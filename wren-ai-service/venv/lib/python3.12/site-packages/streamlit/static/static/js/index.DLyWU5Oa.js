var xL=Object.defineProperty;var wL=(t,e,r)=>e in t?xL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var U=(t,e,r)=>wL(t,typeof e!="symbol"?e+"":e,r);import{g as oA,r as it,U as Wt,p as $e,d as VM,aq as yu,_ as jM,Z as TL,j as ms,a8 as Ll,ar as Hy,F as aE,as as Gy,at as EL,au as lE,av as SL,a6 as CL,aw as PL,ak as IL,n as HM,a4 as GM,ax as w1,ay as cE,$ as ML,M as RL,az as uE}from"./index.Phesr84n.js";import{_ as Gn,C as BL}from"./slicedToArray.Dw1BZbJJ.js";import{b as Fu,a as Lu,_ as a2,c as Gd,d as l2}from"./getPrototypeOf.BipnGiky.js";import{a as OL,T as DL}from"./Toolbar.BZTRaRnq.js";import{u as WM,E as XM,w as FL}from"./withFullScreenWrapper.BE5Y_29x.js";import{u as LL}from"./useBasicWidgetState.CAe5uv9B.js";import{c as kL}from"./_commonjs-dynamic-modules.TDtrdbi3.js";import{D as NL,C as UL}from"./threshold.skajmqVB.js";import"./FormClearHelper.DwtQkhSE.js";import"./string.Bl9OLDCw.js";function zL(t,e){for(var r=0;r<e.length;r++){const i=e[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in t)){const o=Object.getOwnPropertyDescriptor(i,n);o&&Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}async function aA(t,e,r,i){return i._parse(t,e,r,i)}function Ni(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const v_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),hE=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);hE&&parseFloat(hE[1]);const tg=globalThis,Wf=globalThis.process||{},VL=globalThis.navigator||{};function qM(t){var i,n;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((n=process.versions)!=null&&n.electron))return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function ku(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||qM()}function jL(t){return ku()?qM()?"Electron":(VL.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const $M="4.0.7";function HL(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}class WL{constructor(e,r,i="sessionStorage"){this.storage=HL(i),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}}function XL(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function qL(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var mm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(mm||(mm={}));const $L=10;function fE(t){return typeof t!="string"?t:(t=t.toUpperCase(),mm[t]||mm.WHITE)}function ZL(t,e,r){return!ku&&typeof t=="string"&&(e&&(t=`\x1B[${fE(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${fE(r)+$L}m${t}\x1B[49m`)),t}function KL(t,e=["constructor"]){const r=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(r),n=t;for(const o of i){const s=n[o];typeof s=="function"&&(e.find(f=>o===f)||(n[o]=s.bind(t)))}}function c2(t,e){if(!t)throw new Error("Assertion failed")}function Xf(){var e,r,i;let t;if(ku()&&tg.performance)t=(r=(e=tg==null?void 0:tg.performance)==null?void 0:e.now)==null?void 0:r.call(e);else if("hrtime"in Wf){const n=(i=Wf==null?void 0:Wf.hrtime)==null?void 0:i.call(Wf);t=n[0]*1e3+n[1]/1e6}else t=Date.now();return t}const qf={debug:ku()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},YL={enabled:!0,level:0};function $f(){}const dE={},AE={once:!0};class lA{constructor({id:e}={id:""}){this.VERSION=$M,this._startTs=Xf(),this._deltaTs=Xf(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new WL(`__probe-${this.id}__`,YL),this.timeStamp(`${this.id} started`),KL(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Xf()-this._startTs).toPrecision(10))}getDelta(){return Number((Xf()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,qf.warn,arguments,AE)}error(e){return this._getLogFunction(0,e,qf.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,qf.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,qf.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,qf.debug||qf.info,arguments,AE)}table(e,r,i){return r?this._getLogFunction(e,r,console.table||$f,i&&[i],{tag:QL(r)}):$f}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||$f)}group(e,r,i={collapsed:!1}){const n=pE({logLevel:e,message:r,opts:i}),{collapsed:o}=i;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,r,i={}){return this.group(e,r,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||$f)}withGroup(e,r,i){this.group(e,r)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=ZM(e)}_getLogFunction(e,r,i,n,o){if(this._shouldLog(e)){o=pE({logLevel:e,message:r,args:n,opts:o}),i=i||o.method,c2(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Xf();const s=o.tag||o.message;if(o.once&&s)if(!dE[s])dE[s]=Xf();else return $f;return r=JL(this.id,o.message,o),i.bind(console,r,...o.args)}return $f}}lA.VERSION=$M;function ZM(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return c2(Number.isFinite(e)&&e>=0),e}function pE(t){const{logLevel:e,message:r}=t;t.logLevel=ZM(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&i.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const n=typeof t.message;return c2(n==="string"||n==="object"),Object.assign(t,{args:i},t.opts)}function JL(t,e,r){if(typeof e=="string"){const i=r.time?qL(XL(r.total)):"";e=r.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=ZL(e,r.color,r.background)}return e}function QL(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}globalThis.probe={};const KM=new lA({id:"@probe.gl/log"});function YM(t,e){return JM(t||{},e)}function JM(t,e,r=0){if(r>3)return e;const i={...t};for(const[n,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?i[n]=JM(i[n]||{},e[n],r+1):i[n]=e[n];return i}function ek(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}function tk(t){var r,i;return((i=(r=globalThis.loaders)==null?void 0:r.modules)==null?void 0:i[t])||null}const rk="latest";function ik(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.4"),globalThis._loadersgl_.version}const QM=ik();function Pc(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Sa=typeof process!="object"||String(process)!=="[object process]"||process.browser,u2=typeof importScripts=="function",nk=typeof window<"u"&&typeof window.orientation<"u",gE=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);gE&&parseFloat(gE[1]);class sk{constructor(e,r){U(this,"name");U(this,"workerThread");U(this,"isRunning",!0);U(this,"result");U(this,"_resolve",()=>{});U(this,"_reject",()=>{});this.name=e,this.workerThread=r,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){Pc(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Pc(this.isRunning),this.isRunning=!1,this._reject(e)}}class Wy{terminate(){}}const Xy=new Map;function ok(t){Pc(t.source&&!t.url||!t.source&&t.url);let e=Xy.get(t.source||t.url);return e||(t.url&&(e=ak(t.url),Xy.set(t.url,e)),t.source&&(e=eR(t.source),Xy.set(t.source,e))),Pc(e),e}function ak(t){if(!t.startsWith("http"))return t;const e=lk(t);return eR(e)}function eR(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function lk(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function tR(t,e=!0,r){const i=r||new Set;if(t){if(mE(t))i.add(t);else if(mE(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const n in t)tR(t[n],e,i)}}return r===void 0?Array.from(i):[]}function mE(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const qy=()=>{};class T1{constructor(e){U(this,"name");U(this,"source");U(this,"url");U(this,"terminated",!1);U(this,"worker");U(this,"onMessage");U(this,"onError");U(this,"_loadableURL","");const{name:r,source:i,url:n}=e;Pc(i||n),this.name=r,this.source=i,this.url=n,this.onMessage=qy,this.onError=o=>console.log(o),this.worker=Sa?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Sa||typeof Wy<"u"&&!Sa}destroy(){this.onMessage=qy,this.onError=qy,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||tR(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=ok({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Wy(i,{eval:!1})}else if(this.source)e=new Wy(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}}class ck{constructor(e){U(this,"name","unnamed");U(this,"source");U(this,"url");U(this,"maxConcurrency",1);U(this,"maxMobileConcurrency",1);U(this,"onDebug",()=>{});U(this,"reuseWorkers",!0);U(this,"props",{});U(this,"jobQueue",[]);U(this,"idleQueue",[]);U(this,"count",0);U(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return T1.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(n,o,s)=>n.done(s),i=(n,o)=>n.error(o)){const n=new Promise(o=>(this.jobQueue.push({name:e,onMessage:r,onError:i,onStart:o}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const i=new sk(r.name,e);e.onMessage=n=>r.onMessage(i,n.type,n.payload),e.onError=n=>r.onError(i,n),r.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Sa||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new T1({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return nk?this.maxMobileConcurrency:this.maxConcurrency}}const uk={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},xu=class xu{constructor(e){U(this,"props");U(this,"workerPools",new Map);this.props={...uk},this.setProps(e),this.workerPools=new Map}static isSupported(){return T1.isSupported()}static getWorkerFarm(e={}){return xu._workerFarm=xu._workerFarm||new xu({}),xu._workerFarm.setProps(e),xu._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:i,url:n}=e;let o=this.workerPools.get(r);return o||(o=new ck({name:r,source:i,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};U(xu,"_workerFarm");let _m=xu;function hk(t,e={}){const r=e[t.id]||{},i=Sa?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let n=r.workerUrl;if(!n&&t.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(Sa?n=`modules/${t.module}/dist/${i}`:n=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!n){let o=t.version;o==="latest"&&(o=rk);const s=o?`@${o}`:"";n=`https://unpkg.com/@loaders.gl/${t.module}${s}/dist/${i}`}return Pc(n),n}function fk(t,e=QM){Pc(t,"no worker provided");const r=t.version;return!(!e||!r)}const $y={};async function Rh(t,e=null,r={},i=null){return e&&(t=dk(t,e,r,i)),$y[t]=$y[t]||Ak(t),await $y[t]}function dk(t,e,r={},i=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;i=i||t;const n=r.modules||{};return n[i]?n[i]:Sa?r.CDN?(Pc(r.CDN.startsWith("http")),`${r.CDN}/${e}@${QM}/dist/libs/${i}`):u2?`../src/libs/${i}`:`modules/${e}/src/libs/${i}`:`modules/${e}/dist/libs/${i}`}async function Ak(t){if(t.endsWith("wasm"))return await gk(t);if(!Sa)try{const{requireFromFile:r}=globalThis.loaders||{};return await(r==null?void 0:r(t))}catch(r){return console.error(r),null}if(u2)return importScripts(t);const e=await mk(t);return pk(e,t)}function pk(t,e){if(!Sa){const{requireFromString:i}=globalThis.loaders||{};return i==null?void 0:i(t,e)}if(u2)return eval.call(globalThis,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function gk(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Sa||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function mk(t){const{readFileAsText:e}=globalThis.loaders||{};return Sa||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function _k(t,e){return!_m.isSupported()||!Sa&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function yk(t,e,r,i,n){const o=t.id,s=hk(t,r),A=_m.getWorkerFarm(r).getWorkerPool({name:o,url:s});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));const v=await A.startJob("process-on-worker",vk.bind(null,n));return v.postMessage("process",{input:e,options:r,context:i}),await(await v.result).result}async function vk(t,e,r,i){switch(r){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:n,input:o,options:s}=i;try{const f=await t(o,s);e.postMessage("done",{id:n,result:f})}catch(f){const A=f instanceof Error?f.message:"unknown error";e.postMessage("error",{id:n,error:A})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function bk(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?_E(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?_E(t,0,e):""}function _E(t,e,r){if(t.byteLength<=e+r)return"";const i=new DataView(t);let n="";for(let o=0;o<r;o++)n+=String.fromCharCode(i.getUint8(e+o));return n}function xk(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${bk(t)}"`)}}function wk(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const i=new Uint8Array(t),n=new Uint8Array(e);for(let o=0;o<i.length;++o)if(i[o]!==n[o])return!1;return!0}function Tk(...t){return Ek(t)}function Ek(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=e.reduce((o,s)=>o+s.byteLength,0),i=new Uint8Array(r);let n=0;for(const o of e)i.set(o,n),n+=o.byteLength;return i.buffer}function Zy(...t){const e=t,r=e&&e.length>1&&e[0].constructor||null;if(!r)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');const i=e.reduce((s,f)=>s+f.length,0),n=new r(i);let o=0;for(const s of e)n.set(s,o),o+=s.length;return n}function h2(t,e,r){const i=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function i0(t,e){return Ni(t>=0),Ni(e>0),t+(e-1)&~(e-1)}function Sk(t,e,r){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{const n=t.byteOffset,o=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,n,o)}return e.set(i,r),r+i0(i.byteLength,4)}async function Ck(t){const e=[];for await(const r of t)e.push(r);return Tk(...e)}function yE(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class vE{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=yE(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(yE()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class cA{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:i}=e;let n=this.stats[r];return n||(e instanceof vE?n=e:n=new vE(r,i),this.stats[r]=n),n}}const Pk="Queued Requests",Ik="Active Requests",Mk="Cancelled Requests",Rk="Queued Requests Ever",Bk="Active Requests Ever",Ok={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class rR{constructor(e={}){U(this,"props");U(this,"stats");U(this,"activeRequestCount",0);U(this,"requestQueue",[]);U(this,"requestMap",new Map);U(this,"updateTimer",null);this.props={...Ok,...e},this.stats=new cA({id:this.props.id}),this.stats.get(Pk),this.stats.get(Ik),this.stats.get(Mk),this.stats.get(Rk),this.stats.get(Bk)}scheduleRequest(e,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:r},n=new Promise(o=>(i.resolve=o,i));return this.requestQueue.push(i),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:r,resolve:i}=e;let n=!1;const o=()=>{n||(n=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let r=0;r<e;++r){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let r=0;r<e.length;++r){const i=e[r];this._updateRequest(i)||(e.splice(r,1),this.requestMap.delete(i.handle),r--)}e.sort((r,i)=>r.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let Dk="";const bE={};function Fk(t){for(const e in bE)if(t.startsWith(e)){const r=bE[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${Dk}${t}`),t}function Lk(t){return t&&typeof t=="object"&&t.isBuffer}function iR(t){if(Lk(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function kk(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(e=window.location)==null?void 0:e.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function nR(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function f2(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function Nk(...t){const e=[];for(let o=0;o<t.length;o++)e[o]=t[o];let r="",i=!1,n;for(let o=e.length-1;o>=-1&&!i;o--){let s;o>=0?s=e[o]:(n===void 0&&(n=kk()),s=n),s.length!==0&&(r=`${s}/${r}`,i=s.charCodeAt(0)===up)}return r=Uk(r,!i),i?`/${r}`:r.length>0?r:"."}const up=47,Ky=46;function Uk(t,e){let r="",i=-1,n=0,o,s=!1;for(let f=0;f<=t.length;++f){if(f<t.length)o=t.charCodeAt(f);else{if(o===up)break;o=up}if(o===up){if(!(i===f-1||n===1))if(i!==f-1&&n===2){if(r.length<2||!s||r.charCodeAt(r.length-1)!==Ky||r.charCodeAt(r.length-2)!==Ky){if(r.length>2){const A=r.length-1;let v=A;for(;v>=0&&r.charCodeAt(v)!==up;--v);if(v!==A){r=v===-1?"":r.slice(0,v),i=f,n=0,s=!1;continue}}else if(r.length===2||r.length===1){r="",i=f,n=0,s=!1;continue}}e&&(r.length>0?r+="/..":r="..",s=!0)}else{const A=t.slice(i+1,f);r.length>0?r+=`/${A}`:r=A,s=!1}i=f,n=0}else o===Ky&&n!==-1?++n:n=-1}return r}class zk{constructor(e){U(this,"fetch");U(this,"loadOptions");U(this,"_needsRefresh",!0);U(this,"props");this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=Vk(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(e=!0){const r=this._needsRefresh;return e&&(this._needsRefresh=!1),r}}function Vk(t){const e=t==null?void 0:t.fetch;if(e&&typeof e=="function")return(i,n)=>e(i,n);const r=t==null?void 0:t.fetch;return r&&typeof r!="function"?i=>fetch(i,r):i=>fetch(i)}class Fp extends zk{}U(Fp,"type","template"),U(Fp,"testURL",e=>!1);const jk=t=>typeof t=="boolean",_p=t=>typeof t=="function",n0=t=>t!==null&&typeof t=="object",xE=t=>n0(t)&&t.constructor==={}.constructor,Hk=t=>!!t&&typeof t[Symbol.iterator]=="function",Gk=t=>t&&typeof t[Symbol.asyncIterator]=="function",Hh=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Gh=t=>typeof Blob<"u"&&t instanceof Blob,Wk=t=>t&&typeof t=="object"&&t.isBuffer,Xk=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||n0(t)&&_p(t.tee)&&_p(t.cancel)&&_p(t.getReader),qk=t=>n0(t)&&_p(t.read)&&_p(t.pipe)&&jk(t.readable),sR=t=>Xk(t)||qk(t);class $k extends Error{constructor(r,i){super(r);U(this,"reason");U(this,"url");U(this,"response");this.reason=i.reason,this.url=i.url,this.response=i.response}}const Zk=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Kk=/^([-\w.]+\/[-\w.+]+)/;function wE(t,e){return t.toLowerCase()===e.toLowerCase()}function Yk(t){const e=Kk.exec(t);return e?e[1]:t}function TE(t){const e=Zk.exec(t);return e?e[1]:""}const oR=/\?.*/;function Jk(t){const e=t.match(oR);return e&&e[0]}function d2(t){return t.replace(oR,"")}function Qk(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function b_(t){return Hh(t)?t.url:Gh(t)?t.name||"":typeof t=="string"?t:""}function A2(t){if(Hh(t)){const e=t,r=e.headers.get("content-type")||"",i=d2(e.url);return Yk(r)||TE(i)}return Gh(t)?t.type||"":typeof t=="string"?TE(t):""}function e8(t){return Hh(t)?t.headers["content-length"]||-1:Gh(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function aR(t){if(Hh(t))return t;const e={},r=e8(t);r>=0&&(e["content-length"]=String(r));const i=b_(t),n=A2(t);n&&(e["content-type"]=n);const o=await i8(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const s=new Response(t,{headers:e});return Object.defineProperty(s,"url",{value:i}),s}async function t8(t){if(!t.ok)throw await r8(t)}async function r8(t){const e=Qk(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const i={reason:t.statusText,url:t.url,response:t};try{const n=t.headers.get("Content-Type");i.reason=n!=null&&n.includes("application/json")?await t.json():t.text()}catch{}return new $k(r,i)}async function i8(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const r=t.slice(0,5);return await new Promise(i=>{const n=new FileReader;n.onload=o=>{var s;return i((s=o==null?void 0:o.target)==null?void 0:s.result)},n.readAsDataURL(r)})}if(t instanceof ArrayBuffer){const r=t.slice(0,5);return`data:base64,${n8(r)}`}return null}function n8(t){let e="";const r=new Uint8Array(t);for(let i=0;i<r.byteLength;i++)e+=String.fromCharCode(r[i]);return btoa(e)}function s8(t){return!o8(t)&&!a8(t)}function o8(t){return t.startsWith("http:")||t.startsWith("https:")}function a8(t){return t.startsWith("data:")}async function EE(t,e){var r,i;if(typeof t=="string"){const n=Fk(t);return s8(n)&&(r=globalThis.loaders)!=null&&r.fetchNode?(i=globalThis.loaders)==null?void 0:i.fetchNode(n,e):await fetch(n,e)}return await aR(t)}const SE=new lA({id:"loaders.gl"});class l8{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class c8{constructor(){U(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const lR={fetch:null,mimeType:void 0,nothrow:!1,log:new c8,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:v_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},u8={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function cR(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function uR(){const t=cR();return t.globalOptions=t.globalOptions||{...lR},t.globalOptions}function h8(t,e,r,i){return r=r||[],r=Array.isArray(r)?r:[r],f8(t,r),A8(e,t,i)}function f8(t,e){CE(t,null,lR,u8,e);for(const r of e){const i=t&&t[r.id]||{},n=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};CE(i,r.id,n,o,e)}}function CE(t,e,r,i,n){const o=e||"Top level",s=e?`${e}.`:"";for(const f in t){const A=!e&&n0(t[f]),v=f==="baseUri"&&!e,w=f==="workerUrl"&&e;if(!(f in r)&&!v&&!w){if(f in i)SE.warn(`${o} loader option '${s}${f}' no longer supported, use '${i[f]}'`)();else if(!A){const C=d8(f,n);SE.warn(`${o} loader option '${s}${f}' not recognized. ${C}`)()}}}}function d8(t,e){const r=t.toLowerCase();let i="";for(const n of e)for(const o in n.options){if(t===o)return`Did you mean '${n.id}.${o}'?`;const s=o.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(i=i||`Did you mean '${n.id}.${o}'?`)}return i}function A8(t,e,r){const n={...t.options||{}};return p8(n,r),n.log===null&&(n.log=new l8),PE(n,uR()),PE(n,e),n}function PE(t,e){for(const r in e)if(r in e){const i=e[r];xE(i)&&xE(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function p8(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function p2(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function g2(t){Ni(t,"null loader"),Ni(p2(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const hR=()=>{const t=cR();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function s0(t){const e=hR();t=Array.isArray(t)?t:[t];for(const r of t){const i=g2(r);e.find(n=>i===n)||e.unshift(i)}}function g8(){return hR()}const m8=new lA({id:"loaders.gl"}),_8=/\.([^.]+)$/;async function y8(t,e=[],r,i){if(!fR(t))return null;let n=IE(t,e,{...r,nothrow:!0},i);if(n)return n;if(Gh(t)&&(t=await t.slice(0,10).arrayBuffer(),n=IE(t,e,r,i)),!n&&!(r!=null&&r.nothrow))throw new Error(dR(t));return n}function IE(t,e=[],r,i){if(!fR(t))return null;if(e&&!Array.isArray(e))return g2(e);let n=[];e&&(n=n.concat(e)),r!=null&&r.ignoreRegisteredLoaders||n.push(...g8()),b8(n);const o=v8(t,n,r,i);if(!o&&!(r!=null&&r.nothrow))throw new Error(dR(t));return o}function v8(t,e,r,i){const n=b_(t),o=A2(t),s=d2(n)||(i==null?void 0:i.url);let f=null,A="";return r!=null&&r.mimeType&&(f=Yy(e,r==null?void 0:r.mimeType),A=`match forced by supplied MIME type ${r==null?void 0:r.mimeType}`),f=f||x8(e,s),A=A||(f?`matched url ${s}`:""),f=f||Yy(e,o),A=A||(f?`matched MIME type ${o}`:""),f=f||T8(e,t),A=A||(f?`matched initial data ${AR(t)}`:""),r!=null&&r.fallbackMimeType&&(f=f||Yy(e,r==null?void 0:r.fallbackMimeType),A=A||(f?`matched fallback MIME type ${o}`:"")),A&&m8.log(1,`selectLoader selected ${f==null?void 0:f.name}: ${A}.`),f}function fR(t){return!(t instanceof Response&&t.status===204)}function dR(t){const e=b_(t),r=A2(t);let i="No valid loader found (";i+=e?`${nR(e)}, `:"no url provided, ",i+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const n=t?AR(t):"";return i+=n?` first bytes: "${n}"`:"first bytes: not available",i+=")",i}function b8(t){for(const e of t)g2(e)}function x8(t,e){const r=e&&_8.exec(e),i=r&&r[1];return i?w8(t,i):null}function w8(t,e){e=e.toLowerCase();for(const r of t)for(const i of r.extensions)if(i.toLowerCase()===e)return r;return null}function Yy(t,e){var r;for(const i of t)if((r=i.mimeTypes)!=null&&r.some(n=>wE(e,n))||wE(e,`application/x.${i.id}`))return i;return null}function T8(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(E8(e,r))return r}else if(ArrayBuffer.isView(e)){if(ME(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&ME(e,0,r))return r;return null}function E8(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function ME(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>S8(t,e,r,n))}function S8(t,e,r,i){if(i instanceof ArrayBuffer)return wk(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":const n=E1(t,e,i.length);return i===n;default:return!1}}function AR(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?E1(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?E1(t,0,e):""}function E1(t,e,r){if(t.byteLength<e+r)return"";const i=new DataView(t);let n="";for(let o=0;o<r;o++)n+=String.fromCharCode(i.getUint8(e+o));return n}const C8=256*1024;function*P8(t,e){const r=(e==null?void 0:e.chunkSize)||C8;let i=0;const n=new TextEncoder;for(;i<t.length;){const o=Math.min(t.length-i,r),s=t.slice(i,i+o);i+=o,yield n.encode(s)}}const I8=256*1024;function*M8(t,e={}){const{chunkSize:r=I8}=e;let i=0;for(;i<t.byteLength;){const n=Math.min(t.byteLength-i,r),o=new ArrayBuffer(n),s=new Uint8Array(t,i,n);new Uint8Array(o).set(s),i+=n,yield o}}const R8=1024*1024;async function*B8(t,e){const r=(e==null?void 0:e.chunkSize)||R8;let i=0;for(;i<t.size;){const n=i+r,o=await t.slice(i,n).arrayBuffer();i=n,yield o}}function RE(t,e){return v_?O8(t,e):D8(t)}async function*O8(t,e){const r=t.getReader();let i;try{for(;;){const n=i||r.read();e!=null&&e._streamReadAhead&&(i=r.read());const{done:o,value:s}=await n;if(o)return;yield iR(s)}}catch{r.releaseLock()}}async function*D8(t,e){for await(const r of t)yield iR(r)}function F8(t,e){if(typeof t=="string")return P8(t,e);if(t instanceof ArrayBuffer)return M8(t,e);if(Gh(t))return B8(t,e);if(sR(t))return RE(t,e);if(Hh(t))return RE(t.body,e);throw new Error("makeIterator")}const pR="Cannot convert supplied data type";function L8(t,e,r){if(e.text&&typeof t=="string")return t;if(Wk(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const n=t.byteLength||t.length;return(t.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+n)),i}throw new Error(pR)}async function k8(t,e,r){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return L8(t,e);if(Gh(t)&&(t=await aR(t)),Hh(t)){const n=t;return await t8(n),e.binary?await n.arrayBuffer():await n.text()}if(sR(t)&&(t=F8(t,r)),Hk(t)||Gk(t))return Ck(t);throw new Error(pR)}function gR(t,e){const r=uR(),i=t||r;return typeof i.fetch=="function"?i.fetch:n0(i.fetch)?n=>EE(n,i.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:EE}function N8(t,e,r){if(r)return r;const i={fetch:gR(e,t),...t};if(i.url){const n=d2(i.url);i.baseUrl=n,i.queryString=Jk(i.url),i.filename=nR(n),i.baseUrl=f2(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function U8(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...i]:i}return r&&r.length?r:void 0}async function ym(t,e,r,i){e&&!Array.isArray(e)&&!p2(e)&&(i=void 0,r=e,e=void 0),t=await t,r=r||{};const n=b_(t),s=U8(e,i),f=await y8(t,s,r);return f?(r=h8(r,f,s,n),i=N8({url:n,_parse:ym,loaders:s},r,i||null),await z8(f,t,r,i)):null}async function z8(t,e,r,i){if(fk(t),r=YM(t.options,r),Hh(e)){const o=e,{ok:s,redirected:f,status:A,statusText:v,type:w,url:C}=o,I=Object.fromEntries(o.headers.entries());i.response={headers:I,ok:s,redirected:f,status:A,statusText:v,type:w,url:C}}e=await k8(e,t,r);const n=t;if(n.parseTextSync&&typeof e=="string")return n.parseTextSync(e,r,i);if(_k(t,r))return await yk(t,e,r,i,ym);if(n.parseText&&typeof e=="string")return await n.parseText(e,r,i);if(n.parse)return await n.parse(e,r,i);throw Pc(!n.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}const BE=100;class V8{constructor(e,r){U(this,"schema");U(this,"options");U(this,"shape");U(this,"length",0);U(this,"rows",null);U(this,"cursor",0);U(this,"_headers",[]);if(this.options=r,this.schema=e,!Array.isArray(e)){this._headers=[];for(const i in e)this._headers[e[i].index]=e[i].name}}rowCount(){return this.length}addArrayRow(e,r){Number.isFinite(r)&&(this.cursor=r),this.shape="array-row-table",this.rows=this.rows||new Array(BE),this.rows[this.length]=e,this.length++}addObjectRow(e,r){Number.isFinite(r)&&(this.cursor=r),this.shape="object-row-table",this.rows=this.rows||new Array(BE),this.rows[this.length]=e,this.length++}getBatch(){let e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function mR(t,e){if(!t)throw new Error("null row");const r={};if(e)for(let i=0;i<e.length;i++)r[e[i]]=t[i];else for(let i=0;i<t.length;i++){const n=`column-${i}`;r[n]=t[i]}return r}function _R(t,e){if(!t)throw new Error("null row");if(e){const r=new Array(e.length);for(let i=0;i<e.length;i++)r[i]=t[e[i]];return r}return Object.values(t)}function j8(t){const e=[];for(let r=0;r<t.length;r++){const i=`column-${r}`;e.push(i)}return e}function H8(t){return Object.keys(t)}const OE=100;class G8{constructor(e,r){U(this,"schema");U(this,"options");U(this,"length",0);U(this,"objectRows",null);U(this,"arrayRows",null);U(this,"cursor",0);U(this,"_headers",null);if(this.options=r,this.schema=e,e){this._headers=[];for(const i in e)this._headers[e[i].index]=e[i].name}}rowCount(){return this.length}addArrayRow(e,r){switch(Number.isFinite(r)&&(this.cursor=r),this._headers||(this._headers=j8(e)),this.options.shape){case"object-row-table":const i=mR(e,this._headers);this.addObjectRow(i,r);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(OE),this.arrayRows[this.length]=e,this.length++;break}}addObjectRow(e,r){switch(Number.isFinite(r)&&(this.cursor=r),this._headers||(this._headers=H8(e)),this.options.shape){case"array-row-table":const i=_R(e,this._headers);this.addArrayRow(i,r);break;case"object-row-table":this.objectRows=this.objectRows||new Array(OE),this.objectRows[this.length]=e,this.length++;break}}getBatch(){let e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const W8=100;class X8{constructor(e,r){U(this,"schema");U(this,"length",0);U(this,"allocated",0);U(this,"columns",{});this.schema=e,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(e){this._reallocateColumns();let r=0;for(const i in this.columns)this.columns[i][this.length]=e[r++];this.length++}addObjectRow(e){this._reallocateColumns();for(const r in e)this.columns[r][this.length]=e[r];this.length++}getBatch(){this._pruneColumns();const e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const i in this.schema){const n=this.schema[i];e[n.name]=this.columns[n.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:W8,this.columns={};for(const e in this.schema){const r=this.schema[e],i=r.type||Float32Array,n=this.columns[r.index];if(n&&ArrayBuffer.isView(n)){const o=new i(this.allocated);o.set(n),this.columns[r.index]=o}else n?(n.length=this.allocated,this.columns[r.index]=n):this.columns[r.index]=new i(this.allocated)}}}_pruneColumns(){for(const[e,r]of Object.entries(this.columns))this.columns[e]=r.slice(0,this.length)}}const q8={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},$8="TableBatchBuilder",Bp=class Bp{constructor(e,r){U(this,"schema");U(this,"options");U(this,"aggregator",null);U(this,"batchCount",0);U(this,"bytesUsed",0);U(this,"isChunkComplete",!1);U(this,"lastBatchEmittedMs",Date.now());U(this,"totalLength",0);U(this,"totalBytes",0);U(this,"rowBytes",0);this.schema=e,this.options={...q8,...r}}limitReached(){var e,r;return!!((e=this.options)!=null&&e.limit&&this.totalLength>=this.options.limit||(r=this.options)!=null&&r._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}addArrayRow(e){if(!this.aggregator){const r=this._getTableBatchType();this.aggregator=new r(this.schema,this.options)}this.aggregator.addArrayRow(e)}addObjectRow(e){if(!this.aggregator){const r=this._getTableBatchType();this.aggregator=new r(this.schema,this.options)}this.aggregator.addObjectRow(e)}chunkComplete(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),typeof e=="string"&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}getFullBatch(e){return this._isFull()?this._getBatch(e):null}getFinalBatch(e){return this._getBatch(e)}_estimateRowMB(e){return Array.isArray(e)?e.length*8:Object.keys(e).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(e){if(!this.aggregator)return null;e!=null&&e.bytesUsed&&(this.bytesUsed=e.bytesUsed);const r=this.aggregator.getBatch();return r.count=this.batchCount,r.bytesUsed=this.bytesUsed,Object.assign(r,e),this.batchCount++,this.aggregator=null,r}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return G8;case"columnar-table":return X8;case"arrow-table":if(!Bp.ArrowBatch)throw new Error($8);return Bp.ArrowBatch;default:return V8}}};U(Bp,"ArrowBatch");let S1=Bp;function Z8(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function m2(t){let e=1/0,r=1/0,i=1/0,n=-1/0,o=-1/0,s=-1/0;const f=t.POSITION?t.POSITION.value:[],A=f&&f.length;for(let v=0;v<A;v+=3){const w=f[v],C=f[v+1],I=f[v+2];e=w<e?w:e,r=C<r?C:r,i=I<i?I:i,n=w>n?w:n,o=C>o?C:o,s=I>s?I:s}return[[e,r,i],[n,o,s]]}function K8(t,e,r){const i=Z8(e.value),n=r||Y8(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:i}]},nullable:!1,metadata:n}}function Y8(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}class DE extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}class J8{constructor(){U(this,"_values");U(this,"_settlers");U(this,"_closed");this._values=new DE,this._settlers=new DE,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const r=this._settlers.dequeue();e instanceof Error?r.reject(e):r.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((e,r)=>{this._settlers.enqueue({resolve:e,reject:r})})}}async function Ic(t,e,r,i){let n,o;!Array.isArray(e)&&!p2(e)?(n=[],o=e):(n=e,o=r);const s=gR(o);let f=t;return typeof t=="string"&&(f=await s(t)),Gh(t)&&(f=await s(t)),Array.isArray(n)?await ym(f,n,o):await ym(f,n,o)}const Q8="4.2.4";var zM;const e5=(zM=globalThis.loaders)==null?void 0:zM.parseImageNode,C1=typeof Image<"u",P1=typeof ImageBitmap<"u",t5=!!e5,I1=v_?!0:t5;function r5(t){switch(t){case"auto":return P1||C1||I1;case"imagebitmap":return P1;case"image":return C1;case"data":return I1;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function i5(){if(P1)return"imagebitmap";if(C1)return"image";if(I1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function n5(t){const e=s5(t);if(!e)throw new Error("Not an image");return e}function yR(t){switch(n5(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function s5(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const o5=/^data:image\/svg\+xml/,a5=/\.svg((\?|#).*)?$/;function _2(t){return t&&(o5.test(t)||a5.test(t))}function l5(t,e){if(_2(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return vR(t,e)}function vR(t,e){if(_2(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function bR(t,e,r){const i=l5(t,r),n=self.URL||self.webkitURL,o=typeof i!="string"&&n.createObjectURL(i);try{return await c5(o||i,e)}finally{o&&n.revokeObjectURL(o)}}async function c5(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((i,n)=>{try{r.onload=()=>i(r),r.onerror=o=>{const s=o instanceof Error?o.message:"error";n(new Error(s))}}catch(o){n(o)}})}const u5={};let FE=!0;async function h5(t,e,r){let i;_2(r)?i=await bR(t,e,r):i=vR(t,r);const n=e&&e.imagebitmap;return await f5(i,n)}async function f5(t,e=null){if((d5(e)||!FE)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),FE=!1}return await createImageBitmap(t)}function d5(t){for(const e in t||u5)return!1;return!0}function A5(t){return!_5(t,"ftyp",4)||!(t[8]&96)?null:p5(t)}function p5(t){switch(g5(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function g5(t,e,r){return String.fromCharCode(...t.slice(e,r))}function m5(t){return[...t].map(e=>e.charCodeAt(0))}function _5(t,e,r=0){const i=m5(e);for(let n=0;n<i.length;++n)if(i[n]!==t[n+r])return!1;return!0}const kl=!1,yp=!0;function y2(t){const e=o0(t);return v5(e)||w5(e)||b5(e)||x5(e)||y5(e)}function y5(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=A5(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function v5(t){const e=o0(t);return e.byteLength>=24&&e.getUint32(0,kl)===2303741511?{mimeType:"image/png",width:e.getUint32(16,kl),height:e.getUint32(20,kl)}:null}function b5(t){const e=o0(t);return e.byteLength>=10&&e.getUint32(0,kl)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,yp),height:e.getUint16(8,yp)}:null}function x5(t){const e=o0(t);return e.byteLength>=14&&e.getUint16(0,kl)===16973&&e.getUint32(2,yp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,yp),height:e.getUint32(22,yp)}:null}function w5(t){const e=o0(t);if(!(e.byteLength>=3&&e.getUint16(0,kl)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=T5();let o=2;for(;o+9<e.byteLength;){const s=e.getUint16(o,kl);if(n.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,kl),width:e.getUint16(o+7,kl)};if(!i.has(s))return null;o+=2,o+=e.getUint16(o,kl)}return null}function T5(){const t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function o0(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function E5(t,e){var n;const{mimeType:r}=y2(t)||{},i=(n=globalThis.loaders)==null?void 0:n.parseImageNode;return Ni(i),await i(t,r)}async function S5(t,e,r){e=e||{};const n=(e.image||{}).type||"auto",{url:o}=r||{},s=C5(n);let f;switch(s){case"imagebitmap":f=await h5(t,e,o);break;case"image":f=await bR(t,e,o);break;case"data":f=await E5(t);break;default:Ni(!1)}return n==="data"&&(f=yR(f)),f}function C5(t){switch(t){case"auto":case"data":return i5();default:return r5(t),t}}const P5=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],I5=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],M5={image:{type:"auto",decode:!0}},Lp={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Q8,mimeTypes:I5,extensions:P5,parse:S5,tests:[t=>!!y2(new DataView(t))],options:M5},Jy={};function R5(t){if(Jy[t]===void 0){const e=v_?O5(t):B5(t);Jy[t]=e}return Jy[t]}function B5(t){var n,o;const e=["image/png","image/jpeg","image/gif"],r=((n=globalThis.loaders)==null?void 0:n.imageFormatsNode)||e;return!!((o=globalThis.loaders)==null?void 0:o.parseImageNode)&&r.includes(t)}function O5(t){switch(t){case"image/avif":case"image/webp":return D5(t);default:return!0}}function D5(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const fr=new lA({id:"deck"});let M1={};function F5(t){M1=t}function js(t,e,r,i){fr.level>0&&M1[t]&&M1[t].call(null,e,r,i)}function L5(t){const e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}const k5={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:L5,parseTextSync:JSON.parse};function N5(){const t="9.0.33",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(fr.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:fr,_registerLoggers:F5},s0([k5,[Lp,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const U5=N5();function Sh(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Qy={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function z5(t){const e={};for(const[r,i]of Object.entries(t))e[r]=j5(i);return e}function V5(t,e,r){const i={};for(const[n,o]of Object.entries(e))t&&n in t&&!o.private?(o.validate&&Sh(o.validate(t[n],o),`${r}: invalid ${n}`),i[n]=t[n]):i[n]=o.value;return i}function j5(t){let e=LE(t);if(e!=="object")return{value:t,...Qy[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Qy[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=LE(t.value),{...t,...Qy[e],type:e}):{type:"object",value:null};throw new Error("props")}function LE(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const H5=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,G5=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,W5={vertex:H5,fragment:G5},kE=/void\s+main\s*\([^)]*\)\s*\{\n?/,NE=/}\n?[^{}]*$/,ev=[],tm="__LUMA_INJECT_DECLARATIONS__";function X5(t){const e={vertex:{},fragment:{}};for(const r in t){let i=t[r];const n=q5(r);typeof i=="string"&&(i={order:0,injection:i}),e[n][r]=i}return e}function q5(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function vm(t,e,r,i=!1){const n=e==="vertex";for(const o in r){const s=r[o];s.sort((A,v)=>A.order-v.order),ev.length=s.length;for(let A=0,v=s.length;A<v;++A)ev[A]=s[A].injection;const f=`${ev.join(`
`)}
`;switch(o){case"vs:#decl":n&&(t=t.replace(tm,f));break;case"vs:#main-start":n&&(t=t.replace(kE,A=>A+f));break;case"vs:#main-end":n&&(t=t.replace(NE,A=>f+A));break;case"fs:#decl":n||(t=t.replace(tm,f));break;case"fs:#main-start":n||(t=t.replace(kE,A=>A+f));break;case"fs:#main-end":n||(t=t.replace(NE,A=>f+A));break;default:t=t.replace(o,A=>A+f)}}return t=t.replace(tm,""),i&&(t=t.replace(/\}\s*$/,o=>o+W5[e])),t}let $5=1;class wu{constructor(e){U(this,"name");U(this,"vs");U(this,"fs");U(this,"getModuleUniforms");U(this,"dependencies");U(this,"deprecations");U(this,"defines");U(this,"injections");U(this,"uniforms",{});U(this,"uniformTypes",{});const{name:r,vs:i,fs:n,dependencies:o=[],uniformTypes:s={},uniformPropTypes:f={},getUniforms:A,deprecations:v=[],defines:w={},inject:C={}}=e;Sh(typeof r=="string"),this.name=r,this.vs=i,this.fs=n,this.getModuleUniforms=A,this.dependencies=wu.instantiateModules(o),this.deprecations=this._parseDeprecationDefinitions(v),this.defines=w,this.injections=X5(C),this.uniformTypes=s,f&&(this.uniforms=z5(f))}static instantiateModules(e){return e.map(r=>{if(r instanceof wu)return r;Sh(typeof r!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(r)}' and use it directly.`),r.name||(console.warn("shader module has no name"),r.name=`shader-module-${$5++}`);const i=new wu(r);return i.dependencies=wu.instantiateModules(r.dependencies||[]),i})}getModuleSource(e){let r;switch(e){case"vertex":r=this.vs||"";break;case"fragment":r=this.fs||"";break;default:Sh(!1)}const i=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${i}
${r}

`}getUniforms(e,r){return this.getModuleUniforms?this.getModuleUniforms(e,r):V5(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,r){this.deprecations.forEach(i=>{var n;(n=i.regex)!=null&&n.test(e)&&(i.deprecated?r.deprecated(i.old,i.new)():r.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(r=>{switch(r.type){case"function":r.regex=new RegExp(`\\b${r.old}\\(`);break;default:r.regex=new RegExp(`${r.type} ${r.old};`)}}),e}_defaultGetUniforms(e={}){const r={},i=this.uniforms;for(const n in i){const o=i[n];n in e&&!o.private?(o.validate&&Sh(o.validate(e[n],o),`${this.name}: invalid ${n}`),r[n]=e[n]):r[n]=o.value}return r}}function UE(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=zE(t.platformInfo,t.vs);let r;return t.fs&&(r=zE(t.platformInfo,t.fs)),{...t,vs:e,fs:r}}function zE(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function x_(t){const e=wu.instantiateModules(t);return Z5(e)}function Z5(t){const e={},r={};return xR({modules:t,level:0,moduleMap:e,moduleDepth:r}),Object.keys(r).sort((i,n)=>r[n]-r[i]).map(i=>e[i])}function xR(t){const{modules:e,level:r,moduleMap:i,moduleDepth:n}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)i[o.name]=o,(n[o.name]===void 0||n[o.name]<r)&&(n[o.name]=r);for(const o of e)o.dependencies&&xR({modules:o.dependencies,level:r+1,moduleMap:i,moduleDepth:n})}function K5(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function Y5(t,e){var i;if(Number(((i=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=VE(t,J5),t;case"fragment":return t=VE(t,Q5),t;default:throw new Error(e)}}const wR=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],J5=[...wR,[R1("attribute"),"in $1"],[R1("varying"),"out $1"]],Q5=[...wR,[R1("varying"),"in $1"]];function VE(t,e){for(const[r,i]of e)t=t.replace(r,i);return t}function R1(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function TR(t,e){let r="";for(const i in t){const n=t[i];if(r+=`void ${n.signature} {
`,n.header&&(r+=`  ${n.header}`),e[i]){const o=e[i];o.sort((s,f)=>s.order-f.order);for(const s of o)r+=`  ${s.injection}
`}n.footer&&(r+=`  ${n.footer}`),r+=`}
`}return r}function ER(t){const e={vertex:{},fragment:{}};for(const r of t){let i,n;typeof r!="string"?(i=r,n=i.hook):(i={},n=r),n=n.trim();const[o,s]=n.split(":"),f=n.replace(/\(.+/,""),A=Object.assign(i,{signature:s});switch(o){case"vs":e.vertex[f]=A;break;case"fs":e.fragment[f]=A;break;default:throw new Error(o)}}return e}function eN(t,e){return{name:tN(t,e),language:"glsl",version:rN(t)}}function tN(t,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return i?i[1]:e}function rN(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const SR=`

${tm}
`,iN=`precision highp float;
`;function nN(t){const e=x_(t.modules||[]);return{source:B1(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:v2(e)}}function sN(t){const e=x_(t.modules||[]);return{vs:B1(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:B1(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:v2(e)}}function oN(t){const{vs:e,fs:r}=t,i=x_(t.modules||[]);return{vs:jE(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:jE(t.platformInfo,{...t,source:r,stage:"fragment",modules:i}),getUniforms:v2(i)}}function B1(t,e){const{source:r,stage:i,modules:n,hookFunctions:o=[],inject:s={},log:f}=e;Sh(typeof r=="string","shader source must be a string");const A=r;let v="";const w=ER(o),C={},I={},B={};for(const N in s){const V=typeof s[N]=="string"?{injection:s[N],order:0}:s[N],G=/^(v|f)s:(#)?([\w-]+)$/.exec(N);if(G){const Y=G[2],Z=G[3];Y?Z==="decl"?I[N]=[V]:B[N]=[V]:C[N]=[V]}else B[N]=[V]}const F=t.type!=="webgpu"?n:[];for(const N of F){f&&N.checkDeprecations(A,f);const V=N.getModuleSource(i,"wgsl");v+=V;const G=N.injections[i];for(const Y in G){const Z=/^(v|f)s:#([\w-]+)$/.exec(Y);if(Z){const ge=Z[2]==="decl"?I:B;ge[Y]=ge[Y]||[],ge[Y].push(G[Y])}else C[Y]=C[Y]||[],C[Y].push(G[Y])}}return v+=SR,v=vm(v,i,I),v+=TR(w[i],C),v+=A,v=vm(v,i,B),v}function jE(t,e){const{id:r,source:i,stage:n,language:o="glsl",modules:s,defines:f={},hookFunctions:A=[],inject:v={},prologue:w=!0,log:C}=e;Sh(typeof i=="string","shader source must be a string");const I=o==="glsl"?eN(i).version:-1,B=t.shaderLanguageVersion,F=I===100?"#version 100":"#version 300 es",V=i.split(`
`).slice(1).join(`
`),G={};s.forEach(Ue=>{Object.assign(G,Ue.getDefines())}),Object.assign(G,f);let Y="";switch(o){case"wgsl":break;case"glsl":Y=w?`${F}

// ----- PROLOGUE -------------------------
${aN({id:r,source:i,stage:n})}
${`#define SHADER_TYPE_${n.toUpperCase()}`}
${K5(t)}
${n==="fragment"?iN:""}

// ----- APPLICATION DEFINES -------------------------

${lN(G)}

`:`${F}
`;break}const Z=ER(A),se={},ge={},Pe={};for(const Ue in v){const Fe=typeof v[Ue]=="string"?{injection:v[Ue],order:0}:v[Ue],pe=/^(v|f)s:(#)?([\w-]+)$/.exec(Ue);if(pe){const Te=pe[2],Ae=pe[3];Te?Ae==="decl"?ge[Ue]=[Fe]:Pe[Ue]=[Fe]:se[Ue]=[Fe]}else Pe[Ue]=[Fe]}for(const Ue of s){C&&Ue.checkDeprecations(V,C);const Fe=Ue.getModuleSource(n);Y+=Fe;const pe=Ue.injections[n];for(const Te in pe){const Ae=/^(v|f)s:#([\w-]+)$/.exec(Te);if(Ae){const Ve=Ae[2]==="decl"?ge:Pe;Ve[Te]=Ve[Te]||[],Ve[Te].push(pe[Te])}else se[Te]=se[Te]||[],se[Te].push(pe[Te])}}return Y+="// ----- MAIN SHADER SOURCE -------------------------",Y+=SR,Y=vm(Y,n,ge),Y+=TR(Z[n],se),Y+=V,Y=vm(Y,n,Pe),o==="glsl"&&I!==B&&(Y=Y5(Y,n)),Y.trim()}function v2(t){return function(r){const i={};for(const n of t){const o=n.getUniforms(r,i);Object.assign(i,o)}return i}}function aN(t){const{id:e,source:r,stage:i}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}

`:""}function lN(t={}){let e="";for(const r in t){const i=t[r];(i||Number.isFinite(i))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}const Th=class Th{constructor(){U(this,"_hookFunctions",[]);U(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Th.defaultShaderAssembler=Th.defaultShaderAssembler||new Th,Th.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const r=this._getModuleList(e.modules),i=this._hookFunctions,n=UE(e);return{...nN({platformInfo:e.platformInfo,...n,modules:r,hookFunctions:i}),modules:r}}assembleShaderPair(e){const r=UE(e),i=this._getModuleList(e.modules),n=this._hookFunctions,{platformInfo:o}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?sN({platformInfo:o,...r,modules:i,hookFunctions:n}):oN({platformInfo:o,...r,modules:i,hookFunctions:n}),modules:i}}_getModuleList(e=[]){const r=new Array(this._defaultModules.length+e.length),i={};let n=0;for(let o=0,s=this._defaultModules.length;o<s;++o){const f=this._defaultModules[o],A=f.name;r[n++]=f,i[A]=!0}for(let o=0,s=e.length;o<s;++o){const f=e[o],A=f.name;i[A]||(r[n++]=f,i[A]=!0)}return r.length=n,wu.instantiateModules(r)}};U(Th,"defaultShaderAssembler");let bm=Th;function cN(t){if(!t.normalized&&(t.normalized=!0,t.uniformPropTypes&&!t.getUniforms)){const e=new wu(t);t.getUniforms=e.getUniforms.bind(e)}return t}const uN=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,hN=`#version 300 es
${uN}`;function CR(t){const{input:e,inputChannels:r,output:i}=t||{};if(!e)return hN;if(!r)throw new Error("inputChannels");const n=fN(r),o=dN(e,r);return`#version 300 es
in ${n} ${e};
out vec4 ${i};
void main() {
  ${i} = ${o};
}`}function fN(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function dN(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const Et=new lA({id:"luma.gl"});class AN{constructor(){U(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new cA({id:e})),this.stats.get(e)}}const b2=new AN;function pN(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(ku()&&Et.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:Et,stats:b2}),t}const gN=pN();function mN(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function kp(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:mN(t)}const tv={};function Oc(t="id"){tv[t]=tv[t]||1;const e=tv[t]++;return`${t}-${e}`}function xm(t){let e=!0;for(const r in t){e=!1;break}return e}var x1;let Bi=(x1=class{constructor(e,r,i){U(this,"id");U(this,"props");U(this,"userData",{});U(this,"_device");U(this,"destroyed",!1);U(this,"allocatedBytes",0);U(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=_N(r,i);const n=this.props.id!=="undefined"?this.props.id:Oc(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(e,r=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${r} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${r}s Created`).incrementCount(),e.get(`${r}s Active`).incrementCount()}},U(x1,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),x1);function _N(t,e){const r={...e};for(const i in t)t[i]!==void 0&&(r[i]=t[i]);return r}var jn;let In=(jn=class extends Bi{constructor(r,i){const n={...i};(i.usage||0)&jn.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?n.indexType="uint32":i.data instanceof Uint16Array&&(n.indexType="uint16"));super(r,n,jn.defaultProps);U(this,"usage");U(this,"indexType");U(this,"updateTimestamp");U(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=n.indexType,this.updateTimestamp=r.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(r,i){throw new Error("not implemented")}_setDebugData(r,i,n){const o=ArrayBuffer.isView(r)?r.buffer:r,s=Math.min(r?r.byteLength:n,jn.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(s):i===0&&n===r.byteLength?this.debugData=o.slice(0,s):this.debugData=o.slice(i,i+s)}},U(jn,"defaultProps",{...Bi.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),U(jn,"MAP_READ",1),U(jn,"MAP_WRITE",2),U(jn,"COPY_SRC",4),U(jn,"COPY_DST",8),U(jn,"INDEX",16),U(jn,"VERTEX",32),U(jn,"UNIFORM",64),U(jn,"STORAGE",128),U(jn,"INDIRECT",256),U(jn,"QUERY_RESOLVE",512),U(jn,"DEBUG_DATA_MAX_LENGTH",32),jn);function PR(t){const e=HE[t],r=yN(e),i=t.includes("norm"),n=!i&&!t.startsWith("float"),o=t.startsWith("s");return{dataType:HE[t],byteLength:r,integer:n,signed:o,normalized:i}}function yN(t){return vN[t]}const HE={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},vN={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},bN=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],xN=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function wN(t){return bN.some(e=>t.startsWith(e))}function IR(t){const e=xN.exec(t);if(e){const[,r,i,n,o,s]=e;if(r){const f=`${n}${i}`,A=PR(f);return{format:r,components:r.length,srgb:o==="-srgb",unsized:s==="-unsized",webgl:s==="-webgl",...A}}}return EN(t)}const TN={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function EN(t){var r;const e=TN[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((r=e.format)==null?void 0:r.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class SN{}class CN{constructor(e=[],r){U(this,"features");U(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Op=class Op{constructor(e){U(this,"id");U(this,"props");U(this,"userData",{});U(this,"statsManager",b2);U(this,"_lumaData",{});U(this,"timestamp",0);this.props={...Op.defaultProps,...e},this.id=this.props.id||Oc(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return wN(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const r={...e};return(e.usage||0)&In.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":Et.warn("indices buffer content must be of integer type")()),r}};U(Op,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Et.get("debug"),spector:!!(Et.get("spector")||Et.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Et.error(e.message)}),U(Op,"VERSION",gN);let Wd=Op;function _i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const qA=new Map,Bd=class Bd{static registerDevices(e){for(const r of e)_i(r.type&&r.isSupported&&r.create),qA.set(r.type,r)}static getAvailableDevices(){return Array.from(qA).map(e=>e.type)}static getSupportedDevices(){return Array.from(qA).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Wd.defaultProps,e)}static async attachDevice(e){const r=GE(e.devices)||qA;if(e.handle instanceof WebGL2RenderingContext){const i=r.get("webgl");if(i)return await i.attach(e.handle)}if(e.handle===null){const i=r.get("unknown");if(i)return await i.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var o,s;e={...Bd.defaultProps,...e},e.gl&&(e.type="webgl");const r=GE(e.devices)||qA;let i,n;switch(e.type){case"webgpu":if(i=r.get("webgpu"),i)return await i.create(e);break;case"webgl":if(n=r.get("webgl"),n)return await n.create(e);break;case"unknown":const f=r.get("unknown");if(f)return await f.create(e);break;case"best-available":if(i=r.get("webgpu"),(o=i==null?void 0:i.isSupported)!=null&&o.call(i))return await i.create(e);if(n=r.get("webgl"),(s=n==null?void 0:n.isSupported)!=null&&s.call(n))return await n.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const r=HTMLCanvasElement.prototype;if(!e&&r.originalGetContext){r.getContext=r.originalGetContext,r.originalGetContext=void 0;return}r.originalGetContext=r.getContext,r.getContext=function(i,n){return i==="webgl"||i==="experimental-webgl"?this.originalGetContext("webgl2",n):this.originalGetContext(i,n)}}};U(Bd,"defaultProps",{...Wd.defaultProps,type:"best-available",devices:void 0}),U(Bd,"stats",b2),U(Bd,"log",Et);let Od=Bd;function GE(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const r of t)e.set(r.type,r);return e}const PN=ku()&&typeof document<"u",w_=()=>PN&&document.readyState==="complete",IN={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class x2{constructor(e){U(this,"id");U(this,"props");U(this,"canvas");U(this,"htmlCanvas");U(this,"offscreenCanvas");U(this,"type");U(this,"width",1);U(this,"height",1);U(this,"resizeObserver");U(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...IN,...e},e=this.props,!ku()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=BN(e.canvas):this.canvas=e.canvas;else{const r=ON(e),i=RN((e==null?void 0:e.container)||null);i.insertBefore(r,i.firstChild),this.canvas=r,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(const i of r)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return w_()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:r}=this._canvasSizeInfo;return r?e/r:1}catch{return 1}}cssToDevicePixels(e,r=!0){const i=this.cssToDeviceRatio(),[n,o]=this.getDrawingBufferSize();return DN(e,i,n,o,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let i="width"in r?r.width:this.htmlCanvas.clientWidth,n="height"in r?r.height:this.htmlCanvas.clientHeight;(!i||!n)&&(Et.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,n=this.htmlCanvas.height||1);const o=this._canvasSizeInfo;if(o.clientWidth!==i||o.clientHeight!==n||o.devicePixelRatio!==e){let s=e;const f=Math.floor(i*s),A=Math.floor(n*s);this.htmlCanvas.width=f,this.htmlCanvas.height=A;const[v,w]=this.getDrawingBufferSize();(v!==f||w!==A)&&(s=Math.min(v/i,w/n),this.htmlCanvas.width=Math.floor(i*s),this.htmlCanvas.height=Math.floor(n*s),Et.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=n,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var r;((r=this.htmlCanvas)==null?void 0:r.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}U(x2,"pageLoaded",MN());function MN(){return w_()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function RN(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!w_())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function BN(t){const e=document.getElementById(t);if(!e&&!w_())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function ON(t){const{width:e,height:r}=t,i=document.createElement("canvas");return i.id="lumagl-auto-created-canvas",i.width=e||1,i.height=r||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(r)?`${r}px`:"100%",i}function DN(t,e,r,i,n){const o=t,s=WE(o[0],e,r);let f=XE(o[1],e,i,n),A=WE(o[0]+1,e,r);const v=A===r-1?A:A-1;A=XE(o[1]+1,e,i,n);let w;return n?(A=A===0?A:A+1,w=f,f=A):w=A===i-1?A:A-1,{x:s,y:f,width:Math.max(v-s+1,1),height:Math.max(w-f+1,1)}}function WE(t,e,r){return Math.min(Math.round(t*e),r-1)}function XE(t,e,r,i){return i?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}const bc=class bc extends Bi{constructor(r,i,n=bc.defaultProps){super(r,i,n);U(this,"dimension");U(this,"format");U(this,"width");U(this,"height");U(this,"depth");U(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=r.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};U(bc,"defaultProps",{...Bi.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),U(bc,"COPY_SRC",1),U(bc,"COPY_DST",2),U(bc,"TEXTURE_BINDING",4),U(bc,"STORAGE_BINDING",8),U(bc,"RENDER_ATTACHMENT",16);let Zo=bc;const s_=class s_ extends Bi{get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,s_.defaultProps)}};U(s_,"defaultProps",{...Bi.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let wm=s_;function FN(t,e,r){let i="";const n=e.split(/\r?\n/),o=t.slice().sort((s,f)=>s.lineNum-f.lineNum);switch((r==null?void 0:r.showSourceCode)||"no"){case"all":let s=0;for(let f=1;f<=n.length;f++)for(i+=MR(n[f-1],f,r);o.length>s&&o[s].lineNum===f;){const A=o[s++];i+=qE(A,n,A.lineNum,{...r,inlineSource:!1})}return i;case"issues":case"no":for(const f of t)i+=qE(f,n,f.lineNum,{inlineSource:(r==null?void 0:r.showSourceCode)!=="no"});return i}}function qE(t,e,r,i){if(i!=null&&i.inlineSource){const n=LN(e,r),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${n}${o}${t.type.toUpperCase()}: ${t.message}

`}return i!=null&&i.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function LN(t,e,r){let i="";for(let n=e-2;n<=e;n++){const o=t[n-1];o!==void 0&&(i+=MR(o,e,r))}return i}function MR(t,e,r){const i=r!=null&&r.html?NN(t):t;return`${kN(String(e),4)}: ${i}${r!=null&&r.html?"<br/>":`
`}`}function kN(t,e){let r="";for(let i=t.length;i<e;++i)r+=" ";return r+t}function NN(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function RR(t,e){return{name:UN(t,e),language:"glsl",version:zN(t)}}function UN(t,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return i?i[1]:e}function zN(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}return e}const o_=class o_ extends Bi{constructor(r,i){super(r,{id:VN(i),...i},o_.defaultProps);U(this,"stage");U(this,"source");U(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(r=this.props.debug){switch(r){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();this.props.debug==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(r){var v;if(typeof document>"u"||!(document!=null&&document.createElement))return;const i=RR(this.source).name,n=`${this.stage} ${i}`;let o=FN(r,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const f=document.createElement("Button");f.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,f.style.top="10px",f.style.left="10px",f.style.position="absolute",f.style.zIndex="9999",f.style.width="100%",f.style.textAlign="left",document.body.appendChild(f);const A=document.getElementsByClassName("luma-compiler-log-error");(v=A[0])!=null&&v.scrollIntoView&&A[0].scrollIntoView(),f.onclick=()=>{const w=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(w)}}};U(o_,"defaultProps",{...Bi.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let Tm=o_;function VN(t){return RR(t.source).name||t.id||Oc(`unnamed ${t.stage}-shader`)}const a_=class a_ extends Bi{get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){super(e,r,a_.defaultProps)}};U(a_,"defaultProps",{...Bi.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Em=a_;const l_=class l_ extends Bi{constructor(r,i={}){super(r,i,l_.defaultProps);U(this,"width");U(this,"height");U(this,"colorAttachments",[]);U(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(r){let i=!r;if(r){const[n,o]=Array.isArray(r)?r:[r.width,r.height];i=i||o!==this.height||n!==this.width,this.width=n,this.height=o}i&&(Et.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(i=>{if(typeof i=="string"){const n=this.createColorTexture(i);return this.attachResource(n),n.view}return i instanceof Zo?i.view:i});const r=this.props.depthStencilAttachment;if(r)if(typeof r=="string"){const i=this.createDepthStencilTexture(r);this.attachResource(i),this.depthStencilAttachment=i.view}else r instanceof Zo?this.depthStencilAttachment=r.view:this.depthStencilAttachment=r}createColorTexture(r){return this.device.createTexture({id:"color-attachment",usage:Zo.RENDER_ATTACHMENT,format:r,width:this.width,height:this.height})}createDepthStencilTexture(r){return this.device.createTexture({id:"depth-stencil-attachment",usage:Zo.RENDER_ATTACHMENT,format:r,width:this.width,height:this.height})}resizeAttachments(r,i){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const o=this.device._createTexture({...this.colorAttachments[n].props,width:r,height:i});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=o.view,this.attachResource(o.view)}if(this.depthStencilAttachment){const n=this.device._createTexture({...this.depthStencilAttachment.props,width:r,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}}};U(l_,"defaultProps",{...Bi.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Sm=l_;const c_=class c_ extends Bi{constructor(r,i){super(r,i,c_.defaultProps);U(this,"shaderLayout");U(this,"bufferLayout");U(this,"linkStatus","pending");U(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(r){throw new Error("Use uniform blocks")}};U(c_,"defaultProps",{...Bi.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Xd=c_;const u_=class u_ extends Bi{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){super(e,r,u_.defaultProps)}};U(u_,"defaultProps",{...Bi.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let O1=u_;const h_=class h_ extends Bi{constructor(r,i){super(r,i,h_.defaultProps);U(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};U(h_,"defaultProps",{...Bi.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Cm=h_;const f_=class f_ extends Bi{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,f_.defaultProps)}};U(f_,"defaultProps",{...Bi.defaultProps,measureExecutionTime:void 0});let D1=f_;const d_=class d_ extends Bi{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,d_.defaultProps)}};U(d_,"defaultProps",{...Bi.defaultProps});let F1=d_;function jN(t){const[e,r]=GN[t],i=e==="i32"||e==="u32",n=e!=="u32",o=WN[e]*r,s=HN(e,r);return{dataType:e,components:r,defaultVertexFormat:s,byteLength:o,integer:i,signed:n}}function HN(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}const GN={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},WN={f32:4,f16:2,i32:4,u32:4};function BR(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,i]=t.split("x"),n=r,o=i?parseInt(i):1,s=PR(n),f={type:n,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return e&&(f.webglOnly=!0),f}function OR(t,e){const r={};for(const i of t.attributes)r[i.name]=qN(t,e,i.name);return r}function XN(t,e,r=16){const i=OR(t,e),n=new Array(r).fill(null);for(const o of Object.values(i))n[o.location]=o;return n}function qN(t,e,r){const i=$N(t,r),n=ZN(e,r);if(!i)return null;const o=jN(i.type),s=(n==null?void 0:n.vertexFormat)||o.defaultVertexFormat,f=BR(s);return{attributeName:(n==null?void 0:n.attributeName)||i.name,bufferName:(n==null?void 0:n.bufferName)||i.name,location:i.location,shaderType:i.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:f.type,bufferComponents:f.components,normalized:f.normalized,integer:o.integer,stepMode:(n==null?void 0:n.stepMode)||i.stepMode,byteOffset:(n==null?void 0:n.byteOffset)||0,byteStride:(n==null?void 0:n.byteStride)||0}}function $N(t,e){const r=t.attributes.find(i=>i.name===e);return r||Et.warn(`shader layout attribute "${e}" not present in shader`),r||null}function ZN(t,e){KN(t);let r=YN(t,e);return r||(r=JN(t,e),r)?r:(Et.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function KN(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Et.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function YN(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function JN(t,e){var r;for(const i of t){let n=i.byteStride;if(typeof i.byteStride!="number")for(const s of i.attributes||[]){const f=BR(s.format);n+=f.byteLength}const o=(r=i.attributes)==null?void 0:r.find(s=>s.attribute===e);if(o)return{attributeName:o.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:n}}return null}function QN(t,e){const r={...t,attributes:t.attributes.map(i=>({...i}))};for(const i of(e==null?void 0:e.attributes)||[]){const n=r.attributes.find(o=>o.name===i.name);n?(n.type=i.type||n.type,n.stepMode=i.stepMode||n.stepMode):Et.warn(`shader layout attribute ${i.name} not present in shader`)}return r}const A_=class A_ extends Bi{constructor(r,i){super(r,i,A_.defaultProps);U(this,"maxVertexAttributes");U(this,"attributeInfos");U(this,"indexBuffer",null);U(this,"attributes");this.maxVertexAttributes=r.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=XN(i.renderPipeline.shaderLayout,i.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(r,i){throw new Error("constant attributes not supported")}};U(A_,"defaultProps",{...Bi.defaultProps,renderPipeline:null});let L1=A_;const p_=class p_ extends Bi{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,p_.defaultProps)}};U(p_,"defaultProps",{...Bi.defaultProps,layout:void 0,buffers:{}});let k1=p_;const g_=class g_ extends Bi{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,g_.defaultProps)}};U(g_,"defaultProps",{...Bi.defaultProps,type:void 0,count:void 0});let N1=g_;const eU={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function tU(t){const e=eU[t];return _i(t),e}function rU(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let rg;function DR(t){return(!rg||rg.byteLength<t)&&(rg=new ArrayBuffer(t)),rg}function iU(t,e){const r=DR(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function nU(t){const{target:e,source:r,start:i=0,count:n=1}=t,o=r.length,s=n*o;let f=0;for(let A=i;f<o;f++)e[A++]=r[f];for(;f<s;)f<s-f?(e.copyWithin(i+f,i,i+f),f*=2):(e.copyWithin(i+f,i,i+s-f),f=s);return t.target}const $E=1024;class sU{constructor(e){U(this,"layout",{});U(this,"byteLength");let r=0;for(const[n,o]of Object.entries(e)){const s=tU(o),{type:f,components:A}=s;r=rU(r,A);const v=r;r+=A,this.layout[n]={type:f,size:A,offset:v}}r+=(4-r%4)%4;const i=r*4;this.byteLength=Math.max(i,$E)}getData(e){const r=Math.max(this.byteLength,$E),i=DR(r),n={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[o,s]of Object.entries(e)){const f=this.layout[o];if(!f){Et.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}const{type:A,size:v,offset:w}=f,C=n[A];if(v===1){if(typeof s!="number"&&typeof s!="boolean"){Et.warn(`Supplied value for single component uniform ${o} is not a number: ${s}`)();continue}C[w]=Number(s)}else{const I=kp(s);if(!I){Et.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${s}`)();continue}C.set(I,w)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function oU(t,e,r=16){if(t!==e)return!1;const i=kp(t);if(!i)return!1;const n=kp(e);if(n&&i.length===n.length){for(let o=0;o<i.length;++o)if(n[o]!==i[o])return!1}return!0}function aU(t){const e=kp(t);return e?e.slice():t}class lU{constructor(e){U(this,"name");U(this,"uniforms",{});U(this,"modifiedUniforms",{});U(this,"modified",!0);U(this,"bindingLayout",{});U(this,"needsRedraw","initialized");var r;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const i=(r=e==null?void 0:e.shaderLayout.bindings)==null?void 0:r.find(o=>o.type==="uniform"&&o.name===(e==null?void 0:e.name));if(!i)throw new Error(e==null?void 0:e.name);const n=i;for(const o of n.uniforms||[])this.bindingLayout[o.name]=o}}setUniforms(e){for(const[r,i]of Object.entries(e))this._setUniform(r,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){oU(this.uniforms[e],r)||(this.uniforms[e]=aU(r),this.modifiedUniforms[e]=!0,this.modified=!0)}}class cU{constructor(e){U(this,"uniformBlocks",new Map);U(this,"uniformBufferLayouts",new Map);U(this,"uniformBuffers",new Map);for(const[r,i]of Object.entries(e)){const n=r,o=new sU(i.uniformTypes||{});this.uniformBufferLayouts.set(n,o);const s=new lU({name:r});s.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(n,s)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[r,i]of Object.entries(e))this.uniformBlocks.get(r).setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const r=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(r)}createUniformBuffer(e,r,i){i&&this.setUniforms(i);const n=this.getUniformBufferByteLength(r),o=e.createBuffer({usage:In.UNIFORM|In.COPY_DST,byteLength:n}),s=this.getUniformBufferData(r);return o.write(s),o}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){const i=this.getUniformBufferByteLength(r),n=e.createBuffer({usage:In.UNIFORM|In.COPY_DST,byteLength:i});this.uniformBuffers.set(r,n)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(const r of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(r);e||(e=i)}return e&&Et.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const r=this.uniformBlocks.get(e),i=this.uniformBuffers.get(e);let n=!1;if(i&&r.needsRedraw){n||(n=r.needsRedraw);const o=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(o);const f=this.uniformBlocks.get(e).getAllUniforms();Et.log(4,`Writing to uniform buffer ${String(e)}`,o,f)()}return n}}function FR(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function LR(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function uU(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let n=FR(t);if(n==="uint8"&&r&&i===1)return"unorm8-webgl";if(n==="uint8"&&r&&i===3)return"unorm8x3-webgl";if(n==="uint8"||n==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}if(n==="uint16"||n==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}return i===1?n:`${n}x${i}`}function hU(t){return kp(t)!==null||typeof t=="number"||typeof t=="boolean"}function w2(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const i=t[r];hU(i)?e.uniforms[r]=i:e.bindings[r]=i}),e}function fU(t,e,r){const{removedProps:i={},deprecatedProps:n={},replacedProps:o={}}=r;for(const f in i)if(f in e){const v=i[f]?`${t}.${i[f]}`:"N/A";Et.removed(`${t}.${f}`,v)()}for(const f in n)if(f in e){const A=n[f];Et.deprecated(`${t}.${f}`,`${t}.${A}`)()}let s=null;for(const[f,A]of Object.entries(o))f in e&&(Et.deprecated(`${t}.${f}`,`${t}.${A}`)(),s=s||Object.assign({},e),s[A]=e[f],delete s[f]);return s||e}let dU="";async function AU(t,e){return await new Promise((r,i)=>{try{const n=new Image;n.onload=()=>r(n),n.onerror=()=>i(new Error(`Could not load image ${t}.`)),n.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",n.src=t.startsWith("http")?t:dU+t}catch(n){i(n)}})}async function kR(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),new Promise((n,o)=>{i.onload=n,i.onerror=s=>o(new Error(`Unable to load script '${t}': ${s}`)),r.appendChild(i)})}function U1(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!U1(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const o of i)if(!e.hasOwnProperty(o)||!U1(t[o],e[o],r-1))return!1;return!0}return!1}function pU(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function gU(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class mU{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let Dc=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,r){if(e){r(Pm.instance);for(const i of e)i instanceof Array?this.searchBlock(i,r):i.search(r);r(Im.instance)}}};class Pm extends Dc{}Pm.instance=new Pm;class Im extends Dc{}Im.instance=new Im;class on extends Dc{constructor(){super()}}let z1=class extends on{constructor(e,r,i,n,o,s){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=i,this.body=n,this.startLine=o,this.endLine=s}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}};class _U extends on{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class yU extends on{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class vU extends on{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class bU extends on{constructor(e,r,i,n){super(),this.init=e,this.condition=r,this.increment=i,this.body=n}get astNodeType(){return"for"}search(e){var r,i,n;(r=this.init)===null||r===void 0||r.search(e),(i=this.condition)===null||i===void 0||i.search(e),(n=this.increment)===null||n===void 0||n.search(e),this.searchBlock(this.body,e)}}class wh extends on{constructor(e,r,i,n,o){super(),this.name=e,this.type=r,this.storage=i,this.access=n,this.value=o}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class NR extends on{constructor(e,r,i){super(),this.name=e,this.type=r,this.value=i}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class V1 extends on{constructor(e,r,i,n,o){super(),this.name=e,this.type=r,this.storage=i,this.access=n,this.value=o}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class ZE extends on{constructor(e,r,i,n,o){super(),this.name=e,this.type=r,this.storage=i,this.access=n,this.value=o}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}var qd;(function(t){t.increment="++",t.decrement="--"})(qd||(qd={}));(function(t){function e(r){const i=r;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return t[i]}t.parse=e})(qd||(qd={}));class xU extends on{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var Np;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Np||(Np={}));(function(t){function e(r){const i=r;if(i=="parse")throw new Error("Invalid value for AssignOperator");return i}t.parse=e})(Np||(Np={}));class wU extends on{constructor(e,r,i){super(),this.operator=e,this.variable=r,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class UR extends on{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}search(e){for(const r of this.args)r.search(e);e(this)}}class TU extends on{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}}class EU extends on{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"body"}}class SU extends on{constructor(e,r,i,n){super(),this.condition=e,this.body=r,this.elseif=i,this.else=n}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class CU extends on{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class PU extends on{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class IU extends on{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class MU extends on{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class zR extends on{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class RU extends on{constructor(){super()}get astNodeType(){return"discard"}}class BU extends on{constructor(){super()}get astNodeType(){return"break"}}class OU extends on{constructor(){super()}get astNodeType(){return"continue"}}class Wh extends on{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class xh extends Wh{constructor(e,r,i,n){super(e),this.members=r,this.startLine=i,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}}class VR extends Wh{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"template"}}class DU extends Wh{constructor(e,r,i,n){super(e),this.storage=r,this.type=i,this.access=n}get astNodeType(){return"pointer"}}class jR extends Wh{constructor(e,r,i,n){super(e),this.attributes=r,this.format=i,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}}class hp extends Wh{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"sampler"}}class nl extends Dc{constructor(){super()}}class KE extends nl{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class _d extends nl{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){e(this);for(const r of this.args)r.search(e)}}class HR extends nl{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const r of this.args)r.search(e);e(this)}}class j1 extends nl{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const r=e.constants.get(this.name);if(!r)throw new Error("Cannot evaluate node");return r.evaluate(e)}}class YE extends nl{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(e){var r,i;if(this.initializer instanceof _d){const n=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(e),o=(i=this.initializer.type)===null||i===void 0?void 0:i.name,s=e.structs.get(o),f=s==null?void 0:s.getMemberIndex(n);if(f!=-1)return this.initializer.args[f].evaluate(e);console.log(f)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class JE extends nl{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class FU extends nl{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class LU extends nl{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class QE extends nl{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class kU extends nl{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class GR extends nl{constructor(){super()}}class NU extends GR{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Ml extends GR{constructor(e,r,i){super(),this.operator=e,this.left=r,this.right=i}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class WR extends Dc{constructor(){super()}}class UU extends WR{constructor(e,r){super(),this.selector=e,this.body=r}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class zU extends WR{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class VU extends Dc{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"argument"}}class jU extends Dc{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class HU extends Dc{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"member"}}let GU=class extends Dc{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}};var Je,je;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(je||(je={}));class He{constructor(e,r,i){this.name=e,this.type=r,this.rule=i}toString(){return this.name}}class ye{}Je=ye;ye.none=new He("",je.reserved,"");ye.eof=new He("EOF",je.token,"");ye.reserved={asm:new He("asm",je.reserved,"asm"),bf16:new He("bf16",je.reserved,"bf16"),do:new He("do",je.reserved,"do"),enum:new He("enum",je.reserved,"enum"),f16:new He("f16",je.reserved,"f16"),f64:new He("f64",je.reserved,"f64"),handle:new He("handle",je.reserved,"handle"),i8:new He("i8",je.reserved,"i8"),i16:new He("i16",je.reserved,"i16"),i64:new He("i64",je.reserved,"i64"),mat:new He("mat",je.reserved,"mat"),premerge:new He("premerge",je.reserved,"premerge"),regardless:new He("regardless",je.reserved,"regardless"),typedef:new He("typedef",je.reserved,"typedef"),u8:new He("u8",je.reserved,"u8"),u16:new He("u16",je.reserved,"u16"),u64:new He("u64",je.reserved,"u64"),unless:new He("unless",je.reserved,"unless"),using:new He("using",je.reserved,"using"),vec:new He("vec",je.reserved,"vec"),void:new He("void",je.reserved,"void")};ye.keywords={array:new He("array",je.keyword,"array"),atomic:new He("atomic",je.keyword,"atomic"),bool:new He("bool",je.keyword,"bool"),f32:new He("f32",je.keyword,"f32"),i32:new He("i32",je.keyword,"i32"),mat2x2:new He("mat2x2",je.keyword,"mat2x2"),mat2x3:new He("mat2x3",je.keyword,"mat2x3"),mat2x4:new He("mat2x4",je.keyword,"mat2x4"),mat3x2:new He("mat3x2",je.keyword,"mat3x2"),mat3x3:new He("mat3x3",je.keyword,"mat3x3"),mat3x4:new He("mat3x4",je.keyword,"mat3x4"),mat4x2:new He("mat4x2",je.keyword,"mat4x2"),mat4x3:new He("mat4x3",je.keyword,"mat4x3"),mat4x4:new He("mat4x4",je.keyword,"mat4x4"),ptr:new He("ptr",je.keyword,"ptr"),sampler:new He("sampler",je.keyword,"sampler"),sampler_comparison:new He("sampler_comparison",je.keyword,"sampler_comparison"),struct:new He("struct",je.keyword,"struct"),texture_1d:new He("texture_1d",je.keyword,"texture_1d"),texture_2d:new He("texture_2d",je.keyword,"texture_2d"),texture_2d_array:new He("texture_2d_array",je.keyword,"texture_2d_array"),texture_3d:new He("texture_3d",je.keyword,"texture_3d"),texture_cube:new He("texture_cube",je.keyword,"texture_cube"),texture_cube_array:new He("texture_cube_array",je.keyword,"texture_cube_array"),texture_multisampled_2d:new He("texture_multisampled_2d",je.keyword,"texture_multisampled_2d"),texture_storage_1d:new He("texture_storage_1d",je.keyword,"texture_storage_1d"),texture_storage_2d:new He("texture_storage_2d",je.keyword,"texture_storage_2d"),texture_storage_2d_array:new He("texture_storage_2d_array",je.keyword,"texture_storage_2d_array"),texture_storage_3d:new He("texture_storage_3d",je.keyword,"texture_storage_3d"),texture_depth_2d:new He("texture_depth_2d",je.keyword,"texture_depth_2d"),texture_depth_2d_array:new He("texture_depth_2d_array",je.keyword,"texture_depth_2d_array"),texture_depth_cube:new He("texture_depth_cube",je.keyword,"texture_depth_cube"),texture_depth_cube_array:new He("texture_depth_cube_array",je.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new He("texture_depth_multisampled_2d",je.keyword,"texture_depth_multisampled_2d"),texture_external:new He("texture_external",je.keyword,"texture_external"),u32:new He("u32",je.keyword,"u32"),vec2:new He("vec2",je.keyword,"vec2"),vec3:new He("vec3",je.keyword,"vec3"),vec4:new He("vec4",je.keyword,"vec4"),bitcast:new He("bitcast",je.keyword,"bitcast"),block:new He("block",je.keyword,"block"),break:new He("break",je.keyword,"break"),case:new He("case",je.keyword,"case"),continue:new He("continue",je.keyword,"continue"),continuing:new He("continuing",je.keyword,"continuing"),default:new He("default",je.keyword,"default"),diagnostic:new He("diagnostic",je.keyword,"diagnostic"),discard:new He("discard",je.keyword,"discard"),else:new He("else",je.keyword,"else"),enable:new He("enable",je.keyword,"enable"),fallthrough:new He("fallthrough",je.keyword,"fallthrough"),false:new He("false",je.keyword,"false"),fn:new He("fn",je.keyword,"fn"),for:new He("for",je.keyword,"for"),function:new He("function",je.keyword,"function"),if:new He("if",je.keyword,"if"),let:new He("let",je.keyword,"let"),const:new He("const",je.keyword,"const"),loop:new He("loop",je.keyword,"loop"),while:new He("while",je.keyword,"while"),private:new He("private",je.keyword,"private"),read:new He("read",je.keyword,"read"),read_write:new He("read_write",je.keyword,"read_write"),return:new He("return",je.keyword,"return"),requires:new He("requires",je.keyword,"requires"),storage:new He("storage",je.keyword,"storage"),switch:new He("switch",je.keyword,"switch"),true:new He("true",je.keyword,"true"),alias:new He("alias",je.keyword,"alias"),type:new He("type",je.keyword,"type"),uniform:new He("uniform",je.keyword,"uniform"),var:new He("var",je.keyword,"var"),override:new He("override",je.keyword,"override"),workgroup:new He("workgroup",je.keyword,"workgroup"),write:new He("write",je.keyword,"write"),r8unorm:new He("r8unorm",je.keyword,"r8unorm"),r8snorm:new He("r8snorm",je.keyword,"r8snorm"),r8uint:new He("r8uint",je.keyword,"r8uint"),r8sint:new He("r8sint",je.keyword,"r8sint"),r16uint:new He("r16uint",je.keyword,"r16uint"),r16sint:new He("r16sint",je.keyword,"r16sint"),r16float:new He("r16float",je.keyword,"r16float"),rg8unorm:new He("rg8unorm",je.keyword,"rg8unorm"),rg8snorm:new He("rg8snorm",je.keyword,"rg8snorm"),rg8uint:new He("rg8uint",je.keyword,"rg8uint"),rg8sint:new He("rg8sint",je.keyword,"rg8sint"),r32uint:new He("r32uint",je.keyword,"r32uint"),r32sint:new He("r32sint",je.keyword,"r32sint"),r32float:new He("r32float",je.keyword,"r32float"),rg16uint:new He("rg16uint",je.keyword,"rg16uint"),rg16sint:new He("rg16sint",je.keyword,"rg16sint"),rg16float:new He("rg16float",je.keyword,"rg16float"),rgba8unorm:new He("rgba8unorm",je.keyword,"rgba8unorm"),rgba8unorm_srgb:new He("rgba8unorm_srgb",je.keyword,"rgba8unorm_srgb"),rgba8snorm:new He("rgba8snorm",je.keyword,"rgba8snorm"),rgba8uint:new He("rgba8uint",je.keyword,"rgba8uint"),rgba8sint:new He("rgba8sint",je.keyword,"rgba8sint"),bgra8unorm:new He("bgra8unorm",je.keyword,"bgra8unorm"),bgra8unorm_srgb:new He("bgra8unorm_srgb",je.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new He("rgb10a2unorm",je.keyword,"rgb10a2unorm"),rg11b10float:new He("rg11b10float",je.keyword,"rg11b10float"),rg32uint:new He("rg32uint",je.keyword,"rg32uint"),rg32sint:new He("rg32sint",je.keyword,"rg32sint"),rg32float:new He("rg32float",je.keyword,"rg32float"),rgba16uint:new He("rgba16uint",je.keyword,"rgba16uint"),rgba16sint:new He("rgba16sint",je.keyword,"rgba16sint"),rgba16float:new He("rgba16float",je.keyword,"rgba16float"),rgba32uint:new He("rgba32uint",je.keyword,"rgba32uint"),rgba32sint:new He("rgba32sint",je.keyword,"rgba32sint"),rgba32float:new He("rgba32float",je.keyword,"rgba32float"),static_assert:new He("static_assert",je.keyword,"static_assert")};ye.tokens={decimal_float_literal:new He("decimal_float_literal",je.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new He("hex_float_literal",je.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new He("int_literal",je.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new He("uint_literal",je.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new He("ident",je.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new He("and",je.token,"&"),and_and:new He("and_and",je.token,"&&"),arrow:new He("arrow ",je.token,"->"),attr:new He("attr",je.token,"@"),forward_slash:new He("forward_slash",je.token,"/"),bang:new He("bang",je.token,"!"),bracket_left:new He("bracket_left",je.token,"["),bracket_right:new He("bracket_right",je.token,"]"),brace_left:new He("brace_left",je.token,"{"),brace_right:new He("brace_right",je.token,"}"),colon:new He("colon",je.token,":"),comma:new He("comma",je.token,","),equal:new He("equal",je.token,"="),equal_equal:new He("equal_equal",je.token,"=="),not_equal:new He("not_equal",je.token,"!="),greater_than:new He("greater_than",je.token,">"),greater_than_equal:new He("greater_than_equal",je.token,">="),shift_right:new He("shift_right",je.token,">>"),less_than:new He("less_than",je.token,"<"),less_than_equal:new He("less_than_equal",je.token,"<="),shift_left:new He("shift_left",je.token,"<<"),modulo:new He("modulo",je.token,"%"),minus:new He("minus",je.token,"-"),minus_minus:new He("minus_minus",je.token,"--"),period:new He("period",je.token,"."),plus:new He("plus",je.token,"+"),plus_plus:new He("plus_plus",je.token,"++"),or:new He("or",je.token,"|"),or_or:new He("or_or",je.token,"||"),paren_left:new He("paren_left",je.token,"("),paren_right:new He("paren_right",je.token,")"),semicolon:new He("semicolon",je.token,";"),star:new He("star",je.token,"*"),tilde:new He("tilde",je.token,"~"),underscore:new He("underscore",je.token,"_"),xor:new He("xor",je.token,"^"),plus_equal:new He("plus_equal",je.token,"+="),minus_equal:new He("minus_equal",je.token,"-="),times_equal:new He("times_equal",je.token,"*="),division_equal:new He("division_equal",je.token,"/="),modulo_equal:new He("modulo_equal",je.token,"%="),and_equal:new He("and_equal",je.token,"&="),or_equal:new He("or_equal",je.token,"|="),xor_equal:new He("xor_equal",je.token,"^="),shift_right_equal:new He("shift_right_equal",je.token,">>="),shift_left_equal:new He("shift_left_equal",je.token,"<<=")};ye.simpleTokens={"@":Je.tokens.attr,"{":Je.tokens.brace_left,"}":Je.tokens.brace_right,":":Je.tokens.colon,",":Je.tokens.comma,"(":Je.tokens.paren_left,")":Je.tokens.paren_right,";":Je.tokens.semicolon};ye.literalTokens={"&":Je.tokens.and,"&&":Je.tokens.and_and,"->":Je.tokens.arrow,"/":Je.tokens.forward_slash,"!":Je.tokens.bang,"[":Je.tokens.bracket_left,"]":Je.tokens.bracket_right,"=":Je.tokens.equal,"==":Je.tokens.equal_equal,"!=":Je.tokens.not_equal,">":Je.tokens.greater_than,">=":Je.tokens.greater_than_equal,">>":Je.tokens.shift_right,"<":Je.tokens.less_than,"<=":Je.tokens.less_than_equal,"<<":Je.tokens.shift_left,"%":Je.tokens.modulo,"-":Je.tokens.minus,"--":Je.tokens.minus_minus,".":Je.tokens.period,"+":Je.tokens.plus,"++":Je.tokens.plus_plus,"|":Je.tokens.or,"||":Je.tokens.or_or,"*":Je.tokens.star,"~":Je.tokens.tilde,_:Je.tokens.underscore,"^":Je.tokens.xor,"+=":Je.tokens.plus_equal,"-=":Je.tokens.minus_equal,"*=":Je.tokens.times_equal,"/=":Je.tokens.division_equal,"%=":Je.tokens.modulo_equal,"&=":Je.tokens.and_equal,"|=":Je.tokens.or_equal,"^=":Je.tokens.xor_equal,">>=":Je.tokens.shift_right_equal,"<<=":Je.tokens.shift_left_equal};ye.regexTokens={decimal_float_literal:Je.tokens.decimal_float_literal,hex_float_literal:Je.tokens.hex_float_literal,int_literal:Je.tokens.int_literal,uint_literal:Je.tokens.uint_literal,ident:Je.tokens.ident};ye.storage_class=[Je.keywords.function,Je.keywords.private,Je.keywords.workgroup,Je.keywords.uniform,Je.keywords.storage];ye.access_mode=[Je.keywords.read,Je.keywords.write,Je.keywords.read_write];ye.sampler_type=[Je.keywords.sampler,Je.keywords.sampler_comparison];ye.sampled_texture_type=[Je.keywords.texture_1d,Je.keywords.texture_2d,Je.keywords.texture_2d_array,Je.keywords.texture_3d,Je.keywords.texture_cube,Je.keywords.texture_cube_array];ye.multisampled_texture_type=[Je.keywords.texture_multisampled_2d];ye.storage_texture_type=[Je.keywords.texture_storage_1d,Je.keywords.texture_storage_2d,Je.keywords.texture_storage_2d_array,Je.keywords.texture_storage_3d];ye.depth_texture_type=[Je.keywords.texture_depth_2d,Je.keywords.texture_depth_2d_array,Je.keywords.texture_depth_cube,Je.keywords.texture_depth_cube_array,Je.keywords.texture_depth_multisampled_2d];ye.texture_external_type=[Je.keywords.texture_external];ye.any_texture_type=[...Je.sampled_texture_type,...Je.multisampled_texture_type,...Je.storage_texture_type,...Je.depth_texture_type,...Je.texture_external_type];ye.texel_format=[Je.keywords.r8unorm,Je.keywords.r8snorm,Je.keywords.r8uint,Je.keywords.r8sint,Je.keywords.r16uint,Je.keywords.r16sint,Je.keywords.r16float,Je.keywords.rg8unorm,Je.keywords.rg8snorm,Je.keywords.rg8uint,Je.keywords.rg8sint,Je.keywords.r32uint,Je.keywords.r32sint,Je.keywords.r32float,Je.keywords.rg16uint,Je.keywords.rg16sint,Je.keywords.rg16float,Je.keywords.rgba8unorm,Je.keywords.rgba8unorm_srgb,Je.keywords.rgba8snorm,Je.keywords.rgba8uint,Je.keywords.rgba8sint,Je.keywords.bgra8unorm,Je.keywords.bgra8unorm_srgb,Je.keywords.rgb10a2unorm,Je.keywords.rg11b10float,Je.keywords.rg32uint,Je.keywords.rg32sint,Je.keywords.rg32float,Je.keywords.rgba16uint,Je.keywords.rgba16sint,Je.keywords.rgba16float,Je.keywords.rgba32uint,Je.keywords.rgba32sint,Je.keywords.rgba32float];ye.const_literal=[Je.tokens.int_literal,Je.tokens.uint_literal,Je.tokens.decimal_float_literal,Je.tokens.hex_float_literal,Je.keywords.true,Je.keywords.false];ye.literal_or_ident=[Je.tokens.ident,Je.tokens.int_literal,Je.tokens.uint_literal,Je.tokens.decimal_float_literal,Je.tokens.hex_float_literal];ye.element_count_expression=[Je.tokens.int_literal,Je.tokens.uint_literal,Je.tokens.ident];ye.template_types=[Je.keywords.vec2,Je.keywords.vec3,Je.keywords.vec4,Je.keywords.mat2x2,Je.keywords.mat2x3,Je.keywords.mat2x4,Je.keywords.mat3x2,Je.keywords.mat3x3,Je.keywords.mat3x4,Je.keywords.mat4x2,Je.keywords.mat4x3,Je.keywords.mat4x4,Je.keywords.atomic,Je.keywords.bitcast,...Je.any_texture_type];ye.attribute_name=[Je.tokens.ident,Je.keywords.block,Je.keywords.diagnostic];ye.assignment_operators=[Je.tokens.equal,Je.tokens.plus_equal,Je.tokens.minus_equal,Je.tokens.times_equal,Je.tokens.division_equal,Je.tokens.modulo_equal,Je.tokens.and_equal,Je.tokens.or_equal,Je.tokens.xor_equal,Je.tokens.shift_right_equal,Je.tokens.shift_left_equal];ye.increment_operators=[Je.tokens.plus_plus,Je.tokens.minus_minus];class eS{constructor(e,r,i){this.type=e,this.lexeme=r,this.line=i}toString(){return this.lexeme}isTemplateType(){return ye.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ye.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class WU{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new eS(ye.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}const r=ye.simpleTokens[e];if(r)return this._addToken(r),!0;let i=ye.none;const n=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)e+=this._advance(),s=this._peekAhead()}if(n){const s=ye.keywords[e];if(s)return this._addToken(s),!0}if(n||o)return this._addToken(ye.tokens.ident),!0;for(;;){let s=this._findType(e);const f=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(f=="=")return this._current++,e+=f,this._addToken(ye.tokens.minus_equal),!0;if(f=="-")return this._current++,e+=f,this._addToken(ye.tokens.minus_minus),!0;const A=this._tokens.length-1;if((ye.literal_or_ident.indexOf(this._tokens[A].type)!=-1||this._tokens[A].type==ye.tokens.paren_right)&&f!=">")return this._addToken(s),!0}if(e==">"&&(f==">"||f=="=")){let A=!1,v=this._tokens.length-1;for(let w=0;w<5&&v>=0&&ye.assignment_operators.indexOf(this._tokens[v].type)===-1;++w,--v)if(this._tokens[v].type===ye.tokens.less_than){v>0&&this._tokens[v-1].isArrayOrTemplateType()&&(A=!0);break}if(A)return this._addToken(s),!0}if(s===ye.none){let A=e,v=0;const w=2;for(let C=0;C<w;++C)if(A+=this._peekAhead(C),s=this._findType(A),s!==ye.none){v=C;break}if(s===ye.none)return i===ye.none?!1:(this._current--,this._addToken(i),!0);e=A,this._current+=v+1}if(i=s,this._isAtEnd())break;e+=this._advance()}return i===ye.none?!1:(this._addToken(i),!0)}_findType(e){for(const i in ye.regexTokens){const n=ye.regexTokens[i];if(this._match(e,n.rule))return n}const r=ye.literalTokens[e];return r||ye.none}_match(e,r){const i=r.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new eS(e,r,this._line))}}class XU{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new mU,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;r.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const n=i.arrayType,o=i.countNode;if(o instanceof j1){const f=o.name,A=this._context.constants.get(f);if(A)try{const v=A.evaluate(this._context);n.count=v}catch{}}}this._deferArrayCountEval.length=0}return r}_initialize(e){if(e)if(typeof e=="string"){const r=new WU(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,r){return{token:e,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ye.eof}_match(e){if(e instanceof He)return this._check(e)?(this._advance(),!0):!1;for(let r=0,i=e.length;r<i;++r){const n=e[r];if(this._check(n))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),r)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const i=r.type;return e.indexOf(i)!=-1}return r.type==e}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ye.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ye.keywords.alias)){const r=this._type_alias();return this._consume(ye.tokens.semicolon,"Expected ';'"),r}if(this._match(ye.keywords.diagnostic)){const r=this._diagnostic();return this._consume(ye.tokens.semicolon,"Expected ';'"),r}if(this._match(ye.keywords.requires)){const r=this._requires_directive();return this._consume(ye.tokens.semicolon,"Expected ';'"),r}if(this._match(ye.keywords.enable)){const r=this._enable_directive();return this._consume(ye.tokens.semicolon,"Expected ';'"),r}const e=this._attribute();if(this._check(ye.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),r}if(this._check(ye.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),r}if(this._check(ye.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),r}if(this._check(ye.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),r}if(this._check(ye.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),r}if(this._check(ye.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),r}return null}_function_decl(){if(!this._match(ye.keywords.fn))return null;const e=this._currentLine,r=this._consume(ye.tokens.ident,"Expected function name.").toString();this._consume(ye.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(ye.tokens.paren_right))do{if(this._check(ye.tokens.paren_right))break;const f=this._attribute(),A=this._consume(ye.tokens.ident,"Expected argument name.").toString();this._consume(ye.tokens.colon,"Expected ':' for argument type.");const v=this._attribute(),w=this._type_decl();w!=null&&(w.attributes=v,i.push(new VU(A,w,f)))}while(this._match(ye.tokens.comma));this._consume(ye.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(ye.tokens.arrow)){const f=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=f)}const o=this._compound_statement(),s=this._currentLine;return new z1(r,i,n,o,e,s)}_compound_statement(){const e=[];for(this._consume(ye.tokens.brace_left,"Expected '{' for block.");!this._check(ye.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(ye.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ye.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ye.tokens.attr)&&this._attribute(),this._check(ye.keywords.if))return this._if_statement();if(this._check(ye.keywords.switch))return this._switch_statement();if(this._check(ye.keywords.loop))return this._loop_statement();if(this._check(ye.keywords.for))return this._for_statement();if(this._check(ye.keywords.while))return this._while_statement();if(this._check(ye.keywords.continuing))return this._continuing_statement();if(this._check(ye.keywords.static_assert))return this._static_assert_statement();if(this._check(ye.tokens.brace_left))return this._compound_statement();let e=null;return this._check(ye.keywords.return)?e=this._return_statement():this._check([ye.keywords.var,ye.keywords.let,ye.keywords.const])?e=this._variable_statement():this._match(ye.keywords.discard)?e=new RU:this._match(ye.keywords.break)?e=new BU:this._match(ye.keywords.continue)?e=new OU:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(ye.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ye.keywords.static_assert))return null;const e=this._optional_paren_expression();return new _U(e)}_while_statement(){if(!this._match(ye.keywords.while))return null;const e=this._optional_paren_expression();this._check(ye.tokens.attr)&&this._attribute();const r=this._compound_statement();return new yU(e,r)}_continuing_statement(){if(!this._match(ye.keywords.continuing))return null;const e=this._compound_statement();return new vU(e)}_for_statement(){if(!this._match(ye.keywords.for))return null;this._consume(ye.tokens.paren_left,"Expected '('.");const e=this._check(ye.tokens.semicolon)?null:this._for_init();this._consume(ye.tokens.semicolon,"Expected ';'.");const r=this._check(ye.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(ye.tokens.semicolon,"Expected ';'.");const i=this._check(ye.tokens.paren_right)?null:this._for_increment();this._consume(ye.tokens.paren_right,"Expected ')'."),this._check(ye.tokens.attr)&&this._attribute();const n=this._compound_statement();return new bU(e,r,i,n)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ye.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(ye.tokens.equal)&&(r=this._short_circuit_or_expression()),new wh(e.name,e.type,e.storage,e.access,r)}if(this._match(ye.keywords.let)){const e=this._consume(ye.tokens.ident,"Expected name for let.").toString();let r=null;if(this._match(ye.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}this._consume(ye.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return new V1(e,r,null,null,i)}if(this._match(ye.keywords.const)){const e=this._consume(ye.tokens.ident,"Expected name for const.").toString();let r=null;if(this._match(ye.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}this._consume(ye.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return new ZE(e,r,null,null,i)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(ye.increment_operators))return this._current=e,null;const i=this._consume(ye.increment_operators,"Expected increment operator");return new xU(i.type===ye.tokens.plus_plus?qd.increment:qd.decrement,r)}_assignment_statement(){let e=null;if(this._check(ye.tokens.brace_right))return null;let r=this._match(ye.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(ye.assignment_operators,"Expected assignment operator."),n=this._short_circuit_or_expression();return new wU(Np.parse(i.lexeme),e,n)}_func_call_statement(){if(!this._check(ye.tokens.ident))return null;const e=this._current,r=this._consume(ye.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=e,null):new UR(r.lexeme,i)}_loop_statement(){if(!this._match(ye.keywords.loop))return null;this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Expected '{' for loop.");const e=[];let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)e.push(n);else e.push(r);r=this._statement()}let i=null;return this._match(ye.keywords.continuing)&&(i=this._compound_statement()),this._consume(ye.tokens.brace_right,"Expected '}' for loop."),new TU(e,i)}_switch_statement(){if(!this._match(ye.keywords.switch))return null;const e=this._optional_paren_expression();this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Expected '{' for switch.");const r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ye.tokens.brace_right,"Expected '}' for switch."),new EU(e,r)}_switch_body(){const e=[];if(this._match(ye.keywords.case)){const r=this._case_selectors();this._match(ye.tokens.colon),this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(ye.tokens.brace_right,"Exected '}' for switch case."),e.push(new UU(r,i))}if(this._match(ye.keywords.default)){this._match(ye.tokens.colon),this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(ye.tokens.brace_right,"Exected '}' for switch default."),e.push(new zU(r))}if(this._check([ye.keywords.default,ye.keywords.case])){const r=this._switch_body();e.push(r[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(ye.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(ye.keywords.fallthrough))return this._consume(ye.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(ye.keywords.if))return null;const e=this._optional_paren_expression();this._check(ye.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(ye.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let n=null;return this._match(ye.keywords.else)&&(this._check(ye.tokens.attr)&&this._attribute(),n=this._compound_statement()),new SU(e,r,i,n)}_match_elseif(){return this._tokens[this._current].type===ye.keywords.else&&this._tokens[this._current+1].type===ye.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const r=this._optional_paren_expression(),i=this._compound_statement();return e.push(new jU(r,i)),this._match_elseif()&&(this._check(ye.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ye.keywords.return))return null;const e=this._short_circuit_or_expression();return new CU(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ye.tokens.or_or);)e=new Ml(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ye.tokens.and_and);)e=new Ml(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ye.tokens.or);)e=new Ml(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ye.tokens.xor);)e=new Ml(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(ye.tokens.and);)e=new Ml(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([ye.tokens.equal_equal,ye.tokens.not_equal])?new Ml(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ye.tokens.less_than,ye.tokens.greater_than,ye.tokens.less_than_equal,ye.tokens.greater_than_equal]);)e=new Ml(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ye.tokens.shift_left,ye.tokens.shift_right]);)e=new Ml(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ye.tokens.plus,ye.tokens.minus]);)e=new Ml(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ye.tokens.star,ye.tokens.forward_slash,ye.tokens.modulo]);)e=new Ml(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([ye.tokens.minus,ye.tokens.bang,ye.tokens.tilde,ye.tokens.star,ye.tokens.and])?new NU(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(ye.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ye.tokens.bracket_right,"Expected ']'.");const r=new kU(e),i=this._postfix_expression();return i&&(r.postfix=i),r}if(this._match(ye.tokens.period)){const e=this._consume(ye.tokens.ident,"Expected member name."),r=this._postfix_expression(),i=new KE(e.lexeme);return r&&(i.postfix=r),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(ye.tokens.ident)){const i=this._previous().toString();if(this._check(ye.tokens.paren_left)){const n=this._argument_expression_list(),o=this._getStruct(i);return o!=null?new _d(o,n):new HR(i,n)}if(this._context.constants.has(i)){const n=this._context.constants.get(i);return new YE(i,n.value)}return new j1(i)}if(this._match(ye.const_literal))return new JE(parseFloat(this._previous().toString()));if(this._check(ye.tokens.paren_left))return this._paren_expression();if(this._match(ye.keywords.bitcast)){this._consume(ye.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(ye.tokens.greater_than,"Expected '>'.");const n=this._paren_expression();return new FU(i,n)}const e=this._type_decl(),r=this._argument_expression_list();return new LU(e,r)}_argument_expression_list(){if(!this._match(ye.tokens.paren_left))return null;const e=[];do{if(this._check(ye.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(ye.tokens.comma));return this._consume(ye.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ye.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ye.tokens.paren_right),new QE([e])}_paren_expression(){this._consume(ye.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ye.tokens.paren_right,"Expected ')'."),new QE([e])}_struct_decl(){if(!this._match(ye.keywords.struct))return null;const e=this._currentLine,r=this._consume(ye.tokens.ident,"Expected name for struct.").toString();this._consume(ye.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(ye.tokens.brace_right);){const s=this._attribute(),f=this._consume(ye.tokens.ident,"Expected variable name.").toString();this._consume(ye.tokens.colon,"Expected ':' for struct member type.");const A=this._attribute(),v=this._type_decl();v!=null&&(v.attributes=A),this._check(ye.tokens.brace_right)?this._match(ye.tokens.comma):this._consume(ye.tokens.comma,"Expected ',' for struct member."),i.push(new HU(f,v,s))}this._consume(ye.tokens.brace_right,"Expected '}' after struct body.");const n=this._currentLine,o=new xh(r,i,e,n);return this._context.structs.set(r,o),o}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(ye.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ye.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(ye.keywords.const))return null;const e=this._consume(ye.tokens.ident,"Expected variable name");let r=null;if(this._match(ye.tokens.colon)){const o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}let i=null;if(this._match(ye.tokens.equal)){const o=this._short_circuit_or_expression();if(o instanceof _d)i=o;else if(o instanceof YE&&o.initializer instanceof _d)i=o.initializer;else try{const s=o.evaluate(this._context);i=new JE(s)}catch{i=o}}const n=new ZE(e.toString(),r,"","",i);return this._context.constants.set(n.name,n),n}_global_let_decl(){if(!this._match(ye.keywords.let))return null;const e=this._consume(ye.tokens.ident,"Expected variable name");let r=null;if(this._match(ye.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}let i=null;return this._match(ye.tokens.equal)&&(i=this._const_expression()),new V1(e.toString(),r,"","",i)}_const_expression(){if(this._match(ye.const_literal))return new KE(this._previous().toString());const e=this._type_decl();this._consume(ye.tokens.paren_left,"Expected '('.");let r=[];for(;!this._check(ye.tokens.paren_right)&&(r.push(this._const_expression()),!!this._check(ye.tokens.comma));)this._advance();return this._consume(ye.tokens.paren_right,"Expected ')'."),new _d(e,r)}_variable_decl(){if(!this._match(ye.keywords.var))return null;let e="",r="";this._match(ye.tokens.less_than)&&(e=this._consume(ye.storage_class,"Expected storage_class.").toString(),this._match(ye.tokens.comma)&&(r=this._consume(ye.access_mode,"Expected access_mode.").toString()),this._consume(ye.tokens.greater_than,"Expected '>'."));const i=this._consume(ye.tokens.ident,"Expected variable name");let n=null;if(this._match(ye.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}return new wh(i.toString(),n,e,r,null)}_override_decl(){if(!this._match(ye.keywords.override))return null;const e=this._consume(ye.tokens.ident,"Expected variable name");let r=null;if(this._match(ye.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}return new NR(e.toString(),r,null)}_diagnostic(){this._consume(ye.tokens.paren_left,"Expected '('");const e=this._consume(ye.tokens.ident,"Expected severity control name.");this._consume(ye.tokens.comma,"Expected ','");const r=this._consume(ye.tokens.ident,"Expected diagnostic rule name.");return this._consume(ye.tokens.paren_right,"Expected ')'"),new MU(e.toString(),r.toString())}_enable_directive(){const e=this._consume(ye.tokens.ident,"identity expected.");return new PU(e.toString())}_requires_directive(){const e=[this._consume(ye.tokens.ident,"identity expected.").toString()];for(;this._match(ye.tokens.comma);){const r=this._consume(ye.tokens.ident,"identity expected.");e.push(r.toString())}return new IU(e)}_type_alias(){const e=this._consume(ye.tokens.ident,"identity expected.");this._consume(ye.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const i=new zR(e.toString(),r);return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([ye.tokens.ident,...ye.texel_format,ye.keywords.bool,ye.keywords.f32,ye.keywords.i32,ye.keywords.u32])){const i=this._advance(),n=i.toString();return this._context.structs.has(n)?this._context.structs.get(n):this._context.aliases.has(n)?this._context.aliases.get(n).type:new Wh(i.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(ye.template_types)){let i=this._advance().toString(),n=null,o=null;return this._match(ye.tokens.less_than)&&(n=this._type_decl(),o=null,this._match(ye.tokens.comma)&&(o=this._consume(ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(ye.tokens.greater_than,"Expected '>' for type.")),new VR(i,n,o)}if(this._match(ye.keywords.ptr)){let i=this._previous().toString();this._consume(ye.tokens.less_than,"Expected '<' for pointer.");const n=this._consume(ye.storage_class,"Expected storage_class for pointer");this._consume(ye.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let s=null;return this._match(ye.tokens.comma)&&(s=this._consume(ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(ye.tokens.greater_than,"Expected '>' for pointer."),new DU(i,n.toString(),o,s)}const r=this._attribute();if(this._match(ye.keywords.array)){let i=null,n=-1;const o=this._previous();let s=null;if(this._match(ye.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let A="";if(this._match(ye.tokens.comma)){s=this._shift_expression();try{A=s.evaluate(this._context).toString(),s=null}catch{A="1"}}this._consume(ye.tokens.greater_than,"Expected '>' for array."),n=A?parseInt(A):0}const f=new jR(o.toString(),r,i,n);return s&&this._deferArrayCountEval.push({arrayType:f,countNode:s}),f}return null}_texture_sampler_types(){if(this._match(ye.sampler_type))return new hp(this._previous().toString(),null,null);if(this._match(ye.depth_texture_type))return new hp(this._previous().toString(),null,null);if(this._match(ye.sampled_texture_type)||this._match(ye.multisampled_texture_type)){const e=this._previous();this._consume(ye.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(ye.tokens.greater_than,"Expected '>' for sampler type."),new hp(e.toString(),r,null)}if(this._match(ye.storage_texture_type)){const e=this._previous();this._consume(ye.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(ye.texel_format,"Invalid texel format.").toString();this._consume(ye.tokens.comma,"Expected ',' after texel format.");const i=this._consume(ye.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ye.tokens.greater_than,"Expected '>' for sampler type."),new hp(e.toString(),r,i)}return null}_attribute(){let e=[];for(;this._match(ye.tokens.attr);){const r=this._consume(ye.attribute_name,"Expected attribute name"),i=new GU(r.toString(),null);if(this._match(ye.tokens.paren_left)){if(i.value=this._consume(ye.literal_or_ident,"Expected attribute value").toString(),this._check(ye.tokens.comma)){this._advance();do{const n=this._consume(ye.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(n)}while(this._match(ye.tokens.comma))}this._consume(ye.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class Dd{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class tS{constructor(e,r,i){this.name=e,this.type=r,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ig extends Dd{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class rv extends Dd{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}}class rS extends Dd{constructor(e,r,i,n){super(e,i),this.format=r,this.access=n}get isTemplate(){return!0}}var bu;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(bu||(bu={}));class ng{constructor(e,r,i,n,o,s,f){this.name=e,this.type=r,this.group=i,this.binding=n,this.attributes=o,this.resourceType=s,this.access=f}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class qU{constructor(e,r){this.name=e,this.type=r}}class sg{constructor(e,r){this.align=e,this.size=r}}class $U{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n,this.interpolation=null}}class iS{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n}}class ZU{constructor(e,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r}}class KU{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class YU{constructor(e,r,i,n){this.name=e,this.type=r,this.attributes=i,this.id=n}}class JU{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class wc{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new KU,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const i=new XU().parse(e);for(const n of i)n instanceof z1&&this._functions.set(n.name,new JU(n));for(const n of i)if(n instanceof xh){const o=this._getTypeInfo(n,null);o instanceof ig&&this.structs.push(o)}for(const n of i){if(n instanceof zR){this.aliases.push(this._getAliasInfo(n));continue}if(n instanceof NR){const o=n,s=this._getAttributeNum(o.attributes,"id",0),f=o.type!=null?this._getTypeInfo(o.type,o.attributes):null;this.overrides.push(new YU(o.name,f,o.attributes,s));continue}if(this._isUniformVar(n)){const o=n,s=this._getAttributeNum(o.attributes,"group",0),f=this._getAttributeNum(o.attributes,"binding",0),A=this._getTypeInfo(o.type,o.attributes),v=new ng(o.name,A,s,f,o.attributes,bu.Uniform,o.access);this.uniforms.push(v);continue}if(this._isStorageVar(n)){const o=n,s=this._getAttributeNum(o.attributes,"group",0),f=this._getAttributeNum(o.attributes,"binding",0),A=this._getTypeInfo(o.type,o.attributes),v=this._isStorageTexture(A),w=new ng(o.name,A,s,f,o.attributes,v?bu.StorageTexture:bu.Storage,o.access);this.storage.push(w);continue}if(this._isTextureVar(n)){const o=n,s=this._getAttributeNum(o.attributes,"group",0),f=this._getAttributeNum(o.attributes,"binding",0),A=this._getTypeInfo(o.type,o.attributes),v=this._isStorageTexture(A),w=new ng(o.name,A,s,f,o.attributes,v?bu.StorageTexture:bu.Texture,o.access);v?this.storage.push(w):this.textures.push(w);continue}if(this._isSamplerVar(n)){const o=n,s=this._getAttributeNum(o.attributes,"group",0),f=this._getAttributeNum(o.attributes,"binding",0),A=this._getTypeInfo(o.type,o.attributes),v=new ng(o.name,A,s,f,o.attributes,bu.Sampler,o.access);this.samplers.push(v);continue}if(n instanceof z1){const o=this._getAttribute(n,"vertex"),s=this._getAttribute(n,"fragment"),f=this._getAttribute(n,"compute"),A=o||s||f,v=new ZU(n.name,A==null?void 0:A.name);v.startLine=n.startLine,v.endLine=n.endLine,this.functions.push(v),this._functions.get(n.name).info=v,A&&(this._functions.get(n.name).inUse=!0,v.inUse=!0,v.resources=this._findResources(n,!!A),v.inputs=this._getInputs(n.args),v.outputs=this._getOutputs(n.returnType),this.entry[A.name].push(v));continue}}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var i;for(const n of e.calls){const o=(i=this._functions.get(n.name))===null||i===void 0?void 0:i.info;o&&r.add(o)}}findResource(e,r){for(const i of this.uniforms)if(i.group==e&&i.binding==r)return i;for(const i of this.storage)if(i.group==e&&i.binding==r)return i;for(const i of this.textures)if(i.group==e&&i.binding==r)return i;for(const i of this.samplers)if(i.group==e&&i.binding==r)return i;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this._getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const i=[],n=this,o=[];return e.search(s=>{if(s instanceof Pm)o.push({});else if(s instanceof Im)o.pop();else if(s instanceof wh){const f=s;r&&f.type!==null&&this._markStructsFromAST(f.type),o.length>0&&(o[o.length-1][f.name]=f)}else if(s instanceof _d){const f=s;r&&f.type!==null&&this._markStructsFromAST(f.type)}else if(s instanceof V1){const f=s;r&&f.type!==null&&this._markStructsFromAST(f.type),o.length>0&&(o[o.length-1][f.name]=f)}else if(s instanceof j1){const f=s;if(o.length>0&&o[o.length-1][f.name])return;const A=n._findResource(f.name);A&&i.push(A)}else if(s instanceof HR){const f=s,A=n._functions.get(f.name);A&&(r&&(A.inUse=!0),e.calls.add(A.node),A.resources===null&&(A.resources=n._findResources(A.node,r)),i.push(...A.resources))}else if(s instanceof UR){const f=s,A=n._functions.get(f.name);A&&(r&&(A.inUse=!0),e.calls.add(A.node),A.resources===null&&(A.resources=n._findResources(A.node,r)),i.push(...A.resources))}}),[...new Map(i.map(s=>[s.name,s])).values()]}getBindGroups(){const e=[];function r(i,n){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),n>=e[i].length&&(e[i].length=n+1)}for(const i of this.uniforms){r(i.group,i.binding);const n=e[i.group];n[i.binding]=i}for(const i of this.storage){r(i.group,i.binding);const n=e[i.group];n[i.binding]=i}for(const i of this.textures){r(i.group,i.binding);const n=e[i.group];n[i.binding]=i}for(const i of this.samplers){r(i.group,i.binding);const n=e[i.group];n[i.binding]=i}return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof xh)this._getStructOutputs(e,r);else{const i=this._getOutputInfo(e);i!==null&&r.push(i)}return r}_getStructOutputs(e,r){for(const i of e.members)if(i.type instanceof xh)this._getStructOutputs(i.type,r);else{const n=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(n!==null){const o=this._getTypeInfo(i.type,i.type.attributes),s=this._parseInt(n.value),f=new iS(i.name,o,n.name,s);r.push(f)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const i=this._getTypeInfo(e,e.attributes),n=this._parseInt(r.value);return new iS("",i,r.name,n)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const i of e)if(i.type instanceof xh)this._getStructInputs(i.type,r);else{const n=this._getInputInfo(i);n!==null&&r.push(n)}return r}_getStructInputs(e,r){for(const i of e.members)if(i.type instanceof xh)this._getStructInputs(i.type,r);else{const n=this._getInputInfo(i);n!==null&&r.push(n)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const i=this._getAttribute(e,"interpolation"),n=this._getTypeInfo(e.type,e.attributes),o=this._parseInt(r.value),s=new $U(e.name,n,r.name,o);return i!==null&&(s.interpolation=this._parseString(i.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new qU(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,r){if(this._types.has(e))return this._types.get(e);if(e instanceof jR){const n=e,o=this._getTypeInfo(n.format,n.attributes),s=new rv(n.name,r);return s.format=o,s.count=n.count,this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof xh){const n=e,o=new ig(n.name,r);o.startLine=n.startLine,o.endLine=n.endLine;for(const s of n.members){const f=this._getTypeInfo(s.type,s.attributes);o.members.push(new tS(s.name,f,s.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof hp){const n=e,o=n.format instanceof Wh,s=n.format?o?this._getTypeInfo(n.format,null):new Dd(n.format,null):null,f=new rS(n.name,s,r,n.access);return this._types.set(e,f),this._updateTypeInfo(f),f}if(e instanceof VR){const n=e,o=n.format?this._getTypeInfo(n.format,null):null,s=new rS(n.name,o,r,n.access);return this._types.set(e,s),this._updateTypeInfo(s),s}const i=new Dd(e.name,r);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var r,i;const n=this._getTypeSize(e);if(e.size=(r=n==null?void 0:n.size)!==null&&r!==void 0?r:0,e instanceof rv){const o=this._getTypeSize(e.format);e.stride=(i=o==null?void 0:o.size)!==null&&i!==void 0?i:0,this._updateTypeInfo(e.format)}e instanceof ig&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let i=0,n=0,o=0,s=0;for(let f=0,A=e.members.length;f<A;++f){const v=e.members[f],w=this._getTypeSize(v);if(!w)continue;(r=this._getAlias(v.type.name))!==null&&r!==void 0||v.type;const C=w.align,I=w.size;i=this._roundUp(C,i+n),n=I,o=i,s=Math.max(s,C),v.offset=i,v.size=I,this._updateTypeInfo(v.type)}e.size=this._roundUp(s,o+n),e.align=s}_getTypeSize(e){var r,i;if(e==null)return null;const n=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof tS&&(e=e.type),e instanceof Dd){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=wc._typeInfo[e.name];if(s!==void 0){const f=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new sg(Math.max(o,s.align/f),Math.max(n,s.size/f))}}{const s=wc._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const f=e.name[e.name.length-1]==="h"?2:1;return new sg(Math.max(o,s.align/f),Math.max(n,s.size/f))}}if(e instanceof rv){let s=e,f=8,A=8;const v=this._getTypeSize(s.format);v!==null&&(A=v.size,f=v.align);const w=s.count,C=this._getAttributeNum((i=e==null?void 0:e.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(f,A));return A=w*C,n&&(A=n),new sg(Math.max(o,f),Math.max(n,A))}if(e instanceof ig){let s=0,f=0,A=0,v=0,w=0;for(const C of e.members){const I=this._getTypeSize(C.type);I!==null&&(s=Math.max(I.align,s),A=this._roundUp(I.align,A+v),v=I.size,w=A)}return f=this._roundUp(s,w+v),new sg(Math.max(o,s),Math.max(n,f))}return null}_isUniformVar(e){return e instanceof wh&&e.storage=="uniform"}_isStorageVar(e){return e instanceof wh&&e.storage=="storage"}_isTextureVar(e){return e instanceof wh&&e.type!==null&&wc._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof wh&&e.type!==null&&wc._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const i=e;if(!i||!i.attributes)return null;const n=i.attributes;for(let o of n)if(o.name==r)return o;return null}_getAttributeNum(e,r,i){if(e===null)return i;for(let n of e)if(n.name==r){let o=n!==null&&n.value!==null?n.value:i;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):i}return i}_roundUp(e,r){return Math.ceil(r/e)*e}}wc._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};wc._textureTypes=ye.any_texture_type.map(t=>t.name);wc._samplerTypes=ye.sampler_type.map(t=>t.name);function QU(t){var o;const e={attributes:[],bindings:[]};let r;try{r=e9(t)}catch(s){return Et.error(s.message)(),e}for(const s of r.uniforms){const f=[];for(const A of((o=s.type)==null?void 0:o.members)||[])f.push({name:A.name,type:nS(A.type)});e.bindings.push({type:"uniform",name:s.name,location:s.binding,group:s.group,members:f})}const i=r.entry.vertex[0],n=(i==null?void 0:i.inputs.length)||0;for(let s=0;s<n;s++){const f=i.inputs[s];if(f.locationType==="location"){const A=nS(f.type);e.attributes.push({name:f.name,location:Number(f.location),type:A})}}return e}function nS(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function e9(t){try{return new wc(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(r+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(r+=e.token.line||""),new Error(r,{cause:e})}}const t9=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,r9={name:"fp32",vs:t9},i9=[0,1,1,1],n9=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,s9=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,sS={name:"picking",vs:n9,fs:s9,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:i9},getUniforms:o9};function o9(t={},e){const r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const i=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=i}if(t.highlightColor){const i=Array.from(t.highlightColor,n=>n/255);Number.isFinite(i[3])||(i[3]=1),r.highlightColor=i}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}function XR(t,e=[],r=0){const i=Math.fround(t),n=t-i;return e[r]=i,e[r+1]=n,e}function a9(t){return t-Math.fround(t)}function l9(t){const e=new Float32Array(32);for(let r=0;r<4;++r)for(let i=0;i<4;++i){const n=r*4+i;XR(t[i*4+r],e,n*2)}return e}const c9=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,u9={ONE:1};function h9(){return u9}const T_={name:"fp64-arithmetic",vs:c9,getUniforms:h9,fp64ify:XR,fp64LowPart:a9,fp64ifyMatrix4:l9},f9=1/Math.PI*180,d9=1/180*Math.PI,A9={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...A9}};const ts=globalThis.mathgl.config;function p9(t,{precision:e=ts.precision}={}){return t=y9(t),`${parseFloat(t.toPrecision(e))}`}function Ru(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function g9(t){return _9(t)}function m9(t){return Wa(t)}function _9(t,e){return T2(t,r=>r*d9,e)}function Wa(t,e){return T2(t,r=>r*f9,e)}function Tc(t,e,r){return T2(t,i=>Math.max(e,Math.min(r,i)))}function el(t,e,r){return Ru(t)?t.map((i,n)=>el(i,e[n],r)):r*e+(1-r)*t}function Ca(t,e,r){const i=ts.EPSILON;r&&(ts.EPSILON=r);try{if(t===e)return!0;if(Ru(t)&&Ru(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Ca(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=ts.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{ts.EPSILON=i}}function y9(t){return Math.round(t/ts.EPSILON)*ts.EPSILON}function v9(t){return t.clone?t.clone():new Array(t.length)}function T2(t,e,r){if(Ru(t)){const i=t;r=r||v9(i);for(let n=0;n<r.length&&n<i.length;++n){const o=typeof t=="number"?t:t[n];r[n]=e(o,n,r)}return r}return e(t)}class E2 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+r];return this.check()}toArray(e=[],r=0){for(let i=0;i<this.ELEMENTS;++i)e[r+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Ru(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ts)}formatString(e){let r="";for(let i=0;i<this.ELEMENTS;++i)r+=(i>0?", ":"")+p9(this[i],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!Ca(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,i){if(i===void 0)return this.lerp(this,e,r);for(let n=0;n<this.ELEMENTS;++n){const o=e[n],s=typeof r=="number"?r:r[n];this[n]=o+i*(s-o)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),r[i]);return this.check()}add(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=r[i];return this.check()}subtract(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=r[i];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(ts.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),r);return this.check()}get elements(){return this}}function b9(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function mi(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function vp(t,e,r=""){if(ts.debug&&!b9(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function qa(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class S2 extends E2{get x(){return this[0]}set x(e){this[0]=mi(e)}get y(){return this[1]}set y(e){this[1]=mi(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-e[i];r+=n*n}return mi(r)}dot(e){let r=0;for(let i=0;i<this.ELEMENTS;++i)r+=this[i]*e[i];return mi(r)}normalize(){const e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=r[i];return this.check()}divide(...e){for(const r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=r[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return qa(e>=0&&e<this.ELEMENTS,"index is out of range"),mi(this[e])}setComponent(e,r){return qa(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}}const bp=1e-6;let rl=typeof Float32Array<"u"?Float32Array:Array;function x9(){const t=new rl(2);return rl!=Float32Array&&(t[0]=0,t[1]=0),t}function oS(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function w9(t,e){return t[0]=-e[0],t[1]=-e[1],t}function qR(t,e,r,i){const n=e[0],o=e[1];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t}function T9(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function E9(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function $R(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function ZR(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}(function(){const t=x9();return function(e,r,i,n,o,s){let f,A;for(r||(r=2),i||(i=0),n?A=Math.min(n*r+i,e.length):A=e.length,f=i;f<A;f+=r)t[0]=e[f],t[1]=e[f+1],o(t,t,s),e[f]=t[0],e[f+1]=t[1];return e}})();function KR(t,e,r){const i=e[0],n=e[1],o=r[3]*i+r[7]*n||1;return t[0]=(r[0]*i+r[4]*n)/o,t[1]=(r[1]*i+r[5]*n)/o,t}function YR(t,e,r){const i=e[0],n=e[1],o=e[2],s=r[3]*i+r[7]*n+r[11]*o||1;return t[0]=(r[0]*i+r[4]*n+r[8]*o)/s,t[1]=(r[1]*i+r[5]*n+r[9]*o)/s,t[2]=(r[2]*i+r[6]*n+r[10]*o)/s,t}function S9(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t}function C9(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t[3]=e[3],t}function JR(t,e,r){const i=e[0],n=e[1],o=e[2];return t[0]=r[0]*i+r[3]*n+r[6]*o,t[1]=r[1]*i+r[4]*n+r[7]*o,t[2]=r[2]*i+r[5]*n+r[8]*o,t[3]=e[3],t}class C2 extends S2{constructor(e=0,r=0){super(2),Ru(e)&&arguments.length===1?this.copy(e):(ts.debug&&(mi(e),mi(r)),this[0]=e,this[1]=r)}set(e,r){return this[0]=e,this[1]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return ts.debug&&(mi(e.x),mi(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return ZR(this,this,e),this.check()}transformAsVector(e){return KR(this,this,e),this.check()}transformByMatrix3(e){return $R(this,this,e),this.check()}transformByMatrix2x3(e){return E9(this,this,e),this.check()}transformByMatrix2(e){return T9(this,this,e),this.check()}}function QR(){const t=new rl(3);return rl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function eB(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function aS(t,e,r){const i=new rl(3);return i[0]=t,i[1]=e,i[2]=r,i}function P9(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function I9(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function M9(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function R9(t,e){const r=e[0],i=e[1],n=e[2];let o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function P2(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function rm(t,e,r){const i=e[0],n=e[1],o=e[2],s=r[0],f=r[1],A=r[2];return t[0]=n*A-o*f,t[1]=o*s-i*A,t[2]=i*f-n*s,t}function B9(t,e,r,i){const n=e[0],o=e[1],s=e[2];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=s+i*(r[2]-s),t}function I2(t,e,r){const i=e[0],n=e[1],o=e[2];let s=r[3]*i+r[7]*n+r[11]*o+r[15];return s=s||1,t[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/s,t[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/s,t[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/s,t}function tB(t,e,r){const i=e[0],n=e[1],o=e[2];return t[0]=i*r[0]+n*r[3]+o*r[6],t[1]=i*r[1]+n*r[4]+o*r[7],t[2]=i*r[2]+n*r[5]+o*r[8],t}function rB(t,e,r){const i=r[0],n=r[1],o=r[2],s=r[3],f=e[0],A=e[1],v=e[2];let w=n*v-o*A,C=o*f-i*v,I=i*A-n*f,B=n*I-o*C,F=o*w-i*I,N=i*C-n*w;const V=s*2;return w*=V,C*=V,I*=V,B*=2,F*=2,N*=2,t[0]=f+w+B,t[1]=A+C+F,t[2]=v+I+N,t}function O9(t,e,r,i){const n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function D9(t,e,r,i){const n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function F9(t,e,r,i){const n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function L9(t,e){const r=t[0],i=t[1],n=t[2],o=e[0],s=e[1],f=e[2],A=Math.sqrt((r*r+i*i+n*n)*(o*o+s*s+f*f)),v=A&&P2(t,e)/A;return Math.acos(Math.min(Math.max(v,-1),1))}const iB=P9,nB=eB,iv=I9;(function(){const t=QR();return function(e,r,i,n,o,s){let f,A;for(r||(r=3),i||(i=0),n?A=Math.min(n*r+i,e.length):A=e.length,f=i;f<A;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],o(t,t,s),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2];return e}})();const nv=[0,0,0];let og;class Ke extends S2{static get ZERO(){return og||(og=new Ke(0,0,0),Object.freeze(og)),og}constructor(e=0,r=0,i=0){super(-0,-0,-0),arguments.length===1&&Ru(e)?this.copy(e):(ts.debug&&(mi(e),mi(r),mi(i)),this[0]=e,this[1]=r,this[2]=i)}set(e,r,i){return this[0]=e,this[1]=r,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ts.debug&&(mi(e.x),mi(e.y),mi(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=mi(e)}angle(e){return L9(this,e)}cross(e){return rm(this,this,e),this.check()}rotateX({radians:e,origin:r=nv}){return O9(this,this,r,e),this.check()}rotateY({radians:e,origin:r=nv}){return D9(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=nv}){return F9(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return I2(this,this,e),this.check()}transformAsVector(e){return YR(this,this,e),this.check()}transformByMatrix3(e){return tB(this,this,e),this.check()}transformByMatrix2(e){return S9(this,this,e),this.check()}transformByQuaternion(e){return rB(this,this,e),this.check()}}let ag;class M2 extends S2{static get ZERO(){return ag||(ag=new M2(0,0,0,0),Object.freeze(ag)),ag}constructor(e=0,r=0,i=0,n=0){super(-0,-0,-0,-0),Ru(e)&&arguments.length===1?this.copy(e):(ts.debug&&(mi(e),mi(r),mi(i),mi(n)),this[0]=e,this[1]=r,this[2]=i,this[3]=n)}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return ts.debug&&(mi(e.x),mi(e.y),mi(e.z),mi(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=mi(e)}get w(){return this[3]}set w(e){this[3]=mi(e)}transform(e){return I2(this,this,e),this.check()}transformByMatrix3(e){return JR(this,this,e),this.check()}transformByMatrix2(e){return C9(this,this,e),this.check()}transformByQuaternion(e){return rB(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class sB extends E2{toString(){let e="[";if(ts.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,i){return this[r*this.RANK+e]=mi(i),this}getColumn(e,r=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let n=0;n<this.RANK;++n)r[n]=this[i+n];return r}setColumn(e,r){const i=e*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=r[n];return this}}function k9(){const t=new rl(9);return rl!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function N9(t,e){if(t===e){const r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function U9(t,e){const r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],f=e[5],A=e[6],v=e[7],w=e[8],C=w*s-f*v,I=-w*o+f*A,B=v*o-s*A;let F=r*C+i*I+n*B;return F?(F=1/F,t[0]=C*F,t[1]=(-w*i+n*v)*F,t[2]=(f*i-n*s)*F,t[3]=I*F,t[4]=(w*r-n*A)*F,t[5]=(-f*r+n*o)*F,t[6]=B*F,t[7]=(-v*r+i*A)*F,t[8]=(s*r-i*o)*F,t):null}function z9(t){const e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],s=t[5],f=t[6],A=t[7],v=t[8];return e*(v*o-s*A)+r*(-v*n+s*f)+i*(A*n-o*f)}function lS(t,e,r){const i=e[0],n=e[1],o=e[2],s=e[3],f=e[4],A=e[5],v=e[6],w=e[7],C=e[8],I=r[0],B=r[1],F=r[2],N=r[3],V=r[4],G=r[5],Y=r[6],Z=r[7],se=r[8];return t[0]=I*i+B*s+F*v,t[1]=I*n+B*f+F*w,t[2]=I*o+B*A+F*C,t[3]=N*i+V*s+G*v,t[4]=N*n+V*f+G*w,t[5]=N*o+V*A+G*C,t[6]=Y*i+Z*s+se*v,t[7]=Y*n+Z*f+se*w,t[8]=Y*o+Z*A+se*C,t}function V9(t,e,r){const i=e[0],n=e[1],o=e[2],s=e[3],f=e[4],A=e[5],v=e[6],w=e[7],C=e[8],I=r[0],B=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=f,t[5]=A,t[6]=I*i+B*s+v,t[7]=I*n+B*f+w,t[8]=I*o+B*A+C,t}function j9(t,e,r){const i=e[0],n=e[1],o=e[2],s=e[3],f=e[4],A=e[5],v=e[6],w=e[7],C=e[8],I=Math.sin(r),B=Math.cos(r);return t[0]=B*i+I*s,t[1]=B*n+I*f,t[2]=B*o+I*A,t[3]=B*s-I*i,t[4]=B*f-I*n,t[5]=B*A-I*o,t[6]=v,t[7]=w,t[8]=C,t}function cS(t,e,r){const i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function H9(t,e){const r=e[0],i=e[1],n=e[2],o=e[3],s=r+r,f=i+i,A=n+n,v=r*s,w=i*s,C=i*f,I=n*s,B=n*f,F=n*A,N=o*s,V=o*f,G=o*A;return t[0]=1-C-F,t[3]=w-G,t[6]=I+V,t[1]=w+G,t[4]=1-v-F,t[7]=B-N,t[2]=I-V,t[5]=B+N,t[8]=1-v-C,t}var H1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(H1||(H1={}));const G9=Object.freeze([1,0,0,0,1,0,0,0,1]);class Mn extends sB{static get IDENTITY(){return X9()}static get ZERO(){return W9()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return H1}constructor(e,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(G9)}fromObject(e){return this.check()}fromQuaternion(e){return H9(this,e),this.check()}set(e,r,i,n,o,s,f,A,v){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=o,this[5]=s,this[6]=f,this[7]=A,this[8]=v,this.check()}setRowMajor(e,r,i,n,o,s,f,A,v){return this[0]=e,this[1]=n,this[2]=f,this[3]=r,this[4]=o,this[5]=A,this[6]=i,this[7]=s,this[8]=v,this.check()}determinant(){return z9(this)}transpose(){return N9(this,this),this.check()}invert(){return U9(this,this),this.check()}multiplyLeft(e){return lS(this,e,this),this.check()}multiplyRight(e){return lS(this,this,e),this.check()}rotate(e){return j9(this,this,e),this.check()}scale(e){return Array.isArray(e)?cS(this,this,e):cS(this,this,[e,e]),this.check()}translate(e){return V9(this,this,e),this.check()}transform(e,r){let i;switch(e.length){case 2:i=$R(r||[-0,-0],e,this);break;case 3:i=tB(r||[-0,-0,-0],e,this);break;case 4:i=JR(r||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return vp(i,e.length),i}transformVector(e,r){return this.transform(e,r)}transformVector2(e,r){return this.transform(e,r)}transformVector3(e,r){return this.transform(e,r)}}let lg,cg=null;function W9(){return lg||(lg=new Mn([0,0,0,0,0,0,0,0,0]),Object.freeze(lg)),lg}function X9(){return cg||(cg=new Mn,Object.freeze(cg)),cg}function q9(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $9(t,e){if(t===e){const r=e[1],i=e[2],n=e[3],o=e[6],s=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=n,t[13]=s,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function G1(t,e){const r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],f=e[5],A=e[6],v=e[7],w=e[8],C=e[9],I=e[10],B=e[11],F=e[12],N=e[13],V=e[14],G=e[15],Y=r*f-i*s,Z=r*A-n*s,se=r*v-o*s,ge=i*A-n*f,Pe=i*v-o*f,Ue=n*v-o*A,Fe=w*N-C*F,pe=w*V-I*F,Te=w*G-B*F,Ae=C*V-I*N,Le=C*G-B*N,Ve=I*G-B*V;let Xe=Y*Ve-Z*Le+se*Ae+ge*Te-Pe*pe+Ue*Fe;return Xe?(Xe=1/Xe,t[0]=(f*Ve-A*Le+v*Ae)*Xe,t[1]=(n*Le-i*Ve-o*Ae)*Xe,t[2]=(N*Ue-V*Pe+G*ge)*Xe,t[3]=(I*Pe-C*Ue-B*ge)*Xe,t[4]=(A*Te-s*Ve-v*pe)*Xe,t[5]=(r*Ve-n*Te+o*pe)*Xe,t[6]=(V*se-F*Ue-G*Z)*Xe,t[7]=(w*Ue-I*se+B*Z)*Xe,t[8]=(s*Le-f*Te+v*Fe)*Xe,t[9]=(i*Te-r*Le-o*Fe)*Xe,t[10]=(F*Pe-N*se+G*Y)*Xe,t[11]=(C*se-w*Pe-B*Y)*Xe,t[12]=(f*pe-s*Ae-A*Fe)*Xe,t[13]=(r*Ae-i*pe+n*Fe)*Xe,t[14]=(N*Z-F*ge-V*Y)*Xe,t[15]=(w*ge-C*Z+I*Y)*Xe,t):null}function Z9(t){const e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],s=t[5],f=t[6],A=t[7],v=t[8],w=t[9],C=t[10],I=t[11],B=t[12],F=t[13],N=t[14],V=t[15],G=e*s-r*o,Y=e*f-i*o,Z=r*f-i*s,se=v*F-w*B,ge=v*N-C*B,Pe=w*N-C*F,Ue=e*Pe-r*ge+i*se,Fe=o*Pe-s*ge+f*se,pe=v*Z-w*Y+C*G,Te=B*Z-F*Y+N*G;return A*Ue-n*Fe+V*pe-I*Te}function Bh(t,e,r){const i=e[0],n=e[1],o=e[2],s=e[3],f=e[4],A=e[5],v=e[6],w=e[7],C=e[8],I=e[9],B=e[10],F=e[11],N=e[12],V=e[13],G=e[14],Y=e[15];let Z=r[0],se=r[1],ge=r[2],Pe=r[3];return t[0]=Z*i+se*f+ge*C+Pe*N,t[1]=Z*n+se*A+ge*I+Pe*V,t[2]=Z*o+se*v+ge*B+Pe*G,t[3]=Z*s+se*w+ge*F+Pe*Y,Z=r[4],se=r[5],ge=r[6],Pe=r[7],t[4]=Z*i+se*f+ge*C+Pe*N,t[5]=Z*n+se*A+ge*I+Pe*V,t[6]=Z*o+se*v+ge*B+Pe*G,t[7]=Z*s+se*w+ge*F+Pe*Y,Z=r[8],se=r[9],ge=r[10],Pe=r[11],t[8]=Z*i+se*f+ge*C+Pe*N,t[9]=Z*n+se*A+ge*I+Pe*V,t[10]=Z*o+se*v+ge*B+Pe*G,t[11]=Z*s+se*w+ge*F+Pe*Y,Z=r[12],se=r[13],ge=r[14],Pe=r[15],t[12]=Z*i+se*f+ge*C+Pe*N,t[13]=Z*n+se*A+ge*I+Pe*V,t[14]=Z*o+se*v+ge*B+Pe*G,t[15]=Z*s+se*w+ge*F+Pe*Y,t}function Mm(t,e,r){const i=r[0],n=r[1],o=r[2];let s,f,A,v,w,C,I,B,F,N,V,G;return e===t?(t[12]=e[0]*i+e[4]*n+e[8]*o+e[12],t[13]=e[1]*i+e[5]*n+e[9]*o+e[13],t[14]=e[2]*i+e[6]*n+e[10]*o+e[14],t[15]=e[3]*i+e[7]*n+e[11]*o+e[15]):(s=e[0],f=e[1],A=e[2],v=e[3],w=e[4],C=e[5],I=e[6],B=e[7],F=e[8],N=e[9],V=e[10],G=e[11],t[0]=s,t[1]=f,t[2]=A,t[3]=v,t[4]=w,t[5]=C,t[6]=I,t[7]=B,t[8]=F,t[9]=N,t[10]=V,t[11]=G,t[12]=s*i+w*n+F*o+e[12],t[13]=f*i+C*n+N*o+e[13],t[14]=A*i+I*n+V*o+e[14],t[15]=v*i+B*n+G*o+e[15]),t}function R2(t,e,r){const i=r[0],n=r[1],o=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function K9(t,e,r,i){let n=i[0],o=i[1],s=i[2],f=Math.sqrt(n*n+o*o+s*s),A,v,w,C,I,B,F,N,V,G,Y,Z,se,ge,Pe,Ue,Fe,pe,Te,Ae,Le,Ve,Xe,dt;return f<bp?null:(f=1/f,n*=f,o*=f,s*=f,v=Math.sin(r),A=Math.cos(r),w=1-A,C=e[0],I=e[1],B=e[2],F=e[3],N=e[4],V=e[5],G=e[6],Y=e[7],Z=e[8],se=e[9],ge=e[10],Pe=e[11],Ue=n*n*w+A,Fe=o*n*w+s*v,pe=s*n*w-o*v,Te=n*o*w-s*v,Ae=o*o*w+A,Le=s*o*w+n*v,Ve=n*s*w+o*v,Xe=o*s*w-n*v,dt=s*s*w+A,t[0]=C*Ue+N*Fe+Z*pe,t[1]=I*Ue+V*Fe+se*pe,t[2]=B*Ue+G*Fe+ge*pe,t[3]=F*Ue+Y*Fe+Pe*pe,t[4]=C*Te+N*Ae+Z*Le,t[5]=I*Te+V*Ae+se*Le,t[6]=B*Te+G*Ae+ge*Le,t[7]=F*Te+Y*Ae+Pe*Le,t[8]=C*Ve+N*Xe+Z*dt,t[9]=I*Ve+V*Xe+se*dt,t[10]=B*Ve+G*Xe+ge*dt,t[11]=F*Ve+Y*Xe+Pe*dt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function oB(t,e,r){const i=Math.sin(r),n=Math.cos(r),o=e[4],s=e[5],f=e[6],A=e[7],v=e[8],w=e[9],C=e[10],I=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+v*i,t[5]=s*n+w*i,t[6]=f*n+C*i,t[7]=A*n+I*i,t[8]=v*n-o*i,t[9]=w*n-s*i,t[10]=C*n-f*i,t[11]=I*n-A*i,t}function Y9(t,e,r){const i=Math.sin(r),n=Math.cos(r),o=e[0],s=e[1],f=e[2],A=e[3],v=e[8],w=e[9],C=e[10],I=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-v*i,t[1]=s*n-w*i,t[2]=f*n-C*i,t[3]=A*n-I*i,t[8]=o*i+v*n,t[9]=s*i+w*n,t[10]=f*i+C*n,t[11]=A*i+I*n,t}function aB(t,e,r){const i=Math.sin(r),n=Math.cos(r),o=e[0],s=e[1],f=e[2],A=e[3],v=e[4],w=e[5],C=e[6],I=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+v*i,t[1]=s*n+w*i,t[2]=f*n+C*i,t[3]=A*n+I*i,t[4]=v*n-o*i,t[5]=w*n-s*i,t[6]=C*n-f*i,t[7]=I*n-A*i,t}function J9(t,e){const r=e[0],i=e[1],n=e[2],o=e[4],s=e[5],f=e[6],A=e[8],v=e[9],w=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(o*o+s*s+f*f),t[2]=Math.sqrt(A*A+v*v+w*w),t}function Q9(t,e){const r=e[0],i=e[1],n=e[2],o=e[3],s=r+r,f=i+i,A=n+n,v=r*s,w=i*s,C=i*f,I=n*s,B=n*f,F=n*A,N=o*s,V=o*f,G=o*A;return t[0]=1-C-F,t[1]=w+G,t[2]=I-V,t[3]=0,t[4]=w-G,t[5]=1-v-F,t[6]=B+N,t[7]=0,t[8]=I+V,t[9]=B-N,t[10]=1-v-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ez(t,e,r,i,n,o,s){const f=1/(r-e),A=1/(n-i),v=1/(o-s);return t[0]=o*2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*A,t[6]=0,t[7]=0,t[8]=(r+e)*f,t[9]=(n+i)*A,t[10]=(s+o)*v,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*v,t[15]=0,t}function tz(t,e,r,i,n){const o=1/Math.tan(e/2);if(t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){const s=1/(i-n);t[10]=(n+i)*s,t[14]=2*n*i*s}else t[10]=-1,t[14]=-2*i;return t}const rz=tz;function iz(t,e,r,i,n,o,s){const f=1/(e-r),A=1/(i-n),v=1/(o-s);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*A,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*v,t[11]=0,t[12]=(e+r)*f,t[13]=(n+i)*A,t[14]=(s+o)*v,t[15]=1,t}const nz=iz;function sz(t,e,r,i){let n,o,s,f,A,v,w,C,I,B;const F=e[0],N=e[1],V=e[2],G=i[0],Y=i[1],Z=i[2],se=r[0],ge=r[1],Pe=r[2];return Math.abs(F-se)<bp&&Math.abs(N-ge)<bp&&Math.abs(V-Pe)<bp?q9(t):(C=F-se,I=N-ge,B=V-Pe,n=1/Math.sqrt(C*C+I*I+B*B),C*=n,I*=n,B*=n,o=Y*B-Z*I,s=Z*C-G*B,f=G*I-Y*C,n=Math.sqrt(o*o+s*s+f*f),n?(n=1/n,o*=n,s*=n,f*=n):(o=0,s=0,f=0),A=I*f-B*s,v=B*o-C*f,w=C*s-I*o,n=Math.sqrt(A*A+v*v+w*w),n?(n=1/n,A*=n,v*=n,w*=n):(A=0,v=0,w=0),t[0]=o,t[1]=A,t[2]=C,t[3]=0,t[4]=s,t[5]=v,t[6]=I,t[7]=0,t[8]=f,t[9]=w,t[10]=B,t[11]=0,t[12]=-(o*F+s*N+f*V),t[13]=-(A*F+v*N+w*V),t[14]=-(C*F+I*N+B*V),t[15]=1,t)}function oz(){const t=new rl(4);return rl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function az(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function B2(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function lz(t){const e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function cz(t){const e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function uz(t,e){const r=e[0],i=e[1],n=e[2],o=e[3];let s=r*r+i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=r*s,t[1]=i*s,t[2]=n*s,t[3]=o*s,t}function hz(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function fz(t,e,r,i){const n=e[0],o=e[1],s=e[2],f=e[3];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=s+i*(r[2]-s),t[3]=f+i*(r[3]-f),t}function uA(t,e,r){const i=e[0],n=e[1],o=e[2],s=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*s,t[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*s,t[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*s,t[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*s,t}function dz(t,e,r){const i=e[0],n=e[1],o=e[2],s=r[0],f=r[1],A=r[2],v=r[3],w=v*i+f*o-A*n,C=v*n+A*i-s*o,I=v*o+s*n-f*i,B=-s*i-f*n-A*o;return t[0]=w*v+B*-s+C*-A-I*-f,t[1]=C*v+B*-f+I*-s-w*-A,t[2]=I*v+B*-A+w*-f-C*-s,t[3]=e[3],t}(function(){const t=oz();return function(e,r,i,n,o,s){let f,A;for(r||(r=4),i||(i=0),n?A=Math.min(n*r+i,e.length):A=e.length,f=i;f<A;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],o(t,t,s),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}})();var W1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(W1||(W1={}));const Az=45*Math.PI/180,pz=1,sv=.1,ov=500,gz=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Gr extends sB{static get IDENTITY(){return _z()}static get ZERO(){return mz()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return W1}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,i,n,o,s,f,A,v,w,C,I,B,F,N,V){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=o,this[5]=s,this[6]=f,this[7]=A,this[8]=v,this[9]=w,this[10]=C,this[11]=I,this[12]=B,this[13]=F,this[14]=N,this[15]=V,this.check()}setRowMajor(e,r,i,n,o,s,f,A,v,w,C,I,B,F,N,V){return this[0]=e,this[1]=o,this[2]=v,this[3]=B,this[4]=r,this[5]=s,this[6]=w,this[7]=F,this[8]=i,this[9]=f,this[10]=C,this[11]=N,this[12]=n,this[13]=A,this[14]=I,this[15]=V,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(gz)}fromObject(e){return this.check()}fromQuaternion(e){return Q9(this,e),this.check()}frustum(e){const{left:r,right:i,bottom:n,top:o,near:s=sv,far:f=ov}=e;return f===1/0?yz(this,r,i,n,o,s):ez(this,r,i,n,o,s,f),this.check()}lookAt(e){const{eye:r,center:i=[0,0,0],up:n=[0,1,0]}=e;return sz(this,r,i,n),this.check()}ortho(e){const{left:r,right:i,bottom:n,top:o,near:s=sv,far:f=ov}=e;return nz(this,r,i,n,o,s,f),this.check()}orthographic(e){const{fovy:r=Az,aspect:i=pz,focalDistance:n=1,near:o=sv,far:s=ov}=e;uS(r);const f=r/2,A=n*Math.tan(f),v=A*i;return this.ortho({left:-v,right:v,bottom:-A,top:A,near:o,far:s})}perspective(e){const{fovy:r=45*Math.PI/180,aspect:i=1,near:n=.1,far:o=500}=e;return uS(r),rz(this,r,i,n,o),this.check()}determinant(){return Z9(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),n=1/i[0],o=1/i[1],s=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*o,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*o,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),n=1/i[0],o=1/i[1],s=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=this[4]*n,e[4]=this[5]*o,e[5]=this[6]*s,e[6]=this[8]*n,e[7]=this[9]*o,e[8]=this[10]*s,e}transpose(){return $9(this,this),this.check()}invert(){return G1(this,this),this.check()}multiplyLeft(e){return Bh(this,e,this),this.check()}multiplyRight(e){return Bh(this,this,e),this.check()}rotateX(e){return oB(this,this,e),this.check()}rotateY(e){return Y9(this,this,e),this.check()}rotateZ(e){return aB(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return K9(this,this,e,r),this.check()}scale(e){return R2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Mm(this,this,e),this.check()}transform(e,r){return e.length===4?(r=uA(r||[-0,-0,-0,-0],e,this),vp(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){const{length:i}=e;let n;switch(i){case 2:n=ZR(r||[-0,-0],e,this);break;case 3:n=I2(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return vp(n,e.length),n}transformAsVector(e,r){let i;switch(e.length){case 2:i=KR(r||[-0,-0],e,this);break;case 3:i=YR(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return vp(i,e.length),i}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,i){return this.identity().translate([e,r,i])}}let ug,hg;function mz(){return ug||(ug=new Gr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ug)),ug}function _z(){return hg||(hg=new Gr,Object.freeze(hg)),hg}function uS(t){if(t>Math.PI*2)throw Error("expected radians")}function yz(t,e,r,i,n,o){const s=2*o/(r-e),f=2*o/(n-i),A=(r+e)/(r-e),v=(n+i)/(n-i),w=-1,C=-1,I=-2*o;return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=A,t[9]=v,t[10]=w,t[11]=C,t[12]=0,t[13]=0,t[14]=I,t[15]=0,t}function hS(){const t=new rl(4);return rl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function vz(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function lB(t,e,r){r=r*.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function fS(t,e,r){const i=e[0],n=e[1],o=e[2],s=e[3],f=r[0],A=r[1],v=r[2],w=r[3];return t[0]=i*w+s*f+n*v-o*A,t[1]=n*w+s*A+o*f-i*v,t[2]=o*w+s*v+i*A-n*f,t[3]=s*w-i*f-n*A-o*v,t}function bz(t,e,r){r*=.5;const i=e[0],n=e[1],o=e[2],s=e[3],f=Math.sin(r),A=Math.cos(r);return t[0]=i*A+s*f,t[1]=n*A+o*f,t[2]=o*A-n*f,t[3]=s*A-i*f,t}function xz(t,e,r){r*=.5;const i=e[0],n=e[1],o=e[2],s=e[3],f=Math.sin(r),A=Math.cos(r);return t[0]=i*A-o*f,t[1]=n*A+s*f,t[2]=o*A+i*f,t[3]=s*A-n*f,t}function wz(t,e,r){r*=.5;const i=e[0],n=e[1],o=e[2],s=e[3],f=Math.sin(r),A=Math.cos(r);return t[0]=i*A+n*f,t[1]=n*A-i*f,t[2]=o*A+s*f,t[3]=s*A-o*f,t}function Tz(t,e){const r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function im(t,e,r,i){const n=e[0],o=e[1],s=e[2],f=e[3];let A=r[0],v=r[1],w=r[2],C=r[3],I,B,F,N,V;return I=n*A+o*v+s*w+f*C,I<0&&(I=-I,A=-A,v=-v,w=-w,C=-C),1-I>bp?(B=Math.acos(I),V=Math.sin(B),F=Math.sin((1-i)*B)/V,N=Math.sin(i*B)/V):(F=1-i,N=i),t[0]=F*n+N*A,t[1]=F*o+N*v,t[2]=F*s+N*w,t[3]=F*f+N*C,t}function Ez(t,e){const r=e[0],i=e[1],n=e[2],o=e[3],s=r*r+i*i+n*n+o*o,f=s?1/s:0;return t[0]=-r*f,t[1]=-i*f,t[2]=-n*f,t[3]=o*f,t}function Sz(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function cB(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);const o=(n+1)%3,s=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[o*3+o]-e[s*3+s]+1),t[n]=.5*i,i=.5/i,t[3]=(e[o*3+s]-e[s*3+o])*i,t[o]=(e[o*3+n]+e[n*3+o])*i,t[s]=(e[s*3+n]+e[n*3+s])*i}return t}const Cz=az,Pz=B2,Iz=hz,Mz=fz,Rz=lz,Bz=cz,uB=uz,Oz=function(){const t=QR(),e=aS(1,0,0),r=aS(0,1,0);return function(i,n,o){const s=P2(n,o);return s<-.999999?(rm(t,e,n),nB(t)<1e-6&&rm(t,r,n),R9(t,t),lB(i,t,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(rm(t,n,o),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+s,uB(i,i))}}();(function(){const t=hS(),e=hS();return function(r,i,n,o,s,f){return im(t,i,s,f),im(e,n,o,f),im(r,t,e,2*f*(1-f)),r}})();(function(){const t=k9();return function(e,r,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],uB(e,cB(e,t))}})();const Dz=[0,0,0,1];class Up extends E2{constructor(e=0,r=0,i=0,n=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,r,i,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return cB(this,e),this.check()}fromAxisRotation(e,r){return lB(this,e,r),this.check()}identity(){return vz(this),this.check()}setAxisAngle(e,r){return this.fromAxisRotation(e,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=mi(e)}get y(){return this[1]}set y(e){this[1]=mi(e)}get z(){return this[2]}set z(e){this[2]=mi(e)}get w(){return this[3]}set w(e){this[3]=mi(e)}len(){return Rz(this)}lengthSquared(){return Bz(this)}dot(e){return Iz(this,e)}rotationTo(e,r){return Oz(this,e,r),this.check()}add(e){return Cz(this,this,e),this.check()}calculateW(){return Tz(this,this),this.check()}conjugate(){return Sz(this,this),this.check()}invert(){return Ez(this,this),this.check()}lerp(e,r,i){return i===void 0?this.lerp(this,e,r):(Mz(this,e,r,i),this.check())}multiplyRight(e){return fS(this,this,e),this.check()}multiplyLeft(e){return fS(this,e,this),this.check()}normalize(){const e=this.len(),r=e>0?1/e:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,e===0&&(this[3]=1),this.check()}rotateX(e){return bz(this,this,e),this.check()}rotateY(e){return xz(this,this,e),this.check()}rotateZ(e){return wz(this,this,e),this.check()}scale(e){return Pz(this,this,e),this.check()}slerp(e,r,i){let n,o,s;switch(arguments.length){case 1:({start:n=Dz,target:o,ratio:s}=e);break;case 2:n=this,o=e,s=r;break;default:n=e,o=r,s=i}return im(this,n,o,s),this.check()}transformVector4(e,r=new M2){return dz(r,e,this),vp(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,r){return this.setAxisAngle(e,r)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Fz=.1,Lz=1e-12,hB=1e-15,kz=1e-20,dS=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,Nz={lightSources:{}};function av(t={}){const{color:e=[0,0,0],intensity:r=1}=t;return e.map(i=>i*r/255)}function Uz({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){const i={};return t?i["lighting_uAmbientLight.color"]=av(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((n,o)=>{i[`lighting_uPointLight[${o}].color`]=av(n),i[`lighting_uPointLight[${o}].position`]=n.position,i[`lighting_uPointLight[${o}].attenuation`]=n.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,r.forEach((n,o)=>{i[`lighting_uDirectionalLight[${o}].color`]=av(n),i[`lighting_uDirectionalLight[${o}].direction`]=n.direction}),i.lighting_uDirectionalLightCount=r.length,i}function fB(t=Nz){var e,r;if("lightSources"in t){const{ambientLight:i,pointLights:n,directionalLights:o}=t.lightSources||{};return i||n&&n.length>0||o&&o.length>0?Object.assign({},Uz({ambientLight:i,pointLights:n,directionalLights:o}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const i={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":i.ambientLight=n;break;case"directional":(e=i.directionalLights)==null||e.push(n);break;case"point":(r=i.pointLights)==null||r.push(n);break}return fB({lightSources:i})}return{}}const O2={name:"lights",vs:dS,fs:dS,getUniforms:fB,defines:{MAX_LIGHTS:3}},dB=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,zz={};function Vz(t){const{ambient:e=.35,diffuse:r=.6,shininess:i=32,specularColor:n=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:r,lighting_uShininess:i,lighting_uSpecularColor:n.map(o=>o/255)}}function AB(t=zz){if(!("material"in t))return{};const{material:e}=t;return e?Vz(e):{lighting_uEnabled:!1}}const E_={name:"gouraud-lighting",dependencies:[O2],vs:dB,defines:{LIGHTING_VERTEX:1},getUniforms:AB},pB={name:"phong-lighting",dependencies:[O2],fs:dB,defines:{LIGHTING_FRAGMENT:1},getUniforms:AB},jz=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,Hz=`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,D2={name:"pbr",vs:jz,fs:Hz,defines:{LIGHTING_FRAGMENT:1},dependencies:[O2]},gB="#define SMOOTH_EDGE_RADIUS 0.5",Gz=`
${gB}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Wz=`
${gB}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Xz={name:"geometry",vs:Gz,fs:Wz},br={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(br,"IDENTITY",{get:()=>(fr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Za={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Qo={common:0,meters:1,pixels:2},X1={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},qz=Object.keys(br).map(t=>`const int COORDINATE_SYSTEM_${t} = ${br[t]};`).join(""),$z=Object.keys(Za).map(t=>`const int PROJECTION_MODE_${t} = ${Za[t]};`).join(""),Zz=Object.keys(Qo).map(t=>`const int UNIT_${t.toUpperCase()} = ${Qo[t]};`).join(""),Kz=`${qz}
${$z}
${Zz}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function Yz(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}function a0(t){let e={},r;return i=>{for(const n in i)if(!Yz(i[n],e[n])){r=t(i),e=i;break}return r}}const AS=[0,0,0,0],Jz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],mB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Qz=[0,0,0],_B=[0,0,0],e7=a0(i7);function yB(t,e,r=_B){r.length<3&&(r=[r[0],r[1],0]);let i=r,n,o=!0;switch(e===br.LNGLAT_OFFSETS||e===br.METER_OFFSETS?n=r:n=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Za.WEB_MERCATOR:(e===br.LNGLAT||e===br.CARTESIAN)&&(n=[0,0,0],o=!1);break;case Za.WEB_MERCATOR_AUTO_OFFSET:e===br.LNGLAT?i=n:e===br.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],n=t.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case Za.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case Za.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:o}}function t7(t,e,r){const{viewMatrixUncentered:i,projectionMatrix:n}=t;let{viewMatrix:o,viewProjectionMatrix:s}=t,f=AS,A=AS,v=t.cameraPosition;const{geospatialOrigin:w,shaderCoordinateOrigin:C,offsetMode:I}=yB(t,e,r);return I&&(A=t.projectPosition(w||C),v=[v[0]-A[0],v[1]-A[1],v[2]-A[2]],A[3]=1,f=uA([],A,s),o=i||o,s=Bh([],n,o),s=Bh([],s,Jz)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:f,originCommon:A,cameraPosCommon:v,shaderCoordinateOrigin:C,geospatialOrigin:w}}function r7({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:i=br.DEFAULT,coordinateOrigin:n=_B,autoWrapLongitude:o=!1}){i===br.DEFAULT&&(i=t.isGeospatial?br.LNGLAT:br.CARTESIAN);const s=e7({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n});return s.project_uWrapLongitude=o,s.project_uModelMatrix=r||mB,s}function i7({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i}){const{projectionCenter:n,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:f,shaderCoordinateOrigin:A,geospatialOrigin:v}=t7(t,r,i),w=t.getDistanceScales(),C=[t.width*e,t.height*e],I=uA([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,B={project_uCoordinateSystem:r,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:A,project_uCommonOrigin:s.slice(0,3),project_uCenter:n,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:C,project_uDevicePixelRatio:e,project_uFocalDistance:I,project_uCommonUnitsPerMeter:w.unitsPerMeter,project_uCommonUnitsPerWorldUnit:w.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Qz,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:o,project_uModelMatrix:mB,project_uCameraPosition:f};if(v){const F=t.getDistanceScales(v);switch(r){case br.METER_OFFSETS:B.project_uCommonUnitsPerWorldUnit=F.unitsPerMeter,B.project_uCommonUnitsPerWorldUnit2=F.unitsPerMeter2;break;case br.LNGLAT:case br.LNGLAT_OFFSETS:t._pseudoMeters||(B.project_uCommonUnitsPerMeter=F.unitsPerMeter),B.project_uCommonUnitsPerWorldUnit=F.unitsPerDegree,B.project_uCommonUnitsPerWorldUnit2=F.unitsPerDegree2;break;case br.CARTESIAN:B.project_uCommonUnitsPerWorldUnit=[1,1,F.unitsPerMeter[2]],B.project_uCommonUnitsPerWorldUnit2=[0,0,F.unitsPerMeter2[2]];break}}return B}const n7={};function s7(t=n7){return"viewport"in t?r7(t):{}}const F2={name:"project",dependencies:[r9,Xz],vs:Kz,getUniforms:s7},o7=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,uo={name:"project32",dependencies:[F2],vs:o7};function a7(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Fd(t,e){const r=uA([],e,t);return B2(r,r,1/r[3]),r}function pS(t,e){const r=t%e;return r<0?e+r:r}function q1(t,e,r){return t<e?e:t>r?r:t}function l7(t){return Math.log(t)*Math.LOG2E}const L2=Math.log2||l7;function Mc(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ka=Math.PI,vB=Ka/4,Pa=Ka/180,$1=180/Ka,$d=512,Rm=4003e4,fg=85.051129,c7=1.5;function u7(t){return L2(t)}function Rc(t){const[e,r]=t;Mc(Number.isFinite(e)),Mc(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const i=e*Pa,n=r*Pa,o=$d*(i+Ka)/(2*Ka),s=$d*(Ka+Math.log(Math.tan(vB+n*.5)))/(2*Ka);return[o,s]}function Gl(t){const[e,r]=t,i=e/$d*(2*Ka)-Ka,n=2*(Math.atan(Math.exp(r/$d*(2*Ka)-Ka))-vB);return[i*$1,n*$1]}function h7(t){const{latitude:e}=t;Mc(Number.isFinite(e));const r=Math.cos(e*Pa);return u7(Rm*r)-9}function lv(t){const e=Math.cos(t*Pa);return $d/Rm/e}function Z1(t){const{latitude:e,longitude:r,highPrecision:i=!1}=t;Mc(Number.isFinite(e)&&Number.isFinite(r));const n=$d,o=Math.cos(e*Pa),s=n/360,f=s/o,A=n/Rm/o,v={unitsPerMeter:[A,A,A],metersPerUnit:[1/A,1/A,1/A],unitsPerDegree:[s,f,A],degreesPerUnit:[1/s,1/f,1/A]};if(i){const w=Pa*Math.tan(e*Pa)/o,C=s*w/2,I=n/Rm*w,B=I/f*A;v.unitsPerDegree2=[0,C,I],v.unitsPerMeter2=[B,0,B]}return v}function bB(t,e){const[r,i,n]=t,[o,s,f]=e,{unitsPerMeter:A,unitsPerMeter2:v}=Z1({longitude:r,latitude:i,highPrecision:!0}),w=Rc(t);w[0]+=o*(A[0]+v[0]*s),w[1]+=s*(A[1]+v[1]*s);const C=Gl(w),I=(n||0)+(f||0);return Number.isFinite(n)||Number.isFinite(f)?[C[0],C[1],I]:C}function f7(t){const{height:e,pitch:r,bearing:i,altitude:n,scale:o,center:s}=t,f=a7();Mm(f,f,[0,0,-n]),oB(f,f,-r*Pa),aB(f,f,i*Pa);const A=o/e;return R2(f,f,[A,A,A]),s&&Mm(f,f,M9([],s)),f}function d7(t){const{width:e,height:r,altitude:i,pitch:n=0,offset:o,center:s,scale:f,nearZMultiplier:A=1,farZMultiplier:v=1}=t;let{fovy:w=Bm(c7)}=t;i!==void 0&&(w=Bm(i));const C=w*Pa,I=n*Pa,B=xB(w);let F=B;s&&(F+=s[2]*f/Math.cos(I)/r);const N=C*(.5+(o?o[1]:0)/r),V=Math.sin(N)*F/Math.sin(q1(Math.PI/2-I-N,.01,Math.PI-.01)),G=Math.sin(I)*V+F,Y=F*10,Z=Math.min(G*v,Y);return{fov:C,aspect:e/r,focalDistance:B,near:A,far:Z}}function Bm(t){return 2*Math.atan(.5/t)*$1}function xB(t){return .5/Math.tan(.5*t*Pa)}function wB(t,e){const[r,i,n=0]=t;return Mc(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),Fd(e,[r,i,n,1])}function k2(t,e,r=0){const[i,n,o]=t;if(Mc(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return Fd(e,[i,n,o,1]);const s=Fd(e,[i,n,0,1]),f=Fd(e,[i,n,1,1]),A=s[2],v=f[2],w=A===v?0:((r||0)-A)/(v-A);return qR([],s,f,w)}function A7(t){const{width:e,height:r,bounds:i,minExtent:n=0,maxZoom:o=24,offset:s=[0,0]}=t,[[f,A],[v,w]]=i,C=p7(t.padding),I=Rc([f,q1(w,-fg,fg)]),B=Rc([v,q1(A,-fg,fg)]),F=[Math.max(Math.abs(B[0]-I[0]),n),Math.max(Math.abs(B[1]-I[1]),n)],N=[e-C.left-C.right-Math.abs(s[0])*2,r-C.top-C.bottom-Math.abs(s[1])*2];Mc(N[0]>0&&N[1]>0);const V=N[0]/F[0],G=N[1]/F[1],Y=(C.right-C.left)/2/V,Z=(C.top-C.bottom)/2/G,se=[(B[0]+I[0])/2+Y,(B[1]+I[1])/2+Z],ge=Gl(se),Pe=Math.min(o,L2(Math.abs(Math.min(V,G))));return Mc(Number.isFinite(Pe)),{longitude:ge[0],latitude:ge[1],zoom:Pe}}function p7(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Mc(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const gS=Math.PI/180;function g7(t,e=0){const{width:r,height:i,unproject:n}=t,o={targetZ:e},s=n([0,i],o),f=n([r,i],o);let A,v;const w=t.fovy?.5*t.fovy*gS:Math.atan(.5/t.altitude),C=(90-t.pitch)*gS;return w>C-.01?(A=mS(t,0,e),v=mS(t,r,e)):(A=n([0,0],o),v=n([r,0],o)),[s,f,v,A]}function mS(t,e,r){const{pixelUnprojectionMatrix:i}=t,n=Fd(i,[e,0,1,1]),o=Fd(i,[e,t.height,1,1]),f=(r*t.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),A=qR([],n,o,f),v=Gl(A);return v.push(r),v}const _S=512;function m7(t){const{width:e,height:r,pitch:i=0}=t;let{longitude:n,latitude:o,zoom:s,bearing:f=0}=t;(n<-180||n>180)&&(n=pS(n+180,360)-180),(f<-180||f>180)&&(f=pS(f+180,360)-180);const A=L2(r/_S);if(s<=A)s=A,o=0;else{const v=r/2/Math.pow(2,s),w=Gl([0,v])[1];if(o<w)o=w;else{const C=Gl([0,_S-v])[1];o>C&&(o=C)}}return{width:e,height:r,longitude:n,latitude:o,zoom:s,pitch:i,bearing:f}}const _7=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,y7=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,v7=a0(E7),b7=a0(S7),x7=[0,0,0,1],w7=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function T7(t,e){const[r,i,n]=t,o=k2([r,i,n],e);return Number.isFinite(n)?o:[o[0],o[1],0]}function E7({viewport:t,center:e}){return new Gr(t.viewProjectionMatrix).invert().transform(e)}function S7({viewport:t,shadowMatrices:e}){const r=[],i=t.pixelUnprojectionMatrix,n=t.isGeospatial?void 0:1,o=[[0,0,n],[t.width,0,n],[0,t.height,n],[t.width,t.height,n],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(s=>T7(s,i));for(const s of e){const f=s.clone().translate(new Ke(t.center).negate()),A=o.map(w=>f.transform(w)),v=new Gr().ortho({left:Math.min(...A.map(w=>w[0])),right:Math.max(...A.map(w=>w[0])),bottom:Math.min(...A.map(w=>w[1])),top:Math.max(...A.map(w=>w[1])),near:Math.min(...A.map(w=>-w[2])),far:Math.max(...A.map(w=>-w[2]))});r.push(v.multiplyRight(s))}return r}function C7(t,e){const{shadowEnabled:r=!0}=t;if(!r||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||x7,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},n=v7({viewport:t.viewport,center:e.project_uCenter}),o=[],s=b7({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let f=0;f<t.shadowMatrices.length;f++){const A=s[f],v=A.clone().translate(new Ke(t.viewport.center).negate());e.project_uCoordinateSystem===br.LNGLAT&&e.project_uProjectionMode===Za.WEB_MERCATOR?(s[f]=v,o[f]=n):(s[f]=A.clone().multiplyRight(w7),o[f]=v.transform(n))}for(let f=0;f<s.length;f++)i[`shadow_uViewProjectionMatrices[${f}]`]=s[f],i[`shadow_uProjectCenters[${f}]`]=o[f];for(let f=0;f<2;f++)i[`shadow_uShadowMap${f}`]=t.shadowMaps&&t.shadowMaps[f]||t.dummyShadowMap;return i}const yS={name:"shadow",dependencies:[F2],vs:_7,fs:y7,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?C7(t,e):{}},Mo={...sS,defaultUniforms:{...sS.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},P7=[F2],I7=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function TB(){const t=bm.getDefaultShaderAssembler();for(const e of P7)t.addDefaultModule(e);for(const e of I7)t.addShaderHook(e);return t}const M7=[255,255,255],R7=1;let B7=0;class O7{constructor(e={}){this.type="ambient";const{color:r=M7}=e,{intensity:i=R7}=e;this.id=e.id||`ambient-${B7++}`,this.color=r,this.intensity=i}}const D7=[255,255,255],F7=1,L7=[0,0,-1];let k7=0;class vS{constructor(e={}){this.type="directional";const{color:r=D7}=e,{intensity:i=F7}=e,{direction:n=L7}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${k7++}`,this.color=r,this.intensity=i,this.type="directional",this.direction=new Ke(n).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class EB{constructor(e,r={id:"pass"}){const{id:i}=r;this.id=i,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class N2 extends EB{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[r,i]=this.device.canvasContext.getDrawingBufferSize(),n=e.clearCanvas??!0,o=e.clearColor??(n?[0,0,0,0]:!1),s=n?1:!1,f=n?0:!1,A=e.colorMask??15,v={viewport:[0,0,r,i]};e.colorMask&&(v.colorMask=A),e.scissorRect&&(v.scissorRect=e.scissorRect);const w=this.device.beginRenderPass({framebuffer:e.target,parameters:v,clearColor:o,clearDepth:s,clearStencil:f});try{return this._drawLayers(w,e)}finally{w.end()}}_drawLayers(e,r){const{target:i,moduleParameters:n,viewports:o,views:s,onViewportActive:f,clearStack:A=!0}=r;r.pass=r.pass||"unknown",A&&(this._lastRenderIndex=-1);const v=[];for(const w of o){const C=s&&s[w.id];f==null||f(w);const I=this._getDrawLayerParams(w,r),B=w.subViewports||[w];for(const F of B){const N=this._drawLayersInViewport(e,{target:i,moduleParameters:n,viewport:F,view:C,pass:r.pass,layers:r.layers},I);v.push(N)}}return v}_getDrawLayerParams(e,{layers:r,pass:i,isPicking:n=!1,layerFilter:o,cullRect:s,effects:f,moduleParameters:A},v=!1){var F;const w=[],C=SB(this._lastRenderIndex+1),I={layer:r[0],viewport:e,isPicking:n,renderPass:i,cullRect:s},B={};for(let N=0;N<r.length;N++){const V=r[N],G=this._shouldDrawLayer(V,I,o,B),Y={shouldDrawLayer:G};G&&!v&&(Y.layerRenderIndex=C(V,G),Y.moduleParameters=this._getModuleParameters(V,f,i,A),Y.layerParameters={...(F=V.context.deck)==null?void 0:F.props.parameters,...this.getLayerParameters(V,N,e)}),w[N]=Y}return w}_drawLayersInViewport(e,{layers:r,moduleParameters:i,pass:n,target:o,viewport:s,view:f},A){const v=N7(this.device,{moduleParameters:i,target:o,viewport:s});if(f&&f.props.clear){const C=f.props.clear===!0?{color:!0,depth:!0}:f.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:v},()=>this.device.clearWebGL(C))}const w={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:v});for(let C=0;C<r.length;C++){const I=r[C],{shouldDrawLayer:B,layerRenderIndex:F,moduleParameters:N,layerParameters:V}=A[C];if(B&&I.props.pickable&&w.pickableCount++,I.isComposite)w.compositeCount++;else if(B){w.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,F),N.viewport=s,I.context.renderPass=e;try{I._drawLayer({renderPass:e,moduleParameters:N,uniforms:{layerIndex:F},parameters:V})}catch(G){I.raiseError(G,`drawing ${I} to ${n}`)}}}return w}shouldDrawLayer(e){return!0}getModuleParameters(e,r){return null}getLayerParameters(e,r,i){return e.props.parameters}_shouldDrawLayer(e,r,i,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let s=e.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(r))return!1;r.layer=s,s=s.parent}if(i){const f=r.layer.id;if(f in n||(n[f]=i(r)),!n[f])return!1}return e.activateViewport(r.viewport),!0}_getModuleParameters(e,r,i,n){var f,A;const o=this.device.canvasContext.cssToDeviceRatio(),s=Object.assign(Object.create(((f=e.internalState)==null?void 0:f.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:o});if(r)for(const v of r)Object.assign(s,(A=v.getModuleParameters)==null?void 0:A.call(v,e));return Object.assign(s,this.getModuleParameters(e,r),n)}}function SB(t=0,e={}){const r={},i=(n,o)=>{const s=n.props._offset,f=n.id,A=n.parent&&n.parent.id;let v;if(A&&!(A in e)&&i(n.parent,!1),A in r){const w=r[A]=r[A]||SB(e[A],e);v=w(n,o),r[f]=w}else Number.isFinite(s)?(v=s+(e[A]||0),r[f]=null):v=t;return o&&v>=t&&(t=v+1),e[f]=v,v};return i}function N7(t,{moduleParameters:e,target:r,viewport:i}){const n=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,o]=t.canvasContext.getDrawingBufferSize(),s=r?r.height:o,f=i;return[f.x*n,s-(f.y+f.height)*n,f.width*n,f.height*n]}class U7 extends N2{constructor(e,r){super(e,r),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const r=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),n=e.viewports[0],o=n.width*i,s=n.height*i,f=[1,1,1,1];(o!==r.width||s!==r.height)&&r.resize({width:o,height:s}),super.render({...e,clearColor:f,target:r,pass:"shadow"})}getLayerParameters(e,r,i){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const z7={color:[255,255,255],intensity:1},bS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],V7=[0,0,0,200/255];class CB{constructor(e={}){this.id="lighting-effect",this.shadowColor=V7,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:r,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),i._addDefaultShaderModule(yS),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const r in e){const i=e[r];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:o,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const r=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return r.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},r}cleanup(e){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(yS))}_calculateMatrices(){const e=[];for(const r of this.directionalLights){const i=new Gr().lookAt({eye:new Ke(r.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){const i=new U7(e);this.shadowPasses[r]=i,this.shadowMaps[r]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:r,directionalLights:i}=this;!e&&r.length===0&&i.length===0&&(this.ambientLight=new O7(z7),this.directionalLights.push(new vS(bS[0]),new vS(bS[1])))}}class j7{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:i=1,type:n,padding:o=0,copy:s=!1,initialize:f=!1,maxCount:A}){const v=n||e&&e.constructor||Float32Array,w=r*i+o;if(ArrayBuffer.isView(e)){if(w<=e.length)return e;if(w*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new v(e.buffer,0,w)}let C=1/0;A&&(C=A*i+o);const I=this._allocate(v,w,f,C);return e&&s?I.set(e):f||I.fill(0,0,4),this._release(e),I}release(e){this._release(e)}_allocate(e,r,i,n){let o=Math.max(Math.ceil(r*this.opts.overAlloc),1);o>n&&(o=n);const s=this._pool,f=e.BYTES_PER_ELEMENT*o,A=s.findIndex(v=>v.byteLength>=f);if(A>=0){const v=new e(s.splice(A,1)[0],0,o);return i&&v.fill(0),v}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const r=this._pool,{buffer:i}=e,{byteLength:n}=i,o=r.findIndex(s=>s.byteLength>=n);o<0?r.push(i):(o>0||r.length<this.opts.poolSize)&&r.splice(o,0,i),r.length>this.opts.poolSize&&r.shift()}}const Zd=new j7;function fp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function H7(t){return[t[12],t[13],t[14]]}function G7(t){return{left:Zf(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Zf(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Zf(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Zf(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Zf(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Zf(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const xS=new Ke;function Zf(t,e,r,i){xS.set(t,e,r);const n=xS.len();return{distance:i/n,normal:new Ke(-t/n,-e/n,-r/n)}}function dp(t){return t-Math.fround(t)}let $A;function cv(t,e){const{size:r=1,startIndex:i=0}=e,n=e.endIndex!==void 0?e.endIndex:t.length,o=(n-i)/r;$A=Zd.allocate($A,o,{type:Float32Array,size:r*2});let s=i,f=0;for(;s<n;){for(let A=0;A<r;A++){const v=t[s++];$A[f+A]=v,$A[f+A+r]=dp(v)}f+=r*2}return $A.subarray(0,o*r*2)}function W7(t){let e=null,r=!1;for(const i of t)i&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const X7=Math.PI/180,q7=fp(),wS=[0,0,0],$7={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Z7({width:t,height:e,orthographic:r,fovyRadians:i,focalDistance:n,padding:o,near:s,far:f}){const A=t/e,v=r?new Gr().orthographic({fovy:i,aspect:A,focalDistance:n,near:s,far:f}):new Gr().perspective({fovy:i,aspect:A,near:s,far:f});if(o){const{left:w=0,right:C=0,top:I=0,bottom:B=0}=o,F=Tc((w+t-C)/2,0,t)-t/2,N=Tc((I+e-B)/2,0,e)-e/2;v[8]-=F*2/t,v[9]+=N*2/e}return v}class hA{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||$7,this.focalDistance=e.focalDistance||1,this.position=e.position||wS,this.modelMatrix=e.modelMatrix||null;const{longitude:r,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Za.WEB_MERCATOR:Za.WEB_MERCATOR_AUTO_OFFSET:Za.IDENTITY}equals(e){return e instanceof hA?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ca(e.projectionMatrix,this.projectionMatrix)&&Ca(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){const i=this.projectPosition(e),n=wB(i,this.pixelProjectionMatrix),[o,s]=n,f=r?s:this.height-s;return e.length===2?[o,f]:[o,f,n[2]]}unproject(e,{topLeft:r=!0,targetZ:i}={}){const[n,o,s]=e,f=r?o:this.height-o,A=i&&i*this.distanceScales.unitsPerMeter[2],v=k2([n,f,s],this.pixelUnprojectionMatrix,A),[w,C,I]=this.unprojectPosition(v);return Number.isFinite(s)?[w,C,I]:Number.isFinite(i)?[w,C,i]:[w,C]}projectPosition(e){const[r,i]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,i,n]}unprojectPosition(e){const[r,i]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,i,n]}projectFlat(e){if(this.isGeospatial){const r=Rc(e);return r[1]=Tc(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?Gl(e):e}getBounds(e={}){const r={targetZ:e.z||0},i=this.unproject([0,0],r),n=this.unproject([this.width,0],r),o=this.unproject([0,this.height],r),s=this.unproject([this.width,this.height],r);return[Math.min(i[0],n[0],o[0],s[0]),Math.min(i[1],n[1],o[1],s[1]),Math.max(i[0],n[0],o[0],s[0]),Math.max(i[1],n[1],o[1],s[1])]}getDistanceScales(e){return e?Z1({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:i=1,height:n=1}){return e<this.x+this.width&&this.x<e+i&&r<this.y+this.height&&this.y<r+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,G7(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){const r=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=h7({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Z1({latitude:i,longitude:r}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:o,modelMatrix:s}=e;let f=wS;if(o&&(f=s?new Gr(s).transformAsVector(o,[]):o),this.isGeospatial){const A=this.projectPosition([r,i,0]);this.center=new Ke(f).scale(this.distanceScales.unitsPerMeter).add(A)}else this.center=this.projectPosition(f)}_initMatrices(e){const{viewMatrix:r=q7,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:o,fovy:s=75,near:f=.1,far:A=1e3,padding:v=null,focalDistance:w=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new Gr().multiplyRight(r).translate(new Ke(this.center).negate()),this.projectionMatrix=i||Z7({width:this.width,height:this.height,orthographic:n,fovyRadians:o||s*X7,focalDistance:w,padding:v,near:f,far:A});const C=fp();Bh(C,C,this.projectionMatrix),Bh(C,C,this.viewMatrix),this.viewProjectionMatrix=C,this.viewMatrixInverse=G1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=H7(this.viewMatrixInverse);const I=fp(),B=fp();R2(I,I,[this.width/2,-this.height/2,1]),Mm(I,I,[1,-1,0]),Bh(B,I,this.viewProjectionMatrix),this.pixelProjectionMatrix=B,this.pixelUnprojectionMatrix=G1(fp(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||fr.warn("Pixel project matrix not invertible")()}}hA.displayName="Viewport";let zp=class K1 extends hA{constructor(e={}){const{latitude:r=0,longitude:i=0,zoom:n=0,pitch:o=0,bearing:s=0,nearZMultiplier:f=.1,farZMultiplier:A=1.01,nearZ:v,farZ:w,orthographic:C=!1,projectionMatrix:I,repeat:B=!1,worldOffset:F=0,position:N,padding:V,legacyMeterSizes:G=!1}=e;let{width:Y,height:Z,altitude:se=1.5}=e;const ge=Math.pow(2,n);Y=Y||1,Z=Z||1;let Pe,Ue=null;if(I)se=I[5]/2,Pe=Bm(se);else{e.fovy?(Pe=e.fovy,se=xB(Pe)):Pe=Bm(se);let pe;if(V){const{top:Te=0,bottom:Ae=0}=V;pe=[0,Tc((Te+Z-Ae)/2,0,Z)-Z/2]}Ue=d7({width:Y,height:Z,scale:ge,center:N&&[0,0,N[2]*lv(r)],offset:pe,pitch:o,fovy:Pe,nearZMultiplier:f,farZMultiplier:A}),Number.isFinite(v)&&(Ue.near=v),Number.isFinite(w)&&(Ue.far=w)}let Fe=f7({height:Z,pitch:o,bearing:s,scale:ge,altitude:se});F&&(Fe=new Gr().translate([512*F,0,0]).multiplyLeft(Fe)),super({...e,width:Y,height:Z,viewMatrix:Fe,longitude:i,latitude:r,zoom:n,...Ue,fovy:Pe,focalDistance:se}),this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=o,this.bearing=s,this.altitude=se,this.fovy=Pe,this.orthographic=C,this._subViewports=B?[]:null,this._pseudoMeters=G,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),r=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let n=r;n<=i;n++){const o=n?new K1({...this,worldOffset:n}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[r,i]=this.projectFlat(e),n=(e[2]||0)*lv(e[1]);return[r,i,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[r,i]=this.unprojectFlat(e),n=(e[2]||0)/lv(i);return[r,i,n]}addMetersToLngLat(e,r){return bB(e,r)}panByPosition(e,r){const i=k2(r,this.pixelUnprojectionMatrix),n=this.projectFlat(e),o=oS([],n,w9([],i)),s=oS([],this.center,o),[f,A]=this.unprojectFlat(s);return{longitude:f,latitude:A}}getBounds(e={}){const r=g7(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){const{width:i,height:n}=this,{longitude:o,latitude:s,zoom:f}=A7({width:i,height:n,bounds:e,...r});return new K1({width:i,height:n,longitude:o,latitude:s,zoom:f})}};zp.displayName="WebMercatorViewport";const TS=[0,0,0];function uv(t,e,r=!1){const i=e.projectPosition(t);if(r&&e instanceof zp){const[n,o,s=0]=t,f=e.getDistanceScales([n,o]);i[2]=s*f.unitsPerMeter[2]}return i}function K7(t){const{viewport:e,modelMatrix:r,coordinateOrigin:i}=t;let{coordinateSystem:n,fromCoordinateSystem:o,fromCoordinateOrigin:s}=t;return n===br.DEFAULT&&(n=e.isGeospatial?br.LNGLAT:br.CARTESIAN),o===void 0&&(o=n),s===void 0&&(s=i),{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}}function PB(t,{viewport:e,modelMatrix:r,coordinateSystem:i,coordinateOrigin:n,offsetMode:o}){let[s,f,A=0]=t;switch(r&&([s,f,A]=uA([],[s,f,A,1],r)),i){case br.LNGLAT:return uv([s,f,A],e,o);case br.LNGLAT_OFFSETS:return uv([s+n[0],f+n[1],A+(n[2]||0)],e,o);case br.METER_OFFSETS:return uv(bB(n,[s,f,A]),e,o);case br.CARTESIAN:default:return e.isGeospatial?[s+n[0],f+n[1],A+n[2]]:e.projectPosition([s,f,A])}}function Y7(t,e){const{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:f}=K7(e),{autoOffset:A=!0}=e,{geospatialOrigin:v=TS,shaderCoordinateOrigin:w=TS,offsetMode:C=!1}=A?yB(r,i,n):{},I=PB(t,{viewport:r,modelMatrix:o,coordinateSystem:s,coordinateOrigin:f,offsetMode:C});if(C){const B=r.projectPosition(v||w);iB(I,I,B)}return I}let J7=1,Q7=1;class IB{constructor(){U(this,"time",0);U(this,"channels",new Map);U(this,"animations",new Map);U(this,"playing",!1);U(this,"lastEngineTime",-1)}addChannel(e){const{delay:r=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:o=1}=e,s=J7++,f={time:0,delay:r,duration:i,rate:n,repeat:o};return this._setChannelTime(f,this.time),this.channels.set(s,f),s}removeChannel(e){this.channels.delete(e);for(const[r,i]of this.animations)i.channel===e&&this.detachAnimation(r)}isFinished(e){const r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;const r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);const r=this.channels.values();for(const n of r)this._setChannelTime(n,this.time);const i=this.animations.values();for(const n of i){const{animation:o,channel:s}=n;o.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){const i=Q7++;return this.animations.set(i,{animation:e,channel:r}),e.setTime(this.getTime(r)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){const i=r-e.delay,n=e.duration*e.repeat;i>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}let eV=0;const tV={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Od.stats.get(`animation-loop-${eV++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class rV{constructor(e){U(this,"device",null);U(this,"canvas",null);U(this,"props");U(this,"animationProps",null);U(this,"timeline",null);U(this,"stats");U(this,"cpuTime");U(this,"gpuTime");U(this,"frameRate");U(this,"display");U(this,"needsRedraw","initialized");U(this,"_initialized",!1);U(this,"_running",!1);U(this,"_animationFrameId",null);U(this,"_nextFramePromise",null);U(this,"_resolveNextFrame",null);U(this,"_cpuStartTime",0);if(this.props={...tV,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new cA({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=pU(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(gU(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,r;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(r=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:r.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:r,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);const i=this.props.onAddHTML(r);i&&(r.innerHTML=i)}}_getSizeAndAspect(){var o,s,f,A;if(!this.device)return{width:1,height:1,aspect:1};const[e,r]=((s=(o=this.device)==null?void 0:o.canvasContext)==null?void 0:s.getPixelSize())||[1,1];let i=1;const n=(A=(f=this.device)==null?void 0:f.canvasContext)==null?void 0:A.canvas;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:e>0&&r>0&&(i=e/r),{width:e,height:r,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,r;this.props.autoResizeDrawingBuffer&&((r=(e=this.device)==null?void 0:e.canvasContext)==null||r.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class ES{constructor(e){U(this,"id");U(this,"userData",{});U(this,"topology");U(this,"bufferLayout",[]);U(this,"vertexCount");U(this,"indices");U(this,"attributes");this.id=e.id||Oc("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&_i(this.indices.usage===In.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const r of Object.values(this.attributes))r.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function iV(t,e){if(e instanceof ES)return e;const r=nV(t,e),{attributes:i,bufferLayout:n}=sV(t,e);return new ES({topology:e.topology||"triangle-list",bufferLayout:n,vertexCount:e.vertexCount,indices:r,attributes:i})}function nV(t,e){if(!e.indices)return;const r=e.indices.value;return t.createBuffer({usage:In.INDEX,data:r})}function sV(t,e){const r=[],i={};for(const[o,s]of Object.entries(e.attributes)){let f=o;switch(o){case"POSITION":f="positions";break;case"NORMAL":f="normals";break;case"TEXCOORD_0":f="texCoords";break;case"COLOR_0":f="colors";break}i[f]=t.createBuffer({data:s.value,id:`${o}-buffer`});const{value:A,size:v,normalized:w}=s;r.push({name:f,format:uU(A,v,w)})}const n=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:r,vertexCount:n}}class oV{constructor(e){U(this,"modules");U(this,"moduleUniforms");U(this,"moduleBindings");U(this,"moduleUniformsChanged");const r=x_(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;Et.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,n]of Object.entries(e)){const o=i;this.moduleUniforms[o]=n.defaultUniforms||{},this.moduleBindings[o]={}}}destroy(){}setProps(e){var r;for(const i of Object.keys(e)){const n=i,o=e[n],s=this.modules[n];if(!s){Et.warn(`Module ${i} not found`)();continue}const f=this.moduleUniforms[n],A=this.moduleBindings[n],v=((r=s.getUniforms)==null?void 0:r.call(s,o,f))||o,{uniforms:w,bindings:C}=w2(v);this.moduleUniforms[n]={...f,...w},this.moduleBindings[n]={...A,...C}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){var r;const e={};for(const[i,n]of Object.entries(this.moduleUniforms))for(const[o,s]of Object.entries(n))e[`${i}.${o}`]={type:(r=this.modules[i].uniformTypes)==null?void 0:r[o],value:String(s)};return e}}const m_=class m_{constructor(e){U(this,"device");U(this,"_hashCounter",0);U(this,"_hashes",{});U(this,"_renderPipelineCache",{});U(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new m_(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const r={...Xd.defaultProps,...e},i=this._hashRenderPipeline(r);if(!this._renderPipelineCache[i]){const n=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._renderPipelineCache[i]={pipeline:n,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const r={...Cm.defaultProps,...e},i=this._hashComputePipeline(r);if(!this._computePipelineCache[i]){const n=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._computePipelineCache[i]={pipeline:n,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const r=e.hash,i=e instanceof Cm?this._computePipelineCache:this._renderPipelineCache;i[r].useCount--,i[r].useCount===0&&(i[r].pipeline.destroy(),delete i[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const r=this._getHash(e.vs.source),i=e.fs?this._getHash(e.fs.source):0,n="-",o=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${i}V${n}BL${o}`;default:const s=this._getHash(JSON.stringify(e.parameters));return`${r}/${i}V${n}T${e.topology}P${s}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};U(m_,"defaultProps",{...Xd.defaultProps});let Y1=m_;const __=class __{constructor(e){U(this,"device");U(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var r;return(r=e._lumaData).defaultShaderFactory||(r.defaultShaderFactory=new __(e)),e._lumaData.defaultShaderFactory}createShader(e){const r=this._hashShader(e);let i=this._cache[r];if(!i){const n=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=i={shader:n,useCount:0}}return i.useCount++,i.shader}release(e){const r=this._hashShader(e),i=this._cache[r];i&&(i.useCount--,i.useCount===0&&(delete this._cache[r],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};U(__,"defaultProps",{...Tm.defaultProps});let J1=__;function aV(t,e){var n;const r={},i="Values";if(t.attributes.length===0&&!((n=t.varyings)!=null&&n.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const o of t.attributes)if(o){const s=`${o.location} ${o.name}: ${o.type}`;r[`in ${s}`]={[i]:o.stepMode||"vertex"}}for(const o of t.varyings||[]){const s=`${o.location} ${o.name}`;r[`out ${s}`]={[i]:JSON.stringify(o.accessor)}}return r}let gs=null,hv=null;function lV(t,{id:e,minimap:r,opaque:i,top:n="0",left:o="0",rgbaScale:s=1}){gs||(gs=document.createElement("canvas"),gs.id=e,gs.title=e,gs.style.zIndex="100",gs.style.position="absolute",gs.style.top=n,gs.style.left=o,gs.style.border="blue 1px solid",gs.style.transform="scaleY(-1)",document.body.appendChild(gs),hv=gs.getContext("2d")),(gs.width!==t.width||gs.height!==t.height)&&(gs.width=t.width/2,gs.height=t.height/2,gs.style.width="400px",gs.style.height="400px");const f=t.device.readPixelsToArrayWebGL(t),A=hv.createImageData(t.width,t.height),v=0;for(let w=0;w<f.length;w+=4)A.data[v+w+0]=f[w+0]*s,A.data[v+w+1]=f[w+1]*s,A.data[v+w+2]=f[w+2]*s,A.data[v+w+3]=i?255:f[w+3]*s;hv.putImageData(A,0,0)}const Kf=2,cV=1e4,y_=class y_{constructor(e,r){U(this,"device");U(this,"id");U(this,"source");U(this,"vs");U(this,"fs");U(this,"pipelineFactory");U(this,"shaderFactory");U(this,"userData",{});U(this,"parameters");U(this,"topology");U(this,"bufferLayout");U(this,"isInstanced");U(this,"instanceCount",0);U(this,"vertexCount");U(this,"indexBuffer",null);U(this,"bufferAttributes",{});U(this,"constantAttributes",{});U(this,"bindings",{});U(this,"uniforms",{});U(this,"vertexArray");U(this,"transformFeedback",null);U(this,"pipeline");U(this,"shaderInputs");U(this,"_uniformStore");U(this,"_attributeInfos",{});U(this,"_gpuGeometry",null);U(this,"_getModuleUniforms");U(this,"props");U(this,"_pipelineNeedsUpdate","newly created");U(this,"_needsRedraw","initializing");U(this,"_destroyed",!1);U(this,"_lastDrawTimestamp",-1);U(this,"_lastLogTime",0);U(this,"_logOpen",!1);U(this,"_drawCount",0);var f,A,v,w;this.props={...y_.defaultProps,...r},r=this.props,this.id=r.id||Oc("model"),this.device=e,Object.assign(this.userData,r.userData);const i=Object.fromEntries(((f=this.props.modules)==null?void 0:f.map(C=>[C.name,C]))||[]);this.setShaderInputs(r.shaderInputs||new oV(i));const n=uV(e),o=(((A=this.props.modules)==null?void 0:A.length)>0?this.props.modules:(v=this.shaderInputs)==null?void 0:v.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(w=this.props).shaderLayout||(w.shaderLayout=QU(this.props.source));const{source:C,getUniforms:I}=this.props.shaderAssembler.assembleShader({platformInfo:n,...this.props,modules:o});this.source=C,this._getModuleUniforms=I}else{const{vs:C,fs:I,getUniforms:B}=this.props.shaderAssembler.assembleShaderPair({platformInfo:n,...this.props,modules:o});this.vs=C,this.fs=I,this._getModuleUniforms=B}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||Y1.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||J1.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniforms(r.uniforms),r.moduleSettings&&this.updateModuleSettings(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let r;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),xm(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,n=i?i.byteLength/(i.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var i;(i=this._gpuGeometry)==null||i.destroy();const r=e&&iV(this.device,e);r&&(this.setTopology(r.topology||"triangle-list"),this.bufferLayout=SS(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)),this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?SS(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){U1(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new cU(this.shaderInputs.modules);for(const r of Object.keys(this.shaderInputs.modules)){const i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){e.indices&&Et.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[i,n]of Object.entries(e)){const o=this.bufferLayout.find(A=>CS(A).includes(i));if(!o){Et.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}const s=CS(o);let f=!1;for(const A of s){const v=this._attributeInfos[A];v&&(this.vertexArray.setBuffer(v.location,n),f=!0)}!f&&!((r==null?void 0:r.disableWarnings)??this.props.disableWarnings)&&Et.warn(`Model(${this.id}): Ignoring buffer "${n.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(const[i,n]of Object.entries(e)){const o=this._attributeInfos[i];o?this.vertexArray.setConstantWebGL(o.location,n):((r==null?void 0:r.disableWarnings)??this.props.disableWarnings)||Et.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){xm(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:r,uniforms:i}=w2(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const r of Object.values(this.bindings))r instanceof wm?e=Math.max(e,r.texture.updateTimestamp):r instanceof In||r instanceof Zo?e=Math.max(e,r.updateTimestamp):r instanceof Em||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const r={...e.attributes};for(const[i]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(n=>n.name===i)&&i!=="positions"&&delete r[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(Et.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let n=null;this.source?n=i:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:i,fs:n}),this._attributeInfos=OR(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_logDrawCallStart(){const e=Et.level>3?0:cV;Et.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Et.group(Kf,`>>> DRAWING MODEL ${this.id}`,{collapsed:Et.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=aV(this.pipeline.shaderLayout,this.id);Et.table(Kf,e)();const r=this.shaderInputs.getDebugTable();for(const[n,o]of Object.entries(this.uniforms))r[n]={value:o};Et.table(Kf,r)();const i=this._getAttributeDebugTable();Et.table(Kf,this._attributeInfos)(),Et.table(Kf,i)(),Et.groupEnd(Kf)(),this._logOpen=!1}}_logFramebuffer(e){const r=Et.get("framebuffer");if(this._drawCount++,!r||this._drawCount++>3&&this._drawCount%60)return;const i=e.props.framebuffer;i&&lV(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[r,i]of Object.entries(this._attributeInfos))e[i.location]={name:r,type:i.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[i.location],i.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,i=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,r){const i=LR(r);return(e instanceof In?new i(e.debugData):e).toString()}};U(y_,"defaultProps",{...Xd.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:bm.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let zi=y_;function SS(t,e){const r=[...t];for(const i of e){const n=r.findIndex(o=>o.name===i.name);n<0?r.push(i):r[n]=i}return r}function uV(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function CS(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(r=>r.attribute):[t.name]}class Vp{constructor(e,r=zi.defaultProps){U(this,"device");U(this,"model");U(this,"transformFeedback");_i(Vp.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new zi(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||CR(),topology:r.topology||"point-list",...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var r;return((r=e==null?void 0:e.info)==null?void 0:r.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const r=this.getBuffer(e);if(r instanceof In)return r.readAsync();const{buffer:i,byteOffset:n=0,byteLength:o=i.byteLength}=r;return i.readAsync(n,o)}}const hV="transform_output";class Q1{constructor(e,r){U(this,"device");U(this,"model");U(this,"sampler");U(this,"currentIndex",0);U(this,"samplerTextureMap",null);U(this,"bindings",[]);U(this,"resources",{});this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new zi(this.device,{id:r.id||"texture-transform-model",fs:r.fs||CR({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:hV}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){}delete(){this.destroy()}run(e){const{framebuffer:r}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:r,...e});this.model.draw(i),i.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getData({packed:e=!1}={}){throw new Error("getData() not implemented")}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:r,sourceTextures:i,targetTexture:n}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),n){e.targetTexture=n;const{width:o,height:s}=n;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:s,colorAttachments:[n]}),e.framebuffer.resize({width:o,height:s})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:r}=this.bindings[e];for(const i in r)r[i].sampler=this.sampler}}class _s{constructor(e){U(this,"id");U(this,"topology");U(this,"vertexCount");U(this,"indices");U(this,"attributes");U(this,"userData",{});const{attributes:r={},indices:i=null,vertexCount:n=null}=e;this.id=e.id||Oc("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[o,s]of Object.entries(r)){const f=ArrayBuffer.isView(s)?{value:s}:s;_i(ArrayBuffer.isView(f.value),`${this._print(o)}: must be typed array or object with value as typed array`),(o==="POSITION"||o==="positions")&&!f.size&&(f.size=3),o==="indices"?(_i(!this.indices),this.indices=f):this.attributes[o]=f}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let i=1/0;for(const n of Object.values(e)){const{value:o,size:s,constant:f}=n;!f&&o&&s>=1&&(i=Math.min(i,o.length/s))}return _i(Number.isFinite(i)),i}}const fV=`#version 300 es
in vec2 aClipSpacePosition;
in vec2 aTexCoord;
in vec2 aCoordinate;
out vec2 position;
out vec2 coordinate;
out vec2 uv;
void main(void) {
gl_Position = vec4(aClipSpacePosition, 0., 1.);
position = aClipSpacePosition;
coordinate = aCoordinate;
uv = aTexCoord;
}
`,PS=[-1,-1,1,-1,-1,1,1,1];class dV extends zi{constructor(e,r){const i=PS.map(n=>n===-1?0:n);super(e,{...r,vs:fV,vertexCount:4,geometry:new _s({topology:"triangle-strip",vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(PS)},aTexCoord:{size:2,value:new Float32Array(i)},aCoordinate:{size:2,value:new Float32Array(i)}}})})}}class Om{constructor(e={}){U(this,"id");U(this,"matrix",new Gr);U(this,"display",!0);U(this,"position",new Ke);U(this,"rotation",new Ke);U(this,"scale",new Ke(1,1,1));U(this,"userData",{});U(this,"props",{});const{id:r}=e;this.id=r||Oc(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return _i(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return _i(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return _i(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,r=!0){r?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:r,rotation:i,scale:n,update:o=!0}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,r=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(r),this.matrix.scale(i),this}update(e={}){const{position:r,rotation:i,scale:n}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,r){_i(e),r=r||this.matrix;const i=new Gr(e).multiplyRight(r),n=i.invert(),o=n.transpose();return{viewMatrix:e,modelMatrix:r,objectMatrix:r,worldMatrix:i,worldInverseMatrix:n,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Ld extends Om{constructor(r={}){r=Array.isArray(r)?{children:r}:r;const{children:i=[]}=r;Et.assert(i.every(n=>n instanceof Om),"every child must an instance of ScenegraphNode");super(r);U(this,"children");this.children=i}getBounds(){const r=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((i,{worldMatrix:n})=>{const o=i.getBounds();if(!o)return;const[s,f]=o,A=new Ke(s).add(f).divide([2,2,2]);n.transformAsPoint(A,A);const v=new Ke(f).subtract(s).divide([2,2,2]);n.transformAsVector(v,v);for(let w=0;w<8;w++){const C=new Ke(w&1?-1:1,w&2?-1:1,w&4?-1:1).multiply(v).add(A);for(let I=0;I<3;I++)r[0][I]=Math.min(r[0][I],C[I]),r[1][I]=Math.max(r[1][I],C[I])}}),Number.isFinite(r[0][0])?r:null}destroy(){this.children.forEach(r=>r.destroy()),this.removeAll(),super.destroy()}add(...r){for(const i of r)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(r){const i=this.children,n=i.indexOf(r);return n>-1&&i.splice(n,1),this}removeAll(){return this.children=[],this}traverse(r,{worldMatrix:i=new Gr}={}){const n=new Gr(i).multiplyRight(this.matrix);for(const o of this.children)o instanceof Ld?o.traverse(r,{worldMatrix:n}):r(o,{worldMatrix:n})}}class eb extends Om{constructor(r){super(r);U(this,"model");U(this,"bounds",null);U(this,"managedResources");this.model=r.model,this.managedResources=r.managedResources||[],this.bounds=r.bounds||null,this.setProps(r)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(r=>r.destroy()),this.managedResources=[]}draw(r){return this.model.draw(r)}}class MB extends _s{constructor(e={}){const{id:r=Oc("cube-geometry"),indices:i=!0}=e;super(i?{...e,id:r,topology:"triangle-list",indices:{size:1,value:AV},attributes:{...bV,...e.attributes}}:{...e,id:r,topology:"triangle-list",indices:void 0,attributes:{...xV,...e.attributes}})}}const AV=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),pV=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),gV=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),mV=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),_V=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),yV=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),vV=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),bV={POSITION:{size:3,value:pV},NORMAL:{size:3,value:gV},TEXCOORD_0:{size:2,value:mV}},xV={POSITION:{size:3,value:_V},TEXCOORD_0:{size:2,value:yV},COLOR_0:{size:3,value:vV}};class wV extends EB{constructor(e,r){super(e,r);const{module:i,fs:n,id:o}=r,s={depthWriteEnabled:!1,depthCompare:"always"};this.model=new dV(e,{id:o,fs:n,modules:[i],parameters:s})}render(e){this._renderPass(this.device,e)}delete(){this.model.destroy(),this.model=null}_renderPass(e,r){const{clearCanvas:i,inputBuffer:n,outputBuffer:o}=r,s=[n.width,n.height];this.model.shaderInputs.setProps(r.moduleSettings),this.model.setBindings({texSrc:n.colorAttachments[0]}),this.model.setUniforms({texSize:s});const f=this.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,...s]},clearColor:i?[0,0,0,0]:!1,clearDepth:1});this.model.draw(f),f.end()}}class TV{constructor(e,r){this.id=`${e.name}-pass`,this.props=r,cN(e),this.module=e}setup({device:e}){this.passes=EV(e,this.module,this.id)}setProps(e){this.props=e}preRender(){}postRender(e){const r=this.passes,{target:i}=e;let n=e.inputBuffer,o=e.swapBuffer;for(let s=0;s<r.length;s++){const f=s===r.length-1,A=i!==void 0&&f;A&&(o=i);const v=!A||!!e.clearCanvas,w={},C=this.module.passes[s].uniforms;w[this.module.name]={...this.props,...C},r[s].render({clearCanvas:v,inputBuffer:n,outputBuffer:o,moduleSettings:w});const I=o;o=n,n=I}return n}cleanup(){if(this.passes){for(const e of this.passes)e.delete();this.passes=void 0}}}function EV(t,e,r){return e.passes.map((i,n)=>{const o=PV(e,i),s=`${r}-${n}`;return new wV(t,{id:s,module:e,fs:o})})}const RB=`#version 300 es
uniform sampler2D texSrc;
uniform vec2 texSize;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,SV=t=>`${RB}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${t}(fragColor, texSize, coordinate);
}
`,CV=t=>`${RB}
void main() {
  fragColor = ${t}(texSrc, texSize, coordinate);
}
`;function PV(t,e){if(e.filter){const r=typeof e.filter=="string"?e.filter:`${t.name}_filterColor`;return SV(r)}if(e.sampler){const r=typeof e.sampler=="string"?e.sampler:`${t.name}_sampleColor`;return CV(r)}return""}const IV={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class BB extends N2{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:o,pickingFBO:s,deviceRect:{x:f,y:A,width:v,height:w},cullRect:C,effects:I,pass:B="picking",pickZ:F,moduleParameters:N}){this.pickZ=F;const V=this._resetColorEncoder(F),G=[f,A,v,w],Y=super.render({target:s,layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:o,cullRect:C,effects:I==null?void 0:I.filter(se=>se.useInPicking),pass:B,isPicking:!0,moduleParameters:N,clearColor:[0,0,0,0],colorMask:15,scissorRect:G});return this._colorEncoderState=null,{decodePickingColor:V&&RV.bind(null,V),stats:Y}}shouldDrawLayer(e){const{pickable:r,operation:i}=e.props;return r&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,r,i){const n={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:o,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?n.blend=!1:o&&s.includes("draw")&&(Object.assign(n,IV),n.blend=!0,n.blendColor=MV(this._colorEncoderState,e,i)),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function MV(t,e,r){const{byLayer:i,byAlpha:n}=t;let o,s=i.get(e);return s?(s.viewports.push(r),o=s.a):(o=i.size+1,o<=255?(s={a:o,layer:e,viewports:[r]},i.set(e,s),n[o]=s):(fr.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function RV(t,e){const r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}const pd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Dm=Symbol.for("component"),Pu=Symbol.for("propTypes"),fv=Symbol.for("deprecatedProps"),kd=Symbol.for("asyncPropDefaults"),Dh=Symbol.for("asyncPropOriginal"),Tu=Symbol.for("asyncPropResolved");function S_(t,e=()=>!0){return Array.isArray(t)?OB(t,e,[]):e(t)?[t]:[]}function OB(t,e,r){let i=-1;for(;++i<t.length;){const n=t[i];Array.isArray(n)?OB(n,e,r):e(n)&&r.push(n)}return r}function BV({target:t,source:e,start:r=0,count:i=1}){const n=e.length,o=i*n;let s=0;for(let f=r;s<n;s++)t[f++]=e[s];for(;s<o;)s<o-s?(t.copyWithin(r+s,r,r+s),s*=2):(t.copyWithin(r+s,r,r+o-s),s=o);return t}class OV{constructor(e,r,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;const i=++this._loadCount;let n=e;typeof e=="string"&&(n=Ic(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class DV{constructor(e){var r;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(r=e.device)==null?void 0:r.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:i=!1,persistent:n=!0}){let o=this._resources[e];o?o.setData(r,i):(o=new OV(e,r,this._context),this._resources[e]=o),o.persistent=n}remove(e){const r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const r=this._consumers[e];if(r){for(const i in r){const n=r[i],o=this._resources[n.resourceId];o&&o.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:i,requestId:n="default"}){const{_resources:o,protocol:s}=this;e.startsWith(s)&&(e=e.replace(s,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const f=o[e];if(this._track(i,n,f,r),f)return f.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,r,i,n){const o=this._consumers,s=o[e]=o[e]||{};let f=s[r];const A=f&&f.resourceId&&this._resources[f.resourceId];A&&(A.unsubscribe(f),this.prune()),i&&(f?(f.onChange=n,f.resourceId=i.id):f={onChange:n,resourceId:i.id},s[r]=f,i.subscribe(f))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}}const FV="layerManager.setLayers",LV="layerManager.activateViewport";class kV{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=f=>{js(LV,this,f),f&&(this.context.viewport=f)};const{deck:i,stats:n,viewport:o,timeline:s}=r||{};this.layers=[],this.resourceManager=new DV({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:i,shaderAssembler:TB(),defaultShaderModules:[],renderPass:void 0,stats:n||new cA({id:"deck.gl"}),viewport:o||new hA({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new IB,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const n=i.getNeedsRedraw(e);r=r||n}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(i=>r.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){js(FV,this,r,e),this._lastRenderedLayers=e;const i=S_(e,Boolean);for(const n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:r}=this.context;r.find(i=>i.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:r}=this.context,i=r.findIndex(n=>n.name===e.name);i>=0&&(r.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,i){i.raiseError(r,`${e} of ${i}`)}_updateLayers(e,r){const i={};for(const s of e)i[s.id]?fr.warn(`Multiple old layers with same id ${s.id}`)():i[s.id]=s;if(this._defaultShaderModulesChanged){for(const s of e)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const n=[];this._updateSublayersRecursively(r,i,n),this._finalizeOldLayers(i);let o=!1;for(const s of n)if(s.hasUniformTransition()){o=`Uniform transition in ${s}`;break}this._needsUpdate=o,this.layers=n}_updateSublayersRecursively(e,r,i){for(const n of e){n.context=this.context;const o=r[n.id];o===null&&fr.warn(`Multiple new layers with same id ${n.id}`)(),r[n.id]=null;let s=null;try{this._debug&&o!==n&&n.validateProps(),o?(this._transferLayerState(o,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),s=n.isComposite?n.getSubLayers():null}catch(f){this._handleError("matching",f,n)}s&&this._updateSublayersRecursively(s,r,i)}}_finalizeOldLayers(e){for(const r in e){const i=e[r];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=pd.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=pd.MATCHED,r!==e&&(e.lifecycle=pd.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=pd.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=pd.FINALIZED}catch(r){this._handleError("finalization",r,e)}}}function Ws(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Ws(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const o of i)if(!e.hasOwnProperty(o)||!Ws(t[o],e[o],r-1))return!1;return!0}return!1}class NV{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){const r=typeof e=="string"?this.getView(e):e,i=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,r){const i=this.getViewports(),n={x:e[0],y:e[1]};for(let o=i.length-1;o>=0;--o){const s=i[o];if(s.containsPixel(n)){const f=e.slice();return f[0]-=s.x,f[1]-=s.y,s.unproject(f,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=S_(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ws(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):fr.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){const i=r.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var s;return(s=this.getView(e.id))==null?void 0:s.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,r,i,n){const o=e.controller;if(o&&i){const s={...r,...o,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==o.type)&&(n=this._createController(e,s)),n&&n.setProps(s),n}return null}_rebuildViewports(){const{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=e.length;n--;){const o=e[n],s=this.getViewState(o),f=o.makeViewport({viewState:s,width:this.width,height:this.height});let A=r[o.id];const v=!!o.controller;v&&!A&&(i=!0),(i||!v)&&A&&(A.finalize(),A=null),this.controllers[o.id]=this._updateController(o,s,f,A),f&&this._viewports.unshift(f)}for(const n in r){const o=r[n];o&&!this.controllers[n]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((i,n)=>!e[n].equals(r[n]))}}const UV=/([0-9]+\.?[0-9]*)(%|px)/;function du(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=UV.exec(t);if(e&&e.length>=3){const r=e[2]==="%",i=parseFloat(e[1]);return{position:r?i/100:i,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function Au(t,e){return t.relative?Math.round(t.position*e):t.position}class Kd{constructor(e){const{id:r,x:i=0,y:n=0,width:o="100%",height:s="100%",padding:f=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=du(i),this._y=du(n),this._width=du(o),this._height=du(s),this._padding=f&&{left:du(f.left||0),right:du(f.right||0),top:du(f.top||0),bottom:du(f.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&Ws(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:i}){i=this.filterViewState(i);const n=this.getDimensions({width:e,height:r});return!n.height||!n.width?null:new this.ViewportType({...i,...this.props,...n})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...e};for(const i in this.props.viewState)i!=="id"&&(r[i]=this.props.viewState[i]);return r}return e}getDimensions({width:e,height:r}){const i={x:Au(this._x,e),y:Au(this._y,r),width:Au(this._width,e),height:Au(this._height,r)};return this._padding&&(i.padding={left:Au(this._padding.left,e),top:Au(this._padding.top,r),right:Au(this._padding.right,e),bottom:Au(this._padding.bottom,r)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class C_{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var r,i;this.cancel(),this.settings=e,this._inProgress=!0,(i=(r=this.settings).onStart)==null||i.call(r,this)}end(){var e,r;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(r=(e=this.settings).onEnd)==null||r.call(e,this))}cancel(){var e,r;this._inProgress&&((r=(e=this.settings).onInterrupt)==null||r.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,r;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:n}=this;this._handle=i.addChannel({delay:i.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(r=(e=this.settings).onUpdate)==null||r.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const IS=()=>{},tb={BREAK:1,SNAP_TO_END:2,IGNORE:3},zV=t=>t,VV=tb.BREAK;let jV=class{constructor(e){this._onTransitionUpdate=r=>{const{time:i,settings:{interpolator:n,startProps:o,endProps:s,duration:f,easing:A}}=r,v=A(i/f),w=n.interpolateProps(o,s,v);this.propsInTransition=this.getControllerState({...this.props,...w}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new C_(e.timeline),this.onViewStateChange=e.onViewStateChange||IS,this.onStateChange=e.onStateChange||IS}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){const{interruption:o,endProps:s}=this.transition.settings;n={...i,...o===tb.SNAP_TO_END?s:this.propsInTransition||i}}this._triggerTransition(n,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:r,transitionInterpolator:i}=e;return(r>0||r==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===tb.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){const i=this.getControllerState(e),n=this.getControllerState(r).shortestPathFrom(i),o=r.transitionInterpolator,s=o.getDuration?o.getDuration(e,r):r.transitionDuration;if(s===0)return;const f=o.initializeProps(e,n);this.propsInTransition={};const A={duration:s,easing:r.transitionEasing||zV,interpolator:o,interruption:r.transitionInterruption||VV,startProps:f.start,endProps:f.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(A),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(r)}}};function Cs(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}let HV=class{constructor(e){const{compare:r,extract:i,required:n}=e;this._propsToCompare=r,this._propsToExtract=i||r,this._requiredProps=n}arePropsEqual(e,r){for(const i of this._propsToCompare)if(!(i in e)||!(i in r)||!Ca(e[i],r[i]))return!1;return!0}initializeProps(e,r){const i={},n={};for(const o of this._propsToExtract)(o in e||o in r)&&(i[o]=e[o],n[o]=r[o]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{const i=e[r];Cs(Number.isFinite(i)||Array.isArray(i),`${r} is required for transition`)})}};const GV=["longitude","latitude","zoom","bearing","pitch"],WV=["longitude","latitude","zoom"];let DB=class extends HV{constructor(e={}){const r=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:GV,required:WV},super(i.transitionProps),this.opts=i}initializeProps(e,r){const i=super.initializeProps(e,r),{makeViewport:n,around:o}=this.opts;if(n&&o){const s=n(e),f=n(r),A=s.unproject(o);i.start.around=o,Object.assign(i.end,{around:f.project(A),aroundPosition:A,width:r.width,height:r.height})}return i}interpolateProps(e,r,i){const n={};for(const o of this._propsToExtract)n[o]=el(e[o]||0,r[o]||0,i);if(r.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...r,...n});Object.assign(n,o.panByPosition(r.aroundPosition,el(e.around,r.around,i)))}return n}};const pu={transitionDuration:0},XV=300,dg=t=>1-(1-t)*(1-t),Yf={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ph={};class qV{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new jV({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const r in this._events)this._events[r]&&((e=this.eventManager)==null||e.off(r,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return r?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:r,y:i}=this.props,{offsetCenter:n}=e;return[n.x-r,n.y-i]}isPointInBounds(e,r){const{width:i,height:n}=this.props;if(r&&r.handled)return!1;const o=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=n;return o&&r&&r.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?XV:0;const{scrollZoom:i=!0,dragPan:n=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:f=!0,touchRotate:A=!1,keyboard:v=!0}=e,w=!!this.onViewStateChange;this.toggleEvents(Yf.WHEEL,w&&i),this.toggleEvents(Yf.PAN,w),this.toggleEvents(Yf.PINCH,w&&(f||A)),this.toggleEvents(Yf.TRIPLE_PAN,w&&A),this.toggleEvents(Yf.DOUBLE_TAP,w&&s),this.toggleEvents(Yf.KEYBOARD,w&&v),this.scrollZoom=i,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=f,this.touchRotate=A,this.keyboard=v}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(i=>{this._events[i]!==r&&(this._events[i]=r,r?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,r=null,i={}){const n={...e.getViewportProps(),...r},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){const s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const n=this.controllerState[i?"panStart":"rotateStart"]({pos:r});return this._panMove=i,this.updateViewport(n,pu,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const r=this.getCenter(e),i=this.controllerState.pan({pos:r});return this.updateViewport(i,pu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:r}=this;if(this.dragPan&&r&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],o=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:dg},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const r=this.getCenter(e),i=this.controllerState.rotate({pos:r});return this.updateViewport(i,pu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],o=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:dg},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let s=2/(1+Math.exp(-Math.abs(o*i)));o<0&&s!==0&&(s=1/s);const f=this.controllerState.zoom({pos:r,scale:s});return this.updateViewport(f,{...this._getTransitionProps({around:r}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const i=this.controllerState.rotateStart({pos:r});return this.updateViewport(i,pu,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(e);r[0]-=e.deltaX;const i=this.controllerState.rotate({pos:r});return this.updateViewport(i,pu,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){const i=this.getCenter(e),n=[i[0],i[1]+=e.velocityY*r/2],o=this.controllerState.rotate({pos:n});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:dg},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const i=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return ph._startPinchRotation=e.rotation,ph._lastPinchEvent=e,this.updateViewport(i,pu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:i}=e,n=this.getCenter(e);r=r.zoom({pos:n,scale:i})}if(this.touchRotate){const{rotation:i}=e;r=r.rotate({deltaAngleX:ph._startPinchRotation-i})}return this.updateViewport(r,pu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ph._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:i}=ph;if(this.touchZoom&&r&&i&&e.scale!==i.scale){const n=this.getCenter(e);let o=this.controllerState.rotateEnd();const s=Math.log2(e.scale),f=(s-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),A=Math.pow(2,s+f*r/2);o=o.zoom({pos:n,scale:A}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:r,transitionEasing:dg},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ph._startPinchRotation=null,ph._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const i=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:r,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:o,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:f}=this;let A;const v={};switch(e.srcEvent.code){case"Minus":A=r?f.zoomOut(i).zoomOut(i):f.zoomOut(i),v.isZooming=!0;break;case"Equal":A=r?f.zoomIn(i).zoomIn(i):f.zoomIn(i),v.isZooming=!0;break;case"ArrowLeft":r?(A=f.rotateLeft(o),v.isRotating=!0):(A=f.moveLeft(n),v.isPanning=!0);break;case"ArrowRight":r?(A=f.rotateRight(o),v.isRotating=!0):(A=f.moveRight(n),v.isPanning=!0);break;case"ArrowUp":r?(A=f.rotateUp(s),v.isRotating=!0):(A=f.moveUp(n),v.isPanning=!0);break;case"ArrowDown":r?(A=f.rotateDown(s),v.isRotating=!0):(A=f.moveDown(n),v.isPanning=!0);break;default:return!1}return this.updateViewport(A,this._getTransitionProps(),v),!0}_getTransitionProps(e){const{transition:r}=this;return!r||!r.transitionInterpolator?pu:e?{...r,transitionInterpolator:new DB({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class $V{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const MS=5,ZV=1.2;let KV=class extends $V{constructor(e){const{width:r,height:i,latitude:n,longitude:o,zoom:s,bearing:f=0,pitch:A=0,altitude:v=1.5,position:w=[0,0,0],maxZoom:C=20,minZoom:I=0,maxPitch:B=60,minPitch:F=0,startPanLngLat:N,startZoomLngLat:V,startRotatePos:G,startBearing:Y,startPitch:Z,startZoom:se,normalize:ge=!0}=e;Cs(Number.isFinite(o)),Cs(Number.isFinite(n)),Cs(Number.isFinite(s)),super({width:r,height:i,latitude:n,longitude:o,zoom:s,bearing:f,pitch:A,altitude:v,maxZoom:C,minZoom:I,maxPitch:B,minPitch:F,normalize:ge,position:w},{startPanLngLat:N,startZoomLngLat:V,startRotatePos:G,startBearing:Y,startPitch:Z,startZoom:se}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){const i=this.getState().startPanLngLat||this._unproject(r);if(!i)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:i=0}){const{startRotatePos:n,startBearing:o,startPitch:s}=this.getState();if(!n||o===void 0||s===void 0)return this;let f;return e?f=this._getNewRotation(e,n,s,o):f={bearing:o+r,pitch:s+i},this._getUpdatedState(f)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:i}){let{startZoom:n,startZoomLngLat:o}=this.getState();if(o||(n=this.getViewportProps().zoom,o=this._unproject(r)||this._unproject(e)),!o)return this;const{maxZoom:s,minZoom:f}=this.getViewportProps();let A=n+Math.log2(i);A=Tc(A,f,s);const v=this.makeViewport({...this.getViewportProps(),zoom:A});return this._getUpdatedState({zoom:A,...v.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const r=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:o}=i;return Math.abs(n-r.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(o-r.longitude)>180&&(i.longitude=o<0?o+360:o-360),i}applyConstraints(e){const{maxZoom:r,minZoom:i,zoom:n}=e;e.zoom=Tc(n,i,r);const{maxPitch:o,minPitch:s,pitch:f}=e;e.pitch=Tc(f,s,o);const{normalize:A=!0}=e;return A&&Object.assign(e,m7(e)),e}_zoomFromCenter(e){const{width:r,height:i}=this.getViewportProps();return this.zoom({pos:[r/2,i/2],scale:e})}_panFromCenter(e){const{width:r,height:i}=this.getViewportProps();return this.pan({startPos:[r/2,i/2],pos:[r/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,i,n){const o=e[0]-r[0],s=e[1]-r[1],f=e[1],A=r[1],{width:v,height:w}=this.getViewportProps(),C=o/v;let I=0;s>0?Math.abs(w-A)>MS&&(I=s/(A-w)*ZV):s<0&&A>MS&&(I=1-f/A),I=Tc(I,-1,1);const{minPitch:B,maxPitch:F}=this.getViewportProps(),N=n+180*C;let V=i;return I>0?V=i+I*(F-i):I<0&&(V=i-I*(B-i)),{pitch:V,bearing:N}}},YV=class extends qV{constructor(){super(...arguments),this.ControllerState=KV,this.transition={transitionDuration:300,transitionInterpolator:new DB({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};class FB extends Kd{constructor(e={}){super(e)}get ViewportType(){return zp}get ControllerType(){return YV}}FB.displayName="MapView";const JV=new CB;function QV(t,e){const r=t.order??1/0,i=e.order??1/0;return r-i}class ej{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const r=this._defaultEffects;if(!r.find(i=>i.id===e.id)){const i=r.findIndex(n=>QV(n,e)>0);i<0?r.push(e):r.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ws(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){const r={};for(const n of this.effects)r[n.id]=n;const i=[];for(const n of e){const o=r[n.id];let s=n;o&&o!==n?o.setProps?(o.setProps(n.props),s=o):o.cleanup(this._context):o||n.setup(this._context),i.push(s),delete r[n.id]}for(const n in r)r[n].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(n=>n instanceof CB)||this._resolvedEffects.push(JV),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class tj extends N2{shouldDrawLayer(e){const{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}}const rj="deckRenderer.renderLayers";class ij{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new tj(e),this.pickLayersPass=new BB(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const o=r.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,js(rj,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:e}=this;for(const r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const i of e)r.preRenderStats[i.id]=i.preRender(r),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[n]}))});for(const i of e)i.resize(r)}_postRender(e,r){const{renderBuffers:i}=this,n={...r,inputBuffer:i[0],swapBuffer:i[1]};for(const o of e)if(o.postRender){n.target=o.id===this.lastPostProcessEffect?r.target:void 0;const s=o.postRender(n);n.inputBuffer=s,n.swapBuffer=s===i[0]?i[1]:i[0]}}}const nj={pickedColor:null,pickedObjectIndex:-1};function sj({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:i,deviceRadius:n,deviceRect:o}){const{x:s,y:f,width:A,height:v}=o;let w=n*n,C=-1,I=0;for(let B=0;B<v;B++){const F=B+f-i,N=F*F;if(N>w)I+=4*A;else for(let V=0;V<A;V++){if(t[I+3]-1>=0){const Y=V+s-r,Z=Y*Y+N;Z<=w&&(w=Z,C=I)}I+=4}}if(C>=0){const B=t.slice(C,C+4),F=e(B);if(F){const N=Math.floor(C/4/A),V=C/4-N*A;return{...F,pickedColor:B,pickedX:s+V,pickedY:f+N}}fr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return nj}function oj({pickedColors:t,decodePickingColor:e}){const r=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const o=t.slice(i,i+4),s=o.join(",");if(!r.has(s)){const f=e(o);f?r.set(s,{...f,color:o}):fr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function LB({pickInfo:t,viewports:e,pixelRatio:r,x:i,y:n,z:o}){let s=e[0];e.length>1&&(s=lj((t==null?void 0:t.pickedViewports)||e,{x:i,y:n}));let f;if(s){const A=[i-s.x,n-s.y];o!==void 0&&(A[2]=o),f=s.unproject(A)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:f,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function aj(t){const{pickInfo:e,lastPickedInfo:r,mode:i,layers:n}=t,{pickedColor:o,pickedLayer:s,pickedObjectIndex:f}=e,A=s?[s]:[];if(i==="hover"){const C=r.index,I=r.layerId,B=s?s.props.id:null;if(B!==I||f!==C){if(B!==I){const F=n.find(N=>N.props.id===I);F&&A.unshift(F)}r.layerId=B,r.index=f,r.info=null}}const v=LB(t),w=new Map;return w.set(null,v),A.forEach(C=>{let I={...v};C===s&&(I.color=o,I.index=f,I.picked=!0),I=kB({layer:C,info:I,mode:i});const B=I.layer;C===s&&i==="hover"&&(r.info=I),w.set(B.id,I),i==="hover"&&B.updateAutoHighlight(I)}),w}function kB({layer:t,info:e,mode:r}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:i}),t=t.parent}return e}function lj(t,e){for(let r=t.length-1;r>=0;r--){const i=t[r];if(i.containsPixel(e))return i}return t[0]}class cj{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new BB(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:i,viewports:n},o=this.lastPickedInfo.info){const s=o&&o.layer&&o.layer.id,f=o&&o.viewport&&o.viewport.id,A=s?i.find(I=>I.id===s):null,v=f&&n.find(I=>I.id===f)||n[0],w=v&&v.unproject([e-v.x,r-v.y]);return{...o,...{x:e,y:r,viewport:v,coordinate:w,layer:A}}}_resizeBuffer(){var r,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const n=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=n}const{canvas:e}=this.device.getCanvasContext();(r=this.pickingFBO)==null||r.resize({width:e.width,height:e.height}),(i=this.depthFBO)==null||i.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const r=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:i,x:n,y:o,radius:s=0,depth:f=1,mode:A="query",unproject3D:v,onViewportActive:w,effects:C}){const I=this.device.canvasContext.cssToDeviceRatio(),B=this._getPickable(e);if(!B||i.length===0)return{result:[],emptyInfo:LB({viewports:i,x:n,y:o,pixelRatio:I})};this._resizeBuffer();const F=this.device.canvasContext.cssToDevicePixels([n,o],!0),N=[F.x+Math.floor(F.width/2),F.y+Math.floor(F.height/2)],V=Math.round(s*I),{width:G,height:Y}=this.pickingFBO,Z=this._getPickingRect({deviceX:N[0],deviceY:N[1],deviceRadius:V,deviceWidth:G,deviceHeight:Y}),se={x:n-s,y:o-s,width:s*2+1,height:s*2+1};let ge;const Pe=[],Ue=new Set;for(let Fe=0;Fe<f;Fe++){let pe;if(Z){const Ae=this._drawAndSample({layers:B,views:r,viewports:i,onViewportActive:w,deviceRect:Z,cullRect:se,effects:C,pass:`picking:${A}`});pe=sj({...Ae,deviceX:N[0],deviceY:N[1],deviceRadius:V,deviceRect:Z})}else pe={pickedColor:null,pickedObjectIndex:-1};let Te;if(pe.pickedLayer&&v&&this.depthFBO){const{pickedColors:Ae}=this._drawAndSample({layers:[pe.pickedLayer],views:r,viewports:i,onViewportActive:w,deviceRect:{x:pe.pickedX,y:pe.pickedY,width:1,height:1},cullRect:se,effects:C,pass:`picking:${A}:z`},!0);Ae[3]&&(Te=Ae[0])}pe.pickedLayer&&Fe+1<f&&(Ue.add(pe.pickedLayer),pe.pickedLayer.disablePickingIndex(pe.pickedObjectIndex)),ge=aj({pickInfo:pe,lastPickedInfo:this.lastPickedInfo,mode:A,layers:B,viewports:i,x:n,y:o,z:Te,pixelRatio:I});for(const Ae of ge.values())Ae.layer&&Pe.push(Ae);if(!pe.pickedColor)break}for(const Fe of Ue)Fe.restorePickingColors();return{result:Pe,emptyInfo:ge.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:i,x:n,y:o,width:s=1,height:f=1,mode:A="query",maxObjects:v=null,onViewportActive:w,effects:C}){const I=this._getPickable(e);if(!I||i.length===0)return[];this._resizeBuffer();const B=this.device.canvasContext.cssToDeviceRatio(),F=this.device.canvasContext.cssToDevicePixels([n,o],!0),N=F.x,V=F.y+F.height,G=this.device.canvasContext.cssToDevicePixels([n+s,o+f],!0),Y=G.x+G.width,Z=G.y,se={x:N,y:Z,width:Y-N,height:V-Z},ge=this._drawAndSample({layers:I,views:r,viewports:i,onViewportActive:w,deviceRect:se,cullRect:{x:n,y:o,width:s,height:f},effects:C,pass:`picking:${A}`}),Pe=oj(ge),Ue=new Map,Fe=[],pe=Number.isFinite(v);for(let Te=0;Te<Pe.length&&!(pe&&Fe.length>=v);Te++){const Ae=Pe[Te];let Le={color:Ae.pickedColor,layer:null,index:Ae.pickedObjectIndex,picked:!0,x:n,y:o,pixelRatio:B};Le=kB({layer:Ae.pickedLayer,info:Le,mode:A});const Ve=Le.layer.id;Ue.has(Ve)||Ue.set(Ve,new Set);const Xe=Ue.get(Ve),dt=Le.object??Le.index;Xe.has(dt)||(Xe.add(dt),Fe.push(Le))}return Fe}_drawAndSample({layers:e,views:r,viewports:i,onViewportActive:n,deviceRect:o,cullRect:s,effects:f,pass:A},v=!1){const w=v?this.depthFBO:this.pickingFBO,C={layers:e,layerFilter:this.layerFilter,views:r,viewports:i,onViewportActive:n,pickingFBO:w,deviceRect:o,cullRect:s,effects:f,pass:A,pickZ:v,preRenderStats:{}};for(const Y of f)Y.useInPicking&&(C.preRenderStats[Y.id]=Y.preRender(C));const{decodePickingColor:I}=this.pickLayersPass.render(C),{x:B,y:F,width:N,height:V}=o,G=new(v?Float32Array:Uint8Array)(N*V*4);return this.device.readPixelsToArrayWebGL(w,{sourceX:B,sourceY:F,sourceWidth:N,sourceHeight:V,target:G}),{pickedColors:G,decodePickingColor:I}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:i,deviceWidth:n,deviceHeight:o}){const s=Math.max(0,e-i),f=Math.max(0,r-i),A=Math.min(n,e+i+1)-s,v=Math.min(o,r+i+1)-f;return A<=0||v<=0?null:{x:s,y:f,width:A,height:v}}}const uj={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},hj="top-left",RS="__root";class fj{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ws(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const r={};for(const i of this.resolvedWidgets)r[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)r[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const n=r[i.id];n?n.viewId!==i.viewId||n.placement!==i.placement?(this._remove(n),this._add(i)):i!==n&&(n.setProps(i.props),i=n):this._add(i),r[i.id]=null,this.resolvedWidgets.push(i)}for(const i in r){const n=r[i];n&&this._remove(n)}this.widgets=e}_add(e){const{viewId:r=null,placement:i=hj}=e,n=e.onAdd({deck:this.deck,viewId:r});n&&this._getContainer(r,i).append(n),e._element=n}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){var s;const i=e||RS;let n=this.containers[i];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",(s=this.parentElement)==null||s.append(n),this.containers[i]=n);let o=n.querySelector(`.${r}`);return o||(o=document.createElement("div"),o.className=r,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,uj[r]),n.append(o)),o}_updateContainers(){const e=this.deck.width,r=this.deck.height;for(const i in this.containers){const n=this.lastViewports[i]||null,o=i===RS||n,s=this.containers[i];o?(s.style.display="block",s.style.left=`${n?n.x:0}px`,s.style.top=`${n?n.y:0}px`,s.style.width=`${n?n.width:e}px`,s.style.height=`${n?n.height:r}px`):s.style.display="none"}}onRedraw({viewports:e,layers:r}){var o,s;const i=e.reduce((f,A)=>(f[A.id]=A,f),{}),{lastViewports:n}=this;for(const f of this.getWidgets()){const{viewId:A}=f;if(A){const v=i[A];v&&(f.onViewportChange&&!v.equals(n[A])&&f.onViewportChange(v),(o=f.onRedraw)==null||o.call(f,{viewports:[v],layers:r}))}else{if(f.onViewportChange)for(const v of e)v.equals(n[v.id])||f.onViewportChange(v);(s=f.onRedraw)==null||s.call(f,{viewports:e,layers:r})}}this.lastViewports=i,this._updateContainers()}onHover(e,r){var i,n;for(const o of this.getWidgets()){const{viewId:s}=o;(!s||s===((i=e.viewport)==null?void 0:i.id))&&((n=o.onHover)==null||n.call(o,e,r))}}onEvent(e,r){var n,o;const i=X1[r.type];if(i)for(const s of this.getWidgets()){const{viewId:f}=s;(!f||f===((n=e.viewport)==null?void 0:n.id))&&((o=s[i.handler])==null||o.call(s,e,r))}}}const dj={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Aj{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,dj),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var r;this.isVisible&&e.id===((r=this.lastViewport)==null?void 0:r.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:r}=this,i=r&&r.props.getTooltip;if(!i)return;const n=i(e);this.lastViewport=e.viewport,this.setTooltip(n,e.x,e.y)}setTooltip(e,r,i){const n=this.element;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${r}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}}var yd;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(yd||(yd={}));const U2={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Vn=(t,e,r)=>e?t.enable(r):t.disable(r),BS=(t,e,r)=>t.hint(r,e),Xo=(t,e,r)=>t.pixelStorei(r,e),OS=(t,e,r)=>{const i=r===36006?36009:36008;return t.bindFramebuffer(i,e)},ZA=(t,e,r)=>{const n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(n,e)};function dv(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const pj={3042:Vn,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Vn,2885:(t,e)=>t.cullFace(e),2929:Vn,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Vn,35723:BS,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var r;return(r=t.bindTransformFeedback)==null?void 0:r.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:OS,36010:OS,34964:ZA,36662:ZA,36663:ZA,35053:ZA,35055:ZA,2886:(t,e)=>t.frontFace(e),33170:BS,2849:(t,e)=>t.lineWidth(e),32823:Vn,32824:"polygonOffset",10752:"polygonOffset",35977:Vn,32926:Vn,32928:Vn,32938:"sampleCoverage",32939:"sampleCoverage",3089:Vn,3088:(t,e)=>t.scissor(...e),2960:Vn,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Vn,10754:Vn,12288:Vn,12289:Vn,12290:Vn,12291:Vn,12292:Vn,12293:Vn,12294:Vn,12295:Vn,3333:Xo,3317:Xo,37440:Xo,37441:Xo,37443:Xo,3330:Xo,3332:Xo,3331:Xo,3314:Xo,32878:Xo,3316:Xo,3315:Xo,32877:Xo,framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{const r=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=dv(e)?e:[e,e];const[r,i]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=dv(e)&&e.length===3?[...e,...e]:e;const[r,i,n,o,s,f]=e;t.stencilFuncSeparate(1028,r,i,n),t.stencilFuncSeparate(1029,o,s,f)},stencilOp:(t,e)=>{e=dv(e)&&e.length===3?[...e,...e]:e;const[r,i,n,o,s,f]=e;t.stencilOpSeparate(1028,r,i,n),t.stencilOpSeparate(1029,o,s,f)},viewport:(t,e)=>t.viewport(...e)};function Cn(t,e,r){return e[t]!==void 0?e[t]:r[t]}const gj={blendEquation:(t,e,r)=>t.blendEquationSeparate(Cn(32777,e,r),Cn(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(Cn(32969,e,r),Cn(32968,e,r),Cn(32971,e,r),Cn(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(Cn(32824,e,r),Cn(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(Cn(32938,e,r),Cn(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,Cn(2962,e,r),Cn(2967,e,r),Cn(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,Cn(34816,e,r),Cn(36003,e,r),Cn(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,Cn(2964,e,r),Cn(2965,e,r),Cn(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,Cn(34817,e,r),Cn(34818,e,r),Cn(34819,e,r))},DS={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:r}):{valueChanged:!0}},blendColor:(t,e,r,i,n)=>t({32773:new Float32Array([e,r,i,n])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,i,n)=>t({32969:e,32968:r,32971:i,32970:n}),clearColor:(t,e,r,i,n)=>t({3106:new Float32Array([e,r,i,n])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,i,n)=>t({3107:[e,r,i,n]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,i,n)=>t({3088:new Int32Array([e,r,i,n])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,i)=>t({2962:e,2967:r,2963:i,34816:e,36003:r,36004:i}),stencilFuncSeparate:(t,e,r,i,n)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:i,[e===1028?2963:36004]:n}),stencilOp:(t,e,r,i)=>t({2964:e,2965:r,2966:i,34817:e,34818:r,34819:i}),stencilOpSeparate:(t,e,r,i,n)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:i,[e===1028?2966:34819]:n}),viewport:(t,e,r,i,n)=>t({2978:[e,r,i,n]})},Rl=(t,e)=>t.isEnabled(e),FS={3042:Rl,2884:Rl,2929:Rl,3024:Rl,32823:Rl,32926:Rl,32928:Rl,3089:Rl,2960:Rl,35977:Rl},mj=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function fA(t,e){if(yj(e))return;const r={};for(const n in e){const o=Number(n),s=pj[n];s&&(typeof s=="string"?r[s]=!0:s(t,e[n],o))}const i=t.state&&t.state.cache;if(i)for(const n in r){const o=gj[n];o(t,e,i)}}function NB(t,e=U2){if(typeof e=="number"){const n=e,o=FS[n];return o?o(t,n):t.getParameter(n)}const r=Array.isArray(e)?e:Object.keys(e),i={};for(const n of r){const o=FS[n];i[n]=o?o(t,Number(n)):t.getParameter(Number(n))}return i}function _j(t){fA(t,U2)}function yj(t){for(const e in t)return!1;return!0}function vj(t,e){if(t===e)return!0;const r=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&i&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}class bj{constructor(e,{copyState:r=!1,log:i=()=>{}}={}){U(this,"gl");U(this,"program",null);U(this,"stateStack",[]);U(this,"enable",!0);U(this,"cache");U(this,"log");this.gl=e,this.cache=r?NB(e):Object.assign({},U2),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){_i(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];fA(this.gl,e),this.stateStack.pop()}_updateCache(e){let r=!1,i;const n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){_i(o!==void 0);const s=e[o],f=this.cache[o];vj(s,f)||(r=!0,i=f,n&&!(o in n)&&(n[o]=f),this.cache[o]=s)}return{valueChanged:r,oldValue:i}}}function Fh(t){return t.state}function UB(t,e){const{enable:r=!0,copyState:i}=e;if(_i(i!==void 0),!t.state){t.state=new bj(t,{copyState:i}),wj(t);for(const o in DS){const s=DS[o];xj(t,o,s)}LS(t,"getParameter"),LS(t,"isEnabled")}const n=Fh(t);return n.enable=r,t}function P_(t){let e=Fh(t);e||(UB(t,{copyState:!1}),e=Fh(t)),e.push()}function jp(t){const e=Fh(t);_i(e),e.pop()}function LS(t,e){const r=t[e].bind(t);t[e]=function(n){if(n===void 0||mj.has(n))return r(n);const o=Fh(t);return n in o.cache||(o.cache[n]=r(n)),o.enable?o.cache[n]:r(n)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function xj(t,e,r){if(!t[e])return;const i=t[e].bind(t);t[e]=function(...o){const s=Fh(t),{valueChanged:f,oldValue:A}=r(s._updateCache,...o);return f&&i(...o),A},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function wj(t){const e=t.useProgram.bind(t);t.useProgram=function(i){const n=Fh(t);n.program!==i&&(e(i),n.program=i)}}const Tj={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function Ej(t,e){e={...Tj,...e};let r=null;const i=o=>r=o.statusMessage||r;t.addEventListener("webglcontextcreationerror",i,!1);let n=null;if(n||(n=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",i,!1),!n)throw new Error(`Failed to create WebGL context: ${r||"Unknown error"}`);if(e.onContextLost){const{onContextLost:o}=e;t.addEventListener("webglcontextlost",s=>o(s),!1)}if(e.onContextRestored){const{onContextRestored:o}=e;t.addEventListener("webglcontextrestored",s=>o(s),!1)}return n}function Bu(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function Sj(t,e){const r=t.getParameter(7936),i=t.getParameter(7937);Bu(t,"WEBGL_debug_renderer_info",e);const n=e.WEBGL_debug_renderer_info,o=t.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),s=t.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),f=o||r,A=s||i,v=t.getParameter(7938),w=zB(f,A),C=Cj(f,A),I=Pj(f,A);return{type:"webgl",gpu:w,gpuType:I,gpuBackend:C,vendor:f,renderer:A,version:v,shadingLanguage:"glsl",shadingLanguageVersion:300}}function zB(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function Cj(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function Pj(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(zB(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function VB(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Us="texture-compression-bc",Mi="texture-compression-astc",Bl="texture-compression-etc2",Ij="texture-compression-etc1-webgl",Ag="texture-compression-pvrtc-webgl",Av="texture-compression-atc-webgl",KA="float32-renderable-webgl",pv="float16-renderable-webgl",Mj="rgb9e5ufloat_renderable-webgl",gv="snorm8-renderable-webgl",YA="norm16-renderable-webgl",mv="snorm16-renderable-webgl",pg="float32-filterable",kS="float16-filterable-webgl",Ap="WEBGL_compressed_texture_s3tc",pp="WEBGL_compressed_texture_s3tc_srgb",vd="EXT_texture_compression_rgtc",bd="EXT_texture_compression_bptc",Rj="WEBGL_compressed_texture_etc",Bj="WEBGL_compressed_texture_astc",Oj="WEBGL_compressed_texture_etc1",Dj="WEBGL_compressed_texture_pvrtc",Fj="WEBGL_compressed_texture_atc",NS="EXT_texture_norm16",US="EXT_render_snorm",Lj="EXT_color_buffer_float",z2={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[US],"norm16-renderable-webgl":[NS],"snorm16-renderable-webgl":[NS,US],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Ap,pp,vd,bd],"texture-compression-bc5-webgl":[vd],"texture-compression-bc7-webgl":[bd],"texture-compression-etc2":[Rj],"texture-compression-astc":[Bj],"texture-compression-etc1-webgl":[Oj],"texture-compression-pvrtc-webgl":[Dj],"texture-compression-atc-webgl":[Fj]};function kj(t){return t in z2}function Nj(t,e,r){return(z2[e]||[]).every(n=>Bu(t,n,r))}const I_={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:gv},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:gv},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:pv,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:YA,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:mv},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:gv},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:pv,filter:kS,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:YA},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:mv},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:KA,filter:pg},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:Mj},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:KA,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:YA},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:YA},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:KA,filter:pg,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:pv,filter:kS},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:YA,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:mv},"rgb32float-webgl":{gl:34837,render:KA,filter:pg,gl2ext:Lj,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:KA,filter:pg,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Ap,f:Us},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:pp,f:Us},"bc1-rgba-unorm":{gl:33777,x:Ap,f:Us},"bc1-rgba-unorm-srgb":{gl:35916,x:pp,f:Us},"bc2-rgba-unorm":{gl:33778,x:Ap,f:Us},"bc2-rgba-unorm-srgb":{gl:35918,x:pp,f:Us},"bc3-rgba-unorm":{gl:33779,x:Ap,f:Us},"bc3-rgba-unorm-srgb":{gl:35919,x:pp,f:Us},"bc4-r-unorm":{gl:36283,x:vd,f:Us},"bc4-r-snorm":{gl:36284,x:vd,f:Us},"bc5-rg-unorm":{gl:36285,x:vd,f:Us},"bc5-rg-snorm":{gl:36286,x:vd,f:Us},"bc6h-rgb-ufloat":{gl:36495,x:bd,f:Us},"bc6h-rgb-float":{gl:36494,x:bd,f:Us},"bc7-rgba-unorm":{gl:36492,x:bd,f:Us},"bc7-rgba-unorm-srgb":{gl:36493,x:bd,f:Us},"etc2-rgb8unorm":{gl:37492,f:Bl},"etc2-rgb8unorm-srgb":{gl:37494,f:Bl},"etc2-rgb8a1unorm":{gl:37496,f:Bl},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Bl},"etc2-rgba8unorm":{gl:37493,f:Bl},"etc2-rgba8unorm-srgb":{gl:37495,f:Bl},"eac-r11unorm":{gl:37488,f:Bl},"eac-r11snorm":{gl:37489,f:Bl},"eac-rg11unorm":{gl:37490,f:Bl},"eac-rg11snorm":{gl:37491,f:Bl},"astc-4x4-unorm":{gl:37808,f:Mi},"astc-4x4-unorm-srgb":{gl:37840,f:Mi},"astc-5x4-unorm":{gl:37809,f:Mi},"astc-5x4-unorm-srgb":{gl:37841,f:Mi},"astc-5x5-unorm":{gl:37810,f:Mi},"astc-5x5-unorm-srgb":{gl:37842,f:Mi},"astc-6x5-unorm":{gl:37811,f:Mi},"astc-6x5-unorm-srgb":{gl:37843,f:Mi},"astc-6x6-unorm":{gl:37812,f:Mi},"astc-6x6-unorm-srgb":{gl:37844,f:Mi},"astc-8x5-unorm":{gl:37813,f:Mi},"astc-8x5-unorm-srgb":{gl:37845,f:Mi},"astc-8x6-unorm":{gl:37814,f:Mi},"astc-8x6-unorm-srgb":{gl:37846,f:Mi},"astc-8x8-unorm":{gl:37815,f:Mi},"astc-8x8-unorm-srgb":{gl:37847,f:Mi},"astc-10x5-unorm":{gl:37819,f:Mi},"astc-10x5-unorm-srgb":{gl:37851,f:Mi},"astc-10x6-unorm":{gl:37817,f:Mi},"astc-10x6-unorm-srgb":{gl:37849,f:Mi},"astc-10x8-unorm":{gl:37818,f:Mi},"astc-10x8-unorm-srgb":{gl:37850,f:Mi},"astc-10x10-unorm":{gl:37819,f:Mi},"astc-10x10-unorm-srgb":{gl:37851,f:Mi},"astc-12x10-unorm":{gl:37820,f:Mi},"astc-12x10-unorm-srgb":{gl:37852,f:Mi},"astc-12x12-unorm":{gl:37821,f:Mi},"astc-12x12-unorm-srgb":{gl:37853,f:Mi},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Ag},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Ag},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Ag},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Ag},"etc1-rbg-unorm-webgl":{gl:36196,f:Ij},"atc-rgb-unorm-webgl":{gl:35986,f:Av},"atc-rgba-unorm-webgl":{gl:35986,f:Av},"atc-rgbai-unorm-webgl":{gl:34798,f:Av}},Uj={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},zj={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function V2(t,e,r){const i=I_[e];if(!i||i.gl===void 0)return!1;const n=i.x||i.gl2ext;return n?!!Bu(t,n,r):!0}function jB(t){const e=I_[t],r=e==null?void 0:e.gl;if(r===void 0)throw new Error(`Unsupported texture format ${t}`);return r}function Vj(t,e,r){if(!V2(t,e,r)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(IR(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!Bu(t,"OES_texture_float_linear, extensions",r):e.endsWith("16float")?!!Bu(t,"OES_texture_half_float_linear, extensions",r):!0}function jj(t,e,r){return!(!V2(t,e,r)||typeof e=="number")}function Fm(t){var n;const e=I_[t],r=jB(t),i=IR(t);return{format:r,dataFormat:(e==null?void 0:e.dataFormat)||Gj(i.format,i.integer,i.normalized,r),type:i.dataType?VB(i.dataType):((n=e==null?void 0:e.types)==null?void 0:n[0])||5121,compressed:i.compressed}}function Hj(t){const e=I_[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function zS(t){const e=Fm(t),r=Uj[e.dataFormat]||4,i=zj[e.type]||1;return r*i}function Gj(t,e,r,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;default:return 6408}}const VS={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Wj extends CN{constructor(r,i,n){super([],n);U(this,"gl");U(this,"extensions");U(this,"testedFeatures",new Set);this.gl=r,this.extensions=i,Bu(r,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const r=this.getFeatures();for(const i of r)this.has(i)&&(yield i);return[]}has(r){return this.disabledFeatures[r]?!1:(this.testedFeatures.has(r)||(this.testedFeatures.add(r),kj(r)&&Nj(this.gl,r,this.extensions)&&this.features.add(r),this.getWebGLFeature(r)&&this.features.add(r)),this.features.has(r))}initializeFeatures(){const r=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of r)this.has(i)}getFeatures(){return[...Object.keys(VS),...Object.keys(z2)]}getWebGLFeature(r){const i=VS[r];return typeof i=="string"?!!Bu(this.gl,i,this.extensions):!!i}}class Xj extends SN{constructor(r){super();U(this,"gl");U(this,"limits",{});this.gl=r}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(r){return this.limits[r]===void 0&&(this.limits[r]=this.gl.getParameter(r)),this.limits[r]}}function Eu(t,e,r){if(qj(e))return r(t);const{nocatch:i=!0}=e;P_(t),fA(t,e);let n;if(i)n=r(t),jp(t);else try{n=r(t)}finally{jp(t)}return n}function qj(t){for(const e in t)return!1;return!0}function $j(t,e,r,i){if(xm(e))return i(t);const n=t;P_(n.gl);try{return Zj(t,e),fA(n.gl,r),i(t)}finally{jp(n.gl)}}function Zj(t,e){const r=t,{gl:i}=r;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Oh("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const o=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Oh("provokingVertex",e.provokingVertex,{first:36429,last:36430});o==null||o.provokingVertexWEBGL(s)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const o=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Oh("polygonMode",e.polygonMode,{fill:6914,line:6913});o==null||o.polygonModeWEBGL(1028,s),o==null||o.polygonModeWEBGL(1029,s)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(Yj("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(rb("depthCompare",e.depthCompare))),e.stencilWriteMask){const n=e.stencilWriteMask;i.stencilMaskSeparate(1028,n),i.stencilMaskSeparate(1029,n)}if(e.stencilReadMask&&Et.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const n=e.stencilReadMask||4294967295,o=rb("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,o,0,n),i.stencilFuncSeparate(1029,o,0,n)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const n=_v("stencilPassOperation",e.stencilPassOperation),o=_v("stencilFailOperation",e.stencilFailOperation),s=_v("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,o,s,n),i.stencilOpSeparate(1029,o,s,n)}if(e.blendColorOperation||e.blendAlphaOperation){i.enable(3042);const n=jS("blendColorOperation",e.blendColorOperation||"add"),o=jS("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(n,o);const s=gg("blendColorSrcFactor",e.blendColorSrcFactor||"one"),f=gg("blendColorDstFactor",e.blendColorDstFactor||"zero"),A=gg("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),v=gg("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(s,f,A,v)}}function rb(t,e){return Oh(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function _v(t,e){return Oh(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function jS(t,e){return Oh(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function gg(t,e){return Oh(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Kj(t,e){return`Illegal parameter ${e} for ${t}`}function Oh(t,e,r){if(!(e in r))throw new Error(Kj(t,e));return r[e]}function Yj(t,e){return e}function HB(t){const e={};return t.addressModeU&&(e[10242]=yv(t.addressModeU)),t.addressModeV&&(e[10243]=yv(t.addressModeV)),t.addressModeW&&(e[32882]=yv(t.addressModeW)),t.magFilter&&(e[10240]=GB(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=Jj(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=rb("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function yv(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function GB(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function Jj(t,e){if(!e)return GB(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Iu extends In{constructor(r,i={}){super(r,i);U(this,"device");U(this,"gl");U(this,"handle");U(this,"glTarget");U(this,"glUsage");U(this,"glIndexType",5123);U(this,"byteLength");U(this,"bytesUsed");this.device=r,this.gl=this.device.gl;const n=typeof i=="object"?i.handle:void 0;this.handle=n||this.gl.createBuffer(),r.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Qj(this.props.usage),this.glUsage=eH(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(r,i=0,n=r.byteLength+i){const o=this.glTarget;this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,n,this.glUsage),this.gl.bufferSubData(o,i,r),this.gl.bindBuffer(o,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(r,i,n),this.trackAllocatedMemory(n)}_initWithByteLength(r){_i(r>=0);let i=r;r===0&&(i=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(null,0,r),this.trackAllocatedMemory(r),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(r,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,r),this.gl.bindBuffer(36663,null),this._setDebugData(r,i,r.byteLength)}async readAsync(r=0,i){return this.readSyncWebGL(r,i)}readSyncWebGL(r=0,i){i=i??this.byteLength-r;const n=new Uint8Array(i),o=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,r,n,o,i),this.gl.bindBuffer(36662,null),this._setDebugData(n,r,i),n}}function Qj(t){return t&In.INDEX?34963:t&In.VERTEX?34962:t&In.UNIFORM?35345:34962}function eH(t){return t&In.INDEX||t&In.VERTEX?35044:t&In.UNIFORM?35048:35044}class ib extends Em{constructor(r,i){super(r,i);U(this,"device");U(this,"handle");U(this,"parameters");this.device=r,this.parameters=HB(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(r){for(const[i,n]of Object.entries(r)){const o=Number(i);switch(o){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,o,n);break;default:this.device.gl.samplerParameteri(this.handle,o,n);break}}}}class xd extends wm{constructor(r,i){super(r,{...Zo.defaultProps,...i});U(this,"device");U(this,"gl");U(this,"handle");U(this,"texture");this.device=r,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const tH={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Dp=class Dp extends Zo{constructor(r,i){var n;super(r,{...tH,format:"rgba8unorm",...i});U(this,"MAX_ATTRIBUTES");U(this,"device");U(this,"gl");U(this,"handle");U(this,"sampler");U(this,"view");U(this,"glFormat");U(this,"type");U(this,"dataFormat");U(this,"mipmaps");U(this,"target");U(this,"textureUnit");U(this,"loaded",!1);U(this,"_video");this.device=r,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=rH(this.props),this.loaded=!1,typeof((n=this.props)==null?void 0:n.data)=="string"&&Object.assign(this.props,{data:AU(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(r){return new xd(this.device,{...r,texture:this})}initialize(r={}){if(this.props.dimension==="cube")return this.initializeCube(r);let i=r.data;if(i instanceof Promise)return i.then(G=>this.initialize(Object.assign({},r,{pixels:G,data:G}))),this;const n=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement;if(n&&i.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,i.addEventListener("loadeddata",()=>this.initialize(r)),this;const{parameters:o={}}=r,{pixels:s=null,pixelStore:f={},textureUnit:A=void 0,mipmaps:v=!0}=r;i||(i=s);let{width:w,height:C,dataFormat:I,type:B,compressed:F=!1}=r;const{depth:N=0}=r,V=jB(r.format);return{width:w,height:C,compressed:F,dataFormat:I,type:B}=this._deduceParameters({format:r.format,type:B,dataFormat:I,compressed:F,data:i,width:w,height:C}),this.width=w,this.height=C,this.glFormat=V,this.type=B,this.dataFormat=I,this.textureUnit=A,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=v,this.setImageData({data:i,width:w,height:C,depth:N,format:r.format,type:B,dataFormat:I,parameters:f,compressed:F}),this.setSampler(r.sampler),this._setSamplerParameters(o),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),v&&this.device.isTextureFormatFilterable(r.format)&&this.generateMipmap(),n&&(this._video={video:i,parameters:o,lastTime:i.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?i.currentTime:-1}),this}initializeCube(r){const{mipmaps:i=!0,parameters:n={}}=r;return this.setCubeMapImageData(r).then(()=>{this.loaded=!0,i&&this.generateMipmap(r),this.setSampler(r.sampler),this._setSamplerParameters(n)}),this}setSampler(r={}){let i;r instanceof ib?(this.sampler=r,i=r.props):(this.sampler=new ib(this.device,r),i=r);const n=HB(i);return this._setSamplerParameters(n),this}resize(r){const{height:i,width:n,mipmaps:o=!1}=r;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:o}):this}update(){if(this._video){const{video:r,parameters:i,lastTime:n}=this._video;if(n===r.currentTime||r.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:r,parameters:i}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=r.currentTime}}generateMipmap(r={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Eu(this.gl,r,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(r){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(r);this.trackDeallocatedMemory("Texture");const{target:i=this.target,pixels:n=null,level:o=0,glFormat:s=this.glFormat,offset:f=0,parameters:A={}}=r;let{data:v=null,type:w=this.type,width:C=this.width,height:I=this.height,dataFormat:B=this.dataFormat,compressed:F=!1}=r;v||(v=n),{type:w,dataFormat:B,compressed:F,width:C,height:I}=this._deduceParameters({format:this.props.format,type:w,dataFormat:B,compressed:F,data:v,width:C,height:I});const{gl:N}=this;N.bindTexture(this.target,this.handle);let V=null;if({data:v,dataType:V}=this._getDataType({data:v,compressed:F}),Eu(this.gl,A,()=>{switch(V){case"null":N.texImage2D(i,o,s,C,I,0,B,w,v);break;case"typed-array":N.texImage2D(i,o,s,C,I,0,B,w,v,f);break;case"buffer":this.device.gl.bindBuffer(35052,v.handle||v),this.device.gl.texImage2D(i,o,s,C,I,0,B,w,f),this.device.gl.bindBuffer(35052,null);break;case"browser-object":N.texImage2D(i,o,s,C,I,0,B,w,v);break;case"compressed":for(const[G,Y]of v.entries())N.compressedTexImage2D(i,G,Y.format,Y.width,Y.height,0,Y.data);break;default:_i(!1,"Unknown image data type")}}),v&&v.byteLength)this.trackAllocatedMemory(v.byteLength,"Texture");else{const G=zS(this.props.format);this.trackAllocatedMemory(this.width*this.height*G,"Texture")}return this.loaded=!0,this}setSubImageData({target:r=this.target,pixels:i=null,data:n=null,x:o=0,y:s=0,width:f=this.width,height:A=this.height,level:v=0,glFormat:w=this.glFormat,type:C=this.type,dataFormat:I=this.dataFormat,compressed:B=!1,offset:F=0,parameters:N={}}){if({type:C,dataFormat:I,compressed:B,width:f,height:A}=this._deduceParameters({format:this.props.format,type:C,dataFormat:I,compressed:B,data:n,width:f,height:A}),_i(this.depth===1,"texSubImage not supported for 3D textures"),n||(n=i),n&&n.data){const V=n;n=V.data,f=V.shape[0],A=V.shape[1]}n instanceof Iu&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Eu(this.gl,N,()=>{B?this.gl.compressedTexSubImage2D(r,v,o,s,f,A,w,n):n===null?this.gl.texSubImage2D(r,v,o,s,f,A,I,C,null):ArrayBuffer.isView(n)?this.gl.texSubImage2D(r,v,o,s,f,A,I,C,n,F):typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,n),this.device.gl.texSubImage2D(r,v,o,s,f,A,I,C,F),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(r,v,o,s,f,A,I,C,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(r={}){return Et.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(r=this.textureUnit){const{gl:i}=this;return r!==void 0&&(this.textureUnit=r,i.activeTexture(33984+r)),i.bindTexture(this.target,this.handle),r}unbind(r=this.textureUnit){const{gl:i}=this;return r!==void 0&&(this.textureUnit=r,i.activeTexture(33984+r)),i.bindTexture(this.target,null),r}_getDataType({data:r,compressed:i=!1}){return i?{data:r,dataType:"compressed"}:r===null?{data:r,dataType:"null"}:ArrayBuffer.isView(r)?{data:r,dataType:"typed-array"}:r instanceof Iu?{data:r.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&r instanceof WebGLBuffer?{data:r,dataType:"buffer"}:{data:r,dataType:"browser-object"}}_deduceParameters(r){const{format:i,data:n}=r;let{width:o,height:s,dataFormat:f,type:A,compressed:v}=r;const w=Fm(i);return f=f||w.dataFormat,A=A||w.type,v=v||w.compressed,{width:o,height:s}=this._deduceImageSize(n,o,s),{dataFormat:f,type:A,compressed:v,width:o,height:s,format:i,data:n}}_deduceImageSize(r,i,n){let o;return typeof ImageData<"u"&&r instanceof ImageData?o={width:r.width,height:r.height}:typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement?o={width:r.naturalWidth,height:r.naturalHeight}:typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement?o={width:r.width,height:r.height}:typeof ImageBitmap<"u"&&r instanceof ImageBitmap?o={width:r.width,height:r.height}:typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement?o={width:r.videoWidth,height:r.videoHeight}:r?o={width:i,height:n}:o={width:i>=0?i:1,height:n>=0?n:1},_i(o,"Could not deduced texture size"),_i(i===void 0||o.width===i,"Deduced texture width does not match supplied width"),_i(n===void 0||o.height===n,"Deduced texture height does not match supplied height"),o}async setCubeMapImageData(r){const{gl:i}=this,{width:n,height:o,pixels:s,data:f,format:A=6408,type:v=5121}=r,w=s||f,C=await Promise.all(Dp.FACES.map(I=>{const B=w[I];return Promise.all(Array.isArray(B)?B:[B])}));this.bind(),Dp.FACES.forEach((I,B)=>{C[B].length>1&&this.props.mipmaps!==!1&&Et.warn(`${this.id} has mipmap and multiple LODs.`)(),C[B].forEach((F,N)=>{n&&o?i.texImage2D(I,N,A,n,o,0,A,v,F):i.texImage2D(I,N,A,A,v,F)})}),this.unbind()}setImageDataForFace(r){const{face:i,width:n,height:o,pixels:s,data:f,format:A=6408,type:v=5121}=r,{gl:w}=this,C=s||f;return this.bind(),C instanceof Promise?C.then(I=>this.setImageDataForFace(Object.assign({},r,{face:i,data:I,pixels:I}))):this.width||this.height?w.texImage2D(i,0,A,n,o,0,A,v,C):w.texImage2D(i,0,A,A,v,C),this}setImageData3D(r){const{level:i=0,dataFormat:n,format:o,type:s,width:f,height:A,depth:v=1,offset:w=0,data:C,parameters:I={}}=r;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const B=Fm(o);if(Eu(this.gl,I,()=>{ArrayBuffer.isView(C)&&this.gl.texImage3D(this.target,i,B.format,f,A,v,0,B.dataFormat,B.type,C),C instanceof Iu&&(this.gl.bindBuffer(35052,C.handle),this.gl.texImage3D(this.target,i,n,f,A,v,0,o,s,w))}),C&&C.byteLength)this.trackAllocatedMemory(C.byteLength,"Texture");else{const F=zS(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*F,"Texture")}return this.loaded=!0,this}_setSamplerParameters(r){if(!xm(r)){iH(r),this.gl.bindTexture(this.target,this.handle);for(const[i,n]of Object.entries(r)){const o=Number(i),s=n;switch(o){case 33082:case 33083:this.gl.texParameterf(this.target,o,s);break;default:this.gl.texParameteri(this.target,o,s);break}}this.gl.bindTexture(this.target,null)}}};U(Dp,"FACES",[34069,34070,34071,34072,34073,34074]);let Ul=Dp;function rH(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function iH(t){Et.log(1,"texture sampler parameters",t)()}class xp extends Sm{constructor(r,i){super(r,i);U(this,"device");U(this,"gl");U(this,"handle");const n=i.handle===null;if(this.device=r,this.gl=r.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){r.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const o=this.gl.bindFramebuffer(36160,this.handle);for(let s=0;s<this.colorAttachments.length;++s){const f=this.colorAttachments[s],A=36064+s;f&&this._attachOne(A,f)}if(this.depthStencilAttachment&&this._attachOne(Hj(this.depthStencilAttachment.props.format),this.depthStencilAttachment),i.check!==!1){const s=this.gl.checkFramebufferStatus(36160);if(s!==36053)throw new Error(`Framebuffer ${sH(s)}`)}this.gl.bindFramebuffer(36160,o)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(r){return new Ul(this.device,{id:`${this.id}-depth-stencil`,format:r,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(r,i){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;r===void 0&&(r=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight);for(const n of this.colorAttachments)n.texture.resize({width:r,height:i});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:r,height:i}),this}_attachOne(r,i){if(Array.isArray(i)){const[n,o=0,s=0]=i;return this._attachTexture(r,n,o,s),n}if(i instanceof Ul)return this._attachTexture(r,i,0,0),i;if(i instanceof xd){const n=i;return this._attachTexture(r,n.texture,n.props.baseMipLevel,n.props.baseArrayLayer),i.texture}throw new Error("attach")}_attachTexture(r,i,n,o){const{gl:s}=this.device;switch(s.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:s.framebufferTextureLayer(36160,r,i.target,o,n);break;case 34067:const f=nH(n);s.framebufferTexture2D(36160,r,f,i.handle,o);break;case 3553:s.framebufferTexture2D(36160,r,3553,i.handle,o);break;default:_i(!1,"Illegal texture type")}s.bindTexture(i.target,null)}}function nH(t){return t<34069?t+34069:t}function sH(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class oH extends x2{constructor(r,i){super(i);U(this,"device");U(this,"presentationSize");U(this,"_framebuffer",null);this.device=r,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new xp(this.device,{handle:null}),this._framebuffer}update(){const r=this.getPixelSize();(r[0]!==this.presentationSize[0]||r[1]!==this.presentationSize[1])&&(this.presentationSize=r,this.resize())}resize(r){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(r==null?void 0:r.useDevicePixels);this.setDevicePixelRatio(i,r);return}}commit(){}}const aH={spector:Et.get("spector")||Et.get("spectorjs")},lH="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",cH=1;let Ri=null,HS=!1;async function uH(t){if(!globalThis.SPECTOR)try{await kR(lH)}catch(e){Et.warn(String(e))}}function hH(t){if(t={...aH,...t},!(t!=null&&t.spector)||(!Ri&&globalThis.SPECTOR&&(Et.probe(cH,"SPECTOR found and initialized")(),Ri=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=Ri)),!Ri))return null;if(HS||(HS=!0,Ri.spyCanvases(),Ri==null||Ri.onCaptureStarted.add(e=>Et.info("Spector capture started:",e)()),Ri==null||Ri.onCapture.add(e=>{Et.info("Spector capture complete:",e)(),Ri==null||Ri.getResultUI(),Ri==null||Ri.resultView.display(),Ri==null||Ri.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return Ri;Ri==null||Ri.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Et.info("Spector capture stopped after 2 seconds")(),Ri==null||Ri.stopCapture()})}return Ri}const fH="https://unpkg.com/webgl-debug@2.0.1/index.js";function WB(t){return t.luma=t.luma||{},t.luma}async function dH(){ku()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await kR(fH))}function AH(t,e={}){return t?e.debug?gH(t,e):pH(t):null}function pH(t){const e=WB(t);return e.realContext?e.realContext:t}function gH(t,e){if(!globalThis.WebGLDebugUtils)return Et.warn("webgl-debug not loaded")(),t;const r=WB(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...yd,...t});const i=globalThis.WebGLDebugUtils.makeDebugContext(t,mH.bind(null,e),_H.bind(null,e));for(const s in yd)!(s in i)&&typeof yd[s]=="number"&&(i[s]=yd[s]);class n{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(n,i);const o=Object.create(n);return r.realContext=t,r.debugContext=o,o.debug=!0,o}function vv(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function mH(t,e,r,i){i=Array.from(i).map(f=>f===void 0?"undefined":f);const n=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,i),s=`${n} in gl.${r}(${o})`;Et.error(s)();debugger;if(t.throwOnError)throw new Error(s)}function _H(t,e,r){let i="";if(Et.level>=1&&(i=vv(e,r),Et.log(1,i)()),t.break&&t.break.length>0&&(i=i||vv(e,r),t.break.every(o=>i.indexOf(o)!==-1)))debugger;for(const n of r)if(n===void 0){if(i=i||vv(e,r),t.throwOnError)throw new Error(`Undefined argument: ${i}`);Et.error(`Undefined argument: ${i}`)();debugger}}function yH(t){const e=t.split(/\r?\n/),r=[];for(const i of e){if(i.length<=1)continue;const n=i.split(":");if(n.length===2){const[C,I]=n;r.push({message:I.trim(),type:GS(C),lineNum:0,linePos:0});continue}const[o,s,f,...A]=n;let v=parseInt(f,10);isNaN(v)&&(v=0);let w=parseInt(s,10);isNaN(w)&&(w=0),r.push({message:A.join(":").trim(),type:GS(o),lineNum:v,linePos:w})}return r}function GS(t){const e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}class vH extends Tm{constructor(r,i){super(r,i);U(this,"device");U(this,"handle");switch(this.device=r,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const r=this.device.gl.getShaderInfoLog(this.handle);return yH(r)}getTranslatedSource(){const i=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return i==null?void 0:i.getTranslatedShaderSource(this.handle)}async _compile(r){r=(o=>o.startsWith("#version ")?o:`#version 100
${o}`)(r);const{gl:n}=this.device;if(n.shaderSource(this.handle,r),n.compileShader(this.handle),Et.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Et.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Et.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const r=async o=>await new Promise(s=>setTimeout(s,o));if(!this.device.features.has("compilation-status-async-webgl")){await r(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await r(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const bH=256,xH=1024,wH=16384,bv=6144,TH=[1,2,4,8];class EH extends O1{constructor(r,i){super(r,i);U(this,"device");U(this,"glParameters");this.device=r,P_(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){jp(this.device.gl)}pushDebugGroup(r){}popDebugGroup(){}insertDebugMarker(r){}setParameters(r={}){const i={...this.glParameters};this.props.framebuffer&&(i.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,r.viewport&&(r.viewport.length>=6?(i.viewport=r.viewport.slice(0,4),i.depthRange=[r.viewport[4],r.viewport[5]]):i.viewport=r.viewport),r.scissorRect&&(i.scissorTest=!0,i.scissor=r.scissorRect),r.blendConstant&&(i.blendColor=r.blendConstant),r.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),r[2967]=r.stencilReference),r.colorMask&&(i.colorMask=TH.map(n=>!!(n&r.colorMask))),this.glParameters=i,fA(this.device.gl,i)}beginOcclusionQuery(r){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const r=this.props.occlusionQuerySet;r==null||r.endOcclusionQuery()}clear(){const r={...this.glParameters};let i=0;this.props.clearColor!==!1&&(i|=wH,r.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=bH,r.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=xH,r.clearStencil=this.props.clearStencil),i!==0&&Eu(this.device.gl,r,()=>{this.device.gl.clear(i)})}clearColorBuffer(r=0,i=[0,0,0,0]){Eu(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int32Array:this.device.gl.clearBufferiv(bv,r,i);break;case Uint32Array:this.device.gl.clearBufferuiv(bv,r,i);break;case Float32Array:default:this.device.gl.clearBufferfv(bv,r,i);break}})}}const SH="Failed to deduce GL constant from typed array";function CH(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(SH)}}function nb(t,e){const{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const PH={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},IH={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class wp{constructor(...e){U(this,"offset");U(this,"stride");U(this,"type");U(this,"size");U(this,"divisor");U(this,"normalized");U(this,"integer");U(this,"buffer");U(this,"index");e.forEach(r=>this._assign(r)),Object.freeze(this)}static getBytesPerElement(e){return nb(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return _i(e.size),nb(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new wp(PH,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return wp.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return wp.getBytesPerVertex(this)}_assign(e={}){return e=fU("Accessor",e,IH),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function MH(t){return RH.includes(t)}const RH=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],XB={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function qB(t){const e=XB[t];if(!e)throw new Error("uniform");const[r,i,,n]=e;return{format:n,components:i,glType:r}}function BH(t){const e=XB[t];if(!e)throw new Error("attribute");const[,r,,i,n]=e;return{attributeType:i,vertexFormat:n,components:r}}function OH(t,e){const r={attributes:[],bindings:[]};r.attributes=DH(t,e);const i=kH(t,e);for(const f of i){const A=f.uniforms.map(v=>({name:v.name,format:v.format,byteOffset:v.byteOffset,byteStride:v.byteStride,arrayLength:v.arrayLength}));r.bindings.push({type:"uniform",name:f.name,location:f.location,visibility:(f.vertex?1:0)&(f.fragment?2:0),minBindingSize:f.byteLength,uniforms:A})}const n=LH(t,e);let o=0;for(const f of n)if(MH(f.type)){const{viewDimension:A,sampleType:v}=UH(f.type);r.bindings.push({type:"texture",name:f.name,location:o,viewDimension:A,sampleType:v}),f.textureUnit=o,o+=1}n.length&&(r.uniforms=n);const s=FH(t,e);return s!=null&&s.length&&(r.varyings=s),r}function DH(t,e){const r=[],i=t.getProgramParameter(e,35721);for(let n=0;n<i;n++){const o=t.getActiveAttrib(e,n);if(!o)throw new Error("activeInfo");const{name:s,type:f}=o,A=t.getAttribLocation(e,s);if(A>=0){const{attributeType:v}=BH(f),w=/instance/i.test(s)?"instance":"vertex";r.push({name:s,location:A,stepMode:w,type:v})}}return r.sort((n,o)=>n.location-o.location),r}function FH(t,e){const r=[],i=t.getProgramParameter(e,35971);for(let n=0;n<i;n++){const o=t.getTransformFeedbackVarying(e,n);if(!o)throw new Error("activeInfo");const{name:s,type:f,size:A}=o,{glType:v,components:w}=qB(f),C=new wp({type:v,size:A*w}),I={location:n,name:s,accessor:C};r.push(I)}return r.sort((n,o)=>n.location-o.location),r}function LH(t,e){const r=[],i=t.getProgramParameter(e,35718);for(let n=0;n<i;n++){const o=t.getActiveUniform(e,n);if(!o)throw new Error("activeInfo");const{name:s,size:f,type:A}=o,{name:v,isArray:w}=zH(s);let C=t.getUniformLocation(e,v);const I={location:C,name:v,size:f,type:A,isArray:w};if(r.push(I),I.size>1)for(let B=0;B<I.size;B++){const F=`${v}[${B}]`;C=t.getUniformLocation(e,F);const N={...I,name:F,location:C};r.push(N)}}return r}function kH(t,e){const r=(o,s)=>t.getActiveUniformBlockParameter(e,o,s),i=[],n=t.getProgramParameter(e,35382);for(let o=0;o<n;o++){const s={name:t.getActiveUniformBlockName(e,o)||"",location:r(o,35391),byteLength:r(o,35392),vertex:r(o,35396),fragment:r(o,35398),uniformCount:r(o,35394),uniforms:[]},f=r(o,35395)||[],A=t.getActiveUniforms(e,f,35383),v=t.getActiveUniforms(e,f,35384),w=t.getActiveUniforms(e,f,35387),C=t.getActiveUniforms(e,f,35388);for(let I=0;I<s.uniformCount;++I){const B=t.getActiveUniform(e,f[I]);if(!B)throw new Error("activeInfo");s.uniforms.push({name:B.name,format:qB(A[I]).format,type:A[I],arrayLength:v[I],byteOffset:w[I],byteStride:C[I]})}i.push(s)}return i.sort((o,s)=>o.location-s.location),i}const NH={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function UH(t){const e=NH[t];if(!e)throw new Error("sampler");const[r,i]=e;return{viewDimension:r,sampleType:i}}function zH(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const r=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function VH(t,e,r,i){const n=t;let o=i;o===!0&&(o=1),o===!1&&(o=0);const s=typeof o=="number"?[o]:o;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,s);case 35664:return t.uniform2fv(e,s);case 35665:return t.uniform3fv(e,s);case 35666:return t.uniform4fv(e,s);case 5124:return t.uniform1iv(e,s);case 35667:return t.uniform2iv(e,s);case 35668:return t.uniform3iv(e,s);case 35669:return t.uniform4iv(e,s);case 35670:return t.uniform1iv(e,s);case 35671:return t.uniform2iv(e,s);case 35672:return t.uniform3iv(e,s);case 35673:return t.uniform4iv(e,s);case 5125:return n.uniform1uiv(e,s,1);case 36294:return n.uniform2uiv(e,s,2);case 36295:return n.uniform3uiv(e,s,3);case 36296:return n.uniform4uiv(e,s,4);case 35674:return t.uniformMatrix2fv(e,!1,s);case 35675:return t.uniformMatrix3fv(e,!1,s);case 35676:return t.uniformMatrix4fv(e,!1,s);case 35685:return n.uniformMatrix2x3fv(e,!1,s);case 35686:return n.uniformMatrix2x4fv(e,!1,s);case 35687:return n.uniformMatrix3x2fv(e,!1,s);case 35688:return n.uniformMatrix3x4fv(e,!1,s);case 35689:return n.uniformMatrix4x2fv(e,!1,s);case 35690:return n.uniformMatrix4x3fv(e,!1,s)}throw new Error("Illegal uniform")}function jH(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function HH(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const WS=4;class GH extends Xd{constructor(r,i){super(r,i);U(this,"device");U(this,"handle");U(this,"vs");U(this,"fs");U(this,"introspectedLayout");U(this,"uniforms",{});U(this,"bindings",{});U(this,"varyings",null);U(this,"_uniformCount",0);U(this,"_uniformSetters",{});this.device=r,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:n,bufferMode:o=35981}=i;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,o)),this._linkShaders(),Et.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=OH(this.device.gl,this.handle),Et.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=QN(this.introspectedLayout,i.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Et.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(r,i){for(const[n,o]of Object.entries(r)){const s=this.shaderLayout.bindings.find(f=>f.name===n)||this.shaderLayout.bindings.find(f=>f.name===`${n}Uniforms`);if(!s){const f=this.shaderLayout.bindings.map(A=>`"${A.name}"`).join(", ");i!=null&&i.disableWarnings||Et.warn(`Unknown binding "${n}" in render pipeline "${this.id}", expected one of ${f}`)();continue}switch(o||Et.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(o instanceof Iu)&&!(o.buffer instanceof Iu))throw new Error("buffer value");break;case"texture":if(!(o instanceof xd||o instanceof Ul||o instanceof xp))throw new Error("texture value");break;case"sampler":Et.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(s.type)}this.bindings[n]=o}}draw(r){var V;const{renderPass:i,parameters:n=this.props.parameters,topology:o=this.props.topology,vertexArray:s,vertexCount:f,instanceCount:A,isInstanced:v=!1,firstVertex:w=0,transformFeedback:C}=r,I=jH(o),B=!!s.indexBuffer,F=(V=s.indexBuffer)==null?void 0:V.glIndexType;if(this.linkStatus!=="success")return Et.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||f===0)return Et.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(f===0)return Et.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),s.bindBeforeRender(i),C&&C.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const N=i;return $j(this.device,n,N.glParameters,()=>{B&&v?this.device.gl.drawElementsInstanced(I,f||0,F,w,A||0):B?this.device.gl.drawElements(I,f||0,F,w):v?this.device.gl.drawArraysInstanced(I,w,f||0,A||0):this.device.gl.drawArrays(I,w,f||0),C&&C.end()}),s.unbindAfterRender(i),!0}setUniformsWebGL(r){const{bindings:i}=w2(r);Object.keys(i).forEach(n=>{Et.warn(`Unsupported value "${JSON.stringify(i[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,r)}async _linkShaders(){const{gl:r}=this.device;if(r.attachShader(this.handle,this.vs.handle),r.attachShader(this.handle,this.fs.handle),Et.time(WS,`linkProgram for ${this.id}`)(),r.linkProgram(this.handle),Et.timeEnd(WS,`linkProgram for ${this.id}`)(),Et.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Et.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Et.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}_reportLinkStatus(r){var i;switch(r){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((i=this.fs)==null?void 0:i.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${r}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:r}=this.device;return r.getProgramParameter(this.handle,35714)?(r.validateProgram(this.handle),r.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const r=async o=>await new Promise(s=>setTimeout(s,o));if(!this.device.features.has("compilation-status-async-webgl")){await r(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await r(10)}}_areTexturesRenderable(){let r=!0;for(const[,i]of Object.entries(this.bindings))i instanceof Ul&&(i.update(),r=r&&i.loaded);return r}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:r}=this.device;r.useProgram(this.handle);let i=0,n=0;for(const o of this.shaderLayout.bindings){const s=this.bindings[o.name]||this.bindings[o.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${o.name} in ${this.id}`);switch(o.type){case"uniform":const{name:f}=o,A=r.getUniformBlockIndex(this.handle,f);if(A===4294967295)throw new Error(`Invalid uniform block name ${f}`);r.uniformBlockBinding(this.handle,n,A),s instanceof Iu?r.bindBufferBase(35345,n,s.handle):r.bindBufferRange(35345,n,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),n+=1;break;case"texture":if(!(s instanceof xd||s instanceof Ul||s instanceof xp))throw new Error("texture");let v;if(s instanceof xd)v=s.texture;else if(s instanceof Ul)v=s;else if(s instanceof xp&&s.colorAttachments[0]instanceof xd)Et.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),v=s.colorAttachments[0].texture;else throw new Error("No texture");r.activeTexture(33984+i),r.bindTexture(v.target,v.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${o.type}' not supported in WebGL`)}}}_applyUniforms(){for(const r of this.shaderLayout.uniforms||[]){const{name:i,location:n,type:o,textureUnit:s}=r,f=this.uniforms[i]??s;f!==void 0&&VH(this.device.gl,n,o,f)}}}class WH extends F1{constructor(r){super(r,{});U(this,"device");U(this,"commands",[]);this.device=r}submitCommands(r=this.commands){for(const i of r)switch(i.name){case"copy-buffer-to-buffer":XH(this.device,i.options);break;case"copy-buffer-to-texture":qH(this.device,i.options);break;case"copy-texture-to-buffer":$H(this.device,i.options);break;case"copy-texture-to-texture":ZH(this.device,i.options);break}}}function XH(t,e){const r=e.source,i=e.destination;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function qH(t,e){throw new Error("Not implemented")}function $H(t,e){const{source:r,mipLevel:i=0,aspect:n="all",width:o=e.source.width,height:s=e.source.height,depthOrArrayLayers:f=0,origin:A=[0,0],destination:v,byteOffset:w=0,bytesPerRow:C,rowsPerImage:I}=e;if(n!=="all")throw new Error("not supported");if(i!==0||f!==0||C||I)throw new Error("not implemented");const{framebuffer:B,destroyFramebuffer:F}=$B(r);let N;try{const V=v,G=o||B.width,Y=s||B.height,Z=Fm(B.texture.props.format),se=Z.dataFormat,ge=Z.type;t.gl.bindBuffer(35051,V.handle),N=t.gl.bindFramebuffer(36160,B.handle),t.gl.readPixels(A[0],A[1],G,Y,se,ge,w)}finally{t.gl.bindBuffer(35051,null),N!==void 0&&t.gl.bindFramebuffer(36160,N),F&&B.destroy()}}function ZH(t,e){const{source:r,destinationMipLevel:i=0,origin:n=[0,0],destinationOrigin:o=[0,0],destination:s}=e;let{width:f=e.destination.width,height:A=e.destination.height}=e;const{framebuffer:v,destroyFramebuffer:w}=$B(r),[C,I]=n,[B,F,N]=o,V=t.gl.bindFramebuffer(36160,v.handle);let G=null,Y;if(s instanceof Ul)G=s,f=Number.isFinite(f)?f:G.width,A=Number.isFinite(A)?A:G.height,G.bind(0),Y=G.target;else throw new Error("invalid destination");switch(Y){case 3553:case 34067:t.gl.copyTexSubImage2D(Y,i,B,F,C,I,f,A);break;case 35866:case 32879:t.gl.copyTexSubImage3D(Y,i,B,F,N,C,I,f,A);break}G&&G.unbind(),t.gl.bindFramebuffer(36160,V),w&&v.destroy()}function $B(t){if(t instanceof Zo){const{width:e,height:r,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class KH extends D1{constructor(r,i){super(r,i);U(this,"device");U(this,"commandBuffer");this.device=r,this.commandBuffer=new WH(r)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(r){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:r})}copyBufferToTexture(r){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:r})}copyTextureToBuffer(r){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:r})}copyTextureToTexture(r){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:r})}pushDebugGroup(r){}popDebugGroup(){}insertDebugMarker(r){}resolveQuerySet(r,i,n){}}class j2 extends L1{constructor(r,i){super(r,i);U(this,"device");U(this,"handle");U(this,"buffer",null);U(this,"bufferValue",null);this.device=r,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(r){return jL()==="Chrome"}destroy(){var r;super.destroy(),this.buffer&&((r=this.buffer)==null||r.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(r){const i=r;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(r,i){const n=i;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:o,type:s,stride:f,offset:A,normalized:v,integer:w,divisor:C}=this._getAccessor(r);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),w?this.device.gl.vertexAttribIPointer(r,o,s,f,A):this.device.gl.vertexAttribPointer(r,o,s,v,f,A),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(r),this.device.gl.vertexAttribDivisor(r,C||0),this.attributes[r]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(r,i){this._enable(r,!1),this.attributes[r]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let r=0;r<this.maxVertexAttributes;++r){const i=this.attributes[r];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(r,i)}}_getAccessor(r){const i=this.attributeInfos[r];if(!i)throw new Error(`Unknown attribute location ${r}`);const n=VB(i.bufferDataType);return{size:i.bufferComponents,type:n,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(r,i=!0){const o=j2.isConstantAttributeZeroSupported(this.device)||r!==0;(i||o)&&(r=Number(r),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(r):this.device.gl.disableVertexAttribArray(r),this.device.gl.bindVertexArray(null))}getConstantBuffer(r,i){const n=YH(i),o=n.byteLength*r,s=n.length*r;if(this.buffer&&o!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${o} !== ${this.buffer.byteLength}.`);let f=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:o}),f=f||!JH(n,this.bufferValue),f){const A=iU(i.constructor,s);nU({target:A,source:n,start:0,count:s}),this.buffer.write(A),this.bufferValue=i}return this.buffer}}function YH(t){return Array.isArray(t)?new Float32Array(t):t}function JH(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}class QH extends k1{constructor(r,i){super(r,i);U(this,"device");U(this,"gl");U(this,"handle");U(this,"layout");U(this,"buffers",{});U(this,"unusedBuffers",{});U(this,"bindOnUse",!0);U(this,"_bound",!1);this.device=r,this.gl=r.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(r="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(HH(r))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(r){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in r)this.setBuffer(i,r[i])})}setBuffer(r,i){const n=this._getVaryingIndex(r),{buffer:o,byteLength:s,byteOffset:f}=this._getBufferRange(i);if(n<0){this.unusedBuffers[r]=o,Et.warn(`${this.id} unusedBuffers varying buffer ${r}`)();return}this.buffers[n]={buffer:o,byteLength:s,byteOffset:f},this.bindOnUse||this._bindBuffer(n,o,f,s)}getBuffer(r){if(XS(r))return this.buffers[r]||null;const i=this._getVaryingIndex(r);return i>=0?this.buffers[i]:null}bind(r=this.handle){if(typeof r!="function")return this.gl.bindTransformFeedback(36386,r),this;let i;return this._bound?i=r():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=r(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(r){if(r instanceof Iu)return{buffer:r,byteOffset:0,byteLength:r.byteLength};const{buffer:i,byteOffset:n=0,byteLength:o=r.buffer.byteLength}=r;return{buffer:i,byteOffset:n,byteLength:o}}_getVaryingIndex(r){if(XS(r))return Number(r);for(const i of this.layout.varyings)if(r===i.name)return i.location;return-1}_bindBuffers(){for(const r in this.buffers){const{buffer:i,byteLength:n,byteOffset:o}=this._getBufferRange(this.buffers[r]);this._bindBuffer(Number(r),i,o,n)}}_unbindBuffers(){for(const r in this.buffers)this.gl.bindBufferBase(35982,Number(r),null)}_bindBuffer(r,i,n=0,o){const s=i&&i.handle;!s||o===void 0?this.gl.bindBufferBase(35982,r,s):this.gl.bindBufferRange(35982,r,s,n,o)}}function XS(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class eG extends N1{constructor(r,i){super(r,i);U(this,"device");U(this,"handle");U(this,"target",null);U(this,"_queryPending",!1);U(this,"_pollingPromise",null);if(this.device=r,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(r){return this._begin(r!=null&&r.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(r){this._queryPending||(this.target=r,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const r=this.device.gl.getQueryParameter(this.handle,34919);return r&&(this._queryPending=!1),r}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(r=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((n,o)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):i++>r?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}function ZB(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return _i(!1),0}}function tG(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return _i(!1),0}}function rG(t,e){var V,G;const{sourceX:r=0,sourceY:i=0,sourceFormat:n=6408,sourceAttachment:o=36064}=e||{};let{target:s=null,sourceWidth:f,sourceHeight:A,sourceType:v}=e||{};const{framebuffer:w,deleteFramebuffer:C}=KB(t);_i(w);const{gl:I,handle:B}=w;f=f||w.width,A=A||w.height;const F=o-36064;v=v||((G=(V=w.colorAttachments[F])==null?void 0:V.texture)==null?void 0:G.type)||5121,s=sG(s,v,n,f,A),v=v||CH(s);const N=I.bindFramebuffer(36160,B);return I.readPixels(r,i,f,A,n,v,s),I.bindFramebuffer(36160,N||null),C&&w.destroy(),s}function iG(t,e){const{target:r,sourceX:i=0,sourceY:n=0,sourceFormat:o=6408,targetByteOffset:s=0}=e||{};let{sourceWidth:f,sourceHeight:A,sourceType:v}=e||{};const{framebuffer:w,deleteFramebuffer:C}=KB(t);_i(w),f=f||w.width,A=A||w.height;const I=w;v=v||5121;let B=r;if(!B){const N=ZB(o),V=tG(v),G=s+f*A*N*V;B=I.device.createBuffer({byteLength:G})}const F=t.device.createCommandEncoder();return F.copyTextureToBuffer({source:t,width:f,height:A,origin:[i,n],destination:B,byteOffset:s}),F.destroy(),C&&w.destroy(),B}function KB(t){return t instanceof Sm?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:nG(t),deleteFramebuffer:!0}}function nG(t,e){const{device:r,width:i,height:n,id:o}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:i,height:n,colorAttachments:[t]})}function sG(t,e,r,i,n){if(t)return t;e=e||5121;const o=nb(e,{clamped:!1}),s=ZB(r);return new o(i*n*s)}const oG=256,aG=1024,lG=16384,cG="clear: bad arguments";function uG(t,e){const{framebuffer:r=null,color:i=null,depth:n=null,stencil:o=null}=e||{},s={};r&&(s.framebuffer=r);let f=0;i&&(f|=lG,i!==!0&&(s.clearColor=i)),n&&(f|=oG,n!==!0&&(s.clearDepth=n)),o&&(f|=aG,n!==!0&&(s.clearStencil=n)),_i(f!==0,cG);const A=t.gl;Eu(A,s,()=>{A.clear(f)})}const JA=1,Eh=class Eh extends Wd{constructor(r){var A,v;super({...r,id:r.id||Oc("webgl-device")});U(this,"type","webgl");U(this,"handle");U(this,"features");U(this,"limits");U(this,"info");U(this,"canvasContext");U(this,"lost");U(this,"_resolveContextLost");U(this,"renderPass",null);U(this,"gl");U(this,"debug",!1);U(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});U(this,"_extensions",{});U(this,"_polyfilled",!1);U(this,"spectorJS");U(this,"_constants");const i=(A=r.gl)==null?void 0:A.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);const n=((v=r.gl)==null?void 0:v.canvas)||r.canvas;this.canvasContext=new oH(this,{...r,canvas:n}),this.lost=new Promise(w=>{this._resolveContextLost=w});let o=r.gl||null;if(o||(o=Ej(this.canvasContext.canvas,{...r,onContextLost:w=>{var C;return(C=this._resolveContextLost)==null?void 0:C.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!o)throw new Error("WebGL context creation failed");this.handle=o,this.gl=o,this.gl.device=this,this.gl._version=2,r.spector&&(this.spectorJS=hH({...this.props,canvas:this.handle.canvas})),this.info=Sj(this.gl,this._extensions),this.limits=new Xj(this.gl),this.features=new Wj(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:s=!0,copyState:f=!1}=r;UB(this.gl,{enable:s,copyState:f,log:(...w)=>Et.log(1,...w)()}),r.debug&&(this.gl=AH(this.gl,{...r,throwOnError:!0}),this.debug=!0,Et.level=Math.max(Et.level,1),Et.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(r){if(r instanceof Eh)return r;if((r==null?void 0:r.device)instanceof Wd)return r.device;if(!hG(r))throw new Error("Invalid WebGL2RenderingContext");return new Eh({gl:r})}static async create(r={}){var f;Et.groupCollapsed(JA,"WebGLDevice created")();const i=[];r.debug&&i.push(dH()),r.spector&&i.push(uH()),typeof r.canvas=="string"&&i.push(x2.pageLoaded);const n=await Promise.allSettled(i);for(const A of n)A.status==="rejected"&&Et.error(`Failed to initialize debug libraries ${A.reason}`)();if(Et.probe(JA+1,"DOM is loaded")(),(f=r.gl)!=null&&f.device)return Et.warn("reattaching existing device")(),Eh.attach(r.gl);const o=new Eh(r),s=`Created ${o.type}${o.debug?" debug":""} context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Et.probe(JA,s)(),Et.table(JA,o.info)(),Et.groupEnd(JA)(),o}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(r){return V2(this.gl,r,this._extensions)}isTextureFormatFilterable(r){return Vj(this.gl,r,this._extensions)}isTextureFormatRenderable(r){return jj(this.gl,r,this._extensions)}createCanvasContext(r){throw new Error("WebGL only supports a single canvas")}createBuffer(r){const i=this._getBufferProps(r);return new Iu(this,i)}_createTexture(r){return new Ul(this,r)}createExternalTexture(r){throw new Error("createExternalTexture() not implemented")}createSampler(r){return new ib(this,r)}createShader(r){return new vH(this,r)}createFramebuffer(r){return new xp(this,r)}createVertexArray(r){return new j2(this,r)}createTransformFeedback(r){return new QH(this,r)}createQuerySet(r){return new eG(this,r)}createRenderPipeline(r){return new GH(this,r)}beginRenderPass(r){return new EH(this,r)}createComputePipeline(r){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(r){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(r){return new KH(this,r)}submit(){var r;(r=this.renderPass)==null||r.end(),this.renderPass=null}readPixelsToArrayWebGL(r,i){return rG(r,i)}readPixelsToBufferWebGL(r,i){return iG(r,i)}setParametersWebGL(r){fA(this.gl,r)}getParametersWebGL(r){return NB(this.gl,r)}withParametersWebGL(r,i){return Eu(this.gl,r,i)}clearWebGL(r){uG(this,r)}resetWebGL(){Et.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),_j(this.gl)}loseDevice(){var o;let r=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(r=!0,n.loseContext()),(o=this._resolveContextLost)==null||o.call(this,{reason:"destroyed",message:"Application triggered context loss"}),r}pushState(){P_(this.gl)}popState(){jp(this.gl)}setSpectorMetadata(r,i){r.__SPECTOR_Metadata=i}getGLKey(r,i){i=i||this.gl2||this.gl;const n=Number(r);for(const o in i)if(i[o]===n)return`GL.${o}`;return String(r)}setConstantAttributeWebGL(r,i){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const o=this._constants[r];switch(o&&pG(o,i)&&Et.info(1,`setConstantAttributeWebGL(${r}) could have been skipped, value unchanged`)(),this._constants[r]=i,i.constructor){case Float32Array:fG(this,r,i);break;case Int32Array:dG(this,r,i);break;case Uint32Array:AG(this,r,i);break;default:_i(!1)}}getExtension(r){return Bu(this.gl,r,this._extensions),this._extensions}};U(Eh,"type","webgl");let Tp=Eh;function hG(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function fG(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break;default:_i(!1)}}function dG(t,e,r){t.gl.vertexAttribI4iv(e,r)}function AG(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function pG(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var YB={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,r,i,n){var o=["","webkit","Moz","MS","ms","o"],s=r.createElement("div"),f="function",A=Math.round,v=Math.abs,w=Date.now;function C(le,de,Ce){return setTimeout(Z(le,Ce),de)}function I(le,de,Ce){return Array.isArray(le)?(B(le,Ce[de],Ce),!0):!1}function B(le,de,Ce){var Ze;if(le)if(le.forEach)le.forEach(de,Ce);else if(le.length!==n)for(Ze=0;Ze<le.length;)de.call(Ce,le[Ze],Ze,le),Ze++;else for(Ze in le)le.hasOwnProperty(Ze)&&de.call(Ce,le[Ze],Ze,le)}function F(le,de,Ce){var Ze="DEPRECATED METHOD: "+de+`
`+Ce+` AT 
`;return function(){var mt=new Error("get-stack-trace"),Vt=mt&&mt.stack?mt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Vr=e.console&&(e.console.warn||e.console.log);return Vr&&Vr.call(e.console,Ze,Vt),le.apply(this,arguments)}}var N;typeof Object.assign!="function"?N=function(de){if(de===n||de===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ce=Object(de),Ze=1;Ze<arguments.length;Ze++){var mt=arguments[Ze];if(mt!==n&&mt!==null)for(var Vt in mt)mt.hasOwnProperty(Vt)&&(Ce[Vt]=mt[Vt])}return Ce}:N=Object.assign;var V=F(function(de,Ce,Ze){for(var mt=Object.keys(Ce),Vt=0;Vt<mt.length;)(!Ze||Ze&&de[mt[Vt]]===n)&&(de[mt[Vt]]=Ce[mt[Vt]]),Vt++;return de},"extend","Use `assign`."),G=F(function(de,Ce){return V(de,Ce,!0)},"merge","Use `assign`.");function Y(le,de,Ce){var Ze=de.prototype,mt;mt=le.prototype=Object.create(Ze),mt.constructor=le,mt._super=Ze,Ce&&N(mt,Ce)}function Z(le,de){return function(){return le.apply(de,arguments)}}function se(le,de){return typeof le==f?le.apply(de&&de[0]||n,de):le}function ge(le,de){return le===n?de:le}function Pe(le,de,Ce){B(Te(de),function(Ze){le.addEventListener(Ze,Ce,!1)})}function Ue(le,de,Ce){B(Te(de),function(Ze){le.removeEventListener(Ze,Ce,!1)})}function Fe(le,de){for(;le;){if(le==de)return!0;le=le.parentNode}return!1}function pe(le,de){return le.indexOf(de)>-1}function Te(le){return le.trim().split(/\s+/g)}function Ae(le,de,Ce){if(le.indexOf&&!Ce)return le.indexOf(de);for(var Ze=0;Ze<le.length;){if(Ce&&le[Ze][Ce]==de||!Ce&&le[Ze]===de)return Ze;Ze++}return-1}function Le(le){return Array.prototype.slice.call(le,0)}function Ve(le,de,Ce){for(var Ze=[],mt=[],Vt=0;Vt<le.length;){var Vr=le[Vt][de];Ae(mt,Vr)<0&&Ze.push(le[Vt]),mt[Vt]=Vr,Vt++}return Ze=Ze.sort(function(cn,_n){return cn[de]>_n[de]}),Ze}function Xe(le,de){for(var Ce,Ze,mt=de[0].toUpperCase()+de.slice(1),Vt=0;Vt<o.length;){if(Ce=o[Vt],Ze=Ce?Ce+mt:de,Ze in le)return Ze;Vt++}return n}var dt=1;function Nt(){return dt++}function gr(le){var de=le.ownerDocument||le;return de.defaultView||de.parentWindow||e}var mr=/mobile|tablet|ip(ad|hone|od)|android/i,_r="ontouchstart"in e,rr=Xe(e,"PointerEvent")!==n,Ot=_r&&mr.test(navigator.userAgent),Qt="touch",qt="pen",Rt="mouse",ut="kinect",Vi=25,Sr=1,Ur=2,Dt=4,$r=8,Pi=1,yi=2,dr=4,gn=8,oi=16,xi=yi|dr,an=gn|oi,$i=xi|an,Zs=["x","y"],ln=["clientX","clientY"];function ni(le,de){var Ce=this;this.manager=le,this.callback=de,this.element=le.element,this.target=le.options.inputTarget,this.domHandler=function(Ze){se(le.options.enable,[le])&&Ce.handler(Ze)},this.init()}ni.prototype={handler:function(){},init:function(){this.evEl&&Pe(this.element,this.evEl,this.domHandler),this.evTarget&&Pe(this.target,this.evTarget,this.domHandler),this.evWin&&Pe(gr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ue(this.element,this.evEl,this.domHandler),this.evTarget&&Ue(this.target,this.evTarget,this.domHandler),this.evWin&&Ue(gr(this.element),this.evWin,this.domHandler)}};function Is(le){var de,Ce=le.options.inputClass;return Ce?de=Ce:rr?de=yt:Ot?de=Oe:_r?de=he:de=Bo,new de(le,nn)}function nn(le,de,Ce){var Ze=Ce.pointers.length,mt=Ce.changedPointers.length,Vt=de&Sr&&Ze-mt===0,Vr=de&(Dt|$r)&&Ze-mt===0;Ce.isFirst=!!Vt,Ce.isFinal=!!Vr,Vt&&(le.session={}),Ce.eventType=de,Oi(le,Ce),le.emit("hammer.input",Ce),le.recognize(Ce),le.session.prevInput=Ce}function Oi(le,de){var Ce=le.session,Ze=de.pointers,mt=Ze.length;Ce.firstInput||(Ce.firstInput=Yt(de)),mt>1&&!Ce.firstMultiple?Ce.firstMultiple=Yt(de):mt===1&&(Ce.firstMultiple=!1);var Vt=Ce.firstInput,Vr=Ce.firstMultiple,ji=Vr?Vr.center:Vt.center,cn=de.center=Mr(Ze);de.timeStamp=w(),de.deltaTime=de.timeStamp-Vt.timeStamp,de.angle=mn(ji,cn),de.distance=Di(ji,cn),is(Ce,de),de.offsetDirection=kn(de.deltaX,de.deltaY);var _n=qr(de.deltaTime,de.deltaX,de.deltaY);de.overallVelocityX=_n.x,de.overallVelocityY=_n.y,de.overallVelocity=v(_n.x)>v(_n.y)?_n.x:_n.y,de.scale=Vr?ho(Vr.pointers,Ze):1,de.rotation=Vr?Xn(Vr.pointers,Ze):0,de.maxPointers=Ce.prevInput?de.pointers.length>Ce.prevInput.maxPointers?de.pointers.length:Ce.prevInput.maxPointers:de.pointers.length,vt(Ce,de);var Wr=le.element;Fe(de.srcEvent.target,Wr)&&(Wr=de.srcEvent.target),de.target=Wr}function is(le,de){var Ce=de.center,Ze=le.offsetDelta||{},mt=le.prevDelta||{},Vt=le.prevInput||{};(de.eventType===Sr||Vt.eventType===Dt)&&(mt=le.prevDelta={x:Vt.deltaX||0,y:Vt.deltaY||0},Ze=le.offsetDelta={x:Ce.x,y:Ce.y}),de.deltaX=mt.x+(Ce.x-Ze.x),de.deltaY=mt.y+(Ce.y-Ze.y)}function vt(le,de){var Ce=le.lastInterval||de,Ze=de.timeStamp-Ce.timeStamp,mt,Vt,Vr,ji;if(de.eventType!=$r&&(Ze>Vi||Ce.velocity===n)){var cn=de.deltaX-Ce.deltaX,_n=de.deltaY-Ce.deltaY,Wr=qr(Ze,cn,_n);Vt=Wr.x,Vr=Wr.y,mt=v(Wr.x)>v(Wr.y)?Wr.x:Wr.y,ji=kn(cn,_n),le.lastInterval=de}else mt=Ce.velocity,Vt=Ce.velocityX,Vr=Ce.velocityY,ji=Ce.direction;de.velocity=mt,de.velocityX=Vt,de.velocityY=Vr,de.direction=ji}function Yt(le){for(var de=[],Ce=0;Ce<le.pointers.length;)de[Ce]={clientX:A(le.pointers[Ce].clientX),clientY:A(le.pointers[Ce].clientY)},Ce++;return{timeStamp:w(),pointers:de,center:Mr(de),deltaX:le.deltaX,deltaY:le.deltaY}}function Mr(le){var de=le.length;if(de===1)return{x:A(le[0].clientX),y:A(le[0].clientY)};for(var Ce=0,Ze=0,mt=0;mt<de;)Ce+=le[mt].clientX,Ze+=le[mt].clientY,mt++;return{x:A(Ce/de),y:A(Ze/de)}}function qr(le,de,Ce){return{x:de/le||0,y:Ce/le||0}}function kn(le,de){return le===de?Pi:v(le)>=v(de)?le<0?yi:dr:de<0?gn:oi}function Di(le,de,Ce){Ce||(Ce=Zs);var Ze=de[Ce[0]]-le[Ce[0]],mt=de[Ce[1]]-le[Ce[1]];return Math.sqrt(Ze*Ze+mt*mt)}function mn(le,de,Ce){Ce||(Ce=Zs);var Ze=de[Ce[0]]-le[Ce[0]],mt=de[Ce[1]]-le[Ce[1]];return Math.atan2(mt,Ze)*180/Math.PI}function Xn(le,de){return mn(de[1],de[0],ln)+mn(le[1],le[0],ln)}function ho(le,de){return Di(de[0],de[1],ln)/Di(le[0],le[1],ln)}var Ro={mousedown:Sr,mousemove:Ur,mouseup:Dt},ea="mousedown",Ia="mousemove mouseup";function Bo(){this.evEl=ea,this.evWin=Ia,this.pressed=!1,ni.apply(this,arguments)}Y(Bo,ni,{handler:function(de){var Ce=Ro[de.type];Ce&Sr&&de.button===0&&(this.pressed=!0),Ce&Ur&&de.which!==1&&(Ce=Dt),this.pressed&&(Ce&Dt&&(this.pressed=!1),this.callback(this.manager,Ce,{pointers:[de],changedPointers:[de],pointerType:Rt,srcEvent:de}))}});var al={pointerdown:Sr,pointermove:Ur,pointerup:Dt,pointercancel:$r,pointerout:$r},Ks={2:Qt,3:qt,4:Rt,5:ut},Ms="pointerdown",Rs="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ms="MSPointerDown",Rs="MSPointerMove MSPointerUp MSPointerCancel");function yt(){this.evEl=Ms,this.evWin=Rs,ni.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Y(yt,ni,{handler:function(de){var Ce=this.store,Ze=!1,mt=de.type.toLowerCase().replace("ms",""),Vt=al[mt],Vr=Ks[de.pointerType]||de.pointerType,ji=Vr==Qt,cn=Ae(Ce,de.pointerId,"pointerId");Vt&Sr&&(de.button===0||ji)?cn<0&&(Ce.push(de),cn=Ce.length-1):Vt&(Dt|$r)&&(Ze=!0),!(cn<0)&&(Ce[cn]=de,this.callback(this.manager,Vt,{pointers:Ce,changedPointers:[de],pointerType:Vr,srcEvent:de}),Ze&&Ce.splice(cn,1))}});var Ma={touchstart:Sr,touchmove:Ur,touchend:Dt,touchcancel:$r},vi="touchstart",$="touchstart touchmove touchend touchcancel";function ee(){this.evTarget=vi,this.evWin=$,this.started=!1,ni.apply(this,arguments)}Y(ee,ni,{handler:function(de){var Ce=Ma[de.type];if(Ce===Sr&&(this.started=!0),!!this.started){var Ze=oe.call(this,de,Ce);Ce&(Dt|$r)&&Ze[0].length-Ze[1].length===0&&(this.started=!1),this.callback(this.manager,Ce,{pointers:Ze[0],changedPointers:Ze[1],pointerType:Qt,srcEvent:de})}}});function oe(le,de){var Ce=Le(le.touches),Ze=Le(le.changedTouches);return de&(Dt|$r)&&(Ce=Ve(Ce.concat(Ze),"identifier")),[Ce,Ze]}var fe={touchstart:Sr,touchmove:Ur,touchend:Dt,touchcancel:$r},be="touchstart touchmove touchend touchcancel";function Oe(){this.evTarget=be,this.targetIds={},ni.apply(this,arguments)}Y(Oe,ni,{handler:function(de){var Ce=fe[de.type],Ze=De.call(this,de,Ce);Ze&&this.callback(this.manager,Ce,{pointers:Ze[0],changedPointers:Ze[1],pointerType:Qt,srcEvent:de})}});function De(le,de){var Ce=Le(le.touches),Ze=this.targetIds;if(de&(Sr|Ur)&&Ce.length===1)return Ze[Ce[0].identifier]=!0,[Ce,Ce];var mt,Vt,Vr=Le(le.changedTouches),ji=[],cn=this.target;if(Vt=Ce.filter(function(_n){return Fe(_n.target,cn)}),de===Sr)for(mt=0;mt<Vt.length;)Ze[Vt[mt].identifier]=!0,mt++;for(mt=0;mt<Vr.length;)Ze[Vr[mt].identifier]&&ji.push(Vr[mt]),de&(Dt|$r)&&delete Ze[Vr[mt].identifier],mt++;if(ji.length)return[Ve(Vt.concat(ji),"identifier"),ji]}var ce=2500,we=25;function he(){ni.apply(this,arguments);var le=Z(this.handler,this);this.touch=new Oe(this.manager,le),this.mouse=new Bo(this.manager,le),this.primaryTouch=null,this.lastTouches=[]}Y(he,ni,{handler:function(de,Ce,Ze){var mt=Ze.pointerType==Qt,Vt=Ze.pointerType==Rt;if(!(Vt&&Ze.sourceCapabilities&&Ze.sourceCapabilities.firesTouchEvents)){if(mt)Re.call(this,Ce,Ze);else if(Vt&&ke.call(this,Ze))return;this.callback(de,Ce,Ze)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Re(le,de){le&Sr?(this.primaryTouch=de.changedPointers[0].identifier,ze.call(this,de)):le&(Dt|$r)&&ze.call(this,de)}function ze(le){var de=le.changedPointers[0];if(de.identifier===this.primaryTouch){var Ce={x:de.clientX,y:de.clientY};this.lastTouches.push(Ce);var Ze=this.lastTouches,mt=function(){var Vt=Ze.indexOf(Ce);Vt>-1&&Ze.splice(Vt,1)};setTimeout(mt,ce)}}function ke(le){for(var de=le.srcEvent.clientX,Ce=le.srcEvent.clientY,Ze=0;Ze<this.lastTouches.length;Ze++){var mt=this.lastTouches[Ze],Vt=Math.abs(de-mt.x),Vr=Math.abs(Ce-mt.y);if(Vt<=we&&Vr<=we)return!0}return!1}var _=Xe(s.style,"touchAction"),ne=_!==n,ht="compute",qe="auto",gt="manipulation",nt="none",at="pan-x",er="pan-y",ct=yr();function It(le,de){this.manager=le,this.set(de)}It.prototype={set:function(le){le==ht&&(le=this.compute()),ne&&this.manager.element.style&&ct[le]&&(this.manager.element.style[_]=le),this.actions=le.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var le=[];return B(this.manager.recognizers,function(de){se(de.options.enable,[de])&&(le=le.concat(de.getTouchAction()))}),Ir(le.join(" "))},preventDefaults:function(le){var de=le.srcEvent,Ce=le.offsetDirection;if(this.manager.session.prevented){de.preventDefault();return}var Ze=this.actions,mt=pe(Ze,nt)&&!ct[nt],Vt=pe(Ze,er)&&!ct[er],Vr=pe(Ze,at)&&!ct[at];if(mt){var ji=le.pointers.length===1,cn=le.distance<2,_n=le.deltaTime<250;if(ji&&cn&&_n)return}if(!(Vr&&Vt)&&(mt||Vt&&Ce&xi||Vr&&Ce&an))return this.preventSrc(de)},preventSrc:function(le){this.manager.session.prevented=!0,le.preventDefault()}};function Ir(le){if(pe(le,nt))return nt;var de=pe(le,at),Ce=pe(le,er);return de&&Ce?nt:de||Ce?de?at:er:pe(le,gt)?gt:qe}function yr(){if(!ne)return!1;var le={},de=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ce){le[Ce]=de?e.CSS.supports("touch-action",Ce):!0}),le}var Lr=1,ur=2,Yr=4,xr=8,Fr=xr,zr=16,Ar=32;function pr(le){this.options=N({},this.defaults,le||{}),this.id=Nt(),this.manager=null,this.options.enable=ge(this.options.enable,!0),this.state=Lr,this.simultaneous={},this.requireFail=[]}pr.prototype={defaults:{},set:function(le){return N(this.options,le),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(le){if(I(le,"recognizeWith",this))return this;var de=this.simultaneous;return le=zt(le,this),de[le.id]||(de[le.id]=le,le.recognizeWith(this)),this},dropRecognizeWith:function(le){return I(le,"dropRecognizeWith",this)?this:(le=zt(le,this),delete this.simultaneous[le.id],this)},requireFailure:function(le){if(I(le,"requireFailure",this))return this;var de=this.requireFail;return le=zt(le,this),Ae(de,le)===-1&&(de.push(le),le.requireFailure(this)),this},dropRequireFailure:function(le){if(I(le,"dropRequireFailure",this))return this;le=zt(le,this);var de=Ae(this.requireFail,le);return de>-1&&this.requireFail.splice(de,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(le){return!!this.simultaneous[le.id]},emit:function(le){var de=this,Ce=this.state;function Ze(mt){de.manager.emit(mt,le)}Ce<xr&&Ze(de.options.event+ir(Ce)),Ze(de.options.event),le.additionalEvent&&Ze(le.additionalEvent),Ce>=xr&&Ze(de.options.event+ir(Ce))},tryEmit:function(le){if(this.canEmit())return this.emit(le);this.state=Ar},canEmit:function(){for(var le=0;le<this.requireFail.length;){if(!(this.requireFail[le].state&(Ar|Lr)))return!1;le++}return!0},recognize:function(le){var de=N({},le);if(!se(this.options.enable,[this,de])){this.reset(),this.state=Ar;return}this.state&(Fr|zr|Ar)&&(this.state=Lr),this.state=this.process(de),this.state&(ur|Yr|xr|zr)&&this.tryEmit(de)},process:function(le){},getTouchAction:function(){},reset:function(){}};function ir(le){return le&zr?"cancel":le&xr?"end":le&Yr?"move":le&ur?"start":""}function me(le){return le==oi?"down":le==gn?"up":le==yi?"left":le==dr?"right":""}function zt(le,de){var Ce=de.manager;return Ce?Ce.get(le):le}function hi(){pr.apply(this,arguments)}Y(hi,pr,{defaults:{pointers:1},attrTest:function(le){var de=this.options.pointers;return de===0||le.pointers.length===de},process:function(le){var de=this.state,Ce=le.eventType,Ze=de&(ur|Yr),mt=this.attrTest(le);return Ze&&(Ce&$r||!mt)?de|zr:Ze||mt?Ce&Dt?de|xr:de&ur?de|Yr:ur:Ar}});function ta(){hi.apply(this,arguments),this.pX=null,this.pY=null}Y(ta,hi,{defaults:{event:"pan",threshold:10,pointers:1,direction:$i},getTouchAction:function(){var le=this.options.direction,de=[];return le&xi&&de.push(er),le&an&&de.push(at),de},directionTest:function(le){var de=this.options,Ce=!0,Ze=le.distance,mt=le.direction,Vt=le.deltaX,Vr=le.deltaY;return mt&de.direction||(de.direction&xi?(mt=Vt===0?Pi:Vt<0?yi:dr,Ce=Vt!=this.pX,Ze=Math.abs(le.deltaX)):(mt=Vr===0?Pi:Vr<0?gn:oi,Ce=Vr!=this.pY,Ze=Math.abs(le.deltaY))),le.direction=mt,Ce&&Ze>de.threshold&&mt&de.direction},attrTest:function(le){return hi.prototype.attrTest.call(this,le)&&(this.state&ur||!(this.state&ur)&&this.directionTest(le))},emit:function(le){this.pX=le.deltaX,this.pY=le.deltaY;var de=me(le.direction);de&&(le.additionalEvent=this.options.event+de),this._super.emit.call(this,le)}});function Oo(){hi.apply(this,arguments)}Y(Oo,hi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(le){return this._super.attrTest.call(this,le)&&(Math.abs(le.scale-1)>this.options.threshold||this.state&ur)},emit:function(le){if(le.scale!==1){var de=le.scale<1?"in":"out";le.additionalEvent=this.options.event+de}this._super.emit.call(this,le)}});function di(){pr.apply(this,arguments),this._timer=null,this._input=null}Y(di,pr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[qe]},process:function(le){var de=this.options,Ce=le.pointers.length===de.pointers,Ze=le.distance<de.threshold,mt=le.deltaTime>de.time;if(this._input=le,!Ze||!Ce||le.eventType&(Dt|$r)&&!mt)this.reset();else if(le.eventType&Sr)this.reset(),this._timer=C(function(){this.state=Fr,this.tryEmit()},de.time,this);else if(le.eventType&Dt)return Fr;return Ar},reset:function(){clearTimeout(this._timer)},emit:function(le){this.state===Fr&&(le&&le.eventType&Dt?this.manager.emit(this.options.event+"up",le):(this._input.timeStamp=w(),this.manager.emit(this.options.event,this._input)))}});function Do(){hi.apply(this,arguments)}Y(Do,hi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(le){return this._super.attrTest.call(this,le)&&(Math.abs(le.rotation)>this.options.threshold||this.state&ur)}});function ue(){hi.apply(this,arguments)}Y(ue,hi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:xi|an,pointers:1},getTouchAction:function(){return ta.prototype.getTouchAction.call(this)},attrTest:function(le){var de=this.options.direction,Ce;return de&(xi|an)?Ce=le.overallVelocity:de&xi?Ce=le.overallVelocityX:de&an&&(Ce=le.overallVelocityY),this._super.attrTest.call(this,le)&&de&le.offsetDirection&&le.distance>this.options.threshold&&le.maxPointers==this.options.pointers&&v(Ce)>this.options.velocity&&le.eventType&Dt},emit:function(le){var de=me(le.offsetDirection);de&&this.manager.emit(this.options.event+de,le),this.manager.emit(this.options.event,le)}});function Ii(){pr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Y(Ii,pr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[gt]},process:function(le){var de=this.options,Ce=le.pointers.length===de.pointers,Ze=le.distance<de.threshold,mt=le.deltaTime<de.time;if(this.reset(),le.eventType&Sr&&this.count===0)return this.failTimeout();if(Ze&&mt&&Ce){if(le.eventType!=Dt)return this.failTimeout();var Vt=this.pTime?le.timeStamp-this.pTime<de.interval:!0,Vr=!this.pCenter||Di(this.pCenter,le.center)<de.posThreshold;this.pTime=le.timeStamp,this.pCenter=le.center,!Vr||!Vt?this.count=1:this.count+=1,this._input=le;var ji=this.count%de.taps;if(ji===0)return this.hasRequireFailures()?(this._timer=C(function(){this.state=Fr,this.tryEmit()},de.interval,this),ur):Fr}return Ar},failTimeout:function(){return this._timer=C(function(){this.state=Ar},this.options.interval,this),Ar},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Fr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Zi(le,de){return de=de||{},de.recognizers=ge(de.recognizers,Zi.defaults.preset),new Rn(le,de)}Zi.VERSION="2.0.7",Zi.defaults={domEvents:!1,touchAction:ht,enable:!0,inputTarget:null,inputClass:null,preset:[[Do,{enable:!1}],[Oo,{enable:!1},["rotate"]],[ue,{direction:xi}],[ta,{direction:xi},["swipe"]],[Ii],[Ii,{event:"doubletap",taps:2},["tap"]],[di]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ai=1,ns=2;function Rn(le,de){this.options=N({},Zi.defaults,de||{}),this.options.inputTarget=this.options.inputTarget||le,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=le,this.input=Is(this),this.touchAction=new It(this,this.options.touchAction),Zl(this,!0),B(this.options.recognizers,function(Ce){var Ze=this.add(new Ce[0](Ce[1]));Ce[2]&&Ze.recognizeWith(Ce[2]),Ce[3]&&Ze.requireFailure(Ce[3])},this)}Rn.prototype={set:function(le){return N(this.options,le),le.touchAction&&this.touchAction.update(),le.inputTarget&&(this.input.destroy(),this.input.target=le.inputTarget,this.input.init()),this},stop:function(le){this.session.stopped=le?ns:ai},recognize:function(le){var de=this.session;if(!de.stopped){this.touchAction.preventDefaults(le);var Ce,Ze=this.recognizers,mt=de.curRecognizer;(!mt||mt&&mt.state&Fr)&&(mt=de.curRecognizer=null);for(var Vt=0;Vt<Ze.length;)Ce=Ze[Vt],de.stopped!==ns&&(!mt||Ce==mt||Ce.canRecognizeWith(mt))?Ce.recognize(le):Ce.reset(),!mt&&Ce.state&(ur|Yr|xr)&&(mt=de.curRecognizer=Ce),Vt++}},get:function(le){if(le instanceof pr)return le;for(var de=this.recognizers,Ce=0;Ce<de.length;Ce++)if(de[Ce].options.event==le)return de[Ce];return null},add:function(le){if(I(le,"add",this))return this;var de=this.get(le.options.event);return de&&this.remove(de),this.recognizers.push(le),le.manager=this,this.touchAction.update(),le},remove:function(le){if(I(le,"remove",this))return this;if(le=this.get(le),le){var de=this.recognizers,Ce=Ae(de,le);Ce!==-1&&(de.splice(Ce,1),this.touchAction.update())}return this},on:function(le,de){if(le!==n&&de!==n){var Ce=this.handlers;return B(Te(le),function(Ze){Ce[Ze]=Ce[Ze]||[],Ce[Ze].push(de)}),this}},off:function(le,de){if(le!==n){var Ce=this.handlers;return B(Te(le),function(Ze){de?Ce[Ze]&&Ce[Ze].splice(Ae(Ce[Ze],de),1):delete Ce[Ze]}),this}},emit:function(le,de){this.options.domEvents&&qn(le,de);var Ce=this.handlers[le]&&this.handlers[le].slice();if(!(!Ce||!Ce.length)){de.type=le,de.preventDefault=function(){de.srcEvent.preventDefault()};for(var Ze=0;Ze<Ce.length;)Ce[Ze](de),Ze++}},destroy:function(){this.element&&Zl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Zl(le,de){var Ce=le.element;if(Ce.style){var Ze;B(le.options.cssProps,function(mt,Vt){Ze=Xe(Ce.style,Vt),de?(le.oldCssProps[Ze]=Ce.style[Ze],Ce.style[Ze]=mt):Ce.style[Ze]=le.oldCssProps[Ze]||""}),de||(le.oldCssProps={})}}function qn(le,de){var Ce=r.createEvent("Event");Ce.initEvent(le,!0,!0),Ce.gesture=de,de.target.dispatchEvent(Ce)}N(Zi,{INPUT_START:Sr,INPUT_MOVE:Ur,INPUT_END:Dt,INPUT_CANCEL:$r,STATE_POSSIBLE:Lr,STATE_BEGAN:ur,STATE_CHANGED:Yr,STATE_ENDED:xr,STATE_RECOGNIZED:Fr,STATE_CANCELLED:zr,STATE_FAILED:Ar,DIRECTION_NONE:Pi,DIRECTION_LEFT:yi,DIRECTION_RIGHT:dr,DIRECTION_UP:gn,DIRECTION_DOWN:oi,DIRECTION_HORIZONTAL:xi,DIRECTION_VERTICAL:an,DIRECTION_ALL:$i,Manager:Rn,Input:ni,TouchAction:It,TouchInput:Oe,MouseInput:Bo,PointerEventInput:yt,TouchMouseInput:he,SingleTouchInput:ee,Recognizer:pr,AttrRecognizer:hi,Tap:Ii,Pan:ta,Swipe:ue,Pinch:Oo,Rotate:Do,Press:di,on:Pe,off:Ue,each:B,merge:G,extend:V,assign:N,inherit:Y,bindFn:Z,prefixed:Xe});var Uc=typeof e<"u"?e:typeof self<"u"?self:{};Uc.Hammer=Zi,t.exports?t.exports=Zi:e[i]=Zi})(window,document,"Hammer")})(YB);var l0=YB.exports;const gG=oA(l0),Ol=zL({__proto__:null,default:gG},[l0]),JB=1,QB=2,sb=4,mG={mousedown:JB,mousemove:QB,mouseup:sb};function _G(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return!0;return!1}function yG(t){const e=t.prototype.handler;t.prototype.handler=function(i){const n=this.store;i.button>0&&i.type==="pointerdown"&&(_G(n,o=>o.pointerId===i.pointerId)||n.push(i)),e.call(this,i)}}function vG(t){t.prototype.handler=function(r){let i=mG[r.type];i&JB&&r.button>=0&&(this.pressed=!0),i&QB&&r.buttons===0&&(i=sb),this.pressed&&(i&sb&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[r],changedPointers:[r],pointerType:"mouse",srcEvent:r}))}}yG(l0.PointerEventInput);vG(l0.MouseInput);const bG=l0.Manager;class M_{constructor(e,r,i){this.element=e,this.callback=r,this.options={enable:!0,...i}}}const xG=Ol?[[Ol.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Ol.Rotate,{enable:!1}],[Ol.Pinch,{enable:!1}],[Ol.Swipe,{enable:!1}],[Ol.Pan,{threshold:0,enable:!1}],[Ol.Press,{enable:!1}],[Ol.Tap,{event:"doubletap",taps:2,enable:!1}],[Ol.Tap,{event:"anytap",enable:!1}],[Ol.Tap,{enable:!1}]]:null,qS={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},wG={doubletap:["tap"]},TG={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},H2={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},EG={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},$S={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},SG=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",wd=typeof window<"u"?window:global;let ob=!1;try{const t={get passive(){return ob=!0,!0}};wd.addEventListener("test",null,t),wd.removeEventListener("test",null)}catch{ob=!1}const CG=SG.indexOf("firefox")!==-1,{WHEEL_EVENTS:PG}=H2,ZS="wheel",KS=4.000244140625,IG=40,MG=.25;class RG extends M_{constructor(e,r,i){super(e,r,i),this.handleEvent=n=>{if(!this.options.enable)return;let o=n.deltaY;wd.WheelEvent&&(CG&&n.deltaMode===wd.WheelEvent.DOM_DELTA_PIXEL&&(o/=wd.devicePixelRatio),n.deltaMode===wd.WheelEvent.DOM_DELTA_LINE&&(o*=IG)),o!==0&&o%KS===0&&(o=Math.floor(o/KS)),n.shiftKey&&o&&(o=o*MG),this.callback({type:ZS,center:{x:n.clientX,y:n.clientY},delta:-o,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(PG),this.events.forEach(n=>e.addEventListener(n,this.handleEvent,ob?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===ZS&&(this.options.enable=r)}}const{MOUSE_EVENTS:BG}=H2,YS="pointermove",JS="pointerover",QS="pointerout",eC="pointerenter",tC="pointerleave";class OG extends M_{constructor(e,r,i){super(e,r,i),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(BG),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===YS&&(this.enableMoveEvent=r),e===JS&&(this.enableOverEvent=r),e===QS&&(this.enableOutEvent=r),e===eC&&(this.enableEnterEvent=r),e===tC&&(this.enableLeaveEvent=r)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(JS,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(QS,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(eC,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(tC,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(YS,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const{KEY_EVENTS:DG}=H2,rC="keydown",iC="keyup";class FG extends M_{constructor(e,r,i){super(e,r,i),this.handleEvent=n=>{const o=n.target||n.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:rC,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:iC,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(DG),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===rC&&(this.enableDownEvent=r),e===iC&&(this.enableUpEvent=r)}}const nC="contextmenu";class LG extends M_{constructor(e,r,i){super(e,r,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:nC,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e===nC&&(this.options.enable=r)}}const sC=1,ab=2,oC=4,kG={pointerdown:sC,pointermove:ab,pointerup:oC,mousedown:sC,mousemove:ab,mouseup:oC},NG=0,UG=1,zG=2,VG=1,jG=2,HG=4;function GG(t){const e=kG[t.srcEvent.type];if(!e)return null;const{buttons:r,button:i}=t.srcEvent;let n=!1,o=!1,s=!1;return e===ab?(n=!!(r&VG),o=!!(r&HG),s=!!(r&jG)):(n=i===NG,o=i===UG,s=i===zG),{leftButton:n,middleButton:o,rightButton:s}}function WG(t,e){const r=t.center;if(!r)return null;const i=e.getBoundingClientRect(),n=i.width/e.offsetWidth||1,o=i.height/e.offsetHeight||1,s={x:(r.x-i.left-e.clientLeft)/n,y:(r.y-i.top-e.clientTop)/o};return{center:r,offsetCenter:s}}const xv={srcElement:"root",priority:0};class XG{constructor(e){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let n=r.srcEvent.target;for(;n&&n!==i.rootElement;){if(this._emit(i,n),i.handled)return;n=n.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,i,n=!1,o=!1){const{handlers:s,handlersByElement:f}=this;let A=xv;typeof i=="string"||i&&i.addEventListener?A={...xv,srcElement:i}:i&&(A={...xv,...i});let v=f.get(A.srcElement);v||(v=[],f.set(A.srcElement,v));const w={type:e,handler:r,srcElement:A.srcElement,priority:A.priority};n&&(w.once=!0),o&&(w.passive=!0),s.push(w),this._active=this._active||!w.passive;let C=v.length-1;for(;C>=0&&!(v[C].priority>=w.priority);)C--;v.splice(C+1,0,w)}remove(e,r){const{handlers:i,handlersByElement:n}=this;for(let o=i.length-1;o>=0;o--){const s=i[o];if(s.type===e&&s.handler===r){i.splice(o,1);const f=n.get(s.srcElement);f.splice(f.indexOf(s),1),f.length===0&&n.delete(s.srcElement)}}this._active=i.some(o=>!o.passive)}_emit(e,r){const i=this.handlersByElement.get(r);if(i){let n=!1;const o=()=>{e.handled=!0},s=()=>{e.handled=!0,n=!0},f=[];for(let A=0;A<i.length;A++){const{type:v,handler:w,once:C}=i[A];if(w({...e,type:v,stopPropagation:o,stopImmediatePropagation:s}),C&&f.push(i[A]),n)break}for(let A=0;A<f.length;A++){const{type:v,handler:w}=f[A];this.remove(v,w)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...GG(e),...WG(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}const qG={events:null,recognizers:null,recognizerOptions:{},Manager:bG,touchAction:"none",tabIndex:0};class e4{constructor(e=null,r){this._onBasicInput=n=>{const{srcEvent:o}=n,s=TG[o.type];s&&this.manager.emit(s,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...qG,...r},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:r}=this,i=r.Manager;this.manager=new i(e,{touchAction:r.touchAction,recognizers:r.recognizers||xG}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(qS).forEach(n=>{const o=this.manager.get(n);o&&qS[n].forEach(s=>{o.recognizeWith(s)})});for(const n in r.recognizerOptions){const o=this.manager.get(n);if(o){const s=r.recognizerOptions[n];delete s.enable,o.set(s)}}this.wheelInput=new RG(e,this._onOtherEvent,{enable:!1}),this.moveInput=new OG(e,this._onOtherEvent,{enable:!1}),this.keyInput=new FG(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new LG(e,this._onOtherEvent,{enable:!1});for(const[n,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(n,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,r,i){this._addEventHandler(e,r,i,!1)}once(e,r,i){this._addEventHandler(e,r,i,!0)}watch(e,r,i){this._addEventHandler(e,r,i,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){const{manager:i}=this;if(!i)return;const n=i.get(e);if(n&&n.options.enable!==r){n.set({enable:r});const o=wG[e];o&&!this.options.recognizers&&o.forEach(s=>{const f=i.get(s);r?(f.requireFailure(e),n.dropRequireFailure(s)):f.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,r),this.moveInput.enableEventType(e,r),this.keyInput.enableEventType(e,r),this.contextmenuInput.enableEventType(e,r)}_addEventHandler(e,r,i,n,o){if(typeof e!="string"){i=r;for(const w in e)this._addEventHandler(w,e[w],i,n,o);return}const{manager:s,events:f}=this,A=$S[e]||e;let v=f.get(A);v||(v=new XG(this),f.set(A,v),v.recognizerName=EG[A]||A,s&&s.on(A,v.handleEvent)),v.add(e,r,i,n,o),v.isEmpty()||this._toggleRecognizer(v.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const s in e)this._removeEventHandler(s,e[s]);return}const{events:i}=this,n=$S[e]||e,o=i.get(n);if(o&&(o.remove(e,r),o.isEmpty())){const{recognizerName:s}=o;let f=!1;for(const A of i.values())if(A.recognizerName===s&&!A.isEmpty()){f=!0;break}f||this._toggleRecognizer(s,!1)}}}function gu(){}const $G=({isDragging:t})=>t?"grabbing":"grab",t4={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:gu,onWebGLInitialized:gu,onResize:gu,onViewStateChange:gu,onInteractionStateChange:gu,onBeforeRender:gu,onAfterRender:gu,onLoad:gu,onError:t=>fr.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:$G,getTooltip:null,debug:!1,drawPickingColors:!1};class G2{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new cA({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:n}=this;if(i.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(i.leftButton||i.rightButton)return;{const o=i.offsetCenter;if(!o)return;n.x=o.x,n.y=o.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=i},this._onEvent=i=>{const n=X1[i.type],o=i.offsetCenter;if(!n||!o||!this.layerManager)return;const s=this.layerManager.getLayers(),f=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:s,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:A}=f,v=A&&(A[n.handler]||A.props[n.handler]),w=this.props[n.handler];let C=!1;v&&(C=v.call(A,f,i)),C||(w==null||w(f,i),this.widgetManager.onEvent(f,i))},this._onPointerDown=i=>{const n=i.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...t4,...e},e=this.props,e.viewState&&e.initialViewState&&fr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&fr.error("WebGL1 context not supported.")(),this.device=Tp.attach(e.gl));let r=this.device;r||(Od.registerDevices([Tp]),r=Od.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&Zd.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,r,i,n,o,s,f,A,v,w;(e=this.animationLoop)==null||e.stop(),(r=this.animationLoop)==null||r.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(i=this.layerManager)==null||i.finalize(),this.layerManager=null,(n=this.viewManager)==null||n.finalize(),this.viewManager=null,(o=this.effectManager)==null||o.finalize(),this.effectManager=null,(s=this.deckRenderer)==null||s.finalize(),this.deckRenderer=null,(f=this.deckPicker)==null||f.finalize(),this.deckPicker=null,(A=this.eventManager)==null||A.destroy(),this.eventManager=null,(v=this.widgetManager)==null||v.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((w=this.canvas.parentElement)==null||w.removeChild(this.canvas),this.canvas=null)}setProps(e){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&fr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&fr.removed("onLayerClick","onClick")(),e.initialViewState&&!Ws(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return r=r||i||n||o||s,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return Cs(this.viewManager),this.viewManager.views}getViewports(e){return Cs(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:r})}_removeResources(e){for(const r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var r;(r=this.layerManager)==null||r.removeDefaultShaderModule(e)}_pick(e,r,i){Cs(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(r).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(r).timeEnd(),o}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),Cs(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){var n;if(!this.canvas)return;const{width:r,height:i}=e;if(r||r===0){const o=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=o}if(i||i===0){const o=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=((n=e.style)==null?void 0:n.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var n,o;const{canvas:e}=this;if(!e)return;const r=e.clientWidth??e.width,i=e.clientHeight??e.height;(r!==this.width||i!==this.height)&&(this.width=r,this.height=i,(n=this.viewManager)==null||n.setProps({width:r,height:i}),(o=this.layerManager)==null||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:i}))}_createAnimationLoop(e,r){const{gl:i,onError:n,useDevicePixels:o}=r;return new rV({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new FB({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var r,i,n;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:s}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let f=s,A=!1;for(const v of o)f=v,A=((r=v.layer)==null?void 0:r.onHover(v,e.event))||A;A||((n=(i=this.props).onHover)==null||n.call(i,f,e.event),this.widgetManager.onHover(f,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var n,o;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(n=this.device.canvasContext)==null?void 0:n.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Tp&&this.props.onWebGLInitialized(this.device.gl);const r=new IB;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new e4(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in X1)this.eventManager.on(s,this._onEvent);this.viewManager=new NV({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new kV(this.device,{deck:this,stats:this.stats,viewport:i,timeline:r}),this.effectManager=new ej({deck:this,device:this.device}),this.deckRenderer=new ij(this.device),this.deckPicker=new cj(this.device),this.widgetManager=new fj({deck:this,parentElement:(o=this.canvas)==null?void 0:o.parentElement}),this.widgetManager.addDefault(new Aj),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){var s;const{device:i,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:n});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};(s=this.deckRenderer)==null||s.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:i,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),fr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const i=Od.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}G2.defaultProps=t4;G2.VERSION=U5;function ZG(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return LR(t)}}const KG=FR;function mg(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Ch(t){return t.stride||t.size*t.bytesPerElement}function YG(t,e){return t.type===e.type&&t.size===e.size&&Ch(t)===Ch(e)&&(t.offset||0)===(e.offset||0)}function lb(t,e){e.offset&&fr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=Ch(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,n=e.elementOffset||0,o=i*r+n*t.bytesPerElement+(t.offset||0);return{...e,offset:o,stride:r}}function JG(t,e){const r=lb(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}class QG{constructor(e,r,i){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;const n=r.logicalType||r.type,o=n==="float64";let{defaultValue:s}=r;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let f;o?f="float32":!n&&r.isIndexed?f="uint32":f=n||"float32";let A=ZG(n||f);this.doublePrecision=o,o&&r.fp64===!1&&(A=Float32Array),this.value=null,this.settings={...r,defaultType:A,defaultValue:s,logicalType:n,type:f,normalized:f.includes("norm"),size:this.size,bytesPerElement:A.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ch(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Zd.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){const i={};if(this.state.constant){const n=this.value;if(r){const o=lb(this.getAccessor(),r),s=o.offset/n.BYTES_PER_ELEMENT,f=o.size||this.size;i[e]=n.subarray(s,s+f)}else i[e]=n}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,r=null){const i=this.getAccessor(),n=[],o={name:this.id,byteStride:Ch(i),attributes:n};if(this.doublePrecision){const s=JG(i,r||{});n.push(mg(e,{...i,...s.high}),mg(`${e}64Low`,{...i,...s.low}))}else if(r){const s=lb(i,r);n.push(mg(e,{...i,...s}))}else n.push(mg(e,i));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const r=Array.from(this.value);e=[r,r]}else{const{value:r,numInstances:i,size:n}=this,o=i*n;if(r&&o&&r.length>=o){const s=new Array(n).fill(1/0),f=new Array(n).fill(-1/0);for(let A=0;A<o;)for(let v=0;v<n;v++){const w=r[A++];w<s[v]&&(s[v]=w),w>f[v]&&(f[v]=w)}e=[s,f]}}return this.state.bounds=e,e}setData(e){const{state:r}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof In?i={buffer:e}:i=e;const n={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)n.type="float32";else{const s=KG(i.value);n.type=n.normalized?s.replace("int","norm"):s}n.bytesPerElement=i.value.BYTES_PER_ELEMENT,n.stride=Ch(n)}if(r.bounds=null,i.constant){let o=i.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!r.constant||!this._areValuesEqual(o,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(i.buffer){const o=i.buffer;r.externalBuffer=o,r.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let o=i.value;r.externalBuffer=null,r.constant=!1,this.value=o;let{buffer:s}=this;const f=Ch(n),A=(n.vertexOffset||0)*f;if(this.doublePrecision&&o instanceof Float64Array&&(o=cv(o,n)),this.settings.isIndexed){const w=this.settings.defaultType;o.constructor!==w&&(o=new w(o))}const v=o.byteLength+A+f*2;(!s||s.byteLength<v)&&(s=this._createBuffer(v)),s.write(o,A)}return this.setAccessor(n),!0}updateSubBuffer(e={}){this.state.bounds=null;const r=this.value,{startOffset:i=0,endOffset:n}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?cv(r,{size:this.size,startIndex:i,endIndex:n}):r.subarray(i,n),i*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){const{state:i}=this,n=i.allocatedValue,o=Zd.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=o;const{byteOffset:s}=this;let{buffer:f}=this;return(!f||f.byteLength<o.byteLength+s)&&(f=this._createBuffer(o.byteLength+s),r&&n&&f.write(n instanceof Float64Array?cv(n,this):n,s)),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=r.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof i)&&this.settings.normalized&&!("normalized"in e)&&fr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,i){const{defaultValue:n,size:o}=this.settings;if(Number.isFinite(e))return r[i]=e,r;if(!e){let s=o;for(;--s>=0;)r[i+s]=n[s];return r}switch(o){case 4:r[i+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:r[i+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:r[i+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:r[i+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let s=o;for(;--s>=0;)r[i+s]=Number.isFinite(e[s])?e[s]:n[s]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;const{size:i}=this;for(let n=0;n<i;n++)if(e[n]!==r[n])return!1;return!0}_createBuffer(e){var n;this._buffer&&this._buffer.destroy();const{isIndexed:r,type:i}=this.settings;return this._buffer=this.device.createBuffer({...(n=this._buffer)==null?void 0:n.props,id:this.id,usage:r?In.INDEX:In.VERTEX,indexType:r?i:void 0,byteLength:e}),this._buffer}}const aC=[],lC=[];function ql(t,e=0,r=1/0){let i=aC;const n={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(lC.length=t.length,i=lC):i=aC,(e>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,r),n.index=e-1),{iterable:i,objectInfo:n}}function r4(t){return t&&t[Symbol.asyncIterator]}function i4(t,e){const{size:r,stride:i,offset:n,startIndices:o,nested:s}=e,f=t.BYTES_PER_ELEMENT,A=i?i/f:r,v=n?n/f:0,w=Math.floor((t.length-v)/A);return(C,{index:I,target:B})=>{if(!o){const G=I*A+v;for(let Y=0;Y<r;Y++)B[Y]=t[G+Y];return B}const F=o[I],N=o[I+1]||w;let V;if(s){V=new Array(N-F);for(let G=F;G<N;G++){const Y=G*A+v;B=new Array(r);for(let Z=0;Z<r;Z++)B[Z]=t[Y+Z];V[G-F]=B}}else if(A===r)V=t.subarray(F*r+v,N*r+v);else{V=new t.constructor((N-F)*r);let G=0;for(let Y=F;Y<N;Y++){const Z=Y*A+v;for(let se=0;se<r;se++)V[G++]=t[Z+se]}}return V}}const eW=[],nm=[[0,1/0]];function tW(t,e){if(t===nm||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const r=[],i=t.length;let n=0;for(let o=0;o<i;o++){const s=t[o];s[1]<e[0]?(r.push(s),n=o+1):s[0]>e[1]?r.push(s):e=[Math.min(s[0],e[0]),Math.max(s[1],e[1])]}return r.splice(n,0,e),r}const rW={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function n4(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const r=t.type||"interpolation";return{...rW[r],...e,...t,type:r}}class s4 extends QG{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:nm}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!YG(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:r}=this.settings,i=this.settings.transition,n=Array.isArray(r)?e[r.find(o=>e[o])]:e[r];return n4(n,i)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){const{startRow:i=0,endRow:n=1/0}=r;this.state.updateRanges=tW(this.state.updateRanges,[i,n])}else this.state.updateRanges=nm}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=eW}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:r,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,r.updateRanges!==nm),!0):!1}updateBuffer({numInstances:e,data:r,props:i,context:n}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:s,noAlloc:f}}=this;let A=!0;if(s){for(const[v,w]of o)s.call(n,this,{data:r,startRow:v,endRow:w,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[v,w]of o){const C=Number.isFinite(v)?this.getVertexOffset(v):0,I=Number.isFinite(w)?this.getVertexOffset(w):f||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:C,endOffset:I})}this._checkAttributeArray()}else A=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),A}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){const{state:i,settings:n}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),n.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const s=e;Cs(ArrayBuffer.isView(s.value),`invalid ${n.accessor}`);const f=!!s.size&&s.size!==this.size;return i.binaryAccessor=i4(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:r,nested:f}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(const i in e)Object.assign(r,super.getValue(i,e[i]));return r}getBufferLayout(e){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=n??"vertex",!r)return i;for(const o in r){const s=super._getBufferLayout(o,r[o]);i.attributes.push(...s.attributes)}return i}_autoUpdater(e,{data:r,startRow:i,endRow:n,props:o,numInstances:s}){if(e.constant)return;const{settings:f,state:A,value:v,size:w,startIndices:C}=e,{accessor:I,transform:B}=f,F=A.binaryAccessor||(typeof I=="function"?I:o[I]);Cs(typeof F=="function",`accessor "${I}" is not a function`);let N=e.getVertexOffset(i);const{iterable:V,objectInfo:G}=ql(r,i,n);for(const Y of V){G.index++;let Z=F(Y,G);if(B&&(Z=B.call(this,Z)),C){const se=(G.index<C.length-1?C[G.index+1]:s)-C[G.index];if(Z&&Array.isArray(Z[0])){let ge=N;for(const Pe of Z)e._normalizeValue(Pe,v,ge),ge+=w}else Z&&Z.length>w?v.set(Z,N):(e._normalizeValue(Z,G.target,0),BV({target:v,source:G.target,start:N,count:se}));N+=se*w}else e._normalizeValue(Z,v,N),N+=w}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let i=!0;switch(r){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function wv(t){const{source:e,target:r,start:i=0,size:n,getData:o}=t,s=t.end||r.length,f=e.length,A=s-i;if(f>A){r.set(e.subarray(0,A),i);return}if(r.set(e,i),!o)return;let v=f;for(;v<A;){const w=o(v,e);for(let C=0;C<n;C++)r[i+v]=w[C]||0,v++}}function iW({source:t,target:e,size:r,getData:i,sourceStartIndices:n,targetStartIndices:o}){if(!n||!o)return wv({source:t,target:e,size:r,getData:i}),e;let s=0,f=0;const A=i&&((w,C)=>i(w+f,C)),v=Math.min(n.length,o.length);for(let w=1;w<v;w++){const C=n[w]*r,I=o[w]*r;wv({source:t.subarray(s,C),target:e,start:f,end:I,size:r,getData:A}),s=C,f=I}return f<e.length&&wv({source:[],target:e,start:f,size:r,getData:A}),e}function nW(t){const{device:e,settings:r,value:i}=t,n=new s4(e,r);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),n}function o4(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function a4(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function l4(t){t.push(t.shift())}function sW(t,e){const{doublePrecision:r,settings:i,value:n,size:o}=t,s=r&&n instanceof Float64Array?2:1;let f=0;const{shaderAttributes:A}=t.settings;if(A)for(const v of Object.values(A))f=Math.max(f,v.vertexOffset??0);return(i.noAlloc?n.length:(e+f)*o)*s}function c4({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r==null||r.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function u4({device:t,buffer:e,attribute:r,fromLength:i,toLength:n,fromStartIndices:o,getData:s=f=>f}){const f=r.doublePrecision&&r.value instanceof Float64Array?2:1,A=r.size*f,v=r.byteOffset,w=r.settings.bytesPerElement<4?v/r.settings.bytesPerElement*4:v,C=r.startIndices,I=o&&C,B=r.isConstant;if(!I&&e&&i>=n)return e;const F=r.value instanceof Float64Array?Float32Array:r.value.constructor,N=B?r.value:new F(r.getBuffer().readSyncWebGL(v,n*F.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!B){const Z=s;s=(se,ge)=>r.normalizeConstant(Z(se,ge))}const V=B?(Z,se)=>s(N,se):(Z,se)=>s(N.subarray(Z+v,Z+v+A),se),G=e?new Float32Array(e.readSyncWebGL(w,i*4).buffer):new Float32Array(0),Y=new Float32Array(n);return iW({source:G,target:Y,sourceStartIndices:o,targetStartIndices:C,size:A,getData:V}),(!e||e.byteLength<Y.byteLength+w)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:Y.byteLength+w,usage:35050})),e.write(Y,w),e}class h4{constructor({device:e,attribute:r,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new C_(i),this.attribute=r,this.attributeInTransition=nW(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=sW(this.attribute,r),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class oW extends h4{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="interpolation",this.transform=cW(e,r)}start(e,r){const i=this.currentLength,n=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:s}=this;l4(o),o[0]=u4({device:this.device,buffer:o[0],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter}),o[1]=c4({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:f}=this,A=f.model;let v=Math.floor(this.currentLength/s.size);f4(s)&&(v/=2),A.setVertexCount(v),s.isConstant?(A.setAttributes({aFrom:o[0]}),A.setConstantAttributes({aTo:s.value})):A.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),f.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:r}=this.settings,{time:i}=this.transition;let n=i/e;r&&(n=r(n));const{model:o}=this.transform;o.setUniforms({time:n}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const aW=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,lW=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function f4(t){return t.doublePrecision&&t.value instanceof Float64Array}function cW(t,e){const r=e.size,i=o4(r),n=a4(r),o=e.getBufferLayout();return f4(e)?new Vp(t,{vs:lW,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*r}]}],modules:[T_],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Vp(t,{vs:aW,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:o.attributes[0].format}],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class uW extends h4{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="spring",this.texture=AW(e),this.framebuffer=pW(e,this.texture),this.transform=dW(e,r)}start(e,r){const i=this.currentLength,n=this.currentStartIndices;super.start(e,r);const{buffers:o,attribute:s}=this;for(let A=0;A<2;A++)o[A]=u4({device:this.device,buffer:o[A],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter});o[2]=c4({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:f}=this.transform;f.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?f.setConstantAttributes({aTo:s.value}):f.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:e,transform:r,framebuffer:i,transition:n}=this,o=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]}),r.model.setUniforms({stiffness:o.stiffness,damping:o.damping}),r.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),l4(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const hW=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fW=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function dW(t,e){const r=o4(e.size),i=a4(e.size);return new Vp(t,{vs:hW,fs:fW,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function AW(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function pW(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const gW={interpolation:oW,spring:uW};class mW{constructor(e,{id:r,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:i}){this.numInstances=i||1;for(const n in e){const o=e[n],s=o.getTransitionSetting(r);s&&this._updateAttribute(n,o,s)}for(const n in this.transitions){const o=e[n];(!o||!o.getTransitionSetting(r))&&this._removeTransition(n)}}hasAttribute(e){const r=this.transitions[e];return r&&r.inProgress}getAttributes(){const e={};for(const r in this.transitions){const i=this.transitions[r];i.inProgress&&(e[r]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,i){const n=this.transitions[e];let o=!n||n.type!==i.type;if(o){n&&this._removeTransition(e);const s=gW[i.type];s?this.transitions[e]=new s({attribute:r,timeline:this.timeline,device:this.device}):(fr.error(`unsupported transition type '${i.type}'`)(),o=!1)}(o||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const cC="attributeManager.invalidate",_W="attributeManager.updateStart",yW="attributeManager.updateEnd",vW="attribute.updateStart",bW="attribute.allocate",xW="attribute.updateEnd";class W2{constructor(e,{id:r="attribute-manager",stats:i,timeline:n}={}){this.mergeBoundsMemoized=a0(W7),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new mW(e,{id:`${r}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){const i=this._invalidateTrigger(e,r);js(cC,this,e,i)}invalidateAll(e){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);js(cC,this,"all")}update({data:e,numInstances:r,startIndices:i=null,transitions:n,props:o={},buffers:s={},context:f={}}){let A=!1;js(_W,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const v in this.attributes){const w=this.attributes[v],C=w.settings.accessor;w.startIndices=i,w.numInstances=r,o[v]&&fr.removed(`props.${v}`,`data.attributes.${v}`)(),w.setExternalBuffer(s[v])||w.setBinaryValue(typeof C=="string"?s[C]:void 0,e.startIndices)||typeof C=="string"&&!s[C]&&w.setConstantValue(o[C])||w.needsUpdate()&&(A=!0,this._updateAttribute({attribute:w,numInstances:r,data:e,props:o,context:f})),this.needsRedraw=this.needsRedraw||w.needsRedraw()}A&&js(yW,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:n})}updateTransition(){const{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const r=e.map(i=>{var n;return(n=this.attributes[i])==null?void 0:n.getBounds()});return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(const o in r){const s=r[o];s.needsRedraw(e)&&!i.hasAttribute(o)&&(n[o]=s)}return n}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(const i in e){const n=e[i],o={...n,id:i,size:n.isIndexed&&1||n.size||1,...r};this.attributes[i]=new s4(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){const{attributes:i,updateTriggers:n}=this,o=n[e];return o&&o.forEach(s=>{const f=i[s];f&&f.setNeedsUpdate(f.id,r)}),o}_updateAttribute(e){const{attribute:r,numInstances:i}=e;if(js(vW,r),r.constant){r.setConstantValue(r.value);return}r.allocate(i)&&js(bW,r,i),r.updateBuffer(e)&&(this.needsRedraw=!0,js(xW,r,i))}}class wW extends C_{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:r,toValue:i,duration:n,easing:o}}=this,s=o(e/n);this._value=el(r,i,s)}}const uC=1e-5;function hC(t,e,r,i,n){const o=e-t,f=(r-e)*n,A=-o*i;return f+A+o+e}function TW(t,e,r,i,n){if(Array.isArray(r)){const o=[];for(let s=0;s<r.length;s++)o[s]=hC(t[s],e[s],r[s],i,n);return o}return hC(t,e,r,i,n)}function fC(t,e){if(Array.isArray(t)){let r=0;for(let i=0;i<t.length;i++){const n=t[i]-e[i];r+=n*n}return Math.sqrt(r)}return Math.abs(t-e)}class EW extends C_{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:r,damping:i,stiffness:n}=this.settings,{_prevValue:o=e,_currValue:s=e}=this;let f=TW(o,s,r,i,n);const A=fC(f,r),v=fC(f,s);A<uC&&v<uC&&(f=r,this.end()),this._prevValue=s,this._currValue=f}}const SW={interpolation:wW,spring:EW};class CW{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,i,n){const{transitions:o}=this;if(o.has(e)){const A=o.get(e),{value:v=A.settings.fromValue}=A;r=v,this.remove(e)}if(n=n4(n),!n)return;const s=SW[n.type];if(!s){fr.error(`unsupported transition type '${n.type}'`)();return}const f=new s(this.timeline);f.start({...n,fromValue:r,toValue:i}),o.set(e,f)}remove(e){const{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){const e={};for(const[r,i]of this.transitions)i.update(),e[r]=i.value,i.inProgress||this.remove(r);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function PW(t){const e=t[Pu];for(const r in e){const i=e[r],{validate:n}=i;if(n&&!n(t[r],i))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function IW(t,e){const r=X2({newProps:t,oldProps:e,propTypes:t[Pu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=RW(t,e);let n=!1;return i||(n=BW(t,e)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:OW(t,e),transitionsChanged:MW(t,e)}}function MW(t,e){if(!t.transitions)return!1;const r={},i=t[Pu];let n=!1;for(const o in t.transitions){const s=i[o],f=s&&s.type;(f==="number"||f==="color"||f==="array")&&cb(t[o],e[o],s)&&(r[o]=!0,n=!0)}return n?r:!1}function X2({newProps:t,oldProps:e,ignoreProps:r={},propTypes:i={},triggerName:n="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${n} changed shallowly`;if(typeof e!="object"||e===null)return`${n} changed shallowly`;for(const o of Object.keys(t))if(!(o in r)){if(!(o in e))return`${n}.${o} added`;const s=cb(t[o],e[o],i[o]);if(s)return`${n}.${o} ${s}`}for(const o of Object.keys(e))if(!(o in r)){if(!(o in t))return`${n}.${o} dropped`;if(!Object.hasOwnProperty.call(t,o)){const s=cb(t[o],e[o],i[o]);if(s)return`${n}.${o} ${s}`}}return!1}function cb(t,e,r){let i=r&&r.equal;return i&&!i(t,e,r)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function RW(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:i,_dataDiff:n}=t;return i?i(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&n&&(r=n(t.data,e.data)||r),r}function BW(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&dC(t,e,"all"))return{all:!0};const r={};let i=!1;for(const n in t.updateTriggers)n!=="all"&&dC(t,e,n)&&(r[n]=!0,i=!0);return i?r:!1}function OW(t,e){if(e===null)return!0;const r=e.extensions,{extensions:i}=t;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(r[n]))return!0;return!1}function dC(t,e,r){let i=t.updateTriggers[r];i=i??{};let n=e.updateTriggers[r];return n=n??{},X2({oldProps:n,newProps:i,triggerName:r})}const DW="count(): argument not an object",FW="count(): argument not a container";function LW(t){if(!NW(t))throw new Error(DW);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(kW(t))return Object.keys(t).length;throw new Error(FW)}function kW(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function NW(t){return t!==null&&typeof t=="object"}function ub(t,e){if(!e)return t;const r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=r.modules.findIndex(n=>n.name==="project32");i>=0&&r.modules.splice(i,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{const i={...t.inject};for(const n in e.inject)i[n]=(i[n]||"")+e.inject[n];r.inject=i}return r}const UW={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},hb={};function zW(t,e,r,i){if(r instanceof Zo)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let n=null;r.compressed&&(n={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const o=e.createTexture({...r,sampler:{...UW,...n,...i}});return hb[o.id]=t,o}function VW(t,e){!e||!(e instanceof Zo)||hb[e.id]===t&&(e.delete(),delete hb[e.id])}const jW={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||fb(t)&&(t.length===3||t.length===4)},equal(t,e,r){return Ws(t,e,1)}},accessor:{validate(t,e){const r=Lm(t);return r==="function"||r===Lm(e.value)},equal(t,e,r){return typeof e=="function"?!0:Ws(t,e,1)}},array:{validate(t,e){return e.optional&&!t||fb(t)},equal(t,e,r){const{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?Ws(t,e,n):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;const{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?Ws(t,e,n):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;const{dataTransform:i}=r.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{const i=r.context;return!i||!i.device?null:zW(r.id,i.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{VW(r.id,t)}}};function HW(t){const e={},r={},i={};for(const[n,o]of Object.entries(t)){const s=o==null?void 0:o.deprecatedFor;if(s)i[n]=Array.isArray(s)?s:[s];else{const f=GW(n,o);e[n]=f,r[n]=f.value}}return{propTypes:e,defaultProps:r,deprecatedProps:i}}function GW(t,e){switch(Lm(e)){case"object":return QA(t,e);case"array":return QA(t,{type:"array",value:e,compare:!1});case"boolean":return QA(t,{type:"boolean",value:e});case"number":return QA(t,{type:"number",value:e});case"function":return QA(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function QA(t,e){return"type"in e?{name:t,...jW[e.type],...e}:"value"in e?{name:t,type:Lm(e.value),...e}:{name:t,type:"object",value:e}}function fb(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Lm(t){return fb(t)?"array":t===null?"null":typeof t}function WW(t,e){let r;for(let o=e.length-1;o>=0;o--){const s=e[o];"extensions"in s&&(r=s.extensions)}const i=db(t.constructor,r),n=Object.create(i);n[Dm]=t,n[Dh]={},n[Tu]={};for(let o=0;o<e.length;++o){const s=e[o];for(const f in s)n[f]=s[f]}return Object.freeze(n),n}const XW="_mergedDefaultProps";function db(t,e){let r=XW;if(e)for(const n of e){const o=n.constructor;o&&(r+=`:${o.extensionName||o.name}`)}const i=d4(t,r);return i||(t[r]=qW(t,e||[]))}function qW(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),n=db(i),o=d4(t,"defaultProps")||{},s=HW(o),f=Object.assign(Object.create(null),n,s.defaultProps),A=Object.assign(Object.create(null),n==null?void 0:n[Pu],s.propTypes),v=Object.assign(Object.create(null),n==null?void 0:n[fv],s.deprecatedProps);for(const w of e){const C=db(w.constructor);C&&(Object.assign(f,C),Object.assign(A,C[Pu]),Object.assign(v,C[fv]))}return $W(f,t),KW(f,A),ZW(f,v),f[Pu]=A,f[fv]=v,e.length===0&&!q2(t,"_propTypes")&&(t._propTypes=A),f}function $W(t,e){const r=JW(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function ZW(t,e){for(const r in e)Object.defineProperty(t,r,{enumerable:!1,set(i){const n=`${this.id}: ${r}`;for(const o of e[r])q2(this,o)||(this[o]=i);fr.deprecated(n,e[r].join("/"))()}})}function KW(t,e){const r={},i={};for(const n in e){const o=e[n],{name:s,value:f}=o;o.async&&(r[s]=f,i[s]=YW(s))}t[kd]=r,t[Dh]={},Object.defineProperties(t,i)}function YW(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||r4(e)?this[Dh][t]=e:this[Tu][t]=e},get(){if(this[Tu]){if(t in this[Tu])return this[Tu][t]||this[kd][t];if(t in this[Dh]){const e=this[Dm]&&this[Dm].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[kd][t]}}return this[kd][t]}}}function q2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function d4(t,e){return q2(t,e)&&t[e]}function JW(t){const e=t.componentName;return e||fr.warn(`${t.name}.componentName not specified`)(),e||t.name}let QW=0;class $2{constructor(...e){this.props=WW(this,e),this.id=this.props.id,this.count=QW++}clone(e){const{props:r}=this,i={};for(const n in r[kd])n in r[Tu]?i[n]=r[Tu][n]:n in r[Dh]&&(i[n]=r[Dh][n]);return new this.constructor({...r,...i,...e})}}$2.componentName="Component";$2.defaultProps={};const eX=Object.freeze({});class tX{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||eX}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){const r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[Dm]||this.component;const r=e[Tu]||{},i=e[Dh]||e,n=e[kd]||{};for(const o in r){const s=r[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,s),r[o]=this.getAsyncProp(o)}for(const o in i){const s=i[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,s)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(r4(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){const i=this.asyncProps[e];return r===i.resolvedValue||r===i.lastValue?!1:(i.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(r=this._postProcessValue(i,r),i.resolvedValue=r,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,r,i){const n=this.asyncProps[e];n&&i>=n.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=r,n.resolvedLoadCount=i,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const n=i.pendingLoadCount;r.then(o=>{this.component&&(o=this._postProcessValue(i,o),this._setAsyncPropValue(e,o,n),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const n=i.pendingLoadCount;let o=[],s=0;for await(const f of r){if(!this.component)return;const{dataTransform:A}=this.component.props;A?o=A(f,o):o=o.concat(f),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(e,o,n)}this._onResolve(e,o)}_postProcessValue(e,r){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(r,i,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){const n=this.component&&this.component.props[Pu];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class rX extends tX{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){const i=this.layer,n=i==null?void 0:i.props.fetch;return n?n(r,{propName:e,layer:i}):super._fetch(e,r)}_onResolve(e,r){const i=this.layer;if(i){const n=i.props.onDataLoad;e==="data"&&n&&n(r,{propName:e,layer:i})}}_onError(e,r){const i=this.layer;i&&i.raiseError(r,`loading ${e} of ${this.layer}`)}}const iX="layer.changeFlag",nX="layer.initialize",sX="layer.update",oX="layer.finalize",aX="layer.matched",AC=2**24-1,lX=Object.freeze([]),cX=a0(({oldViewport:t,viewport:e})=>t.equals(e));let Dl=new Uint8ClampedArray(0);const uX={data:{type:"data",value:lX,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:i,loadOptions:n,signal:o})=>{const{resourceManager:s}=r.context;n=n||r.getLoadOptions(),i=i||r.props.loaders,o&&(n={...n,fetch:{...n==null?void 0:n.fetch,signal:o}});let f=s.contains(t);return!f&&!n&&(s.add({resourceId:t,data:Ic(t,i),persistent:!1}),f=!0),f?s.subscribe({resourceId:t,onChange:A=>{var v;return(v=r.internalState)==null?void 0:v.reloadAsyncProp(e,A)},consumerId:r.id,requestId:e}):Ic(t,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:br.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Wn extends $2{constructor(){super(...arguments),this.internalState=null,this.lifecycle=pd.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Cs(this.internalState);const r=this.internalState.viewport||this.context.viewport,i=PB(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,o,s]=wB(i,r.pixelProjectionMatrix);return e.length===2?[n,o]:[n,o,s]}unproject(e){return Cs(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){Cs(this.internalState);const i=this.internalState.viewport||this.context.viewport;return Y7(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const r of this.getModels())r.updateModuleSettings(e)}setShaderModuleProps(...e){for(const r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===br.DEFAULT||e===br.LNGLAT||e===br.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){Cs(e instanceof Uint8Array);const[r,i,n]=e;return r+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:LW(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=ub(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)e=ub(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const r=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&r)if(Array.isArray(i))for(const n of i)r.invalidateAll(n);else r.invalidateAll();if(r){const{props:n}=e,o=this.internalState.hasPickingBuffer,s=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(f=>f.getNeedsPickingBuffer.call(this,f));if(o!==s){this.internalState.hasPickingBuffer=s;const{pickingColors:f,instancePickingColors:A}=r.attributes,v=f||A;v&&(s&&v.constant&&(v.constant=!1,r.invalidate(v.id)),!v.value&&!s&&(v.constant=!0,v.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const r of this.getModels())r.draw(e)}getPickingInfo({info:e,mode:r,sourceLayer:i}){const{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(e,r){var i,n,o,s;r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),(n=(i=this.props).onError)!=null&&n.call(i,e)||(s=(o=this.context)==null?void 0:o.onError)==null||s.call(o,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=e,(!r||!cX({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(const i in e)e[i].layoutChanged()&&(r=!0);for(const i of this.getModels())this._setModelAttributes(i,e,r)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const r=this.props,i=this.getNumInstances(),n=this.getStartIndices();e.update({data:r.data,numInstances:i,startIndices:n,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const r=e.update(),i=Object.create(this.props);for(const n in r)Object.defineProperty(i,n,{value:r[n]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;const i=Math.floor(Dl.length/4);if(this.internalState.usesPickingColorCache=!0,i<r){r>AC&&fr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Dl=Zd.allocate(Dl,r,{size:4,copy:!0,maxCount:Math.max(r,AC)});const n=Math.floor(Dl.length/4),o=[];for(let s=i;s<n;s++)this.encodePickingColor(s,o),Dl[s*4+0]=o[0],Dl[s*4+1]=o[1],Dl[s*4+2]=o[2]}e.value=Dl.subarray(0,r*4)}_setModelAttributes(e,r,i=!1){var f;if(!Object.keys(r).length)return;if(i){const A=this.getAttributeManager();e.setBufferLayout(A.getBufferLayouts(e)),r=A.getAttributes()}const n=((f=e.userData)==null?void 0:f.excludeAttributes)||{},o={},s={};for(const A in r){if(n[A])continue;const v=r[A].getValue();for(const w in v){const C=v[w];C instanceof In?r[A].settings.isIndexed?e.setIndexBuffer(C):o[w]=C:C&&(s[w]=C)}}e.setAttributes(o),e.setConstantAttributes(s)}disablePickingIndex(e){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,o=i||n,s=o&&r.attributes&&r.attributes[o.id];if(s&&s.value){const f=s.value,A=this.encodePickingColor(e);for(let v=0;v<r.length;v++){const w=o.getVertexOffset(v);f[w]===A[0]&&f[w+1]===A[1]&&f[w+2]===A[2]&&this._disablePickingIndex(v)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,n=r||i;if(!n)return;const o=n.getVertexOffset(e),s=n.getVertexOffset(e+1);n.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,i=e||r;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Dl.buffer&&(i.value=Dl.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Cs(!this.internalState),Cs(Number.isFinite(this.props.coordinateSystem)),js(nX,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new rX({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(fr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new CW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){js(aX,this,this===e);const{state:r,internalState:i}=e;this!==e&&(this.internalState=i,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(js(sX,this,e),!e)return;const r=this.props,i=this.context,n=this.internalState,o=i.viewport,s=this._updateUniformTransition();n.propsInTransition=s,i.viewport=n.viewport||o,this.props=s;try{const f=this._getUpdateParams(),A=this.getModels();if(i.device)this.updateState(f);else try{this.updateState(f)}catch{}for(const w of this.props.extensions)w.updateState.call(this,f,w);const v=this.getModels()[0]!==A[0];this._postUpdate(f,v)}finally{i.viewport=o,this.props=r,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){js(oX,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:r=null,uniforms:i={},parameters:n={}}){this._updateAttributeTransition();const o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;const f=this.props.opacity;i.opacity=Math.pow(f,1/2.2);try{if(r){const{isActive:w,isAttribute:C}=r.picking;this.setModuleParameters(r),this.setShaderModuleProps({picking:{isActive:w,isAttribute:C}})}const{getPolygonOffset:A}=this.props,v=A&&A(i)||[0,0];s.device.setParametersWebGL({polygonOffset:v});for(const w of this.getModels())w.setParameters(n);s.device.withParametersWebGL(n,()=>{const w={renderPass:e,moduleParameters:r,uniforms:i,parameters:n,context:s};for(const C of this.props.extensions)C.draw.call(this,w,C);this.draw(w)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const n in e)if(e[n]){let o=!1;switch(n){case"dataChanged":const s=e[n],f=r[n];s&&Array.isArray(f)&&(r.dataChanged=Array.isArray(s)?f.concat(s):s,o=!0);default:r[n]||(r[n]=e[n],o=!0)}o&&js(iX,this,n,e)}const i=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=i,r.somethingChanged=i||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){var n;const i=IW(e,r);if(i.updateTriggersChanged)for(const o in i.updateTriggersChanged)i.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(i.transitionsChanged)for(const o in i.transitionsChanged)this.internalState.uniformTransitions.add(o,r[o],e[o],(n=e.transitions)==null?void 0:n[o]);return this.setChangeFlags(i)}validateProps(){PW(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(r.highlightColor=i(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new W2(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){const{props:i,oldProps:n}=e;this.setNeedsRedraw(),this._updateAttributes();const o=this.state.model;o!=null&&o.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:f,highlightColor:A}=i;if(r||n.autoHighlight!==s||n.highlightedObjectIndex!==f||n.highlightColor!==A){const v={};Array.isArray(A)&&(v.highlightColor=A),(r||n.autoHighlight!==s||f!==n.highlightedObjectIndex)&&(v.highlightedObjectColor=Number.isFinite(f)&&f>=0?this.encodePickingColor(f):null),this.setShaderModuleProps({picking:v})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),n=i?i.getNeedsRedraw(e):!1;if(r=r||n,r)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Wn.defaultProps=uX;Wn.layerName="Layer";const hX="compositeLayer.renderLayers";class rs extends Wn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||r}getSubLayerRow(e,r,i){return e.__source={parent:this,object:r,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const r={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(r.index=i.__source.index,e(i.__source.object,r)):e(i,n)}return e}getSubLayerProps(e={}){var Ue;const{opacity:r,pickable:i,visible:n,parameters:o,getPolygonOffset:s,highlightedObjectIndex:f,autoHighlight:A,highlightColor:v,coordinateSystem:w,coordinateOrigin:C,wrapLongitude:I,positionFormat:B,modelMatrix:F,extensions:N,fetch:V,operation:G,_subLayerProps:Y}=this.props,Z={id:"",updateTriggers:{},opacity:r,pickable:i,visible:n,parameters:o,getPolygonOffset:s,highlightedObjectIndex:f,autoHighlight:A,highlightColor:v,coordinateSystem:w,coordinateOrigin:C,wrapLongitude:I,positionFormat:B,modelMatrix:F,extensions:N,fetch:V,operation:G},se=Y&&e.id&&Y[e.id],ge=se&&se.updateTriggers,Pe=e.id||"sublayer";if(se){const Fe=this.props[Pu],pe=e.type?e.type._propTypes:{};for(const Te in se){const Ae=pe[Te]||Fe[Te];Ae&&Ae.type==="accessor"&&(se[Te]=this.getSubLayerAccessor(se[Te]))}}Object.assign(Z,e,se),Z.id=`${this.props.id}-${Pe}`,Z.updateTriggers={all:(Ue=this.props.updateTriggers)==null?void 0:Ue.all,...e.updateTriggers,...ge};for(const Fe of N){const pe=Fe.getSubLayerProps.call(this,Fe);pe&&Object.assign(Z,pe,{updateTriggers:Object.assign(Z.updateTriggers,pe.updateTriggers)})}return Z}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let i=this.internalState.subLayers;const n=!i||this.needsUpdate();if(n){const o=this.renderLayers();i=S_(o,Boolean),this.internalState.subLayers=i}js(hX,this,n,i);for(const o of i)o.parent=this}}rs.layerName="CompositeLayer";const _g=Math.PI/180,pC=180/Math.PI,sm=6370972,Td=256;function fX(){const t=Td/sm,e=Math.PI/180*Td;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class dX extends hA{constructor(e={}){const{latitude:r=0,longitude:i=0,zoom:n=0,nearZMultiplier:o=.1,farZMultiplier:s=2,resolution:f=10}=e;let{height:A,altitude:v=1.5}=e;A=A||1,v=Math.max(.75,v);const w=new Gr().lookAt({eye:[0,-v,0],up:[0,0,1]}),C=Math.pow(2,n);w.rotateX(r*_g),w.rotateZ(-i*_g),w.scale(C/A);const I=Math.atan(.5/v),B=Td*2*C/A;super({...e,height:A,viewMatrix:w,longitude:i,latitude:r,zoom:n,distanceScales:fX(),fovyRadians:I*2,focalDistance:v,near:o,far:Math.min(2,1/B+1)*v*s}),this.latitude=r,this.longitude=i,this.resolution=f}get projectionMode(){return Za.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const r={targetZ:e.z||0},i=this.unproject([0,this.height/2],r),n=this.unproject([this.width/2,0],r),o=this.unproject([this.width,this.height/2],r),s=this.unproject([this.width/2,this.height],r);return o[0]<this.longitude&&(o[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],o[0],n[0],s[0]),Math.min(i[1],o[1],n[1],s[1]),Math.max(i[0],o[0],n[0],s[0]),Math.max(i[1],o[1],n[1],s[1])]}unproject(e,{topLeft:r=!0,targetZ:i}={}){const[n,o,s]=e,f=r?o:this.height-o,{pixelUnprojectionMatrix:A}=this;let v;if(Number.isFinite(s))v=Tv(A,[n,f,s,1]);else{const B=Tv(A,[n,f,-1,1]),F=Tv(A,[n,f,1,1]),N=((i||0)/sm+1)*Td,V=iv(iB([],B,F)),G=iv(B),Y=iv(F),se=4*((4*G*Y-(V-G-Y)**2)/16)/V,ge=Math.sqrt(G-se),Pe=Math.sqrt(Math.max(0,N*N-se)),Ue=(ge-Pe)/Math.sqrt(V);v=B9([],B,F,Ue)}const[w,C,I]=this.unprojectPosition(v);return Number.isFinite(s)?[w,C,I]:Number.isFinite(i)?[w,C,i]:[w,C]}projectPosition(e){const[r,i,n=0]=e,o=r*_g,s=i*_g,f=Math.cos(s),A=(n/sm+1)*Td;return[Math.sin(o)*f*A,-Math.cos(o)*f*A,Math.sin(s)*A]}unprojectPosition(e){const[r,i,n]=e,o=nB(e),s=Math.asin(n/o),A=Math.atan2(r,-i)*pC,v=s*pC,w=(o/Td-1)*sm;return[A,v,w]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,r){const i=this.unproject(r);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function Tv(t,e){const r=uA([],e,t);return B2(r,r,1/r[3]),r}class Z2{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ws(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:r}=e.constructor,i={updateTriggers:{}};for(const n in r)if(n in this.props){const o=r[n],s=this.props[n];i[n]=s,o&&o.type==="accessor"&&(i.updateTriggers[n]=this.props.updateTriggers[n],typeof s=="function"&&(i[n]=this.getSubLayerAccessor(s)))}return i}initializeState(e,r){}updateState(e,r){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,r){}finalizeState(e,r){}}Z2.defaultProps={};Z2.extensionName="LayerExtension";class A4{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:r={}}=e;this.typedArrayManager=Zd,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:r,buffers:i={},getGeometry:n,geometryBuffer:o,positionFormat:s,dataChanged:f,normalize:A=!0}=this.opts;if(this.data=r,this.getGeometry=n,this.positionSize=o&&o.size||(s==="XY"?2:3),this.buffers=i,this.normalize=A,o&&(Cs(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),A||(i.vertexPositions=o)),this.geometryBuffer=i.vertexPositions,Array.isArray(f))for(const v of f)this._rebuildGeometry(v);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:r}){this._rebuildGeometry({startRow:e,endRow:r})}getGeometryFromBuffer(e){const r=e.value||e;return ArrayBuffer.isView(r)?i4(r,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,r){const{attributes:i,buffers:n,_attributeDefs:o,typedArrayManager:s}=this;for(const f in o)if(f in n)s.release(i[f]),i[f]=null;else{const A=o[f];A.copy=r,i[f]=s.allocate(i[f],e,A)}}_forEachGeometry(e,r,i){const{data:n,getGeometry:o}=this,{iterable:s,objectInfo:f}=ql(n,r,i);for(const A of s){f.index++;const v=o?o(A,f):null;e(v,f.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:r,vertexStarts:i,instanceCount:n}=this;const{data:o,geometryBuffer:s}=this,{startRow:f=0,endRow:A=1/0}=e||{},v={};if(e||(r=[0],i=[0]),this.normalize||!s)this._forEachGeometry((C,I)=>{const B=C&&this.normalizeGeometry(C);v[I]=B,i[I+1]=i[I]+(B?this.getGeometrySize(B):0)},f,A),n=i[i.length-1];else if(i=o.startIndices,n=i[o.length]||0,ArrayBuffer.isView(s))n=n||s.length/this.positionSize;else if(s instanceof In){const C=this.positionSize*4;n=n||s.byteLength/C}else if(s.buffer){const C=s.stride||this.positionSize*4;n=n||s.buffer.byteLength/C}else if(s.value){const C=s.value,I=s.stride/C.BYTES_PER_ELEMENT||this.positionSize;n=n||C.length/I}this._allocate(n,!!e),this.indexStarts=r,this.vertexStarts=i,this.instanceCount=n;const w={};this._forEachGeometry((C,I)=>{const B=v[I]||C;w.vertexStart=i[I],w.indexStart=r[I];const F=I<i.length-1?i[I+1]:n;w.geometrySize=F-i[I],w.geometryIndex=I,this.updateGeometryAttributes(B,w)},f,A),this.vertexCount=r[r.length-1]}}const AX=typeof window<"u"?it.useLayoutEffect:it.useEffect;function km(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const pX={position:"absolute",zIndex:-1};function p4(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(r=>p4(r,e));if(R_(t)){if(gX(t))return e.style=pX,it.cloneElement(t,e);if(mX(t))return it.cloneElement(t,e)}return t}function R_(t){return t&&typeof t=="object"&&"type"in t||!1}function gX(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function mX(t){const e=t.type;return e&&e.deckGLViewProps}function Ab(t){if(typeof t=="function")return it.createElement(Kd,{},t);if(Array.isArray(t))return t.map(Ab);if(R_(t)){if(t.type===it.Fragment)return Ab(t.props.children);if(km(t.type,Kd))return t}return t}function _X({children:t,layers:e=[],views:r=null}){const i=[],n=[],o={};return it.Children.forEach(Ab(t),s=>{if(R_(s)){const f=s.type;if(km(f,Wn)){const A=yX(f,s.props);n.push(A)}else i.push(s);if(km(f,Kd)&&f!==Kd&&s.props.id){const A=new f(s.props);o[A.id]=A}}else s&&i.push(s)}),Object.keys(o).length>0&&(Array.isArray(r)?r.forEach(s=>{o[s.id]=s}):r&&(o[r.id]=r),r=Object.values(o)),e=n.length>0?[...n,...e]:e,{layers:e,children:i,views:r}}function yX(t,e){const r={},i=t.defaultProps||{};for(const n in e)i[n]!==e[n]&&(r[n]=e[n]);return new t(r)}function vX({children:t,deck:e,ContextProvider:r}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const n={},o=i.views[0].id;for(const s of t){let f=o,A=s;R_(s)&&km(s.type,Kd)&&(f=s.props.id||o,A=s.props.children);const v=i.getViewport(f),w=i.getViewState(f);if(v){w.padding=v.padding;const{x:C,y:I,width:B,height:F}=v;A=p4(A,{x:C,y:I,width:B,height:F,viewport:v,viewState:w}),n[f]||(n[f]={viewport:v,children:[]}),n[f].children.push(A)}}return Object.keys(n).map(s=>{const{viewport:f,children:A}=n[s],{x:v,y:w,width:C,height:I}=f,B={position:"absolute",left:v,top:w,width:C,height:I},F=`view-${s}`,N=it.createElement("div",{key:F,id:F,style:B},...A);if(r){const V={viewport:f,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:G=>{G.viewId=s,e._onViewStateChange(G)}};return it.createElement(r,{key:F,value:V},N)}return N})}const bX={mixBlendMode:null};function xX({width:t,height:e,style:r}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},n={left:0,top:0};if(r)for(const o in r)o in bX?n[o]=r[o]:i[o]=r[o];return{containerStyle:i,canvasStyle:n}}function wX(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function g4(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function TX(t,e,r){const i=new e({...r,_customRender:n=>{t.redrawReason=n;const o=i.getViewports();t.lastRenderedViewports!==o?t.forceUpdate():g4(t)}});return i}function EX(t,e){const[r,i]=it.useState(0),o=it.useRef({control:null,version:r,forceUpdate:()=>i(ge=>ge+1)}).current,s=it.useRef(null),f=it.useRef(null),A=it.useMemo(()=>_X(t),[t.layers,t.views,t.children]);let v=!0;const w=ge=>{var Pe;return v&&t.viewState?(o.viewStateUpdateRequested=ge,null):(o.viewStateUpdateRequested=null,(Pe=t.onViewStateChange)==null?void 0:Pe.call(t,ge))},C=ge=>{var Pe;v?o.interactionStateUpdateRequested=ge:(o.interactionStateUpdateRequested=null,(Pe=t.onInteractionStateChange)==null||Pe.call(t,ge))},I=it.useMemo(()=>{const ge={...t,style:null,width:"100%",height:"100%",parent:s.current,canvas:f.current,layers:A.layers,views:A.views,onViewStateChange:w,onInteractionStateChange:C};return delete ge._customRender,o.deck&&o.deck.setProps(ge),ge},[t]);it.useEffect(()=>{const ge=t.Deck||G2;return o.deck=TX(o,ge,{...I,parent:s.current,canvas:f.current}),()=>{var Pe;return(Pe=o.deck)==null?void 0:Pe.finalize()}},[]),AX(()=>{g4(o);const{viewStateUpdateRequested:ge,interactionStateUpdateRequested:Pe}=o;ge&&w(ge),Pe&&C(Pe)}),it.useImperativeHandle(e,()=>wX(o),[]);const B=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:F,width:N="100%",height:V="100%",id:G,style:Y}=t,{containerStyle:Z,canvasStyle:se}=it.useMemo(()=>xX({width:N,height:V,style:Y}),[N,V,Y]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===B||o.version!==r){o.lastRenderedViewports=B,o.version=r;const ge=vX({children:A.children,deck:o.deck,ContextProvider:F}),Pe=it.createElement("canvas",{key:"canvas",id:G||"deckgl-overlay",ref:f,style:se});o.control=it.createElement("div",{id:`${G||"deckgl"}-wrapper`,ref:s,style:Z},[Pe,ge])}return v=!1,o.control}const SX=it.forwardRef(EX);var zs=1e-6,Yd=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function CX(){var t=new Yd(4);return Yd!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function PX(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function IX(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*s,t[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*s,t[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*s,t[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*s,t}(function(){var t=CX();return function(e,r,i,n,o,s){var f,A;for(r||(r=4),i||(i=0),n?A=Math.min(n*r+i,e.length):A=e.length,f=i;f<A;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],o(t,t,s),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}})();function om(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Nd(t,e){const r=IX([],e,t);return PX(r,r,1/r[3]),r}function gC(t,e){const r=t%e;return r<0?e+r:r}function MX(t,e,r){return r*e+(1-r)*t}function pb(t,e,r){return t<e?e:t>r?r:t}function RX(t){return Math.log(t)*Math.LOG2E}const K2=Math.log2||RX;function BX(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],f=e[5],A=e[6],v=e[7],w=e[8],C=e[9],I=e[10],B=e[11],F=e[12],N=e[13],V=e[14],G=e[15],Y=r*f-i*s,Z=r*A-n*s,se=r*v-o*s,ge=i*A-n*f,Pe=i*v-o*f,Ue=n*v-o*A,Fe=w*N-C*F,pe=w*V-I*F,Te=w*G-B*F,Ae=C*V-I*N,Le=C*G-B*N,Ve=I*G-B*V,Xe=Y*Ve-Z*Le+se*Ae+ge*Te-Pe*pe+Ue*Fe;return Xe?(Xe=1/Xe,t[0]=(f*Ve-A*Le+v*Ae)*Xe,t[1]=(n*Le-i*Ve-o*Ae)*Xe,t[2]=(N*Ue-V*Pe+G*ge)*Xe,t[3]=(I*Pe-C*Ue-B*ge)*Xe,t[4]=(A*Te-s*Ve-v*pe)*Xe,t[5]=(r*Ve-n*Te+o*pe)*Xe,t[6]=(V*se-F*Ue-G*Z)*Xe,t[7]=(w*Ue-I*se+B*Z)*Xe,t[8]=(s*Le-f*Te+v*Fe)*Xe,t[9]=(i*Te-r*Le-o*Fe)*Xe,t[10]=(F*Pe-N*se+G*Y)*Xe,t[11]=(C*se-w*Pe-B*Y)*Xe,t[12]=(f*pe-s*Ae-A*Fe)*Xe,t[13]=(r*Ae-i*pe+n*Fe)*Xe,t[14]=(N*Z-F*ge-V*Y)*Xe,t[15]=(w*ge-C*Z+I*Y)*Xe,t):null}function Ev(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],f=e[4],A=e[5],v=e[6],w=e[7],C=e[8],I=e[9],B=e[10],F=e[11],N=e[12],V=e[13],G=e[14],Y=e[15],Z=r[0],se=r[1],ge=r[2],Pe=r[3];return t[0]=Z*i+se*f+ge*C+Pe*N,t[1]=Z*n+se*A+ge*I+Pe*V,t[2]=Z*o+se*v+ge*B+Pe*G,t[3]=Z*s+se*w+ge*F+Pe*Y,Z=r[4],se=r[5],ge=r[6],Pe=r[7],t[4]=Z*i+se*f+ge*C+Pe*N,t[5]=Z*n+se*A+ge*I+Pe*V,t[6]=Z*o+se*v+ge*B+Pe*G,t[7]=Z*s+se*w+ge*F+Pe*Y,Z=r[8],se=r[9],ge=r[10],Pe=r[11],t[8]=Z*i+se*f+ge*C+Pe*N,t[9]=Z*n+se*A+ge*I+Pe*V,t[10]=Z*o+se*v+ge*B+Pe*G,t[11]=Z*s+se*w+ge*F+Pe*Y,Z=r[12],se=r[13],ge=r[14],Pe=r[15],t[12]=Z*i+se*f+ge*C+Pe*N,t[13]=Z*n+se*A+ge*I+Pe*V,t[14]=Z*o+se*v+ge*B+Pe*G,t[15]=Z*s+se*w+ge*F+Pe*Y,t}function gb(t,e,r){var i=r[0],n=r[1],o=r[2],s,f,A,v,w,C,I,B,F,N,V,G;return e===t?(t[12]=e[0]*i+e[4]*n+e[8]*o+e[12],t[13]=e[1]*i+e[5]*n+e[9]*o+e[13],t[14]=e[2]*i+e[6]*n+e[10]*o+e[14],t[15]=e[3]*i+e[7]*n+e[11]*o+e[15]):(s=e[0],f=e[1],A=e[2],v=e[3],w=e[4],C=e[5],I=e[6],B=e[7],F=e[8],N=e[9],V=e[10],G=e[11],t[0]=s,t[1]=f,t[2]=A,t[3]=v,t[4]=w,t[5]=C,t[6]=I,t[7]=B,t[8]=F,t[9]=N,t[10]=V,t[11]=G,t[12]=s*i+w*n+F*o+e[12],t[13]=f*i+C*n+N*o+e[13],t[14]=A*i+I*n+V*o+e[14],t[15]=v*i+B*n+G*o+e[15]),t}function m4(t,e,r){var i=r[0],n=r[1],o=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function OX(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[4],s=e[5],f=e[6],A=e[7],v=e[8],w=e[9],C=e[10],I=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+v*i,t[5]=s*n+w*i,t[6]=f*n+C*i,t[7]=A*n+I*i,t[8]=v*n-o*i,t[9]=w*n-s*i,t[10]=C*n-f*i,t[11]=I*n-A*i,t}function DX(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],s=e[1],f=e[2],A=e[3],v=e[4],w=e[5],C=e[6],I=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+v*i,t[1]=s*n+w*i,t[2]=f*n+C*i,t[3]=A*n+I*i,t[4]=v*n-o*i,t[5]=w*n-s*i,t[6]=C*n-f*i,t[7]=I*n-A*i,t}function FX(t,e,r,i,n){var o=1/Math.tan(e/2),s;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(s=1/(i-n),t[10]=(n+i)*s,t[14]=2*n*i*s):(t[10]=-1,t[14]=-2*i),t}var LX=FX;function mC(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],f=t[5],A=t[6],v=t[7],w=t[8],C=t[9],I=t[10],B=t[11],F=t[12],N=t[13],V=t[14],G=t[15],Y=e[0],Z=e[1],se=e[2],ge=e[3],Pe=e[4],Ue=e[5],Fe=e[6],pe=e[7],Te=e[8],Ae=e[9],Le=e[10],Ve=e[11],Xe=e[12],dt=e[13],Nt=e[14],gr=e[15];return Math.abs(r-Y)<=zs*Math.max(1,Math.abs(r),Math.abs(Y))&&Math.abs(i-Z)<=zs*Math.max(1,Math.abs(i),Math.abs(Z))&&Math.abs(n-se)<=zs*Math.max(1,Math.abs(n),Math.abs(se))&&Math.abs(o-ge)<=zs*Math.max(1,Math.abs(o),Math.abs(ge))&&Math.abs(s-Pe)<=zs*Math.max(1,Math.abs(s),Math.abs(Pe))&&Math.abs(f-Ue)<=zs*Math.max(1,Math.abs(f),Math.abs(Ue))&&Math.abs(A-Fe)<=zs*Math.max(1,Math.abs(A),Math.abs(Fe))&&Math.abs(v-pe)<=zs*Math.max(1,Math.abs(v),Math.abs(pe))&&Math.abs(w-Te)<=zs*Math.max(1,Math.abs(w),Math.abs(Te))&&Math.abs(C-Ae)<=zs*Math.max(1,Math.abs(C),Math.abs(Ae))&&Math.abs(I-Le)<=zs*Math.max(1,Math.abs(I),Math.abs(Le))&&Math.abs(B-Ve)<=zs*Math.max(1,Math.abs(B),Math.abs(Ve))&&Math.abs(F-Xe)<=zs*Math.max(1,Math.abs(F),Math.abs(Xe))&&Math.abs(N-dt)<=zs*Math.max(1,Math.abs(N),Math.abs(dt))&&Math.abs(V-Nt)<=zs*Math.max(1,Math.abs(V),Math.abs(Nt))&&Math.abs(G-gr)<=zs*Math.max(1,Math.abs(G),Math.abs(gr))}function kX(){var t=new Yd(2);return Yd!=Float32Array&&(t[0]=0,t[1]=0),t}function mb(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function NX(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function UX(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function zX(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function VX(t,e){return t[0]=-e[0],t[1]=-e[1],t}function _4(t,e,r,i){var n=e[0],o=e[1];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t}var jX=NX;(function(){var t=kX();return function(e,r,i,n,o,s){var f,A;for(r||(r=2),i||(i=0),n?A=Math.min(n*r+i,e.length):A=e.length,f=i;f<A;f+=r)t[0]=e[f],t[1]=e[f+1],o(t,t,s),e[f]=t[0],e[f+1]=t[1];return e}})();function HX(){var t=new Yd(3);return Yd!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function GX(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function WX(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function XX(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}var qX=WX;(function(){var t=HX();return function(e,r,i,n,o,s){var f,A;for(r||(r=3),i||(i=0),n?A=Math.min(n*r+i,e.length):A=e.length,f=i;f<A;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],o(t,t,s),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2];return e}})();function Ou(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ya=Math.PI,y4=Ya/4,Vl=Ya/180,_b=180/Ya,Hp=512,_C=4003e4,yg=85.051129,v4=1.5;function yb(t){return Math.pow(2,t)}function $X(t){return K2(t)}function Su(t){const[e,r]=t;Ou(Number.isFinite(e)),Ou(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const i=e*Vl,n=r*Vl,o=Hp*(i+Ya)/(2*Ya),s=Hp*(Ya+Math.log(Math.tan(y4+n*.5)))/(2*Ya);return[o,s]}function Mu(t){const[e,r]=t,i=e/Hp*(2*Ya)-Ya,n=2*(Math.atan(Math.exp(r/Hp*(2*Ya)-Ya))-y4);return[i*_b,n*_b]}function ZX(t){const{latitude:e,longitude:r,highPrecision:i=!1}=t;Ou(Number.isFinite(e)&&Number.isFinite(r));const n=Hp,o=Math.cos(e*Vl),s=n/360,f=s/o,A=n/_C/o,v={unitsPerMeter:[A,A,A],metersPerUnit:[1/A,1/A,1/A],unitsPerDegree:[s,f,A],degreesPerUnit:[1/s,1/f,1/A]};if(i){const w=Vl*Math.tan(e*Vl)/o,C=s*w/2,I=n/_C*w,B=I/f*A;v.unitsPerDegree2=[0,C,I],v.unitsPerMeter2=[B,0,B]}return v}function KX(t){const{height:e,pitch:r,bearing:i,altitude:n,scale:o,center:s}=t,f=om();gb(f,f,[0,0,-n]),OX(f,f,-r*Vl),DX(f,f,i*Vl);const A=o/e;return m4(f,f,[A,A,A]),s&&gb(f,f,XX([],s)),f}function YX(t){const{width:e,height:r,altitude:i,pitch:n=0,offset:o,center:s,scale:f,nearZMultiplier:A=1,farZMultiplier:v=1}=t;let{fovy:w=Nm(v4)}=t;i!==void 0&&(w=Nm(i));const C=w*Vl,I=n*Vl,B=b4(w);let F=B;s&&(F+=s[2]*f/Math.cos(I)/r);const N=C*(.5+(o?o[1]:0)/r),V=Math.sin(N)*F/Math.sin(pb(Math.PI/2-I-N,.01,Math.PI-.01)),G=Math.sin(I)*V+F,Y=F*10,Z=Math.min(G*v,Y);return{fov:C,aspect:e/r,focalDistance:B,near:A,far:Z}}function JX(t){const{fov:e,aspect:r,near:i,far:n}=YX(t);return LX([],e,r,i,n)}function Nm(t){return 2*Math.atan(.5/t)*_b}function b4(t){return .5/Math.tan(.5*t*Vl)}function QX(t,e){const[r,i,n=0]=t;return Ou(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),Nd(e,[r,i,n,1])}function yC(t,e,r=0){const[i,n,o]=t;if(Ou(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return Nd(e,[i,n,o,1]);const s=Nd(e,[i,n,0,1]),f=Nd(e,[i,n,1,1]),A=s[2],v=f[2],w=A===v?0:((r||0)-A)/(v-A);return _4([],s,f,w)}function eq(t){const{width:e,height:r,bounds:i,minExtent:n=0,maxZoom:o=24,offset:s=[0,0]}=t,[[f,A],[v,w]]=i,C=tq(t.padding),I=Su([f,pb(w,-yg,yg)]),B=Su([v,pb(A,-yg,yg)]),F=[Math.max(Math.abs(B[0]-I[0]),n),Math.max(Math.abs(B[1]-I[1]),n)],N=[e-C.left-C.right-Math.abs(s[0])*2,r-C.top-C.bottom-Math.abs(s[1])*2];Ou(N[0]>0&&N[1]>0);const V=N[0]/F[0],G=N[1]/F[1],Y=(C.right-C.left)/2/V,Z=(C.top-C.bottom)/2/G,se=[(B[0]+I[0])/2+Y,(B[1]+I[1])/2+Z],ge=Mu(se),Pe=Math.min(o,K2(Math.abs(Math.min(V,G))));return Ou(Number.isFinite(Pe)),{longitude:ge[0],latitude:ge[1],zoom:Pe}}function tq(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ou(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const vC=Math.PI/180;function rq(t,e=0){const{width:r,height:i,unproject:n}=t,o={targetZ:e},s=n([0,i],o),f=n([r,i],o);let A,v;const w=t.fovy?.5*t.fovy*vC:Math.atan(.5/t.altitude),C=(90-t.pitch)*vC;return w>C-.01?(A=bC(t,0,e),v=bC(t,r,e)):(A=n([0,0],o),v=n([r,0],o)),[s,f,v,A]}function bC(t,e,r){const{pixelUnprojectionMatrix:i}=t,n=Nd(i,[e,0,1,1]),o=Nd(i,[e,t.height,1,1]),f=(r*t.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),A=_4([],n,o,f),v=Mu(A);return v.push(r),v}class jl{constructor(e={width:1,height:1}){Wt(this,"latitude",void 0),Wt(this,"longitude",void 0),Wt(this,"zoom",void 0),Wt(this,"pitch",void 0),Wt(this,"bearing",void 0),Wt(this,"altitude",void 0),Wt(this,"fovy",void 0),Wt(this,"meterOffset",void 0),Wt(this,"center",void 0),Wt(this,"width",void 0),Wt(this,"height",void 0),Wt(this,"scale",void 0),Wt(this,"distanceScales",void 0),Wt(this,"viewMatrix",void 0),Wt(this,"projectionMatrix",void 0),Wt(this,"viewProjectionMatrix",void 0),Wt(this,"pixelProjectionMatrix",void 0),Wt(this,"pixelUnprojectionMatrix",void 0),Wt(this,"equals",G=>G instanceof jl?G.width===this.width&&G.height===this.height&&mC(G.projectionMatrix,this.projectionMatrix)&&mC(G.viewMatrix,this.viewMatrix):!1),Wt(this,"project",(G,Y={})=>{const{topLeft:Z=!0}=Y,se=this.projectPosition(G),ge=QX(se,this.pixelProjectionMatrix),[Pe,Ue]=ge,Fe=Z?Ue:this.height-Ue;return G.length===2?[Pe,Fe]:[Pe,Fe,ge[2]]}),Wt(this,"unproject",(G,Y={})=>{const{topLeft:Z=!0,targetZ:se=void 0}=Y,[ge,Pe,Ue]=G,Fe=Z?Pe:this.height-Pe,pe=se&&se*this.distanceScales.unitsPerMeter[2],Te=yC([ge,Fe,Ue],this.pixelUnprojectionMatrix,pe),[Ae,Le,Ve]=this.unprojectPosition(Te);return Number.isFinite(Ue)?[Ae,Le,Ve]:Number.isFinite(se)?[Ae,Le,se]:[Ae,Le]}),Wt(this,"projectPosition",G=>{const[Y,Z]=Su(G),se=(G[2]||0)*this.distanceScales.unitsPerMeter[2];return[Y,Z,se]}),Wt(this,"unprojectPosition",G=>{const[Y,Z]=Mu(G),se=(G[2]||0)*this.distanceScales.metersPerUnit[2];return[Y,Z,se]});let{width:r,height:i,altitude:n=null,fovy:o=null}=e;const{latitude:s=0,longitude:f=0,zoom:A=0,pitch:v=0,bearing:w=0,position:C=null,nearZMultiplier:I=.02,farZMultiplier:B=1.01}=e;r=r||1,i=i||1,o===null&&n===null?(n=v4,o=Nm(n)):o===null?o=Nm(n):n===null&&(n=b4(o));const F=yb(A);n=Math.max(.75,n);const N=ZX({longitude:f,latitude:s}),V=Su([f,s]);V.push(0),C&&GX(V,V,qX([],C,N.unitsPerMeter)),this.projectionMatrix=JX({width:r,height:i,scale:F,center:V,pitch:v,fovy:o,nearZMultiplier:I,farZMultiplier:B}),this.viewMatrix=KX({height:i,scale:F,center:V,pitch:v,bearing:w,altitude:n}),this.width=r,this.height=i,this.scale=F,this.latitude=s,this.longitude=f,this.zoom=A,this.pitch=v,this.bearing=w,this.altitude=n,this.fovy=o,this.center=V,this.meterOffset=C||[0,0,0],this.distanceScales=N,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:r,projectionMatrix:i,viewMatrix:n}=this,o=om();Ev(o,o,i),Ev(o,o,n),this.viewProjectionMatrix=o;const s=om();m4(s,s,[e/2,-r/2,1]),gb(s,s,[1,-1,0]),Ev(s,s,o);const f=BX(om(),s);if(!f)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=f}projectFlat(e){return Su(e)}unprojectFlat(e){return Mu(e)}getMapCenterByLngLatPosition({lngLat:e,pos:r}){const i=yC(r,this.pixelUnprojectionMatrix),n=Su(e),o=mb([],n,VX([],i)),s=mb([],this.center,o);return Mu(s)}fitBounds(e,r={}){const{width:i,height:n}=this,{longitude:o,latitude:s,zoom:f}=eq(Object.assign({width:i,height:n,bounds:e},r));return new jl({width:i,height:n,longitude:o,latitude:s,zoom:f})}getBounds(e){const r=this.getBoundingRegion(e),i=Math.min(...r.map(f=>f[0])),n=Math.max(...r.map(f=>f[0])),o=Math.min(...r.map(f=>f[1])),s=Math.max(...r.map(f=>f[1]));return[[i,o],[n,s]]}getBoundingRegion(e={}){return rq(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:r}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}}const xC=512;function iq(t){const{width:e,height:r,pitch:i=0}=t;let{longitude:n,latitude:o,zoom:s,bearing:f=0}=t;(n<-180||n>180)&&(n=gC(n+180,360)-180),(f<-180||f>180)&&(f=gC(f+180,360)-180);const A=K2(r/xC);if(s<=A)s=A,o=0;else{const v=r/2/Math.pow(2,s),w=Mu([0,v])[1];if(o<w)o=w;else{const C=Mu([0,xC-v])[1];o>C&&(o=C)}}return{width:e,height:r,longitude:n,latitude:o,zoom:s,pitch:i,bearing:f}}const x4=.01,nq=["longitude","latitude","zoom"],w4={curve:1.414,speed:1.2};function sq(t,e,r,i){const{startZoom:n,startCenterXY:o,uDelta:s,w0:f,u1:A,S:v,rho:w,rho2:C,r0:I}=T4(t,e,i);if(A<x4){const se={};for(const ge of nq){const Pe=t[ge],Ue=e[ge];se[ge]=MX(Pe,Ue,r)}return se}const B=r*v,F=Math.cosh(I)/Math.cosh(I+w*B),N=f*((Math.cosh(I)*Math.tanh(I+w*B)-Math.sinh(I))/C)/A,V=1/F,G=n+$X(V),Y=UX([],s,N);mb(Y,Y,o);const Z=Mu(Y);return{longitude:Z[0],latitude:Z[1],zoom:G}}function oq(t,e,r){const i={...w4,...r},{screenSpeed:n,speed:o,maxDuration:s}=i,{S:f,rho:A}=T4(t,e,i),v=1e3*f;let w;return Number.isFinite(n)?w=v/(n/A):w=v/o,Number.isFinite(s)&&w>s?0:w}function T4(t,e,r){r=Object.assign({},w4,r);const i=r.curve,n=t.zoom,o=[t.longitude,t.latitude],s=yb(n),f=e.zoom,A=[e.longitude,e.latitude],v=yb(f-n),w=Su(o),C=Su(A),I=jX([],C,w),B=Math.max(t.width,t.height),F=B/v,N=zX(I)*s,V=Math.max(N,x4),G=i*i,Y=(F*F-B*B+G*G*V*V)/(2*B*G*V),Z=(F*F-B*B-G*G*V*V)/(2*F*G*V),se=Math.log(Math.sqrt(Y*Y+1)-Y),ge=Math.log(Math.sqrt(Z*Z+1)-Z),Pe=(ge-se)/i;return{startZoom:n,startCenterXY:w,uDelta:I,w0:B,u1:N,S:Pe,rho:i,rho2:G,r0:se,r1:ge}}var E4=function(){if(typeof Map<"u")return Map;function t(e,r){var i=-1;return e.some(function(n,o){return n[0]===r?(i=o,!0):!1}),i}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(r){var i=t(this.__entries__,r),n=this.__entries__[i];return n&&n[1]},e.prototype.set=function(r,i){var n=t(this.__entries__,r);~n?this.__entries__[n][1]=i:this.__entries__.push([r,i])},e.prototype.delete=function(r){var i=this.__entries__,n=t(i,r);~n&&i.splice(n,1)},e.prototype.has=function(r){return!!~t(this.__entries__,r)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(r,i){i===void 0&&(i=null);for(var n=0,o=this.__entries__;n<o.length;n++){var s=o[n];r.call(i,s[1],s[0])}},e}()}(),vb=typeof window<"u"&&typeof document<"u"&&window.document===document,Um=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),aq=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(Um):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)}}(),lq=2;function cq(t,e){var r=!1,i=!1,n=0;function o(){r&&(r=!1,t()),i&&f()}function s(){aq(o)}function f(){var A=Date.now();if(r){if(A-n<lq)return;i=!0}else r=!0,i=!1,setTimeout(s,e);n=A}return f}var uq=20,hq=["top","right","bottom","left","width","height","size","weight"],fq=typeof MutationObserver<"u",dq=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=cq(this.refresh.bind(this),uq)}return t.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},t.prototype.removeObserver=function(e){var r=this.observers_,i=r.indexOf(e);~i&&r.splice(i,1),!r.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},t.prototype.updateObservers_=function(){var e=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return e.forEach(function(r){return r.broadcastActive()}),e.length>0},t.prototype.connect_=function(){!vb||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),fq?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){!vb||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(e){var r=e.propertyName,i=r===void 0?"":r,n=hq.some(function(o){return!!~i.indexOf(o)});n&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),S4=function(t,e){for(var r=0,i=Object.keys(e);r<i.length;r++){var n=i[r];Object.defineProperty(t,n,{value:e[n],enumerable:!1,writable:!1,configurable:!0})}return t},Jd=function(t){var e=t&&t.ownerDocument&&t.ownerDocument.defaultView;return e||Um},C4=B_(0,0,0,0);function zm(t){return parseFloat(t)||0}function wC(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return e.reduce(function(i,n){var o=t["border-"+n+"-width"];return i+zm(o)},0)}function Aq(t){for(var e=["top","right","bottom","left"],r={},i=0,n=e;i<n.length;i++){var o=n[i],s=t["padding-"+o];r[o]=zm(s)}return r}function pq(t){var e=t.getBBox();return B_(0,0,e.width,e.height)}function gq(t){var e=t.clientWidth,r=t.clientHeight;if(!e&&!r)return C4;var i=Jd(t).getComputedStyle(t),n=Aq(i),o=n.left+n.right,s=n.top+n.bottom,f=zm(i.width),A=zm(i.height);if(i.boxSizing==="border-box"&&(Math.round(f+o)!==e&&(f-=wC(i,"left","right")+o),Math.round(A+s)!==r&&(A-=wC(i,"top","bottom")+s)),!_q(t)){var v=Math.round(f+o)-e,w=Math.round(A+s)-r;Math.abs(v)!==1&&(f-=v),Math.abs(w)!==1&&(A-=w)}return B_(n.left,n.top,f,A)}var mq=function(){return typeof SVGGraphicsElement<"u"?function(t){return t instanceof Jd(t).SVGGraphicsElement}:function(t){return t instanceof Jd(t).SVGElement&&typeof t.getBBox=="function"}}();function _q(t){return t===Jd(t).document.documentElement}function yq(t){return vb?mq(t)?pq(t):gq(t):C4}function vq(t){var e=t.x,r=t.y,i=t.width,n=t.height,o=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,s=Object.create(o.prototype);return S4(s,{x:e,y:r,width:i,height:n,top:r,right:e+i,bottom:n+r,left:e}),s}function B_(t,e,r,i){return{x:t,y:e,width:r,height:i}}var bq=function(){function t(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=B_(0,0,0,0),this.target=e}return t.prototype.isActive=function(){var e=yq(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},t}(),xq=function(){function t(e,r){var i=vq(r);S4(this,{target:e,contentRect:i})}return t}(),wq=function(){function t(e,r,i){if(this.activeObservations_=[],this.observations_=new E4,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=r,this.callbackCtx_=i}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof Jd(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(e)||(r.set(e,new bq(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof Jd(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(e)&&(r.delete(e),r.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&e.activeObservations_.push(r)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,r=this.activeObservations_.map(function(i){return new xq(i.target,i.broadcastRect())});this.callback_.call(e,r,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),P4=typeof WeakMap<"u"?new WeakMap:new E4,I4=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=dq.getInstance(),i=new wq(e,r,this);P4.set(this,i)}return t}();["observe","unobserve","disconnect"].forEach(function(t){I4.prototype[t]=function(){var e;return(e=P4.get(this))[t].apply(e,arguments)}});var Tq=function(){return typeof Um.ResizeObserver<"u"?Um.ResizeObserver:I4}(),xc=typeof document<"u"?document:{};function TC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function vg(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?TC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):TC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}function EC(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=Eq(t))||e){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(v){throw v},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,f;return{s:function(){r=t[Symbol.iterator]()},n:function(){var v=r.next();return o=v.done,v},e:function(v){s=!0,f=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw f}}}}function Eq(t,e){if(t){if(typeof t=="string")return SC(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return SC(t,e)}}function SC(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}var Sq=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Sv(t){if(!t)return null;if(typeof t=="string")return t;t.toJS&&(t=t.toJS());var e={},r=EC(t.layers),i;try{for(r.s();!(i=r.n()).done;){var n=i.value;e[n.id]=n}}catch(s){r.e(s)}finally{r.f()}var o=t.layers.map(function(s){var f=e[s.ref],A=null;if("interactive"in s&&(A=vg({},s),delete A.interactive),f){A=A||vg({},s),delete A.ref;var v=EC(Sq),w;try{for(v.s();!(w=v.n()).done;){var C=w.value;C in f&&(A[C]=f[C])}}catch(I){v.e(I)}finally{v.f()}}return A||s});return vg(vg({},t),{},{layers:o})}var CC={};function Cq(){}function Pq(t){t&&console.error(t.error)}var M4={container:$e.object,gl:$e.object,mapboxApiAccessToken:$e.string,mapboxApiUrl:$e.string,attributionControl:$e.bool,preserveDrawingBuffer:$e.bool,reuseMaps:$e.bool,transformRequest:$e.func,mapOptions:$e.object,mapStyle:$e.oneOfType([$e.string,$e.object]),preventStyleDiffing:$e.bool,visible:$e.bool,asyncRender:$e.bool,onLoad:$e.func,onError:$e.func,width:$e.number,height:$e.number,viewState:$e.object,longitude:$e.number,latitude:$e.number,zoom:$e.number,bearing:$e.number,pitch:$e.number,altitude:$e.number},am={container:xc.body,mapboxApiAccessToken:Iq(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:Cq,onError:Pq,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function Iq(){var t=null;if(typeof window<"u"&&window.location){var e=window.location.search.match(/access_token=([^&\/]*)/);t=e&&e[1]}return!t&&typeof process<"u"&&(t=t||CC.MapboxAccessToken||CC.REACT_APP_MAPBOX_ACCESS_TOKEN),t||"no-token"}function PC(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";t.debug&&$e.checkPropTypes(M4,t,"prop",e)}var Xh=function(){function t(e){var r=this;if(Lu(this,t),Wt(this,"props",am),Wt(this,"width",0),Wt(this,"height",0),Wt(this,"_fireLoadEvent",function(){r.props.onLoad({type:"load",target:r._map})}),Wt(this,"_handleError",function(i){r.props.onError(i)}),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return Fu(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(r){return this._update(this.props,r),this}},{key:"redraw",value:function(){var r=this._map;r.style&&(r._frame&&(r._frame.cancel(),r._frame=null),r._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(r){this._map=t.savedMap;var i=this._map.getContainer(),n=r.container;for(n.classList.add("mapboxgl-map");i.childNodes.length>0;)n.appendChild(i.childNodes[0]);this._map._container=n,t.savedMap=null,r.mapStyle&&this._map.setStyle(Sv(r.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(r){if(r.reuseMaps&&t.savedMap)this._reuse(r);else{if(r.gl){var i=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=i,r.gl}}var n={container:r.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:Sv(r.mapStyle),interactive:!1,trackResize:!1,attributionControl:r.attributionControl,preserveDrawingBuffer:r.preserveDrawingBuffer};r.transformRequest&&(n.transformRequest=r.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},n,r.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!t.savedMap?(t.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(r){var i=this;r=Object.assign({},am,r),PC(r,"Mapbox"),this.mapboxgl.accessToken=r.mapboxApiAccessToken||am.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=r.mapboxApiUrl,this._create(r);var n=r,o=n.container;Object.defineProperty(o,"offsetWidth",{configurable:!0,get:function(){return i.width}}),Object.defineProperty(o,"clientWidth",{configurable:!0,get:function(){return i.width}}),Object.defineProperty(o,"offsetHeight",{configurable:!0,get:function(){return i.height}}),Object.defineProperty(o,"clientHeight",{configurable:!0,get:function(){return i.height}});var s=this._map.getCanvas();s&&(s.style.outline="none"),this._updateMapViewport({},r),this._updateMapSize({},r),this.props=r}},{key:"_update",value:function(r,i){if(this._map){i=Object.assign({},this.props,i),PC(i,"Mapbox");var n=this._updateMapViewport(r,i),o=this._updateMapSize(r,i);this._updateMapStyle(r,i),!i.asyncRender&&(n||o)&&this.redraw(),this.props=i}}},{key:"_updateMapStyle",value:function(r,i){var n=r.mapStyle!==i.mapStyle;n&&this._map.setStyle(Sv(i.mapStyle),{diff:!i.preventStyleDiffing})}},{key:"_updateMapSize",value:function(r,i){var n=r.width!==i.width||r.height!==i.height;return n&&(this.width=i.width,this.height=i.height,this._map.resize()),n}},{key:"_updateMapViewport",value:function(r,i){var n=this._getViewState(r),o=this._getViewState(i),s=o.latitude!==n.latitude||o.longitude!==n.longitude||o.zoom!==n.zoom||o.pitch!==n.pitch||o.bearing!==n.bearing||o.altitude!==n.altitude;return s&&(this._map.jumpTo(this._viewStateToMapboxProps(o)),o.altitude!==n.altitude&&(this._map.transform.altitude=o.altitude)),s}},{key:"_getViewState",value:function(r){var i=r.viewState||r,n=i.longitude,o=i.latitude,s=i.zoom,f=i.pitch,A=f===void 0?0:f,v=i.bearing,w=v===void 0?0:v,C=i.altitude,I=C===void 0?1.5:C;return{longitude:n,latitude:o,zoom:s,pitch:A,bearing:w,altitude:I}}},{key:"_checkStyleSheet",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof xc>"u"))try{var i=xc.createElement("div");i.className="mapboxgl-map",i.style.display="none",xc.body.appendChild(i);var n=window.getComputedStyle(i).position!=="static";if(!n){var o=xc.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(r,"/mapbox-gl.css")),xc.head.appendChild(o)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(r){return{center:[r.longitude,r.latitude],zoom:r.zoom,bearing:r.bearing,pitch:r.pitch}}}]),t}();Wt(Xh,"initialized",!1);Wt(Xh,"propTypes",M4);Wt(Xh,"defaultProps",am);Wt(Xh,"savedMap",null);var R4={exports:{}};(function(t,e){(function(r,i){t.exports=i()})(VM,function(){var r,i,n;function o(s,f){if(!r)r=f;else if(!i)i=f;else{var A="var sharedChunk = {}; ("+r+")(sharedChunk); ("+i+")(sharedChunk);",v={};r(v),n=f(v),typeof window<"u"&&(n.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}return o(["exports"],function(s){function f(a,h){return a(h={exports:{}},h.exports),h.exports}var A=v;function v(a,h,p,x){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(x-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=x,this.p2x=p,this.p2y=x}v.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},v.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},v.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},v.prototype.solveCurveX=function(a,h){var p,x,E,P,R;for(h===void 0&&(h=1e-6),E=a,R=0;R<8;R++){if(P=this.sampleCurveX(E)-a,Math.abs(P)<h)return E;var O=this.sampleCurveDerivativeX(E);if(Math.abs(O)<1e-6)break;E-=P/O}if((E=a)<(p=0))return p;if(E>(x=1))return x;for(;p<x;){if(P=this.sampleCurveX(E),Math.abs(P-a)<h)return E;a>P?p=E:x=E,E=.5*(x-p)+p}return E},v.prototype.solve=function(a,h){return this.sampleCurveY(this.solveCurveX(a,h))};var w=C;function C(a,h){this.x=a,this.y=h}C.prototype={clone:function(){return new C(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,h){return this.clone()._rotateAround(a,h)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var h=a.x-this.x,p=a.y-this.y;return h*h+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,h){return Math.atan2(this.x*h-this.y*a,this.x*a+this.y*h)},_matMult:function(a){var h=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=h,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var h=Math.cos(a),p=Math.sin(a),x=p*this.x+h*this.y;return this.x=h*this.x-p*this.y,this.y=x,this},_rotateAround:function(a,h){var p=Math.cos(a),x=Math.sin(a),E=h.y+x*(this.x-h.x)+p*(this.y-h.y);return this.x=h.x+p*(this.x-h.x)-x*(this.y-h.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},C.convert=function(a){return a instanceof C?a:Array.isArray(a)?new C(a[0],a[1]):a};var I=typeof self<"u"?self:{},B=Math.pow(2,53)-1;function F(a,h,p,x){var E=new A(a,h,p,x);return function(P){return E.solve(P)}}var N=F(.25,.1,.25,1);function V(a,h,p){return Math.min(p,Math.max(h,a))}function G(a,h,p){var x=p-h,E=((a-h)%x+x)%x+h;return E===h?p:E}function Y(a){for(var h=[],p=arguments.length-1;p-- >0;)h[p]=arguments[p+1];for(var x=0,E=h;x<E.length;x+=1){var P=E[x];for(var R in P)a[R]=P[R]}return a}var Z=1;function se(){return Z++}function ge(){return function a(h){return h?(h^16*Math.random()>>h/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Pe(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Ue(a,h){a.forEach(function(p){h[p]&&(h[p]=h[p].bind(h))})}function Fe(a,h){return a.indexOf(h,a.length-h.length)!==-1}function pe(a,h,p){var x={};for(var E in a)x[E]=h.call(p||this,a[E],E,a);return x}function Te(a,h,p){var x={};for(var E in a)h.call(p||this,a[E],E,a)&&(x[E]=a[E]);return x}function Ae(a){return Array.isArray(a)?a.map(Ae):typeof a=="object"&&a?pe(a,Ae):a}var Le={};function Ve(a){Le[a]||(typeof console<"u"&&console.warn(a),Le[a]=!0)}function Xe(a,h,p){return(p.y-a.y)*(h.x-a.x)>(h.y-a.y)*(p.x-a.x)}function dt(a){for(var h=0,p=0,x=a.length,E=x-1,P=void 0,R=void 0;p<x;E=p++)h+=((R=a[E]).x-(P=a[p]).x)*(P.y+R.y);return h}function Nt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function gr(a){var h={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(x,E,P,R){var O=P||R;return h[E]=!O||O.toLowerCase(),""}),h["max-age"]){var p=parseInt(h["max-age"],10);isNaN(p)?delete h["max-age"]:h["max-age"]=p}return h}var mr=null;function _r(a){if(mr==null){var h=a.navigator?a.navigator.userAgent:null;mr=!!a.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return mr}function rr(a){try{var h=I[a];return h.setItem("_mapbox_test_",1),h.removeItem("_mapbox_test_"),!0}catch{return!1}}var Ot,Qt,qt,Rt,ut=I.performance&&I.performance.now?I.performance.now.bind(I.performance):Date.now.bind(Date),Vi=I.requestAnimationFrame||I.mozRequestAnimationFrame||I.webkitRequestAnimationFrame||I.msRequestAnimationFrame,Sr=I.cancelAnimationFrame||I.mozCancelAnimationFrame||I.webkitCancelAnimationFrame||I.msCancelAnimationFrame,Ur={now:ut,frame:function(a){var h=Vi(a);return{cancel:function(){return Sr(h)}}},getImageData:function(a,h){h===void 0&&(h=0);var p=I.document.createElement("canvas"),x=p.getContext("2d");if(!x)throw new Error("failed to create canvas 2d context");return p.width=a.width,p.height=a.height,x.drawImage(a,0,0,a.width,a.height),x.getImageData(-h,-h,a.width+2*h,a.height+2*h)},resolveURL:function(a){return Ot||(Ot=I.document.createElement("a")),Ot.href=a,Ot.href},hardwareConcurrency:I.navigator&&I.navigator.hardwareConcurrency||4,get devicePixelRatio(){return I.devicePixelRatio},get prefersReducedMotion(){return!!I.matchMedia&&(Qt==null&&(Qt=I.matchMedia("(prefers-reduced-motion: reduce)")),Qt.matches)}},Dt={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},$r={supported:!1,testSupport:function(a){!Pi&&Rt&&(yi?dr(a):qt=a)}},Pi=!1,yi=!1;function dr(a){var h=a.createTexture();a.bindTexture(a.TEXTURE_2D,h);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Rt),a.isContextLost())return;$r.supported=!0}catch{}a.deleteTexture(h),Pi=!0}I.document&&((Rt=I.document.createElement("img")).onload=function(){qt&&dr(qt),qt=null,yi=!0},Rt.onerror=function(){Pi=!0,qt=null},Rt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var gn="01",oi=function(a,h){this._transformRequestFn=a,this._customAccessToken=h,this._createSkuToken()};function xi(a){return a.indexOf("mapbox:")===0}oi.prototype._createSkuToken=function(){var a=function(){for(var h="",p=0;p<10;p++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",gn,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},oi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},oi.prototype.transformRequest=function(a,h){return this._transformRequestFn&&this._transformRequestFn(a,h)||{url:a}},oi.prototype.normalizeStyleURL=function(a,h){if(!xi(a))return a;var p=ln(a);return p.path="/styles/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||h)},oi.prototype.normalizeGlyphsURL=function(a,h){if(!xi(a))return a;var p=ln(a);return p.path="/fonts/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||h)},oi.prototype.normalizeSourceURL=function(a,h){if(!xi(a))return a;var p=ln(a);return p.path="/v4/"+p.authority+".json",p.params.push("secure"),this._makeAPIURL(p,this._customAccessToken||h)},oi.prototype.normalizeSpriteURL=function(a,h,p,x){var E=ln(a);return xi(a)?(E.path="/styles/v1"+E.path+"/sprite"+h+p,this._makeAPIURL(E,this._customAccessToken||x)):(E.path+=""+h+p,ni(E))},oi.prototype.normalizeTileURL=function(a,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!xi(a))return a;var p=ln(a);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Ur.devicePixelRatio>=2||h===512?"@2x":"")+($r.supported?".webp":"$1")),p.path=p.path.replace(/^.+\/v4\//,"/"),p.path="/v4"+p.path;var x=this._customAccessToken||function(E){for(var P=0,R=E;P<R.length;P+=1){var O=R[P].match(/^access_token=(.*)$/);if(O)return O[1]}return null}(p.params)||Dt.ACCESS_TOKEN;return Dt.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&p.params.push("sku="+this._skuToken),this._makeAPIURL(p,x)},oi.prototype.canonicalizeTileURL=function(a,h){var p=ln(a);if(!p.path.match(/(^\/v4\/)/)||!p.path.match(/\.[\w]+$/))return a;var x="mapbox://tiles/";x+=p.path.replace("/v4/","");var E=p.params;return h&&(E=E.filter(function(P){return!P.match(/^access_token=/)})),E.length&&(x+="?"+E.join("&")),x},oi.prototype.canonicalizeTileset=function(a,h){for(var p=!!h&&xi(h),x=[],E=0,P=a.tiles||[];E<P.length;E+=1){var R=P[E];$i(R)?x.push(this.canonicalizeTileURL(R,p)):x.push(R)}return x},oi.prototype._makeAPIURL=function(a,h){var p="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",x=ln(Dt.API_URL);if(a.protocol=x.protocol,a.authority=x.authority,a.protocol==="http"){var E=a.params.indexOf("secure");E>=0&&a.params.splice(E,1)}if(x.path!=="/"&&(a.path=""+x.path+a.path),!Dt.REQUIRE_ACCESS_TOKEN)return ni(a);if(!(h=h||Dt.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+p);if(h[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+p);return a.params=a.params.filter(function(P){return P.indexOf("access_token")===-1}),a.params.push("access_token="+h),ni(a)};var an=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function $i(a){return an.test(a)}var Zs=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ln(a){var h=a.match(Zs);if(!h)throw new Error("Unable to parse URL object");return{protocol:h[1],authority:h[2],path:h[3]||"/",params:h[4]?h[4].split("&"):[]}}function ni(a){var h=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+h}function Is(a){if(!a)return null;var h=a.split(".");if(!h||h.length!==3)return null;try{return JSON.parse(decodeURIComponent(I.atob(h[1]).split("").map(function(p){return"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var nn=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};nn.prototype.getStorageKey=function(a){var h,p=Is(Dt.ACCESS_TOKEN);return h=p&&p.u?I.btoa(encodeURIComponent(p.u).replace(/%([0-9A-F]{2})/g,function(x,E){return String.fromCharCode(+("0x"+E))})):Dt.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+h:"mapbox.eventData:"+h},nn.prototype.fetchEventData=function(){var a=rr("localStorage"),h=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{var x=I.localStorage.getItem(h);x&&(this.eventData=JSON.parse(x));var E=I.localStorage.getItem(p);E&&(this.anonId=E)}catch{Ve("Unable to read from LocalStorage")}},nn.prototype.saveEventData=function(){var a=rr("localStorage"),h=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{I.localStorage.setItem(p,this.anonId),Object.keys(this.eventData).length>=1&&I.localStorage.setItem(h,JSON.stringify(this.eventData))}catch{Ve("Unable to write to LocalStorage")}},nn.prototype.processRequests=function(a){},nn.prototype.postEvent=function(a,h,p,x){var E=this;if(Dt.EVENTS_URL){var P=ln(Dt.EVENTS_URL);P.params.push("access_token="+(x||Dt.ACCESS_TOKEN||""));var R={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:gn,userId:this.anonId},O=h?Y(R,h):R,k={url:ni(P),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=vi(k,function(H){E.pendingRequest=null,p(H),E.saveEventData(),E.processRequests(x)})}},nn.prototype.queueRequest=function(a,h){this.queue.push(a),this.processRequests(h)};var Oi,is,vt=function(a){function h(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.postMapLoadEvent=function(p,x,E,P){this.skuToken=E;var R=!(!P&&!Dt.ACCESS_TOKEN),O=Array.isArray(p)&&p.some(function(k){return xi(k)||$i(k)});Dt.EVENTS_URL&&R&&O&&this.queueRequest({id:x,timestamp:Date.now()},P)},h.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){var E=this.queue.shift(),P=E.id,R=E.timestamp;P&&this.success[P]||(this.anonId||this.fetchEventData(),Pe(this.anonId)||(this.anonId=ge()),this.postEvent(R,{skuToken:this.skuToken},function(O){O||P&&(x.success[P]=!0)},p))}},h}(nn),Yt=new(function(a){function h(p){a.call(this,"appUserTurnstile"),this._customAccessToken=p}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.postTurnstileEvent=function(p,x){Dt.EVENTS_URL&&Dt.ACCESS_TOKEN&&Array.isArray(p)&&p.some(function(E){return xi(E)||$i(E)})&&this.queueRequest(Date.now(),x)},h.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var E=Is(Dt.ACCESS_TOKEN),P=E?E.u:Dt.ACCESS_TOKEN,R=P!==this.eventData.tokenU;Pe(this.anonId)||(this.anonId=ge(),R=!0);var O=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),H=new Date(O),X=(O-this.eventData.lastSuccess)/864e5;R=R||X>=1||X<-1||k.getDate()!==H.getDate()}else R=!0;if(!R)return this.processRequests();this.postEvent(O,{"enabled.telemetry":!1},function(q){q||(x.eventData.lastSuccess=O,x.eventData.tokenU=P)},p)}},h}(nn)),Mr=Yt.postTurnstileEvent.bind(Yt),qr=new vt,kn=qr.postMapLoadEvent.bind(qr),Di=500,mn=50;function Xn(){I.caches&&!Oi&&(Oi=I.caches.open("mapbox-tiles"))}function ho(a){var h=a.indexOf("?");return h<0?a:a.slice(0,h)}var Ro,ea=1/0;function Ia(){return Ro==null&&(Ro=I.OffscreenCanvas&&new I.OffscreenCanvas(1,1).getContext("2d")&&typeof I.createImageBitmap=="function"),Ro}var Bo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Bo);var al=function(a){function h(p,x,E){x===401&&$i(E)&&(p+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,p),this.status=x,this.url=E,this.name=this.constructor.name,this.message=p}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},h}(Error),Ks=Nt()?function(){return self.worker&&self.worker.referrer}:function(){return(I.location.protocol==="blob:"?I.parent:I).location.href},Ms,Rs,yt=function(a,h){if(!(/^file:/.test(p=a.url)||/^file:/.test(Ks())&&!/^\w+:/.test(p))){if(I.fetch&&I.Request&&I.AbortController&&I.Request.prototype.hasOwnProperty("signal"))return function(x,E){var P,R=new I.AbortController,O=new I.Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:Ks(),signal:R.signal}),k=!1,H=!1,X=(P=O.url).indexOf("sku=")>0&&$i(P);x.type==="json"&&O.headers.set("Accept","application/json");var q=function(ae,ve,xe){if(!H){if(ae&&ae.message!=="SecurityError"&&Ve(ae),ve&&xe)return re(ve);var Be=Date.now();I.fetch(O).then(function(Se){if(Se.ok){var Ne=X?Se.clone():null;return re(Se,Ne,Be)}return E(new al(Se.statusText,Se.status,x.url))}).catch(function(Se){Se.code!==20&&E(new Error(Se.message))})}},re=function(ae,ve,xe){(x.type==="arrayBuffer"?ae.arrayBuffer():x.type==="json"?ae.json():ae.text()).then(function(Be){H||(ve&&xe&&function(Se,Ne,We){if(Xn(),Oi){var Ye={status:Ne.status,statusText:Ne.statusText,headers:new I.Headers};Ne.headers.forEach(function(ot,pt){return Ye.headers.set(pt,ot)});var et=gr(Ne.headers.get("Cache-Control")||"");et["no-store"]||(et["max-age"]&&Ye.headers.set("Expires",new Date(We+1e3*et["max-age"]).toUTCString()),new Date(Ye.headers.get("Expires")).getTime()-We<42e4||function(ot,pt){if(is===void 0)try{new Response(new ReadableStream),is=!0}catch{is=!1}is?pt(ot.body):ot.blob().then(pt)}(Ne,function(ot){var pt=new I.Response(ot,Ye);Xn(),Oi&&Oi.then(function(wt){return wt.put(ho(Se.url),pt)}).catch(function(wt){return Ve(wt.message)})}))}}(O,ve,xe),k=!0,E(null,Be,ae.headers.get("Cache-Control"),ae.headers.get("Expires")))}).catch(function(Be){H||E(new Error(Be.message))})};return X?function(ae,ve){if(Xn(),!Oi)return ve(null);var xe=ho(ae.url);Oi.then(function(Be){Be.match(xe).then(function(Se){var Ne=function(We){if(!We)return!1;var Ye=new Date(We.headers.get("Expires")||0),et=gr(We.headers.get("Cache-Control")||"");return Ye>Date.now()&&!et["no-cache"]}(Se);Be.delete(xe),Ne&&Be.put(xe,Se.clone()),ve(null,Se,Ne)}).catch(ve)}).catch(ve)}(O,q):q(null,null),{cancel:function(){H=!0,k||R.abort()}}}(a,h);if(Nt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,h,void 0,!0)}var p;return function(x,E){var P=new I.XMLHttpRequest;for(var R in P.open(x.method||"GET",x.url,!0),x.type==="arrayBuffer"&&(P.responseType="arraybuffer"),x.headers)P.setRequestHeader(R,x.headers[R]);return x.type==="json"&&(P.responseType="text",P.setRequestHeader("Accept","application/json")),P.withCredentials=x.credentials==="include",P.onerror=function(){E(new Error(P.statusText))},P.onload=function(){if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){var O=P.response;if(x.type==="json")try{O=JSON.parse(P.response)}catch(k){return E(k)}E(null,O,P.getResponseHeader("Cache-Control"),P.getResponseHeader("Expires"))}else E(new al(P.statusText,P.status,x.url))},P.send(x.body),{cancel:function(){return P.abort()}}}(a,h)},Ma=function(a,h){return yt(Y(a,{type:"arrayBuffer"}),h)},vi=function(a,h){return yt(Y(a,{method:"POST"}),h)},$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ms=[],Rs=0;var ee=function(a,h){if($r.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Rs>=Dt.MAX_PARALLEL_IMAGE_REQUESTS){var p={requestParameters:a,callback:h,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ms.push(p),p}Rs++;var x=!1,E=function(){if(!x)for(x=!0,Rs--;Ms.length&&Rs<Dt.MAX_PARALLEL_IMAGE_REQUESTS;){var R=Ms.shift();R.cancelled||(R.cancel=ee(R.requestParameters,R.callback).cancel)}},P=Ma(a,function(R,O,k,H){E(),R?h(R):O&&(Ia()?function(X,q){var re=new I.Blob([new Uint8Array(X)],{type:"image/png"});I.createImageBitmap(re).then(function(ae){q(null,ae)}).catch(function(ae){q(new Error("Could not load image because of "+ae.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(O,h):function(X,q,re,ae){var ve=new I.Image,xe=I.URL;ve.onload=function(){q(null,ve),xe.revokeObjectURL(ve.src),ve.onload=null,I.requestAnimationFrame(function(){ve.src=$})},ve.onerror=function(){return q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Be=new I.Blob([new Uint8Array(X)],{type:"image/png"});ve.cacheControl=re,ve.expires=ae,ve.src=X.byteLength?xe.createObjectURL(Be):$}(O,h,k,H))});return{cancel:function(){P.cancel(),E()}}};function oe(a,h,p){p[a]&&p[a].indexOf(h)!==-1||(p[a]=p[a]||[],p[a].push(h))}function fe(a,h,p){if(p&&p[a]){var x=p[a].indexOf(h);x!==-1&&p[a].splice(x,1)}}var be=function(a,h){h===void 0&&(h={}),Y(this,h),this.type=a},Oe=function(a){function h(p,x){x===void 0&&(x={}),a.call(this,"error",Y({error:p},x))}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(be),De=function(){};De.prototype.on=function(a,h){return this._listeners=this._listeners||{},oe(a,h,this._listeners),this},De.prototype.off=function(a,h){return fe(a,h,this._listeners),fe(a,h,this._oneTimeListeners),this},De.prototype.once=function(a,h){return this._oneTimeListeners=this._oneTimeListeners||{},oe(a,h,this._oneTimeListeners),this},De.prototype.fire=function(a,h){typeof a=="string"&&(a=new be(a,h||{}));var p=a.type;if(this.listens(p)){a.target=this;for(var x=0,E=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];x<E.length;x+=1)E[x].call(this,a);for(var P=0,R=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];P<R.length;P+=1){var O=R[P];fe(p,O,this._oneTimeListeners),O.call(this,a)}var k=this._eventedParent;k&&(Y(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(a))}else a instanceof Oe&&console.error(a.error);return this},De.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},De.prototype.setEventedParent=function(a,h){return this._eventedParent=a,this._eventedParentData=h,this};var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},we=function(a,h,p,x){this.message=(a?a+": ":"")+p,x&&(this.identifier=x),h!=null&&h.__line__&&(this.line=h.__line__)};function he(a){var h=a.value;return h?[new we(a.key,h,"constants have been deprecated as of v8")]:[]}function Re(a){for(var h=[],p=arguments.length-1;p-- >0;)h[p]=arguments[p+1];for(var x=0,E=h;x<E.length;x+=1){var P=E[x];for(var R in P)a[R]=P[R]}return a}function ze(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function ke(a){if(Array.isArray(a))return a.map(ke);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var h={};for(var p in a)h[p]=ke(a[p]);return h}return ze(a)}var _=function(a){function h(p,x){a.call(this,x),this.message=x,this.key=p}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(Error),ne=function(a,h){h===void 0&&(h=[]),this.parent=a,this.bindings={};for(var p=0,x=h;p<x.length;p+=1){var E=x[p];this.bindings[E[0]]=E[1]}};ne.prototype.concat=function(a){return new ne(this,a)},ne.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},ne.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var ht={kind:"null"},qe={kind:"number"},gt={kind:"string"},nt={kind:"boolean"},at={kind:"color"},er={kind:"object"},ct={kind:"value"},It={kind:"collator"},Ir={kind:"formatted"},yr={kind:"resolvedImage"};function Lr(a,h){return{kind:"array",itemType:a,N:h}}function ur(a){if(a.kind==="array"){var h=ur(a.itemType);return typeof a.N=="number"?"array<"+h+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+h+">"}return a.kind}var Yr=[ht,qe,gt,nt,at,Ir,er,Lr(ct),yr];function xr(a,h){if(h.kind==="error")return null;if(a.kind==="array"){if(h.kind==="array"&&(h.N===0&&h.itemType.kind==="value"||!xr(a.itemType,h.itemType))&&(typeof a.N!="number"||a.N===h.N))return null}else{if(a.kind===h.kind)return null;if(a.kind==="value"){for(var p=0,x=Yr;p<x.length;p+=1)if(!xr(x[p],h))return null}}return"Expected "+ur(a)+" but found "+ur(h)+" instead."}function Fr(a,h){return h.some(function(p){return p.kind===a.kind})}function zr(a,h){return h.some(function(p){return p==="null"?a===null:p==="array"?Array.isArray(a):p==="object"?a&&!Array.isArray(a)&&typeof a=="object":p===typeof a})}var Ar=f(function(a,h){var p={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function x(O){return(O=Math.round(O))<0?0:O>255?255:O}function E(O){return x(O[O.length-1]==="%"?parseFloat(O)/100*255:parseInt(O))}function P(O){return(k=O[O.length-1]==="%"?parseFloat(O)/100:parseFloat(O))<0?0:k>1?1:k;var k}function R(O,k,H){return H<0?H+=1:H>1&&(H-=1),6*H<1?O+(k-O)*H*6:2*H<1?k:3*H<2?O+(k-O)*(2/3-H)*6:O}try{h.parseCSSColor=function(O){var k,H=O.replace(/ /g,"").toLowerCase();if(H in p)return p[H].slice();if(H[0]==="#")return H.length===4?(k=parseInt(H.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:H.length===7&&(k=parseInt(H.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var X=H.indexOf("("),q=H.indexOf(")");if(X!==-1&&q+1===H.length){var re=H.substr(0,X),ae=H.substr(X+1,q-(X+1)).split(","),ve=1;switch(re){case"rgba":if(ae.length!==4)return null;ve=P(ae.pop());case"rgb":return ae.length!==3?null:[E(ae[0]),E(ae[1]),E(ae[2]),ve];case"hsla":if(ae.length!==4)return null;ve=P(ae.pop());case"hsl":if(ae.length!==3)return null;var xe=(parseFloat(ae[0])%360+360)%360/360,Be=P(ae[1]),Se=P(ae[2]),Ne=Se<=.5?Se*(Be+1):Se+Be-Se*Be,We=2*Se-Ne;return[x(255*R(We,Ne,xe+1/3)),x(255*R(We,Ne,xe)),x(255*R(We,Ne,xe-1/3)),ve];default:return null}}return null}}catch{}}).parseCSSColor,pr=function(a,h,p,x){x===void 0&&(x=1),this.r=a,this.g=h,this.b=p,this.a=x};pr.parse=function(a){if(a){if(a instanceof pr)return a;if(typeof a=="string"){var h=Ar(a);if(h)return new pr(h[0]/255*h[3],h[1]/255*h[3],h[2]/255*h[3],h[3])}}},pr.prototype.toString=function(){var a=this.toArray(),h=a[1],p=a[2],x=a[3];return"rgba("+Math.round(a[0])+","+Math.round(h)+","+Math.round(p)+","+x+")"},pr.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},pr.black=new pr(0,0,0,1),pr.white=new pr(1,1,1,1),pr.transparent=new pr(0,0,0,0),pr.red=new pr(1,0,0,1);var ir=function(a,h,p){this.sensitivity=a?h?"variant":"case":h?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ir.prototype.compare=function(a,h){return this.collator.compare(a,h)},ir.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var me=function(a,h,p,x,E){this.text=a,this.image=h,this.scale=p,this.fontStack=x,this.textColor=E},zt=function(a){this.sections=a};zt.fromString=function(a){return new zt([new me(a,null,null,null,null)])},zt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},zt.factory=function(a){return a instanceof zt?a:zt.fromString(a)},zt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},zt.prototype.serialize=function(){for(var a=["format"],h=0,p=this.sections;h<p.length;h+=1){var x=p[h];if(x.image)a.push(["image",x.image.name]);else{a.push(x.text);var E={};x.fontStack&&(E["text-font"]=["literal",x.fontStack.split(",")]),x.scale&&(E["font-scale"]=x.scale),x.textColor&&(E["text-color"]=["rgba"].concat(x.textColor.toArray())),a.push(E)}}return a};var hi=function(a){this.name=a.name,this.available=a.available};function ta(a,h,p,x){return typeof a=="number"&&a>=0&&a<=255&&typeof h=="number"&&h>=0&&h<=255&&typeof p=="number"&&p>=0&&p<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:"Invalid rgba value ["+[a,h,p,x].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof x=="number"?[a,h,p,x]:[a,h,p]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Oo(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof pr||a instanceof ir||a instanceof zt||a instanceof hi)return!0;if(Array.isArray(a)){for(var h=0,p=a;h<p.length;h+=1)if(!Oo(p[h]))return!1;return!0}if(typeof a=="object"){for(var x in a)if(!Oo(a[x]))return!1;return!0}return!1}function di(a){if(a===null)return ht;if(typeof a=="string")return gt;if(typeof a=="boolean")return nt;if(typeof a=="number")return qe;if(a instanceof pr)return at;if(a instanceof ir)return It;if(a instanceof zt)return Ir;if(a instanceof hi)return yr;if(Array.isArray(a)){for(var h,p=a.length,x=0,E=a;x<E.length;x+=1){var P=di(E[x]);if(h){if(h===P)continue;h=ct;break}h=P}return Lr(h||ct,p)}return er}function Do(a){var h=typeof a;return a===null?"":h==="string"||h==="number"||h==="boolean"?String(a):a instanceof pr||a instanceof zt||a instanceof hi?a.toString():JSON.stringify(a)}hi.prototype.toString=function(){return this.name},hi.fromString=function(a){return a?new hi({name:a,available:!1}):null},hi.prototype.serialize=function(){return["image",this.name]};var ue=function(a,h){this.type=a,this.value=h};ue.parse=function(a,h){if(a.length!==2)return h.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Oo(a[1]))return h.error("invalid value");var p=a[1],x=di(p),E=h.expectedType;return x.kind!=="array"||x.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(x=E),new ue(x,p)},ue.prototype.evaluate=function(){return this.value},ue.prototype.eachChild=function(){},ue.prototype.outputDefined=function(){return!0},ue.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof pr?["rgba"].concat(this.value.toArray()):this.value instanceof zt?this.value.serialize():this.value};var Ii=function(a){this.name="ExpressionEvaluationError",this.message=a};Ii.prototype.toJSON=function(){return this.message};var Zi={string:gt,number:qe,boolean:nt,object:er},ai=function(a,h){this.type=a,this.args=h};ai.parse=function(a,h){if(a.length<2)return h.error("Expected at least one argument.");var p,x=1,E=a[0];if(E==="array"){var P,R;if(a.length>2){var O=a[1];if(typeof O!="string"||!(O in Zi)||O==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);P=Zi[O],x++}else P=ct;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return h.error('The length argument to "array" must be a positive integer literal',2);R=a[2],x++}p=Lr(P,R)}else p=Zi[E];for(var k=[];x<a.length;x++){var H=h.parse(a[x],x,ct);if(!H)return null;k.push(H)}return new ai(p,k)},ai.prototype.evaluate=function(a){for(var h=0;h<this.args.length;h++){var p=this.args[h].evaluate(a);if(!xr(this.type,di(p)))return p;if(h===this.args.length-1)throw new Ii("Expected value to be of type "+ur(this.type)+", but found "+ur(di(p))+" instead.")}return null},ai.prototype.eachChild=function(a){this.args.forEach(a)},ai.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},ai.prototype.serialize=function(){var a=this.type,h=[a.kind];if(a.kind==="array"){var p=a.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){h.push(p.kind);var x=a.N;(typeof x=="number"||this.args.length>1)&&h.push(x)}}return h.concat(this.args.map(function(E){return E.serialize()}))};var ns=function(a){this.type=Ir,this.sections=a};ns.parse=function(a,h){if(a.length<2)return h.error("Expected at least one argument.");var p=a[1];if(!Array.isArray(p)&&typeof p=="object")return h.error("First argument must be an image or text section.");for(var x=[],E=!1,P=1;P<=a.length-1;++P){var R=a[P];if(E&&typeof R=="object"&&!Array.isArray(R)){E=!1;var O=null;if(R["font-scale"]&&!(O=h.parse(R["font-scale"],1,qe)))return null;var k=null;if(R["text-font"]&&!(k=h.parse(R["text-font"],1,Lr(gt))))return null;var H=null;if(R["text-color"]&&!(H=h.parse(R["text-color"],1,at)))return null;var X=x[x.length-1];X.scale=O,X.font=k,X.textColor=H}else{var q=h.parse(a[P],1,ct);if(!q)return null;var re=q.type.kind;if(re!=="string"&&re!=="value"&&re!=="null"&&re!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,x.push({content:q,scale:null,font:null,textColor:null})}}return new ns(x)},ns.prototype.evaluate=function(a){return new zt(this.sections.map(function(h){var p=h.content.evaluate(a);return di(p)===yr?new me("",p,null,null,null):new me(Do(p),null,h.scale?h.scale.evaluate(a):null,h.font?h.font.evaluate(a).join(","):null,h.textColor?h.textColor.evaluate(a):null)}))},ns.prototype.eachChild=function(a){for(var h=0,p=this.sections;h<p.length;h+=1){var x=p[h];a(x.content),x.scale&&a(x.scale),x.font&&a(x.font),x.textColor&&a(x.textColor)}},ns.prototype.outputDefined=function(){return!1},ns.prototype.serialize=function(){for(var a=["format"],h=0,p=this.sections;h<p.length;h+=1){var x=p[h];a.push(x.content.serialize());var E={};x.scale&&(E["font-scale"]=x.scale.serialize()),x.font&&(E["text-font"]=x.font.serialize()),x.textColor&&(E["text-color"]=x.textColor.serialize()),a.push(E)}return a};var Rn=function(a){this.type=yr,this.input=a};Rn.parse=function(a,h){if(a.length!==2)return h.error("Expected two arguments.");var p=h.parse(a[1],1,gt);return p?new Rn(p):h.error("No image name provided.")},Rn.prototype.evaluate=function(a){var h=this.input.evaluate(a),p=hi.fromString(h);return p&&a.availableImages&&(p.available=a.availableImages.indexOf(h)>-1),p},Rn.prototype.eachChild=function(a){a(this.input)},Rn.prototype.outputDefined=function(){return!1},Rn.prototype.serialize=function(){return["image",this.input.serialize()]};var Zl={"to-boolean":nt,"to-color":at,"to-number":qe,"to-string":gt},qn=function(a,h){this.type=a,this.args=h};qn.parse=function(a,h){if(a.length<2)return h.error("Expected at least one argument.");var p=a[0];if((p==="to-boolean"||p==="to-string")&&a.length!==2)return h.error("Expected one argument.");for(var x=Zl[p],E=[],P=1;P<a.length;P++){var R=h.parse(a[P],P,ct);if(!R)return null;E.push(R)}return new qn(x,E)},qn.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var h,p,x=0,E=this.args;x<E.length;x+=1){if(p=null,(h=E[x].evaluate(a))instanceof pr)return h;if(typeof h=="string"){var P=a.parseColor(h);if(P)return P}else if(Array.isArray(h)&&!(p=h.length<3||h.length>4?"Invalid rbga value "+JSON.stringify(h)+": expected an array containing either three or four numeric values.":ta(h[0],h[1],h[2],h[3])))return new pr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Ii(p||"Could not parse color from value '"+(typeof h=="string"?h:String(JSON.stringify(h)))+"'")}if(this.type.kind==="number"){for(var R=null,O=0,k=this.args;O<k.length;O+=1){if((R=k[O].evaluate(a))===null)return 0;var H=Number(R);if(!isNaN(H))return H}throw new Ii("Could not convert "+JSON.stringify(R)+" to number.")}return this.type.kind==="formatted"?zt.fromString(Do(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?hi.fromString(Do(this.args[0].evaluate(a))):Do(this.args[0].evaluate(a))},qn.prototype.eachChild=function(a){this.args.forEach(a)},qn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},qn.prototype.serialize=function(){if(this.type.kind==="formatted")return new ns([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Rn(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(h){a.push(h.serialize())}),a};var Uc=["Unknown","Point","LineString","Polygon"],le=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};le.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},le.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Uc[this.feature.type]:this.feature.type:null},le.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},le.prototype.canonicalID=function(){return this.canonical},le.prototype.properties=function(){return this.feature&&this.feature.properties||{}},le.prototype.parseColor=function(a){var h=this._parseColorCache[a];return h||(h=this._parseColorCache[a]=pr.parse(a)),h};var de=function(a,h,p,x){this.name=a,this.type=h,this._evaluate=p,this.args=x};de.prototype.evaluate=function(a){return this._evaluate(a,this.args)},de.prototype.eachChild=function(a){this.args.forEach(a)},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},de.parse=function(a,h){var p,x=a[0],E=de.definitions[x];if(!E)return h.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0);for(var P=Array.isArray(E)?E[0]:E.type,R=Array.isArray(E)?[[E[1],E[2]]]:E.overloads,O=R.filter(function(Xt){var Bt=Xt[0];return!Array.isArray(Bt)||Bt.length===a.length-1}),k=null,H=0,X=O;H<X.length;H+=1){var q=X[H],re=q[0],ae=q[1];k=new Lo(h.registry,h.path,null,h.scope);for(var ve=[],xe=!1,Be=1;Be<a.length;Be++){var Se=a[Be],Ne=Array.isArray(re)?re[Be-1]:re.type,We=k.parse(Se,1+ve.length,Ne);if(!We){xe=!0;break}ve.push(We)}if(!xe)if(Array.isArray(re)&&re.length!==ve.length)k.error("Expected "+re.length+" arguments, but found "+ve.length+" instead.");else{for(var Ye=0;Ye<ve.length;Ye++){var et=Array.isArray(re)?re[Ye]:re.type,ot=ve[Ye];k.concat(Ye+1).checkSubtype(et,ot.type)}if(k.errors.length===0)return new de(x,P,ae,ve)}}if(O.length===1)(p=h.errors).push.apply(p,k.errors);else{for(var pt=(O.length?O:R).map(function(Xt){var Bt;return Bt=Xt[0],Array.isArray(Bt)?"("+Bt.map(ur).join(", ")+")":"("+ur(Bt.type)+"...)"}).join(" | "),wt=[],Ht=1;Ht<a.length;Ht++){var Mt=h.parse(a[Ht],1+wt.length);if(!Mt)return null;wt.push(ur(Mt.type))}h.error("Expected arguments of type "+pt+", but found ("+wt.join(", ")+") instead.")}return null},de.register=function(a,h){for(var p in de.definitions=h,h)a[p]=de};var Ce=function(a,h,p){this.type=It,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=h};function Ze(a,h){a[0]=Math.min(a[0],h[0]),a[1]=Math.min(a[1],h[1]),a[2]=Math.max(a[2],h[0]),a[3]=Math.max(a[3],h[1])}function mt(a,h){return!(a[0]<=h[0]||a[2]>=h[2]||a[1]<=h[1]||a[3]>=h[3])}function Vt(a,h){var p=(180+a[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,E=Math.pow(2,h.z);return[Math.round(p*E*8192),Math.round(x*E*8192)]}function Vr(a,h,p){return h[1]>a[1]!=p[1]>a[1]&&a[0]<(p[0]-h[0])*(a[1]-h[1])/(p[1]-h[1])+h[0]}function ji(a,h){for(var p,x,E,P,R,O,k,H=!1,X=0,q=h.length;X<q;X++)for(var re=h[X],ae=0,ve=re.length;ae<ve-1;ae++){if((P=(p=a)[0]-(x=re[ae])[0])*(k=p[1]-(E=re[ae+1])[1])-(O=p[0]-E[0])*(R=p[1]-x[1])==0&&P*O<=0&&R*k<=0)return!1;Vr(a,re[ae],re[ae+1])&&(H=!H)}return H}function cn(a,h){for(var p=0;p<h.length;p++)if(ji(a,h[p]))return!0;return!1}function _n(a,h,p,x){var E=x[0]-p[0],P=x[1]-p[1],R=(a[0]-p[0])*P-E*(a[1]-p[1]),O=(h[0]-p[0])*P-E*(h[1]-p[1]);return R>0&&O<0||R<0&&O>0}function Wr(a,h,p){for(var x=0,E=p;x<E.length;x+=1)for(var P=E[x],R=0;R<P.length-1;++R)if((q=[(X=P[R+1])[0]-(H=P[R])[0],X[1]-H[1]])[0]*(re=[(k=h)[0]-(O=a)[0],k[1]-O[1]])[1]-q[1]*re[0]!=0&&_n(O,k,H,X)&&_n(H,X,O,k))return!0;var O,k,H,X,q,re;return!1}function zc(a,h){for(var p=0;p<a.length;++p)if(!ji(a[p],h))return!1;for(var x=0;x<a.length-1;++x)if(Wr(a[x],a[x+1],h))return!1;return!0}function Gu(a,h){for(var p=0;p<h.length;p++)if(zc(a,h[p]))return!0;return!1}function ll(a,h,p){for(var x=[],E=0;E<a.length;E++){for(var P=[],R=0;R<a[E].length;R++){var O=Vt(a[E][R],p);Ze(h,O),P.push(O)}x.push(P)}return x}function Wu(a,h,p){for(var x=[],E=0;E<a.length;E++){var P=ll(a[E],h,p);x.push(P)}return x}function Kl(a,h,p,x){if(a[0]<p[0]||a[0]>p[2]){var E=.5*x,P=a[0]-p[0]>E?-x:p[0]-a[0]>E?x:0;P===0&&(P=a[0]-p[2]>E?-x:p[2]-a[0]>E?x:0),a[0]+=P}Ze(h,a)}function Xu(a,h,p,x){for(var E=8192*Math.pow(2,x.z),P=[8192*x.x,8192*x.y],R=[],O=0,k=a;O<k.length;O+=1)for(var H=0,X=k[O];H<X.length;H+=1){var q=X[H],re=[q.x+P[0],q.y+P[1]];Kl(re,h,p,E),R.push(re)}return R}function cl(a,h,p,x){for(var E,P=8192*Math.pow(2,x.z),R=[8192*x.x,8192*x.y],O=[],k=0,H=a;k<H.length;k+=1){for(var X=[],q=0,re=H[k];q<re.length;q+=1){var ae=re[q],ve=[ae.x+R[0],ae.y+R[1]];Ze(h,ve),X.push(ve)}O.push(X)}if(h[2]-h[0]<=P/2){(E=h)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(var xe=0,Be=O;xe<Be.length;xe+=1)for(var Se=0,Ne=Be[xe];Se<Ne.length;Se+=1)Kl(Ne[Se],h,p,P)}return O}Ce.parse=function(a,h){if(a.length!==2)return h.error("Expected one argument.");var p=a[1];if(typeof p!="object"||Array.isArray(p))return h.error("Collator options argument must be an object.");var x=h.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,nt);if(!x)return null;var E=h.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,nt);if(!E)return null;var P=null;return p.locale&&!(P=h.parse(p.locale,1,gt))?null:new Ce(x,E,P)},Ce.prototype.evaluate=function(a){return new ir(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Ce.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Ce.prototype.outputDefined=function(){return!1},Ce.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var ss=function(a,h){this.type=nt,this.geojson=a,this.geometries=h};function ra(a){if(a instanceof de&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof ss)return!1;var h=!0;return a.eachChild(function(p){h&&!ra(p)&&(h=!1)}),h}function ia(a){if(a instanceof de&&a.name==="feature-state")return!1;var h=!0;return a.eachChild(function(p){h&&!ia(p)&&(h=!1)}),h}function na(a,h){if(a instanceof de&&h.indexOf(a.name)>=0)return!1;var p=!0;return a.eachChild(function(x){p&&!na(x,h)&&(p=!1)}),p}ss.parse=function(a,h){if(a.length!==2)return h.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Oo(a[1])){var p=a[1];if(p.type==="FeatureCollection")for(var x=0;x<p.features.length;++x){var E=p.features[x].geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new ss(p,p.features[x].geometry)}else if(p.type==="Feature"){var P=p.geometry.type;if(P==="Polygon"||P==="MultiPolygon")return new ss(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ss(p,p)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ss.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(h,p){var x=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],P=h.canonicalID();if(p.type==="Polygon"){var R=ll(p.coordinates,E,P),O=Xu(h.geometry(),x,E,P);if(!mt(x,E))return!1;for(var k=0,H=O;k<H.length;k+=1)if(!ji(H[k],R))return!1}if(p.type==="MultiPolygon"){var X=Wu(p.coordinates,E,P),q=Xu(h.geometry(),x,E,P);if(!mt(x,E))return!1;for(var re=0,ae=q;re<ae.length;re+=1)if(!cn(ae[re],X))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(h,p){var x=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],P=h.canonicalID();if(p.type==="Polygon"){var R=ll(p.coordinates,E,P),O=cl(h.geometry(),x,E,P);if(!mt(x,E))return!1;for(var k=0,H=O;k<H.length;k+=1)if(!zc(H[k],R))return!1}if(p.type==="MultiPolygon"){var X=Wu(p.coordinates,E,P),q=cl(h.geometry(),x,E,P);if(!mt(x,E))return!1;for(var re=0,ae=q;re<ae.length;re+=1)if(!Gu(ae[re],X))return!1}return!0}(a,this.geometries)}return!1},ss.prototype.eachChild=function(){},ss.prototype.outputDefined=function(){return!0},ss.prototype.serialize=function(){return["within",this.geojson]};var Fo=function(a,h){this.type=h.type,this.name=a,this.boundExpression=h};Fo.parse=function(a,h){if(a.length!==2||typeof a[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");var p=a[1];return h.scope.has(p)?new Fo(p,h.scope.get(p)):h.error('Unknown variable "'+p+'". Make sure "'+p+'" has been bound in an enclosing "let" expression before using it.',1)},Fo.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Fo.prototype.eachChild=function(){},Fo.prototype.outputDefined=function(){return!1},Fo.prototype.serialize=function(){return["var",this.name]};var Lo=function(a,h,p,x,E){h===void 0&&(h=[]),x===void 0&&(x=new ne),E===void 0&&(E=[]),this.registry=a,this.path=h,this.key=h.map(function(P){return"["+P+"]"}).join(""),this.scope=x,this.errors=E,this.expectedType=p};function Vc(a,h){for(var p,x=a.length-1,E=0,P=x,R=0;E<=P;)if((p=a[R=Math.floor((E+P)/2)])<=h){if(R===x||h<a[R+1])return R;E=R+1}else{if(!(p>h))throw new Ii("Input is not a number.");P=R-1}return 0}Lo.prototype.parse=function(a,h,p,x,E){return E===void 0&&(E={}),h?this.concat(h,p,x)._parse(a,E):this._parse(a,E)},Lo.prototype._parse=function(a,h){function p(H,X,q){return q==="assert"?new ai(X,[H]):q==="coerce"?new qn(X,[H]):H}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var x=a[0];if(typeof x!="string")return this.error("Expression name must be a string, but found "+typeof x+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var E=this.registry[x];if(E){var P=E.parse(a,this);if(!P)return null;if(this.expectedType){var R=this.expectedType,O=P.type;if(R.kind!=="string"&&R.kind!=="number"&&R.kind!=="boolean"&&R.kind!=="object"&&R.kind!=="array"||O.kind!=="value")if(R.kind!=="color"&&R.kind!=="formatted"&&R.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string"){if(this.checkSubtype(R,O))return null}else P=p(P,R,h.typeAnnotation||"coerce");else P=p(P,R,h.typeAnnotation||"assert")}if(!(P instanceof ue)&&P.type.kind!=="resolvedImage"&&function H(X){if(X instanceof Fo)return H(X.boundExpression);if(X instanceof de&&X.name==="error"||X instanceof Ce||X instanceof ss)return!1;var q=X instanceof qn||X instanceof ai,re=!0;return X.eachChild(function(ae){re=q?re&&H(ae):re&&ae instanceof ue}),!!re&&ra(X)&&na(X,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(P)){var k=new le;try{P=new ue(P.type,P.evaluate(k))}catch(H){return this.error(H.message),null}}return P}return this.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},Lo.prototype.concat=function(a,h,p){var x=typeof a=="number"?this.path.concat(a):this.path,E=p?this.scope.concat(p):this.scope;return new Lo(this.registry,x,h||null,E,this.errors)},Lo.prototype.error=function(a){for(var h=[],p=arguments.length-1;p-- >0;)h[p]=arguments[p+1];var x=""+this.key+h.map(function(E){return"["+E+"]"}).join("");this.errors.push(new _(x,a))},Lo.prototype.checkSubtype=function(a,h){var p=xr(a,h);return p&&this.error(p),p};var os=function(a,h,p){this.type=a,this.input=h,this.labels=[],this.outputs=[];for(var x=0,E=p;x<E.length;x+=1){var P=E[x],R=P[1];this.labels.push(P[0]),this.outputs.push(R)}};function Hi(a,h,p){return a*(1-p)+h*p}os.parse=function(a,h){if(a.length-1<4)return h.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");var p=h.parse(a[1],1,qe);if(!p)return null;var x=[],E=null;h.expectedType&&h.expectedType.kind!=="value"&&(E=h.expectedType);for(var P=1;P<a.length;P+=2){var R=P===1?-1/0:a[P],O=a[P+1],k=P,H=P+1;if(typeof R!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(x.length&&x[x.length-1][0]>=R)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var X=h.parse(O,H,E);if(!X)return null;E=E||X.type,x.push([R,X])}return new os(E,p,x)},os.prototype.evaluate=function(a){var h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=h[0])return p[0].evaluate(a);var E=h.length;return x>=h[E-1]?p[E-1].evaluate(a):p[Vc(h,x)].evaluate(a)},os.prototype.eachChild=function(a){a(this.input);for(var h=0,p=this.outputs;h<p.length;h+=1)a(p[h])},os.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},os.prototype.serialize=function(){for(var a=["step",this.input.serialize()],h=0;h<this.labels.length;h++)h>0&&a.push(this.labels[h]),a.push(this.outputs[h].serialize());return a};var Ki=Object.freeze({__proto__:null,number:Hi,color:function(a,h,p){return new pr(Hi(a.r,h.r,p),Hi(a.g,h.g,p),Hi(a.b,h.b,p),Hi(a.a,h.a,p))},array:function(a,h,p){return a.map(function(x,E){return Hi(x,h[E],p)})}}),sa=6/29*3*(6/29),$n=Math.PI/180,qu=180/Math.PI;function jc(a){return a>.008856451679035631?Math.pow(a,1/3):a/sa+4/29}function ul(a){return a>6/29?a*a*a:sa*(a-4/29)}function $u(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Zu(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Qh(a){var h=Zu(a.r),p=Zu(a.g),x=Zu(a.b),E=jc((.4124564*h+.3575761*p+.1804375*x)/.95047),P=jc((.2126729*h+.7151522*p+.072175*x)/1);return{l:116*P-16,a:500*(E-P),b:200*(P-jc((.0193339*h+.119192*p+.9503041*x)/1.08883)),alpha:a.a}}function Ku(a){var h=(a.l+16)/116,p=isNaN(a.a)?h:h+a.a/500,x=isNaN(a.b)?h:h-a.b/200;return h=1*ul(h),p=.95047*ul(p),x=1.08883*ul(x),new pr($u(3.2404542*p-1.5371385*h-.4985314*x),$u(-.969266*p+1.8760108*h+.041556*x),$u(.0556434*p-.2040259*h+1.0572252*x),a.alpha)}function Hc(a,h,p){var x=h-a;return a+p*(x>180||x<-180?x-360*Math.round(x/360):x)}var Ys={forward:Qh,reverse:Ku,interpolate:function(a,h,p){return{l:Hi(a.l,h.l,p),a:Hi(a.a,h.a,p),b:Hi(a.b,h.b,p),alpha:Hi(a.alpha,h.alpha,p)}}},hl={forward:function(a){var h=Qh(a),p=h.l,x=h.a,E=h.b,P=Math.atan2(E,x)*qu;return{h:P<0?P+360:P,c:Math.sqrt(x*x+E*E),l:p,alpha:a.a}},reverse:function(a){var h=a.h*$n,p=a.c;return Ku({l:a.l,a:Math.cos(h)*p,b:Math.sin(h)*p,alpha:a.alpha})},interpolate:function(a,h,p){return{h:Hc(a.h,h.h,p),c:Hi(a.c,h.c,p),l:Hi(a.l,h.l,p),alpha:Hi(a.alpha,h.alpha,p)}}},Yu=Object.freeze({__proto__:null,lab:Ys,hcl:hl}),Yi=function(a,h,p,x,E){this.type=a,this.operator=h,this.interpolation=p,this.input=x,this.labels=[],this.outputs=[];for(var P=0,R=E;P<R.length;P+=1){var O=R[P],k=O[1];this.labels.push(O[0]),this.outputs.push(k)}};function ko(a,h,p,x){var E=x-p,P=a-p;return E===0?0:h===1?P/E:(Math.pow(h,P)-1)/(Math.pow(h,E)-1)}Yi.interpolationFactor=function(a,h,p,x){var E=0;if(a.name==="exponential")E=ko(h,a.base,p,x);else if(a.name==="linear")E=ko(h,1,p,x);else if(a.name==="cubic-bezier"){var P=a.controlPoints;E=new A(P[0],P[1],P[2],P[3]).solve(ko(h,1,p,x))}return E},Yi.parse=function(a,h){var p=a[0],x=a[1],E=a[2],P=a.slice(3);if(!Array.isArray(x)||x.length===0)return h.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){var R=x[1];if(typeof R!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:R}}else{if(x[0]!=="cubic-bezier")return h.error("Unknown interpolation type "+String(x[0]),1,0);var O=x.slice(1);if(O.length!==4||O.some(function(Be){return typeof Be!="number"||Be<0||Be>1}))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:O}}if(a.length-1<4)return h.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(!(E=h.parse(E,2,qe)))return null;var k=[],H=null;p==="interpolate-hcl"||p==="interpolate-lab"?H=at:h.expectedType&&h.expectedType.kind!=="value"&&(H=h.expectedType);for(var X=0;X<P.length;X+=2){var q=P[X],re=P[X+1],ae=X+3,ve=X+4;if(typeof q!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ae);if(k.length&&k[k.length-1][0]>=q)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ae);var xe=h.parse(re,ve,H);if(!xe)return null;H=H||xe.type,k.push([q,xe])}return H.kind==="number"||H.kind==="color"||H.kind==="array"&&H.itemType.kind==="number"&&typeof H.N=="number"?new Yi(H,p,x,E,k):h.error("Type "+ur(H)+" is not interpolatable.")},Yi.prototype.evaluate=function(a){var h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=h[0])return p[0].evaluate(a);var E=h.length;if(x>=h[E-1])return p[E-1].evaluate(a);var P=Vc(h,x),R=Yi.interpolationFactor(this.interpolation,x,h[P],h[P+1]),O=p[P].evaluate(a),k=p[P+1].evaluate(a);return this.operator==="interpolate"?Ki[this.type.kind.toLowerCase()](O,k,R):this.operator==="interpolate-hcl"?hl.reverse(hl.interpolate(hl.forward(O),hl.forward(k),R)):Ys.reverse(Ys.interpolate(Ys.forward(O),Ys.forward(k),R))},Yi.prototype.eachChild=function(a){a(this.input);for(var h=0,p=this.outputs;h<p.length;h+=1)a(p[h])},Yi.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Yi.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var h=[this.operator,a,this.input.serialize()],p=0;p<this.labels.length;p++)h.push(this.labels[p],this.outputs[p].serialize());return h};var Zn=function(a,h){this.type=a,this.args=h};Zn.parse=function(a,h){if(a.length<2)return h.error("Expectected at least one argument.");var p=null,x=h.expectedType;x&&x.kind!=="value"&&(p=x);for(var E=[],P=0,R=a.slice(1);P<R.length;P+=1){var O=h.parse(R[P],1+E.length,p,void 0,{typeAnnotation:"omit"});if(!O)return null;p=p||O.type,E.push(O)}var k=x&&E.some(function(H){return xr(x,H.type)});return new Zn(k?ct:p,E)},Zn.prototype.evaluate=function(a){for(var h,p=null,x=0,E=0,P=this.args;E<P.length&&(x++,(p=P[E].evaluate(a))&&p instanceof hi&&!p.available&&(h||(h=p.name),p=null,x===this.args.length&&(p=h)),p===null);E+=1);return p},Zn.prototype.eachChild=function(a){this.args.forEach(a)},Zn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Zn.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(h){a.push(h.serialize())}),a};var No=function(a,h){this.type=h.type,this.bindings=[].concat(a),this.result=h};No.prototype.evaluate=function(a){return this.result.evaluate(a)},No.prototype.eachChild=function(a){for(var h=0,p=this.bindings;h<p.length;h+=1)a(p[h][1]);a(this.result)},No.parse=function(a,h){if(a.length<4)return h.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var p=[],x=1;x<a.length-1;x+=2){var E=a[x];if(typeof E!="string")return h.error("Expected string, but found "+typeof E+" instead.",x);if(/[^a-zA-Z0-9_]/.test(E))return h.error("Variable names must contain only alphanumeric characters or '_'.",x);var P=h.parse(a[x+1],x+1);if(!P)return null;p.push([E,P])}var R=h.parse(a[a.length-1],a.length-1,h.expectedType,p);return R?new No(p,R):null},No.prototype.outputDefined=function(){return this.result.outputDefined()},No.prototype.serialize=function(){for(var a=["let"],h=0,p=this.bindings;h<p.length;h+=1){var x=p[h];a.push(x[0],x[1].serialize())}return a.push(this.result.serialize()),a};var oa=function(a,h,p){this.type=a,this.index=h,this.input=p};oa.parse=function(a,h){if(a.length!==3)return h.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=h.parse(a[1],1,qe),x=h.parse(a[2],2,Lr(h.expectedType||ct));return p&&x?new oa(x.type.itemType,p,x):null},oa.prototype.evaluate=function(a){var h=this.index.evaluate(a),p=this.input.evaluate(a);if(h<0)throw new Ii("Array index out of bounds: "+h+" < 0.");if(h>=p.length)throw new Ii("Array index out of bounds: "+h+" > "+(p.length-1)+".");if(h!==Math.floor(h))throw new Ii("Array index must be an integer, but found "+h+" instead.");return p[h]},oa.prototype.eachChild=function(a){a(this.index),a(this.input)},oa.prototype.outputDefined=function(){return!1},oa.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Uo=function(a,h){this.type=nt,this.needle=a,this.haystack=h};Uo.parse=function(a,h){if(a.length!==3)return h.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=h.parse(a[1],1,ct),x=h.parse(a[2],2,ct);return p&&x?Fr(p.type,[nt,gt,qe,ht,ct])?new Uo(p,x):h.error("Expected first argument to be of type boolean, string, number or null, but found "+ur(p.type)+" instead"):null},Uo.prototype.evaluate=function(a){var h=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!p)return!1;if(!zr(h,["boolean","string","number","null"]))throw new Ii("Expected first argument to be of type boolean, string, number or null, but found "+ur(di(h))+" instead.");if(!zr(p,["string","array"]))throw new Ii("Expected second argument to be of type array or string, but found "+ur(di(p))+" instead.");return p.indexOf(h)>=0},Uo.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Uo.prototype.outputDefined=function(){return!0},Uo.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var aa=function(a,h,p){this.type=qe,this.needle=a,this.haystack=h,this.fromIndex=p};aa.parse=function(a,h){if(a.length<=2||a.length>=5)return h.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=h.parse(a[1],1,ct),x=h.parse(a[2],2,ct);if(!p||!x)return null;if(!Fr(p.type,[nt,gt,qe,ht,ct]))return h.error("Expected first argument to be of type boolean, string, number or null, but found "+ur(p.type)+" instead");if(a.length===4){var E=h.parse(a[3],3,qe);return E?new aa(p,x,E):null}return new aa(p,x)},aa.prototype.evaluate=function(a){var h=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!zr(h,["boolean","string","number","null"]))throw new Ii("Expected first argument to be of type boolean, string, number or null, but found "+ur(di(h))+" instead.");if(!zr(p,["string","array"]))throw new Ii("Expected second argument to be of type array or string, but found "+ur(di(p))+" instead.");if(this.fromIndex){var x=this.fromIndex.evaluate(a);return p.indexOf(h,x)}return p.indexOf(h)},aa.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},aa.prototype.outputDefined=function(){return!1},aa.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ra=function(a,h,p,x,E,P){this.inputType=a,this.type=h,this.input=p,this.cases=x,this.outputs=E,this.otherwise=P};Ra.parse=function(a,h){if(a.length<5)return h.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return h.error("Expected an even number of arguments.");var p,x;h.expectedType&&h.expectedType.kind!=="value"&&(x=h.expectedType);for(var E={},P=[],R=2;R<a.length-1;R+=2){var O=a[R],k=a[R+1];Array.isArray(O)||(O=[O]);var H=h.concat(R);if(O.length===0)return H.error("Expected at least one branch label.");for(var X=0,q=O;X<q.length;X+=1){var re=q[X];if(typeof re!="number"&&typeof re!="string")return H.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return H.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof re=="number"&&Math.floor(re)!==re)return H.error("Numeric branch labels must be integer values.");if(p){if(H.checkSubtype(p,di(re)))return null}else p=di(re);if(E[String(re)]!==void 0)return H.error("Branch labels must be unique.");E[String(re)]=P.length}var ae=h.parse(k,R,x);if(!ae)return null;x=x||ae.type,P.push(ae)}var ve=h.parse(a[1],1,ct);if(!ve)return null;var xe=h.parse(a[a.length-1],a.length-1,x);return xe?ve.type.kind!=="value"&&h.concat(1).checkSubtype(p,ve.type)?null:new Ra(p,x,ve,E,P,xe):null},Ra.prototype.evaluate=function(a){var h=this.input.evaluate(a);return(di(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(a)},Ra.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Ra.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Ra.prototype.serialize=function(){for(var a=this,h=["match",this.input.serialize()],p=[],x={},E=0,P=Object.keys(this.cases).sort();E<P.length;E+=1){var R=P[E];(q=x[this.cases[R]])===void 0?(x[this.cases[R]]=p.length,p.push([this.cases[R],[R]])):p[q][1].push(R)}for(var O=function(ae){return a.inputType.kind==="number"?Number(ae):ae},k=0,H=p;k<H.length;k+=1){var X=H[k],q=X[0],re=X[1];h.push(re.length===1?O(re[0]):re.map(O)),h.push(this.outputs[outputIndex$1].serialize())}return h.push(this.otherwise.serialize()),h};var la=function(a,h,p){this.type=a,this.branches=h,this.otherwise=p};la.parse=function(a,h){if(a.length<4)return h.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return h.error("Expected an odd number of arguments.");var p;h.expectedType&&h.expectedType.kind!=="value"&&(p=h.expectedType);for(var x=[],E=1;E<a.length-1;E+=2){var P=h.parse(a[E],E,nt);if(!P)return null;var R=h.parse(a[E+1],E+1,p);if(!R)return null;x.push([P,R]),p=p||R.type}var O=h.parse(a[a.length-1],a.length-1,p);return O?new la(p,x,O):null},la.prototype.evaluate=function(a){for(var h=0,p=this.branches;h<p.length;h+=1){var x=p[h],E=x[1];if(x[0].evaluate(a))return E.evaluate(a)}return this.otherwise.evaluate(a)},la.prototype.eachChild=function(a){for(var h=0,p=this.branches;h<p.length;h+=1){var x=p[h],E=x[1];a(x[0]),a(E)}a(this.otherwise)},la.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},la.prototype.serialize=function(){var a=["case"];return this.eachChild(function(h){a.push(h.serialize())}),a};var ca=function(a,h,p,x){this.type=a,this.input=h,this.beginIndex=p,this.endIndex=x};function ef(a,h){return a==="=="||a==="!="?h.kind==="boolean"||h.kind==="string"||h.kind==="number"||h.kind==="null"||h.kind==="value":h.kind==="string"||h.kind==="number"||h.kind==="value"}function tf(a,h,p,x){return x.compare(h,p)===0}function Qr(a,h,p){var x=a!=="=="&&a!=="!=";return function(){function E(P,R,O){this.type=nt,this.lhs=P,this.rhs=R,this.collator=O,this.hasUntypedArgument=P.type.kind==="value"||R.type.kind==="value"}return E.parse=function(P,R){if(P.length!==3&&P.length!==4)return R.error("Expected two or three arguments.");var O=P[0],k=R.parse(P[1],1,ct);if(!k)return null;if(!ef(O,k.type))return R.concat(1).error('"'+O+`" comparisons are not supported for type '`+ur(k.type)+"'.");var H=R.parse(P[2],2,ct);if(!H)return null;if(!ef(O,H.type))return R.concat(2).error('"'+O+`" comparisons are not supported for type '`+ur(H.type)+"'.");if(k.type.kind!==H.type.kind&&k.type.kind!=="value"&&H.type.kind!=="value")return R.error("Cannot compare types '"+ur(k.type)+"' and '"+ur(H.type)+"'.");x&&(k.type.kind==="value"&&H.type.kind!=="value"?k=new ai(H.type,[k]):k.type.kind!=="value"&&H.type.kind==="value"&&(H=new ai(k.type,[H])));var X=null;if(P.length===4){if(k.type.kind!=="string"&&H.type.kind!=="string"&&k.type.kind!=="value"&&H.type.kind!=="value")return R.error("Cannot use collator to compare non-string types.");if(!(X=R.parse(P[3],3,It)))return null}return new E(k,H,X)},E.prototype.evaluate=function(P){var R=this.lhs.evaluate(P),O=this.rhs.evaluate(P);if(x&&this.hasUntypedArgument){var k=di(R),H=di(O);if(k.kind!==H.kind||k.kind!=="string"&&k.kind!=="number")throw new Ii('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+k.kind+", "+H.kind+") instead.")}if(this.collator&&!x&&this.hasUntypedArgument){var X=di(R),q=di(O);if(X.kind!=="string"||q.kind!=="string")return h(P,R,O)}return this.collator?p(P,R,O,this.collator.evaluate(P)):h(P,R,O)},E.prototype.eachChild=function(P){P(this.lhs),P(this.rhs),this.collator&&P(this.collator)},E.prototype.outputDefined=function(){return!0},E.prototype.serialize=function(){var P=[a];return this.eachChild(function(R){P.push(R.serialize())}),P},E}()}ca.parse=function(a,h){if(a.length<=2||a.length>=5)return h.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=h.parse(a[1],1,ct),x=h.parse(a[2],2,qe);if(!p||!x)return null;if(!Fr(p.type,[Lr(ct),gt,ct]))return h.error("Expected first argument to be of type array or string, but found "+ur(p.type)+" instead");if(a.length===4){var E=h.parse(a[3],3,qe);return E?new ca(p.type,p,x,E):null}return new ca(p.type,p,x)},ca.prototype.evaluate=function(a){var h=this.input.evaluate(a),p=this.beginIndex.evaluate(a);if(!zr(h,["string","array"]))throw new Ii("Expected first argument to be of type array or string, but found "+ur(di(h))+" instead.");if(this.endIndex){var x=this.endIndex.evaluate(a);return h.slice(p,x)}return h.slice(p)},ca.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},ca.prototype.outputDefined=function(){return!1},ca.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var _A=Qr("==",function(a,h,p){return h===p},tf),Gc=Qr("!=",function(a,h,p){return h!==p},function(a,h,p,x){return!tf(0,h,p,x)}),rf=Qr("<",function(a,h,p){return h<p},function(a,h,p,x){return x.compare(h,p)<0}),nf=Qr(">",function(a,h,p){return h>p},function(a,h,p,x){return x.compare(h,p)>0}),Yl=Qr("<=",function(a,h,p){return h<=p},function(a,h,p,x){return x.compare(h,p)<=0}),sf=Qr(">=",function(a,h,p){return h>=p},function(a,h,p,x){return x.compare(h,p)>=0}),Ba=function(a,h,p,x,E){this.type=gt,this.number=a,this.locale=h,this.currency=p,this.minFractionDigits=x,this.maxFractionDigits=E};Ba.parse=function(a,h){if(a.length!==3)return h.error("Expected two arguments.");var p=h.parse(a[1],1,qe);if(!p)return null;var x=a[2];if(typeof x!="object"||Array.isArray(x))return h.error("NumberFormat options argument must be an object.");var E=null;if(x.locale&&!(E=h.parse(x.locale,1,gt)))return null;var P=null;if(x.currency&&!(P=h.parse(x.currency,1,gt)))return null;var R=null;if(x["min-fraction-digits"]&&!(R=h.parse(x["min-fraction-digits"],1,qe)))return null;var O=null;return x["max-fraction-digits"]&&!(O=h.parse(x["max-fraction-digits"],1,qe))?null:new Ba(p,E,P,R,O)},Ba.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Ba.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Ba.prototype.outputDefined=function(){return!1},Ba.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var ua=function(a){this.type=qe,this.input=a};ua.parse=function(a,h){if(a.length!==2)return h.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var p=h.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?h.error("Expected argument of type string or array, but found "+ur(p.type)+" instead."):new ua(p):null},ua.prototype.evaluate=function(a){var h=this.input.evaluate(a);if(typeof h=="string"||Array.isArray(h))return h.length;throw new Ii("Expected value to be of type string or array, but found "+ur(di(h))+" instead.")},ua.prototype.eachChild=function(a){a(this.input)},ua.prototype.outputDefined=function(){return!1},ua.prototype.serialize=function(){var a=["length"];return this.eachChild(function(h){a.push(h.serialize())}),a};var Js={"==":_A,"!=":Gc,">":nf,"<":rf,">=":sf,"<=":Yl,array:ai,at:oa,boolean:ai,case:la,coalesce:Zn,collator:Ce,format:ns,image:Rn,in:Uo,"index-of":aa,interpolate:Yi,"interpolate-hcl":Yi,"interpolate-lab":Yi,length:ua,let:No,literal:ue,match:Ra,number:ai,"number-format":Ba,object:ai,slice:ca,step:os,string:ai,"to-boolean":qn,"to-color":qn,"to-number":qn,"to-string":qn,var:Fo,within:ss};function of(a,h){var p=h[0],x=h[1],E=h[2],P=h[3];p=p.evaluate(a),x=x.evaluate(a),E=E.evaluate(a);var R=P?P.evaluate(a):1,O=ta(p,x,E,R);if(O)throw new Ii(O);return new pr(p/255*R,x/255*R,E/255*R,R)}function Wc(a,h){return a in h}function Xc(a,h){var p=h[a];return p===void 0?null:p}function Bs(a){return{type:a}}function af(a){return{result:"success",value:a}}function zo(a){return{result:"error",value:a}}function ha(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function lf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function fl(a){return!!a.expression&&a.expression.interpolated}function ei(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function dl(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function qc(a){return a}function ti(a,h,p){return a!==void 0?a:h!==void 0?h:p!==void 0?p:void 0}function cf(a,h,p,x,E){return ti(typeof p===E?x[p]:void 0,a.default,h.default)}function yA(a,h,p){if(ei(p)!=="number")return ti(a.default,h.default);var x=a.stops.length;if(x===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[x-1][0])return a.stops[x-1][1];var E=Vc(a.stops.map(function(P){return P[0]}),p);return a.stops[E][1]}function uf(a,h,p){var x=a.base!==void 0?a.base:1;if(ei(p)!=="number")return ti(a.default,h.default);var E=a.stops.length;if(E===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[E-1][0])return a.stops[E-1][1];var P=Vc(a.stops.map(function(q){return q[0]}),p),R=function(q,re,ae,ve){var xe=ve-ae,Be=q-ae;return xe===0?0:re===1?Be/xe:(Math.pow(re,Be)-1)/(Math.pow(re,xe)-1)}(p,x,a.stops[P][0],a.stops[P+1][0]),O=a.stops[P][1],k=a.stops[P+1][1],H=Ki[h.type]||qc;if(a.colorSpace&&a.colorSpace!=="rgb"){var X=Yu[a.colorSpace];H=function(q,re){return X.reverse(X.interpolate(X.forward(q),X.forward(re),R))}}return typeof O.evaluate=="function"?{evaluate:function(){for(var q=[],re=arguments.length;re--;)q[re]=arguments[re];var ae=O.evaluate.apply(void 0,q),ve=k.evaluate.apply(void 0,q);if(ae!==void 0&&ve!==void 0)return H(ae,ve,R)}}:H(O,k,R)}function $c(a,h,p){return h.type==="color"?p=pr.parse(p):h.type==="formatted"?p=zt.fromString(p.toString()):h.type==="resolvedImage"?p=hi.fromString(p.toString()):ei(p)===h.type||h.type==="enum"&&h.values[p]||(p=void 0),ti(p,a.default,h.default)}de.register(Js,{error:[{kind:"error"},[gt],function(a,h){throw new Ii(h[0].evaluate(a))}],typeof:[gt,[ct],function(a,h){return ur(di(h[0].evaluate(a)))}],"to-rgba":[Lr(qe,4),[at],function(a,h){return h[0].evaluate(a).toArray()}],rgb:[at,[qe,qe,qe],of],rgba:[at,[qe,qe,qe,qe],of],has:{type:nt,overloads:[[[gt],function(a,h){return Wc(h[0].evaluate(a),a.properties())}],[[gt,er],function(a,h){var p=h[1];return Wc(h[0].evaluate(a),p.evaluate(a))}]]},get:{type:ct,overloads:[[[gt],function(a,h){return Xc(h[0].evaluate(a),a.properties())}],[[gt,er],function(a,h){var p=h[1];return Xc(h[0].evaluate(a),p.evaluate(a))}]]},"feature-state":[ct,[gt],function(a,h){return Xc(h[0].evaluate(a),a.featureState||{})}],properties:[er,[],function(a){return a.properties()}],"geometry-type":[gt,[],function(a){return a.geometryType()}],id:[ct,[],function(a){return a.id()}],zoom:[qe,[],function(a){return a.globals.zoom}],"heatmap-density":[qe,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[qe,[],function(a){return a.globals.lineProgress||0}],accumulated:[ct,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[qe,Bs(qe),function(a,h){for(var p=0,x=0,E=h;x<E.length;x+=1)p+=E[x].evaluate(a);return p}],"*":[qe,Bs(qe),function(a,h){for(var p=1,x=0,E=h;x<E.length;x+=1)p*=E[x].evaluate(a);return p}],"-":{type:qe,overloads:[[[qe,qe],function(a,h){var p=h[1];return h[0].evaluate(a)-p.evaluate(a)}],[[qe],function(a,h){return-h[0].evaluate(a)}]]},"/":[qe,[qe,qe],function(a,h){var p=h[1];return h[0].evaluate(a)/p.evaluate(a)}],"%":[qe,[qe,qe],function(a,h){var p=h[1];return h[0].evaluate(a)%p.evaluate(a)}],ln2:[qe,[],function(){return Math.LN2}],pi:[qe,[],function(){return Math.PI}],e:[qe,[],function(){return Math.E}],"^":[qe,[qe,qe],function(a,h){var p=h[1];return Math.pow(h[0].evaluate(a),p.evaluate(a))}],sqrt:[qe,[qe],function(a,h){return Math.sqrt(h[0].evaluate(a))}],log10:[qe,[qe],function(a,h){return Math.log(h[0].evaluate(a))/Math.LN10}],ln:[qe,[qe],function(a,h){return Math.log(h[0].evaluate(a))}],log2:[qe,[qe],function(a,h){return Math.log(h[0].evaluate(a))/Math.LN2}],sin:[qe,[qe],function(a,h){return Math.sin(h[0].evaluate(a))}],cos:[qe,[qe],function(a,h){return Math.cos(h[0].evaluate(a))}],tan:[qe,[qe],function(a,h){return Math.tan(h[0].evaluate(a))}],asin:[qe,[qe],function(a,h){return Math.asin(h[0].evaluate(a))}],acos:[qe,[qe],function(a,h){return Math.acos(h[0].evaluate(a))}],atan:[qe,[qe],function(a,h){return Math.atan(h[0].evaluate(a))}],min:[qe,Bs(qe),function(a,h){return Math.min.apply(Math,h.map(function(p){return p.evaluate(a)}))}],max:[qe,Bs(qe),function(a,h){return Math.max.apply(Math,h.map(function(p){return p.evaluate(a)}))}],abs:[qe,[qe],function(a,h){return Math.abs(h[0].evaluate(a))}],round:[qe,[qe],function(a,h){var p=h[0].evaluate(a);return p<0?-Math.round(-p):Math.round(p)}],floor:[qe,[qe],function(a,h){return Math.floor(h[0].evaluate(a))}],ceil:[qe,[qe],function(a,h){return Math.ceil(h[0].evaluate(a))}],"filter-==":[nt,[gt,ct],function(a,h){var p=h[0],x=h[1];return a.properties()[p.value]===x.value}],"filter-id-==":[nt,[ct],function(a,h){var p=h[0];return a.id()===p.value}],"filter-type-==":[nt,[gt],function(a,h){var p=h[0];return a.geometryType()===p.value}],"filter-<":[nt,[gt,ct],function(a,h){var p=h[0],x=h[1],E=a.properties()[p.value],P=x.value;return typeof E==typeof P&&E<P}],"filter-id-<":[nt,[ct],function(a,h){var p=h[0],x=a.id(),E=p.value;return typeof x==typeof E&&x<E}],"filter->":[nt,[gt,ct],function(a,h){var p=h[0],x=h[1],E=a.properties()[p.value],P=x.value;return typeof E==typeof P&&E>P}],"filter-id->":[nt,[ct],function(a,h){var p=h[0],x=a.id(),E=p.value;return typeof x==typeof E&&x>E}],"filter-<=":[nt,[gt,ct],function(a,h){var p=h[0],x=h[1],E=a.properties()[p.value],P=x.value;return typeof E==typeof P&&E<=P}],"filter-id-<=":[nt,[ct],function(a,h){var p=h[0],x=a.id(),E=p.value;return typeof x==typeof E&&x<=E}],"filter->=":[nt,[gt,ct],function(a,h){var p=h[0],x=h[1],E=a.properties()[p.value],P=x.value;return typeof E==typeof P&&E>=P}],"filter-id->=":[nt,[ct],function(a,h){var p=h[0],x=a.id(),E=p.value;return typeof x==typeof E&&x>=E}],"filter-has":[nt,[ct],function(a,h){return h[0].value in a.properties()}],"filter-has-id":[nt,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[nt,[Lr(gt)],function(a,h){return h[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[nt,[Lr(ct)],function(a,h){return h[0].value.indexOf(a.id())>=0}],"filter-in-small":[nt,[gt,Lr(ct)],function(a,h){var p=h[0];return h[1].value.indexOf(a.properties()[p.value])>=0}],"filter-in-large":[nt,[gt,Lr(ct)],function(a,h){var p=h[0],x=h[1];return function(E,P,R,O){for(;R<=O;){var k=R+O>>1;if(P[k]===E)return!0;P[k]>E?O=k-1:R=k+1}return!1}(a.properties()[p.value],x.value,0,x.value.length-1)}],all:{type:nt,overloads:[[[nt,nt],function(a,h){var p=h[1];return h[0].evaluate(a)&&p.evaluate(a)}],[Bs(nt),function(a,h){for(var p=0,x=h;p<x.length;p+=1)if(!x[p].evaluate(a))return!1;return!0}]]},any:{type:nt,overloads:[[[nt,nt],function(a,h){var p=h[1];return h[0].evaluate(a)||p.evaluate(a)}],[Bs(nt),function(a,h){for(var p=0,x=h;p<x.length;p+=1)if(x[p].evaluate(a))return!0;return!1}]]},"!":[nt,[nt],function(a,h){return!h[0].evaluate(a)}],"is-supported-script":[nt,[gt],function(a,h){var p=a.globals&&a.globals.isSupportedScript;return!p||p(h[0].evaluate(a))}],upcase:[gt,[gt],function(a,h){return h[0].evaluate(a).toUpperCase()}],downcase:[gt,[gt],function(a,h){return h[0].evaluate(a).toLowerCase()}],concat:[gt,Bs(ct),function(a,h){return h.map(function(p){return Do(p.evaluate(a))}).join("")}],"resolved-locale":[gt,[It],function(a,h){return h[0].evaluate(a).resolvedLocale()}]});var Al=function(a,h){this.expression=a,this._warningHistory={},this._evaluator=new le,this._defaultValue=h?function(p){return p.type==="color"&&dl(p.default)?new pr(0,0,0,0):p.type==="color"?pr.parse(p.default)||null:p.default===void 0?null:p.default}(h):null,this._enumValues=h&&h.type==="enum"?h.values:null};function Jl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Js}function Zc(a,h){var p=new Lo(Js,[],h?function(E){var P={color:at,string:gt,number:qe,enum:gt,boolean:nt,formatted:Ir,resolvedImage:yr};return E.type==="array"?Lr(P[E.value]||ct,E.length):P[E.type]}(h):void 0),x=p.parse(a,void 0,void 0,void 0,h&&h.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?af(new Al(x,h)):zo(p.errors)}Al.prototype.evaluateWithoutErrorHandling=function(a,h,p,x,E,P){return this._evaluator.globals=a,this._evaluator.feature=h,this._evaluator.featureState=p,this._evaluator.canonical=x,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=P,this.expression.evaluate(this._evaluator)},Al.prototype.evaluate=function(a,h,p,x,E,P){this._evaluator.globals=a,this._evaluator.feature=h||null,this._evaluator.featureState=p||null,this._evaluator.canonical=x,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=P||null;try{var R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Ii("Expected value to be one of "+Object.keys(this._enumValues).map(function(O){return JSON.stringify(O)}).join(", ")+", but found "+JSON.stringify(R)+" instead.");return R}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(O.message)),this._defaultValue}};var yn=function(a,h){this.kind=a,this._styleExpression=h,this.isStateDependent=a!=="constant"&&!ia(h.expression)};yn.prototype.evaluateWithoutErrorHandling=function(a,h,p,x,E,P){return this._styleExpression.evaluateWithoutErrorHandling(a,h,p,x,E,P)},yn.prototype.evaluate=function(a,h,p,x,E,P){return this._styleExpression.evaluate(a,h,p,x,E,P)};var fa=function(a,h,p,x){this.kind=a,this.zoomStops=p,this._styleExpression=h,this.isStateDependent=a!=="camera"&&!ia(h.expression),this.interpolationType=x};function da(a,h){if((a=Zc(a,h)).result==="error")return a;var p=a.value.expression,x=ra(p);if(!x&&!ha(h))return zo([new _("","data expressions not supported")]);var E=na(p,["zoom"]);if(!E&&!lf(h))return zo([new _("","zoom expressions not supported")]);var P=function R(O){var k=null;if(O instanceof No)k=R(O.result);else if(O instanceof Zn)for(var H=0,X=O.args;H<X.length&&!(k=R(X[H]));H+=1);else(O instanceof os||O instanceof Yi)&&O.input instanceof de&&O.input.name==="zoom"&&(k=O);return k instanceof _||O.eachChild(function(q){var re=R(q);re instanceof _?k=re:!k&&re?k=new _("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&re&&k!==re&&(k=new _("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(p);return P||E?P instanceof _?zo([P]):P instanceof Yi&&!fl(h)?zo([new _("",'"interpolate" expressions cannot be used with this property')]):af(P?new fa(x?"camera":"composite",a.value,P.labels,P instanceof Yi?P.interpolation:void 0):new yn(x?"constant":"source",a.value)):zo([new _("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}fa.prototype.evaluateWithoutErrorHandling=function(a,h,p,x,E,P){return this._styleExpression.evaluateWithoutErrorHandling(a,h,p,x,E,P)},fa.prototype.evaluate=function(a,h,p,x,E,P){return this._styleExpression.evaluate(a,h,p,x,E,P)},fa.prototype.interpolationFactor=function(a,h,p){return this.interpolationType?Yi.interpolationFactor(this.interpolationType,a,h,p):0};var pl=function(a,h){this._parameters=a,this._specification=h,Re(this,function p(x,E){var P,R,O,k=E.type==="color",H=x.stops&&typeof x.stops[0][0]=="object",X=H||!(H||x.property!==void 0),q=x.type||(fl(E)?"exponential":"interval");if(k&&((x=Re({},x)).stops&&(x.stops=x.stops.map(function(Mt){return[Mt[0],pr.parse(Mt[1])]})),x.default=pr.parse(x.default?x.default:E.default)),x.colorSpace&&x.colorSpace!=="rgb"&&!Yu[x.colorSpace])throw new Error("Unknown color space: "+x.colorSpace);if(q==="exponential")P=uf;else if(q==="interval")P=yA;else if(q==="categorical"){P=cf,R=Object.create(null);for(var re=0,ae=x.stops;re<ae.length;re+=1){var ve=ae[re];R[ve[0]]=ve[1]}O=typeof x.stops[0][0]}else{if(q!=="identity")throw new Error('Unknown function type "'+q+'"');P=$c}if(H){for(var xe={},Be=[],Se=0;Se<x.stops.length;Se++){var Ne=x.stops[Se],We=Ne[0].zoom;xe[We]===void 0&&(xe[We]={zoom:We,type:x.type,property:x.property,default:x.default,stops:[]},Be.push(We)),xe[We].stops.push([Ne[0].value,Ne[1]])}for(var Ye=[],et=0,ot=Be;et<ot.length;et+=1){var pt=ot[et];Ye.push([xe[pt].zoom,p(xe[pt],E)])}var wt={name:"linear"};return{kind:"composite",interpolationType:wt,interpolationFactor:Yi.interpolationFactor.bind(void 0,wt),zoomStops:Ye.map(function(Mt){return Mt[0]}),evaluate:function(Mt,Xt){var Bt=Mt.zoom;return uf({stops:Ye,base:x.base},E,Bt).evaluate(Bt,Xt)}}}if(X){var Ht=q==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:Ht,interpolationFactor:Yi.interpolationFactor.bind(void 0,Ht),zoomStops:x.stops.map(function(Mt){return Mt[0]}),evaluate:function(Mt){return P(x,E,Mt.zoom,R,O)}}}return{kind:"source",evaluate:function(Mt,Xt){var Bt=Xt&&Xt.properties?Xt.properties[x.property]:void 0;return Bt===void 0?ti(x.default,E.default):P(x,E,Bt,R,O)}}}(this._parameters,this._specification))};function ys(a){var h=a.key,p=a.value,x=a.valueSpec||{},E=a.objectElementValidators||{},P=a.style,R=a.styleSpec,O=[],k=ei(p);if(k!=="object")return[new we(h,p,"object expected, "+k+" found")];for(var H in p){var X=H.split(".")[0],q=x[X]||x["*"],re=void 0;if(E[X])re=E[X];else if(x[X])re=kr;else if(E["*"])re=E["*"];else{if(!x["*"]){O.push(new we(h,p[H],'unknown property "'+H+'"'));continue}re=kr}O=O.concat(re({key:(h&&h+".")+H,value:p[H],valueSpec:q,style:P,styleSpec:R,object:p,objectKey:H},p))}for(var ae in x)E[ae]||x[ae].required&&x[ae].default===void 0&&p[ae]===void 0&&O.push(new we(h,p,'missing required property "'+ae+'"'));return O}function hf(a){var h=a.value,p=a.valueSpec,x=a.style,E=a.styleSpec,P=a.key,R=a.arrayElementValidator||kr;if(ei(h)!=="array")return[new we(P,h,"array expected, "+ei(h)+" found")];if(p.length&&h.length!==p.length)return[new we(P,h,"array length "+p.length+" expected, length "+h.length+" found")];if(p["min-length"]&&h.length<p["min-length"])return[new we(P,h,"array length at least "+p["min-length"]+" expected, length "+h.length+" found")];var O={type:p.value,values:p.values};E.$version<7&&(O.function=p.function),ei(p.value)==="object"&&(O=p.value);for(var k=[],H=0;H<h.length;H++)k=k.concat(R({array:h,arrayIndex:H,value:h[H],valueSpec:O,style:x,styleSpec:E,key:P+"["+H+"]"}));return k}function vs(a){var h=a.key,p=a.value,x=a.valueSpec,E=ei(p);return E==="number"&&p!=p&&(E="NaN"),E!=="number"?[new we(h,p,"number expected, "+E+" found")]:"minimum"in x&&p<x.minimum?[new we(h,p,p+" is less than the minimum value "+x.minimum)]:"maximum"in x&&p>x.maximum?[new we(h,p,p+" is greater than the maximum value "+x.maximum)]:[]}function Ju(a){var h,p,x,E=a.valueSpec,P=ze(a.value.type),R={},O=P!=="categorical"&&a.value.property===void 0,k=!O,H=ei(a.value.stops)==="array"&&ei(a.value.stops[0])==="array"&&ei(a.value.stops[0][0])==="object",X=ys({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(ae){if(P==="identity")return[new we(ae.key,ae.value,'identity function may not have a "stops" property')];var ve=[],xe=ae.value;return ve=ve.concat(hf({key:ae.key,value:xe,valueSpec:ae.valueSpec,style:ae.style,styleSpec:ae.styleSpec,arrayElementValidator:q})),ei(xe)==="array"&&xe.length===0&&ve.push(new we(ae.key,xe,"array must have at least one stop")),ve},default:function(ae){return kr({key:ae.key,value:ae.value,valueSpec:E,style:ae.style,styleSpec:ae.styleSpec})}}});return P==="identity"&&O&&X.push(new we(a.key,a.value,'missing required property "property"')),P==="identity"||a.value.stops||X.push(new we(a.key,a.value,'missing required property "stops"')),P==="exponential"&&a.valueSpec.expression&&!fl(a.valueSpec)&&X.push(new we(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(k&&!ha(a.valueSpec)?X.push(new we(a.key,a.value,"property functions not supported")):O&&!lf(a.valueSpec)&&X.push(new we(a.key,a.value,"zoom functions not supported"))),P!=="categorical"&&!H||a.value.property!==void 0||X.push(new we(a.key,a.value,'"property" property is required')),X;function q(ae){var ve=[],xe=ae.value,Be=ae.key;if(ei(xe)!=="array")return[new we(Be,xe,"array expected, "+ei(xe)+" found")];if(xe.length!==2)return[new we(Be,xe,"array length 2 expected, length "+xe.length+" found")];if(H){if(ei(xe[0])!=="object")return[new we(Be,xe,"object expected, "+ei(xe[0])+" found")];if(xe[0].zoom===void 0)return[new we(Be,xe,"object stop key must have zoom")];if(xe[0].value===void 0)return[new we(Be,xe,"object stop key must have value")];if(x&&x>ze(xe[0].zoom))return[new we(Be,xe[0].zoom,"stop zoom values must appear in ascending order")];ze(xe[0].zoom)!==x&&(x=ze(xe[0].zoom),p=void 0,R={}),ve=ve.concat(ys({key:Be+"[0]",value:xe[0],valueSpec:{zoom:{}},style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{zoom:vs,value:re}}))}else ve=ve.concat(re({key:Be+"[0]",value:xe[0],valueSpec:{},style:ae.style,styleSpec:ae.styleSpec},xe));return Jl(ke(xe[1]))?ve.concat([new we(Be+"[1]",xe[1],"expressions are not allowed in function stops.")]):ve.concat(kr({key:Be+"[1]",value:xe[1],valueSpec:E,style:ae.style,styleSpec:ae.styleSpec}))}function re(ae,ve){var xe=ei(ae.value),Be=ze(ae.value),Se=ae.value!==null?ae.value:ve;if(h){if(xe!==h)return[new we(ae.key,Se,xe+" stop domain type must match previous stop domain type "+h)]}else h=xe;if(xe!=="number"&&xe!=="string"&&xe!=="boolean")return[new we(ae.key,Se,"stop domain value must be a number, string, or boolean")];if(xe!=="number"&&P!=="categorical"){var Ne="number expected, "+xe+" found";return ha(E)&&P===void 0&&(Ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new we(ae.key,Se,Ne)]}return P!=="categorical"||xe!=="number"||isFinite(Be)&&Math.floor(Be)===Be?P!=="categorical"&&xe==="number"&&p!==void 0&&Be<p?[new we(ae.key,Se,"stop domain values must appear in ascending order")]:(p=Be,P==="categorical"&&Be in R?[new we(ae.key,Se,"stop domain values must be unique")]:(R[Be]=!0,[])):[new we(ae.key,Se,"integer expected, found "+Be)]}}function Vo(a){var h=(a.expressionContext==="property"?da:Zc)(ke(a.value),a.valueSpec);if(h.result==="error")return h.value.map(function(x){return new we(""+a.key+x.key,a.value,x.message)});var p=h.value.expression||h.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!p.outputDefined())return[new we(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!ia(p))return[new we(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!ia(p))return[new we(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!na(p,["zoom","feature-state"]))return[new we(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!ra(p))return[new we(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fo(a){var h=a.key,p=a.value,x=a.valueSpec,E=[];return Array.isArray(x.values)?x.values.indexOf(ze(p))===-1&&E.push(new we(h,p,"expected one of ["+x.values.join(", ")+"], "+JSON.stringify(p)+" found")):Object.keys(x.values).indexOf(ze(p))===-1&&E.push(new we(h,p,"expected one of ["+Object.keys(x.values).join(", ")+"], "+JSON.stringify(p)+" found")),E}function Aa(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var h=0,p=a.slice(1);h<p.length;h+=1){var x=p[h];if(!Aa(x)&&typeof x!="boolean")return!1}return!0;default:return!0}}pl.deserialize=function(a){return new pl(a._parameters,a._specification)},pl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var Oa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Kc(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};Aa(a)||(a=Yc(a));var h=Zc(a,Oa);if(h.result==="error")throw new Error(h.value.map(function(p){return p.key+": "+p.message}).join(", "));return{filter:function(p,x,E){return h.value.evaluate(p,x,{},E)},needGeometry:function p(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(var E=1;E<x.length;E++)if(p(x[E]))return!0;return!1}(a)}}function ff(a,h){return a<h?-1:a>h?1:0}function Yc(a){if(!a)return!0;var h,p=a[0];return a.length<=1?p!=="any":p==="=="?Ql(a[1],a[2],"=="):p==="!="?ec(Ql(a[1],a[2],"==")):p==="<"||p===">"||p==="<="||p===">="?Ql(a[1],a[2],p):p==="any"?(h=a.slice(1),["any"].concat(h.map(Yc))):p==="all"?["all"].concat(a.slice(1).map(Yc)):p==="none"?["all"].concat(a.slice(1).map(Yc).map(ec)):p==="in"?df(a[1],a.slice(2)):p==="!in"?ec(df(a[1],a.slice(2))):p==="has"?Af(a[1]):p==="!has"?ec(Af(a[1])):p!=="within"||a}function Ql(a,h,p){switch(a){case"$type":return["filter-type-"+p,h];case"$id":return["filter-id-"+p,h];default:return["filter-"+p,a,h]}}function df(a,h){if(h.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",h]];case"$id":return["filter-id-in",["literal",h]];default:return h.length>200&&!h.some(function(p){return typeof p!=typeof h[0]})?["filter-in-large",a,["literal",h.sort(ff)]]:["filter-in-small",a,["literal",h]]}}function Af(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ec(a){return["!",a]}function Jc(a){return Aa(ke(a.value))?Vo(Re({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function h(p){var x=p.value,E=p.key;if(ei(x)!=="array")return[new we(E,x,"array expected, "+ei(x)+" found")];var P,R=p.styleSpec,O=[];if(x.length<1)return[new we(E,x,"filter array must have at least 1 element")];switch(O=O.concat(fo({key:E+"[0]",value:x[0],valueSpec:R.filter_operator,style:p.style,styleSpec:p.styleSpec})),ze(x[0])){case"<":case"<=":case">":case">=":x.length>=2&&ze(x[1])==="$type"&&O.push(new we(E,x,'"$type" cannot be use with operator "'+x[0]+'"'));case"==":case"!=":x.length!==3&&O.push(new we(E,x,'filter array for operator "'+x[0]+'" must have 3 elements'));case"in":case"!in":x.length>=2&&(P=ei(x[1]))!=="string"&&O.push(new we(E+"[1]",x[1],"string expected, "+P+" found"));for(var k=2;k<x.length;k++)P=ei(x[k]),ze(x[1])==="$type"?O=O.concat(fo({key:E+"["+k+"]",value:x[k],valueSpec:R.geometry_type,style:p.style,styleSpec:p.styleSpec})):P!=="string"&&P!=="number"&&P!=="boolean"&&O.push(new we(E+"["+k+"]",x[k],"string, number, or boolean expected, "+P+" found"));break;case"any":case"all":case"none":for(var H=1;H<x.length;H++)O=O.concat(h({key:E+"["+H+"]",value:x[H],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":P=ei(x[1]),x.length!==2?O.push(new we(E,x,'filter array for "'+x[0]+'" operator must have 2 elements')):P!=="string"&&O.push(new we(E+"[1]",x[1],"string expected, "+P+" found"));break;case"within":P=ei(x[1]),x.length!==2?O.push(new we(E,x,'filter array for "'+x[0]+'" operator must have 2 elements')):P!=="object"&&O.push(new we(E+"[1]",x[1],"object expected, "+P+" found"))}return O}(a)}function Da(a,h){var p=a.key,x=a.style,E=a.styleSpec,P=a.value,R=a.objectKey,O=E[h+"_"+a.layerType];if(!O)return[];var k=R.match(/^(.*)-transition$/);if(h==="paint"&&k&&O[k[1]]&&O[k[1]].transition)return kr({key:p,value:P,valueSpec:E.transition,style:x,styleSpec:E});var H,X=a.valueSpec||O[R];if(!X)return[new we(p,P,'unknown property "'+R+'"')];if(ei(P)==="string"&&ha(X)&&!X.tokens&&(H=/^{([^}]+)}$/.exec(P)))return[new we(p,P,'"'+R+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(H[1])+" }`.")];var q=[];return a.layerType==="symbol"&&(R==="text-field"&&x&&!x.glyphs&&q.push(new we(p,P,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&dl(ke(P))&&ze(P.type)==="identity"&&q.push(new we(p,P,'"text-font" does not support identity functions'))),q.concat(kr({key:a.key,value:P,valueSpec:X,style:x,styleSpec:E,expressionContext:"property",propertyType:h,propertyKey:R}))}function pa(a){return Da(a,"paint")}function tc(a){return Da(a,"layout")}function gl(a){var h=[],p=a.value,x=a.key,E=a.style,P=a.styleSpec;p.type||p.ref||h.push(new we(x,p,'either "type" or "ref" is required'));var R,O=ze(p.type),k=ze(p.ref);if(p.id)for(var H=ze(p.id),X=0;X<a.arrayIndex;X++){var q=E.layers[X];ze(q.id)===H&&h.push(new we(x,p.id,'duplicate layer id "'+p.id+'", previously used at line '+q.id.__line__))}if("ref"in p)["type","source","source-layer","filter","layout"].forEach(function(ve){ve in p&&h.push(new we(x,p[ve],'"'+ve+'" is prohibited for ref layers'))}),E.layers.forEach(function(ve){ze(ve.id)===k&&(R=ve)}),R?R.ref?h.push(new we(x,p.ref,"ref cannot reference another ref layer")):O=ze(R.type):h.push(new we(x,p.ref,'ref layer "'+k+'" not found'));else if(O!=="background")if(p.source){var re=E.sources&&E.sources[p.source],ae=re&&ze(re.type);re?ae==="vector"&&O==="raster"?h.push(new we(x,p.source,'layer "'+p.id+'" requires a raster source')):ae==="raster"&&O!=="raster"?h.push(new we(x,p.source,'layer "'+p.id+'" requires a vector source')):ae!=="vector"||p["source-layer"]?ae==="raster-dem"&&O!=="hillshade"?h.push(new we(x,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="line"||!p.paint||!p.paint["line-gradient"]||ae==="geojson"&&re.lineMetrics||h.push(new we(x,p,'layer "'+p.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):h.push(new we(x,p,'layer "'+p.id+'" must specify a "source-layer"')):h.push(new we(x,p.source,'source "'+p.source+'" not found'))}else h.push(new we(x,p,'missing required property "source"'));return h=h.concat(ys({key:x,value:p,valueSpec:P.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return kr({key:x+".type",value:p.type,valueSpec:P.layer.type,style:a.style,styleSpec:a.styleSpec,object:p,objectKey:"type"})},filter:Jc,layout:function(ve){return ys({layer:p,key:ve.key,value:ve.value,style:ve.style,styleSpec:ve.styleSpec,objectElementValidators:{"*":function(xe){return tc(Re({layerType:O},xe))}}})},paint:function(ve){return ys({layer:p,key:ve.key,value:ve.value,style:ve.style,styleSpec:ve.styleSpec,objectElementValidators:{"*":function(xe){return pa(Re({layerType:O},xe))}}})}}}))}function Fa(a){var h=a.value,p=a.key,x=ei(h);return x!=="string"?[new we(p,h,"string expected, "+x+" found")]:[]}var Ai={promoteId:function(a){var h=a.key,p=a.value;if(ei(p)==="string")return Fa({key:h,value:p});var x=[];for(var E in p)x.push.apply(x,Fa({key:h+"."+E,value:p[E]}));return x}};function Qc(a){var h=a.value,p=a.key,x=a.styleSpec,E=a.style;if(!h.type)return[new we(p,h,'"type" is required')];var P,R=ze(h.type);switch(R){case"vector":case"raster":case"raster-dem":return ys({key:p,value:h,valueSpec:x["source_"+R.replace("-","_")],style:a.style,styleSpec:x,objectElementValidators:Ai});case"geojson":if(P=ys({key:p,value:h,valueSpec:x.source_geojson,style:E,styleSpec:x,objectElementValidators:Ai}),h.cluster)for(var O in h.clusterProperties){var k=h.clusterProperties[O],H=k[0],X=typeof H=="string"?[H,["accumulated"],["get",O]]:H;P.push.apply(P,Vo({key:p+"."+O+".map",value:k[1],expressionContext:"cluster-map"})),P.push.apply(P,Vo({key:p+"."+O+".reduce",value:X,expressionContext:"cluster-reduce"}))}return P;case"video":return ys({key:p,value:h,valueSpec:x.source_video,style:E,styleSpec:x});case"image":return ys({key:p,value:h,valueSpec:x.source_image,style:E,styleSpec:x});case"canvas":return[new we(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fo({key:p+".type",value:h.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:E,styleSpec:x})}}function La(a){var h=a.value,p=a.styleSpec,x=p.light,E=a.style,P=[],R=ei(h);if(h===void 0)return P;if(R!=="object")return P.concat([new we("light",h,"object expected, "+R+" found")]);for(var O in h){var k=O.match(/^(.*)-transition$/);P=P.concat(k&&x[k[1]]&&x[k[1]].transition?kr({key:O,value:h[O],valueSpec:p.transition,style:E,styleSpec:p}):x[O]?kr({key:O,value:h[O],valueSpec:x[O],style:E,styleSpec:p}):[new we(O,h[O],'unknown property "'+O+'"')])}return P}var ga={"*":function(){return[]},array:hf,boolean:function(a){var h=a.value,p=a.key,x=ei(h);return x!=="boolean"?[new we(p,h,"boolean expected, "+x+" found")]:[]},number:vs,color:function(a){var h=a.key,p=a.value,x=ei(p);return x!=="string"?[new we(h,p,"color expected, "+x+" found")]:Ar(p)===null?[new we(h,p,'color expected, "'+p+'" found')]:[]},constants:he,enum:fo,filter:Jc,function:Ju,layer:gl,object:ys,source:Qc,light:La,string:Fa,formatted:function(a){return Fa(a).length===0?[]:Vo(a)},resolvedImage:function(a){return Fa(a).length===0?[]:Vo(a)}};function kr(a){var h=a.value,p=a.valueSpec,x=a.styleSpec;return p.expression&&dl(ze(h))?Ju(a):p.expression&&Jl(ke(h))?Vo(a):p.type&&ga[p.type]?ga[p.type](a):ys(Re({},a,{valueSpec:p.type?x[p.type]:p}))}function li(a){var h=a.value,p=a.key,x=Fa(a);return x.length||(h.indexOf("{fontstack}")===-1&&x.push(new we(p,h,'"glyphs" url must include a "{fontstack}" token')),h.indexOf("{range}")===-1&&x.push(new we(p,h,'"glyphs" url must include a "{range}" token'))),x}function Kn(a,h){h===void 0&&(h=ce);var p=[];return p=p.concat(kr({key:"",value:a,valueSpec:h.$root,styleSpec:h,style:a,objectElementValidators:{glyphs:li,"*":function(){return[]}}})),a.constants&&(p=p.concat(he({key:"constants",value:a.constants,style:a,styleSpec:h}))),ml(p)}function ml(a){return[].concat(a).sort(function(h,p){return h.line-p.line})}function ma(a){return function(){for(var h=[],p=arguments.length;p--;)h[p]=arguments[p];return ml(a.apply(this,h))}}Kn.source=ma(Qc),Kn.light=ma(La),Kn.layer=ma(gl),Kn.filter=ma(Jc),Kn.paintProperty=ma(pa),Kn.layoutProperty=ma(tc);var rc=Kn,vA=rc.light,bA=rc.paintProperty,ic=rc.layoutProperty;function nc(a,h){var p=!1;if(h&&h.length)for(var x=0,E=h;x<E.length;x+=1)a.fire(new Oe(new Error(E[x].message))),p=!0;return p}var jo=Ji;function Ji(a,h,p){var x=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var E=new Int32Array(this.arrayBuffer);a=E[0],this.d=(h=E[1])+2*(p=E[2]);for(var P=0;P<this.d*this.d;P++){var R=E[3+P],O=E[3+P+1];x.push(R===O?null:E.subarray(R,O))}var k=E[3+x.length+1];this.keys=E.subarray(E[3+x.length],k),this.bboxes=E.subarray(k),this.insert=this._insertReadonly}else{this.d=h+2*p;for(var H=0;H<this.d*this.d;H++)x.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=p,this.scale=h/a,this.uid=0;var X=p/h*a;this.min=-X,this.max=a+X}Ji.prototype.insert=function(a,h,p,x,E){this._forEachCell(h,p,x,E,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(E)},Ji.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ji.prototype._insertCell=function(a,h,p,x,E,P){this.cells[E].push(P)},Ji.prototype.query=function(a,h,p,x,E){var P=this.min,R=this.max;if(a<=P&&h<=P&&R<=p&&R<=x&&!E)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(a,h,p,x,this._queryCell,O,{},E),O},Ji.prototype._queryCell=function(a,h,p,x,E,P,R,O){var k=this.cells[E];if(k!==null)for(var H=this.keys,X=this.bboxes,q=0;q<k.length;q++){var re=k[q];if(R[re]===void 0){var ae=4*re;(O?O(X[ae+0],X[ae+1],X[ae+2],X[ae+3]):a<=X[ae+2]&&h<=X[ae+3]&&p>=X[ae+0]&&x>=X[ae+1])?(R[re]=!0,P.push(H[re])):R[re]=!1}}},Ji.prototype._forEachCell=function(a,h,p,x,E,P,R,O){for(var k=this._convertToCellCoord(a),H=this._convertToCellCoord(h),X=this._convertToCellCoord(p),q=this._convertToCellCoord(x),re=k;re<=X;re++)for(var ae=H;ae<=q;ae++){var ve=this.d*ae+re;if((!O||O(this._convertFromCellCoord(re),this._convertFromCellCoord(ae),this._convertFromCellCoord(re+1),this._convertFromCellCoord(ae+1)))&&E.call(this,a,h,p,x,ve,P,R,O))return}},Ji.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ji.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ji.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,h=3+this.cells.length+1+1,p=0,x=0;x<this.cells.length;x++)p+=this.cells[x].length;var E=new Int32Array(h+p+this.keys.length+this.bboxes.length);E[0]=this.extent,E[1]=this.n,E[2]=this.padding;for(var P=h,R=0;R<a.length;R++){var O=a[R];E[3+R]=P,E.set(O,P),P+=O.length}return E[3+a.length]=P,E.set(this.keys,P),E[3+a.length+1]=P+=this.keys.length,E.set(this.bboxes,P),P+=this.bboxes.length,E.buffer};var _l=I.ImageData,pf=I.ImageBitmap,Fi={};function Ct(a,h,p){p===void 0&&(p={}),Object.defineProperty(h,"_classRegistryKey",{value:a,writeable:!1}),Fi[a]={klass:h,omit:p.omit||[],shallow:p.shallow||[]}}for(var Yn in Ct("Object",Object),jo.serialize=function(a,h){var p=a.toArrayBuffer();return h&&h.push(p),{buffer:p}},jo.deserialize=function(a){return new jo(a.buffer)},Ct("Grid",jo),Ct("Color",pr),Ct("Error",Error),Ct("ResolvedImage",hi),Ct("StylePropertyFunction",pl),Ct("StyleExpression",Al,{omit:["_evaluator"]}),Ct("ZoomDependentExpression",fa),Ct("ZoomConstantExpression",yn),Ct("CompoundExpression",de,{omit:["_evaluate"]}),Js)Js[Yn]._classRegistryKey||Ct("Expression_"+Yn,Js[Yn]);function eu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function yl(a){return pf&&a instanceof pf}function Qs(a,h){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(eu(a)||yl(a))return h&&h.push(a),a;if(ArrayBuffer.isView(a)){var p=a;return h&&h.push(p.buffer),p}if(a instanceof _l)return h&&h.push(a.data.buffer),a;if(Array.isArray(a)){for(var x=[],E=0,P=a;E<P.length;E+=1)x.push(Qs(P[E],h));return x}if(typeof a=="object"){var R=a.constructor,O=R._classRegistryKey;if(!O)throw new Error("can't serialize object of unregistered class");var k=R.serialize?R.serialize(a,h):{};if(!R.serialize){for(var H in a)if(a.hasOwnProperty(H)&&!(Fi[O].omit.indexOf(H)>=0)){var X=a[H];k[H]=Fi[O].shallow.indexOf(H)>=0?X:Qs(X,h)}a instanceof Error&&(k.message=a.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return O!=="Object"&&(k.$name=O),k}throw new Error("can't serialize object of type "+typeof a)}function as(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||eu(a)||yl(a)||ArrayBuffer.isView(a)||a instanceof _l)return a;if(Array.isArray(a))return a.map(as);if(typeof a=="object"){var h=a.$name||"Object",p=Fi[h].klass;if(!p)throw new Error("can't deserialize unregistered class "+h);if(p.deserialize)return p.deserialize(a);for(var x=Object.create(p.prototype),E=0,P=Object.keys(a);E<P.length;E+=1){var R=P[E];if(R!=="$name"){var O=a[R];x[R]=Fi[h].shallow.indexOf(R)>=0?O:as(O)}}return x}throw new Error("can't deserialize object of type "+typeof a)}var Qu=function(){this.first=!0};Qu.prototype.update=function(a,h){var p=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=h),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=p,!0))};var bt={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function tu(a){for(var h=0,p=a;h<p.length;h+=1)if(sc(p[h].charCodeAt(0)))return!0;return!1}function sc(a){return!(a!==746&&a!==747&&(a<4352||!(bt["Bopomofo Extended"](a)||bt.Bopomofo(a)||bt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||bt["CJK Compatibility Ideographs"](a)||bt["CJK Compatibility"](a)||bt["CJK Radicals Supplement"](a)||bt["CJK Strokes"](a)||!(!bt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||bt["CJK Unified Ideographs Extension A"](a)||bt["CJK Unified Ideographs"](a)||bt["Enclosed CJK Letters and Months"](a)||bt["Hangul Compatibility Jamo"](a)||bt["Hangul Jamo Extended-A"](a)||bt["Hangul Jamo Extended-B"](a)||bt["Hangul Jamo"](a)||bt["Hangul Syllables"](a)||bt.Hiragana(a)||bt["Ideographic Description Characters"](a)||bt.Kanbun(a)||bt["Kangxi Radicals"](a)||bt["Katakana Phonetic Extensions"](a)||bt.Katakana(a)&&a!==12540||!(!bt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!bt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||bt["Unified Canadian Aboriginal Syllabics"](a)||bt["Unified Canadian Aboriginal Syllabics Extended"](a)||bt["Vertical Forms"](a)||bt["Yijing Hexagram Symbols"](a)||bt["Yi Syllables"](a)||bt["Yi Radicals"](a))))}function eh(a){return!(sc(a)||function(h){return!!(bt["Latin-1 Supplement"](h)&&(h===167||h===169||h===174||h===177||h===188||h===189||h===190||h===215||h===247)||bt["General Punctuation"](h)&&(h===8214||h===8224||h===8225||h===8240||h===8241||h===8251||h===8252||h===8258||h===8263||h===8264||h===8265||h===8273)||bt["Letterlike Symbols"](h)||bt["Number Forms"](h)||bt["Miscellaneous Technical"](h)&&(h>=8960&&h<=8967||h>=8972&&h<=8991||h>=8996&&h<=9e3||h===9003||h>=9085&&h<=9114||h>=9150&&h<=9165||h===9167||h>=9169&&h<=9179||h>=9186&&h<=9215)||bt["Control Pictures"](h)&&h!==9251||bt["Optical Character Recognition"](h)||bt["Enclosed Alphanumerics"](h)||bt["Geometric Shapes"](h)||bt["Miscellaneous Symbols"](h)&&!(h>=9754&&h<=9759)||bt["Miscellaneous Symbols and Arrows"](h)&&(h>=11026&&h<=11055||h>=11088&&h<=11097||h>=11192&&h<=11243)||bt["CJK Symbols and Punctuation"](h)||bt.Katakana(h)||bt["Private Use Area"](h)||bt["CJK Compatibility Forms"](h)||bt["Small Form Variants"](h)||bt["Halfwidth and Fullwidth Forms"](h)||h===8734||h===8756||h===8757||h>=9984&&h<=10087||h>=10102&&h<=10131||h===65532||h===65533)}(a))}function Os(a){return a>=1424&&a<=2303||bt["Arabic Presentation Forms-A"](a)||bt["Arabic Presentation Forms-B"](a)}function ls(a,h){return!(!h&&Os(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||bt.Khmer(a))}function ru(a){for(var h=0,p=a;h<p.length;h+=1)if(Os(p[h].charCodeAt(0)))return!0;return!1}var iu=null,cs="unavailable",Ho=null,gf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(cs="error"),iu&&iu(a)};function oc(){th.fire(new be("pluginStateChange",{pluginStatus:cs,pluginURL:Ho}))}var th=new De,rh=function(){return cs},Ds=function(){if(cs!=="deferred"||!Ho)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");cs="loading",oc(),Ho&&Ma({url:Ho},function(a){a?gf(a):(cs="loaded",oc())})},us={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return cs==="loaded"||us.applyArabicShaping!=null},isLoading:function(){return cs==="loading"},setState:function(a){cs=a.pluginStatus,Ho=a.pluginURL},isParsed:function(){return us.applyArabicShaping!=null&&us.processBidirectionalText!=null&&us.processStyledBidirectionalText!=null},getPluginURL:function(){return Ho}},Jt=function(a,h){this.zoom=a,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Qu,this.transition={})};Jt.prototype.isSupportedScript=function(a){return function(h,p){for(var x=0,E=h;x<E.length;x+=1)if(!ls(E[x].charCodeAt(0),p))return!1;return!0}(a,us.isLoaded())},Jt.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Jt.prototype.getCrossfadeParameters=function(){var a=this.zoom,h=a-Math.floor(a),p=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*h}};var Ao=function(a,h){this.property=a,this.value=h,this.expression=function(p,x){if(dl(p))return new pl(p,x);if(Jl(p)){var E=da(p,x);if(E.result==="error")throw new Error(E.value.map(function(R){return R.key+": "+R.message}).join(", "));return E.value}var P=p;return typeof p=="string"&&x.type==="color"&&(P=pr.parse(p)),{kind:"constant",evaluate:function(){return P}}}(h===void 0?a.specification.default:h,a.specification)};Ao.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Ao.prototype.possiblyEvaluate=function(a,h,p){return this.property.possiblyEvaluate(this,a,h,p)};var Fs=function(a){this.property=a,this.value=new Ao(a,void 0)};Fs.prototype.transitioned=function(a,h){return new vn(this.property,this.value,h,Y({},a.transition,this.transition),a.now)},Fs.prototype.untransitioned=function(){return new vn(this.property,this.value,null,{},0)};var Gi=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Gi.prototype.getValue=function(a){return Ae(this._values[a].value.value)},Gi.prototype.setValue=function(a,h){this._values.hasOwnProperty(a)||(this._values[a]=new Fs(this._values[a].property)),this._values[a].value=new Ao(this._values[a].property,h===null?void 0:Ae(h))},Gi.prototype.getTransition=function(a){return Ae(this._values[a].transition)},Gi.prototype.setTransition=function(a,h){this._values.hasOwnProperty(a)||(this._values[a]=new Fs(this._values[a].property)),this._values[a].transition=Ae(h)||void 0},Gi.prototype.serialize=function(){for(var a={},h=0,p=Object.keys(this._values);h<p.length;h+=1){var x=p[h],E=this.getValue(x);E!==void 0&&(a[x]=E);var P=this.getTransition(x);P!==void 0&&(a[x+"-transition"]=P)}return a},Gi.prototype.transitioned=function(a,h){for(var p=new _a(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var P=E[x];p._values[P]=this._values[P].transitioned(a,h._values[P])}return p},Gi.prototype.untransitioned=function(){for(var a=new _a(this._properties),h=0,p=Object.keys(this._values);h<p.length;h+=1){var x=p[h];a._values[x]=this._values[x].untransitioned()}return a};var vn=function(a,h,p,x,E){this.property=a,this.value=h,this.begin=E+x.delay||0,this.end=this.begin+x.duration||0,a.specification.transition&&(x.delay||x.duration)&&(this.prior=p)};vn.prototype.possiblyEvaluate=function(a,h,p){var x=a.now||0,E=this.value.possiblyEvaluate(a,h,p),P=this.prior;if(P){if(x>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(x<this.begin)return P.possiblyEvaluate(a,h,p);var R=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(P.possiblyEvaluate(a,h,p),E,function(O){if(O<=0)return 0;if(O>=1)return 1;var k=O*O,H=k*O;return 4*(O<.5?H:3*(O-k)+H-.75)}(R))}return E};var _a=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};_a.prototype.possiblyEvaluate=function(a,h,p){for(var x=new vl(this._properties),E=0,P=Object.keys(this._values);E<P.length;E+=1){var R=P[E];x._values[R]=this._values[R].possiblyEvaluate(a,h,p)}return x},_a.prototype.hasTransition=function(){for(var a=0,h=Object.keys(this._values);a<h.length;a+=1)if(this._values[h[a]].prior)return!0;return!1};var eo=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};eo.prototype.getValue=function(a){return Ae(this._values[a].value)},eo.prototype.setValue=function(a,h){this._values[a]=new Ao(this._values[a].property,h===null?void 0:Ae(h))},eo.prototype.serialize=function(){for(var a={},h=0,p=Object.keys(this._values);h<p.length;h+=1){var x=p[h],E=this.getValue(x);E!==void 0&&(a[x]=E)}return a},eo.prototype.possiblyEvaluate=function(a,h,p){for(var x=new vl(this._properties),E=0,P=Object.keys(this._values);E<P.length;E+=1){var R=P[E];x._values[R]=this._values[R].possiblyEvaluate(a,h,p)}return x};var Nn=function(a,h,p){this.property=a,this.value=h,this.parameters=p};Nn.prototype.isConstant=function(){return this.value.kind==="constant"},Nn.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},Nn.prototype.evaluate=function(a,h,p,x){return this.property.evaluate(this.value,this.parameters,a,h,p,x)};var vl=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};vl.prototype.get=function(a){return this._values[a]};var jt=function(a){this.specification=a};jt.prototype.possiblyEvaluate=function(a,h){return a.expression.evaluate(h)},jt.prototype.interpolate=function(a,h,p){var x=Ki[this.specification.type];return x?x(a,h,p):a};var Lt=function(a,h){this.specification=a,this.overrides=h};Lt.prototype.possiblyEvaluate=function(a,h,p,x){return new Nn(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(h,null,{},p,x)}:a.expression,h)},Lt.prototype.interpolate=function(a,h,p){if(a.value.kind!=="constant"||h.value.kind!=="constant")return a;if(a.value.value===void 0||h.value.value===void 0)return new Nn(this,{kind:"constant",value:void 0},a.parameters);var x=Ki[this.specification.type];return x?new Nn(this,{kind:"constant",value:x(a.value.value,h.value.value,p)},a.parameters):a},Lt.prototype.evaluate=function(a,h,p,x,E,P){return a.kind==="constant"?a.value:a.evaluate(h,p,x,E,P)};var ac=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.possiblyEvaluate=function(p,x,E,P){if(p.value===void 0)return new Nn(this,{kind:"constant",value:void 0},x);if(p.expression.kind==="constant"){var R=p.expression.evaluate(x,null,{},E,P),O=p.property.specification.type==="resolvedImage"&&typeof R!="string"?R.name:R,k=this._calculate(O,O,O,x);return new Nn(this,{kind:"constant",value:k},x)}if(p.expression.kind==="camera"){var H=this._calculate(p.expression.evaluate({zoom:x.zoom-1}),p.expression.evaluate({zoom:x.zoom}),p.expression.evaluate({zoom:x.zoom+1}),x);return new Nn(this,{kind:"constant",value:H},x)}return new Nn(this,p.expression,x)},h.prototype.evaluate=function(p,x,E,P,R,O){if(p.kind==="source"){var k=p.evaluate(x,E,P,R,O);return this._calculate(k,k,k,x)}return p.kind==="composite"?this._calculate(p.evaluate({zoom:Math.floor(x.zoom)-1},E,P),p.evaluate({zoom:Math.floor(x.zoom)},E,P),p.evaluate({zoom:Math.floor(x.zoom)+1},E,P),x):p.value},h.prototype._calculate=function(p,x,E,P){return P.zoom>P.zoomHistory.lastIntegerZoom?{from:p,to:x}:{from:E,to:x}},h.prototype.interpolate=function(p){return p},h}(Lt),Un=function(a){this.specification=a};Un.prototype.possiblyEvaluate=function(a,h,p,x){if(a.value!==void 0){if(a.expression.kind==="constant"){var E=a.expression.evaluate(h,null,{},p,x);return this._calculate(E,E,E,h)}return this._calculate(a.expression.evaluate(new Jt(Math.floor(h.zoom-1),h)),a.expression.evaluate(new Jt(Math.floor(h.zoom),h)),a.expression.evaluate(new Jt(Math.floor(h.zoom+1),h)),h)}},Un.prototype._calculate=function(a,h,p,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:a,to:h}:{from:p,to:h}},Un.prototype.interpolate=function(a){return a};var to=function(a){this.specification=a};to.prototype.possiblyEvaluate=function(a,h,p,x){return!!a.expression.evaluate(h,null,{},p,x)},to.prototype.interpolate=function(){return!1};var bn=function(a){for(var h in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var p=a[h];p.specification.overridable&&this.overridableProperties.push(h);var x=this.defaultPropertyValues[h]=new Ao(p,void 0),E=this.defaultTransitionablePropertyValues[h]=new Fs(p);this.defaultTransitioningPropertyValues[h]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate({})}};Ct("DataDrivenProperty",Lt),Ct("DataConstantProperty",jt),Ct("CrossFadedDataDrivenProperty",ac),Ct("CrossFadedProperty",Un),Ct("ColorRampProperty",to);var po=function(a){function h(p,x){if(a.call(this),this.id=p.id,this.type=p.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},p.type!=="custom"&&(this.metadata=(p=p).metadata,this.minzoom=p.minzoom,this.maxzoom=p.maxzoom,p.type!=="background"&&(this.source=p.source,this.sourceLayer=p["source-layer"],this.filter=p.filter),x.layout&&(this._unevaluatedLayout=new eo(x.layout)),x.paint)){for(var E in this._transitionablePaint=new Gi(x.paint),p.paint)this.setPaintProperty(E,p.paint[E],{validate:!1});for(var P in p.layout)this.setLayoutProperty(P,p.layout[P],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vl(x.paint)}}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},h.prototype.getLayoutProperty=function(p){return p==="visibility"?this.visibility:this._unevaluatedLayout.getValue(p)},h.prototype.setLayoutProperty=function(p,x,E){E===void 0&&(E={}),x!=null&&this._validate(ic,"layers."+this.id+".layout."+p,p,x,E)||(p!=="visibility"?this._unevaluatedLayout.setValue(p,x):this.visibility=x)},h.prototype.getPaintProperty=function(p){return Fe(p,"-transition")?this._transitionablePaint.getTransition(p.slice(0,-11)):this._transitionablePaint.getValue(p)},h.prototype.setPaintProperty=function(p,x,E){if(E===void 0&&(E={}),x!=null&&this._validate(bA,"layers."+this.id+".paint."+p,p,x,E))return!1;if(Fe(p,"-transition"))return this._transitionablePaint.setTransition(p.slice(0,-11),x||void 0),!1;var P=this._transitionablePaint._values[p],R=P.property.specification["property-type"]==="cross-faded-data-driven",O=P.value.isDataDriven(),k=P.value;this._transitionablePaint.setValue(p,x),this._handleSpecialPaintPropertyUpdate(p);var H=this._transitionablePaint._values[p].value;return H.isDataDriven()||O||R||this._handleOverridablePaintPropertyUpdate(p,k,H)},h.prototype._handleSpecialPaintPropertyUpdate=function(p){},h.prototype._handleOverridablePaintPropertyUpdate=function(p,x,E){return!1},h.prototype.isHidden=function(p){return!!(this.minzoom&&p<this.minzoom)||!!(this.maxzoom&&p>=this.maxzoom)||this.visibility==="none"},h.prototype.updateTransitions=function(p){this._transitioningPaint=this._transitionablePaint.transitioned(p,this._transitioningPaint)},h.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},h.prototype.recalculate=function(p,x){p.getCrossfadeParameters&&(this._crossfadeParameters=p.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(p,void 0,x)),this.paint=this._transitioningPaint.possiblyEvaluate(p,void 0,x)},h.prototype.serialize=function(){var p={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(p.layout=p.layout||{},p.layout.visibility=this.visibility),Te(p,function(x,E){return!(x===void 0||E==="layout"&&!Object.keys(x).length||E==="paint"&&!Object.keys(x).length)})},h.prototype._validate=function(p,x,E,P,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&nc(this,p.call(rc,{key:x,layerType:this.type,objectKey:E,value:P,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))},h.prototype.is3D=function(){return!1},h.prototype.isTileClipped=function(){return!1},h.prototype.hasOffscreenPass=function(){return!1},h.prototype.resize=function(){},h.prototype.isStateDependent=function(){for(var p in this.paint._values){var x=this.paint.get(p);if(x instanceof Nn&&ha(x.property.specification)&&(x.value.kind==="source"||x.value.kind==="composite")&&x.value.isStateDependent)return!0}return!1},h}(De),ih={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ro=function(a,h){this._structArray=a,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Rr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function $t(a,h){h===void 0&&(h=1);var p=0,x=0;return{members:a.map(function(E){var P=ih[E.type].BYTES_PER_ELEMENT,R=p=io(p,Math.max(h,P)),O=E.components||1;return x=Math.max(x,P),p+=P*O,{name:E.name,type:E.type,components:O,offset:R}}),size:io(p,Math.max(x,h)),alignment:h}}function io(a,h){return Math.ceil(a/h)*h}Rr.serialize=function(a,h){return a._trim(),h&&(a.isTransferred=!0,h.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Rr.deserialize=function(a){var h=Object.create(this.prototype);return h.arrayBuffer=a.arrayBuffer,h.length=a.length,h.capacity=a.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h},Rr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Rr.prototype.clear=function(){this.length=0},Rr.prototype.resize=function(a){this.reserve(a),this.length=a},Rr.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}},Rr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Cr=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x){var E=this.length;return this.resize(E+1),this.emplace(E,p,x)},h.prototype.emplace=function(p,x,E){var P=2*p;return this.int16[P+0]=x,this.int16[P+1]=E,p},h}(Rr);Cr.prototype.bytesPerElement=4,Ct("StructArrayLayout2i4",Cr);var xn=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P){var R=this.length;return this.resize(R+1),this.emplace(R,p,x,E,P)},h.prototype.emplace=function(p,x,E,P,R){var O=4*p;return this.int16[O+0]=x,this.int16[O+1]=E,this.int16[O+2]=P,this.int16[O+3]=R,p},h}(Rr);xn.prototype.bytesPerElement=8,Ct("StructArrayLayout4i8",xn);var go=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P,R,O){var k=this.length;return this.resize(k+1),this.emplace(k,p,x,E,P,R,O)},h.prototype.emplace=function(p,x,E,P,R,O,k){var H=6*p;return this.int16[H+0]=x,this.int16[H+1]=E,this.int16[H+2]=P,this.int16[H+3]=R,this.int16[H+4]=O,this.int16[H+5]=k,p},h}(Rr);go.prototype.bytesPerElement=12,Ct("StructArrayLayout2i4i12",go);var zn=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P,R,O){var k=this.length;return this.resize(k+1),this.emplace(k,p,x,E,P,R,O)},h.prototype.emplace=function(p,x,E,P,R,O,k){var H=4*p,X=8*p;return this.int16[H+0]=x,this.int16[H+1]=E,this.uint8[X+4]=P,this.uint8[X+5]=R,this.uint8[X+6]=O,this.uint8[X+7]=k,p},h}(Rr);zn.prototype.bytesPerElement=8,Ct("StructArrayLayout2i4ub8",zn);var Ls=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x){var E=this.length;return this.resize(E+1),this.emplace(E,p,x)},h.prototype.emplace=function(p,x,E){var P=2*p;return this.float32[P+0]=x,this.float32[P+1]=E,p},h}(Rr);Ls.prototype.bytesPerElement=8,Ct("StructArrayLayout2f8",Ls);var mo=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P,R,O,k,H,X,q){var re=this.length;return this.resize(re+1),this.emplace(re,p,x,E,P,R,O,k,H,X,q)},h.prototype.emplace=function(p,x,E,P,R,O,k,H,X,q,re){var ae=10*p;return this.uint16[ae+0]=x,this.uint16[ae+1]=E,this.uint16[ae+2]=P,this.uint16[ae+3]=R,this.uint16[ae+4]=O,this.uint16[ae+5]=k,this.uint16[ae+6]=H,this.uint16[ae+7]=X,this.uint16[ae+8]=q,this.uint16[ae+9]=re,p},h}(Rr);mo.prototype.bytesPerElement=20,Ct("StructArrayLayout10ui20",mo);var un=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P,R,O,k,H,X,q,re,ae){var ve=this.length;return this.resize(ve+1),this.emplace(ve,p,x,E,P,R,O,k,H,X,q,re,ae)},h.prototype.emplace=function(p,x,E,P,R,O,k,H,X,q,re,ae,ve){var xe=12*p;return this.int16[xe+0]=x,this.int16[xe+1]=E,this.int16[xe+2]=P,this.int16[xe+3]=R,this.uint16[xe+4]=O,this.uint16[xe+5]=k,this.uint16[xe+6]=H,this.uint16[xe+7]=X,this.int16[xe+8]=q,this.int16[xe+9]=re,this.int16[xe+10]=ae,this.int16[xe+11]=ve,p},h}(Rr);un.prototype.bytesPerElement=24,Ct("StructArrayLayout4i4ui4i24",un);var Go=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E){var P=this.length;return this.resize(P+1),this.emplace(P,p,x,E)},h.prototype.emplace=function(p,x,E,P){var R=3*p;return this.float32[R+0]=x,this.float32[R+1]=E,this.float32[R+2]=P,p},h}(Rr);Go.prototype.bytesPerElement=12,Ct("StructArrayLayout3f12",Go);var _o=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},h.prototype.emplace=function(p,x){return this.uint32[1*p+0]=x,p},h}(Rr);_o.prototype.bytesPerElement=4,Ct("StructArrayLayout1ul4",_o);var nu=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P,R,O,k,H,X){var q=this.length;return this.resize(q+1),this.emplace(q,p,x,E,P,R,O,k,H,X)},h.prototype.emplace=function(p,x,E,P,R,O,k,H,X,q){var re=10*p,ae=5*p;return this.int16[re+0]=x,this.int16[re+1]=E,this.int16[re+2]=P,this.int16[re+3]=R,this.int16[re+4]=O,this.int16[re+5]=k,this.uint32[ae+3]=H,this.uint16[re+8]=X,this.uint16[re+9]=q,p},h}(Rr);nu.prototype.bytesPerElement=20,Ct("StructArrayLayout6i1ul2ui20",nu);var _t=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P,R,O){var k=this.length;return this.resize(k+1),this.emplace(k,p,x,E,P,R,O)},h.prototype.emplace=function(p,x,E,P,R,O,k){var H=6*p;return this.int16[H+0]=x,this.int16[H+1]=E,this.int16[H+2]=P,this.int16[H+3]=R,this.int16[H+4]=O,this.int16[H+5]=k,p},h}(Rr);_t.prototype.bytesPerElement=12,Ct("StructArrayLayout2i2i2i12",_t);var St=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P,R){var O=this.length;return this.resize(O+1),this.emplace(O,p,x,E,P,R)},h.prototype.emplace=function(p,x,E,P,R,O){var k=4*p,H=8*p;return this.float32[k+0]=x,this.float32[k+1]=E,this.float32[k+2]=P,this.int16[H+6]=R,this.int16[H+7]=O,p},h}(Rr);St.prototype.bytesPerElement=16,Ct("StructArrayLayout2f1f2i16",St);var su=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P){var R=this.length;return this.resize(R+1),this.emplace(R,p,x,E,P)},h.prototype.emplace=function(p,x,E,P,R){var O=12*p,k=3*p;return this.uint8[O+0]=x,this.uint8[O+1]=E,this.float32[k+1]=P,this.float32[k+2]=R,p},h}(Rr);su.prototype.bytesPerElement=12,Ct("StructArrayLayout2ub2f12",su);var yo=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E){var P=this.length;return this.resize(P+1),this.emplace(P,p,x,E)},h.prototype.emplace=function(p,x,E,P){var R=3*p;return this.uint16[R+0]=x,this.uint16[R+1]=E,this.uint16[R+2]=P,p},h}(Rr);yo.prototype.bytesPerElement=6,Ct("StructArrayLayout3ui6",yo);var no=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P,R,O,k,H,X,q,re,ae,ve,xe,Be,Se,Ne){var We=this.length;return this.resize(We+1),this.emplace(We,p,x,E,P,R,O,k,H,X,q,re,ae,ve,xe,Be,Se,Ne)},h.prototype.emplace=function(p,x,E,P,R,O,k,H,X,q,re,ae,ve,xe,Be,Se,Ne,We){var Ye=24*p,et=12*p,ot=48*p;return this.int16[Ye+0]=x,this.int16[Ye+1]=E,this.uint16[Ye+2]=P,this.uint16[Ye+3]=R,this.uint32[et+2]=O,this.uint32[et+3]=k,this.uint32[et+4]=H,this.uint16[Ye+10]=X,this.uint16[Ye+11]=q,this.uint16[Ye+12]=re,this.float32[et+7]=ae,this.float32[et+8]=ve,this.uint8[ot+36]=xe,this.uint8[ot+37]=Be,this.uint8[ot+38]=Se,this.uint32[et+10]=Ne,this.int16[Ye+22]=We,p},h}(Rr);no.prototype.bytesPerElement=48,Ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",no);var ka=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P,R,O,k,H,X,q,re,ae,ve,xe,Be,Se,Ne,We,Ye,et,ot,pt,wt,Ht,Mt,Xt,Bt,Er){var sr=this.length;return this.resize(sr+1),this.emplace(sr,p,x,E,P,R,O,k,H,X,q,re,ae,ve,xe,Be,Se,Ne,We,Ye,et,ot,pt,wt,Ht,Mt,Xt,Bt,Er)},h.prototype.emplace=function(p,x,E,P,R,O,k,H,X,q,re,ae,ve,xe,Be,Se,Ne,We,Ye,et,ot,pt,wt,Ht,Mt,Xt,Bt,Er,sr){var Ut=34*p,Br=17*p;return this.int16[Ut+0]=x,this.int16[Ut+1]=E,this.int16[Ut+2]=P,this.int16[Ut+3]=R,this.int16[Ut+4]=O,this.int16[Ut+5]=k,this.int16[Ut+6]=H,this.int16[Ut+7]=X,this.uint16[Ut+8]=q,this.uint16[Ut+9]=re,this.uint16[Ut+10]=ae,this.uint16[Ut+11]=ve,this.uint16[Ut+12]=xe,this.uint16[Ut+13]=Be,this.uint16[Ut+14]=Se,this.uint16[Ut+15]=Ne,this.uint16[Ut+16]=We,this.uint16[Ut+17]=Ye,this.uint16[Ut+18]=et,this.uint16[Ut+19]=ot,this.uint16[Ut+20]=pt,this.uint16[Ut+21]=wt,this.uint16[Ut+22]=Ht,this.uint32[Br+12]=Mt,this.float32[Br+13]=Xt,this.float32[Br+14]=Bt,this.float32[Br+15]=Er,this.float32[Br+16]=sr,p},h}(Rr);ka.prototype.bytesPerElement=68,Ct("StructArrayLayout8i15ui1ul4f68",ka);var hs=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},h.prototype.emplace=function(p,x){return this.float32[1*p+0]=x,p},h}(Rr);hs.prototype.bytesPerElement=4,Ct("StructArrayLayout1f4",hs);var bs=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E){var P=this.length;return this.resize(P+1),this.emplace(P,p,x,E)},h.prototype.emplace=function(p,x,E,P){var R=3*p;return this.int16[R+0]=x,this.int16[R+1]=E,this.int16[R+2]=P,p},h}(Rr);bs.prototype.bytesPerElement=6,Ct("StructArrayLayout3i6",bs);var vo=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E){var P=this.length;return this.resize(P+1),this.emplace(P,p,x,E)},h.prototype.emplace=function(p,x,E,P){var R=4*p;return this.uint32[2*p+0]=x,this.uint16[R+2]=E,this.uint16[R+3]=P,p},h}(Rr);vo.prototype.bytesPerElement=8,Ct("StructArrayLayout1ul2ui8",vo);var m=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x){var E=this.length;return this.resize(E+1),this.emplace(E,p,x)},h.prototype.emplace=function(p,x,E){var P=2*p;return this.uint16[P+0]=x,this.uint16[P+1]=E,p},h}(Rr);m.prototype.bytesPerElement=4,Ct("StructArrayLayout2ui4",m);var g=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},h.prototype.emplace=function(p,x){return this.uint16[1*p+0]=x,p},h}(Rr);g.prototype.bytesPerElement=2,Ct("StructArrayLayout1ui2",g);var b=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(p,x,E,P){var R=this.length;return this.resize(R+1),this.emplace(R,p,x,E,P)},h.prototype.emplace=function(p,x,E,P,R){var O=4*p;return this.float32[O+0]=x,this.float32[O+1]=E,this.float32[O+2]=P,this.float32[O+3]=R,p},h}(Rr);b.prototype.bytesPerElement=16,Ct("StructArrayLayout4f16",b);var l=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var p={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return p.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},p.x1.get=function(){return this._structArray.int16[this._pos2+2]},p.y1.get=function(){return this._structArray.int16[this._pos2+3]},p.x2.get=function(){return this._structArray.int16[this._pos2+4]},p.y2.get=function(){return this._structArray.int16[this._pos2+5]},p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.anchorPoint.get=function(){return new w(this.anchorPointX,this.anchorPointY)},Object.defineProperties(h.prototype,p),h}(ro);l.prototype.size=20;var u=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.get=function(p){return new l(this,p)},h}(nu);Ct("CollisionBoxArray",u);var c=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},p.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},p.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},p.segment.get=function(){return this._structArray.uint16[this._pos2+10]},p.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},p.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},p.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},p.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},p.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},p.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},p.placedOrientation.set=function(x){this._structArray.uint8[this._pos1+37]=x},p.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},p.hidden.set=function(x){this._structArray.uint8[this._pos1+38]=x},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+10]=x},p.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(h.prototype,p),h}(ro);c.prototype.size=48;var d=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.get=function(p){return new c(this,p)},h}(no);Ct("PlacedSymbolArray",d);var y=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},p.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},p.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},p.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},p.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},p.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},p.key.get=function(){return this._structArray.uint16[this._pos2+8]},p.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},p.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},p.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},p.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},p.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},p.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},p.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},p.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},p.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},p.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},p.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},p.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},p.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+12]=x},p.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},p.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},p.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},p.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(h.prototype,p),h}(ro);y.prototype.size=68;var T=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.get=function(p){return new y(this,p)},h}(ka);Ct("SymbolInstanceArray",T);var S=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.getoffsetX=function(p){return this.float32[1*p+0]},h}(hs);Ct("GlyphOffsetArray",S);var M=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.getx=function(p){return this.int16[3*p+0]},h.prototype.gety=function(p){return this.int16[3*p+1]},h.prototype.gettileUnitDistanceFromAnchor=function(p){return this.int16[3*p+2]},h}(bs);Ct("SymbolLineVertexArray",M);var D=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var p={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(h.prototype,p),h}(ro);D.prototype.size=8;var L=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.get=function(p){return new D(this,p)},h}(vo);Ct("FeatureIndexArray",L);var j=$t([{name:"a_pos",components:2,type:"Int16"}],4).members,z=function(a){a===void 0&&(a=[]),this.segments=a};function W(a,h){return 256*(a=V(Math.floor(a),0,255))+V(Math.floor(h),0,255)}z.prototype.prepareSegment=function(a,h,p,x){var E=this.segments[this.segments.length-1];return a>z.MAX_VERTEX_ARRAY_LENGTH&&Ve("Max vertices per segment is "+z.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!E||E.vertexLength+a>z.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==x)&&(E={vertexOffset:h.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},x!==void 0&&(E.sortKey=x),this.segments.push(E)),E},z.prototype.get=function(){return this.segments},z.prototype.destroy=function(){for(var a=0,h=this.segments;a<h.length;a+=1){var p=h[a];for(var x in p.vaos)p.vaos[x].destroy()}},z.simpleSegment=function(a,h,p,x){return new z([{vertexOffset:a,primitiveOffset:h,vertexLength:p,primitiveLength:x,vaos:{},sortKey:0}])},z.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct("SegmentVector",z);var te=$t([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Q=f(function(a){a.exports=function(h,p){var x,E,P,R,O,k,H,X;for(E=h.length-(x=3&h.length),P=p,O=3432918353,k=461845907,X=0;X<E;)H=255&h.charCodeAt(X)|(255&h.charCodeAt(++X))<<8|(255&h.charCodeAt(++X))<<16|(255&h.charCodeAt(++X))<<24,++X,P=27492+(65535&(R=5*(65535&(P=(P^=H=(65535&(H=(H=(65535&H)*O+(((H>>>16)*O&65535)<<16)&4294967295)<<15|H>>>17))*k+(((H>>>16)*k&65535)<<16)&4294967295)<<13|P>>>19))+((5*(P>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch(H=0,x){case 3:H^=(255&h.charCodeAt(X+2))<<16;case 2:H^=(255&h.charCodeAt(X+1))<<8;case 1:P^=H=(65535&(H=(H=(65535&(H^=255&h.charCodeAt(X)))*O+(((H>>>16)*O&65535)<<16)&4294967295)<<15|H>>>17))*k+(((H>>>16)*k&65535)<<16)&4294967295}return P^=h.length,P=2246822507*(65535&(P^=P>>>16))+((2246822507*(P>>>16)&65535)<<16)&4294967295,P=3266489909*(65535&(P^=P>>>13))+((3266489909*(P>>>16)&65535)<<16)&4294967295,(P^=P>>>16)>>>0}}),ie=f(function(a){a.exports=function(h,p){for(var x,E=h.length,P=p^E,R=0;E>=4;)x=1540483477*(65535&(x=255&h.charCodeAt(R)|(255&h.charCodeAt(++R))<<8|(255&h.charCodeAt(++R))<<16|(255&h.charCodeAt(++R))<<24))+((1540483477*(x>>>16)&65535)<<16),P=1540483477*(65535&P)+((1540483477*(P>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),E-=4,++R;switch(E){case 3:P^=(255&h.charCodeAt(R+2))<<16;case 2:P^=(255&h.charCodeAt(R+1))<<8;case 1:P=1540483477*(65535&(P^=255&h.charCodeAt(R)))+((1540483477*(P>>>16)&65535)<<16)}return P=1540483477*(65535&(P^=P>>>13))+((1540483477*(P>>>16)&65535)<<16),(P^=P>>>15)>>>0}}),K=Q,J=ie;K.murmur3=Q,K.murmur2=J;var _e=function(){this.ids=[],this.positions=[],this.indexed=!1};_e.prototype.add=function(a,h,p,x){this.ids.push(Ie(a)),this.positions.push(h,p,x)},_e.prototype.getPositions=function(a){for(var h=Ie(a),p=0,x=this.ids.length-1;p<x;){var E=p+x>>1;this.ids[E]>=h?x=E:p=E+1}for(var P=[];this.ids[p]===h;)P.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return P},_e.serialize=function(a,h){var p=new Float64Array(a.ids),x=new Uint32Array(a.positions);return function E(P,R,O,k){for(;O<k;){for(var H=P[O+k>>1],X=O-1,q=k+1;;){do X++;while(P[X]<H);do q--;while(P[q]>H);if(X>=q)break;Me(P,X,q),Me(R,3*X,3*q),Me(R,3*X+1,3*q+1),Me(R,3*X+2,3*q+2)}q-O<k-q?(E(P,R,O,q),O=q+1):(E(P,R,q+1,k),k=q)}}(p,x,0,p.length-1),h&&h.push(p.buffer,x.buffer),{ids:p,positions:x}},_e.deserialize=function(a){var h=new _e;return h.ids=a.ids,h.positions=a.positions,h.indexed=!0,h};var Ee=Math.pow(2,53)-1;function Ie(a){var h=+a;return!isNaN(h)&&h<=Ee?h:K(String(a))}function Me(a,h,p){var x=a[h];a[h]=a[p],a[p]=x}Ct("FeaturePositionMap",_e);var Ge=function(a,h){this.gl=a.gl,this.location=h},Qe=function(a){function h(p,x){a.call(this,p,x),this.current=0}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))},h}(Ge),st=function(a){function h(p,x){a.call(this,p,x),this.current=0}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))},h}(Ge),rt=function(a){function h(p,x){a.call(this,p,x),this.current=[0,0]}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))},h}(Ge),lt=function(a){function h(p,x){a.call(this,p,x),this.current=[0,0,0]}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))},h}(Ge),At=function(a){function h(p,x){a.call(this,p,x),this.current=[0,0,0,0]}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3]))},h}(Ge),Tt=function(a){function h(p,x){a.call(this,p,x),this.current=pr.transparent}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.set=function(p){p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a))},h}(Ge),ft=new Float32Array(16),Zt=function(a){function h(p,x){a.call(this,p,x),this.current=ft}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.set=function(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(var x=1;x<16;x++)if(p[x]!==this.current[x]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}},h}(Ge);function xt(a){return[W(255*a.r,255*a.g),W(255*a.b,255*a.a)]}var or=function(a,h,p){this.value=a,this.uniformNames=h.map(function(x){return"u_"+x}),this.type=p};or.prototype.setUniform=function(a,h,p){a.set(p.constantOr(this.value))},or.prototype.getBinding=function(a,h,p){return this.type==="color"?new Tt(a,h):new st(a,h)};var Tr=function(a,h){this.uniformNames=h.map(function(p){return"u_"+p}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Tr.prototype.setConstantPatternPositions=function(a,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=a.tlbr},Tr.prototype.setUniform=function(a,h,p,x){var E=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&a.set(E)},Tr.prototype.getBinding=function(a,h,p){return p.substr(0,9)==="u_pattern"?new At(a,h):new st(a,h)};var hr=function(a,h,p,x){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=h.map(function(E){return{name:"a_"+E,type:"Float32",components:p==="color"?2:1,offset:0}}),this.paintVertexArray=new x};hr.prototype.populatePaintArray=function(a,h,p,x,E){var P=this.paintVertexArray.length,R=this.expression.evaluate(new Jt(0),h,{},x,[],E);this.paintVertexArray.resize(a),this._setPaintValue(P,a,R)},hr.prototype.updatePaintArray=function(a,h,p,x){var E=this.expression.evaluate({zoom:0},p,x);this._setPaintValue(a,h,E)},hr.prototype._setPaintValue=function(a,h,p){if(this.type==="color")for(var x=xt(p),E=a;E<h;E++)this.paintVertexArray.emplace(E,x[0],x[1]);else{for(var P=a;P<h;P++)this.paintVertexArray.emplace(P,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}},hr.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},hr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var cr=function(a,h,p,x,E,P){this.expression=a,this.uniformNames=h.map(function(R){return"u_"+R+"_t"}),this.type=p,this.useIntegerZoom=x,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=h.map(function(R){return{name:"a_"+R,type:"Float32",components:p==="color"?4:2,offset:0}}),this.paintVertexArray=new P};cr.prototype.populatePaintArray=function(a,h,p,x,E){var P=this.expression.evaluate(new Jt(this.zoom),h,{},x,[],E),R=this.expression.evaluate(new Jt(this.zoom+1),h,{},x,[],E),O=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(O,a,P,R)},cr.prototype.updatePaintArray=function(a,h,p,x){var E=this.expression.evaluate({zoom:this.zoom},p,x),P=this.expression.evaluate({zoom:this.zoom+1},p,x);this._setPaintValue(a,h,E,P)},cr.prototype._setPaintValue=function(a,h,p,x){if(this.type==="color")for(var E=xt(p),P=xt(x),R=a;R<h;R++)this.paintVertexArray.emplace(R,E[0],E[1],P[0],P[1]);else{for(var O=a;O<h;O++)this.paintVertexArray.emplace(O,p,x);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(x))}},cr.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},cr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},cr.prototype.setUniform=function(a,h){var p=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,x=V(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);a.set(x)},cr.prototype.getBinding=function(a,h,p){return new st(a,h)};var wr=function(a,h,p,x,E,P){this.expression=a,this.type=h,this.useIntegerZoom=p,this.zoom=x,this.layerId=P,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E};wr.prototype.populatePaintArray=function(a,h,p){var x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(x,a,h.patterns&&h.patterns[this.layerId],p)},wr.prototype.updatePaintArray=function(a,h,p,x,E){this._setPaintValues(a,h,p.patterns&&p.patterns[this.layerId],E)},wr.prototype._setPaintValues=function(a,h,p,x){if(x&&p){var E=x[p.min],P=x[p.mid],R=x[p.max];if(E&&P&&R)for(var O=a;O<h;O++)this.zoomInPaintVertexArray.emplace(O,P.tl[0],P.tl[1],P.br[0],P.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],P.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,P.tl[0],P.tl[1],P.br[0],P.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],P.pixelRatio,R.pixelRatio)}},wr.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,te.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,te.members,this.expression.isStateDependent))},wr.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ar=function(a,h,p){this.binders={},this._buffers=[];var x=[];for(var E in a.paint._values)if(p(E)){var P=a.paint.get(E);if(P instanceof Nn&&ha(P.property.specification)){var R=wn(E,a.type),O=P.value,k=P.property.specification.type,H=P.property.useIntegerZoom,X=P.property.specification["property-type"],q=X==="cross-faded"||X==="cross-faded-data-driven";if(O.kind==="constant")this.binders[E]=q?new Tr(O.value,R):new or(O.value,R,k),x.push("/u_"+E);else if(O.kind==="source"||q){var re=Wi(E,k,"source");this.binders[E]=q?new wr(O,k,H,h,re,a.id):new hr(O,R,k,re),x.push("/a_"+E)}else{var ae=Wi(E,k,"composite");this.binders[E]=new cr(O,R,k,H,h,ae),x.push("/z_"+E)}}}this.cacheKey=x.sort().join("")};ar.prototype.getMaxValue=function(a){var h=this.binders[a];return h instanceof hr||h instanceof cr?h.maxValue:0},ar.prototype.populatePaintArrays=function(a,h,p,x,E){for(var P in this.binders){var R=this.binders[P];(R instanceof hr||R instanceof cr||R instanceof wr)&&R.populatePaintArray(a,h,p,x,E)}},ar.prototype.setConstantPatternPositions=function(a,h){for(var p in this.binders){var x=this.binders[p];x instanceof Tr&&x.setConstantPatternPositions(a,h)}},ar.prototype.updatePaintArrays=function(a,h,p,x,E){var P=!1;for(var R in a)for(var O=0,k=h.getPositions(R);O<k.length;O+=1){var H=k[O],X=p.feature(H.index);for(var q in this.binders){var re=this.binders[q];if((re instanceof hr||re instanceof cr||re instanceof wr)&&re.expression.isStateDependent===!0){var ae=x.paint.get(q);re.expression=ae.value,re.updatePaintArray(H.start,H.end,X,a[R],E),P=!0}}}return P},ar.prototype.defines=function(){var a=[];for(var h in this.binders){var p=this.binders[h];(p instanceof or||p instanceof Tr)&&a.push.apply(a,p.uniformNames.map(function(x){return"#define HAS_UNIFORM_"+x}))}return a},ar.prototype.getBinderAttributes=function(){var a=[];for(var h in this.binders){var p=this.binders[h];if(p instanceof hr||p instanceof cr)for(var x=0;x<p.paintVertexAttributes.length;x++)a.push(p.paintVertexAttributes[x].name);else if(p instanceof wr)for(var E=0;E<te.members.length;E++)a.push(te.members[E].name)}return a},ar.prototype.getBinderUniforms=function(){var a=[];for(var h in this.binders){var p=this.binders[h];if(p instanceof or||p instanceof Tr||p instanceof cr)for(var x=0,E=p.uniformNames;x<E.length;x+=1)a.push(E[x])}return a},ar.prototype.getPaintVertexBuffers=function(){return this._buffers},ar.prototype.getUniforms=function(a,h){var p=[];for(var x in this.binders){var E=this.binders[x];if(E instanceof or||E instanceof Tr||E instanceof cr)for(var P=0,R=E.uniformNames;P<R.length;P+=1){var O=R[P];if(h[O]){var k=E.getBinding(a,h[O],O);p.push({name:O,property:x,binding:k})}}}return p},ar.prototype.setUniforms=function(a,h,p,x){for(var E=0,P=h;E<P.length;E+=1){var R=P[E],O=R.name,k=R.property;this.binders[k].setUniform(R.binding,x,p.get(k),O)}},ar.prototype.updatePaintBuffers=function(a){for(var h in this._buffers=[],this.binders){var p=this.binders[h];if(a&&p instanceof wr){var x=a.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(p instanceof hr||p instanceof cr)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}},ar.prototype.upload=function(a){for(var h in this.binders){var p=this.binders[h];(p instanceof hr||p instanceof cr||p instanceof wr)&&p.upload(a)}this.updatePaintBuffers()},ar.prototype.destroy=function(){for(var a in this.binders){var h=this.binders[a];(h instanceof hr||h instanceof cr||h instanceof wr)&&h.destroy()}};var nr=function(a,h,p){p===void 0&&(p=function(){return!0}),this.programConfigurations={};for(var x=0,E=a;x<E.length;x+=1){var P=E[x];this.programConfigurations[P.id]=new ar(P,h,p)}this.needsUpload=!1,this._featureMap=new _e,this._bufferOffset=0};function wn(a,h){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(h+"-","").replace(/-/g,"_")]}function Wi(a,h,p){var x={color:{source:Ls,composite:b},number:{source:hs,composite:Ls}},E=function(P){return{"line-pattern":{source:mo,composite:mo},"fill-pattern":{source:mo,composite:mo},"fill-extrusion-pattern":{source:mo,composite:mo}}[P]}(a);return E&&E[p]||x[h][p]}nr.prototype.populatePaintArrays=function(a,h,p,x,E,P){for(var R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(a,h,x,E,P);h.id!==void 0&&this._featureMap.add(h.id,p,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},nr.prototype.updatePaintArrays=function(a,h,p,x){for(var E=0,P=p;E<P.length;E+=1){var R=P[E];this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(a,this._featureMap,h,R,x)||this.needsUpload}},nr.prototype.get=function(a){return this.programConfigurations[a]},nr.prototype.upload=function(a){if(this.needsUpload){for(var h in this.programConfigurations)this.programConfigurations[h].upload(a);this.needsUpload=!1}},nr.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},Ct("ConstantBinder",or),Ct("CrossFadedConstantBinder",Tr),Ct("SourceExpressionBinder",hr),Ct("CrossFadedCompositeBinder",wr),Ct("CompositeExpressionBinder",cr),Ct("ProgramConfiguration",ar,{omit:["_buffers"]}),Ct("ProgramConfigurationSet",nr);var Jn=Math.pow(2,14)-1,Bn=-Jn-1;function Li(a){for(var h=8192/a.extent,p=a.loadGeometry(),x=0;x<p.length;x++)for(var E=p[x],P=0;P<E.length;P++){var R=E[P],O=Math.round(R.x*h),k=Math.round(R.y*h);R.x=V(O,Bn,Jn),R.y=V(k,Bn,Jn),(O<R.x||O>R.x+1||k<R.y||k>R.y+1)&&Ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return p}function Qi(a,h){return{type:a.type,id:a.id,properties:a.properties,geometry:h?Li(a):[]}}function ks(a,h,p,x,E){a.emplaceBack(2*h+(x+1)/2,2*p+(E+1)/2)}var fs=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Cr,this.indexArray=new yo,this.segments=new z,this.programConfigurations=new nr(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};function bl(a,h){for(var p=0;p<a.length;p++)if(ya(h,a[p]))return!0;for(var x=0;x<h.length;x++)if(ya(a,h[x]))return!0;return!!nh(a,h)}function xs(a,h,p){return!!ya(a,h)||!!xl(h,a,p)}function Wo(a,h){if(a.length===1)return sh(h,a[0]);for(var p=0;p<h.length;p++)for(var x=h[p],E=0;E<x.length;E++)if(ya(a,x[E]))return!0;for(var P=0;P<a.length;P++)if(sh(h,a[P]))return!0;for(var R=0;R<h.length;R++)if(nh(a,h[R]))return!0;return!1}function bo(a,h,p){if(a.length>1){if(nh(a,h))return!0;for(var x=0;x<h.length;x++)if(xl(h[x],a,p))return!0}for(var E=0;E<a.length;E++)if(xl(a[E],h,p))return!0;return!1}function nh(a,h){if(a.length===0||h.length===0)return!1;for(var p=0;p<a.length-1;p++)for(var x=a[p],E=a[p+1],P=0;P<h.length-1;P++)if(ou(x,E,h[P],h[P+1]))return!0;return!1}function ou(a,h,p,x){return Xe(a,p,x)!==Xe(h,p,x)&&Xe(a,h,p)!==Xe(a,h,x)}function xl(a,h,p){var x=p*p;if(h.length===1)return a.distSqr(h[0])<x;for(var E=1;E<h.length;E++)if(au(a,h[E-1],h[E])<x)return!0;return!1}function au(a,h,p){var x=h.distSqr(p);if(x===0)return a.distSqr(h);var E=((a.x-h.x)*(p.x-h.x)+(a.y-h.y)*(p.y-h.y))/x;return a.distSqr(E<0?h:E>1?p:p.sub(h)._mult(E)._add(h))}function sh(a,h){for(var p,x,E,P=!1,R=0;R<a.length;R++)for(var O=0,k=(p=a[R]).length-1;O<p.length;k=O++)(x=p[O]).y>h.y!=(E=p[k]).y>h.y&&h.x<(E.x-x.x)*(h.y-x.y)/(E.y-x.y)+x.x&&(P=!P);return P}function ya(a,h){for(var p=!1,x=0,E=a.length-1;x<a.length;E=x++){var P=a[x],R=a[E];P.y>h.y!=R.y>h.y&&h.x<(R.x-P.x)*(h.y-P.y)/(R.y-P.y)+P.x&&(p=!p)}return p}function oh(a,h,p){var x=p[0],E=p[2];if(a.x<x.x&&h.x<x.x||a.x>E.x&&h.x>E.x||a.y<x.y&&h.y<x.y||a.y>E.y&&h.y>E.y)return!1;var P=Xe(a,h,p[0]);return P!==Xe(a,h,p[1])||P!==Xe(a,h,p[2])||P!==Xe(a,h,p[3])}function va(a,h,p){var x=h.paint.get(a).value;return x.kind==="constant"?x.value:p.programConfigurations.get(h.id).getMaxValue(a)}function Tn(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Na(a,h,p,x,E){if(!h[0]&&!h[1])return a;var P=w.convert(h)._mult(E);p==="viewport"&&P._rotate(-x);for(var R=[],O=0;O<a.length;O++)R.push(a[O].sub(P));return R}fs.prototype.populate=function(a,h,p){var x=this.layers[0],E=[],P=null;x.type==="circle"&&(P=x.layout.get("circle-sort-key"));for(var R=0,O=a;R<O.length;R+=1){var k=O[R],H=k.feature,X=k.id,q=k.index,re=k.sourceLayerIndex,ae=this.layers[0]._featureFilter.needGeometry,ve=Qi(H,ae);if(this.layers[0]._featureFilter.filter(new Jt(this.zoom),ve,p)){var xe=P?P.evaluate(ve,{},p):void 0,Be={id:X,properties:H.properties,type:H.type,sourceLayerIndex:re,index:q,geometry:ae?ve.geometry:Li(H),patterns:{},sortKey:xe};E.push(Be)}}P&&E.sort(function(wt,Ht){return wt.sortKey-Ht.sortKey});for(var Se=0,Ne=E;Se<Ne.length;Se+=1){var We=Ne[Se],Ye=We.geometry,et=We.index,ot=We.sourceLayerIndex,pt=a[et].feature;this.addFeature(We,Ye,et,p),h.featureIndex.insert(pt,Ye,et,ot,this.index)}},fs.prototype.update=function(a,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,p)},fs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fs.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,j),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fs.prototype.addFeature=function(a,h,p,x){for(var E=0,P=h;E<P.length;E+=1)for(var R=0,O=P[E];R<O.length;R+=1){var k=O[R],H=k.x,X=k.y;if(!(H<0||H>=8192||X<0||X>=8192)){var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),re=q.vertexLength;ks(this.layoutVertexArray,H,X,-1,-1),ks(this.layoutVertexArray,H,X,1,-1),ks(this.layoutVertexArray,H,X,1,1),ks(this.layoutVertexArray,H,X,-1,1),this.indexArray.emplaceBack(re,re+1,re+2),this.indexArray.emplaceBack(re,re+3,re+2),q.vertexLength+=4,q.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},x)},Ct("CircleBucket",fs,{omit:["layers"]});var wl=new bn({"circle-sort-key":new Lt(ce.layout_circle["circle-sort-key"])}),lc={paint:new bn({"circle-radius":new Lt(ce.paint_circle["circle-radius"]),"circle-color":new Lt(ce.paint_circle["circle-color"]),"circle-blur":new Lt(ce.paint_circle["circle-blur"]),"circle-opacity":new Lt(ce.paint_circle["circle-opacity"]),"circle-translate":new jt(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Lt(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Lt(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Lt(ce.paint_circle["circle-stroke-opacity"])}),layout:wl},Jr=typeof Float32Array<"u"?Float32Array:Array;function so(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ws(a,h,p){var x=h[0],E=h[1],P=h[2],R=h[3],O=h[4],k=h[5],H=h[6],X=h[7],q=h[8],re=h[9],ae=h[10],ve=h[11],xe=h[12],Be=h[13],Se=h[14],Ne=h[15],We=p[0],Ye=p[1],et=p[2],ot=p[3];return a[0]=We*x+Ye*O+et*q+ot*xe,a[1]=We*E+Ye*k+et*re+ot*Be,a[2]=We*P+Ye*H+et*ae+ot*Se,a[3]=We*R+Ye*X+et*ve+ot*Ne,a[4]=(We=p[4])*x+(Ye=p[5])*O+(et=p[6])*q+(ot=p[7])*xe,a[5]=We*E+Ye*k+et*re+ot*Be,a[6]=We*P+Ye*H+et*ae+ot*Se,a[7]=We*R+Ye*X+et*ve+ot*Ne,a[8]=(We=p[8])*x+(Ye=p[9])*O+(et=p[10])*q+(ot=p[11])*xe,a[9]=We*E+Ye*k+et*re+ot*Be,a[10]=We*P+Ye*H+et*ae+ot*Se,a[11]=We*R+Ye*X+et*ve+ot*Ne,a[12]=(We=p[12])*x+(Ye=p[13])*O+(et=p[14])*q+(ot=p[15])*xe,a[13]=We*E+Ye*k+et*re+ot*Be,a[14]=We*P+Ye*H+et*ae+ot*Se,a[15]=We*R+Ye*X+et*ve+ot*Ne,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,h=0,p=arguments.length;p--;)h+=a[p]*a[p];return Math.sqrt(h)});var cc,hy=ws;function mf(a,h,p){var x=h[0],E=h[1],P=h[2],R=h[3];return a[0]=p[0]*x+p[4]*E+p[8]*P+p[12]*R,a[1]=p[1]*x+p[5]*E+p[9]*P+p[13]*R,a[2]=p[2]*x+p[6]*E+p[10]*P+p[14]*R,a[3]=p[3]*x+p[7]*E+p[11]*P+p[15]*R,a}cc=new Jr(3),Jr!=Float32Array&&(cc[0]=0,cc[1]=0,cc[2]=0),function(){var a=new Jr(4);Jr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var fy=(function(){var a=new Jr(2);Jr!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function h(p){a.call(this,p,lc)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.createBucket=function(p){return new fs(p)},h.prototype.queryRadius=function(p){var x=p;return va("circle-radius",this,x)+va("circle-stroke-width",this,x)+Tn(this.paint.get("circle-translate"))},h.prototype.queryIntersectsFeature=function(p,x,E,P,R,O,k,H){for(var X=Na(p,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),O.angle,k),q=this.paint.get("circle-radius").evaluate(x,E)+this.paint.get("circle-stroke-width").evaluate(x,E),re=this.paint.get("circle-pitch-alignment")==="map",ae=re?X:function(pt,wt){return pt.map(function(Ht){return ah(Ht,wt)})}(X,H),ve=re?q*k:q,xe=0,Be=P;xe<Be.length;xe+=1)for(var Se=0,Ne=Be[xe];Se<Ne.length;Se+=1){var We=Ne[Se],Ye=re?We:ah(We,H),et=ve,ot=mf([],[We.x,We.y,0,1],H);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?et*=ot[3]/O.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(et*=O.cameraToCenterDistance/ot[3]),xs(ae,Ye,et))return!0}return!1},h}(po));function ah(a,h){var p=mf([],[a.x,a.y,0,1],h);return new w(p[0]/p[3],p[1]/p[3])}var x0=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(fs);function lu(a,h,p,x){var E=h.width,P=h.height;if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==E*P*p)throw new RangeError("mismatched image size")}else x=new Uint8Array(E*P*p);return a.width=E,a.height=P,a.data=x,a}function _f(a,h,p){var x=h.width,E=h.height;if(x!==a.width||E!==a.height){var P=lu({},{width:x,height:E},p);dy(a,P,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,x),height:Math.min(a.height,E)},p),a.width=x,a.height=E,a.data=P.data}}function dy(a,h,p,x,E,P){if(E.width===0||E.height===0)return h;if(E.width>a.width||E.height>a.height||p.x>a.width-E.width||p.y>a.height-E.height)throw new RangeError("out of range source coordinates for image copy");if(E.width>h.width||E.height>h.height||x.x>h.width-E.width||x.y>h.height-E.height)throw new RangeError("out of range destination coordinates for image copy");for(var R=a.data,O=h.data,k=0;k<E.height;k++)for(var H=((p.y+k)*a.width+p.x)*P,X=((x.y+k)*h.width+x.x)*P,q=0;q<E.width*P;q++)O[X+q]=R[H+q];return h}Ct("HeatmapBucket",x0,{omit:["layers"]});var lh=function(a,h){lu(this,a,1,h)};lh.prototype.resize=function(a){_f(this,a,1)},lh.prototype.clone=function(){return new lh({width:this.width,height:this.height},new Uint8Array(this.data))},lh.copy=function(a,h,p,x,E){dy(a,h,p,x,E,1)};var Ns=function(a,h){lu(this,a,4,h)};Ns.prototype.resize=function(a){_f(this,a,4)},Ns.prototype.replace=function(a,h){h?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Ns.prototype.clone=function(){return new Ns({width:this.width,height:this.height},new Uint8Array(this.data))},Ns.copy=function(a,h,p,x,E){dy(a,h,p,x,E,4)},Ct("AlphaImage",lh),Ct("RGBAImage",Ns);var GF={paint:new bn({"heatmap-radius":new Lt(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Lt(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new to(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(ce.paint_heatmap["heatmap-opacity"])})};function Vw(a){var h={},p=a.resolution||256,x=a.clips?a.clips.length:1,E=a.image||new Ns({width:p,height:x}),P=function(ve,xe,Be){h[a.evaluationKey]=Be;var Se=a.expression.evaluate(h);E.data[ve+xe+0]=Math.floor(255*Se.r/Se.a),E.data[ve+xe+1]=Math.floor(255*Se.g/Se.a),E.data[ve+xe+2]=Math.floor(255*Se.b/Se.a),E.data[ve+xe+3]=Math.floor(255*Se.a)};if(a.clips)for(var R=0,O=0;R<x;++R,O+=4*p)for(var k=0,H=0;k<p;k++,H+=4){var X=k/(p-1),q=a.clips[R];P(O,H,q.start*(1-X)+q.end*X)}else for(var re=0,ae=0;re<p;re++,ae+=4)P(0,ae,re/(p-1));return E}var WF=function(a){function h(p){a.call(this,p,GF),this._updateColorRamp()}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.createBucket=function(p){return new x0(p)},h.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="heatmap-color"&&this._updateColorRamp()},h.prototype._updateColorRamp=function(){this.colorRamp=Vw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},h.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},h.prototype.queryRadius=function(){return 0},h.prototype.queryIntersectsFeature=function(){return!1},h.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},h}(po),XF={paint:new bn({"hillshade-illumination-direction":new jt(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jt(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(ce.paint_hillshade["hillshade-accent-color"])})},qF=function(a){function h(p){a.call(this,p,XF)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},h}(po),$F=$t([{name:"a_pos",components:2,type:"Int16"}],4).members,Ay=w0,ZF=w0;function w0(a,h,p){p=p||2;var x,E,P,R,O,k,H,X=h&&h.length,q=X?h[0]*p:a.length,re=jw(a,0,q,p,!0),ae=[];if(!re||re.next===re.prev)return ae;if(X&&(re=function(xe,Be,Se,Ne){var We,Ye,et,ot=[];for(We=0,Ye=Be.length;We<Ye;We++)(et=jw(xe,Be[We]*Ne,We<Ye-1?Be[We+1]*Ne:xe.length,Ne,!1))===et.next&&(et.steiner=!0),ot.push(i6(et));for(ot.sort(e6),We=0;We<ot.length;We++)t6(ot[We],Se),Se=cu(Se,Se.next);return Se}(a,h,re,p)),a.length>80*p){x=P=a[0],E=R=a[1];for(var ve=p;ve<q;ve+=p)(O=a[ve])<x&&(x=O),(k=a[ve+1])<E&&(E=k),O>P&&(P=O),k>R&&(R=k);H=(H=Math.max(P-x,R-E))!==0?1/H:0}return xA(re,ae,p,x,E,H),ae}function jw(a,h,p,x,E){var P,R;if(E===my(a,h,p,x)>0)for(P=h;P<p;P+=x)R=Ww(P,a[P],a[P+1],R);else for(P=p-x;P>=h;P-=x)R=Ww(P,a[P],a[P+1],R);return R&&T0(R,R.next)&&(TA(R),R=R.next),R}function cu(a,h){if(!a)return a;h||(h=a);var p,x=a;do if(p=!1,x.steiner||!T0(x,x.next)&&hn(x.prev,x,x.next)!==0)x=x.next;else{if(TA(x),(x=h=x.prev)===x.next)break;p=!0}while(p||x!==h);return h}function xA(a,h,p,x,E,P,R){if(a){!R&&P&&function(X,q,re,ae){var ve=X;do ve.z===null&&(ve.z=py(ve.x,ve.y,q,re,ae)),ve.prevZ=ve.prev,ve.nextZ=ve.next,ve=ve.next;while(ve!==X);ve.prevZ.nextZ=null,ve.prevZ=null,function(xe){var Be,Se,Ne,We,Ye,et,ot,pt,wt=1;do{for(Se=xe,xe=null,Ye=null,et=0;Se;){for(et++,Ne=Se,ot=0,Be=0;Be<wt&&(ot++,Ne=Ne.nextZ);Be++);for(pt=wt;ot>0||pt>0&&Ne;)ot!==0&&(pt===0||!Ne||Se.z<=Ne.z)?(We=Se,Se=Se.nextZ,ot--):(We=Ne,Ne=Ne.nextZ,pt--),Ye?Ye.nextZ=We:xe=We,We.prevZ=Ye,Ye=We;Se=Ne}Ye.nextZ=null,wt*=2}while(et>1)}(ve)}(a,x,E,P);for(var O,k,H=a;a.prev!==a.next;)if(O=a.prev,k=a.next,P?YF(a,x,E,P):KF(a))h.push(O.i/p),h.push(a.i/p),h.push(k.i/p),TA(a),a=k.next,H=k.next;else if((a=k)===H){R?R===1?xA(a=JF(cu(a),h,p),h,p,x,E,P,2):R===2&&QF(a,h,p,x,E,P):xA(cu(a),h,p,x,E,P,1);break}}}function KF(a){var h=a.prev,p=a,x=a.next;if(hn(h,p,x)>=0)return!1;for(var E=a.next.next;E!==a.prev;){if(yf(h.x,h.y,p.x,p.y,x.x,x.y,E.x,E.y)&&hn(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function YF(a,h,p,x){var E=a.prev,P=a,R=a.next;if(hn(E,P,R)>=0)return!1;for(var O=E.x>P.x?E.x>R.x?E.x:R.x:P.x>R.x?P.x:R.x,k=E.y>P.y?E.y>R.y?E.y:R.y:P.y>R.y?P.y:R.y,H=py(E.x<P.x?E.x<R.x?E.x:R.x:P.x<R.x?P.x:R.x,E.y<P.y?E.y<R.y?E.y:R.y:P.y<R.y?P.y:R.y,h,p,x),X=py(O,k,h,p,x),q=a.prevZ,re=a.nextZ;q&&q.z>=H&&re&&re.z<=X;){if(q!==a.prev&&q!==a.next&&yf(E.x,E.y,P.x,P.y,R.x,R.y,q.x,q.y)&&hn(q.prev,q,q.next)>=0||(q=q.prevZ,re!==a.prev&&re!==a.next&&yf(E.x,E.y,P.x,P.y,R.x,R.y,re.x,re.y)&&hn(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;q&&q.z>=H;){if(q!==a.prev&&q!==a.next&&yf(E.x,E.y,P.x,P.y,R.x,R.y,q.x,q.y)&&hn(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;re&&re.z<=X;){if(re!==a.prev&&re!==a.next&&yf(E.x,E.y,P.x,P.y,R.x,R.y,re.x,re.y)&&hn(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function JF(a,h,p){var x=a;do{var E=x.prev,P=x.next.next;!T0(E,P)&&Hw(E,x,x.next,P)&&wA(E,P)&&wA(P,E)&&(h.push(E.i/p),h.push(x.i/p),h.push(P.i/p),TA(x),TA(x.next),x=a=P),x=x.next}while(x!==a);return cu(x)}function QF(a,h,p,x,E,P){var R=a;do{for(var O=R.next.next;O!==R.prev;){if(R.i!==O.i&&n6(R,O)){var k=Gw(R,O);return R=cu(R,R.next),k=cu(k,k.next),xA(R,h,p,x,E,P),void xA(k,h,p,x,E,P)}O=O.next}R=R.next}while(R!==a)}function e6(a,h){return a.x-h.x}function t6(a,h){if(h=function(x,E){var P,R=E,O=x.x,k=x.y,H=-1/0;do{if(k<=R.y&&k>=R.next.y&&R.next.y!==R.y){var X=R.x+(k-R.y)*(R.next.x-R.x)/(R.next.y-R.y);if(X<=O&&X>H){if(H=X,X===O){if(k===R.y)return R;if(k===R.next.y)return R.next}P=R.x<R.next.x?R:R.next}}R=R.next}while(R!==E);if(!P)return null;if(O===H)return P;var q,re=P,ae=P.x,ve=P.y,xe=1/0;R=P;do O>=R.x&&R.x>=ae&&O!==R.x&&yf(k<ve?O:H,k,ae,ve,k<ve?H:O,k,R.x,R.y)&&(q=Math.abs(k-R.y)/(O-R.x),wA(R,x)&&(q<xe||q===xe&&(R.x>P.x||R.x===P.x&&r6(P,R)))&&(P=R,xe=q)),R=R.next;while(R!==re);return P}(a,h)){var p=Gw(h,a);cu(h,h.next),cu(p,p.next)}}function r6(a,h){return hn(a.prev,a,h.prev)<0&&hn(h.next,a,a.next)<0}function py(a,h,p,x,E){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-p)*E)|a<<8))|a<<4))|a<<2))|a<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=32767*(h-x)*E)|h<<8))|h<<4))|h<<2))|h<<1))<<1}function i6(a){var h=a,p=a;do(h.x<p.x||h.x===p.x&&h.y<p.y)&&(p=h),h=h.next;while(h!==a);return p}function yf(a,h,p,x,E,P,R,O){return(E-R)*(h-O)-(a-R)*(P-O)>=0&&(a-R)*(x-O)-(p-R)*(h-O)>=0&&(p-R)*(P-O)-(E-R)*(x-O)>=0}function n6(a,h){return a.next.i!==h.i&&a.prev.i!==h.i&&!function(p,x){var E=p;do{if(E.i!==p.i&&E.next.i!==p.i&&E.i!==x.i&&E.next.i!==x.i&&Hw(E,E.next,p,x))return!0;E=E.next}while(E!==p);return!1}(a,h)&&(wA(a,h)&&wA(h,a)&&function(p,x){var E=p,P=!1,R=(p.x+x.x)/2,O=(p.y+x.y)/2;do E.y>O!=E.next.y>O&&E.next.y!==E.y&&R<(E.next.x-E.x)*(O-E.y)/(E.next.y-E.y)+E.x&&(P=!P),E=E.next;while(E!==p);return P}(a,h)&&(hn(a.prev,a,h.prev)||hn(a,h.prev,h))||T0(a,h)&&hn(a.prev,a,a.next)>0&&hn(h.prev,h,h.next)>0)}function hn(a,h,p){return(h.y-a.y)*(p.x-h.x)-(h.x-a.x)*(p.y-h.y)}function T0(a,h){return a.x===h.x&&a.y===h.y}function Hw(a,h,p,x){var E=S0(hn(a,h,p)),P=S0(hn(a,h,x)),R=S0(hn(p,x,a)),O=S0(hn(p,x,h));return E!==P&&R!==O||!(E!==0||!E0(a,p,h))||!(P!==0||!E0(a,x,h))||!(R!==0||!E0(p,a,x))||!(O!==0||!E0(p,h,x))}function E0(a,h,p){return h.x<=Math.max(a.x,p.x)&&h.x>=Math.min(a.x,p.x)&&h.y<=Math.max(a.y,p.y)&&h.y>=Math.min(a.y,p.y)}function S0(a){return a>0?1:a<0?-1:0}function wA(a,h){return hn(a.prev,a,a.next)<0?hn(a,h,a.next)>=0&&hn(a,a.prev,h)>=0:hn(a,h,a.prev)<0||hn(a,a.next,h)<0}function Gw(a,h){var p=new gy(a.i,a.x,a.y),x=new gy(h.i,h.x,h.y),E=a.next,P=h.prev;return a.next=h,h.prev=a,p.next=E,E.prev=p,x.next=p,p.prev=x,P.next=x,x.prev=P,x}function Ww(a,h,p,x){var E=new gy(a,h,p);return x?(E.next=x.next,E.prev=x,x.next.prev=E,x.next=E):(E.prev=E,E.next=E),E}function TA(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function gy(a,h,p){this.i=a,this.x=h,this.y=p,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function my(a,h,p,x){for(var E=0,P=h,R=p-x;P<p;P+=x)E+=(a[R]-a[P])*(a[P+1]+a[R+1]),R=P;return E}function s6(a,h,p,x,E){(function P(R,O,k,H,X){for(;H>k;){if(H-k>600){var q=H-k+1,re=O-k+1,ae=Math.log(q),ve=.5*Math.exp(2*ae/3),xe=.5*Math.sqrt(ae*ve*(q-ve)/q)*(re-q/2<0?-1:1);P(R,O,Math.max(k,Math.floor(O-re*ve/q+xe)),Math.min(H,Math.floor(O+(q-re)*ve/q+xe)),X)}var Be=R[O],Se=k,Ne=H;for(EA(R,k,O),X(R[H],Be)>0&&EA(R,k,H);Se<Ne;){for(EA(R,Se,Ne),Se++,Ne--;X(R[Se],Be)<0;)Se++;for(;X(R[Ne],Be)>0;)Ne--}X(R[k],Be)===0?EA(R,k,Ne):EA(R,++Ne,H),Ne<=O&&(k=Ne+1),O<=Ne&&(H=Ne-1)}})(a,h,p,x||a.length-1,E||o6)}function EA(a,h,p){var x=a[h];a[h]=a[p],a[p]=x}function o6(a,h){return a<h?-1:a>h?1:0}function _y(a,h){var p=a.length;if(p<=1)return[a];for(var x,E,P=[],R=0;R<p;R++){var O=dt(a[R]);O!==0&&(a[R].area=Math.abs(O),E===void 0&&(E=O<0),E===O<0?(x&&P.push(x),x=[a[R]]):x.push(a[R]))}if(x&&P.push(x),h>1)for(var k=0;k<P.length;k++)P[k].length<=h||(s6(P[k],h,1,P[k].length-1,a6),P[k]=P[k].slice(0,h));return P}function a6(a,h){return h.area-a.area}function yy(a,h,p){for(var x=p.patternDependencies,E=!1,P=0,R=h;P<R.length;P+=1){var O=R[P].paint.get(a+"-pattern");O.isConstant()||(E=!0);var k=O.constantOr(null);k&&(E=!0,x[k.to]=!0,x[k.from]=!0)}return E}function vy(a,h,p,x,E){for(var P=E.patternDependencies,R=0,O=h;R<O.length;R+=1){var k=O[R],H=k.paint.get(a+"-pattern").value;if(H.kind!=="constant"){var X=H.evaluate({zoom:x-1},p,{},E.availableImages),q=H.evaluate({zoom:x},p,{},E.availableImages),re=H.evaluate({zoom:x+1},p,{},E.availableImages);q=q&&q.name?q.name:q,re=re&&re.name?re.name:re,P[X=X&&X.name?X.name:X]=!0,P[q]=!0,P[re]=!0,p.patterns[k.id]={min:X,mid:q,max:re}}}return p}w0.deviation=function(a,h,p,x){var E=h&&h.length,P=Math.abs(my(a,0,E?h[0]*p:a.length,p));if(E)for(var R=0,O=h.length;R<O;R++)P-=Math.abs(my(a,h[R]*p,R<O-1?h[R+1]*p:a.length,p));var k=0;for(R=0;R<x.length;R+=3){var H=x[R]*p,X=x[R+1]*p,q=x[R+2]*p;k+=Math.abs((a[H]-a[q])*(a[X+1]-a[H+1])-(a[H]-a[X])*(a[q+1]-a[H+1]))}return P===0&&k===0?0:Math.abs((k-P)/P)},w0.flatten=function(a){for(var h=a[0][0].length,p={vertices:[],holes:[],dimensions:h},x=0,E=0;E<a.length;E++){for(var P=0;P<a[E].length;P++)for(var R=0;R<h;R++)p.vertices.push(a[E][P][R]);E>0&&p.holes.push(x+=a[E-1].length)}return p},Ay.default=ZF;var Ua=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Cr,this.indexArray=new yo,this.indexArray2=new m,this.programConfigurations=new nr(a.layers,a.zoom),this.segments=new z,this.segments2=new z,this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};Ua.prototype.populate=function(a,h,p){this.hasPattern=yy("fill",this.layers,h);for(var x=this.layers[0].layout.get("fill-sort-key"),E=[],P=0,R=a;P<R.length;P+=1){var O=R[P],k=O.feature,H=O.id,X=O.index,q=O.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,ae=Qi(k,re);if(this.layers[0]._featureFilter.filter(new Jt(this.zoom),ae,p)){var ve=x?x.evaluate(ae,{},p,h.availableImages):void 0,xe={id:H,properties:k.properties,type:k.type,sourceLayerIndex:q,index:X,geometry:re?ae.geometry:Li(k),patterns:{},sortKey:ve};E.push(xe)}}x&&E.sort(function(pt,wt){return pt.sortKey-wt.sortKey});for(var Be=0,Se=E;Be<Se.length;Be+=1){var Ne=Se[Be],We=Ne.geometry,Ye=Ne.index,et=Ne.sourceLayerIndex;if(this.hasPattern){var ot=vy("fill",this.layers,Ne,this.zoom,h);this.patternFeatures.push(ot)}else this.addFeature(Ne,We,Ye,p,{});h.featureIndex.insert(a[Ye].feature,We,Ye,et,this.index)}},Ua.prototype.update=function(a,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,p)},Ua.prototype.addFeatures=function(a,h,p){for(var x=0,E=this.patternFeatures;x<E.length;x+=1){var P=E[x];this.addFeature(P,P.geometry,P.index,h,p)}},Ua.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ua.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ua.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,$F),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},Ua.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ua.prototype.addFeature=function(a,h,p,x,E){for(var P=0,R=_y(h,500);P<R.length;P+=1){for(var O=R[P],k=0,H=0,X=O;H<X.length;H+=1)k+=X[H].length;for(var q=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),re=q.vertexLength,ae=[],ve=[],xe=0,Be=O;xe<Be.length;xe+=1){var Se=Be[xe];if(Se.length!==0){Se!==O[0]&&ve.push(ae.length/2);var Ne=this.segments2.prepareSegment(Se.length,this.layoutVertexArray,this.indexArray2),We=Ne.vertexLength;this.layoutVertexArray.emplaceBack(Se[0].x,Se[0].y),this.indexArray2.emplaceBack(We+Se.length-1,We),ae.push(Se[0].x),ae.push(Se[0].y);for(var Ye=1;Ye<Se.length;Ye++)this.layoutVertexArray.emplaceBack(Se[Ye].x,Se[Ye].y),this.indexArray2.emplaceBack(We+Ye-1,We+Ye),ae.push(Se[Ye].x),ae.push(Se[Ye].y);Ne.vertexLength+=Se.length,Ne.primitiveLength+=Se.length}}for(var et=Ay(ae,ve),ot=0;ot<et.length;ot+=3)this.indexArray.emplaceBack(re+et[ot],re+et[ot+1],re+et[ot+2]);q.vertexLength+=k,q.primitiveLength+=et.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,E,x)},Ct("FillBucket",Ua,{omit:["layers","patternFeatures"]});var l6=new bn({"fill-sort-key":new Lt(ce.layout_fill["fill-sort-key"])}),c6={paint:new bn({"fill-antialias":new jt(ce.paint_fill["fill-antialias"]),"fill-opacity":new Lt(ce.paint_fill["fill-opacity"]),"fill-color":new Lt(ce.paint_fill["fill-color"]),"fill-outline-color":new Lt(ce.paint_fill["fill-outline-color"]),"fill-translate":new jt(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new ac(ce.paint_fill["fill-pattern"])}),layout:l6},u6=function(a){function h(p){a.call(this,p,c6)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x);var E=this.paint._values["fill-outline-color"];E.value.kind==="constant"&&E.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},h.prototype.createBucket=function(p){return new Ua(p)},h.prototype.queryRadius=function(){return Tn(this.paint.get("fill-translate"))},h.prototype.queryIntersectsFeature=function(p,x,E,P,R,O,k){return Wo(Na(p,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),O.angle,k),P)},h.prototype.isTileClipped=function(){return!0},h}(po),h6=$t([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Xw=vf;function vf(a,h,p,x,E){this.properties={},this.extent=p,this.type=0,this._pbf=a,this._geometry=-1,this._keys=x,this._values=E,a.readFields(f6,this,h)}function f6(a,h,p){a==1?h.id=p.readVarint():a==2?function(x,E){for(var P=x.readVarint()+x.pos;x.pos<P;){var R=E._keys[x.readVarint()],O=E._values[x.readVarint()];E.properties[R]=O}}(p,h):a==3?h.type=p.readVarint():a==4&&(h._geometry=p.pos)}function d6(a){for(var h,p,x=0,E=0,P=a.length,R=P-1;E<P;R=E++)x+=((p=a[R]).x-(h=a[E]).x)*(h.y+p.y);return x}vf.types=["Unknown","Point","LineString","Polygon"],vf.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var h,p=a.readVarint()+a.pos,x=1,E=0,P=0,R=0,O=[];a.pos<p;){if(E<=0){var k=a.readVarint();x=7&k,E=k>>3}if(E--,x===1||x===2)P+=a.readSVarint(),R+=a.readSVarint(),x===1&&(h&&O.push(h),h=[]),h.push(new w(P,R));else{if(x!==7)throw new Error("unknown command "+x);h&&h.push(h[0].clone())}}return h&&O.push(h),O},vf.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var h=a.readVarint()+a.pos,p=1,x=0,E=0,P=0,R=1/0,O=-1/0,k=1/0,H=-1/0;a.pos<h;){if(x<=0){var X=a.readVarint();p=7&X,x=X>>3}if(x--,p===1||p===2)(E+=a.readSVarint())<R&&(R=E),E>O&&(O=E),(P+=a.readSVarint())<k&&(k=P),P>H&&(H=P);else if(p!==7)throw new Error("unknown command "+p)}return[R,k,O,H]},vf.prototype.toGeoJSON=function(a,h,p){var x,E,P=this.extent*Math.pow(2,p),R=this.extent*a,O=this.extent*h,k=this.loadGeometry(),H=vf.types[this.type];function X(ae){for(var ve=0;ve<ae.length;ve++){var xe=ae[ve];ae[ve]=[360*(xe.x+R)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(xe.y+O)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(x=0;x<k.length;x++)q[x]=k[x][0];X(k=q);break;case 2:for(x=0;x<k.length;x++)X(k[x]);break;case 3:for(k=function(ae){var ve=ae.length;if(ve<=1)return[ae];for(var xe,Be,Se=[],Ne=0;Ne<ve;Ne++){var We=d6(ae[Ne]);We!==0&&(Be===void 0&&(Be=We<0),Be===We<0?(xe&&Se.push(xe),xe=[ae[Ne]]):xe.push(ae[Ne]))}return xe&&Se.push(xe),Se}(k),x=0;x<k.length;x++)for(E=0;E<k[x].length;E++)X(k[x][E])}k.length===1?k=k[0]:H="Multi"+H;var re={type:"Feature",geometry:{type:H,coordinates:k},properties:this.properties};return"id"in this&&(re.id=this.id),re};var qw=$w;function $w(a,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(A6,this,h),this.length=this._features.length}function A6(a,h,p){a===15?h.version=p.readVarint():a===1?h.name=p.readString():a===5?h.extent=p.readVarint():a===2?h._features.push(p.pos):a===3?h._keys.push(p.readString()):a===4&&h._values.push(function(x){for(var E=null,P=x.readVarint()+x.pos;x.pos<P;){var R=x.readVarint()>>3;E=R===1?x.readString():R===2?x.readFloat():R===3?x.readDouble():R===4?x.readVarint64():R===5?x.readVarint():R===6?x.readSVarint():R===7?x.readBoolean():null}return E}(p))}function p6(a,h,p){if(a===3){var x=new qw(p,p.readVarint()+p.pos);x.length&&(h[x.name]=x)}}$w.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var h=this._pbf.readVarint()+this._pbf.pos;return new Xw(this._pbf,h,this.extent,this._keys,this._values)};var bf={VectorTile:function(a,h){this.layers=a.readFields(p6,{},h)},VectorTileFeature:Xw,VectorTileLayer:qw},g6=bf.VectorTileFeature.types,by=Math.pow(2,13);function SA(a,h,p,x,E,P,R,O){a.emplaceBack(h,p,2*Math.floor(x*by)+R,E*by*2,P*by*2,Math.round(O))}var za=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new go,this.indexArray=new yo,this.programConfigurations=new nr(a.layers,a.zoom),this.segments=new z,this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};function m6(a,h){return a.x===h.x&&(a.x<0||a.x>8192)||a.y===h.y&&(a.y<0||a.y>8192)}za.prototype.populate=function(a,h,p){this.features=[],this.hasPattern=yy("fill-extrusion",this.layers,h);for(var x=0,E=a;x<E.length;x+=1){var P=E[x],R=P.feature,O=P.id,k=P.index,H=P.sourceLayerIndex,X=this.layers[0]._featureFilter.needGeometry,q=Qi(R,X);if(this.layers[0]._featureFilter.filter(new Jt(this.zoom),q,p)){var re={id:O,sourceLayerIndex:H,index:k,geometry:X?q.geometry:Li(R),properties:R.properties,type:R.type,patterns:{}};this.hasPattern?this.features.push(vy("fill-extrusion",this.layers,re,this.zoom,h)):this.addFeature(re,re.geometry,k,p,{}),h.featureIndex.insert(R,re.geometry,k,H,this.index,!0)}}},za.prototype.addFeatures=function(a,h,p){for(var x=0,E=this.features;x<E.length;x+=1){var P=E[x];this.addFeature(P,P.geometry,P.index,h,p)}},za.prototype.update=function(a,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,p)},za.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},za.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},za.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,h6),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},za.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},za.prototype.addFeature=function(a,h,p,x,E){for(var P=0,R=_y(h,500);P<R.length;P+=1){for(var O=R[P],k=0,H=0,X=O;H<X.length;H+=1)k+=X[H].length;for(var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),re=0,ae=O;re<ae.length;re+=1){var ve=ae[re];if(ve.length!==0&&!((Br=ve).every(function(vr){return vr.x<0})||Br.every(function(vr){return vr.x>8192})||Br.every(function(vr){return vr.y<0})||Br.every(function(vr){return vr.y>8192})))for(var xe=0,Be=0;Be<ve.length;Be++){var Se=ve[Be];if(Be>=1){var Ne=ve[Be-1];if(!m6(Se,Ne)){q.vertexLength+4>z.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var We=Se.sub(Ne)._perp()._unit(),Ye=Ne.dist(Se);xe+Ye>32768&&(xe=0),SA(this.layoutVertexArray,Se.x,Se.y,We.x,We.y,0,0,xe),SA(this.layoutVertexArray,Se.x,Se.y,We.x,We.y,0,1,xe),SA(this.layoutVertexArray,Ne.x,Ne.y,We.x,We.y,0,0,xe+=Ye),SA(this.layoutVertexArray,Ne.x,Ne.y,We.x,We.y,0,1,xe);var et=q.vertexLength;this.indexArray.emplaceBack(et,et+2,et+1),this.indexArray.emplaceBack(et+1,et+2,et+3),q.vertexLength+=4,q.primitiveLength+=2}}}}if(q.vertexLength+k>z.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),g6[a.type]==="Polygon"){for(var ot=[],pt=[],wt=q.vertexLength,Ht=0,Mt=O;Ht<Mt.length;Ht+=1){var Xt=Mt[Ht];if(Xt.length!==0){Xt!==O[0]&&pt.push(ot.length/2);for(var Bt=0;Bt<Xt.length;Bt++){var Er=Xt[Bt];SA(this.layoutVertexArray,Er.x,Er.y,0,0,1,1,0),ot.push(Er.x),ot.push(Er.y)}}}for(var sr=Ay(ot,pt),Ut=0;Ut<sr.length;Ut+=3)this.indexArray.emplaceBack(wt+sr[Ut],wt+sr[Ut+2],wt+sr[Ut+1]);q.primitiveLength+=sr.length/3,q.vertexLength+=k}}var Br;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,E,x)},Ct("FillExtrusionBucket",za,{omit:["layers","features"]});var _6={paint:new bn({"fill-extrusion-opacity":new jt(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Lt(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ac(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Lt(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Lt(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},y6=function(a){function h(p){a.call(this,p,_6)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.createBucket=function(p){return new za(p)},h.prototype.queryRadius=function(){return Tn(this.paint.get("fill-extrusion-translate"))},h.prototype.is3D=function(){return!0},h.prototype.queryIntersectsFeature=function(p,x,E,P,R,O,k,H){var X=Na(p,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),O.angle,k),q=this.paint.get("fill-extrusion-height").evaluate(x,E),re=this.paint.get("fill-extrusion-base").evaluate(x,E),ae=function(xe,Be,Se,Ne){for(var We=[],Ye=0,et=xe;Ye<et.length;Ye+=1){var ot=et[Ye],pt=[ot.x,ot.y,0,1];mf(pt,pt,Be),We.push(new w(pt[0]/pt[3],pt[1]/pt[3]))}return We}(X,H),ve=function(xe,Be,Se,Ne){for(var We=[],Ye=[],et=Ne[8]*Be,ot=Ne[9]*Be,pt=Ne[10]*Be,wt=Ne[11]*Be,Ht=Ne[8]*Se,Mt=Ne[9]*Se,Xt=Ne[10]*Se,Bt=Ne[11]*Se,Er=0,sr=xe;Er<sr.length;Er+=1){for(var Ut=[],Br=[],vr=0,Hr=sr[Er];vr<Hr.length;vr+=1){var Kt=Hr[vr],Zr=Kt.x,Ti=Kt.y,Xi=Ne[0]*Zr+Ne[4]*Ti+Ne[12],ki=Ne[1]*Zr+Ne[5]*Ti+Ne[13],Ei=Ne[2]*Zr+Ne[6]*Ti+Ne[14],qi=Ne[3]*Zr+Ne[7]*Ti+Ne[15],En=Ei+pt,Sn=qi+wt,As=Xi+Ht,Dn=ki+Mt,ps=Ei+Xt,en=qi+Bt,Fn=new w((Xi+et)/Sn,(ki+ot)/Sn);Fn.z=En/Sn,Ut.push(Fn);var Nr=new w(As/en,Dn/en);Nr.z=ps/en,Br.push(Nr)}We.push(Ut),Ye.push(Br)}return[We,Ye]}(P,re,q,H);return function(xe,Be,Se){var Ne=1/0;Wo(Se,Be)&&(Ne=Zw(Se,Be[0]));for(var We=0;We<Be.length;We++)for(var Ye=Be[We],et=xe[We],ot=0;ot<Ye.length-1;ot++){var pt=Ye[ot],wt=[pt,Ye[ot+1],et[ot+1],et[ot],pt];bl(Se,wt)&&(Ne=Math.min(Ne,Zw(Se,wt)))}return Ne!==1/0&&Ne}(ve[0],ve[1],ae)},h}(po);function CA(a,h){return a.x*h.x+a.y*h.y}function Zw(a,h){if(a.length===1){for(var p,x=0,E=h[x++];!p||E.equals(p);)if(!(p=h[x++]))return 1/0;for(;x<h.length;x++){var P=h[x],R=a[0],O=p.sub(E),k=P.sub(E),H=R.sub(E),X=CA(O,O),q=CA(O,k),re=CA(k,k),ae=CA(H,O),ve=CA(H,k),xe=X*re-q*q,Be=(re*ae-q*ve)/xe,Se=(X*ve-q*ae)/xe,Ne=E.z*(1-Be-Se)+p.z*Be+P.z*Se;if(isFinite(Ne))return Ne}return 1/0}for(var We=1/0,Ye=0,et=h;Ye<et.length;Ye+=1)We=Math.min(We,et[Ye].z);return We}var v6=$t([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,b6=$t([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,x6=bf.VectorTileFeature.types,w6=Math.cos(Math.PI/180*37.5),Kw=Math.pow(2,14)/.5,Ts=function(a){var h=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(p){return p.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(p){h.gradients[p.id]={}}),this.layoutVertexArray=new zn,this.layoutVertexArray2=new Ls,this.indexArray=new yo,this.programConfigurations=new nr(a.layers,a.zoom),this.segments=new z,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(p){return p.isStateDependent()}).map(function(p){return p.id})};Ts.prototype.populate=function(a,h,p){this.hasPattern=yy("line",this.layers,h);for(var x=this.layers[0].layout.get("line-sort-key"),E=[],P=0,R=a;P<R.length;P+=1){var O=R[P],k=O.feature,H=O.id,X=O.index,q=O.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,ae=Qi(k,re);if(this.layers[0]._featureFilter.filter(new Jt(this.zoom),ae,p)){var ve=x?x.evaluate(ae,{},p):void 0,xe={id:H,properties:k.properties,type:k.type,sourceLayerIndex:q,index:X,geometry:re?ae.geometry:Li(k),patterns:{},sortKey:ve};E.push(xe)}}x&&E.sort(function(pt,wt){return pt.sortKey-wt.sortKey});for(var Be=0,Se=E;Be<Se.length;Be+=1){var Ne=Se[Be],We=Ne.geometry,Ye=Ne.index,et=Ne.sourceLayerIndex;if(this.hasPattern){var ot=vy("line",this.layers,Ne,this.zoom,h);this.patternFeatures.push(ot)}else this.addFeature(Ne,We,Ye,p,{});h.featureIndex.insert(a[Ye].feature,We,Ye,et,this.index)}},Ts.prototype.update=function(a,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,p)},Ts.prototype.addFeatures=function(a,h,p){for(var x=0,E=this.patternFeatures;x<E.length;x+=1){var P=E[x];this.addFeature(P,P.geometry,P.index,h,p)}},Ts.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ts.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ts.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,b6)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,v6),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ts.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ts.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Ts.prototype.addFeature=function(a,h,p,x,E){var P=this.layers[0].layout,R=P.get("line-join").evaluate(a,{}),O=P.get("line-cap"),k=P.get("line-miter-limit"),H=P.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var X=0,q=h;X<q.length;X+=1)this.addLine(q[X],a,R,O,k,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,E,x)},Ts.prototype.addLine=function(a,h,p,x,E,P){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var R=0;R<a.length-1;R++)this.totalDistance+=a[R].dist(a[R+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var O=x6[h.type]==="Polygon",k=a.length;k>=2&&a[k-1].equals(a[k-2]);)k--;for(var H=0;H<k-1&&a[H].equals(a[H+1]);)H++;if(!(k<(O?3:2))){p==="bevel"&&(E=1.05);var X,q=this.overscaling<=16?122880/(512*this.overscaling):0,re=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),ae=void 0,ve=void 0,xe=void 0,Be=void 0;this.e1=this.e2=-1,O&&(Be=a[H].sub(X=a[k-2])._unit()._perp());for(var Se=H;Se<k;Se++)if(!(ve=Se===k-1?O?a[H+1]:void 0:a[Se+1])||!a[Se].equals(ve)){Be&&(xe=Be),X&&(ae=X),X=a[Se],Be=ve?ve.sub(X)._unit()._perp():xe;var Ne=(xe=xe||Be).add(Be);Ne.x===0&&Ne.y===0||Ne._unit();var We=xe.x*Be.x+xe.y*Be.y,Ye=Ne.x*Be.x+Ne.y*Be.y,et=Ye!==0?1/Ye:1/0,ot=2*Math.sqrt(2-2*Ye),pt=Ye<w6&&ae&&ve,wt=xe.x*Be.y-xe.y*Be.x>0;if(pt&&Se>H){var Ht=X.dist(ae);if(Ht>2*q){var Mt=X.sub(X.sub(ae)._mult(q/Ht)._round());this.updateDistance(ae,Mt),this.addCurrentVertex(Mt,xe,0,0,re),ae=Mt}}var Xt=ae&&ve,Bt=Xt?p:O?"butt":x;if(Xt&&Bt==="round"&&(et<P?Bt="miter":et<=2&&(Bt="fakeround")),Bt==="miter"&&et>E&&(Bt="bevel"),Bt==="bevel"&&(et>2&&(Bt="flipbevel"),et<E&&(Bt="miter")),ae&&this.updateDistance(ae,X),Bt==="miter")Ne._mult(et),this.addCurrentVertex(X,Ne,0,0,re);else if(Bt==="flipbevel"){if(et>100)Ne=Be.mult(-1);else{var Er=et*xe.add(Be).mag()/xe.sub(Be).mag();Ne._perp()._mult(Er*(wt?-1:1))}this.addCurrentVertex(X,Ne,0,0,re),this.addCurrentVertex(X,Ne.mult(-1),0,0,re)}else if(Bt==="bevel"||Bt==="fakeround"){var sr=-Math.sqrt(et*et-1),Ut=wt?sr:0,Br=wt?0:sr;if(ae&&this.addCurrentVertex(X,xe,Ut,Br,re),Bt==="fakeround")for(var vr=Math.round(180*ot/Math.PI/20),Hr=1;Hr<vr;Hr++){var Kt=Hr/vr;if(Kt!==.5){var Zr=Kt-.5;Kt+=Kt*Zr*(Kt-1)*((1.0904+We*(We*(3.55645-1.43519*We)-3.2452))*Zr*Zr+(.848013+We*(.215638*We-1.06021)))}var Ti=Be.sub(xe)._mult(Kt)._add(xe)._unit()._mult(wt?-1:1);this.addHalfVertex(X,Ti.x,Ti.y,!1,wt,0,re)}ve&&this.addCurrentVertex(X,Be,-Ut,-Br,re)}else if(Bt==="butt")this.addCurrentVertex(X,Ne,0,0,re);else if(Bt==="square"){var Xi=ae?1:-1;this.addCurrentVertex(X,Ne,Xi,Xi,re)}else Bt==="round"&&(ae&&(this.addCurrentVertex(X,xe,0,0,re),this.addCurrentVertex(X,xe,1,1,re,!0)),ve&&(this.addCurrentVertex(X,Be,-1,-1,re,!0),this.addCurrentVertex(X,Be,0,0,re)));if(pt&&Se<k-1){var ki=X.dist(ve);if(ki>2*q){var Ei=X.add(ve.sub(X)._mult(q/ki)._round());this.updateDistance(X,Ei),this.addCurrentVertex(Ei,Be,0,0,re),X=Ei}}}}},Ts.prototype.addCurrentVertex=function(a,h,p,x,E,P){P===void 0&&(P=!1);var R=h.y*x-h.x,O=-h.y-h.x*x;this.addHalfVertex(a,h.x+h.y*p,h.y-h.x*p,P,!1,p,E),this.addHalfVertex(a,R,O,P,!0,-x,E),this.distance>Kw/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,h,p,x,E,P))},Ts.prototype.addHalfVertex=function(a,h,p,x,E,P,R){var O=.5*(this.lineClips?this.scaledDistance*(Kw-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(x?1:0),(a.y<<1)+(E?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(P===0?0:P<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),R.primitiveLength++),E?this.e2=k:this.e1=k},Ts.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ts.prototype.updateDistance=function(a,h){this.distance+=a.dist(h),this.updateScaledDistance()},Ct("LineBucket",Ts,{omit:["layers","patternFeatures"]});var T6=new bn({"line-cap":new jt(ce.layout_line["line-cap"]),"line-join":new Lt(ce.layout_line["line-join"]),"line-miter-limit":new jt(ce.layout_line["line-miter-limit"]),"line-round-limit":new jt(ce.layout_line["line-round-limit"]),"line-sort-key":new Lt(ce.layout_line["line-sort-key"])}),Yw={paint:new bn({"line-opacity":new Lt(ce.paint_line["line-opacity"]),"line-color":new Lt(ce.paint_line["line-color"]),"line-translate":new jt(ce.paint_line["line-translate"]),"line-translate-anchor":new jt(ce.paint_line["line-translate-anchor"]),"line-width":new Lt(ce.paint_line["line-width"]),"line-gap-width":new Lt(ce.paint_line["line-gap-width"]),"line-offset":new Lt(ce.paint_line["line-offset"]),"line-blur":new Lt(ce.paint_line["line-blur"]),"line-dasharray":new Un(ce.paint_line["line-dasharray"]),"line-pattern":new ac(ce.paint_line["line-pattern"]),"line-gradient":new to(ce.paint_line["line-gradient"])}),layout:T6},Jw=new(function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.possiblyEvaluate=function(p,x){return x=new Jt(Math.floor(x.zoom),{now:x.now,fadeDuration:x.fadeDuration,zoomHistory:x.zoomHistory,transition:x.transition}),a.prototype.possiblyEvaluate.call(this,p,x)},h.prototype.evaluate=function(p,x,E,P){return x=Y({},x,{zoom:Math.floor(x.zoom)}),a.prototype.evaluate.call(this,p,x,E,P)},h}(Lt))(Yw.paint.properties["line-width"].specification);Jw.useIntegerZoom=!0;var E6=function(a){function h(p){a.call(this,p,Yw),this.gradientVersion=0}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof os,this.gradientVersion=(this.gradientVersion+1)%B)},h.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},h.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x),this.paint._values["line-floorwidth"]=Jw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,p)},h.prototype.createBucket=function(p){return new Ts(p)},h.prototype.queryRadius=function(p){var x=p,E=Qw(va("line-width",this,x),va("line-gap-width",this,x)),P=va("line-offset",this,x);return E/2+Math.abs(P)+Tn(this.paint.get("line-translate"))},h.prototype.queryIntersectsFeature=function(p,x,E,P,R,O,k){var H=Na(p,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),O.angle,k),X=k/2*Qw(this.paint.get("line-width").evaluate(x,E),this.paint.get("line-gap-width").evaluate(x,E)),q=this.paint.get("line-offset").evaluate(x,E);return q&&(P=function(re,ae){for(var ve=[],xe=new w(0,0),Be=0;Be<re.length;Be++){for(var Se=re[Be],Ne=[],We=0;We<Se.length;We++){var Ye=Se[We],et=Se[We+1],ot=We===0?xe:Ye.sub(Se[We-1])._unit()._perp(),pt=We===Se.length-1?xe:et.sub(Ye)._unit()._perp(),wt=ot._add(pt)._unit();wt._mult(1/(wt.x*pt.x+wt.y*pt.y)),Ne.push(wt._mult(ae)._add(Ye))}ve.push(Ne)}return ve}(P,q*k)),function(re,ae,ve){for(var xe=0;xe<ae.length;xe++){var Be=ae[xe];if(re.length>=3){for(var Se=0;Se<Be.length;Se++)if(ya(re,Be[Se]))return!0}if(bo(re,Be,ve))return!0}return!1}(H,P,X)},h.prototype.isTileClipped=function(){return!0},h}(po);function Qw(a,h){return h>0?h+2*a:a}var S6=$t([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),C6=$t([{name:"a_projected_pos",components:3,type:"Float32"}],4),P6=($t([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),$t([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),eT=($t([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),$t([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),I6=$t([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function M6(a,h,p){return a.sections.forEach(function(x){x.text=function(E,P,R){var O=P.layout.get("text-transform").evaluate(R,{});return O==="uppercase"?E=E.toLocaleUpperCase():O==="lowercase"&&(E=E.toLocaleLowerCase()),us.applyArabicShaping&&(E=us.applyArabicShaping(E)),E}(x.text,h,p)}),a}$t([{name:"triangle",components:3,type:"Uint16"}]),$t([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),$t([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),$t([{type:"Float32",name:"offsetX"}]),$t([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var PA={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},tT=function(a,h,p,x,E){var P,R,O=8*E-x-1,k=(1<<O)-1,H=k>>1,X=-7,q=E-1,re=-1,ae=a[h+q];for(q+=re,P=ae&(1<<-X)-1,ae>>=-X,X+=O;X>0;P=256*P+a[h+q],q+=re,X-=8);for(R=P&(1<<-X)-1,P>>=-X,X+=x;X>0;R=256*R+a[h+q],q+=re,X-=8);if(P===0)P=1-H;else{if(P===k)return R?NaN:1/0*(ae?-1:1);R+=Math.pow(2,x),P-=H}return(ae?-1:1)*R*Math.pow(2,P-x)},rT=function(a,h,p,x,E,P){var R,O,k,H=8*P-E-1,X=(1<<H)-1,q=X>>1,re=E===23?Math.pow(2,-24)-Math.pow(2,-77):0,ae=0,ve=1,xe=h<0||h===0&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(O=isNaN(h)?1:0,R=X):(R=Math.floor(Math.log(h)/Math.LN2),h*(k=Math.pow(2,-R))<1&&(R--,k*=2),(h+=R+q>=1?re/k:re*Math.pow(2,1-q))*k>=2&&(R++,k/=2),R+q>=X?(O=0,R=X):R+q>=1?(O=(h*k-1)*Math.pow(2,E),R+=q):(O=h*Math.pow(2,q-1)*Math.pow(2,E),R=0));E>=8;a[p+ae]=255&O,ae+=ve,O/=256,E-=8);for(R=R<<E|O,H+=E;H>0;a[p+ae]=255&R,ae+=ve,R/=256,H-=8);a[p+ae-ve]|=128*xe},C0=pi;function pi(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}pi.Varint=0,pi.Fixed64=1,pi.Bytes=2,pi.Fixed32=5;var iT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function uc(a){return a.type===pi.Bytes?a.readVarint()+a.pos:a.pos+1}function xf(a,h,p){return p?4294967296*h+(a>>>0):4294967296*(h>>>0)+(a>>>0)}function nT(a,h,p){var x=h<=16383?1:h<=2097151?2:h<=268435455?3:Math.floor(Math.log(h)/(7*Math.LN2));p.realloc(x);for(var E=p.pos-1;E>=a;E--)p.buf[E+x]=p.buf[E]}function R6(a,h){for(var p=0;p<a.length;p++)h.writeVarint(a[p])}function B6(a,h){for(var p=0;p<a.length;p++)h.writeSVarint(a[p])}function O6(a,h){for(var p=0;p<a.length;p++)h.writeFloat(a[p])}function D6(a,h){for(var p=0;p<a.length;p++)h.writeDouble(a[p])}function F6(a,h){for(var p=0;p<a.length;p++)h.writeBoolean(a[p])}function L6(a,h){for(var p=0;p<a.length;p++)h.writeFixed32(a[p])}function k6(a,h){for(var p=0;p<a.length;p++)h.writeSFixed32(a[p])}function N6(a,h){for(var p=0;p<a.length;p++)h.writeFixed64(a[p])}function U6(a,h){for(var p=0;p<a.length;p++)h.writeSFixed64(a[p])}function P0(a,h){return(a[h]|a[h+1]<<8|a[h+2]<<16)+16777216*a[h+3]}function wf(a,h,p){a[p]=h,a[p+1]=h>>>8,a[p+2]=h>>>16,a[p+3]=h>>>24}function sT(a,h){return(a[h]|a[h+1]<<8|a[h+2]<<16)+(a[h+3]<<24)}function z6(a,h,p){a===1&&p.readMessage(V6,h)}function V6(a,h,p){if(a===3){var x=p.readMessage(j6,{}),E=x.width,P=x.height,R=x.left,O=x.top,k=x.advance;h.push({id:x.id,bitmap:new lh({width:E+6,height:P+6},x.bitmap),metrics:{width:E,height:P,left:R,top:O,advance:k}})}}function j6(a,h,p){a===1?h.id=p.readVarint():a===2?h.bitmap=p.readBytes():a===3?h.width=p.readVarint():a===4?h.height=p.readVarint():a===5?h.left=p.readSVarint():a===6?h.top=p.readSVarint():a===7&&(h.advance=p.readVarint())}function oT(a){for(var h=0,p=0,x=0,E=a;x<E.length;x+=1){var P=E[x];h+=P.w*P.h,p=Math.max(p,P.w)}a.sort(function(xe,Be){return Be.h-xe.h});for(var R=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(h/.95)),p),h:1/0}],O=0,k=0,H=0,X=a;H<X.length;H+=1)for(var q=X[H],re=R.length-1;re>=0;re--){var ae=R[re];if(!(q.w>ae.w||q.h>ae.h)){if(q.x=ae.x,q.y=ae.y,k=Math.max(k,q.y+q.h),O=Math.max(O,q.x+q.w),q.w===ae.w&&q.h===ae.h){var ve=R.pop();re<R.length&&(R[re]=ve)}else q.h===ae.h?(ae.x+=q.w,ae.w-=q.w):q.w===ae.w?(ae.y+=q.h,ae.h-=q.h):(R.push({x:ae.x+q.w,y:ae.y,w:ae.w-q.w,h:q.h}),ae.y+=q.h,ae.h-=q.h);break}}return{w:O,h:k,fill:h/(O*k)||0}}pi.prototype={destroy:function(){this.buf=null},readFields:function(a,h,p){for(p=p||this.length;this.pos<p;){var x=this.readVarint(),E=x>>3,P=this.pos;this.type=7&x,a(E,h,this),this.pos===P&&this.skip(x)}return h},readMessage:function(a,h){return this.readFields(a,h,this.readVarint()+this.pos)},readFixed32:function(){var a=P0(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=sT(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=P0(this.buf,this.pos)+4294967296*P0(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=P0(this.buf,this.pos)+4294967296*sT(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=tT(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=tT(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var h,p,x=this.buf;return h=127&(p=x[this.pos++]),p<128?h:(h|=(127&(p=x[this.pos++]))<<7,p<128?h:(h|=(127&(p=x[this.pos++]))<<14,p<128?h:(h|=(127&(p=x[this.pos++]))<<21,p<128?h:function(E,P,R){var O,k,H=R.buf;if(O=(112&(k=H[R.pos++]))>>4,k<128||(O|=(127&(k=H[R.pos++]))<<3,k<128)||(O|=(127&(k=H[R.pos++]))<<10,k<128)||(O|=(127&(k=H[R.pos++]))<<17,k<128)||(O|=(127&(k=H[R.pos++]))<<24,k<128)||(O|=(1&(k=H[R.pos++]))<<31,k<128))return xf(E,O,P);throw new Error("Expected varint not more than 10 bytes")}(h|=(15&(p=x[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,h=this.pos;return this.pos=a,a-h>=12&&iT?function(p,x,E){return iT.decode(p.subarray(x,E))}(this.buf,h,a):function(p,x,E){for(var P="",R=x;R<E;){var O,k,H,X=p[R],q=null,re=X>239?4:X>223?3:X>191?2:1;if(R+re>E)break;re===1?X<128&&(q=X):re===2?(192&(O=p[R+1]))==128&&(q=(31&X)<<6|63&O)<=127&&(q=null):re===3?(k=p[R+2],(192&(O=p[R+1]))==128&&(192&k)==128&&((q=(15&X)<<12|(63&O)<<6|63&k)<=2047||q>=55296&&q<=57343)&&(q=null)):re===4&&(k=p[R+2],H=p[R+3],(192&(O=p[R+1]))==128&&(192&k)==128&&(192&H)==128&&((q=(15&X)<<18|(63&O)<<12|(63&k)<<6|63&H)<=65535||q>=1114112)&&(q=null)),q===null?(q=65533,re=1):q>65535&&(q-=65536,P+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),P+=String.fromCharCode(q),R+=re}return P}(this.buf,h,a)},readBytes:function(){var a=this.readVarint()+this.pos,h=this.buf.subarray(this.pos,a);return this.pos=a,h},readPackedVarint:function(a,h){if(this.type!==pi.Bytes)return a.push(this.readVarint(h));var p=uc(this);for(a=a||[];this.pos<p;)a.push(this.readVarint(h));return a},readPackedSVarint:function(a){if(this.type!==pi.Bytes)return a.push(this.readSVarint());var h=uc(this);for(a=a||[];this.pos<h;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==pi.Bytes)return a.push(this.readBoolean());var h=uc(this);for(a=a||[];this.pos<h;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==pi.Bytes)return a.push(this.readFloat());var h=uc(this);for(a=a||[];this.pos<h;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==pi.Bytes)return a.push(this.readDouble());var h=uc(this);for(a=a||[];this.pos<h;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==pi.Bytes)return a.push(this.readFixed32());var h=uc(this);for(a=a||[];this.pos<h;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==pi.Bytes)return a.push(this.readSFixed32());var h=uc(this);for(a=a||[];this.pos<h;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==pi.Bytes)return a.push(this.readFixed64());var h=uc(this);for(a=a||[];this.pos<h;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==pi.Bytes)return a.push(this.readSFixed64());var h=uc(this);for(a=a||[];this.pos<h;)a.push(this.readSFixed64());return a},skip:function(a){var h=7&a;if(h===pi.Varint)for(;this.buf[this.pos++]>127;);else if(h===pi.Bytes)this.pos=this.readVarint()+this.pos;else if(h===pi.Fixed32)this.pos+=4;else{if(h!==pi.Fixed64)throw new Error("Unimplemented type: "+h);this.pos+=8}},writeTag:function(a,h){this.writeVarint(a<<3|h)},realloc:function(a){for(var h=this.length||16;h<this.pos+a;)h*=2;if(h!==this.length){var p=new Uint8Array(h);p.set(this.buf),this.buf=p,this.length=h}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),wf(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),wf(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),wf(this.buf,-1&a,this.pos),wf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),wf(this.buf,-1&a,this.pos),wf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(h,p){var x,E;if(h>=0?(x=h%4294967296|0,E=h/4294967296|0):(E=~(-h/4294967296),4294967295^(x=~(-h%4294967296))?x=x+1|0:(x=0,E=E+1|0)),h>=18446744073709552e3||h<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),function(P,R,O){O.buf[O.pos++]=127&P|128,P>>>=7,O.buf[O.pos++]=127&P|128,P>>>=7,O.buf[O.pos++]=127&P|128,P>>>=7,O.buf[O.pos++]=127&P|128,O.buf[O.pos]=127&(P>>>=7)}(x,0,p),function(P,R){var O=(7&P)<<4;R.buf[R.pos++]|=O|((P>>>=3)?128:0),P&&(R.buf[R.pos++]=127&P|((P>>>=7)?128:0),P&&(R.buf[R.pos++]=127&P|((P>>>=7)?128:0),P&&(R.buf[R.pos++]=127&P|((P>>>=7)?128:0),P&&(R.buf[R.pos++]=127&P|((P>>>=7)?128:0),P&&(R.buf[R.pos++]=127&P)))))}(E,p)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var h=this.pos;this.pos=function(x,E,P){for(var R,O,k=0;k<E.length;k++){if((R=E.charCodeAt(k))>55295&&R<57344){if(!O){R>56319||k+1===E.length?(x[P++]=239,x[P++]=191,x[P++]=189):O=R;continue}if(R<56320){x[P++]=239,x[P++]=191,x[P++]=189,O=R;continue}R=O-55296<<10|R-56320|65536,O=null}else O&&(x[P++]=239,x[P++]=191,x[P++]=189,O=null);R<128?x[P++]=R:(R<2048?x[P++]=R>>6|192:(R<65536?x[P++]=R>>12|224:(x[P++]=R>>18|240,x[P++]=R>>12&63|128),x[P++]=R>>6&63|128),x[P++]=63&R|128)}return P}(this.buf,a,this.pos);var p=this.pos-h;p>=128&&nT(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p},writeFloat:function(a){this.realloc(4),rT(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),rT(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var h=a.length;this.writeVarint(h),this.realloc(h);for(var p=0;p<h;p++)this.buf[this.pos++]=a[p]},writeRawMessage:function(a,h){this.pos++;var p=this.pos;a(h,this);var x=this.pos-p;x>=128&&nT(p,x,this),this.pos=p-1,this.writeVarint(x),this.pos+=x},writeMessage:function(a,h,p){this.writeTag(a,pi.Bytes),this.writeRawMessage(h,p)},writePackedVarint:function(a,h){h.length&&this.writeMessage(a,R6,h)},writePackedSVarint:function(a,h){h.length&&this.writeMessage(a,B6,h)},writePackedBoolean:function(a,h){h.length&&this.writeMessage(a,F6,h)},writePackedFloat:function(a,h){h.length&&this.writeMessage(a,O6,h)},writePackedDouble:function(a,h){h.length&&this.writeMessage(a,D6,h)},writePackedFixed32:function(a,h){h.length&&this.writeMessage(a,L6,h)},writePackedSFixed32:function(a,h){h.length&&this.writeMessage(a,k6,h)},writePackedFixed64:function(a,h){h.length&&this.writeMessage(a,N6,h)},writePackedSFixed64:function(a,h){h.length&&this.writeMessage(a,U6,h)},writeBytesField:function(a,h){this.writeTag(a,pi.Bytes),this.writeBytes(h)},writeFixed32Field:function(a,h){this.writeTag(a,pi.Fixed32),this.writeFixed32(h)},writeSFixed32Field:function(a,h){this.writeTag(a,pi.Fixed32),this.writeSFixed32(h)},writeFixed64Field:function(a,h){this.writeTag(a,pi.Fixed64),this.writeFixed64(h)},writeSFixed64Field:function(a,h){this.writeTag(a,pi.Fixed64),this.writeSFixed64(h)},writeVarintField:function(a,h){this.writeTag(a,pi.Varint),this.writeVarint(h)},writeSVarintField:function(a,h){this.writeTag(a,pi.Varint),this.writeSVarint(h)},writeStringField:function(a,h){this.writeTag(a,pi.Bytes),this.writeString(h)},writeFloatField:function(a,h){this.writeTag(a,pi.Fixed32),this.writeFloat(h)},writeDoubleField:function(a,h){this.writeTag(a,pi.Fixed64),this.writeDouble(h)},writeBooleanField:function(a,h){this.writeVarintField(a,!!h)}};var I0=function(a,h){var p=h.pixelRatio,x=h.version,E=h.stretchX,P=h.stretchY,R=h.content;this.paddedRect=a,this.pixelRatio=p,this.stretchX=E,this.stretchY=P,this.content=R,this.version=x},IA={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};IA.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},IA.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},IA.tlbr.get=function(){return this.tl.concat(this.br)},IA.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(I0.prototype,IA);var MA=function(a,h){var p={},x={};this.haveRenderCallbacks=[];var E=[];this.addImages(a,p,E),this.addImages(h,x,E);var P=oT(E),R=new Ns({width:P.w||1,height:P.h||1});for(var O in a){var k=a[O],H=p[O].paddedRect;Ns.copy(k.data,R,{x:0,y:0},{x:H.x+1,y:H.y+1},k.data)}for(var X in h){var q=h[X],re=x[X].paddedRect,ae=re.x+1,ve=re.y+1,xe=q.data.width,Be=q.data.height;Ns.copy(q.data,R,{x:0,y:0},{x:ae,y:ve},q.data),Ns.copy(q.data,R,{x:0,y:Be-1},{x:ae,y:ve-1},{width:xe,height:1}),Ns.copy(q.data,R,{x:0,y:0},{x:ae,y:ve+Be},{width:xe,height:1}),Ns.copy(q.data,R,{x:xe-1,y:0},{x:ae-1,y:ve},{width:1,height:Be}),Ns.copy(q.data,R,{x:0,y:0},{x:ae+xe,y:ve},{width:1,height:Be})}this.image=R,this.iconPositions=p,this.patternPositions=x};MA.prototype.addImages=function(a,h,p){for(var x in a){var E=a[x],P={x:0,y:0,w:E.data.width+2,h:E.data.height+2};p.push(P),h[x]=new I0(P,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(x)}},MA.prototype.patchUpdatedImages=function(a,h){for(var p in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[p],a.getImage(p),h),this.patchUpdatedImage(this.patternPositions[p],a.getImage(p),h)},MA.prototype.patchUpdatedImage=function(a,h,p){if(a&&h&&a.version!==h.version){a.version=h.version;var x=a.tl;p.update(h.data,void 0,{x:x[0],y:x[1]})}},Ct("ImagePosition",I0),Ct("ImageAtlas",MA);var xo={horizontal:1,vertical:2,horizontalOnly:3},Tf=function(){this.scale=1,this.fontStack="",this.imageName=null};Tf.forText=function(a,h){var p=new Tf;return p.scale=a||1,p.fontStack=h,p},Tf.forImage=function(a){var h=new Tf;return h.imageName=a,h};var ds=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function M0(a,h,p,x,E,P,R,O,k,H,X,q,re,ae,ve,xe){var Be,Se=ds.fromFeature(a,E);q===xo.vertical&&Se.verticalizePunctuation();var Ne=us.processBidirectionalText,We=us.processStyledBidirectionalText;if(Ne&&Se.sections.length===1){Be=[];for(var Ye=0,et=Ne(Se.toString(),xy(Se,H,P,h,x,ae,ve));Ye<et.length;Ye+=1){var ot=et[Ye],pt=new ds;pt.text=ot,pt.sections=Se.sections;for(var wt=0;wt<ot.length;wt++)pt.sectionIndex.push(0);Be.push(pt)}}else if(We){Be=[];for(var Ht=0,Mt=We(Se.text,Se.sectionIndex,xy(Se,H,P,h,x,ae,ve));Ht<Mt.length;Ht+=1){var Xt=Mt[Ht],Bt=new ds;Bt.text=Xt[0],Bt.sectionIndex=Xt[1],Bt.sections=Se.sections,Be.push(Bt)}}else Be=function(Ut,Br){for(var vr=[],Hr=Ut.text,Kt=0,Zr=0,Ti=Br;Zr<Ti.length;Zr+=1){var Xi=Ti[Zr];vr.push(Ut.substring(Kt,Xi)),Kt=Xi}return Kt<Hr.length&&vr.push(Ut.substring(Kt,Hr.length)),vr}(Se,xy(Se,H,P,h,x,ae,ve));var Er=[],sr={positionedLines:Er,text:Se.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(Ut,Br,vr,Hr,Kt,Zr,Ti,Xi,ki,Ei,qi,En){for(var Sn=0,As=-17,Dn=0,ps=0,en=Xi==="right"?1:Xi==="left"?0:.5,Fn=0,Nr=0,ci=Kt;Nr<ci.length;Nr+=1){var ri=ci[Nr];ri.trim();var Xr=ri.getMaxScale(),Es=24*(Xr-1),Qn={positionedGlyphs:[],lineOffset:0};Ut.positionedLines[Fn]=Qn;var bi=Qn.positionedGlyphs,sn=0;if(ri.length()){for(var es=0;es<ri.length();es++){var Kr=ri.getSection(es),Tl=ri.getSectionIndex(es),wo=ri.getCharCode(es),El=0,tn=null,Sl=null,ba=null,Bf=24,fh=!(ki===xo.horizontal||!qi&&!sc(wo)||qi&&(R0[wo]||(Ac=wo,bt.Arabic(Ac)||bt["Arabic Supplement"](Ac)||bt["Arabic Extended-A"](Ac)||bt["Arabic Presentation Forms-A"](Ac)||bt["Arabic Presentation Forms-B"](Ac))));if(Kr.imageName){var Of=Hr[Kr.imageName];if(!Of)continue;ba=Kr.imageName,Ut.iconsInText=Ut.iconsInText||!0,Sl=Of.paddedRect;var dc=Of.displaySize;Kr.scale=24*Kr.scale/En,El=Es+(24-dc[1]*Kr.scale),Bf=(tn={width:dc[0],height:dc[1],left:1,top:-3,advance:fh?dc[1]:dc[0]}).advance;var Df=fh?dc[0]*Kr.scale-24*Xr:dc[1]*Kr.scale-24*Xr;Df>0&&Df>sn&&(sn=Df)}else{var z0=vr[Kr.fontStack],Ff=z0&&z0[wo];if(Ff&&Ff.rect)Sl=Ff.rect,tn=Ff.metrics;else{var OA=Br[Kr.fontStack],V0=OA&&OA[wo];if(!V0)continue;tn=V0.metrics}El=24*(Xr-Kr.scale)}fh?(Ut.verticalizable=!0,bi.push({glyph:wo,imageName:ba,x:Sn,y:As+El,vertical:fh,scale:Kr.scale,fontStack:Kr.fontStack,sectionIndex:Tl,metrics:tn,rect:Sl}),Sn+=Bf*Kr.scale+Ei):(bi.push({glyph:wo,imageName:ba,x:Sn,y:As+El,vertical:fh,scale:Kr.scale,fontStack:Kr.fontStack,sectionIndex:Tl,metrics:tn,rect:Sl}),Sn+=tn.advance*Kr.scale+Ei)}bi.length!==0&&(Dn=Math.max(Sn-Ei,Dn),G6(bi,0,bi.length-1,en,sn)),Sn=0;var j0=Zr*Xr+sn;Qn.lineOffset=Math.max(sn,Es),As+=j0,ps=Math.max(j0,ps),++Fn}else As+=Zr,++Fn}var Ac,DA=As- -17,Lf=wy(Ti),hu=Lf.horizontalAlign,kf=Lf.verticalAlign;(function(H0,G0,FA,LA,W0,kA,NA,UA,X0){var Nf,q0=(G0-FA)*W0;Nf=kA!==NA?-UA*LA- -17:(-LA*X0+.5)*NA;for(var Uf=0,zA=H0;Uf<zA.length;Uf+=1)for(var dh=0,VA=zA[Uf].positionedGlyphs;dh<VA.length;dh+=1){var zf=VA[dh];zf.x+=q0,zf.y+=Nf}})(Ut.positionedLines,en,hu,kf,Dn,ps,Zr,DA,Kt.length),Ut.top+=-kf*DA,Ut.bottom=Ut.top+DA,Ut.left+=-hu*Dn,Ut.right=Ut.left+Dn}(sr,h,p,x,Be,R,O,k,q,H,re,xe),!function(Ut){for(var Br=0,vr=Ut;Br<vr.length;Br+=1)if(vr[Br].positionedGlyphs.length!==0)return!1;return!0}(Er)&&sr}ds.fromFeature=function(a,h){for(var p=new ds,x=0;x<a.sections.length;x++){var E=a.sections[x];E.image?p.addImageSection(E):p.addTextSection(E,h)}return p},ds.prototype.length=function(){return this.text.length},ds.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},ds.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},ds.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},ds.prototype.verticalizePunctuation=function(){this.text=function(a){for(var h="",p=0;p<a.length;p++){var x=a.charCodeAt(p+1)||null,E=a.charCodeAt(p-1)||null;h+=x&&eh(x)&&!PA[a[p+1]]||E&&eh(E)&&!PA[a[p-1]]||!PA[a[p]]?a[p]:PA[a[p]]}return h}(this.text)},ds.prototype.trim=function(){for(var a=0,h=0;h<this.text.length&&R0[this.text.charCodeAt(h)];h++)a++;for(var p=this.text.length,x=this.text.length-1;x>=0&&x>=a&&R0[this.text.charCodeAt(x)];x--)p--;this.text=this.text.substring(a,p),this.sectionIndex=this.sectionIndex.slice(a,p)},ds.prototype.substring=function(a,h){var p=new ds;return p.text=this.text.substring(a,h),p.sectionIndex=this.sectionIndex.slice(a,h),p.sections=this.sections,p},ds.prototype.toString=function(){return this.text},ds.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(h,p){return Math.max(h,a.sections[p].scale)},0)},ds.prototype.addTextSection=function(a,h){this.text+=a.text,this.sections.push(Tf.forText(a.scale,a.fontStack||h));for(var p=this.sections.length-1,x=0;x<a.text.length;++x)this.sectionIndex.push(p)},ds.prototype.addImageSection=function(a){var h=a.image?a.image.name:"";if(h.length!==0){var p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Tf.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Ve("Reached maximum number of images 6401")}else Ve("Can't add FormattedSection with an empty image.")},ds.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var R0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},oo={};function aT(a,h,p,x,E,P){if(h.imageName){var R=x[h.imageName];return R?R.displaySize[0]*h.scale*24/P+E:0}var O=p[h.fontStack],k=O&&O[a];return k?k.metrics.advance*h.scale+E:0}function lT(a,h,p,x){var E=Math.pow(a-h,2);return x?a<h?E/2:2*E:E+Math.abs(p)*p}function H6(a,h,p){var x=0;return a===10&&(x-=1e4),p&&(x+=150),a!==40&&a!==65288||(x+=50),h!==41&&h!==65289||(x+=50),x}function cT(a,h,p,x,E,P){for(var R=null,O=lT(h,p,E,P),k=0,H=x;k<H.length;k+=1){var X=H[k],q=lT(h-X.x,p,E,P)+X.badness;q<=O&&(R=X,O=q)}return{index:a,x:h,priorBreak:R,badness:O}}function xy(a,h,p,x,E,P,R){if(P!=="point")return[];if(!a)return[];for(var O,k=[],H=function(Be,Se,Ne,We,Ye,et){for(var ot=0,pt=0;pt<Be.length();pt++){var wt=Be.getSection(pt);ot+=aT(Be.getCharCode(pt),wt,We,Ye,Se,et)}return ot/Math.max(1,Math.ceil(ot/Ne))}(a,h,p,x,E,R),X=a.text.indexOf("")>=0,q=0,re=0;re<a.length();re++){var ae=a.getSection(re),ve=a.getCharCode(re);if(R0[ve]||(q+=aT(ve,ae,x,E,h,R)),re<a.length()-1){var xe=!((O=ve)<11904||!(bt["Bopomofo Extended"](O)||bt.Bopomofo(O)||bt["CJK Compatibility Forms"](O)||bt["CJK Compatibility Ideographs"](O)||bt["CJK Compatibility"](O)||bt["CJK Radicals Supplement"](O)||bt["CJK Strokes"](O)||bt["CJK Symbols and Punctuation"](O)||bt["CJK Unified Ideographs Extension A"](O)||bt["CJK Unified Ideographs"](O)||bt["Enclosed CJK Letters and Months"](O)||bt["Halfwidth and Fullwidth Forms"](O)||bt.Hiragana(O)||bt["Ideographic Description Characters"](O)||bt["Kangxi Radicals"](O)||bt["Katakana Phonetic Extensions"](O)||bt.Katakana(O)||bt["Vertical Forms"](O)||bt["Yi Radicals"](O)||bt["Yi Syllables"](O)));(oo[ve]||xe||ae.imageName)&&k.push(cT(re+1,q,H,k,H6(ve,a.getCharCode(re+1),xe&&X),!1))}}return function Be(Se){return Se?Be(Se.priorBreak).concat(Se.index):[]}(cT(a.length(),q,H,k,0,!0))}function wy(a){var h=.5,p=.5;switch(a){case"right":case"top-right":case"bottom-right":h=1;break;case"left":case"top-left":case"bottom-left":h=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":p=1;break;case"top":case"top-right":case"top-left":p=0}return{horizontalAlign:h,verticalAlign:p}}function G6(a,h,p,x,E){if(x||E)for(var P=a[p],R=(a[p].x+P.metrics.advance*P.scale)*x,O=h;O<=p;O++)a[O].x-=R,a[O].y+=E}function uT(a,h,p,x,E,P){var R,O=a.image;if(O.content){var k=O.content,H=O.pixelRatio||1;R=[k[0]/H,k[1]/H,O.displaySize[0]-k[2]/H,O.displaySize[1]-k[3]/H]}var X,q,re,ae,ve=h.left*P,xe=h.right*P;p==="width"||p==="both"?(ae=E[0]+ve-x[3],q=E[0]+xe+x[1]):q=(ae=E[0]+(ve+xe-O.displaySize[0])/2)+O.displaySize[0];var Be=h.top*P,Se=h.bottom*P;return p==="height"||p==="both"?(X=E[1]+Be-x[0],re=E[1]+Se+x[2]):re=(X=E[1]+(Be+Se-O.displaySize[1])/2)+O.displaySize[1],{image:O,top:X,right:q,bottom:re,left:ae,collisionPadding:R}}oo[10]=!0,oo[32]=!0,oo[38]=!0,oo[40]=!0,oo[41]=!0,oo[43]=!0,oo[45]=!0,oo[47]=!0,oo[173]=!0,oo[183]=!0,oo[8203]=!0,oo[8208]=!0,oo[8211]=!0,oo[8231]=!0;var Ef=function(a){function h(p,x,E,P){a.call(this,p,x),this.angle=E,P!==void 0&&(this.segment=P)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.clone=function(){return new h(this.x,this.y,this.angle,this.segment)},h}(w);function Ty(a,h){var p=h.expression;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new Jt(a+1))};if(p.kind==="source")return{kind:"source"};for(var x=p.zoomStops,E=p.interpolationType,P=0;P<x.length&&x[P]<=a;)P++;for(var R=P=Math.max(0,P-1);R<x.length&&x[R]<a+1;)R++;R=Math.min(x.length-1,R);var O=x[P],k=x[R];return p.kind==="composite"?{kind:"composite",minZoom:O,maxZoom:k,interpolationType:E}:{kind:"camera",minZoom:O,maxZoom:k,minSize:p.evaluate(new Jt(O)),maxSize:p.evaluate(new Jt(k)),interpolationType:E}}function hT(a,h,p){var x=h.uSize,E=p.lowerSize;return a.kind==="source"?E/128:a.kind==="composite"?Hi(E/128,p.upperSize/128,h.uSizeT):x}function fT(a,h){var p=0,x=0;if(a.kind==="constant")x=a.layoutSize;else if(a.kind!=="source"){var E=a.interpolationType,P=E?V(Yi.interpolationFactor(E,h,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?x=Hi(a.minSize,a.maxSize,P):p=P}return{uSizeT:p,uSize:x}}Ct("Anchor",Ef);var W6=Object.freeze({__proto__:null,getSizeData:Ty,evaluateSizeForFeature:hT,evaluateSizeForZoom:fT,SIZE_PACK_FACTOR:128});function dT(a,h,p,x,E){if(h.segment===void 0)return!0;for(var P=h,R=h.segment+1,O=0;O>-p/2;){if(--R<0)return!1;O-=a[R].dist(P),P=a[R]}O+=a[R].dist(a[R+1]),R++;for(var k=[],H=0;O<p/2;){var X=a[R],q=a[R+1];if(!q)return!1;var re=a[R-1].angleTo(X)-X.angleTo(q);for(re=Math.abs((re+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:O,angleDelta:re}),H+=re;O-k[0].distance>x;)H-=k.shift().angleDelta;if(H>E)return!1;R++,O+=X.dist(q)}return!0}function AT(a){for(var h=0,p=0;p<a.length-1;p++)h+=a[p].dist(a[p+1]);return h}function pT(a,h,p){return a?.6*h*p:0}function gT(a,h){return Math.max(a?a.right-a.left:0,h?h.right-h.left:0)}function X6(a,h,p,x,E,P){for(var R=pT(p,E,P),O=gT(p,x)*P,k=0,H=AT(a)/2,X=0;X<a.length-1;X++){var q=a[X],re=a[X+1],ae=q.dist(re);if(k+ae>H){var ve=(H-k)/ae,xe=Hi(q.x,re.x,ve),Be=Hi(q.y,re.y,ve),Se=new Ef(xe,Be,re.angleTo(q),X);return Se._round(),!R||dT(a,Se,O,R,h)?Se:void 0}k+=ae}}function q6(a,h,p,x,E,P,R,O,k){var H=pT(x,P,R),X=gT(x,E),q=X*R,re=a[0].x===0||a[0].x===k||a[0].y===0||a[0].y===k;return h-q<h/4&&(h=q+h/4),function ae(ve,xe,Be,Se,Ne,We,Ye,et,ot){for(var pt=We/2,wt=AT(ve),Ht=0,Mt=xe-Be,Xt=[],Bt=0;Bt<ve.length-1;Bt++){for(var Er=ve[Bt],sr=ve[Bt+1],Ut=Er.dist(sr),Br=sr.angleTo(Er);Mt+Be<Ht+Ut;){var vr=((Mt+=Be)-Ht)/Ut,Hr=Hi(Er.x,sr.x,vr),Kt=Hi(Er.y,sr.y,vr);if(Hr>=0&&Hr<ot&&Kt>=0&&Kt<ot&&Mt-pt>=0&&Mt+pt<=wt){var Zr=new Ef(Hr,Kt,Br,Bt);Zr._round(),Se&&!dT(ve,Zr,We,Se,Ne)||Xt.push(Zr)}}Ht+=Ut}return et||Xt.length||Ye||(Xt=ae(ve,Ht/2,Be,Se,Ne,We,Ye,!0,ot)),Xt}(a,re?h/2*O%h:(X/2+2*P)*R*O%h,h,H,p,q,re,!1,k)}function mT(a,h,p,x,E){for(var P=[],R=0;R<a.length;R++)for(var O=a[R],k=void 0,H=0;H<O.length-1;H++){var X=O[H],q=O[H+1];X.x<h&&q.x<h||(X.x<h?X=new w(h,X.y+(h-X.x)/(q.x-X.x)*(q.y-X.y))._round():q.x<h&&(q=new w(h,X.y+(h-X.x)/(q.x-X.x)*(q.y-X.y))._round()),X.y<p&&q.y<p||(X.y<p?X=new w(X.x+(p-X.y)/(q.y-X.y)*(q.x-X.x),p)._round():q.y<p&&(q=new w(X.x+(p-X.y)/(q.y-X.y)*(q.x-X.x),p)._round()),X.x>=x&&q.x>=x||(X.x>=x?X=new w(x,X.y+(x-X.x)/(q.x-X.x)*(q.y-X.y))._round():q.x>=x&&(q=new w(x,X.y+(x-X.x)/(q.x-X.x)*(q.y-X.y))._round()),X.y>=E&&q.y>=E||(X.y>=E?X=new w(X.x+(E-X.y)/(q.y-X.y)*(q.x-X.x),E)._round():q.y>=E&&(q=new w(X.x+(E-X.y)/(q.y-X.y)*(q.x-X.x),E)._round()),k&&X.equals(k[k.length-1])||P.push(k=[X]),k.push(q)))))}return P}function _T(a,h,p,x){var E=[],P=a.image,R=P.pixelRatio,O=P.paddedRect.w-2,k=P.paddedRect.h-2,H=a.right-a.left,X=a.bottom-a.top,q=P.stretchX||[[0,O]],re=P.stretchY||[[0,k]],ae=function(Hr,Kt){return Hr+Kt[1]-Kt[0]},ve=q.reduce(ae,0),xe=re.reduce(ae,0),Be=O-ve,Se=k-xe,Ne=0,We=ve,Ye=0,et=xe,ot=0,pt=Be,wt=0,Ht=Se;if(P.content&&x){var Mt=P.content;Ne=B0(q,0,Mt[0]),Ye=B0(re,0,Mt[1]),We=B0(q,Mt[0],Mt[2]),et=B0(re,Mt[1],Mt[3]),ot=Mt[0]-Ne,wt=Mt[1]-Ye,pt=Mt[2]-Mt[0]-We,Ht=Mt[3]-Mt[1]-et}var Xt=function(Hr,Kt,Zr,Ti){var Xi=O0(Hr.stretch-Ne,We,H,a.left),ki=D0(Hr.fixed-ot,pt,Hr.stretch,ve),Ei=O0(Kt.stretch-Ye,et,X,a.top),qi=D0(Kt.fixed-wt,Ht,Kt.stretch,xe),En=O0(Zr.stretch-Ne,We,H,a.left),Sn=D0(Zr.fixed-ot,pt,Zr.stretch,ve),As=O0(Ti.stretch-Ye,et,X,a.top),Dn=D0(Ti.fixed-wt,Ht,Ti.stretch,xe),ps=new w(Xi,Ei),en=new w(En,Ei),Fn=new w(En,As),Nr=new w(Xi,As),ci=new w(ki/R,qi/R),ri=new w(Sn/R,Dn/R),Xr=h*Math.PI/180;if(Xr){var Es=Math.sin(Xr),Qn=Math.cos(Xr),bi=[Qn,-Es,Es,Qn];ps._matMult(bi),en._matMult(bi),Nr._matMult(bi),Fn._matMult(bi)}var sn=Hr.stretch+Hr.fixed,es=Kt.stretch+Kt.fixed;return{tl:ps,tr:en,bl:Nr,br:Fn,tex:{x:P.paddedRect.x+1+sn,y:P.paddedRect.y+1+es,w:Zr.stretch+Zr.fixed-sn,h:Ti.stretch+Ti.fixed-es},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ci,pixelOffsetBR:ri,minFontScaleX:pt/R/H,minFontScaleY:Ht/R/X,isSDF:p}};if(x&&(P.stretchX||P.stretchY))for(var Bt=yT(q,Be,ve),Er=yT(re,Se,xe),sr=0;sr<Bt.length-1;sr++)for(var Ut=Bt[sr],Br=Bt[sr+1],vr=0;vr<Er.length-1;vr++)E.push(Xt(Ut,Er[vr],Br,Er[vr+1]));else E.push(Xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:O+1},{fixed:0,stretch:k+1}));return E}function B0(a,h,p){for(var x=0,E=0,P=a;E<P.length;E+=1){var R=P[E];x+=Math.max(h,Math.min(p,R[1]))-Math.max(h,Math.min(p,R[0]))}return x}function yT(a,h,p){for(var x=[{fixed:-1,stretch:0}],E=0,P=a;E<P.length;E+=1){var R=P[E],O=R[0],k=R[1],H=x[x.length-1];x.push({fixed:O-H.stretch,stretch:H.stretch}),x.push({fixed:O-H.stretch,stretch:H.stretch+(k-O)})}return x.push({fixed:h+1,stretch:p}),x}function O0(a,h,p,x){return a/h*p+x}function D0(a,h,p,x){return a-h*p/x}var F0=function(a,h,p,x,E,P,R,O,k,H){if(this.boxStartIndex=a.length,k){var X=P.top,q=P.bottom,re=P.collisionPadding;re&&(X-=re[1],q+=re[3]);var ae=q-X;ae>0&&(ae=Math.max(10,ae),this.circleDiameter=ae)}else{var ve=P.top*R-O,xe=P.bottom*R+O,Be=P.left*R-O,Se=P.right*R+O,Ne=P.collisionPadding;if(Ne&&(Be-=Ne[0]*R,ve-=Ne[1]*R,Se+=Ne[2]*R,xe+=Ne[3]*R),H){var We=new w(Be,ve),Ye=new w(Se,ve),et=new w(Be,xe),ot=new w(Se,xe),pt=H*Math.PI/180;We._rotate(pt),Ye._rotate(pt),et._rotate(pt),ot._rotate(pt),Be=Math.min(We.x,Ye.x,et.x,ot.x),Se=Math.max(We.x,Ye.x,et.x,ot.x),ve=Math.min(We.y,Ye.y,et.y,ot.y),xe=Math.max(We.y,Ye.y,et.y,ot.y)}a.emplaceBack(h.x,h.y,Be,ve,Se,xe,p,x,E)}this.boxEndIndex=a.length},Sf=function(a,h){if(a===void 0&&(a=[]),h===void 0&&(h=$6),this.data=a,this.length=this.data.length,this.compare=h,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function $6(a,h){return a<h?-1:a>h?1:0}function Z6(a,h,p){p===void 0&&(p=!1);for(var x=1/0,E=1/0,P=-1/0,R=-1/0,O=a[0],k=0;k<O.length;k++){var H=O[k];(!k||H.x<x)&&(x=H.x),(!k||H.y<E)&&(E=H.y),(!k||H.x>P)&&(P=H.x),(!k||H.y>R)&&(R=H.y)}var X=Math.min(P-x,R-E),q=X/2,re=new Sf([],K6);if(X===0)return new w(x,E);for(var ae=x;ae<P;ae+=X)for(var ve=E;ve<R;ve+=X)re.push(new Cf(ae+q,ve+q,q,a));for(var xe=function(Ne){for(var We=0,Ye=0,et=0,ot=Ne[0],pt=0,wt=ot.length,Ht=wt-1;pt<wt;Ht=pt++){var Mt=ot[pt],Xt=ot[Ht],Bt=Mt.x*Xt.y-Xt.x*Mt.y;Ye+=(Mt.x+Xt.x)*Bt,et+=(Mt.y+Xt.y)*Bt,We+=3*Bt}return new Cf(Ye/We,et/We,0,Ne)}(a),Be=re.length;re.length;){var Se=re.pop();(Se.d>xe.d||!xe.d)&&(xe=Se,p&&console.log("found best %d after %d probes",Math.round(1e4*Se.d)/1e4,Be)),Se.max-xe.d<=h||(re.push(new Cf(Se.p.x-(q=Se.h/2),Se.p.y-q,q,a)),re.push(new Cf(Se.p.x+q,Se.p.y-q,q,a)),re.push(new Cf(Se.p.x-q,Se.p.y+q,q,a)),re.push(new Cf(Se.p.x+q,Se.p.y+q,q,a)),Be+=4)}return p&&(console.log("num probes: "+Be),console.log("best distance: "+xe.d)),xe.p}function K6(a,h){return h.max-a.max}function Cf(a,h,p,x){this.p=new w(a,h),this.h=p,this.d=function(E,P){for(var R=!1,O=1/0,k=0;k<P.length;k++)for(var H=P[k],X=0,q=H.length,re=q-1;X<q;re=X++){var ae=H[X],ve=H[re];ae.y>E.y!=ve.y>E.y&&E.x<(ve.x-ae.x)*(E.y-ae.y)/(ve.y-ae.y)+ae.x&&(R=!R),O=Math.min(O,au(E,ae,ve))}return(R?1:-1)*Math.sqrt(O)}(this.p,x),this.max=this.d+this.h*Math.SQRT2}Sf.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Sf.prototype.pop=function(){if(this.length!==0){var a=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),a}},Sf.prototype.peek=function(){return this.data[0]},Sf.prototype._up=function(a){for(var h=this.data,p=this.compare,x=h[a];a>0;){var E=a-1>>1,P=h[E];if(p(x,P)>=0)break;h[a]=P,a=E}h[a]=x},Sf.prototype._down=function(a){for(var h=this.data,p=this.compare,x=this.length>>1,E=h[a];a<x;){var P=1+(a<<1),R=h[P],O=P+1;if(O<this.length&&p(h[O],R)<0&&(P=O,R=h[O]),p(R,E)>=0)break;h[a]=R,a=P}h[a]=E};var Ey=Number.POSITIVE_INFINITY;function vT(a,h){return h[1]!==Ey?function(p,x,E){var P=0,R=0;switch(x=Math.abs(x),E=Math.abs(E),p){case"top-right":case"top-left":case"top":R=E-7;break;case"bottom-right":case"bottom-left":case"bottom":R=7-E}switch(p){case"top-right":case"bottom-right":case"right":P=-x;break;case"top-left":case"bottom-left":case"left":P=x}return[P,R]}(a,h[0],h[1]):function(p,x){var E=0,P=0;x<0&&(x=0);var R=x/Math.sqrt(2);switch(p){case"top-right":case"top-left":P=R-7;break;case"bottom-right":case"bottom-left":P=7-R;break;case"bottom":P=7-x;break;case"top":P=x-7}switch(p){case"top-right":case"bottom-right":E=-R;break;case"top-left":case"bottom-left":E=R;break;case"left":E=x;break;case"right":E=-x}return[E,P]}(a,h[0])}function Sy(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bT(a,h,p,x,E,P,R,O,k,H,X,q,re,ae,ve){var xe=function(Ye,et,ot,pt,wt,Ht,Mt,Xt){for(var Bt=pt.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,Er=[],sr=0,Ut=et.positionedLines;sr<Ut.length;sr+=1)for(var Br=Ut[sr],vr=0,Hr=Br.positionedGlyphs;vr<Hr.length;vr+=1){var Kt=Hr[vr];if(Kt.rect){var Zr=Kt.rect||{},Ti=4,Xi=!0,ki=1,Ei=0,qi=(wt||Xt)&&Kt.vertical,En=Kt.metrics.advance*Kt.scale/2;if(Xt&&et.verticalizable&&(Ei=Br.lineOffset/2-(Kt.imageName?-(24-Kt.metrics.width*Kt.scale)/2:24*(Kt.scale-1))),Kt.imageName){var Sn=Mt[Kt.imageName];Xi=Sn.sdf,Ti=1/(ki=Sn.pixelRatio)}var As=wt?[Kt.x+En,Kt.y]:[0,0],Dn=wt?[0,0]:[Kt.x+En+ot[0],Kt.y+ot[1]-Ei],ps=[0,0];qi&&(ps=Dn,Dn=[0,0]);var en=(Kt.metrics.left-Ti)*Kt.scale-En+Dn[0],Fn=(-Kt.metrics.top-Ti)*Kt.scale+Dn[1],Nr=en+Zr.w*Kt.scale/ki,ci=Fn+Zr.h*Kt.scale/ki,ri=new w(en,Fn),Xr=new w(Nr,Fn),Es=new w(en,ci),Qn=new w(Nr,ci);if(qi){var bi=new w(-En,En- -17),sn=-Math.PI/2,es=12-En,Kr=new w(22-es,-(Kt.imageName?es:0)),Tl=new(Function.prototype.bind.apply(w,[null].concat(ps)));ri._rotateAround(sn,bi)._add(Kr)._add(Tl),Xr._rotateAround(sn,bi)._add(Kr)._add(Tl),Es._rotateAround(sn,bi)._add(Kr)._add(Tl),Qn._rotateAround(sn,bi)._add(Kr)._add(Tl)}if(Bt){var wo=Math.sin(Bt),El=Math.cos(Bt),tn=[El,-wo,wo,El];ri._matMult(tn),Xr._matMult(tn),Es._matMult(tn),Qn._matMult(tn)}var Sl=new w(0,0),ba=new w(0,0);Er.push({tl:ri,tr:Xr,bl:Es,br:Qn,tex:Zr,writingMode:et.writingMode,glyphOffset:As,sectionIndex:Kt.sectionIndex,isSDF:Xi,pixelOffsetTL:Sl,pixelOffsetBR:ba,minFontScaleX:0,minFontScaleY:0})}}return Er}(0,p,O,E,P,R,x,a.allowVerticalPlacement),Be=a.textSizeData,Se=null;Be.kind==="source"?(Se=[128*E.layout.get("text-size").evaluate(R,{})])[0]>32640&&Ve(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Be.kind==="composite"&&((Se=[128*ae.compositeTextSizes[0].evaluate(R,{},ve),128*ae.compositeTextSizes[1].evaluate(R,{},ve)])[0]>32640||Se[1]>32640)&&Ve(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,xe,Se,O,P,R,H,h,k.lineStartIndex,k.lineLength,re,ve);for(var Ne=0,We=X;Ne<We.length;Ne+=1)q[We[Ne]]=a.text.placedSymbolArray.length-1;return 4*xe.length}function xT(a){for(var h in a)return a[h];return null}function Y6(a,h,p,x){var E=a.compareText;if(h in E){for(var P=E[h],R=P.length-1;R>=0;R--)if(x.dist(P[R])<p)return!0}else E[h]=[];return E[h].push(x),!1}var J6=bf.VectorTileFeature.types,Q6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function L0(a,h,p,x,E,P,R,O,k,H,X,q,re){var ae=O?Math.min(32640,Math.round(O[0])):0,ve=O?Math.min(32640,Math.round(O[1])):0;a.emplaceBack(h,p,Math.round(32*x),Math.round(32*E),P,R,(ae<<1)+(k?1:0),ve,16*H,16*X,256*q,256*re)}function Cy(a,h,p){a.emplaceBack(h.x,h.y,p),a.emplaceBack(h.x,h.y,p),a.emplaceBack(h.x,h.y,p),a.emplaceBack(h.x,h.y,p)}function eL(a){for(var h=0,p=a.sections;h<p.length;h+=1)if(ru(p[h].text))return!0;return!1}var Pf=function(a){this.layoutVertexArray=new un,this.indexArray=new yo,this.programConfigurations=a,this.segments=new z,this.dynamicLayoutVertexArray=new Go,this.opacityVertexArray=new _o,this.placedSymbolArray=new d};Pf.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Pf.prototype.upload=function(a,h,p,x){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,S6.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,C6.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Q6,!0),this.opacityVertexBuffer.itemSize=1),(p||x)&&this.programConfigurations.upload(a))},Pf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Ct("SymbolBuffers",Pf);var RA=function(a,h,p){this.layoutVertexArray=new a,this.layoutAttributes=h,this.indexArray=new p,this.segments=new z,this.collisionVertexArray=new su};RA.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,P6.members,!0)},RA.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Ct("CollisionBuffers",RA);var si=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(P){return P.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=so([]),this.placementViewportMatrix=so([]);var h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ty(this.zoom,h["text-size"]),this.iconSizeData=Ty(this.zoom,h["icon-size"]);var p=this.layers[0].layout,x=p.get("symbol-sort-key"),E=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&x.constantOr(1)!==void 0,this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(function(P){return xo[P]})),this.stateDependentLayerIds=this.layers.filter(function(P){return P.isStateDependent()}).map(function(P){return P.id}),this.sourceID=a.sourceID};si.prototype.createArrays=function(){this.text=new Pf(new nr(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Pf(new nr(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new S,this.lineVertexArray=new M,this.symbolInstances=new T},si.prototype.calculateGlyphDependencies=function(a,h,p,x,E){for(var P=0;P<a.length;P++)if(h[a.charCodeAt(P)]=!0,(p||x)&&E){var R=PA[a.charAt(P)];R&&(h[R.charCodeAt(0)]=!0)}},si.prototype.populate=function(a,h,p){var x=this.layers[0],E=x.layout,P=E.get("text-font"),R=E.get("text-field"),O=E.get("icon-image"),k=(R.value.kind!=="constant"||R.value.value instanceof zt&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),H=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,X=E.get("symbol-sort-key");if(this.features=[],k||H){for(var q=h.iconDependencies,re=h.glyphDependencies,ae=h.availableImages,ve=new Jt(this.zoom),xe=0,Be=a;xe<Be.length;xe+=1){var Se=Be[xe],Ne=Se.feature,We=Se.id,Ye=Se.index,et=Se.sourceLayerIndex,ot=x._featureFilter.needGeometry,pt=Qi(Ne,ot);if(x._featureFilter.filter(ve,pt,p)){ot||(pt.geometry=Li(Ne));var wt=void 0;if(k){var Ht=x.getValueAndResolveTokens("text-field",pt,p,ae),Mt=zt.factory(Ht);eL(Mt)&&(this.hasRTLText=!0),(!this.hasRTLText||rh()==="unavailable"||this.hasRTLText&&us.isParsed())&&(wt=M6(Mt,x,pt))}var Xt=void 0;if(H){var Bt=x.getValueAndResolveTokens("icon-image",pt,p,ae);Xt=Bt instanceof hi?Bt:hi.fromString(Bt)}if(wt||Xt){var Er=this.sortFeaturesByKey?X.evaluate(pt,{},p):void 0;if(this.features.push({id:We,text:wt,icon:Xt,index:Ye,sourceLayerIndex:et,geometry:pt.geometry,properties:Ne.properties,type:J6[Ne.type],sortKey:Er}),Xt&&(q[Xt.name]=!0),wt){var sr=P.evaluate(pt,{},p).join(","),Ut=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(xo.vertical)>=0;for(var Br=0,vr=wt.sections;Br<vr.length;Br+=1){var Hr=vr[Br];if(Hr.image)q[Hr.image.name]=!0;else{var Kt=tu(wt.toString()),Zr=Hr.fontStack||sr,Ti=re[Zr]=re[Zr]||{};this.calculateGlyphDependencies(Hr.text,Ti,Ut,this.allowVerticalPlacement,Kt)}}}}}}E.get("symbol-placement")==="line"&&(this.features=function(Xi){var ki={},Ei={},qi=[],En=0;function Sn(bi){qi.push(Xi[bi]),En++}function As(bi,sn,es){var Kr=Ei[bi];return delete Ei[bi],Ei[sn]=Kr,qi[Kr].geometry[0].pop(),qi[Kr].geometry[0]=qi[Kr].geometry[0].concat(es[0]),Kr}function Dn(bi,sn,es){var Kr=ki[sn];return delete ki[sn],ki[bi]=Kr,qi[Kr].geometry[0].shift(),qi[Kr].geometry[0]=es[0].concat(qi[Kr].geometry[0]),Kr}function ps(bi,sn,es){var Kr=es?sn[0][sn[0].length-1]:sn[0][0];return bi+":"+Kr.x+":"+Kr.y}for(var en=0;en<Xi.length;en++){var Fn=Xi[en],Nr=Fn.geometry,ci=Fn.text?Fn.text.toString():null;if(ci){var ri=ps(ci,Nr),Xr=ps(ci,Nr,!0);if(ri in Ei&&Xr in ki&&Ei[ri]!==ki[Xr]){var Es=Dn(ri,Xr,Nr),Qn=As(ri,Xr,qi[Es].geometry);delete ki[ri],delete Ei[Xr],Ei[ps(ci,qi[Qn].geometry,!0)]=Qn,qi[Es].geometry=null}else ri in Ei?As(ri,Xr,Nr):Xr in ki?Dn(ri,Xr,Nr):(Sn(en),ki[ri]=En-1,Ei[Xr]=En-1)}else Sn(en)}return qi.filter(function(bi){return bi.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Xi,ki){return Xi.sortKey-ki.sortKey})}},si.prototype.update=function(a,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,h,this.layers,p),this.icon.programConfigurations.updatePaintArrays(a,h,this.layers,p))},si.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},si.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},si.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},si.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},si.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},si.prototype.addToLineVertexArray=function(a,h){var p=this.lineVertexArray.length;if(a.segment!==void 0){for(var x=a.dist(h[a.segment+1]),E=a.dist(h[a.segment]),P={},R=a.segment+1;R<h.length;R++)P[R]={x:h[R].x,y:h[R].y,tileUnitDistanceFromAnchor:x},R<h.length-1&&(x+=h[R+1].dist(h[R]));for(var O=a.segment||0;O>=0;O--)P[O]={x:h[O].x,y:h[O].y,tileUnitDistanceFromAnchor:E},O>0&&(E+=h[O-1].dist(h[O]));for(var k=0;k<h.length;k++){var H=P[k];this.lineVertexArray.emplaceBack(H.x,H.y,H.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}},si.prototype.addSymbols=function(a,h,p,x,E,P,R,O,k,H,X,q){for(var re=a.indexArray,ae=a.layoutVertexArray,ve=a.segments.prepareSegment(4*h.length,ae,re,this.canOverlap?P.sortKey:void 0),xe=this.glyphOffsetArray.length,Be=ve.vertexLength,Se=this.allowVerticalPlacement&&R===xo.vertical?Math.PI/2:0,Ne=P.text&&P.text.sections,We=0;We<h.length;We++){var Ye=h[We],et=Ye.tl,ot=Ye.tr,pt=Ye.bl,wt=Ye.br,Ht=Ye.tex,Mt=Ye.pixelOffsetTL,Xt=Ye.pixelOffsetBR,Bt=Ye.minFontScaleX,Er=Ye.minFontScaleY,sr=Ye.glyphOffset,Ut=Ye.isSDF,Br=Ye.sectionIndex,vr=ve.vertexLength,Hr=sr[1];L0(ae,O.x,O.y,et.x,Hr+et.y,Ht.x,Ht.y,p,Ut,Mt.x,Mt.y,Bt,Er),L0(ae,O.x,O.y,ot.x,Hr+ot.y,Ht.x+Ht.w,Ht.y,p,Ut,Xt.x,Mt.y,Bt,Er),L0(ae,O.x,O.y,pt.x,Hr+pt.y,Ht.x,Ht.y+Ht.h,p,Ut,Mt.x,Xt.y,Bt,Er),L0(ae,O.x,O.y,wt.x,Hr+wt.y,Ht.x+Ht.w,Ht.y+Ht.h,p,Ut,Xt.x,Xt.y,Bt,Er),Cy(a.dynamicLayoutVertexArray,O,Se),re.emplaceBack(vr,vr+1,vr+2),re.emplaceBack(vr+1,vr+2,vr+3),ve.vertexLength+=4,ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(sr[0]),We!==h.length-1&&Br===h[We+1].sectionIndex||a.programConfigurations.populatePaintArrays(ae.length,P,P.index,{},q,Ne&&Ne[Br])}a.placedSymbolArray.emplaceBack(O.x,O.y,xe,this.glyphOffsetArray.length-xe,Be,k,H,O.segment,p?p[0]:0,p?p[1]:0,x[0],x[1],R,0,!1,0,X)},si.prototype._addCollisionDebugVertex=function(a,h,p,x,E,P){return h.emplaceBack(0,0),a.emplaceBack(p.x,p.y,x,E,Math.round(P.x),Math.round(P.y))},si.prototype.addCollisionDebugVertices=function(a,h,p,x,E,P,R){var O=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),k=O.vertexLength,H=E.layoutVertexArray,X=E.collisionVertexArray,q=R.anchorX,re=R.anchorY;this._addCollisionDebugVertex(H,X,P,q,re,new w(a,h)),this._addCollisionDebugVertex(H,X,P,q,re,new w(p,h)),this._addCollisionDebugVertex(H,X,P,q,re,new w(p,x)),this._addCollisionDebugVertex(H,X,P,q,re,new w(a,x)),O.vertexLength+=4;var ae=E.indexArray;ae.emplaceBack(k,k+1),ae.emplaceBack(k+1,k+2),ae.emplaceBack(k+2,k+3),ae.emplaceBack(k+3,k),O.primitiveLength+=4},si.prototype.addDebugCollisionBoxes=function(a,h,p,x){for(var E=a;E<h;E++){var P=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(P.x1,P.y1,P.x2,P.y2,x?this.textCollisionBox:this.iconCollisionBox,P.anchorPoint,p)}},si.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new RA(_t,eT.members,m),this.iconCollisionBox=new RA(_t,eT.members,m);for(var a=0;a<this.symbolInstances.length;a++){var h=this.symbolInstances.get(a);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}},si.prototype._deserializeCollisionBoxesForSymbol=function(a,h,p,x,E,P,R,O,k){for(var H={},X=h;X<p;X++){var q=a.get(X);H.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},H.textFeatureIndex=q.featureIndex;break}for(var re=x;re<E;re++){var ae=a.get(re);H.verticalTextBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},H.verticalTextFeatureIndex=ae.featureIndex;break}for(var ve=P;ve<R;ve++){var xe=a.get(ve);H.iconBox={x1:xe.x1,y1:xe.y1,x2:xe.x2,y2:xe.y2,anchorPointX:xe.anchorPointX,anchorPointY:xe.anchorPointY},H.iconFeatureIndex=xe.featureIndex;break}for(var Be=O;Be<k;Be++){var Se=a.get(Be);H.verticalIconBox={x1:Se.x1,y1:Se.y1,x2:Se.x2,y2:Se.y2,anchorPointX:Se.anchorPointX,anchorPointY:Se.anchorPointY},H.verticalIconFeatureIndex=Se.featureIndex;break}return H},si.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var h=0;h<this.symbolInstances.length;h++){var p=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}},si.prototype.hasTextData=function(){return this.text.segments.get().length>0},si.prototype.hasIconData=function(){return this.icon.segments.get().length>0},si.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},si.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},si.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},si.prototype.addIndicesForPlacedSymbol=function(a,h){for(var p=a.placedSymbolArray.get(h),x=p.vertexStartIndex+4*p.numGlyphs,E=p.vertexStartIndex;E<x;E+=4)a.indexArray.emplaceBack(E,E+1,E+2),a.indexArray.emplaceBack(E+1,E+2,E+3)},si.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var h=Math.sin(a),p=Math.cos(a),x=[],E=[],P=[],R=0;R<this.symbolInstances.length;++R){P.push(R);var O=this.symbolInstances.get(R);x.push(0|Math.round(h*O.anchorX+p*O.anchorY)),E.push(O.featureIndex)}return P.sort(function(k,H){return x[k]-x[H]||E[H]-E[k]}),P},si.prototype.addToSortKeyRanges=function(a,h){var p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===h?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:a,symbolInstanceEnd:a+1})},si.prototype.sortFeatures=function(a){var h=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var p=0,x=this.symbolInstanceIndexes;p<x.length;p+=1){var E=this.symbolInstances.get(x[p]);this.featureSortOrder.push(E.featureIndex),[E.rightJustifiedTextSymbolIndex,E.centerJustifiedTextSymbolIndex,E.leftJustifiedTextSymbolIndex].forEach(function(P,R,O){P>=0&&O.indexOf(P)===R&&h.addIndicesForPlacedSymbol(h.text,P)}),E.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,E.verticalPlacedTextSymbolIndex),E.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.placedIconSymbolIndex),E.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Ct("SymbolBucket",si,{omit:["layers","collisionBoxArray","features","compareText"]}),si.MAX_GLYPHS=65535,si.addDynamicAttributes=Cy;var tL=new bn({"symbol-placement":new jt(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Lt(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jt(ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jt(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Lt(ce.layout_symbol["icon-size"]),"icon-text-fit":new jt(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Lt(ce.layout_symbol["icon-image"]),"icon-rotate":new Lt(ce.layout_symbol["icon-rotate"]),"icon-padding":new jt(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Lt(ce.layout_symbol["icon-offset"]),"icon-anchor":new Lt(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(ce.layout_symbol["text-rotation-alignment"]),"text-field":new Lt(ce.layout_symbol["text-field"]),"text-font":new Lt(ce.layout_symbol["text-font"]),"text-size":new Lt(ce.layout_symbol["text-size"]),"text-max-width":new Lt(ce.layout_symbol["text-max-width"]),"text-line-height":new jt(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Lt(ce.layout_symbol["text-letter-spacing"]),"text-justify":new Lt(ce.layout_symbol["text-justify"]),"text-radial-offset":new Lt(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(ce.layout_symbol["text-variable-anchor"]),"text-anchor":new Lt(ce.layout_symbol["text-anchor"]),"text-max-angle":new jt(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(ce.layout_symbol["text-writing-mode"]),"text-rotate":new Lt(ce.layout_symbol["text-rotate"]),"text-padding":new jt(ce.layout_symbol["text-padding"]),"text-keep-upright":new jt(ce.layout_symbol["text-keep-upright"]),"text-transform":new Lt(ce.layout_symbol["text-transform"]),"text-offset":new Lt(ce.layout_symbol["text-offset"]),"text-allow-overlap":new jt(ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jt(ce.layout_symbol["text-ignore-placement"]),"text-optional":new jt(ce.layout_symbol["text-optional"])}),Py={paint:new bn({"icon-opacity":new Lt(ce.paint_symbol["icon-opacity"]),"icon-color":new Lt(ce.paint_symbol["icon-color"]),"icon-halo-color":new Lt(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Lt(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Lt(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Lt(ce.paint_symbol["text-opacity"]),"text-color":new Lt(ce.paint_symbol["text-color"],{runtimeType:at,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new Lt(ce.paint_symbol["text-halo-color"]),"text-halo-width":new Lt(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Lt(ce.paint_symbol["text-halo-blur"]),"text-translate":new jt(ce.paint_symbol["text-translate"]),"text-translate-anchor":new jt(ce.paint_symbol["text-translate-anchor"])}),layout:tL},If=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:ht,this.defaultValue=a};If.prototype.evaluate=function(a){if(a.formattedSection){var h=this.defaultValue.property.overrides;if(h&&h.hasOverride(a.formattedSection))return h.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},If.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},If.prototype.outputDefined=function(){return!1},If.prototype.serialize=function(){return null},Ct("FormatSectionOverride",If,{omit:["defaultValue"]});var rL=function(a){function h(p){a.call(this,p,Py)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.recalculate=function(p,x){if(a.prototype.recalculate.call(this,p,x),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var E=this.layout.get("text-writing-mode");if(E){for(var P=[],R=0,O=E;R<O.length;R+=1){var k=O[R];P.indexOf(k)<0&&P.push(k)}this.layout._values["text-writing-mode"]=P}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},h.prototype.getValueAndResolveTokens=function(p,x,E,P){var R=this.layout.get(p).evaluate(x,{},E,P),O=this._unevaluatedLayout._values[p];return O.isDataDriven()||Jl(O.value)||!R?R:function(k,H){return H.replace(/{([^{}]+)}/g,function(X,q){return q in k?String(k[q]):""})}(x.properties,R)},h.prototype.createBucket=function(p){return new si(p)},h.prototype.queryRadius=function(){return 0},h.prototype.queryIntersectsFeature=function(){return!1},h.prototype._setPaintOverrides=function(){for(var p=0,x=Py.paint.overridableProperties;p<x.length;p+=1){var E=x[p];if(h.hasPaintOverride(this.layout,E)){var P,R=this.paint.get(E),O=new If(R),k=new Al(O,R.property.specification);P=R.value.kind==="constant"||R.value.kind==="source"?new yn("source",k):new fa("composite",k,R.value.zoomStops,R.value._interpolationType),this.paint._values[E]=new Nn(R.property,P,R.parameters)}}},h.prototype._handleOverridablePaintPropertyUpdate=function(p,x,E){return!(!this.layout||x.isDataDriven()||E.isDataDriven())&&h.hasPaintOverride(this.layout,p)},h.hasPaintOverride=function(p,x){var E=p.get("text-field"),P=Py.paint.properties[x],R=!1,O=function(X){for(var q=0,re=X;q<re.length;q+=1)if(P.overrides&&P.overrides.hasOverride(re[q]))return void(R=!0)};if(E.value.kind==="constant"&&E.value.value instanceof zt)O(E.value.value.sections);else if(E.value.kind==="source"){var k=function(X){R||(X instanceof ue&&di(X.value)===Ir?O(X.value.sections):X instanceof ns?O(X.sections):X.eachChild(k))},H=E.value;H._styleExpression&&k(H._styleExpression.expression)}return R},h}(po),iL={paint:new bn({"background-color":new jt(ce.paint_background["background-color"]),"background-pattern":new Un(ce.paint_background["background-pattern"]),"background-opacity":new jt(ce.paint_background["background-opacity"])})},nL=function(a){function h(p){a.call(this,p,iL)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(po),sL={paint:new bn({"raster-opacity":new jt(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new jt(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(ce.paint_raster["raster-saturation"]),"raster-contrast":new jt(ce.paint_raster["raster-contrast"]),"raster-resampling":new jt(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(ce.paint_raster["raster-fade-duration"])})},oL=function(a){function h(p){a.call(this,p,sL)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(po),aL=function(a){function h(p){a.call(this,p,{}),this.implementation=p}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},h.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},h.prototype.recalculate=function(){},h.prototype.updateTransitions=function(){},h.prototype.hasTransition=function(){},h.prototype.serialize=function(){},h.prototype.onAdd=function(p){this.implementation.onAdd&&this.implementation.onAdd(p,p.painter.context.gl)},h.prototype.onRemove=function(p){this.implementation.onRemove&&this.implementation.onRemove(p,p.painter.context.gl)},h}(po),lL={circle:fy,heatmap:WF,hillshade:qF,fill:u6,"fill-extrusion":y6,line:E6,symbol:rL,background:nL,raster:oL},wT=I.HTMLImageElement,TT=I.HTMLCanvasElement,ET=I.HTMLVideoElement,ST=I.ImageData,k0=I.ImageBitmap,ch=function(a,h,p,x){this.context=a,this.format=p,this.texture=a.gl.createTexture(),this.update(h,x)};ch.prototype.update=function(a,h,p){var x=a.width,E=a.height,P=!(this.size&&this.size[0]===x&&this.size[1]===E||p),R=this.context,O=R.gl;if(this.useMipmap=!!(h&&h.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!h||h.premultiply!==!1)),P)this.size=[x,E],a instanceof wT||a instanceof TT||a instanceof ET||a instanceof ST||k0&&a instanceof k0?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,a):O.texImage2D(O.TEXTURE_2D,0,this.format,x,E,0,this.format,O.UNSIGNED_BYTE,a.data);else{var k=p||{x:0,y:0},H=k.x,X=k.y;a instanceof wT||a instanceof TT||a instanceof ET||a instanceof ST||k0&&a instanceof k0?O.texSubImage2D(O.TEXTURE_2D,0,H,X,O.RGBA,O.UNSIGNED_BYTE,a):O.texSubImage2D(O.TEXTURE_2D,0,H,X,x,E,O.RGBA,O.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)},ch.prototype.bind=function(a,h,p){var x=this.context.gl;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||a),this.filter=a),h!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,h),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrap=h)},ch.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},ch.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Iy=function(a){var h=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){h._triggered=!1,h._callback()})};Iy.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Iy.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Mf=function(a,h,p){this.target=a,this.parent=h,this.mapId=p,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ue(["receive","process"],this),this.invoker=new Iy(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Nt()?a:I};function CT(a,h,p){var x=2*Math.PI*6378137/256/Math.pow(2,p);return[a*x-2*Math.PI*6378137/2,h*x-2*Math.PI*6378137/2]}Mf.prototype.send=function(a,h,p,x,E){var P=this;E===void 0&&(E=!1);var R=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(this.callbacks[R]=p);var O=_r(this.globalScope)?void 0:[];return this.target.postMessage({id:R,type:a,hasCallback:!!p,targetMapId:x,mustQueue:E,sourceMapId:this.mapId,data:Qs(h,O)},O),{cancel:function(){p&&delete P.callbacks[R],P.target.postMessage({id:R,type:"<cancel>",targetMapId:x,sourceMapId:P.mapId})}}},Mf.prototype.receive=function(a){var h=a.data,p=h.id;if(p&&(!h.targetMapId||this.mapId===h.targetMapId))if(h.type==="<cancel>"){delete this.tasks[p];var x=this.cancelCallbacks[p];delete this.cancelCallbacks[p],x&&x()}else Nt()||h.mustQueue?(this.tasks[p]=h,this.taskQueue.push(p),this.invoker.trigger()):this.processTask(p,h)},Mf.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),h=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),h&&this.processTask(a,h)}},Mf.prototype.processTask=function(a,h){var p=this;if(h.type==="<response>"){var x=this.callbacks[a];delete this.callbacks[a],x&&(h.error?x(as(h.error)):x(null,as(h.data)))}else{var E=!1,P=_r(this.globalScope)?void 0:[],R=h.hasCallback?function(X,q){E=!0,delete p.cancelCallbacks[a],p.target.postMessage({id:a,type:"<response>",sourceMapId:p.mapId,error:X?Qs(X):null,data:Qs(q,P)},P)}:function(X){E=!0},O=null,k=as(h.data);if(this.parent[h.type])O=this.parent[h.type](h.sourceMapId,k,R);else if(this.parent.getWorkerSource){var H=h.type.split(".");O=this.parent.getWorkerSource(h.sourceMapId,H[0],k.source)[H[1]](k,R)}else R(new Error("Could not find function "+h.type));!E&&O&&O.cancel&&(this.cancelCallbacks[a]=O.cancel)}},Mf.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var fn=function(a,h){a&&(h?this.setSouthWest(a).setNorthEast(h):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};fn.prototype.setNorthEast=function(a){return this._ne=a instanceof wi?new wi(a.lng,a.lat):wi.convert(a),this},fn.prototype.setSouthWest=function(a){return this._sw=a instanceof wi?new wi(a.lng,a.lat):wi.convert(a),this},fn.prototype.extend=function(a){var h,p,x=this._sw,E=this._ne;if(a instanceof wi)h=a,p=a;else{if(!(a instanceof fn))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(fn.convert(a)):this.extend(wi.convert(a)):this;if(p=a._ne,!(h=a._sw)||!p)return this}return x||E?(x.lng=Math.min(h.lng,x.lng),x.lat=Math.min(h.lat,x.lat),E.lng=Math.max(p.lng,E.lng),E.lat=Math.max(p.lat,E.lat)):(this._sw=new wi(h.lng,h.lat),this._ne=new wi(p.lng,p.lat)),this},fn.prototype.getCenter=function(){return new wi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},fn.prototype.getSouthWest=function(){return this._sw},fn.prototype.getNorthEast=function(){return this._ne},fn.prototype.getNorthWest=function(){return new wi(this.getWest(),this.getNorth())},fn.prototype.getSouthEast=function(){return new wi(this.getEast(),this.getSouth())},fn.prototype.getWest=function(){return this._sw.lng},fn.prototype.getSouth=function(){return this._sw.lat},fn.prototype.getEast=function(){return this._ne.lng},fn.prototype.getNorth=function(){return this._ne.lat},fn.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},fn.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},fn.prototype.isEmpty=function(){return!(this._sw&&this._ne)},fn.prototype.contains=function(a){var h=wi.convert(a),p=h.lng,x=h.lat,E=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(E=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&E},fn.convert=function(a){return!a||a instanceof fn?a:new fn(a)};var wi=function(a,h){if(isNaN(a)||isNaN(h))throw new Error("Invalid LngLat object: ("+a+", "+h+")");if(this.lng=+a,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};wi.prototype.wrap=function(){return new wi(G(this.lng,-180,180),this.lat)},wi.prototype.toArray=function(){return[this.lng,this.lat]},wi.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},wi.prototype.distanceTo=function(a){var h=Math.PI/180,p=this.lat*h,x=a.lat*h,E=Math.sin(p)*Math.sin(x)+Math.cos(p)*Math.cos(x)*Math.cos((a.lng-this.lng)*h);return 63710088e-1*Math.acos(Math.min(E,1))},wi.prototype.toBounds=function(a){a===void 0&&(a=0);var h=360*a/40075017,p=h/Math.cos(Math.PI/180*this.lat);return new fn(new wi(this.lng-p,this.lat-h),new wi(this.lng+p,this.lat+h))},wi.convert=function(a){if(a instanceof wi)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new wi(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new wi(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var PT=2*Math.PI*63710088e-1;function IT(a){return PT*Math.cos(a*Math.PI/180)}function MT(a){return(180+a)/360}function RT(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function BT(a,h){return a/IT(h)}function My(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var uh=function(a,h,p){p===void 0&&(p=0),this.x=+a,this.y=+h,this.z=+p};uh.fromLngLat=function(a,h){h===void 0&&(h=0);var p=wi.convert(a);return new uh(MT(p.lng),RT(p.lat),BT(h,p.lat))},uh.prototype.toLngLat=function(){return new wi(360*this.x-180,My(this.y))},uh.prototype.toAltitude=function(){return this.z*IT(My(this.y))},uh.prototype.meterInMercatorCoordinateUnits=function(){return 1/PT*(a=My(this.y),1/Math.cos(a*Math.PI/180));var a};var hh=function(a,h,p){this.z=a,this.x=h,this.y=p,this.key=BA(0,a,a,h,p)};hh.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},hh.prototype.url=function(a,h){var p,x,E,P,R,O=(x=this.y,E=this.z,P=CT(256*(p=this.x),256*(x=Math.pow(2,E)-x-1),E),R=CT(256*(p+1),256*(x+1),E),P[0]+","+P[1]+","+R[0]+","+R[1]),k=function(H,X,q){for(var re,ae="",ve=H;ve>0;ve--)ae+=(X&(re=1<<ve-1)?1:0)+(q&re?2:0);return ae}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",O)},hh.prototype.getTilePoint=function(a){var h=Math.pow(2,this.z);return new w(8192*(a.x*h-this.x),8192*(a.y*h-this.y))},hh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var OT=function(a,h){this.wrap=a,this.canonical=h,this.key=BA(a,h.z,h.z,h.x,h.y)},dn=function(a,h,p,x,E){this.overscaledZ=a,this.wrap=h,this.canonical=new hh(p,+x,+E),this.key=BA(h,a,p,x,E)};function BA(a,h,p,x,E){(a*=2)<0&&(a=-1*a-1);var P=1<<p;return(P*P*a+P*E+x).toString(36)+p.toString(36)+h.toString(36)}dn.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},dn.prototype.scaledTo=function(a){var h=this.canonical.z-a;return a>this.canonical.z?new dn(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new dn(a,this.wrap,a,this.canonical.x>>h,this.canonical.y>>h)},dn.prototype.calculateScaledKey=function(a,h){var p=this.canonical.z-a;return a>this.canonical.z?BA(this.wrap*+h,a,this.canonical.z,this.canonical.x,this.canonical.y):BA(this.wrap*+h,a,a,this.canonical.x>>p,this.canonical.y>>p)},dn.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var h=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>h&&a.canonical.y===this.canonical.y>>h},dn.prototype.children=function(a){if(this.overscaledZ>=a)return[new dn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var h=this.canonical.z+1,p=2*this.canonical.x,x=2*this.canonical.y;return[new dn(h,this.wrap,h,p,x),new dn(h,this.wrap,h,p+1,x),new dn(h,this.wrap,h,p,x+1),new dn(h,this.wrap,h,p+1,x+1)]},dn.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},dn.prototype.wrapped=function(){return new dn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},dn.prototype.unwrapTo=function(a){return new dn(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},dn.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},dn.prototype.toUnwrapped=function(){return new OT(this.wrap,this.canonical)},dn.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},dn.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new uh(a.x-this.wrap,a.y))},Ct("CanonicalTileID",hh),Ct("OverscaledTileID",dn,{omit:["posMatrix"]});var hc=function(a,h,p){if(this.uid=a,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return Ve('"'+p+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=h.height;var x=this.dim=h.height-2;this.data=new Uint32Array(h.data.buffer),this.encoding=p||"mapbox";for(var E=0;E<x;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(x,E)]=this.data[this._idx(x-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,x)]=this.data[this._idx(E,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)]};hc.prototype.get=function(a,h){var p=new Uint8Array(this.data.buffer),x=4*this._idx(a,h);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(p[x],p[x+1],p[x+2])},hc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},hc.prototype._idx=function(a,h){if(a<-1||a>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(a+1)},hc.prototype._unpackMapbox=function(a,h,p){return(256*a*256+256*h+p)/10-1e4},hc.prototype._unpackTerrarium=function(a,h,p){return 256*a+h+p/256-32768},hc.prototype.getPixels=function(){return new Ns({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},hc.prototype.backfillBorder=function(a,h,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var x=h*this.dim,E=h*this.dim+this.dim,P=p*this.dim,R=p*this.dim+this.dim;switch(h){case-1:x=E-1;break;case 1:E=x+1}switch(p){case-1:P=R-1;break;case 1:R=P+1}for(var O=-h*this.dim,k=-p*this.dim,H=P;H<R;H++)for(var X=x;X<E;X++)this.data[this._idx(X,H)]=a.data[this._idx(X+O,H+k)]},Ct("DEMData",hc);var N0=function(a){this._stringToNumber={},this._numberToString=[];for(var h=0;h<a.length;h++){var p=a[h];this._stringToNumber[p]=h,this._numberToString[h]=p}};N0.prototype.encode=function(a){return this._stringToNumber[a]},N0.prototype.decode=function(a){return this._numberToString[a]};var U0=function(a,h,p,x,E){this.type="Feature",this._vectorTileFeature=a,a._z=h,a._x=p,a._y=x,this.properties=a.properties,this.id=E},Ry={geometry:{configurable:!0}};Ry.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Ry.geometry.set=function(a){this._geometry=a},U0.prototype.toJSON=function(){var a={geometry:this.geometry};for(var h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(a[h]=this[h]);return a},Object.defineProperties(U0.prototype,Ry);var Rf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Rf.prototype.updateState=function(a,h,p){var x=String(h);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][x]=this.stateChanges[a][x]||{},Y(this.stateChanges[a][x],p),this.deletedStates[a]===null)for(var E in this.deletedStates[a]={},this.state[a])E!==x&&(this.deletedStates[a][E]=null);else if(this.deletedStates[a]&&this.deletedStates[a][x]===null)for(var P in this.deletedStates[a][x]={},this.state[a][x])p[P]||(this.deletedStates[a][x][P]=null);else for(var R in p)this.deletedStates[a]&&this.deletedStates[a][x]&&this.deletedStates[a][x][R]===null&&delete this.deletedStates[a][x][R]},Rf.prototype.removeFeatureState=function(a,h,p){if(this.deletedStates[a]!==null){var x=String(h);if(this.deletedStates[a]=this.deletedStates[a]||{},p&&h!==void 0)this.deletedStates[a][x]!==null&&(this.deletedStates[a][x]=this.deletedStates[a][x]||{},this.deletedStates[a][x][p]=null);else if(h!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][x])for(p in this.deletedStates[a][x]={},this.stateChanges[a][x])this.deletedStates[a][x][p]=null;else this.deletedStates[a][x]=null;else this.deletedStates[a]=null}},Rf.prototype.getState=function(a,h){var p=String(h),x=Y({},(this.state[a]||{})[p],(this.stateChanges[a]||{})[p]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var E=this.deletedStates[a][h];if(E===null)return{};for(var P in E)delete x[P]}return x},Rf.prototype.initializeTileState=function(a,h){a.setFeatureState(this.state,h)},Rf.prototype.coalesceChanges=function(a,h){var p={};for(var x in this.stateChanges){this.state[x]=this.state[x]||{};var E={};for(var P in this.stateChanges[x])this.state[x][P]||(this.state[x][P]={}),Y(this.state[x][P],this.stateChanges[x][P]),E[P]=this.state[x][P];p[x]=E}for(var R in this.deletedStates){this.state[R]=this.state[R]||{};var O={};if(this.deletedStates[R]===null)for(var k in this.state[R])O[k]={},this.state[R][k]={};else for(var H in this.deletedStates[R]){if(this.deletedStates[R][H]===null)this.state[R][H]={};else for(var X=0,q=Object.keys(this.deletedStates[R][H]);X<q.length;X+=1)delete this.state[R][H][q[X]];O[H]=this.state[R][H]}p[R]=p[R]||{},Y(p[R],O)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(var re in a)a[re].setFeatureState(p,h)};var fc=function(a,h){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new jo(8192,16,0),this.grid3D=new jo(8192,16,0),this.featureIndexArray=new L,this.promoteId=h};function DT(a,h,p,x,E){return pe(a,function(P,R){var O=h instanceof vl?h.get(R):null;return O&&O.evaluate?O.evaluate(p,x,E):O})}function FT(a){for(var h=1/0,p=1/0,x=-1/0,E=-1/0,P=0,R=a;P<R.length;P+=1){var O=R[P];h=Math.min(h,O.x),p=Math.min(p,O.y),x=Math.max(x,O.x),E=Math.max(E,O.y)}return{minX:h,minY:p,maxX:x,maxY:E}}function cL(a,h){return h-a}fc.prototype.insert=function(a,h,p,x,E,P){var R=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,x,E);for(var O=P?this.grid3D:this.grid,k=0;k<h.length;k++){for(var H=h[k],X=[1/0,1/0,-1/0,-1/0],q=0;q<H.length;q++){var re=H[q];X[0]=Math.min(X[0],re.x),X[1]=Math.min(X[1],re.y),X[2]=Math.max(X[2],re.x),X[3]=Math.max(X[3],re.y)}X[0]<8192&&X[1]<8192&&X[2]>=0&&X[3]>=0&&O.insert(R,X[0],X[1],X[2],X[3])}},fc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new bf.VectorTile(new C0(this.rawTileData)).layers,this.sourceLayerCoder=new N0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},fc.prototype.query=function(a,h,p,x){var E=this;this.loadVTLayers();for(var P=a.params||{},R=8192/a.tileSize/a.scale,O=Kc(P.filter),k=a.queryGeometry,H=a.queryPadding*R,X=FT(k),q=this.grid.query(X.minX-H,X.minY-H,X.maxX+H,X.maxY+H),re=FT(a.cameraQueryGeometry),ae=this.grid3D.query(re.minX-H,re.minY-H,re.maxX+H,re.maxY+H,function(Ye,et,ot,pt){return function(wt,Ht,Mt,Xt,Bt){for(var Er=0,sr=wt;Er<sr.length;Er+=1){var Ut=sr[Er];if(Ht<=Ut.x&&Mt<=Ut.y&&Xt>=Ut.x&&Bt>=Ut.y)return!0}var Br=[new w(Ht,Mt),new w(Ht,Bt),new w(Xt,Bt),new w(Xt,Mt)];if(wt.length>2){for(var vr=0,Hr=Br;vr<Hr.length;vr+=1)if(ya(wt,Hr[vr]))return!0}for(var Kt=0;Kt<wt.length-1;Kt++)if(oh(wt[Kt],wt[Kt+1],Br))return!0;return!1}(a.cameraQueryGeometry,Ye-H,et-H,ot+H,pt+H)}),ve=0,xe=ae;ve<xe.length;ve+=1)q.push(xe[ve]);q.sort(cL);for(var Be,Se={},Ne=function(Ye){var et=q[Ye];if(et!==Be){Be=et;var ot=E.featureIndexArray.get(et),pt=null;E.loadMatchingFeature(Se,ot.bucketIndex,ot.sourceLayerIndex,ot.featureIndex,O,P.layers,P.availableImages,h,p,x,function(wt,Ht,Mt){return pt||(pt=Li(wt)),Ht.queryIntersectsFeature(k,wt,Mt,pt,E.z,a.transform,R,a.pixelPosMatrix)})}},We=0;We<q.length;We++)Ne(We);return Se},fc.prototype.loadMatchingFeature=function(a,h,p,x,E,P,R,O,k,H,X){var q=this.bucketLayerIDs[h];if(!P||function(wt,Ht){for(var Mt=0;Mt<wt.length;Mt++)if(Ht.indexOf(wt[Mt])>=0)return!0;return!1}(P,q)){var re=this.sourceLayerCoder.decode(p),ae=this.vtLayers[re].feature(x);if(E.needGeometry){var ve=Qi(ae,!0);if(!E.filter(new Jt(this.tileID.overscaledZ),ve,this.tileID.canonical))return}else if(!E.filter(new Jt(this.tileID.overscaledZ),ae))return;for(var xe=this.getId(ae,re),Be=0;Be<q.length;Be++){var Se=q[Be];if(!(P&&P.indexOf(Se)<0)){var Ne=O[Se];if(Ne){var We={};xe!==void 0&&H&&(We=H.getState(Ne.sourceLayer||"_geojsonTileLayer",xe));var Ye=Y({},k[Se]);Ye.paint=DT(Ye.paint,Ne.paint,ae,We,R),Ye.layout=DT(Ye.layout,Ne.layout,ae,We,R);var et=!X||X(ae,Ne,We);if(et){var ot=new U0(ae,this.z,this.x,this.y,xe);ot.layer=Ye;var pt=a[Se];pt===void 0&&(pt=a[Se]=[]),pt.push({featureIndex:x,feature:ot,intersectionZ:et})}}}}}},fc.prototype.lookupSymbolFeatures=function(a,h,p,x,E,P,R,O){var k={};this.loadVTLayers();for(var H=Kc(E),X=0,q=a;X<q.length;X+=1)this.loadMatchingFeature(k,p,x,q[X],H,P,R,O,h);return k},fc.prototype.hasLayer=function(a){for(var h=0,p=this.bucketLayerIDs;h<p.length;h+=1)for(var x=0,E=p[h];x<E.length;x+=1)if(a===E[x])return!0;return!1},fc.prototype.getId=function(a,h){var p=a.id;return this.promoteId&&typeof(p=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]])=="boolean"&&(p=Number(p)),p},Ct("FeatureIndex",fc,{omit:["rawTileData","sourceLayerCoder"]});var On=function(a,h){this.tileID=a,this.uid=se(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};On.prototype.registerFadeDuration=function(a){var h=a+this.timeAdded;h<Ur.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)},On.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},On.prototype.loadVectorData=function(a,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var x in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(H,X){var q={};if(!X)return q;for(var re=function(){var xe=ve[ae],Be=xe.layerIds.map(function(We){return X.getLayer(We)}).filter(Boolean);if(Be.length!==0){xe.layers=Be,xe.stateDependentLayerIds&&(xe.stateDependentLayers=xe.stateDependentLayerIds.map(function(We){return Be.filter(function(Ye){return Ye.id===We})[0]}));for(var Se=0,Ne=Be;Se<Ne.length;Se+=1)q[Ne[Se].id]=xe}},ae=0,ve=H;ae<ve.length;ae+=1)re();return q}(a.buckets,h.style),this.hasSymbolBuckets=!1,this.buckets){var E=this.buckets[x];if(E instanceof si){if(this.hasSymbolBuckets=!0,!p)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var P in this.buckets){var R=this.buckets[P];if(R instanceof si&&R.hasRTLText){this.hasRTLText=!0,us.isLoading()||us.isLoaded()||rh()!=="deferred"||Ds();break}}for(var O in this.queryPadding=0,this.buckets){var k=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(O).queryRadius(k))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new u},On.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},On.prototype.getBucket=function(a){return this.buckets[a.id]},On.prototype.upload=function(a){for(var h in this.buckets){var p=this.buckets[h];p.uploadPending()&&p.upload(a)}var x=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ch(a,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ch(a,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)},On.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},On.prototype.queryRenderedFeatures=function(a,h,p,x,E,P,R,O,k,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:E,scale:P,tileSize:this.tileSize,pixelPosMatrix:H,transform:O,params:R,queryPadding:this.queryPadding*k},a,h,p):{}},On.prototype.querySourceFeatures=function(a,h){var p=this.latestFeatureIndex;if(p&&p.rawTileData){var x=p.loadVTLayers(),E=h?h.sourceLayer:"",P=x._geojsonTileLayer||x[E];if(P)for(var R=Kc(h&&h.filter),O=this.tileID.canonical,k=O.z,H=O.x,X=O.y,q={z:k,x:H,y:X},re=0;re<P.length;re++){var ae=P.feature(re);if(R.needGeometry){var ve=Qi(ae,!0);if(!R.filter(new Jt(this.tileID.overscaledZ),ve,this.tileID.canonical))continue}else if(!R.filter(new Jt(this.tileID.overscaledZ),ae))continue;var xe=p.getId(ae,E),Be=new U0(ae,k,H,X,xe);Be.tile=q,a.push(Be)}}},On.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},On.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},On.prototype.setExpiryData=function(a){var h=this.expirationTime;if(a.cacheControl){var p=gr(a.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var x=Date.now(),E=!1;if(this.expirationTime>x)E=!1;else if(h)if(this.expirationTime<h)E=!0;else{var P=this.expirationTime-h;P?this.expirationTime=x+Math.max(P,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},On.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},On.prototype.setFeatureState=function(a,h){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var p=this.latestFeatureIndex.loadVTLayers();for(var x in this.buckets)if(h.style.hasLayer(x)){var E=this.buckets[x],P=E.layers[0].sourceLayer||"_geojsonTileLayer",R=p[P],O=a[P];if(R&&O&&Object.keys(O).length!==0){E.update(O,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=h&&h.style&&h.style.getLayer(x);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(E)))}}}},On.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},On.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ur.now()},On.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},On.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Ur.now()+a},On.prototype.setDependencies=function(a,h){for(var p={},x=0,E=h;x<E.length;x+=1)p[E[x]]=!0;this.dependencies[a]=p},On.prototype.hasDependency=function(a,h){for(var p=0,x=a;p<x.length;p+=1){var E=this.dependencies[x[p]];if(E){for(var P=0,R=h;P<R.length;P+=1)if(E[R[P]])return!0}}return!1};var uu=I.performance,LT=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},uu.mark(this._marks.start)};LT.prototype.finish=function(){uu.mark(this._marks.end);var a=uu.getEntriesByName(this._marks.measure);return a.length===0&&(uu.measure(this._marks.measure,this._marks.start,this._marks.end),a=uu.getEntriesByName(this._marks.measure),uu.clearMarks(this._marks.start),uu.clearMarks(this._marks.end),uu.clearMeasures(this._marks.measure)),a},s.Actor=Mf,s.AlphaImage=lh,s.CanonicalTileID=hh,s.CollisionBoxArray=u,s.Color=pr,s.DEMData=hc,s.DataConstantProperty=jt,s.DictionaryCoder=N0,s.EXTENT=8192,s.ErrorEvent=Oe,s.EvaluationParameters=Jt,s.Event=be,s.Evented=De,s.FeatureIndex=fc,s.FillBucket=Ua,s.FillExtrusionBucket=za,s.ImageAtlas=MA,s.ImagePosition=I0,s.LineBucket=Ts,s.LngLat=wi,s.LngLatBounds=fn,s.MercatorCoordinate=uh,s.ONE_EM=24,s.OverscaledTileID=dn,s.Point=w,s.Point$1=w,s.Properties=bn,s.Protobuf=C0,s.RGBAImage=Ns,s.RequestManager=oi,s.RequestPerformance=LT,s.ResourceType=Bo,s.SegmentVector=z,s.SourceFeatureState=Rf,s.StructArrayLayout1ui2=g,s.StructArrayLayout2f1f2i16=St,s.StructArrayLayout2i4=Cr,s.StructArrayLayout3ui6=yo,s.StructArrayLayout4i8=xn,s.SymbolBucket=si,s.Texture=ch,s.Tile=On,s.Transitionable=Gi,s.Uniform1f=st,s.Uniform1i=Qe,s.Uniform2f=rt,s.Uniform3f=lt,s.Uniform4f=At,s.UniformColor=Tt,s.UniformMatrix4f=Zt,s.UnwrappedTileID=OT,s.ValidationError=we,s.WritingMode=xo,s.ZoomHistory=Qu,s.add=function(a,h,p){return a[0]=h[0]+p[0],a[1]=h[1]+p[1],a[2]=h[2]+p[2],a},s.addDynamicAttributes=Cy,s.asyncAll=function(a,h,p){if(!a.length)return p(null,[]);var x=a.length,E=new Array(a.length),P=null;a.forEach(function(R,O){h(R,function(k,H){k&&(P=k),E[O]=H,--x==0&&p(P,E)})})},s.bezier=F,s.bindAll=Ue,s.browser=Ur,s.cacheEntryPossiblyAdded=function(a){++ea>mn&&(a.getActor().send("enforceCacheSizeLimit",Di),ea=0)},s.clamp=V,s.clearTileCache=function(a){var h=I.caches.delete("mapbox-tiles");a&&h.catch(a).then(function(){return a()})},s.clipLine=mT,s.clone=function(a){var h=new Jr(16);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},s.clone$1=Ae,s.clone$2=function(a){var h=new Jr(3);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h},s.collisionCircleLayout=I6,s.config=Dt,s.create=function(){var a=new Jr(16);return Jr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},s.create$1=function(){var a=new Jr(9);return Jr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},s.create$2=function(){var a=new Jr(4);return Jr!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.createCommonjsModule=f,s.createExpression=Zc,s.createLayout=$t,s.createStyleLayer=function(a){return a.type==="custom"?new aL(a):new lL[a.type](a)},s.cross=function(a,h,p){var x=h[0],E=h[1],P=h[2],R=p[0],O=p[1],k=p[2];return a[0]=E*k-P*O,a[1]=P*R-x*k,a[2]=x*O-E*R,a},s.deepEqual=function a(h,p){if(Array.isArray(h)){if(!Array.isArray(p)||h.length!==p.length)return!1;for(var x=0;x<h.length;x++)if(!a(h[x],p[x]))return!1;return!0}if(typeof h=="object"&&h!==null&&p!==null){if(typeof p!="object"||Object.keys(h).length!==Object.keys(p).length)return!1;for(var E in h)if(!a(h[E],p[E]))return!1;return!0}return h===p},s.dot=function(a,h){return a[0]*h[0]+a[1]*h[1]+a[2]*h[2]},s.dot$1=function(a,h){return a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]},s.ease=N,s.emitValidationErrors=nc,s.endsWith=Fe,s.enforceCacheSizeLimit=function(a){Xn(),Oi&&Oi.then(function(h){h.keys().then(function(p){for(var x=0;x<p.length-a;x++)h.delete(p[x])})})},s.evaluateSizeForFeature=hT,s.evaluateSizeForZoom=fT,s.evaluateVariableOffset=vT,s.evented=th,s.extend=Y,s.featureFilter=Kc,s.filterObject=Te,s.fromRotation=function(a,h){var p=Math.sin(h),x=Math.cos(h);return a[0]=x,a[1]=p,a[2]=0,a[3]=-p,a[4]=x,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.getAnchorAlignment=wy,s.getAnchorJustification=Sy,s.getArrayBuffer=Ma,s.getImage=ee,s.getJSON=function(a,h){return yt(Y(a,{type:"json"}),h)},s.getRTLTextPluginStatus=rh,s.getReferrer=Ks,s.getVideo=function(a,h){var p,x,E=I.document.createElement("video");E.muted=!0,E.onloadstart=function(){h(null,E)};for(var P=0;P<a.length;P++){var R=I.document.createElement("source");p=a[P],x=void 0,(x=I.document.createElement("a")).href=p,(x.protocol!==I.document.location.protocol||x.host!==I.document.location.host)&&(E.crossOrigin="Anonymous"),R.src=a[P],E.appendChild(R)}return{cancel:function(){}}},s.identity=so,s.invert=function(a,h){var p=h[0],x=h[1],E=h[2],P=h[3],R=h[4],O=h[5],k=h[6],H=h[7],X=h[8],q=h[9],re=h[10],ae=h[11],ve=h[12],xe=h[13],Be=h[14],Se=h[15],Ne=p*O-x*R,We=p*k-E*R,Ye=p*H-P*R,et=x*k-E*O,ot=x*H-P*O,pt=E*H-P*k,wt=X*xe-q*ve,Ht=X*Be-re*ve,Mt=X*Se-ae*ve,Xt=q*Be-re*xe,Bt=q*Se-ae*xe,Er=re*Se-ae*Be,sr=Ne*Er-We*Bt+Ye*Xt+et*Mt-ot*Ht+pt*wt;return sr?(a[0]=(O*Er-k*Bt+H*Xt)*(sr=1/sr),a[1]=(E*Bt-x*Er-P*Xt)*sr,a[2]=(xe*pt-Be*ot+Se*et)*sr,a[3]=(re*ot-q*pt-ae*et)*sr,a[4]=(k*Mt-R*Er-H*Ht)*sr,a[5]=(p*Er-E*Mt+P*Ht)*sr,a[6]=(Be*Ye-ve*pt-Se*We)*sr,a[7]=(X*pt-re*Ye+ae*We)*sr,a[8]=(R*Bt-O*Mt+H*wt)*sr,a[9]=(x*Mt-p*Bt-P*wt)*sr,a[10]=(ve*ot-xe*Ye+Se*Ne)*sr,a[11]=(q*Ye-X*ot-ae*Ne)*sr,a[12]=(O*Ht-R*Xt-k*wt)*sr,a[13]=(p*Xt-x*Ht+E*wt)*sr,a[14]=(xe*We-ve*et-Be*Ne)*sr,a[15]=(X*et-q*We+re*Ne)*sr,a):null},s.isChar=bt,s.isMapboxURL=xi,s.keysDifference=function(a,h){var p=[];for(var x in a)x in h||p.push(x);return p},s.makeRequest=yt,s.mapObject=pe,s.mercatorXfromLng=MT,s.mercatorYfromLat=RT,s.mercatorZfromAltitude=BT,s.mul=hy,s.multiply=ws,s.mvt=bf,s.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},s.normalize=function(a,h){var p=h[0],x=h[1],E=h[2],P=p*p+x*x+E*E;return P>0&&(P=1/Math.sqrt(P)),a[0]=h[0]*P,a[1]=h[1]*P,a[2]=h[2]*P,a},s.number=Hi,s.offscreenCanvasSupported=Ia,s.ortho=function(a,h,p,x,E,P,R){var O=1/(h-p),k=1/(x-E),H=1/(P-R);return a[0]=-2*O,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*k,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*H,a[11]=0,a[12]=(h+p)*O,a[13]=(E+x)*k,a[14]=(R+P)*H,a[15]=1,a},s.parseGlyphPBF=function(a){return new C0(a).readFields(z6,[])},s.pbf=C0,s.performSymbolLayout=function(a,h,p,x,E,P,R){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var O=a.layers[0].layout,k=a.layers[0]._unevaluatedLayout._values,H={};if(a.textSizeData.kind==="composite"){var X=a.textSizeData,q=X.maxZoom;H.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Jt(X.minZoom),R),k["text-size"].possiblyEvaluate(new Jt(q),R)]}if(a.iconSizeData.kind==="composite"){var re=a.iconSizeData,ae=re.maxZoom;H.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Jt(re.minZoom),R),k["icon-size"].possiblyEvaluate(new Jt(ae),R)]}H.layoutTextSize=k["text-size"].possiblyEvaluate(new Jt(a.zoom+1),R),H.layoutIconSize=k["icon-size"].possiblyEvaluate(new Jt(a.zoom+1),R),H.textMaxSize=k["text-size"].possiblyEvaluate(new Jt(18));for(var ve=24*O.get("text-line-height"),xe=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",Be=O.get("text-keep-upright"),Se=O.get("text-size"),Ne=function(){var et=Ye[We],ot=O.get("text-font").evaluate(et,{},R).join(","),pt=Se.evaluate(et,{},R),wt=H.layoutTextSize.evaluate(et,{},R),Ht=H.layoutIconSize.evaluate(et,{},R),Mt={horizontal:{},vertical:void 0},Xt=et.text,Bt=[0,0];if(Xt){var Er=Xt.toString(),sr=24*O.get("text-letter-spacing").evaluate(et,{},R),Ut=function(Nr){for(var ci=0,ri=Nr;ci<ri.length;ci+=1)if(Xr=ri[ci].charCodeAt(0),bt.Arabic(Xr)||bt["Arabic Supplement"](Xr)||bt["Arabic Extended-A"](Xr)||bt["Arabic Presentation Forms-A"](Xr)||bt["Arabic Presentation Forms-B"](Xr))return!1;var Xr;return!0}(Er)?sr:0,Br=O.get("text-anchor").evaluate(et,{},R),vr=O.get("text-variable-anchor");if(!vr){var Hr=O.get("text-radial-offset").evaluate(et,{},R);Bt=Hr?vT(Br,[24*Hr,Ey]):O.get("text-offset").evaluate(et,{},R).map(function(Nr){return 24*Nr})}var Kt=xe?"center":O.get("text-justify").evaluate(et,{},R),Zr=O.get("symbol-placement"),Ti=Zr==="point"?24*O.get("text-max-width").evaluate(et,{},R):0,Xi=function(){a.allowVerticalPlacement&&tu(Er)&&(Mt.vertical=M0(Xt,h,p,E,ot,Ti,ve,Br,"left",Ut,Bt,xo.vertical,!0,Zr,wt,pt))};if(!xe&&vr){for(var ki=Kt==="auto"?vr.map(function(Nr){return Sy(Nr)}):[Kt],Ei=!1,qi=0;qi<ki.length;qi++){var En=ki[qi];if(!Mt.horizontal[En])if(Ei)Mt.horizontal[En]=Mt.horizontal[0];else{var Sn=M0(Xt,h,p,E,ot,Ti,ve,"center",En,Ut,Bt,xo.horizontal,!1,Zr,wt,pt);Sn&&(Mt.horizontal[En]=Sn,Ei=Sn.positionedLines.length===1)}}Xi()}else{Kt==="auto"&&(Kt=Sy(Br));var As=M0(Xt,h,p,E,ot,Ti,ve,Br,Kt,Ut,Bt,xo.horizontal,!1,Zr,wt,pt);As&&(Mt.horizontal[Kt]=As),Xi(),tu(Er)&&xe&&Be&&(Mt.vertical=M0(Xt,h,p,E,ot,Ti,ve,Br,Kt,Ut,Bt,xo.vertical,!1,Zr,wt,pt))}}var Dn=void 0,ps=!1;if(et.icon&&et.icon.name){var en=x[et.icon.name];en&&(Dn=function(Nr,ci,ri){var Xr=wy(ri),Es=ci[0]-Nr.displaySize[0]*Xr.horizontalAlign,Qn=ci[1]-Nr.displaySize[1]*Xr.verticalAlign;return{image:Nr,top:Qn,bottom:Qn+Nr.displaySize[1],left:Es,right:Es+Nr.displaySize[0]}}(E[et.icon.name],O.get("icon-offset").evaluate(et,{},R),O.get("icon-anchor").evaluate(et,{},R)),ps=en.sdf,a.sdfIcons===void 0?a.sdfIcons=en.sdf:a.sdfIcons!==en.sdf&&Ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(en.pixelRatio!==a.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Fn=xT(Mt.horizontal)||Mt.vertical;a.iconsInText=!!Fn&&Fn.iconsInText,(Fn||Dn)&&function(Nr,ci,ri,Xr,Es,Qn,bi,sn,es,Kr,Tl){var wo=Qn.textMaxSize.evaluate(ci,{});wo===void 0&&(wo=bi);var El,tn=Nr.layers[0].layout,Sl=tn.get("icon-offset").evaluate(ci,{},Tl),ba=xT(ri.horizontal),Bf=bi/24,fh=Nr.tilePixelRatio*Bf,Of=Nr.tilePixelRatio*wo/24,dc=Nr.tilePixelRatio*sn,Df=Nr.tilePixelRatio*tn.get("symbol-spacing"),z0=tn.get("text-padding")*Nr.tilePixelRatio,Ff=tn.get("icon-padding")*Nr.tilePixelRatio,OA=tn.get("text-max-angle")/180*Math.PI,V0=tn.get("text-rotation-alignment")==="map"&&tn.get("symbol-placement")!=="point",j0=tn.get("icon-rotation-alignment")==="map"&&tn.get("symbol-placement")!=="point",Ac=tn.get("symbol-placement"),DA=Df/2,Lf=tn.get("icon-text-fit");Xr&&Lf!=="none"&&(Nr.allowVerticalPlacement&&ri.vertical&&(El=uT(Xr,ri.vertical,Lf,tn.get("icon-text-fit-padding"),Sl,Bf)),ba&&(Xr=uT(Xr,ba,Lf,tn.get("icon-text-fit-padding"),Sl,Bf)));var hu=function(uL,jA){jA.x<0||jA.x>=8192||jA.y<0||jA.y>=8192||function(rn,Va,hL,fu,Fy,UT,$0,Cl,Z0,HA,K0,Y0,Ly,zT,GA,VT,jT,HT,GT,WT,To,J0,XT,Pl,fL){var qT,Ah,Vf,jf,Hf,Gf=rn.addToLineVertexArray(Va,hL),$T=0,ZT=0,KT=0,YT=0,ky=-1,Ny=-1,pc={},JT=K(""),Uy=0,zy=0;if(Cl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Uy=(qT=Cl.layout.get("text-offset").evaluate(To,{},Pl).map(function(XA){return 24*XA}))[0],zy=qT[1]):(Uy=24*Cl.layout.get("text-radial-offset").evaluate(To,{},Pl),zy=Ey),rn.allowVerticalPlacement&&fu.vertical){var QT=Cl.layout.get("text-rotate").evaluate(To,{},Pl)+90;jf=new F0(Z0,Va,HA,K0,Y0,fu.vertical,Ly,zT,GA,QT),$0&&(Hf=new F0(Z0,Va,HA,K0,Y0,$0,jT,HT,GA,QT))}if(Fy){var Vy=Cl.layout.get("icon-rotate").evaluate(To,{}),eE=Cl.layout.get("icon-text-fit")!=="none",tE=_T(Fy,Vy,XT,eE),jy=$0?_T($0,Vy,XT,eE):void 0;Vf=new F0(Z0,Va,HA,K0,Y0,Fy,jT,HT,!1,Vy),$T=4*tE.length;var rE=rn.iconSizeData,WA=null;rE.kind==="source"?(WA=[128*Cl.layout.get("icon-size").evaluate(To,{})])[0]>32640&&Ve(rn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):rE.kind==="composite"&&((WA=[128*J0.compositeIconSizes[0].evaluate(To,{},Pl),128*J0.compositeIconSizes[1].evaluate(To,{},Pl)])[0]>32640||WA[1]>32640)&&Ve(rn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),rn.addSymbols(rn.icon,tE,WA,WT,GT,To,!1,Va,Gf.lineStartIndex,Gf.lineLength,-1,Pl),ky=rn.icon.placedSymbolArray.length-1,jy&&(ZT=4*jy.length,rn.addSymbols(rn.icon,jy,WA,WT,GT,To,xo.vertical,Va,Gf.lineStartIndex,Gf.lineLength,-1,Pl),Ny=rn.icon.placedSymbolArray.length-1)}for(var iE in fu.horizontal){var Q0=fu.horizontal[iE];if(!Ah){JT=K(Q0.text);var dL=Cl.layout.get("text-rotate").evaluate(To,{},Pl);Ah=new F0(Z0,Va,HA,K0,Y0,Q0,Ly,zT,GA,dL)}var nE=Q0.positionedLines.length===1;if(KT+=bT(rn,Va,Q0,UT,Cl,GA,To,VT,Gf,fu.vertical?xo.horizontal:xo.horizontalOnly,nE?Object.keys(fu.horizontal):[iE],pc,ky,J0,Pl),nE)break}fu.vertical&&(YT+=bT(rn,Va,fu.vertical,UT,Cl,GA,To,VT,Gf,xo.vertical,["vertical"],pc,Ny,J0,Pl));var AL=Ah?Ah.boxStartIndex:rn.collisionBoxArray.length,pL=Ah?Ah.boxEndIndex:rn.collisionBoxArray.length,gL=jf?jf.boxStartIndex:rn.collisionBoxArray.length,mL=jf?jf.boxEndIndex:rn.collisionBoxArray.length,_L=Vf?Vf.boxStartIndex:rn.collisionBoxArray.length,yL=Vf?Vf.boxEndIndex:rn.collisionBoxArray.length,vL=Hf?Hf.boxStartIndex:rn.collisionBoxArray.length,bL=Hf?Hf.boxEndIndex:rn.collisionBoxArray.length,Il=-1,eg=function(XA,oE){return XA&&XA.circleDiameter?Math.max(XA.circleDiameter,oE):oE};Il=eg(Ah,Il),Il=eg(jf,Il),Il=eg(Vf,Il);var sE=(Il=eg(Hf,Il))>-1?1:0;sE&&(Il*=fL/24),rn.glyphOffsetArray.length>=si.MAX_GLYPHS&&Ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),To.sortKey!==void 0&&rn.addToSortKeyRanges(rn.symbolInstances.length,To.sortKey),rn.symbolInstances.emplaceBack(Va.x,Va.y,pc.right>=0?pc.right:-1,pc.center>=0?pc.center:-1,pc.left>=0?pc.left:-1,pc.vertical||-1,ky,Ny,JT,AL,pL,gL,mL,_L,yL,vL,bL,HA,KT,YT,$T,ZT,sE,0,Ly,Uy,zy,Il)}(Nr,jA,uL,ri,Xr,Es,El,Nr.layers[0],Nr.collisionBoxArray,ci.index,ci.sourceLayerIndex,Nr.index,fh,z0,V0,es,dc,Ff,j0,Sl,ci,Qn,Kr,Tl,bi)};if(Ac==="line")for(var kf=0,H0=mT(ci.geometry,0,0,8192,8192);kf<H0.length;kf+=1)for(var G0=H0[kf],FA=0,LA=q6(G0,Df,OA,ri.vertical||ba,Xr,24,Of,Nr.overscaling,8192);FA<LA.length;FA+=1){var W0=LA[FA];ba&&Y6(Nr,ba.text,DA,W0)||hu(G0,W0)}else if(Ac==="line-center")for(var kA=0,NA=ci.geometry;kA<NA.length;kA+=1){var UA=NA[kA];if(UA.length>1){var X0=X6(UA,OA,ri.vertical||ba,Xr,24,Of);X0&&hu(UA,X0)}}else if(ci.type==="Polygon")for(var Nf=0,q0=_y(ci.geometry,0);Nf<q0.length;Nf+=1){var Uf=q0[Nf],zA=Z6(Uf,16);hu(Uf[0],new Ef(zA.x,zA.y,0))}else if(ci.type==="LineString")for(var dh=0,VA=ci.geometry;dh<VA.length;dh+=1){var zf=VA[dh];hu(zf,new Ef(zf[0].x,zf[0].y,0))}else if(ci.type==="Point")for(var By=0,kT=ci.geometry;By<kT.length;By+=1)for(var Oy=0,NT=kT[By];Oy<NT.length;Oy+=1){var Dy=NT[Oy];hu([Dy],new Ef(Dy.x,Dy.y,0))}}(a,et,Mt,Dn,x,H,wt,Ht,Bt,ps,R)},We=0,Ye=a.features;We<Ye.length;We+=1)Ne();P&&a.generateCollisionDebugBuffers()},s.perspective=function(a,h,p,x,E){var P,R=1/Math.tan(h/2);return a[0]=R/p,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=R,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,E!=null&&E!==1/0?(a[10]=(E+x)*(P=1/(x-E)),a[14]=2*E*x*P):(a[10]=-1,a[14]=-2*x),a},s.pick=function(a,h){for(var p={},x=0;x<h.length;x++){var E=h[x];E in a&&(p[E]=a[E])}return p},s.plugin=us,s.polygonIntersectsPolygon=bl,s.postMapLoadEvent=kn,s.postTurnstileEvent=Mr,s.potpack=oT,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=Ct,s.registerForPluginStateChange=function(a){return a({pluginStatus:cs,pluginURL:Ho}),th.on("pluginStateChange",a),a},s.renderColorRamp=Vw,s.rotate=function(a,h,p){var x=h[0],E=h[1],P=h[2],R=h[3],O=Math.sin(p),k=Math.cos(p);return a[0]=x*k+P*O,a[1]=E*k+R*O,a[2]=x*-O+P*k,a[3]=E*-O+R*k,a},s.rotateX=function(a,h,p){var x=Math.sin(p),E=Math.cos(p),P=h[4],R=h[5],O=h[6],k=h[7],H=h[8],X=h[9],q=h[10],re=h[11];return h!==a&&(a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15]),a[4]=P*E+H*x,a[5]=R*E+X*x,a[6]=O*E+q*x,a[7]=k*E+re*x,a[8]=H*E-P*x,a[9]=X*E-R*x,a[10]=q*E-O*x,a[11]=re*E-k*x,a},s.rotateZ=function(a,h,p){var x=Math.sin(p),E=Math.cos(p),P=h[0],R=h[1],O=h[2],k=h[3],H=h[4],X=h[5],q=h[6],re=h[7];return h!==a&&(a[8]=h[8],a[9]=h[9],a[10]=h[10],a[11]=h[11],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15]),a[0]=P*E+H*x,a[1]=R*E+X*x,a[2]=O*E+q*x,a[3]=k*E+re*x,a[4]=H*E-P*x,a[5]=X*E-R*x,a[6]=q*E-O*x,a[7]=re*E-k*x,a},s.scale=function(a,h,p){var x=p[0],E=p[1],P=p[2];return a[0]=h[0]*x,a[1]=h[1]*x,a[2]=h[2]*x,a[3]=h[3]*x,a[4]=h[4]*E,a[5]=h[5]*E,a[6]=h[6]*E,a[7]=h[7]*E,a[8]=h[8]*P,a[9]=h[9]*P,a[10]=h[10]*P,a[11]=h[11]*P,a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15],a},s.scale$1=function(a,h,p){return a[0]=h[0]*p,a[1]=h[1]*p,a[2]=h[2]*p,a[3]=h[3]*p,a},s.scale$2=function(a,h,p){return a[0]=h[0]*p,a[1]=h[1]*p,a[2]=h[2]*p,a},s.setCacheLimits=function(a,h){Di=a,mn=h},s.setRTLTextPlugin=function(a,h,p){if(p===void 0&&(p=!1),cs==="deferred"||cs==="loading"||cs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ho=Ur.resolveURL(a),cs="deferred",iu=h,oc(),p||Ds()},s.sphericalToCartesian=function(a){var h=a[0],p=a[1],x=a[2];return p+=90,p*=Math.PI/180,x*=Math.PI/180,{x:h*Math.cos(p)*Math.sin(x),y:h*Math.sin(p)*Math.sin(x),z:h*Math.cos(x)}},s.sqrLen=function(a){var h=a[0],p=a[1];return h*h+p*p},s.styleSpec=ce,s.sub=function(a,h,p){return a[0]=h[0]-p[0],a[1]=h[1]-p[1],a[2]=h[2]-p[2],a},s.symbolSize=W6,s.transformMat3=function(a,h,p){var x=h[0],E=h[1],P=h[2];return a[0]=x*p[0]+E*p[3]+P*p[6],a[1]=x*p[1]+E*p[4]+P*p[7],a[2]=x*p[2]+E*p[5]+P*p[8],a},s.transformMat4=mf,s.translate=function(a,h,p){var x,E,P,R,O,k,H,X,q,re,ae,ve,xe=p[0],Be=p[1],Se=p[2];return h===a?(a[12]=h[0]*xe+h[4]*Be+h[8]*Se+h[12],a[13]=h[1]*xe+h[5]*Be+h[9]*Se+h[13],a[14]=h[2]*xe+h[6]*Be+h[10]*Se+h[14],a[15]=h[3]*xe+h[7]*Be+h[11]*Se+h[15]):(E=h[1],P=h[2],R=h[3],O=h[4],k=h[5],H=h[6],X=h[7],q=h[8],re=h[9],ae=h[10],ve=h[11],a[0]=x=h[0],a[1]=E,a[2]=P,a[3]=R,a[4]=O,a[5]=k,a[6]=H,a[7]=X,a[8]=q,a[9]=re,a[10]=ae,a[11]=ve,a[12]=x*xe+O*Be+q*Se+h[12],a[13]=E*xe+k*Be+re*Se+h[13],a[14]=P*xe+H*Be+ae*Se+h[14],a[15]=R*xe+X*Be+ve*Se+h[15]),a},s.triggerPluginCompletionEvent=gf,s.uniqueId=se,s.validateCustomStyleLayer=function(a){var h=[],p=a.id;return p===void 0&&h.push({message:"layers."+p+': missing required property "id"'}),a.render===void 0&&h.push({message:"layers."+p+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&h.push({message:"layers."+p+': property "renderingMode" must be either "2d" or "3d"'}),h},s.validateLight=vA,s.validateStyle=rc,s.values=function(a){var h=[];for(var p in a)h.push(a[p]);return h},s.vectorTile=bf,s.version="1.13.3",s.warnOnce=Ve,s.webpSupported=$r,s.window=I,s.wrap=G}),o(["./shared"],function(s){function f($){var ee=typeof $;if(ee==="number"||ee==="boolean"||ee==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){for(var oe="[",fe=0,be=$;fe<be.length;fe+=1)oe+=f(be[fe])+",";return oe+"]"}for(var Oe=Object.keys($).sort(),De="{",ce=0;ce<Oe.length;ce++)De+=JSON.stringify(Oe[ce])+":"+f($[Oe[ce]])+",";return De+"}"}function A($){for(var ee="",oe=0,fe=s.refProperties;oe<fe.length;oe+=1)ee+="/"+f($[fe[oe]]);return ee}var v=function($){this.keyCache={},$&&this.replace($)};v.prototype.replace=function($){this._layerConfigs={},this._layers={},this.update($,[])},v.prototype.update=function($,ee){for(var oe=this,fe=0,be=$;fe<be.length;fe+=1){var Oe=be[fe];this._layerConfigs[Oe.id]=Oe;var De=this._layers[Oe.id]=s.createStyleLayer(Oe);De._featureFilter=s.featureFilter(De.filter),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id]}for(var ce=0,we=ee;ce<we.length;ce+=1){var he=we[ce];delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he]}this.familiesBySource={};for(var Re=0,ze=function(nt,at){for(var er={},ct=0;ct<nt.length;ct++){var It=at&&at[nt[ct].id]||A(nt[ct]);at&&(at[nt[ct].id]=It);var Ir=er[It];Ir||(Ir=er[It]=[]),Ir.push(nt[ct])}var yr=[];for(var Lr in er)yr.push(er[Lr]);return yr}(s.values(this._layerConfigs),this.keyCache);Re<ze.length;Re+=1){var ke=ze[Re].map(function(nt){return oe._layers[nt.id]}),_=ke[0];if(_.visibility!=="none"){var ne=_.source||"",ht=this.familiesBySource[ne];ht||(ht=this.familiesBySource[ne]={});var qe=_.sourceLayer||"_geojsonTileLayer",gt=ht[qe];gt||(gt=ht[qe]=[]),gt.push(ke)}}};var w=function($){var ee={},oe=[];for(var fe in $){var be=$[fe],Oe=ee[fe]={};for(var De in be){var ce=be[+De];if(ce&&ce.bitmap.width!==0&&ce.bitmap.height!==0){var we={x:0,y:0,w:ce.bitmap.width+2,h:ce.bitmap.height+2};oe.push(we),Oe[De]={rect:we,metrics:ce.metrics}}}}var he=s.potpack(oe),Re=new s.AlphaImage({width:he.w||1,height:he.h||1});for(var ze in $){var ke=$[ze];for(var _ in ke){var ne=ke[+_];if(ne&&ne.bitmap.width!==0&&ne.bitmap.height!==0){var ht=ee[ze][_].rect;s.AlphaImage.copy(ne.bitmap,Re,{x:0,y:0},{x:ht.x+1,y:ht.y+1},ne.bitmap)}}}this.image=Re,this.positions=ee};s.register("GlyphAtlas",w);var C=function($){this.tileID=new s.OverscaledTileID($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.uid=$.uid,this.zoom=$.zoom,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.returnDependencies=!!$.returnDependencies,this.promoteId=$.promoteId};function I($,ee,oe){for(var fe=new s.EvaluationParameters(ee),be=0,Oe=$;be<Oe.length;be+=1)Oe[be].recalculate(fe,oe)}function B($,ee){var oe=s.getArrayBuffer($.request,function(fe,be,Oe,De){fe?ee(fe):be&&ee(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(be)),rawData:be,cacheControl:Oe,expires:De})});return function(){oe.cancel(),ee()}}C.prototype.parse=function($,ee,oe,fe,be){var Oe=this;this.status="parsing",this.data=$,this.collisionBoxArray=new s.CollisionBoxArray;var De=new s.DictionaryCoder(Object.keys($.layers).sort()),ce=new s.FeatureIndex(this.tileID,this.promoteId);ce.bucketLayerIDs=[];var we,he,Re,ze,ke={},_={featureIndex:ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:oe},ne=ee.familiesBySource[this.source];for(var ht in ne){var qe=$.layers[ht];if(qe){qe.version===1&&s.warnOnce('Vector tile source "'+this.source+'" layer "'+ht+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var gt=De.encode(ht),nt=[],at=0;at<qe.length;at++){var er=qe.feature(at),ct=ce.getId(er,ht);nt.push({feature:er,id:ct,index:at,sourceLayerIndex:gt})}for(var It=0,Ir=ne[ht];It<Ir.length;It+=1){var yr=Ir[It],Lr=yr[0];Lr.minzoom&&this.zoom<Math.floor(Lr.minzoom)||Lr.maxzoom&&this.zoom>=Lr.maxzoom||Lr.visibility!=="none"&&(I(yr,this.zoom,oe),(ke[Lr.id]=Lr.createBucket({index:ce.bucketLayerIDs.length,layers:yr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:gt,sourceID:this.source})).populate(nt,_,this.tileID.canonical),ce.bucketLayerIDs.push(yr.map(function(zr){return zr.id})))}}}var ur=s.mapObject(_.glyphDependencies,function(zr){return Object.keys(zr).map(Number)});Object.keys(ur).length?fe.send("getGlyphs",{uid:this.uid,stacks:ur},function(zr,Ar){we||(we=zr,he=Ar,Fr.call(Oe))}):he={};var Yr=Object.keys(_.iconDependencies);Yr.length?fe.send("getImages",{icons:Yr,source:this.source,tileID:this.tileID,type:"icons"},function(zr,Ar){we||(we=zr,Re=Ar,Fr.call(Oe))}):Re={};var xr=Object.keys(_.patternDependencies);function Fr(){if(we)return be(we);if(he&&Re&&ze){var zr=new w(he),Ar=new s.ImageAtlas(Re,ze);for(var pr in ke){var ir=ke[pr];ir instanceof s.SymbolBucket?(I(ir.layers,this.zoom,oe),s.performSymbolLayout(ir,he,zr.positions,Re,Ar.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ir.hasPattern&&(ir instanceof s.LineBucket||ir instanceof s.FillBucket||ir instanceof s.FillExtrusionBucket)&&(I(ir.layers,this.zoom,oe),ir.addFeatures(_,this.tileID.canonical,Ar.patternPositions))}this.status="done",be(null,{buckets:s.values(ke).filter(function(me){return!me.isEmpty()}),featureIndex:ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zr.image,imageAtlas:Ar,glyphMap:this.returnDependencies?he:null,iconMap:this.returnDependencies?Re:null,glyphPositions:this.returnDependencies?zr.positions:null})}}xr.length?fe.send("getImages",{icons:xr,source:this.source,tileID:this.tileID,type:"patterns"},function(zr,Ar){we||(we=zr,ze=Ar,Fr.call(Oe))}):ze={},Fr.call(this)};var F=function($,ee,oe,fe){this.actor=$,this.layerIndex=ee,this.availableImages=oe,this.loadVectorData=fe||B,this.loading={},this.loaded={}};F.prototype.loadTile=function($,ee){var oe=this,fe=$.uid;this.loading||(this.loading={});var be=!!($&&$.request&&$.request.collectResourceTiming)&&new s.RequestPerformance($.request),Oe=this.loading[fe]=new C($);Oe.abort=this.loadVectorData($,function(De,ce){if(delete oe.loading[fe],De||!ce)return Oe.status="done",oe.loaded[fe]=Oe,ee(De);var we=ce.rawData,he={};ce.expires&&(he.expires=ce.expires),ce.cacheControl&&(he.cacheControl=ce.cacheControl);var Re={};if(be){var ze=be.finish();ze&&(Re.resourceTiming=JSON.parse(JSON.stringify(ze)))}Oe.vectorTile=ce.vectorTile,Oe.parse(ce.vectorTile,oe.layerIndex,oe.availableImages,oe.actor,function(ke,_){if(ke||!_)return ee(ke);ee(null,s.extend({rawTileData:we.slice(0)},_,he,Re))}),oe.loaded=oe.loaded||{},oe.loaded[fe]=Oe})},F.prototype.reloadTile=function($,ee){var oe=this,fe=this.loaded,be=$.uid,Oe=this;if(fe&&fe[be]){var De=fe[be];De.showCollisionBoxes=$.showCollisionBoxes;var ce=function(we,he){var Re=De.reloadCallback;Re&&(delete De.reloadCallback,De.parse(De.vectorTile,Oe.layerIndex,oe.availableImages,Oe.actor,Re)),ee(we,he)};De.status==="parsing"?De.reloadCallback=ce:De.status==="done"&&(De.vectorTile?De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,ce):ce())}},F.prototype.abortTile=function($,ee){var oe=this.loading,fe=$.uid;oe&&oe[fe]&&oe[fe].abort&&(oe[fe].abort(),delete oe[fe]),ee()},F.prototype.removeTile=function($,ee){var oe=this.loaded,fe=$.uid;oe&&oe[fe]&&delete oe[fe],ee()};var N=s.window.ImageBitmap,V=function(){this.loaded={}};function G($,ee){if($.length!==0){Y($[0],ee);for(var oe=1;oe<$.length;oe++)Y($[oe],!ee)}}function Y($,ee){for(var oe=0,fe=0,be=0,Oe=$.length,De=Oe-1;be<Oe;De=be++){var ce=($[be][0]-$[De][0])*($[De][1]+$[be][1]),we=oe+ce;fe+=Math.abs(oe)>=Math.abs(ce)?oe-we+ce:ce-we+oe,oe=we}oe+fe>=0!=!!ee&&$.reverse()}V.prototype.loadTile=function($,ee){var oe=$.uid,fe=$.encoding,be=$.rawImageData,Oe=N&&be instanceof N?this.getImageData(be):be,De=new s.DEMData(oe,Oe,fe);this.loaded=this.loaded||{},this.loaded[oe]=De,ee(null,De)},V.prototype.getImageData=function($){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);var ee=this.offscreenCanvasContext.getImageData(-1,-1,$.width+2,$.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:ee.width,height:ee.height},ee.data)},V.prototype.removeTile=function($){var ee=this.loaded,oe=$.uid;ee&&ee[oe]&&delete ee[oe]};var Z=s.vectorTile.VectorTileFeature.prototype.toGeoJSON,se=function($){this._feature=$,this.extent=s.EXTENT,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))};se.prototype.loadGeometry=function(){if(this._feature.type===1){for(var $=[],ee=0,oe=this._feature.geometry;ee<oe.length;ee+=1){var fe=oe[ee];$.push([new s.Point$1(fe[0],fe[1])])}return $}for(var be=[],Oe=0,De=this._feature.geometry;Oe<De.length;Oe+=1){for(var ce=[],we=0,he=De[Oe];we<he.length;we+=1){var Re=he[we];ce.push(new s.Point$1(Re[0],Re[1]))}be.push(ce)}return be},se.prototype.toGeoJSON=function($,ee,oe){return Z.call(this,$,ee,oe)};var ge=function($){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=$.length,this._features=$};ge.prototype.feature=function($){return new se(this._features[$])};var Pe=s.vectorTile.VectorTileFeature,Ue=Fe;function Fe($,ee){this.options=ee||{},this.features=$,this.length=$.length}function pe($,ee){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=ee||4096}Fe.prototype.feature=function($){return new pe(this.features[$],this.options.extent)},pe.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var ee=0;ee<$.length;ee++){for(var oe=$[ee],fe=[],be=0;be<oe.length;be++)fe.push(new s.Point$1(oe[be][0],oe[be][1]));this.geometry.push(fe)}return this.geometry},pe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,ee=1/0,oe=-1/0,fe=1/0,be=-1/0,Oe=0;Oe<$.length;Oe++)for(var De=$[Oe],ce=0;ce<De.length;ce++){var we=De[ce];ee=Math.min(ee,we.x),oe=Math.max(oe,we.x),fe=Math.min(fe,we.y),be=Math.max(be,we.y)}return[ee,fe,oe,be]},pe.prototype.toGeoJSON=Pe.prototype.toGeoJSON;var Te=Le,Ae=Ue;function Le($){var ee=new s.pbf;return function(oe,fe){for(var be in oe.layers)fe.writeMessage(3,Ve,oe.layers[be])}($,ee),ee.finish()}function Ve($,ee){var oe;ee.writeVarintField(15,$.version||1),ee.writeStringField(1,$.name||""),ee.writeVarintField(5,$.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<$.length;oe++)fe.feature=$.feature(oe),ee.writeMessage(2,Xe,fe);var be=fe.keys;for(oe=0;oe<be.length;oe++)ee.writeStringField(3,be[oe]);var Oe=fe.values;for(oe=0;oe<Oe.length;oe++)ee.writeMessage(4,_r,Oe[oe])}function Xe($,ee){var oe=$.feature;oe.id!==void 0&&ee.writeVarintField(1,oe.id),ee.writeMessage(2,dt,$),ee.writeVarintField(3,oe.type),ee.writeMessage(4,mr,oe)}function dt($,ee){var oe=$.feature,fe=$.keys,be=$.values,Oe=$.keycache,De=$.valuecache;for(var ce in oe.properties){var we=Oe[ce];we===void 0&&(fe.push(ce),Oe[ce]=we=fe.length-1),ee.writeVarint(we);var he=oe.properties[ce],Re=typeof he;Re!=="string"&&Re!=="boolean"&&Re!=="number"&&(he=JSON.stringify(he));var ze=Re+":"+he,ke=De[ze];ke===void 0&&(be.push(he),De[ze]=ke=be.length-1),ee.writeVarint(ke)}}function Nt($,ee){return(ee<<3)+(7&$)}function gr($){return $<<1^$>>31}function mr($,ee){for(var oe=$.loadGeometry(),fe=$.type,be=0,Oe=0,De=oe.length,ce=0;ce<De;ce++){var we=oe[ce],he=1;fe===1&&(he=we.length),ee.writeVarint(Nt(1,he));for(var Re=fe===3?we.length-1:we.length,ze=0;ze<Re;ze++){ze===1&&fe!==1&&ee.writeVarint(Nt(2,Re-1));var ke=we[ze].x-be,_=we[ze].y-Oe;ee.writeVarint(gr(ke)),ee.writeVarint(gr(_)),be+=ke,Oe+=_}fe===3&&ee.writeVarint(Nt(7,1))}}function _r($,ee){var oe=typeof $;oe==="string"?ee.writeStringField(1,$):oe==="boolean"?ee.writeBooleanField(7,$):oe==="number"&&($%1!=0?ee.writeDoubleField(3,$):$<0?ee.writeSVarintField(6,$):ee.writeVarintField(5,$))}function rr($,ee,oe,fe){Ot($,oe,fe),Ot(ee,2*oe,2*fe),Ot(ee,2*oe+1,2*fe+1)}function Ot($,ee,oe){var fe=$[ee];$[ee]=$[oe],$[oe]=fe}function Qt($,ee,oe,fe){var be=$-oe,Oe=ee-fe;return be*be+Oe*Oe}Te.fromVectorTileJs=Le,Te.fromGeojsonVt=function($,ee){ee=ee||{};var oe={};for(var fe in $)oe[fe]=new Ue($[fe].features,ee),oe[fe].name=fe,oe[fe].version=ee.version,oe[fe].extent=ee.extent;return Le({layers:oe})},Te.GeoJSONWrapper=Ae;var qt=function($){return $[0]},Rt=function($){return $[1]},ut=function($,ee,oe,fe,be){ee===void 0&&(ee=qt),oe===void 0&&(oe=Rt),fe===void 0&&(fe=64),be===void 0&&(be=Float64Array),this.nodeSize=fe,this.points=$;for(var Oe=$.length<65536?Uint16Array:Uint32Array,De=this.ids=new Oe($.length),ce=this.coords=new be(2*$.length),we=0;we<$.length;we++)De[we]=we,ce[2*we]=ee($[we]),ce[2*we+1]=oe($[we]);(function he(Re,ze,ke,_,ne,ht){if(!(ne-_<=ke)){var qe=_+ne>>1;(function gt(nt,at,er,ct,It,Ir){for(;It>ct;){if(It-ct>600){var yr=It-ct+1,Lr=er-ct+1,ur=Math.log(yr),Yr=.5*Math.exp(2*ur/3),xr=.5*Math.sqrt(ur*Yr*(yr-Yr)/yr)*(Lr-yr/2<0?-1:1);gt(nt,at,er,Math.max(ct,Math.floor(er-Lr*Yr/yr+xr)),Math.min(It,Math.floor(er+(yr-Lr)*Yr/yr+xr)),Ir)}var Fr=at[2*er+Ir],zr=ct,Ar=It;for(rr(nt,at,ct,er),at[2*It+Ir]>Fr&&rr(nt,at,ct,It);zr<Ar;){for(rr(nt,at,zr,Ar),zr++,Ar--;at[2*zr+Ir]<Fr;)zr++;for(;at[2*Ar+Ir]>Fr;)Ar--}at[2*ct+Ir]===Fr?rr(nt,at,ct,Ar):rr(nt,at,++Ar,It),Ar<=er&&(ct=Ar+1),er<=Ar&&(It=Ar-1)}})(Re,ze,qe,_,ne,ht%2),he(Re,ze,ke,_,qe-1,ht+1),he(Re,ze,ke,qe+1,ne,ht+1)}})(De,ce,fe,0,De.length-1,0)};ut.prototype.range=function($,ee,oe,fe){return function(be,Oe,De,ce,we,he,Re){for(var ze,ke,_=[0,be.length-1,0],ne=[];_.length;){var ht=_.pop(),qe=_.pop(),gt=_.pop();if(qe-gt<=Re)for(var nt=gt;nt<=qe;nt++)ke=Oe[2*nt+1],(ze=Oe[2*nt])>=De&&ze<=we&&ke>=ce&&ke<=he&&ne.push(be[nt]);else{var at=Math.floor((gt+qe)/2);ke=Oe[2*at+1],(ze=Oe[2*at])>=De&&ze<=we&&ke>=ce&&ke<=he&&ne.push(be[at]);var er=(ht+1)%2;(ht===0?De<=ze:ce<=ke)&&(_.push(gt),_.push(at-1),_.push(er)),(ht===0?we>=ze:he>=ke)&&(_.push(at+1),_.push(qe),_.push(er))}}return ne}(this.ids,this.coords,$,ee,oe,fe,this.nodeSize)},ut.prototype.within=function($,ee,oe){return function(fe,be,Oe,De,ce,we){for(var he=[0,fe.length-1,0],Re=[],ze=ce*ce;he.length;){var ke=he.pop(),_=he.pop(),ne=he.pop();if(_-ne<=we)for(var ht=ne;ht<=_;ht++)Qt(be[2*ht],be[2*ht+1],Oe,De)<=ze&&Re.push(fe[ht]);else{var qe=Math.floor((ne+_)/2),gt=be[2*qe],nt=be[2*qe+1];Qt(gt,nt,Oe,De)<=ze&&Re.push(fe[qe]);var at=(ke+1)%2;(ke===0?Oe-ce<=gt:De-ce<=nt)&&(he.push(ne),he.push(qe-1),he.push(at)),(ke===0?Oe+ce>=gt:De+ce>=nt)&&(he.push(qe+1),he.push(_),he.push(at))}}return Re}(this.ids,this.coords,$,ee,oe,this.nodeSize)};var Vi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function($){return $}},Sr=function($){this.options=gn(Object.create(Vi),$),this.trees=new Array(this.options.maxZoom+1)};function Ur($,ee,oe,fe,be){return{x:$,y:ee,zoom:1/0,id:oe,parentId:-1,numPoints:fe,properties:be}}function Dt($,ee){var oe=$.geometry.coordinates,fe=oe[1];return{x:yi(oe[0]),y:dr(fe),zoom:1/0,index:ee,parentId:-1}}function $r($){return{type:"Feature",id:$.id,properties:Pi($),geometry:{type:"Point",coordinates:[(fe=$.x,360*(fe-.5)),(ee=$.y,oe=(180-360*ee)*Math.PI/180,360*Math.atan(Math.exp(oe))/Math.PI-90)]}};var ee,oe,fe}function Pi($){var ee=$.numPoints,oe=ee>=1e4?Math.round(ee/1e3)+"k":ee>=1e3?Math.round(ee/100)/10+"k":ee;return gn(gn({},$.properties),{cluster:!0,cluster_id:$.id,point_count:ee,point_count_abbreviated:oe})}function yi($){return $/360+.5}function dr($){var ee=Math.sin($*Math.PI/180),oe=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return oe<0?0:oe>1?1:oe}function gn($,ee){for(var oe in ee)$[oe]=ee[oe];return $}function oi($){return $.x}function xi($){return $.y}function an($,ee,oe,fe,be,Oe){var De=be-oe,ce=Oe-fe;if(De!==0||ce!==0){var we=(($-oe)*De+(ee-fe)*ce)/(De*De+ce*ce);we>1?(oe=be,fe=Oe):we>0&&(oe+=De*we,fe+=ce*we)}return(De=$-oe)*De+(ce=ee-fe)*ce}function $i($,ee,oe,fe){var be={id:$===void 0?null:$,type:ee,geometry:oe,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Oe){var De=Oe.geometry,ce=Oe.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")Zs(Oe,De);else if(ce==="Polygon"||ce==="MultiLineString")for(var we=0;we<De.length;we++)Zs(Oe,De[we]);else if(ce==="MultiPolygon")for(we=0;we<De.length;we++)for(var he=0;he<De[we].length;he++)Zs(Oe,De[we][he])}(be),be}function Zs($,ee){for(var oe=0;oe<ee.length;oe+=3)$.minX=Math.min($.minX,ee[oe]),$.minY=Math.min($.minY,ee[oe+1]),$.maxX=Math.max($.maxX,ee[oe]),$.maxY=Math.max($.maxY,ee[oe+1])}function ln($,ee,oe,fe){if(ee.geometry){var be=ee.geometry.coordinates,Oe=ee.geometry.type,De=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2),ce=[],we=ee.id;if(oe.promoteId?we=ee.properties[oe.promoteId]:oe.generateId&&(we=fe||0),Oe==="Point")ni(be,ce);else if(Oe==="MultiPoint")for(var he=0;he<be.length;he++)ni(be[he],ce);else if(Oe==="LineString")Is(be,ce,De,!1);else if(Oe==="MultiLineString"){if(oe.lineMetrics){for(he=0;he<be.length;he++)Is(be[he],ce=[],De,!1),$.push($i(we,"LineString",ce,ee.properties));return}nn(be,ce,De,!1)}else if(Oe==="Polygon")nn(be,ce,De,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(he=0;he<ee.geometry.geometries.length;he++)ln($,{id:we,geometry:ee.geometry.geometries[he],properties:ee.properties},oe,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(he=0;he<be.length;he++){var Re=[];nn(be[he],Re,De,!0),ce.push(Re)}}$.push($i(we,Oe,ce,ee.properties))}}function ni($,ee){ee.push(Oi($[0])),ee.push(is($[1])),ee.push(0)}function Is($,ee,oe,fe){for(var be,Oe,De=0,ce=0;ce<$.length;ce++){var we=Oi($[ce][0]),he=is($[ce][1]);ee.push(we),ee.push(he),ee.push(0),ce>0&&(De+=fe?(be*he-we*Oe)/2:Math.sqrt(Math.pow(we-be,2)+Math.pow(he-Oe,2))),be=we,Oe=he}var Re=ee.length-3;ee[2]=1,function ze(ke,_,ne,ht){for(var qe,gt=ht,nt=ne-_>>1,at=ne-_,er=ke[_],ct=ke[_+1],It=ke[ne],Ir=ke[ne+1],yr=_+3;yr<ne;yr+=3){var Lr=an(ke[yr],ke[yr+1],er,ct,It,Ir);if(Lr>gt)qe=yr,gt=Lr;else if(Lr===gt){var ur=Math.abs(yr-nt);ur<at&&(qe=yr,at=ur)}}gt>ht&&(qe-_>3&&ze(ke,_,qe,ht),ke[qe+2]=gt,ne-qe>3&&ze(ke,qe,ne,ht))}(ee,0,Re,oe),ee[Re+2]=1,ee.size=Math.abs(De),ee.start=0,ee.end=ee.size}function nn($,ee,oe,fe){for(var be=0;be<$.length;be++){var Oe=[];Is($[be],Oe,oe,fe),ee.push(Oe)}}function Oi($){return $/360+.5}function is($){var ee=Math.sin($*Math.PI/180),oe=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return oe<0?0:oe>1?1:oe}function vt($,ee,oe,fe,be,Oe,De,ce){if(fe/=ee,Oe>=(oe/=ee)&&De<fe)return $;if(De<oe||Oe>=fe)return null;for(var we=[],he=0;he<$.length;he++){var Re=$[he],ze=Re.geometry,ke=Re.type,_=be===0?Re.minX:Re.minY,ne=be===0?Re.maxX:Re.maxY;if(_>=oe&&ne<fe)we.push(Re);else if(!(ne<oe||_>=fe)){var ht=[];if(ke==="Point"||ke==="MultiPoint")Yt(ze,ht,oe,fe,be);else if(ke==="LineString")Mr(ze,ht,oe,fe,be,!1,ce.lineMetrics);else if(ke==="MultiLineString")kn(ze,ht,oe,fe,be,!1);else if(ke==="Polygon")kn(ze,ht,oe,fe,be,!0);else if(ke==="MultiPolygon")for(var qe=0;qe<ze.length;qe++){var gt=[];kn(ze[qe],gt,oe,fe,be,!0),gt.length&&ht.push(gt)}if(ht.length){if(ce.lineMetrics&&ke==="LineString"){for(qe=0;qe<ht.length;qe++)we.push($i(Re.id,ke,ht[qe],Re.tags));continue}ke!=="LineString"&&ke!=="MultiLineString"||(ht.length===1?(ke="LineString",ht=ht[0]):ke="MultiLineString"),ke!=="Point"&&ke!=="MultiPoint"||(ke=ht.length===3?"Point":"MultiPoint"),we.push($i(Re.id,ke,ht,Re.tags))}}}return we.length?we:null}function Yt($,ee,oe,fe,be){for(var Oe=0;Oe<$.length;Oe+=3){var De=$[Oe+be];De>=oe&&De<=fe&&(ee.push($[Oe]),ee.push($[Oe+1]),ee.push($[Oe+2]))}}function Mr($,ee,oe,fe,be,Oe,De){for(var ce,we,he=qr($),Re=be===0?mn:Xn,ze=$.start,ke=0;ke<$.length-3;ke+=3){var _=$[ke],ne=$[ke+1],ht=$[ke+2],qe=$[ke+3],gt=$[ke+4],nt=be===0?_:ne,at=be===0?qe:gt,er=!1;De&&(ce=Math.sqrt(Math.pow(_-qe,2)+Math.pow(ne-gt,2))),nt<oe?at>oe&&(we=Re(he,_,ne,qe,gt,oe),De&&(he.start=ze+ce*we)):nt>fe?at<fe&&(we=Re(he,_,ne,qe,gt,fe),De&&(he.start=ze+ce*we)):Di(he,_,ne,ht),at<oe&&nt>=oe&&(we=Re(he,_,ne,qe,gt,oe),er=!0),at>fe&&nt<=fe&&(we=Re(he,_,ne,qe,gt,fe),er=!0),!Oe&&er&&(De&&(he.end=ze+ce*we),ee.push(he),he=qr($)),De&&(ze+=ce)}var ct=$.length-3;_=$[ct],ne=$[ct+1],ht=$[ct+2],(nt=be===0?_:ne)>=oe&&nt<=fe&&Di(he,_,ne,ht),ct=he.length-3,Oe&&ct>=3&&(he[ct]!==he[0]||he[ct+1]!==he[1])&&Di(he,he[0],he[1],he[2]),he.length&&ee.push(he)}function qr($){var ee=[];return ee.size=$.size,ee.start=$.start,ee.end=$.end,ee}function kn($,ee,oe,fe,be,Oe){for(var De=0;De<$.length;De++)Mr($[De],ee,oe,fe,be,Oe,!1)}function Di($,ee,oe,fe){$.push(ee),$.push(oe),$.push(fe)}function mn($,ee,oe,fe,be,Oe){var De=(Oe-ee)/(fe-ee);return $.push(Oe),$.push(oe+(be-oe)*De),$.push(1),De}function Xn($,ee,oe,fe,be,Oe){var De=(Oe-oe)/(be-oe);return $.push(ee+(fe-ee)*De),$.push(Oe),$.push(1),De}function ho($,ee){for(var oe=[],fe=0;fe<$.length;fe++){var be,Oe=$[fe],De=Oe.type;if(De==="Point"||De==="MultiPoint"||De==="LineString")be=Ro(Oe.geometry,ee);else if(De==="MultiLineString"||De==="Polygon"){be=[];for(var ce=0;ce<Oe.geometry.length;ce++)be.push(Ro(Oe.geometry[ce],ee))}else if(De==="MultiPolygon")for(be=[],ce=0;ce<Oe.geometry.length;ce++){for(var we=[],he=0;he<Oe.geometry[ce].length;he++)we.push(Ro(Oe.geometry[ce][he],ee));be.push(we)}oe.push($i(Oe.id,De,be,Oe.tags))}return oe}function Ro($,ee){var oe=[];oe.size=$.size,$.start!==void 0&&(oe.start=$.start,oe.end=$.end);for(var fe=0;fe<$.length;fe+=3)oe.push($[fe]+ee,$[fe+1],$[fe+2]);return oe}function ea($,ee){if($.transformed)return $;var oe,fe,be,Oe=1<<$.z,De=$.x,ce=$.y;for(oe=0;oe<$.features.length;oe++){var we=$.features[oe],he=we.geometry,Re=we.type;if(we.geometry=[],Re===1)for(fe=0;fe<he.length;fe+=2)we.geometry.push(Ia(he[fe],he[fe+1],ee,Oe,De,ce));else for(fe=0;fe<he.length;fe++){var ze=[];for(be=0;be<he[fe].length;be+=2)ze.push(Ia(he[fe][be],he[fe][be+1],ee,Oe,De,ce));we.geometry.push(ze)}}return $.transformed=!0,$}function Ia($,ee,oe,fe,be,Oe){return[Math.round(oe*($*fe-be)),Math.round(oe*(ee*fe-Oe))]}function Bo($,ee,oe,fe,be){for(var Oe=ee===be.maxZoom?0:be.tolerance/((1<<ee)*be.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:oe,y:fe,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<$.length;ce++){De.numFeatures++,al(De,$[ce],Oe,be);var we=$[ce].minX,he=$[ce].minY,Re=$[ce].maxX,ze=$[ce].maxY;we<De.minX&&(De.minX=we),he<De.minY&&(De.minY=he),Re>De.maxX&&(De.maxX=Re),ze>De.maxY&&(De.maxY=ze)}return De}function al($,ee,oe,fe){var be=ee.geometry,Oe=ee.type,De=[];if(Oe==="Point"||Oe==="MultiPoint")for(var ce=0;ce<be.length;ce+=3)De.push(be[ce]),De.push(be[ce+1]),$.numPoints++,$.numSimplified++;else if(Oe==="LineString")Ks(De,be,$,oe,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(ce=0;ce<be.length;ce++)Ks(De,be[ce],$,oe,Oe==="Polygon",ce===0);else if(Oe==="MultiPolygon")for(var we=0;we<be.length;we++){var he=be[we];for(ce=0;ce<he.length;ce++)Ks(De,he[ce],$,oe,!0,ce===0)}if(De.length){var Re=ee.tags||null;if(Oe==="LineString"&&fe.lineMetrics){for(var ze in Re={},ee.tags)Re[ze]=ee.tags[ze];Re.mapbox_clip_start=be.start/be.size,Re.mapbox_clip_end=be.end/be.size}var ke={geometry:De,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:Re};ee.id!==null&&(ke.id=ee.id),$.features.push(ke)}}function Ks($,ee,oe,fe,be,Oe){var De=fe*fe;if(fe>0&&ee.size<(be?De:fe))oe.numPoints+=ee.length/3;else{for(var ce=[],we=0;we<ee.length;we+=3)(fe===0||ee[we+2]>De)&&(oe.numSimplified++,ce.push(ee[we]),ce.push(ee[we+1])),oe.numPoints++;be&&function(he,Re){for(var ze=0,ke=0,_=he.length,ne=_-2;ke<_;ne=ke,ke+=2)ze+=(he[ke]-he[ne])*(he[ke+1]+he[ne+1]);if(ze>0===Re)for(ke=0,_=he.length;ke<_/2;ke+=2){var ht=he[ke],qe=he[ke+1];he[ke]=he[_-2-ke],he[ke+1]=he[_-1-ke],he[_-2-ke]=ht,he[_-1-ke]=qe}}(ce,Oe),$.push(ce)}}function Ms($,ee){var oe=(ee=this.options=function(be,Oe){for(var De in Oe)be[De]=Oe[De];return be}(Object.create(this.options),ee)).debug;if(oe&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");var fe=function(be,Oe){var De=[];if(be.type==="FeatureCollection")for(var ce=0;ce<be.features.length;ce++)ln(De,be.features[ce],Oe,ce);else ln(De,be.type==="Feature"?be:{geometry:be},Oe);return De}($,ee);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(fe=function(be,Oe){var De=Oe.buffer/Oe.extent,ce=be,we=vt(be,1,-1-De,De,0,-1,2,Oe),he=vt(be,1,1-De,2+De,0,-1,2,Oe);return(we||he)&&(ce=vt(be,1,-De,1+De,0,-1,2,Oe)||[],we&&(ce=ho(we,1).concat(ce)),he&&(ce=ce.concat(ho(he,-1)))),ce}(fe,ee)).length&&this.splitTile(fe,0,0,0),oe&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Rs($,ee,oe){return 32*((1<<$)*oe+ee)+$}function yt($,ee){var oe=$.tileID.canonical;if(!this._geoJSONIndex)return ee(null,null);var fe=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!fe)return ee(null,null);var be=new ge(fe.features),Oe=Te(be);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),ee(null,{vectorTile:be,rawData:Oe.buffer})}Sr.prototype.load=function($){var ee=this.options,oe=ee.log,fe=ee.minZoom,be=ee.maxZoom,Oe=ee.nodeSize;oe&&console.time("total time");var De="prepare "+$.length+" points";oe&&console.time(De),this.points=$;for(var ce=[],we=0;we<$.length;we++)$[we].geometry&&ce.push(Dt($[we],we));this.trees[be+1]=new ut(ce,oi,xi,Oe,Float32Array),oe&&console.timeEnd(De);for(var he=be;he>=fe;he--){var Re=+Date.now();ce=this._cluster(ce,he),this.trees[he]=new ut(ce,oi,xi,Oe,Float32Array),oe&&console.log("z%d: %d clusters in %dms",he,ce.length,+Date.now()-Re)}return oe&&console.timeEnd("total time"),this},Sr.prototype.getClusters=function($,ee){var oe=(($[0]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,$[1])),be=$[2]===180?180:(($[2]+180)%360+360)%360-180,Oe=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)oe=-180,be=180;else if(oe>be){var De=this.getClusters([oe,fe,180,Oe],ee),ce=this.getClusters([-180,fe,be,Oe],ee);return De.concat(ce)}for(var we=this.trees[this._limitZoom(ee)],he=[],Re=0,ze=we.range(yi(oe),dr(Oe),yi(be),dr(fe));Re<ze.length;Re+=1){var ke=we.points[ze[Re]];he.push(ke.numPoints?$r(ke):this.points[ke.index])}return he},Sr.prototype.getChildren=function($){var ee=this._getOriginId($),oe=this._getOriginZoom($),fe="No cluster with the specified id.",be=this.trees[oe];if(!be)throw new Error(fe);var Oe=be.points[ee];if(!Oe)throw new Error(fe);for(var De=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ce=[],we=0,he=be.within(Oe.x,Oe.y,De);we<he.length;we+=1){var Re=be.points[he[we]];Re.parentId===$&&ce.push(Re.numPoints?$r(Re):this.points[Re.index])}if(ce.length===0)throw new Error(fe);return ce},Sr.prototype.getLeaves=function($,ee,oe){var fe=[];return this._appendLeaves(fe,$,ee=ee||10,oe=oe||0,0),fe},Sr.prototype.getTile=function($,ee,oe){var fe=this.trees[this._limitZoom($)],be=Math.pow(2,$),Oe=this.options,De=Oe.radius/Oe.extent,ce=(oe-De)/be,we=(oe+1+De)/be,he={features:[]};return this._addTileFeatures(fe.range((ee-De)/be,ce,(ee+1+De)/be,we),fe.points,ee,oe,be,he),ee===0&&this._addTileFeatures(fe.range(1-De/be,ce,1,we),fe.points,be,oe,be,he),ee===be-1&&this._addTileFeatures(fe.range(0,ce,De/be,we),fe.points,-1,oe,be,he),he.features.length?he:null},Sr.prototype.getClusterExpansionZoom=function($){for(var ee=this._getOriginZoom($)-1;ee<=this.options.maxZoom;){var oe=this.getChildren($);if(ee++,oe.length!==1)break;$=oe[0].properties.cluster_id}return ee},Sr.prototype._appendLeaves=function($,ee,oe,fe,be){for(var Oe=0,De=this.getChildren(ee);Oe<De.length;Oe+=1){var ce=De[Oe],we=ce.properties;if(we&&we.cluster?be+we.point_count<=fe?be+=we.point_count:be=this._appendLeaves($,we.cluster_id,oe,fe,be):be<fe?be++:$.push(ce),$.length===oe)break}return be},Sr.prototype._addTileFeatures=function($,ee,oe,fe,be,Oe){for(var De=0,ce=$;De<ce.length;De+=1){var we=ee[ce[De]],he=we.numPoints,Re={type:1,geometry:[[Math.round(this.options.extent*(we.x*be-oe)),Math.round(this.options.extent*(we.y*be-fe))]],tags:he?Pi(we):this.points[we.index].properties},ze=void 0;he?ze=we.id:this.options.generateId?ze=we.index:this.points[we.index].id&&(ze=this.points[we.index].id),ze!==void 0&&(Re.id=ze),Oe.features.push(Re)}},Sr.prototype._limitZoom=function($){return Math.max(this.options.minZoom,Math.min(+$,this.options.maxZoom+1))},Sr.prototype._cluster=function($,ee){for(var oe=[],fe=this.options,be=fe.reduce,Oe=fe.minPoints,De=fe.radius/(fe.extent*Math.pow(2,ee)),ce=0;ce<$.length;ce++){var we=$[ce];if(!(we.zoom<=ee)){we.zoom=ee;for(var he=this.trees[ee+1],Re=he.within(we.x,we.y,De),ze=we.numPoints||1,ke=ze,_=0,ne=Re;_<ne.length;_+=1){var ht=he.points[ne[_]];ht.zoom>ee&&(ke+=ht.numPoints||1)}if(ke>=Oe){for(var qe=we.x*ze,gt=we.y*ze,nt=be&&ze>1?this._map(we,!0):null,at=(ce<<5)+(ee+1)+this.points.length,er=0,ct=Re;er<ct.length;er+=1){var It=he.points[ct[er]];if(!(It.zoom<=ee)){It.zoom=ee;var Ir=It.numPoints||1;qe+=It.x*Ir,gt+=It.y*Ir,It.parentId=at,be&&(nt||(nt=this._map(we,!0)),be(nt,this._map(It)))}}we.parentId=at,oe.push(Ur(qe/ke,gt/ke,at,ke,nt))}else if(oe.push(we),ke>1)for(var yr=0,Lr=Re;yr<Lr.length;yr+=1){var ur=he.points[Lr[yr]];ur.zoom<=ee||(ur.zoom=ee,oe.push(ur))}}}return oe},Sr.prototype._getOriginId=function($){return $-this.points.length>>5},Sr.prototype._getOriginZoom=function($){return($-this.points.length)%32},Sr.prototype._map=function($,ee){if($.numPoints)return ee?gn({},$.properties):$.properties;var oe=this.points[$.index].properties,fe=this.options.map(oe);return ee&&fe===oe?gn({},fe):fe},Ms.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ms.prototype.splitTile=function($,ee,oe,fe,be,Oe,De){for(var ce=[$,ee,oe,fe],we=this.options,he=we.debug;ce.length;){fe=ce.pop(),oe=ce.pop(),ee=ce.pop(),$=ce.pop();var Re=1<<ee,ze=Rs(ee,oe,fe),ke=this.tiles[ze];if(!ke&&(he>1&&console.time("creation"),ke=this.tiles[ze]=Bo($,ee,oe,fe,we),this.tileCoords.push({z:ee,x:oe,y:fe}),he)){he>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,oe,fe,ke.numFeatures,ke.numPoints,ke.numSimplified),console.timeEnd("creation"));var _="z"+ee;this.stats[_]=(this.stats[_]||0)+1,this.total++}if(ke.source=$,be){if(ee===we.maxZoom||ee===be)continue;var ne=1<<be-ee;if(oe!==Math.floor(Oe/ne)||fe!==Math.floor(De/ne))continue}else if(ee===we.indexMaxZoom||ke.numPoints<=we.indexMaxPoints)continue;if(ke.source=null,$.length!==0){he>1&&console.time("clipping");var ht,qe,gt,nt,at,er,ct=.5*we.buffer/we.extent,It=.5-ct,Ir=.5+ct,yr=1+ct;ht=qe=gt=nt=null,at=vt($,Re,oe-ct,oe+Ir,0,ke.minX,ke.maxX,we),er=vt($,Re,oe+It,oe+yr,0,ke.minX,ke.maxX,we),$=null,at&&(ht=vt(at,Re,fe-ct,fe+Ir,1,ke.minY,ke.maxY,we),qe=vt(at,Re,fe+It,fe+yr,1,ke.minY,ke.maxY,we),at=null),er&&(gt=vt(er,Re,fe-ct,fe+Ir,1,ke.minY,ke.maxY,we),nt=vt(er,Re,fe+It,fe+yr,1,ke.minY,ke.maxY,we),er=null),he>1&&console.timeEnd("clipping"),ce.push(ht||[],ee+1,2*oe,2*fe),ce.push(qe||[],ee+1,2*oe,2*fe+1),ce.push(gt||[],ee+1,2*oe+1,2*fe),ce.push(nt||[],ee+1,2*oe+1,2*fe+1)}}},Ms.prototype.getTile=function($,ee,oe){var fe=this.options,be=fe.extent,Oe=fe.debug;if($<0||$>24)return null;var De=1<<$,ce=Rs($,ee=(ee%De+De)%De,oe);if(this.tiles[ce])return ea(this.tiles[ce],be);Oe>1&&console.log("drilling down to z%d-%d-%d",$,ee,oe);for(var we,he=$,Re=ee,ze=oe;!we&&he>0;)he--,Re=Math.floor(Re/2),ze=Math.floor(ze/2),we=this.tiles[Rs(he,Re,ze)];return we&&we.source?(Oe>1&&console.log("found parent tile z%d-%d-%d",he,Re,ze),Oe>1&&console.time("drilling down"),this.splitTile(we.source,he,Re,ze,$,ee,oe),Oe>1&&console.timeEnd("drilling down"),this.tiles[ce]?ea(this.tiles[ce],be):null):null};var Ma=function($){function ee(oe,fe,be,Oe){$.call(this,oe,fe,be,yt),Oe&&(this.loadGeoJSON=Oe)}return $&&(ee.__proto__=$),(ee.prototype=Object.create($&&$.prototype)).constructor=ee,ee.prototype.loadData=function(oe,fe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=fe,this._pendingLoadDataParams=oe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ee.prototype._loadData=function(){var oe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var fe=this._pendingCallback,be=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Oe=!!(be&&be.request&&be.request.collectResourceTiming)&&new s.RequestPerformance(be.request);this.loadGeoJSON(be,function(De,ce){if(De||!ce)return fe(De);if(typeof ce!="object")return fe(new Error("Input data given to '"+be.source+"' is not a valid GeoJSON object."));(function ke(_,ne){var ht,qe=_&&_.type;if(qe==="FeatureCollection")for(ht=0;ht<_.features.length;ht++)ke(_.features[ht],ne);else if(qe==="GeometryCollection")for(ht=0;ht<_.geometries.length;ht++)ke(_.geometries[ht],ne);else if(qe==="Feature")ke(_.geometry,ne);else if(qe==="Polygon")G(_.coordinates,ne);else if(qe==="MultiPolygon")for(ht=0;ht<_.coordinates.length;ht++)G(_.coordinates[ht],ne);return _})(ce,!0);try{if(be.filter){var we=s.createExpression(be.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map(function(ke){return ke.key+": "+ke.message}).join(", "));var he=ce.features.filter(function(ke){return we.value.evaluate({zoom:0},ke)});ce={type:"FeatureCollection",features:he}}oe._geoJSONIndex=be.cluster?new Sr(function(ke){var _=ke.superclusterOptions,ne=ke.clusterProperties;if(!ne||!_)return _;for(var ht={},qe={},gt={accumulated:null,zoom:0},nt={properties:null},at=Object.keys(ne),er=0,ct=at;er<ct.length;er+=1){var It=ct[er],Ir=ne[It],yr=Ir[0],Lr=s.createExpression(Ir[1]),ur=s.createExpression(typeof yr=="string"?[yr,["accumulated"],["get",It]]:yr);ht[It]=Lr.value,qe[It]=ur.value}return _.map=function(Yr){nt.properties=Yr;for(var xr={},Fr=0,zr=at;Fr<zr.length;Fr+=1){var Ar=zr[Fr];xr[Ar]=ht[Ar].evaluate(gt,nt)}return xr},_.reduce=function(Yr,xr){nt.properties=xr;for(var Fr=0,zr=at;Fr<zr.length;Fr+=1){var Ar=zr[Fr];gt.accumulated=Yr[Ar],Yr[Ar]=qe[Ar].evaluate(gt,nt)}},_}(be)).load(ce.features):function(ke,_){return new Ms(ke,_)}(ce,be.geojsonVtOptions)}catch(ke){return fe(ke)}oe.loaded={};var Re={};if(Oe){var ze=Oe.finish();ze&&(Re.resourceTiming={},Re.resourceTiming[be.source]=JSON.parse(JSON.stringify(ze)))}fe(null,Re)})}},ee.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ee.prototype.reloadTile=function(oe,fe){var be=this.loaded;return be&&be[oe.uid]?$.prototype.reloadTile.call(this,oe,fe):this.loadTile(oe,fe)},ee.prototype.loadGeoJSON=function(oe,fe){if(oe.request)s.getJSON(oe.request,fe);else{if(typeof oe.data!="string")return fe(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."));try{return fe(null,JSON.parse(oe.data))}catch{return fe(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."))}}},ee.prototype.removeSource=function(oe,fe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),fe()},ee.prototype.getClusterExpansionZoom=function(oe,fe){try{fe(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(be){fe(be)}},ee.prototype.getClusterChildren=function(oe,fe){try{fe(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(be){fe(be)}},ee.prototype.getClusterLeaves=function(oe,fe){try{fe(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(be){fe(be)}},ee}(F),vi=function($){var ee=this;this.self=$,this.actor=new s.Actor($,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:F,geojson:Ma},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(oe,fe){if(ee.workerSourceTypes[oe])throw new Error('Worker source with name "'+oe+'" already registered.');ee.workerSourceTypes[oe]=fe},this.self.registerRTLTextPlugin=function(oe){if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=oe.applyArabicShaping,s.plugin.processBidirectionalText=oe.processBidirectionalText,s.plugin.processStyledBidirectionalText=oe.processStyledBidirectionalText}};return vi.prototype.setReferrer=function($,ee){this.referrer=ee},vi.prototype.setImages=function($,ee,oe){for(var fe in this.availableImages[$]=ee,this.workerSources[$]){var be=this.workerSources[$][fe];for(var Oe in be)be[Oe].availableImages=ee}oe()},vi.prototype.setLayers=function($,ee,oe){this.getLayerIndex($).replace(ee),oe()},vi.prototype.updateLayers=function($,ee,oe){this.getLayerIndex($).update(ee.layers,ee.removedIds),oe()},vi.prototype.loadTile=function($,ee,oe){this.getWorkerSource($,ee.type,ee.source).loadTile(ee,oe)},vi.prototype.loadDEMTile=function($,ee,oe){this.getDEMWorkerSource($,ee.source).loadTile(ee,oe)},vi.prototype.reloadTile=function($,ee,oe){this.getWorkerSource($,ee.type,ee.source).reloadTile(ee,oe)},vi.prototype.abortTile=function($,ee,oe){this.getWorkerSource($,ee.type,ee.source).abortTile(ee,oe)},vi.prototype.removeTile=function($,ee,oe){this.getWorkerSource($,ee.type,ee.source).removeTile(ee,oe)},vi.prototype.removeDEMTile=function($,ee){this.getDEMWorkerSource($,ee.source).removeTile(ee)},vi.prototype.removeSource=function($,ee,oe){if(this.workerSources[$]&&this.workerSources[$][ee.type]&&this.workerSources[$][ee.type][ee.source]){var fe=this.workerSources[$][ee.type][ee.source];delete this.workerSources[$][ee.type][ee.source],fe.removeSource!==void 0?fe.removeSource(ee,oe):oe()}},vi.prototype.loadWorkerSource=function($,ee,oe){try{this.self.importScripts(ee.url),oe()}catch(fe){oe(fe.toString())}},vi.prototype.syncRTLPluginState=function($,ee,oe){try{s.plugin.setState(ee);var fe=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&fe!=null){this.self.importScripts(fe);var be=s.plugin.isParsed();oe(be?void 0:new Error("RTL Text Plugin failed to import scripts from "+fe),be)}}catch(Oe){oe(Oe.toString())}},vi.prototype.getAvailableImages=function($){var ee=this.availableImages[$];return ee||(ee=[]),ee},vi.prototype.getLayerIndex=function($){var ee=this.layerIndexes[$];return ee||(ee=this.layerIndexes[$]=new v),ee},vi.prototype.getWorkerSource=function($,ee,oe){var fe=this;return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][ee]||(this.workerSources[$][ee]={}),this.workerSources[$][ee][oe]||(this.workerSources[$][ee][oe]=new this.workerSourceTypes[ee]({send:function(be,Oe,De){fe.actor.send(be,Oe,De,$)}},this.getLayerIndex($),this.getAvailableImages($))),this.workerSources[$][ee][oe]},vi.prototype.getDEMWorkerSource=function($,ee){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][ee]||(this.demWorkerSources[$][ee]=new V),this.demWorkerSources[$][ee]},vi.prototype.enforceCacheSizeLimit=function($,ee){s.enforceCacheSizeLimit(ee)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new vi(self)),vi}),o(["./shared"],function(s){var f=s.createCommonjsModule(function(l){function u(y){return!c(y)}function c(y){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,M,D=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(D);try{M=new Worker(L),S=!0}catch{S=!1}return M&&M.terminate(),URL.revokeObjectURL(L),S}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var S=document.createElement("canvas");S.width=S.height=1;var M=S.getContext("2d");if(!M)return!1;var D=M.getImageData(0,0,1,1);return D&&D.width===S.width}()?(d[T=y&&y.failIfMajorPerformanceCaveat]===void 0&&(d[T]=function(S){var M=function(L){var j=document.createElement("canvas"),z=Object.create(u.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=L,j.probablySupportsContext?j.probablySupportsContext("webgl",z)||j.probablySupportsContext("experimental-webgl",z):j.supportsContext?j.supportsContext("webgl",z)||j.supportsContext("experimental-webgl",z):j.getContext("webgl",z)||j.getContext("experimental-webgl",z)}(S);if(!M)return!1;var D=M.createShader(M.VERTEX_SHADER);return!(!D||M.isContextLost())&&(M.shaderSource(D,"void main() {}"),M.compileShader(D),M.getShaderParameter(D,M.COMPILE_STATUS)===!0)}(T)),d[T]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var T}l.exports?l.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=c);var d={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),A={create:function(l,u,c){var d=s.window.document.createElement(l);return u!==void 0&&(d.className=u),c&&c.appendChild(d),d},createNS:function(l,u){return s.window.document.createElementNS(l,u)}},v=s.window.document&&s.window.document.documentElement.style;function w(l){if(!v)return l[0];for(var u=0;u<l.length;u++)if(l[u]in v)return l[u];return l[0]}var C,I=w(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);A.disableDrag=function(){v&&I&&(C=v[I],v[I]="none")},A.enableDrag=function(){v&&I&&(v[I]=C)};var B=w(["transform","WebkitTransform"]);A.setTransform=function(l,u){l.style[B]=u};var F=!1;try{var N=Object.defineProperty({},"passive",{get:function(){F=!0}});s.window.addEventListener("test",N,N),s.window.removeEventListener("test",N,N)}catch{F=!1}A.addEventListener=function(l,u,c,d){d===void 0&&(d={}),l.addEventListener(u,c,"passive"in d&&F?d:d.capture)},A.removeEventListener=function(l,u,c,d){d===void 0&&(d={}),l.removeEventListener(u,c,"passive"in d&&F?d:d.capture)};var V=function(l){l.preventDefault(),l.stopPropagation(),s.window.removeEventListener("click",V,!0)};function G(l){var u=l.userImage;return!!(u&&u.render&&u.render())&&(l.data.replace(new Uint8Array(u.data.buffer)),!0)}A.suppressClick=function(){s.window.addEventListener("click",V,!0),s.window.setTimeout(function(){s.window.removeEventListener("click",V,!0)},0)},A.mousePos=function(l,u){var c=l.getBoundingClientRect();return new s.Point(u.clientX-c.left-l.clientLeft,u.clientY-c.top-l.clientTop)},A.touchPos=function(l,u){for(var c=l.getBoundingClientRect(),d=[],y=0;y<u.length;y++)d.push(new s.Point(u[y].clientX-c.left-l.clientLeft,u[y].clientY-c.top-l.clientTop));return d},A.mouseButton=function(l){return s.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},A.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Y=function(l){function u(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,y=this.requestors;d<y.length;d+=1){var T=y[d];this._notify(T.ids,T.callback)}this.requestors=[]}},u.prototype.getImage=function(c){return this.images[c]},u.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},u.prototype._validate=function(c,d){var y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new s.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new s.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),y=!1),this._validateContent(d.content,d)||(this.fire(new s.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),y=!1),y},u.prototype._validateStretch=function(c,d){if(!c)return!0;for(var y=0,T=0,S=c;T<S.length;T+=1){var M=S[T];if(M[0]<y||M[1]<M[0]||d<M[1])return!1;y=M[1]}return!0},u.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},u.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},u.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(c,d){var y=!0;if(!this.isLoaded())for(var T=0,S=c;T<S.length;T+=1)this.images[S[T]]||(y=!1);this.isLoaded()||y?this._notify(c,d):this.requestors.push({ids:c,callback:d})},u.prototype._notify=function(c,d){for(var y={},T=0,S=c;T<S.length;T+=1){var M=S[T];this.images[M]||this.fire(new s.Event("styleimagemissing",{id:M}));var D=this.images[M];D?y[M]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:!!(D.userImage&&D.userImage.render)}:s.warnOnce('Image "'+M+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,y)},u.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},u.prototype.getPattern=function(c){var d=this.patterns[c],y=this.getImage(c);if(!y)return null;if(d&&d.position.version===y.version)return d.position;if(d)d.position.version=y.version;else{var T={w:y.data.width+2,h:y.data.height+2,x:0,y:0},S=new s.ImagePosition(T,y);this.patterns[c]={bin:T,position:S}}return this._updatePatternAtlas(),this.patterns[c].position},u.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var y=s.potpack(c),T=y.w,S=y.h,M=this.atlasImage;for(var D in M.resize({width:T||1,height:S||1}),this.patterns){var L=this.patterns[D].bin,j=L.x+1,z=L.y+1,W=this.images[D].data,te=W.width,Q=W.height;s.RGBAImage.copy(W,M,{x:0,y:0},{x:j,y:z},{width:te,height:Q}),s.RGBAImage.copy(W,M,{x:0,y:Q-1},{x:j,y:z-1},{width:te,height:1}),s.RGBAImage.copy(W,M,{x:0,y:0},{x:j,y:z+Q},{width:te,height:1}),s.RGBAImage.copy(W,M,{x:te-1,y:0},{x:j-1,y:z},{width:1,height:Q}),s.RGBAImage.copy(W,M,{x:0,y:0},{x:j+te,y:z},{width:1,height:Q})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(c){for(var d=0,y=c;d<y.length;d+=1){var T=y[d];if(!this.callbackDispatchedThisFrame[T]){this.callbackDispatchedThisFrame[T]=!0;var S=this.images[T];G(S)&&this.updateImage(T,S)}}},u}(s.Evented),Z=Pe,se=Pe,ge=1e20;function Pe(l,u,c,d,y,T){this.fontSize=l||24,this.buffer=u===void 0?3:u,this.cutoff=d||.25,this.fontFamily=y||"sans-serif",this.fontWeight=T||"normal",this.radius=c||8;var S=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=S,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.d=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Int16Array(S),this.middle=Math.round(S/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ue(l,u,c,d,y,T,S){for(var M=0;M<u;M++){for(var D=0;D<c;D++)d[D]=l[D*u+M];for(Fe(d,y,T,S,c),D=0;D<c;D++)l[D*u+M]=y[D]}for(D=0;D<c;D++){for(M=0;M<u;M++)d[M]=l[D*u+M];for(Fe(d,y,T,S,u),M=0;M<u;M++)l[D*u+M]=Math.sqrt(y[M])}}function Fe(l,u,c,d,y){c[0]=0,d[0]=-ge,d[1]=+ge;for(var T=1,S=0;T<y;T++){for(var M=(l[T]+T*T-(l[c[S]]+c[S]*c[S]))/(2*T-2*c[S]);M<=d[S];)S--,M=(l[T]+T*T-(l[c[S]]+c[S]*c[S]))/(2*T-2*c[S]);c[++S]=T,d[S]=M,d[S+1]=+ge}for(T=0,S=0;T<y;T++){for(;d[S+1]<T;)S++;u[T]=(T-c[S])*(T-c[S])+l[c[S]]}}Pe.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var y=u.data[4*d+3]/255;this.gridOuter[d]=y===1?0:y===0?ge:Math.pow(Math.max(0,.5-y),2),this.gridInner[d]=y===1?ge:y===0?0:Math.pow(Math.max(0,y-.5),2)}for(Ue(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ue(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Z.default=se;var pe=function(l,u){this.requestManager=l,this.localIdeographFontFamily=u,this.entries={}};pe.prototype.setURL=function(l){this.url=l},pe.prototype.getGlyphs=function(l,u){var c=this,d=[];for(var y in l)for(var T=0,S=l[y];T<S.length;T+=1)d.push({stack:y,id:S[T]});s.asyncAll(d,function(M,D){var L=M.stack,j=M.id,z=c.entries[L];z||(z=c.entries[L]={glyphs:{},requests:{},ranges:{}});var W=z.glyphs[j];if(W===void 0){if(W=c._tinySDF(z,L,j))return z.glyphs[j]=W,void D(null,{stack:L,id:j,glyph:W});var te=Math.floor(j/256);if(256*te>65535)D(new Error("glyphs > 65535 not supported"));else if(z.ranges[te])D(null,{stack:L,id:j,glyph:W});else{var Q=z.requests[te];Q||(Q=z.requests[te]=[],pe.loadGlyphRange(L,te,c.url,c.requestManager,function(ie,K){if(K){for(var J in K)c._doesCharSupportLocalGlyph(+J)||(z.glyphs[+J]=K[+J]);z.ranges[te]=!0}for(var _e=0,Ee=Q;_e<Ee.length;_e+=1)(0,Ee[_e])(ie,K);delete z.requests[te]})),Q.push(function(ie,K){ie?D(ie):K&&D(null,{stack:L,id:j,glyph:K[j]||null})})}}else D(null,{stack:L,id:j,glyph:W})},function(M,D){if(M)u(M);else if(D){for(var L={},j=0,z=D;j<z.length;j+=1){var W=z[j],te=W.stack,Q=W.id,ie=W.glyph;(L[te]||(L[te]={}))[Q]=ie&&{id:ie.id,bitmap:ie.bitmap.clone(),metrics:ie.metrics}}u(null,L)}})},pe.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(s.isChar["CJK Unified Ideographs"](l)||s.isChar["Hangul Syllables"](l)||s.isChar.Hiragana(l)||s.isChar.Katakana(l))},pe.prototype._tinySDF=function(l,u,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var y=l.tinySDF;if(!y){var T="400";/bold/i.test(u)?T="900":/medium/i.test(u)?T="500":/light/i.test(u)&&(T="200"),y=l.tinySDF=new pe.TinySDF(24,3,8,.25,d,T)}return{id:c,bitmap:new s.AlphaImage({width:30,height:30},y.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},pe.loadGlyphRange=function(l,u,c,d,y){var T=256*u,S=T+255,M=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",T+"-"+S),s.ResourceType.Glyphs);s.getArrayBuffer(M,function(D,L){if(D)y(D);else if(L){for(var j={},z=0,W=s.parseGlyphPBF(L);z<W.length;z+=1){var te=W[z];j[te.id]=te}y(null,j)}})},pe.TinySDF=Z;var Te=function(){this.specification=s.styleSpec.light.position};Te.prototype.possiblyEvaluate=function(l,u){return s.sphericalToCartesian(l.expression.evaluate(u))},Te.prototype.interpolate=function(l,u,c){return{x:s.number(l.x,u.x,c),y:s.number(l.y,u.y,c),z:s.number(l.z,u.z,c)}};var Ae=new s.Properties({anchor:new s.DataConstantProperty(s.styleSpec.light.anchor),position:new Te,color:new s.DataConstantProperty(s.styleSpec.light.color),intensity:new s.DataConstantProperty(s.styleSpec.light.intensity)}),Le=function(l){function u(c){l.call(this),this._transitionable=new s.Transitionable(Ae),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(s.validateLight,c,d))for(var y in c){var T=c[y];s.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),T):this._transitionable.setValue(y,T)}},u.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},u.prototype._validate=function(c,d,y){return(!y||y.validate!==!1)&&s.emitValidationErrors(this,c.call(s.validateStyle,s.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.styleSpec})))},u}(s.Evented),Ve=function(l,u){this.width=l,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ve.prototype.getDash=function(l,u){var c=l.join(",")+String(u);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,u)),this.dashEntry[c]},Ve.prototype.getDashRanges=function(l,u,c){var d=[],y=l.length%2==1?-l[l.length-1]*c:0,T=l[0]*c,S=!0;d.push({left:y,right:T,isDash:S,zeroLength:l[0]===0});for(var M=l[0],D=1;D<l.length;D++){var L=l[D];d.push({left:y=M*c,right:T=(M+=L)*c,isDash:S=!S,zeroLength:L===0})}return d},Ve.prototype.addRoundDash=function(l,u,c){for(var d=u/2,y=-c;y<=c;y++)for(var T=this.width*(this.nextRow+c+y),S=0,M=l[S],D=0;D<this.width;D++){D/M.right>1&&(M=l[++S]);var L=Math.abs(D-M.left),j=Math.abs(D-M.right),z=Math.min(L,j),W=void 0,te=y/c*(d+1);if(M.isDash){var Q=d-Math.abs(te);W=Math.sqrt(z*z+Q*Q)}else W=d-Math.sqrt(z*z+te*te);this.data[T+D]=Math.max(0,Math.min(255,W+128))}},Ve.prototype.addRegularDash=function(l){for(var u=l.length-1;u>=0;--u){var c=l[u],d=l[u+1];c.zeroLength?l.splice(u,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(u,1))}var y=l[0],T=l[l.length-1];y.isDash===T.isDash&&(y.left=T.left-this.width,T.right=y.right+this.width);for(var S=this.width*this.nextRow,M=0,D=l[M],L=0;L<this.width;L++){L/D.right>1&&(D=l[++M]);var j=Math.abs(L-D.left),z=Math.abs(L-D.right),W=Math.min(j,z);this.data[S+L]=Math.max(0,Math.min(255,(D.isDash?W:-W)+128))}},Ve.prototype.addDash=function(l,u){var c=u?7:0,d=2*c+1;if(this.nextRow+d>this.height)return s.warnOnce("LineAtlas out of space"),null;for(var y=0,T=0;T<l.length;T++)y+=l[T];if(y!==0){var S=this.width/y,M=this.getDashRanges(l,this.width,S);u?this.addRoundDash(M,S,c):this.addRegularDash(M)}var D={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:y};return this.nextRow+=d,this.dirty=!0,D},Ve.prototype.bind=function(l){var u=l.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Xe=function l(u,c){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=s.uniqueId();for(var d=this.workerPool.acquire(this.id),y=0;y<d.length;y++){var T=new l.Actor(d[y],c,this.id);T.name="Worker "+y,this.actors.push(T)}};function dt(l,u,c){var d=function(y,T){if(y)return c(y);if(T){var S=s.pick(s.extend(T,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(S.vectorLayers=T.vector_layers,S.vectorLayerIds=S.vectorLayers.map(function(M){return M.id})),S.tiles=u.canonicalizeTileset(S,l.url),c(null,S)}};return l.url?s.getJSON(u.transformRequest(u.normalizeSourceURL(l.url),s.ResourceType.Source),d):s.browser.frame(function(){return d(null,l)})}Xe.prototype.broadcast=function(l,u,c){s.asyncAll(this.actors,function(d,y){d.send(l,u,y)},c=c||function(){})},Xe.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Xe.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Xe.Actor=s.Actor;var Nt=function(l,u,c){this.bounds=s.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=u||0,this.maxzoom=c||24};Nt.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Nt.prototype.contains=function(l){var u=Math.pow(2,l.z),c=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*u),d=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*u),y=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*u),T=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*u);return l.x>=c&&l.x<y&&l.y>=d&&l.y<T};var gr=function(l){function u(c,d,y,T){if(l.call(this),this.id=c,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(d,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dt(this._options,this.map._requestManager,function(d,y){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new s.ErrorEvent(d)):y&&(s.extend(c,y),y.bounds&&(c.tileBounds=new Nt(y.bounds,c.minzoom,c.maxzoom)),s.postTurnstileEvent(y.tiles,c.map._requestManager._customAccessToken),s.postMapLoadEvent(y.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},u.prototype.onAdd=function(c){this.map=c,this.load()},u.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},u.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return s.extend({},this._options)},u.prototype.loadTile=function(c,d){var y=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),T={request:this.map._requestManager.transformRequest(y,s.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function S(M,D){return delete c.request,c.aborted?d(null):M&&M.status!==404?d(M):(D&&D.resourceTiming&&(c.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&c.setExpiryData(D),c.loadVectorData(D,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}T.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",T,S.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",T,S.bind(this)))},u.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(s.Evented),mr=function(l){function u(c,d,y,T){l.call(this),this.id=c,this.dispatcher=y,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},d),s.extend(this,s.pick(d,["url","scheme","tileSize"]))}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dt(this._options,this.map._requestManager,function(d,y){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new s.ErrorEvent(d)):y&&(s.extend(c,y),y.bounds&&(c.tileBounds=new Nt(y.bounds,c.minzoom,c.maxzoom)),s.postTurnstileEvent(y.tiles),s.postMapLoadEvent(y.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(c){this.map=c,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return s.extend({},this._options)},u.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},u.prototype.loadTile=function(c,d){var y=this,T=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=s.getImage(this.map._requestManager.transformRequest(T,s.ResourceType.Tile),function(S,M){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(S)c.state="errored",d(S);else if(M){y.map._refreshExpiredTiles&&c.setExpiryData(M),delete M.cacheControl,delete M.expires;var D=y.map.painter.context,L=D.gl;c.texture=y.map.painter.getTileTexture(M.width),c.texture?c.texture.update(M,{useMipmap:!0}):(c.texture=new s.Texture(D,M,L.RGBA,{useMipmap:!0}),c.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),D.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax)),c.state="loaded",s.cacheEntryPossiblyAdded(y.dispatcher),d(null)}})},u.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},u.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},u.prototype.hasTransition=function(){return!1},u}(s.Evented),_r=function(l){function u(c,d,y,T){l.call(this,c,d,y,T),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(c,d){var y=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function T(S,M){S&&(c.state="errored",d(S)),M&&(c.dem=M,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=s.getImage(this.map._requestManager.transformRequest(y,s.ResourceType.Tile),(function(S,M){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(S)c.state="errored",d(S);else if(M){this.map._refreshExpiredTiles&&c.setExpiryData(M),delete M.cacheControl,delete M.expires;var D=s.window.ImageBitmap&&M instanceof s.window.ImageBitmap&&s.offscreenCanvasSupported()?M:s.browser.getImageData(M,1),L={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:D,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",L,T.bind(this)))}}).bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},u.prototype._getNeighboringTiles=function(c){var d=c.canonical,y=Math.pow(2,d.z),T=(d.x-1+y)%y,S=d.x===0?c.wrap-1:c.wrap,M=(d.x+1+y)%y,D=d.x+1===y?c.wrap+1:c.wrap,L={};return L[new s.OverscaledTileID(c.overscaledZ,S,d.z,T,d.y).key]={backfilled:!1},L[new s.OverscaledTileID(c.overscaledZ,D,d.z,M,d.y).key]={backfilled:!1},d.y>0&&(L[new s.OverscaledTileID(c.overscaledZ,S,d.z,T,d.y-1).key]={backfilled:!1},L[new s.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},L[new s.OverscaledTileID(c.overscaledZ,D,d.z,M,d.y-1).key]={backfilled:!1}),d.y+1<y&&(L[new s.OverscaledTileID(c.overscaledZ,S,d.z,T,d.y+1).key]={backfilled:!1},L[new s.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},L[new s.OverscaledTileID(c.overscaledZ,D,d.z,M,d.y+1).key]={backfilled:!1}),L},u.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},u}(mr),rr=function(l){function u(c,d,y,T){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=y.getActor(),this.setEventedParent(T),this._data=d.data,this._options=s.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var S=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*S,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*S,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:s.EXTENT,radius:(d.clusterRadius||50)*S,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.load=function(){var c=this;this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new s.ErrorEvent(d));else{var y={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(y.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new s.Event("data",y))}})},u.prototype.onAdd=function(c){this.map=c,this.load()},u.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(y){if(y)d.fire(new s.ErrorEvent(y));else{var T={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(T.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new s.Event("data",T))}}),this},u.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},u.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},u.prototype.getClusterLeaves=function(c,d,y,T){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:y},T),this},u.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var y=s.extend({},this.workerOptions),T=this._data;typeof T=="string"?(y.request=this.map._requestManager.transformRequest(s.browser.resolveURL(T),s.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(T),this.actor.send(this.type+".loadData",y,function(S,M){d._removed||M&&M.abandoned||(d._loaded=!0,M&&M.resourceTiming&&M.resourceTiming[d.id]&&(d._resourceTiming=M.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:y.source},null),c(S))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(c,d){var y=this,T=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(T,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(S,M){return delete c.request,c.unloadVectorData(),c.aborted?d(null):S?d(S):(c.loadVectorData(M,y.map.painter,T==="reloadTile"),d(null))})},u.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},u.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return s.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(s.Evented),Ot=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Qt=function(l){function u(c,d,y,T){l.call(this),this.id=c,this.dispatcher=y,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=d}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.load=function(c,d){var y=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),function(T,S){y._loaded=!0,T?y.fire(new s.ErrorEvent(T)):S&&(y.image=S,c&&(y.coordinates=c),d&&d(),y._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(c){this.map=c,this.load()},u.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var y=c.map(s.MercatorCoordinate.fromLngLat);this.tileID=function(S){for(var M=1/0,D=1/0,L=-1/0,j=-1/0,z=0,W=S;z<W.length;z+=1){var te=W[z];M=Math.min(M,te.x),D=Math.min(D,te.y),L=Math.max(L,te.x),j=Math.max(j,te.y)}var Q=Math.max(L-M,j-D),ie=Math.max(0,Math.floor(-Math.log(Q)/Math.LN2)),K=Math.pow(2,ie);return new s.CanonicalTileID(ie,Math.floor((M+L)/2*K),Math.floor((D+j)/2*K))}(y),this.minzoom=this.maxzoom=this.tileID.z;var T=y.map(function(S){return d.tileID.getTilePoint(S)._round()});return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(T[0].x,T[0].y,0,0),this._boundsArray.emplaceBack(T[1].x,T[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(T[3].x,T[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(T[2].x,T[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Ot.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[y];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(s.Evented),qt=function(l){function u(c,d,y,T){l.call(this,c,d,y,T),this.roundZoom=!0,this.type="video",this.options=d}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var y=0,T=d.urls;y<T.length;y+=1)this.urls.push(this.map._requestManager.transformRequest(T[y],s.ResourceType.Source).url);s.getVideo(this.urls,function(S,M){c._loaded=!0,S?c.fire(new s.ErrorEvent(S)):M&&(c.video=M,c.video.loop=!0,c.video.setAttribute("playsinline",""),c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Ot.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[y];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(Qt),Rt=function(l){function u(c,d,y,T){l.call(this,c,d,y,T),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(S){return!Array.isArray(S)||S.length!==2||S.some(function(M){return typeof M!="number"})})||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,y=d.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Ot.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(d,this.canvas,y.RGBA,{premultiply:!0}),this.tiles){var S=this.tiles[T];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var y=d[c];if(isNaN(y)||y<=0)return!0}return!1},u}(Qt),ut={vector:gr,raster:mr,"raster-dem":_r,geojson:rr,video:qt,image:Qt,canvas:Rt};function Vi(l,u){var c=s.identity([]);return s.translate(c,c,[1,1,0]),s.scale(c,c,[.5*l.width,.5*l.height,1]),s.multiply(c,c,l.calculatePosMatrix(u.toUnwrapped()))}function Sr(l,u,c,d,y,T){var S=function(ie,K,J){if(ie)for(var _e=0,Ee=ie;_e<Ee.length;_e+=1){var Ie=K[Ee[_e]];if(Ie&&Ie.source===J&&Ie.type==="fill-extrusion")return!0}else for(var Me in K){var Ge=K[Me];if(Ge.source===J&&Ge.type==="fill-extrusion")return!0}return!1}(y&&y.layers,u,l.id),M=T.maxPitchScaleFactor(),D=l.tilesIn(d,M,S);D.sort(Ur);for(var L=[],j=0,z=D;j<z.length;j+=1){var W=z[j];L.push({wrappedTileID:W.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(u,c,l._state,W.queryGeometry,W.cameraQueryGeometry,W.scale,y,T,M,Vi(l.transform,W.tileID))})}var te=function(ie){for(var K={},J={},_e=0,Ee=ie;_e<Ee.length;_e+=1){var Ie=Ee[_e],Me=Ie.queryResults,Ge=Ie.wrappedTileID,Qe=J[Ge]=J[Ge]||{};for(var st in Me)for(var rt=Me[st],lt=Qe[st]=Qe[st]||{},At=K[st]=K[st]||[],Tt=0,ft=rt;Tt<ft.length;Tt+=1){var Zt=ft[Tt];lt[Zt.featureIndex]||(lt[Zt.featureIndex]=!0,At.push(Zt))}}return K}(L);for(var Q in te)te[Q].forEach(function(ie){var K=ie.feature,J=l.getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=J});return te}function Ur(l,u){var c=l.tileID,d=u.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Dt=function(l,u){this.max=l,this.onRemove=u,this.reset()};Dt.prototype.reset=function(){for(var l in this.data)for(var u=0,c=this.data[l];u<c.length;u+=1){var d=c[u];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Dt.prototype.add=function(l,u,c){var d=this,y=l.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);var T={value:u,timeout:void 0};if(c!==void 0&&(T.timeout=setTimeout(function(){d.remove(l,T)},c)),this.data[y].push(T),this.order.push(y),this.order.length>this.max){var S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this},Dt.prototype.has=function(l){return l.wrapped().key in this.data},Dt.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Dt.prototype._getAndRemoveByKey=function(l){var u=this.data[l].shift();return u.timeout&&clearTimeout(u.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),u.value},Dt.prototype.getByKey=function(l){var u=this.data[l];return u?u[0].value:null},Dt.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Dt.prototype.remove=function(l,u){if(!this.has(l))return this;var c=l.wrapped().key,d=u===void 0?0:this.data[c].indexOf(u),y=this.data[c][d];return this.data[c].splice(d,1),y.timeout&&clearTimeout(y.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(y.value),this.order.splice(this.order.indexOf(c),1),this},Dt.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},Dt.prototype.filter=function(l){var u=[];for(var c in this.data)for(var d=0,y=this.data[c];d<y.length;d+=1){var T=y[d];l(T.value)||u.push(T)}for(var S=0,M=u;S<M.length;S+=1){var D=M[S];this.remove(D.value.tileID,D)}};var $r=function(l,u,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};$r.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},$r.prototype.updateData=function(l){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},$r.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Pi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},yi=function(l,u,c,d){this.length=u.length,this.attributes=c,this.itemSize=u.bytesPerElement,this.dynamicDraw=d,this.context=l;var y=l.gl;this.buffer=y.createBuffer(),l.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};yi.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},yi.prototype.updateData=function(l){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,l.arrayBuffer)},yi.prototype.enableAttributes=function(l,u){for(var c=0;c<this.attributes.length;c++){var d=u.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},yi.prototype.setVertexAttribPointers=function(l,u,c){for(var d=0;d<this.attributes.length;d++){var y=this.attributes[d],T=u.attributes[y.name];T!==void 0&&l.vertexAttribPointer(T,y.components,l[Pi[y.type]],!1,this.itemSize,y.offset+this.itemSize*(c||0))}},yi.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var dr=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};dr.prototype.get=function(){return this.current},dr.prototype.set=function(l){},dr.prototype.getDefault=function(){return this.default},dr.prototype.setDefault=function(){this.set(this.default)};var gn=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return s.Color.transparent},u.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},u}(dr),oi=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},u}(dr),xi=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},u}(dr),an=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},u}(dr),$i=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},u}(dr),Zs=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},u}(dr),ln=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},u}(dr),ni=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},u.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},u}(dr),Is=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},u}(dr),nn=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},u}(dr),Oi=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},u}(dr),is=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},u}(dr),vt=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},u}(dr),Yt=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},u.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},u}(dr),Mr=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return s.Color.transparent},u.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},u}(dr),qr=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},u}(dr),kn=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},u}(dr),Di=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},u}(dr),mn=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},u}(dr),Xn=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},u}(dr),ho=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},u}(dr),Ro=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},u.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},u}(dr),ea=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},u}(dr),Ia=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},u}(dr),Bo=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},u}(dr),al=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},u}(dr),Ks=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},u}(dr),Ms=function(l){function u(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},u}(dr),Rs=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},u}(dr),yt=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},u}(dr),Ma=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},u}(dr),vi=function(l){function u(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(dr),$=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},u}(vi),ee=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},u}(vi),oe=function(l,u,c,d){this.context=l,this.width=u,this.height=c;var y=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new $(l,y),d&&(this.depthAttachment=new ee(l,y))};oe.prototype.destroy=function(){var l=this.context.gl,u=this.colorAttachment.get();if(u&&l.deleteTexture(u),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var fe=function(l,u,c){this.func=l,this.mask=u,this.range=c};fe.ReadOnly=!1,fe.ReadWrite=!0,fe.disabled=new fe(519,fe.ReadOnly,[0,1]);var be=function(l,u,c,d,y,T){this.test=l,this.ref=u,this.mask=c,this.fail=d,this.depthFail=y,this.pass=T};be.disabled=new be({func:519,mask:0},0,0,7680,7680,7680);var Oe=function(l,u,c){this.blendFunction=l,this.blendColor=u,this.mask=c};Oe.disabled=new Oe(Oe.Replace=[1,0],s.Color.transparent,[!1,!1,!1,!1]),Oe.unblended=new Oe(Oe.Replace,s.Color.transparent,[!0,!0,!0,!0]),Oe.alphaBlended=new Oe([1,771],s.Color.transparent,[!0,!0,!0,!0]);var De=function(l,u,c){this.enable=l,this.mode=u,this.frontFace=c};De.disabled=new De(!1,1029,2305),De.backCCW=new De(!0,1029,2305);var ce=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new gn(this),this.clearDepth=new oi(this),this.clearStencil=new xi(this),this.colorMask=new an(this),this.depthMask=new $i(this),this.stencilMask=new Zs(this),this.stencilFunc=new ln(this),this.stencilOp=new ni(this),this.stencilTest=new Is(this),this.depthRange=new nn(this),this.depthTest=new Oi(this),this.depthFunc=new is(this),this.blend=new vt(this),this.blendFunc=new Yt(this),this.blendColor=new Mr(this),this.blendEquation=new qr(this),this.cullFace=new kn(this),this.cullFaceSide=new Di(this),this.frontFace=new mn(this),this.program=new Xn(this),this.activeTexture=new ho(this),this.viewport=new Ro(this),this.bindFramebuffer=new ea(this),this.bindRenderbuffer=new Ia(this),this.bindTexture=new Bo(this),this.bindVertexBuffer=new al(this),this.bindElementBuffer=new Ks(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ms(this),this.pixelStoreUnpack=new Rs(this),this.pixelStoreUnpackPremultiplyAlpha=new yt(this),this.pixelStoreUnpackFlipY=new Ma(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ce.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ce.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ce.prototype.createIndexBuffer=function(l,u){return new $r(this,l,u)},ce.prototype.createVertexBuffer=function(l,u,c){return new yi(this,l,u,c)},ce.prototype.createRenderbuffer=function(l,u,c){var d=this.gl,y=d.createRenderbuffer();return this.bindRenderbuffer.set(y),d.renderbufferStorage(d.RENDERBUFFER,l,u,c),this.bindRenderbuffer.set(null),y},ce.prototype.createFramebuffer=function(l,u,c){return new oe(this,l,u,c)},ce.prototype.clear=function(l){var u=l.color,c=l.depth,d=this.gl,y=0;u&&(y|=d.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(y|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(y)},ce.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ce.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ce.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ce.prototype.setColorMode=function(l){s.deepEqual(l.blendFunction,Oe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ce.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var we=function(l){function u(c,d,y){var T=this;l.call(this),this.id=c,this.dispatcher=y,this.on("data",function(S){S.dataType==="source"&&S.sourceDataType==="metadata"&&(T._sourceLoaded=!0),T._sourceLoaded&&!T._paused&&S.dataType==="source"&&S.sourceDataType==="content"&&(T.reload(),T.transform&&T.update(T.transform))}),this.on("error",function(){T._sourceErrored=!0}),this._source=function(S,M,D,L){var j=new ut[M.type](S,M,D,L);if(j.id!==S)throw new Error("Expected Source id to be "+S+" instead of "+j.id);return s.bindAll(["load","abort","unload","serialize","prepare"],j),j}(c,d,y,this),this._tiles={},this._cache=new Dt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new s.SourceFeatureState}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},u.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},u.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},u.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var y=this._tiles[d];y.upload(c),y.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return s.values(this._tiles).map(function(c){return c.tileID}).sort(he).map(function(c){return c.key})},u.prototype.getRenderableIds=function(c){var d=this,y=[];for(var T in this._tiles)this._isIdRenderable(T,c)&&y.push(this._tiles[T]);return c?y.sort(function(S,M){var D=S.tileID,L=M.tileID,j=new s.Point(D.canonical.x,D.canonical.y)._rotate(d.transform.angle),z=new s.Point(L.canonical.x,L.canonical.y)._rotate(d.transform.angle);return D.overscaledZ-L.overscaledZ||z.y-j.y||z.x-j.x}).map(function(S){return S.tileID.key}):y.map(function(S){return S.tileID}).sort(he).map(function(S){return S.key})},u.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},u.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},u.prototype._reloadTile=function(c,d){var y=this._tiles[c];y&&(y.state!=="loading"&&(y.state=d),this._loadTile(y,this._tileLoaded.bind(this,y,c,d)))},u.prototype._tileLoaded=function(c,d,y,T){if(T)return c.state="errored",void(T.status!==404?this._source.fire(new s.ErrorEvent(T,{tile:c})):this.update(this.transform));c.timeAdded=s.browser.now(),y==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new s.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},u.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),y=0;y<d.length;y++){var T=d[y];if(c.neighboringTiles&&c.neighboringTiles[T]){var S=this.getTileByID(T);M(c,S),M(S,c)}}function M(D,L){D.needsHillshadePrepare=!0;var j=L.tileID.canonical.x-D.tileID.canonical.x,z=L.tileID.canonical.y-D.tileID.canonical.y,W=Math.pow(2,D.tileID.canonical.z),te=L.tileID.key;j===0&&z===0||Math.abs(z)>1||(Math.abs(j)>1&&(Math.abs(j+W)===1?j+=W:Math.abs(j-W)===1&&(j-=W)),L.dem&&D.dem&&(D.dem.backfillBorder(L.dem,j,z),D.neighboringTiles&&D.neighboringTiles[te]&&(D.neighboringTiles[te].backfilled=!0)))}},u.prototype.getTile=function(c){return this.getTileByID(c.key)},u.prototype.getTileByID=function(c){return this._tiles[c]},u.prototype._retainLoadedChildren=function(c,d,y,T){for(var S in this._tiles){var M=this._tiles[S];if(!(T[S]||!M.hasData()||M.tileID.overscaledZ<=d||M.tileID.overscaledZ>y)){for(var D=M.tileID;M&&M.tileID.overscaledZ>d+1;){var L=M.tileID.scaledTo(M.tileID.overscaledZ-1);(M=this._tiles[L.key])&&M.hasData()&&(D=L)}for(var j=D;j.overscaledZ>d;)if(c[(j=j.scaledTo(j.overscaledZ-1)).key]){T[D.key]=D;break}}}},u.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var y=this._loadedParentTiles[c.key];return y&&y.tileID.overscaledZ>=d?y:null}for(var T=c.overscaledZ-1;T>=d;T--){var S=c.scaledTo(T),M=this._getLoadedTile(S);if(M)return M}},u.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},u.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,y=Math.ceil(c.height/this._source.tileSize)+1,T=Math.floor(d*y*5),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(S)},u.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var y={};for(var T in this._tiles){var S=this._tiles[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+d),y[S.tileID.key]=S}for(var M in this._tiles=y,this._timers)clearTimeout(this._timers[M]),delete this._timers[M];for(var D in this._tiles)this._setTileReloadTimer(D,this._tiles[D])}},u.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var y;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?y=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Qe){return new s.OverscaledTileID(Qe.canonical.z,Qe.wrap,Qe.canonical.z,Qe.canonical.x,Qe.canonical.y)}):(y=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(y=y.filter(function(Qe){return d._source.hasTile(Qe)}))):y=[];var T=c.coveringZoomLevel(this._source),S=Math.max(T-u.maxOverzooming,this._source.minzoom),M=Math.max(T+u.maxUnderzooming,this._source.minzoom),D=this._updateRetainedTiles(y,T);if(Re(this._source.type)){for(var L={},j={},z=0,W=Object.keys(D);z<W.length;z+=1){var te=W[z],Q=D[te],ie=this._tiles[te];if(ie&&!(ie.fadeEndTime&&ie.fadeEndTime<=s.browser.now())){var K=this.findLoadedParent(Q,S);K&&(this._addTile(K.tileID),L[K.tileID.key]=K.tileID),j[te]=Q}}for(var J in this._retainLoadedChildren(j,T,M,D),L)D[J]||(this._coveredTiles[J]=!0,D[J]=L[J])}for(var _e in D)this._tiles[_e].clearFadeHold();for(var Ee=0,Ie=s.keysDifference(this._tiles,D);Ee<Ie.length;Ee+=1){var Me=Ie[Ee],Ge=this._tiles[Me];Ge.hasSymbolBuckets&&!Ge.holdingForFade()?Ge.setHoldDuration(this.map._fadeDuration):Ge.hasSymbolBuckets&&!Ge.symbolFadeFinished()||this._removeTile(Me)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},u.prototype._updateRetainedTiles=function(c,d){for(var y={},T={},S=Math.max(d-u.maxOverzooming,this._source.minzoom),M=Math.max(d+u.maxUnderzooming,this._source.minzoom),D={},L=0,j=c;L<j.length;L+=1){var z=j[L],W=this._addTile(z);y[z.key]=z,W.hasData()||d<this._source.maxzoom&&(D[z.key]=z)}this._retainLoadedChildren(D,d,M,y);for(var te=0,Q=c;te<Q.length;te+=1){var ie=Q[te],K=this._tiles[ie.key];if(!K.hasData()){if(d+1>this._source.maxzoom){var J=ie.children(this._source.maxzoom)[0],_e=this.getTile(J);if(_e&&_e.hasData()){y[J.key]=J;continue}}else{var Ee=ie.children(this._source.maxzoom);if(y[Ee[0].key]&&y[Ee[1].key]&&y[Ee[2].key]&&y[Ee[3].key])continue}for(var Ie=K.wasRequested(),Me=ie.overscaledZ-1;Me>=S;--Me){var Ge=ie.scaledTo(Me);if(T[Ge.key]||(T[Ge.key]=!0,!(K=this.getTile(Ge))&&Ie&&(K=this._addTile(Ge)),K&&(y[Ge.key]=Ge,Ie=K.wasRequested(),K.hasData())))break}}}return y},u.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],y=void 0,T=this._tiles[c].tileID;T.overscaledZ>0;){if(T.key in this._loadedParentTiles){y=this._loadedParentTiles[T.key];break}d.push(T.key);var S=T.scaledTo(T.overscaledZ-1);if(y=this._getLoadedTile(S))break;T=S}for(var M=0,D=d;M<D.length;M+=1)this._loadedParentTiles[D[M]]=y}},u.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var y=!!d;return y||(d=new s.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,y||this._source.fire(new s.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},u.prototype._setTileReloadTimer=function(c,d){var y=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var T=d.getExpiryTimeout();T&&(this._timers[c]=setTimeout(function(){y._reloadTile(c,"expired"),delete y._timers[c]},T))},u.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},u.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},u.prototype.tilesIn=function(c,d,y){var T=this,S=[],M=this.transform;if(!M)return S;for(var D=y?M.getCameraQueryGeometry(c):c,L=c.map(function(Me){return M.pointCoordinate(Me)}),j=D.map(function(Me){return M.pointCoordinate(Me)}),z=this.getIds(),W=1/0,te=1/0,Q=-1/0,ie=-1/0,K=0,J=j;K<J.length;K+=1){var _e=J[K];W=Math.min(W,_e.x),te=Math.min(te,_e.y),Q=Math.max(Q,_e.x),ie=Math.max(ie,_e.y)}for(var Ee=function(Me){var Ge=T._tiles[z[Me]];if(!Ge.holdingForFade()){var Qe=Ge.tileID,st=Math.pow(2,M.zoom-Ge.tileID.overscaledZ),rt=d*Ge.queryPadding*s.EXTENT/Ge.tileSize/st,lt=[Qe.getTilePoint(new s.MercatorCoordinate(W,te)),Qe.getTilePoint(new s.MercatorCoordinate(Q,ie))];if(lt[0].x-rt<s.EXTENT&&lt[0].y-rt<s.EXTENT&&lt[1].x+rt>=0&&lt[1].y+rt>=0){var At=L.map(function(ft){return Qe.getTilePoint(ft)}),Tt=j.map(function(ft){return Qe.getTilePoint(ft)});S.push({tile:Ge,tileID:Qe,queryGeometry:At,cameraQueryGeometry:Tt,scale:st})}}},Ie=0;Ie<z.length;Ie++)Ee(Ie);return S},u.prototype.getVisibleCoordinates=function(c){for(var d=this,y=this.getRenderableIds(c).map(function(D){return d._tiles[D].tileID}),T=0,S=y;T<S.length;T+=1){var M=S[T];M.posMatrix=this.transform.calculatePosMatrix(M.toUnwrapped())}return y},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Re(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=s.browser.now())return!0}return!1},u.prototype.setFeatureState=function(c,d,y){this._state.updateState(c=c||"_geojsonTileLayer",d,y)},u.prototype.removeFeatureState=function(c,d,y){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,y)},u.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},u.prototype.setDependencies=function(c,d,y){var T=this._tiles[c];T&&T.setDependencies(d,y)},u.prototype.reloadTilesForDependencies=function(c,d){for(var y in this._tiles)this._tiles[y].hasDependency(c,d)&&this._reloadTile(y,"reloading");this._cache.filter(function(T){return!T.hasDependency(c,d)})},u}(s.Evented);function he(l,u){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*u.wrap)-+(u.wrap<0);return l.overscaledZ-u.overscaledZ||d-c||u.canonical.y-l.canonical.y||u.canonical.x-l.canonical.x}function Re(l){return l==="raster"||l==="image"||l==="video"}function ze(){return new s.window.Worker(b.workerUrl)}we.maxOverzooming=10,we.maxUnderzooming=3;var ke="mapboxgl_preloaded_worker_pool",_=function(){this.active={}};_.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<_.workerCount;)this.workers.push(new ze);return this.active[l]=!0,this.workers.slice()},_.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},_.prototype.isPreloaded=function(){return!!this.active[ke]},_.prototype.numActive=function(){return Object.keys(this.active).length};var ne,ht=Math.floor(s.browser.hardwareConcurrency/2);function qe(){return ne||(ne=new _),ne}function gt(l,u){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return s.refProperties.forEach(function(y){y in u&&(c[y]=u[y])}),c}function nt(l){l=l.slice();for(var u=Object.create(null),c=0;c<l.length;c++)u[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=gt(l[d],u[l[d].ref]));return l}_.workerCount=Math.max(Math.min(ht,6),1);var at={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function er(l,u,c){c.push({command:at.addSource,args:[l,u[l]]})}function ct(l,u,c){u.push({command:at.removeSource,args:[l]}),c[l]=!0}function It(l,u,c,d){ct(l,c,d),er(l,u,c)}function Ir(l,u,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!s.deepEqual(l[c][d],u[c][d]))return!1;for(d in u[c])if(u[c].hasOwnProperty(d)&&d!=="data"&&!s.deepEqual(l[c][d],u[c][d]))return!1;return!0}function yr(l,u,c,d,y,T){var S;for(S in u=u||{},l=l||{})l.hasOwnProperty(S)&&(s.deepEqual(l[S],u[S])||c.push({command:T,args:[d,S,u[S],y]}));for(S in u)u.hasOwnProperty(S)&&!l.hasOwnProperty(S)&&(s.deepEqual(l[S],u[S])||c.push({command:T,args:[d,S,u[S],y]}))}function Lr(l){return l.id}function ur(l,u){return l[u.id]=u,l}var Yr=function(l,u){this.reset(l,u)};Yr.prototype.reset=function(l,u){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Yr.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=s.clamp(l,0,1);for(var u=1,c=this._distances[u],d=l*this.paddedLength+this.padding;c<d&&u<this._distances.length;)c=this._distances[++u];var y=u-1,T=this._distances[y],S=c-T,M=S>0?(d-T)/S:0;return this.points[y].mult(1-M).add(this.points[u].mult(M))};var xr=function(l,u,c){var d=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(u/c);for(var T=0;T<this.xCellCount*this.yCellCount;T++)d.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=u,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Fr(l,u,c,d,y){var T=s.create();return u?(s.scale(T,T,[1/y,1/y,1]),c||s.rotateZ(T,T,d.angle)):s.multiply(T,d.labelPlaneMatrix,l),T}function zr(l,u,c,d,y){if(u){var T=s.clone(l);return s.scale(T,T,[y,y,1]),c||s.rotateZ(T,T,-d.angle),T}return d.glCoordMatrix}function Ar(l,u){var c=[l.x,l.y,0,1];Ii(c,c,u);var d=c[3];return{point:new s.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function pr(l,u){return .5+l/u*.5}function ir(l,u){var c=l[0]/l[3],d=l[1]/l[3];return c>=-u[0]&&c<=u[0]&&d>=-u[1]&&d<=u[1]}function me(l,u,c,d,y,T,S,M){var D=d?l.textSizeData:l.iconSizeData,L=s.evaluateSizeForZoom(D,c.transform.zoom),j=[256/c.width*2+1,256/c.height*2+1],z=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;z.clear();for(var W=l.lineVertexArray,te=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Q=c.transform.width/c.transform.height,ie=!1,K=0;K<te.length;K++){var J=te.get(K);if(J.hidden||J.writingMode===s.WritingMode.vertical&&!ie)ue(J.numGlyphs,z);else{ie=!1;var _e=[J.anchorX,J.anchorY,0,1];if(s.transformMat4(_e,_e,u),ir(_e,j)){var Ee=pr(c.transform.cameraToCenterDistance,_e[3]),Ie=s.evaluateSizeForFeature(D,L,J),Me=S?Ie/Ee:Ie*Ee,Ge=new s.Point(J.anchorX,J.anchorY),Qe=Ar(Ge,y).point,st={},rt=ta(J,Me,!1,M,u,y,T,l.glyphOffsetArray,W,z,Qe,Ge,st,Q);ie=rt.useVertical,(rt.notEnoughRoom||ie||rt.needsFlipping&&ta(J,Me,!0,M,u,y,T,l.glyphOffsetArray,W,z,Qe,Ge,st,Q).notEnoughRoom)&&ue(J.numGlyphs,z)}else ue(J.numGlyphs,z)}}d?l.text.dynamicLayoutVertexBuffer.updateData(z):l.icon.dynamicLayoutVertexBuffer.updateData(z)}function zt(l,u,c,d,y,T,S,M,D,L,j){var z=M.glyphStartIndex+M.numGlyphs,W=M.lineStartIndex,te=M.lineStartIndex+M.lineLength,Q=u.getoffsetX(M.glyphStartIndex),ie=u.getoffsetX(z-1),K=di(l*Q,c,d,y,T,S,M.segment,W,te,D,L,j);if(!K)return null;var J=di(l*ie,c,d,y,T,S,M.segment,W,te,D,L,j);return J?{first:K,last:J}:null}function hi(l,u,c,d){return l===s.WritingMode.horizontal&&Math.abs(c.y-u.y)>Math.abs(c.x-u.x)*d?{useVertical:!0}:(l===s.WritingMode.vertical?u.y<c.y:u.x>c.x)?{needsFlipping:!0}:null}function ta(l,u,c,d,y,T,S,M,D,L,j,z,W,te){var Q,ie=u/24,K=l.lineOffsetX*ie,J=l.lineOffsetY*ie;if(l.numGlyphs>1){var _e=l.glyphStartIndex+l.numGlyphs,Ee=l.lineStartIndex,Ie=l.lineStartIndex+l.lineLength,Me=zt(ie,M,K,J,c,j,z,l,D,T,W);if(!Me)return{notEnoughRoom:!0};var Ge=Ar(Me.first.point,S).point,Qe=Ar(Me.last.point,S).point;if(d&&!c){var st=hi(l.writingMode,Ge,Qe,te);if(st)return st}Q=[Me.first];for(var rt=l.glyphStartIndex+1;rt<_e-1;rt++)Q.push(di(ie*M.getoffsetX(rt),K,J,c,j,z,l.segment,Ee,Ie,D,T,W));Q.push(Me.last)}else{if(d&&!c){var lt=Ar(z,y).point,At=l.lineStartIndex+l.segment+1,Tt=new s.Point(D.getx(At),D.gety(At)),ft=Ar(Tt,y),Zt=ft.signedDistanceFromCamera>0?ft.point:Oo(z,Tt,lt,1,y),xt=hi(l.writingMode,lt,Zt,te);if(xt)return xt}var or=di(ie*M.getoffsetX(l.glyphStartIndex),K,J,c,j,z,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,D,T,W);if(!or)return{notEnoughRoom:!0};Q=[or]}for(var Tr=0,hr=Q;Tr<hr.length;Tr+=1){var cr=hr[Tr];s.addDynamicAttributes(L,cr.point,cr.angle)}return{}}function Oo(l,u,c,d,y){var T=Ar(l.add(l.sub(u)._unit()),y).point,S=c.sub(T);return c.add(S._mult(d/S.mag()))}function di(l,u,c,d,y,T,S,M,D,L,j,z){var W=d?l-u:l+u,te=W>0?1:-1,Q=0;d&&(te*=-1,Q=Math.PI),te<0&&(Q+=Math.PI);for(var ie=te>0?M+S:M+S+1,K=y,J=y,_e=0,Ee=0,Ie=Math.abs(W),Me=[];_e+Ee<=Ie;){if((ie+=te)<M||ie>=D)return null;if(J=K,Me.push(K),(K=z[ie])===void 0){var Ge=new s.Point(L.getx(ie),L.gety(ie)),Qe=Ar(Ge,j);if(Qe.signedDistanceFromCamera>0)K=z[ie]=Qe.point;else{var st=ie-te;K=Oo(_e===0?T:new s.Point(L.getx(st),L.gety(st)),Ge,J,Ie-_e+1,j)}}_e+=Ee,Ee=J.dist(K)}var rt=(Ie-_e)/Ee,lt=K.sub(J),At=lt.mult(rt)._add(J);At._add(lt._unit()._perp()._mult(c*te));var Tt=Q+Math.atan2(K.y-J.y,K.x-J.x);return Me.push(At),{point:At,angle:Tt,path:Me}}xr.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},xr.prototype.insert=function(l,u,c,d,y){this._forEachCell(u,c,d,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(y)},xr.prototype.insertCircle=function(l,u,c,d){this._forEachCell(u-d,c-d,u+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(u),this.circles.push(c),this.circles.push(d)},xr.prototype._insertBoxCell=function(l,u,c,d,y,T){this.boxCells[y].push(T)},xr.prototype._insertCircleCell=function(l,u,c,d,y,T){this.circleCells[y].push(T)},xr.prototype._query=function(l,u,c,d,y,T){if(c<0||l>this.width||d<0||u>this.height)return!y&&[];var S=[];if(l<=0&&u<=0&&this.width<=c&&this.height<=d){if(y)return!0;for(var M=0;M<this.boxKeys.length;M++)S.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(var D=0;D<this.circleKeys.length;D++){var L=this.circles[3*D],j=this.circles[3*D+1],z=this.circles[3*D+2];S.push({key:this.circleKeys[D],x1:L-z,y1:j-z,x2:L+z,y2:j+z})}return T?S.filter(T):S}return this._forEachCell(l,u,c,d,this._queryCell,S,{hitTest:y,seenUids:{box:{},circle:{}}},T),y?S.length>0:S},xr.prototype._queryCircle=function(l,u,c,d,y){var T=l-c,S=l+c,M=u-c,D=u+c;if(S<0||T>this.width||D<0||M>this.height)return!d&&[];var L=[];return this._forEachCell(T,M,S,D,this._queryCellCircle,L,{hitTest:d,circle:{x:l,y:u,radius:c},seenUids:{box:{},circle:{}}},y),d?L.length>0:L},xr.prototype.query=function(l,u,c,d,y){return this._query(l,u,c,d,!1,y)},xr.prototype.hitTest=function(l,u,c,d,y){return this._query(l,u,c,d,!0,y)},xr.prototype.hitTestCircle=function(l,u,c,d){return this._queryCircle(l,u,c,!0,d)},xr.prototype._queryCell=function(l,u,c,d,y,T,S,M){var D=S.seenUids,L=this.boxCells[y];if(L!==null)for(var j=this.bboxes,z=0,W=L;z<W.length;z+=1){var te=W[z];if(!D.box[te]){D.box[te]=!0;var Q=4*te;if(l<=j[Q+2]&&u<=j[Q+3]&&c>=j[Q+0]&&d>=j[Q+1]&&(!M||M(this.boxKeys[te]))){if(S.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[te],x1:j[Q],y1:j[Q+1],x2:j[Q+2],y2:j[Q+3]})}}}var ie=this.circleCells[y];if(ie!==null)for(var K=this.circles,J=0,_e=ie;J<_e.length;J+=1){var Ee=_e[J];if(!D.circle[Ee]){D.circle[Ee]=!0;var Ie=3*Ee;if(this._circleAndRectCollide(K[Ie],K[Ie+1],K[Ie+2],l,u,c,d)&&(!M||M(this.circleKeys[Ee]))){if(S.hitTest)return T.push(!0),!0;var Me=K[Ie],Ge=K[Ie+1],Qe=K[Ie+2];T.push({key:this.circleKeys[Ee],x1:Me-Qe,y1:Ge-Qe,x2:Me+Qe,y2:Ge+Qe})}}}},xr.prototype._queryCellCircle=function(l,u,c,d,y,T,S,M){var D=S.circle,L=S.seenUids,j=this.boxCells[y];if(j!==null)for(var z=this.bboxes,W=0,te=j;W<te.length;W+=1){var Q=te[W];if(!L.box[Q]){L.box[Q]=!0;var ie=4*Q;if(this._circleAndRectCollide(D.x,D.y,D.radius,z[ie+0],z[ie+1],z[ie+2],z[ie+3])&&(!M||M(this.boxKeys[Q])))return T.push(!0),!0}}var K=this.circleCells[y];if(K!==null)for(var J=this.circles,_e=0,Ee=K;_e<Ee.length;_e+=1){var Ie=Ee[_e];if(!L.circle[Ie]){L.circle[Ie]=!0;var Me=3*Ie;if(this._circlesCollide(J[Me],J[Me+1],J[Me+2],D.x,D.y,D.radius)&&(!M||M(this.circleKeys[Ie])))return T.push(!0),!0}}},xr.prototype._forEachCell=function(l,u,c,d,y,T,S,M){for(var D=this._convertToXCellCoord(l),L=this._convertToYCellCoord(u),j=this._convertToXCellCoord(c),z=this._convertToYCellCoord(d),W=D;W<=j;W++)for(var te=L;te<=z;te++)if(y.call(this,l,u,c,d,this.xCellCount*te+W,T,S,M))return},xr.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},xr.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},xr.prototype._circlesCollide=function(l,u,c,d,y,T){var S=d-l,M=y-u,D=c+T;return D*D>S*S+M*M},xr.prototype._circleAndRectCollide=function(l,u,c,d,y,T,S){var M=(T-d)/2,D=Math.abs(l-(d+M));if(D>M+c)return!1;var L=(S-y)/2,j=Math.abs(u-(y+L));if(j>L+c)return!1;if(D<=M||j<=L)return!0;var z=D-M,W=j-L;return z*z+W*W<=c*c};var Do=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ue(l,u){for(var c=0;c<l;c++){var d=u.length;u.resize(d+4),u.float32.set(Do,3*d)}}function Ii(l,u,c){var d=u[0],y=u[1];return l[0]=c[0]*d+c[4]*y+c[12],l[1]=c[1]*d+c[5]*y+c[13],l[3]=c[3]*d+c[7]*y+c[15],l}var Zi=function(l,u,c){u===void 0&&(u=new xr(l.width+200,l.height+200,25)),c===void 0&&(c=new xr(l.width+200,l.height+200,25)),this.transform=l,this.grid=u,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ai(l,u,c){return u*(s.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Zi.prototype.placeCollisionBox=function(l,u,c,d,y){var T=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),S=c*T.perspectiveRatio,M=l.x1*S+T.point.x,D=l.y1*S+T.point.y,L=l.x2*S+T.point.x,j=l.y2*S+T.point.y;return!this.isInsideGrid(M,D,L,j)||!u&&this.grid.hitTest(M,D,L,j,y)?{box:[],offscreen:!1}:{box:[M,D,L,j],offscreen:this.isOffscreen(M,D,L,j)}},Zi.prototype.placeCollisionCircles=function(l,u,c,d,y,T,S,M,D,L,j,z,W){var te=[],Q=new s.Point(u.anchorX,u.anchorY),ie=Ar(Q,T),K=pr(this.transform.cameraToCenterDistance,ie.signedDistanceFromCamera),J=(L?y/K:y*K)/s.ONE_EM,_e=Ar(Q,S).point,Ee=zt(J,d,u.lineOffsetX*J,u.lineOffsetY*J,!1,_e,Q,u,c,S,{}),Ie=!1,Me=!1,Ge=!0;if(Ee){for(var Qe=.5*z*K+W,st=new s.Point(-100,-100),rt=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),lt=new Yr,At=Ee.first,Tt=Ee.last,ft=[],Zt=At.path.length-1;Zt>=1;Zt--)ft.push(At.path[Zt]);for(var xt=1;xt<Tt.path.length;xt++)ft.push(Tt.path[xt]);var or=2.5*Qe;if(M){var Tr=ft.map(function(bo){return Ar(bo,M)});ft=Tr.some(function(bo){return bo.signedDistanceFromCamera<=0})?[]:Tr.map(function(bo){return bo.point})}var hr=[];if(ft.length>0){for(var cr=ft[0].clone(),wr=ft[0].clone(),ar=1;ar<ft.length;ar++)cr.x=Math.min(cr.x,ft[ar].x),cr.y=Math.min(cr.y,ft[ar].y),wr.x=Math.max(wr.x,ft[ar].x),wr.y=Math.max(wr.y,ft[ar].y);hr=cr.x>=st.x&&wr.x<=rt.x&&cr.y>=st.y&&wr.y<=rt.y?[ft]:wr.x<st.x||cr.x>rt.x||wr.y<st.y||cr.y>rt.y?[]:s.clipLine([ft],st.x,st.y,rt.x,rt.y)}for(var nr=0,wn=hr;nr<wn.length;nr+=1){var Wi;lt.reset(wn[nr],.25*Qe),Wi=lt.length<=.5*Qe?1:Math.ceil(lt.paddedLength/or)+1;for(var Jn=0;Jn<Wi;Jn++){var Bn=Jn/Math.max(Wi-1,1),Li=lt.lerp(Bn),Qi=Li.x+100,ks=Li.y+100;te.push(Qi,ks,Qe,0);var fs=Qi-Qe,bl=ks-Qe,xs=Qi+Qe,Wo=ks+Qe;if(Ge=Ge&&this.isOffscreen(fs,bl,xs,Wo),Me=Me||this.isInsideGrid(fs,bl,xs,Wo),!l&&this.grid.hitTestCircle(Qi,ks,Qe,j)&&(Ie=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ie}}}}return{circles:!D&&Ie||!Me?[]:te,offscreen:Ge,collisionDetected:Ie}},Zi.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],c=1/0,d=1/0,y=-1/0,T=-1/0,S=0,M=l;S<M.length;S+=1){var D=M[S],L=new s.Point(D.x+100,D.y+100);c=Math.min(c,L.x),d=Math.min(d,L.y),y=Math.max(y,L.x),T=Math.max(T,L.y),u.push(L)}for(var j={},z={},W=0,te=this.grid.query(c,d,y,T).concat(this.ignoredGrid.query(c,d,y,T));W<te.length;W+=1){var Q=te[W],ie=Q.key;if(j[ie.bucketInstanceId]===void 0&&(j[ie.bucketInstanceId]={}),!j[ie.bucketInstanceId][ie.featureIndex]){var K=[new s.Point(Q.x1,Q.y1),new s.Point(Q.x2,Q.y1),new s.Point(Q.x2,Q.y2),new s.Point(Q.x1,Q.y2)];s.polygonIntersectsPolygon(u,K)&&(j[ie.bucketInstanceId][ie.featureIndex]=!0,z[ie.bucketInstanceId]===void 0&&(z[ie.bucketInstanceId]=[]),z[ie.bucketInstanceId].push(ie.featureIndex))}}return z},Zi.prototype.insertCollisionBox=function(l,u,c,d,y){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:y},l[0],l[1],l[2],l[3])},Zi.prototype.insertCollisionCircles=function(l,u,c,d,y){for(var T=u?this.ignoredGrid:this.grid,S={bucketInstanceId:c,featureIndex:d,collisionGroupID:y},M=0;M<l.length;M+=4)T.insertCircle(S,l[M],l[M+1],l[M+2])},Zi.prototype.projectAndGetPerspectiveRatio=function(l,u,c){var d=[u,c,0,1];return Ii(d,d,l),{point:new s.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Zi.prototype.isOffscreen=function(l,u,c,d){return c<100||l>=this.screenRightBoundary||d<100||u>this.screenBottomBoundary},Zi.prototype.isInsideGrid=function(l,u,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&u<this.gridBottomBoundary},Zi.prototype.getViewportMatrix=function(){var l=s.identity([]);return s.translate(l,l,[-100,-100,0]),l};var ns=function(l,u,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?u:-u))):d&&c?1:0,this.placed=c};ns.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Rn=function(l,u,c,d,y){this.text=new ns(l?l.text:null,u,c,y),this.icon=new ns(l?l.icon:null,u,d,y)};Rn.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Zl=function(l,u,c){this.text=l,this.icon=u,this.skipFade=c},qn=function(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]},Uc=function(l,u,c,d,y){this.bucketInstanceId=l,this.featureIndex=u,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=y},le=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function de(l,u,c,d,y){var T=s.getAnchorAlignment(l),S=-(T.horizontalAlign-.5)*u,M=-(T.verticalAlign-.5)*c,D=s.evaluateVariableOffset(l,d);return new s.Point(S+D[0]*y,M+D[1]*y)}function Ce(l,u,c,d,y,T){var S=l.x1,M=l.x2,D=l.y1,L=l.y2,j=l.anchorPointX,z=l.anchorPointY,W=new s.Point(u,c);return d&&W._rotate(y?T:-T),{x1:S+W.x,y1:D+W.y,x2:M+W.x,y2:L+W.y,anchorPointX:j,anchorPointY:z}}le.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var u=++this.maxGroupID;this.collisionGroups[l]={ID:u,predicate:function(c){return c.collisionGroupID===u}}}return this.collisionGroups[l]};var Ze=function(l,u,c,d){this.transform=l.clone(),this.collisionIndex=new Zi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new le(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function mt(l,u,c,d,y){l.emplaceBack(u?1:0,c?1:0,d||0,y||0),l.emplaceBack(u?1:0,c?1:0,d||0,y||0),l.emplaceBack(u?1:0,c?1:0,d||0,y||0),l.emplaceBack(u?1:0,c?1:0,d||0,y||0)}Ze.prototype.getBucketParts=function(l,u,c,d){var y=c.getBucket(u),T=c.latestFeatureIndex;if(y&&T&&u.id===y.layerIds[0]){var S=c.collisionBoxArray,M=y.layers[0].layout,D=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),L=c.tileSize/s.EXTENT,j=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),z=M.get("text-pitch-alignment")==="map",W=M.get("text-rotation-alignment")==="map",te=ai(c,1,this.transform.zoom),Q=Fr(j,z,W,this.transform,te),ie=null;if(z){var K=zr(j,z,W,this.transform,te);ie=s.multiply([],this.transform.labelPlaneMatrix,K)}this.retainedQueryData[y.bucketInstanceId]=new Uc(y.bucketInstanceId,T,y.sourceLayerIndex,y.index,c.tileID);var J={bucket:y,layout:M,posMatrix:j,textLabelPlaneMatrix:Q,labelToScreenMatrix:ie,scale:D,textPixelRatio:L,holdingForFade:c.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(d)for(var _e=0,Ee=y.sortKeyRanges;_e<Ee.length;_e+=1){var Ie=Ee[_e];l.push({sortKey:Ie.sortKey,symbolInstanceStart:Ie.symbolInstanceStart,symbolInstanceEnd:Ie.symbolInstanceEnd,parameters:J})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:J})}},Ze.prototype.attemptAnchorPlacement=function(l,u,c,d,y,T,S,M,D,L,j,z,W,te,Q){var ie,K=[z.textOffset0,z.textOffset1],J=de(l,c,d,K,y),_e=this.collisionIndex.placeCollisionBox(Ce(u,J.x,J.y,T,S,this.transform.angle),j,M,D,L.predicate);if(!Q||this.collisionIndex.placeCollisionBox(Ce(Q,J.x,J.y,T,S,this.transform.angle),j,M,D,L.predicate).box.length!==0)return _e.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID].text&&(ie=this.prevPlacement.variableOffsets[z.crossTileID].anchor),this.variableOffsets[z.crossTileID]={textOffset:K,width:c,height:d,anchor:l,textBoxScale:y,prevAnchor:ie},this.markUsedJustification(W,l,z,te),W.allowVerticalPlacement&&(this.markUsedOrientation(W,te,z),this.placedOrientations[z.crossTileID]=te),{shift:J,placedGlyphBoxes:_e}):void 0},Ze.prototype.placeLayerBucketPart=function(l,u,c){var d=this,y=l.parameters,T=y.bucket,S=y.layout,M=y.posMatrix,D=y.textLabelPlaneMatrix,L=y.labelToScreenMatrix,j=y.textPixelRatio,z=y.holdingForFade,W=y.collisionBoxArray,te=y.partiallyEvaluatedTextSize,Q=y.collisionGroup,ie=S.get("text-optional"),K=S.get("icon-optional"),J=S.get("text-allow-overlap"),_e=S.get("icon-allow-overlap"),Ee=S.get("text-rotation-alignment")==="map",Ie=S.get("text-pitch-alignment")==="map",Me=S.get("icon-text-fit")!=="none",Ge=S.get("symbol-z-order")==="viewport-y",Qe=J&&(_e||!T.hasIconData()||K),st=_e&&(J||!T.hasTextData()||ie);!T.collisionArrays&&W&&T.deserializeCollisionBoxes(W);var rt=function(xt,or){if(!u[xt.crossTileID])if(z)d.placements[xt.crossTileID]=new Zl(!1,!1,!1);else{var Tr,hr=!1,cr=!1,wr=!0,ar=null,nr={box:null,offscreen:null},wn={box:null,offscreen:null},Wi=null,Jn=null,Bn=0,Li=0,Qi=0;or.textFeatureIndex?Bn=or.textFeatureIndex:xt.useRuntimeCollisionCircles&&(Bn=xt.featureIndex),or.verticalTextFeatureIndex&&(Li=or.verticalTextFeatureIndex);var ks=or.textBox;if(ks){var fs=function(Jr){var so=s.WritingMode.horizontal;if(T.allowVerticalPlacement&&!Jr&&d.prevPlacement){var ws=d.prevPlacement.placedOrientations[xt.crossTileID];ws&&(d.placedOrientations[xt.crossTileID]=ws,d.markUsedOrientation(T,so=ws,xt))}return so},bl=function(Jr,so){if(T.allowVerticalPlacement&&xt.numVerticalGlyphVertices>0&&or.verticalTextBox)for(var ws=0,cc=T.writingModes;ws<cc.length&&(cc[ws]===s.WritingMode.vertical?(nr=so(),wn=nr):nr=Jr(),!(nr&&nr.box&&nr.box.length));ws+=1);else nr=Jr()};if(S.get("text-variable-anchor")){var xs=S.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[xt.crossTileID]){var Wo=d.prevPlacement.variableOffsets[xt.crossTileID];xs.indexOf(Wo.anchor)>0&&(xs=xs.filter(function(Jr){return Jr!==Wo.anchor})).unshift(Wo.anchor)}var bo=function(Jr,so,ws){for(var cc=Jr.x2-Jr.x1,hy=Jr.y2-Jr.y1,mf=xt.textBoxScale,fy=Me&&!_e?so:null,ah={box:[],offscreen:!1},x0=J?2*xs.length:xs.length,lu=0;lu<x0;++lu){var _f=d.attemptAnchorPlacement(xs[lu%xs.length],Jr,cc,hy,mf,Ee,Ie,j,M,Q,lu>=xs.length,xt,T,ws,fy);if(_f&&(ah=_f.placedGlyphBoxes)&&ah.box&&ah.box.length){hr=!0,ar=_f.shift;break}}return ah};bl(function(){return bo(ks,or.iconBox,s.WritingMode.horizontal)},function(){var Jr=or.verticalTextBox;return T.allowVerticalPlacement&&!(nr&&nr.box&&nr.box.length)&&xt.numVerticalGlyphVertices>0&&Jr?bo(Jr,or.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),nr&&(hr=nr.box,wr=nr.offscreen);var nh=fs(nr&&nr.box);if(!hr&&d.prevPlacement){var ou=d.prevPlacement.variableOffsets[xt.crossTileID];ou&&(d.variableOffsets[xt.crossTileID]=ou,d.markUsedJustification(T,ou.anchor,xt,nh))}}else{var xl=function(Jr,so){var ws=d.collisionIndex.placeCollisionBox(Jr,J,j,M,Q.predicate);return ws&&ws.box&&ws.box.length&&(d.markUsedOrientation(T,so,xt),d.placedOrientations[xt.crossTileID]=so),ws};bl(function(){return xl(ks,s.WritingMode.horizontal)},function(){var Jr=or.verticalTextBox;return T.allowVerticalPlacement&&xt.numVerticalGlyphVertices>0&&Jr?xl(Jr,s.WritingMode.vertical):{box:null,offscreen:null}}),fs(nr&&nr.box&&nr.box.length)}}if(hr=(Tr=nr)&&Tr.box&&Tr.box.length>0,wr=Tr&&Tr.offscreen,xt.useRuntimeCollisionCircles){var au=T.text.placedSymbolArray.get(xt.centerJustifiedTextSymbolIndex),sh=s.evaluateSizeForFeature(T.textSizeData,te,au),ya=S.get("text-padding");Wi=d.collisionIndex.placeCollisionCircles(J,au,T.lineVertexArray,T.glyphOffsetArray,sh,M,D,L,c,Ie,Q.predicate,xt.collisionCircleDiameter,ya),hr=J||Wi.circles.length>0&&!Wi.collisionDetected,wr=wr&&Wi.offscreen}if(or.iconFeatureIndex&&(Qi=or.iconFeatureIndex),or.iconBox){var oh=function(Jr){var so=Me&&ar?Ce(Jr,ar.x,ar.y,Ee,Ie,d.transform.angle):Jr;return d.collisionIndex.placeCollisionBox(so,_e,j,M,Q.predicate)};cr=wn&&wn.box&&wn.box.length&&or.verticalIconBox?(Jn=oh(or.verticalIconBox)).box.length>0:(Jn=oh(or.iconBox)).box.length>0,wr=wr&&Jn.offscreen}var va=ie||xt.numHorizontalGlyphVertices===0&&xt.numVerticalGlyphVertices===0,Tn=K||xt.numIconVertices===0;if(va||Tn?Tn?va||(cr=cr&&hr):hr=cr&&hr:cr=hr=cr&&hr,hr&&Tr&&Tr.box&&d.collisionIndex.insertCollisionBox(Tr.box,S.get("text-ignore-placement"),T.bucketInstanceId,wn&&wn.box&&Li?Li:Bn,Q.ID),cr&&Jn&&d.collisionIndex.insertCollisionBox(Jn.box,S.get("icon-ignore-placement"),T.bucketInstanceId,Qi,Q.ID),Wi&&(hr&&d.collisionIndex.insertCollisionCircles(Wi.circles,S.get("text-ignore-placement"),T.bucketInstanceId,Bn,Q.ID),c)){var Na=T.bucketInstanceId,wl=d.collisionCircleArrays[Na];wl===void 0&&(wl=d.collisionCircleArrays[Na]=new qn);for(var lc=0;lc<Wi.circles.length;lc+=4)wl.circles.push(Wi.circles[lc+0]),wl.circles.push(Wi.circles[lc+1]),wl.circles.push(Wi.circles[lc+2]),wl.circles.push(Wi.collisionDetected?1:0)}d.placements[xt.crossTileID]=new Zl(hr||Qe,cr||st,wr||T.justReloaded),u[xt.crossTileID]=!0}};if(Ge)for(var lt=T.getSortedSymbolIndexes(this.transform.angle),At=lt.length-1;At>=0;--At){var Tt=lt[At];rt(T.symbolInstances.get(Tt),T.collisionArrays[Tt])}else for(var ft=l.symbolInstanceStart;ft<l.symbolInstanceEnd;ft++)rt(T.symbolInstances.get(ft),T.collisionArrays[ft]);if(c&&T.bucketInstanceId in this.collisionCircleArrays){var Zt=this.collisionCircleArrays[T.bucketInstanceId];s.invert(Zt.invProjMatrix,M),Zt.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1},Ze.prototype.markUsedJustification=function(l,u,c,d){var y;y=d===s.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(u)];for(var T=0,S=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];T<S.length;T+=1){var M=S[T];M>=0&&(l.text.placedSymbolArray.get(M).crossTileID=y>=0&&M!==y?0:c.crossTileID)}},Ze.prototype.markUsedOrientation=function(l,u,c){for(var d=u===s.WritingMode.horizontal||u===s.WritingMode.horizontalOnly?u:0,y=u===s.WritingMode.vertical?u:0,T=0,S=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];T<S.length;T+=1)l.text.placedSymbolArray.get(S[T]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=y)},Ze.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,c=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var d=u?u.symbolFadeChange(l):1,y=u?u.opacities:{},T=u?u.variableOffsets:{},S=u?u.placedOrientations:{};for(var M in this.placements){var D=this.placements[M],L=y[M];L?(this.opacities[M]=new Rn(L,d,D.text,D.icon),c=c||D.text!==L.text.placed||D.icon!==L.icon.placed):(this.opacities[M]=new Rn(null,d,D.text,D.icon,D.skipFade),c=c||D.text||D.icon)}for(var j in y){var z=y[j];if(!this.opacities[j]){var W=new Rn(z,d,!1,!1);W.isHidden()||(this.opacities[j]=W,c=c||z.text.placed||z.icon.placed)}}for(var te in T)this.variableOffsets[te]||!this.opacities[te]||this.opacities[te].isHidden()||(this.variableOffsets[te]=T[te]);for(var Q in S)this.placedOrientations[Q]||!this.opacities[Q]||this.opacities[Q].isHidden()||(this.placedOrientations[Q]=S[Q]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:l)},Ze.prototype.updateLayerOpacities=function(l,u){for(var c={},d=0,y=u;d<y.length;d+=1){var T=y[d],S=T.getBucket(l);S&&T.latestFeatureIndex&&l.id===S.layerIds[0]&&this.updateBucketOpacities(S,c,T.collisionBoxArray)}},Ze.prototype.updateBucketOpacities=function(l,u,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var y=l.layers[0].layout,T=new Rn(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),M=y.get("icon-allow-overlap"),D=y.get("text-variable-anchor"),L=y.get("text-rotation-alignment")==="map",j=y.get("text-pitch-alignment")==="map",z=y.get("icon-text-fit")!=="none",W=new Rn(null,0,S&&(M||!l.hasIconData()||y.get("icon-optional")),M&&(S||!l.hasTextData()||y.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var te=function(J,_e,Ee){for(var Ie=0;Ie<_e/4;Ie++)J.opacityVertexArray.emplaceBack(Ee)},Q=function(J){var _e=l.symbolInstances.get(J),Ee=_e.numHorizontalGlyphVertices,Ie=_e.numVerticalGlyphVertices,Me=_e.crossTileID,Ge=d.opacities[Me];u[Me]?Ge=T:Ge||(d.opacities[Me]=Ge=W),u[Me]=!0;var Qe=_e.numIconVertices>0,st=d.placedOrientations[_e.crossTileID],rt=st===s.WritingMode.vertical,lt=st===s.WritingMode.horizontal||st===s.WritingMode.horizontalOnly;if(Ee>0||Ie>0){var At=Gu(Ge.text);te(l.text,Ee,rt?ll:At),te(l.text,Ie,lt?ll:At);var Tt=Ge.text.isHidden();[_e.rightJustifiedTextSymbolIndex,_e.centerJustifiedTextSymbolIndex,_e.leftJustifiedTextSymbolIndex].forEach(function(nr){nr>=0&&(l.text.placedSymbolArray.get(nr).hidden=Tt||rt?1:0)}),_e.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(_e.verticalPlacedTextSymbolIndex).hidden=Tt||lt?1:0);var ft=d.variableOffsets[_e.crossTileID];ft&&d.markUsedJustification(l,ft.anchor,_e,st);var Zt=d.placedOrientations[_e.crossTileID];Zt&&(d.markUsedJustification(l,"left",_e,Zt),d.markUsedOrientation(l,Zt,_e))}if(Qe){var xt=Gu(Ge.icon),or=!(z&&_e.verticalPlacedIconSymbolIndex&&rt);_e.placedIconSymbolIndex>=0&&(te(l.icon,_e.numIconVertices,or?xt:ll),l.icon.placedSymbolArray.get(_e.placedIconSymbolIndex).hidden=Ge.icon.isHidden()),_e.verticalPlacedIconSymbolIndex>=0&&(te(l.icon,_e.numVerticalIconVertices,or?ll:xt),l.icon.placedSymbolArray.get(_e.verticalPlacedIconSymbolIndex).hidden=Ge.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var Tr=l.collisionArrays[J];if(Tr){var hr=new s.Point(0,0);if(Tr.textBox||Tr.verticalTextBox){var cr=!0;if(D){var wr=d.variableOffsets[Me];wr?(hr=de(wr.anchor,wr.width,wr.height,wr.textOffset,wr.textBoxScale),L&&hr._rotate(j?d.transform.angle:-d.transform.angle)):cr=!1}Tr.textBox&&mt(l.textCollisionBox.collisionVertexArray,Ge.text.placed,!cr||rt,hr.x,hr.y),Tr.verticalTextBox&&mt(l.textCollisionBox.collisionVertexArray,Ge.text.placed,!cr||lt,hr.x,hr.y)}var ar=!!(!lt&&Tr.verticalIconBox);Tr.iconBox&&mt(l.iconCollisionBox.collisionVertexArray,Ge.icon.placed,ar,z?hr.x:0,z?hr.y:0),Tr.verticalIconBox&&mt(l.iconCollisionBox.collisionVertexArray,Ge.icon.placed,!ar,z?hr.x:0,z?hr.y:0)}}},ie=0;ie<l.symbolInstances.length;ie++)Q(ie);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var K=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=K.invProjMatrix,l.placementViewportMatrix=K.viewportMatrix,l.collisionCircleArray=K.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Ze.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ze.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Ze.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Ze.prototype.stillRecent=function(l,u){var c=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*c>l},Ze.prototype.setStale=function(){this.stale=!0};var Vt=Math.pow(2,25),Vr=Math.pow(2,24),ji=Math.pow(2,17),cn=Math.pow(2,16),_n=Math.pow(2,9),Wr=Math.pow(2,8),zc=Math.pow(2,1);function Gu(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var u=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Vt+u*Vr+c*ji+u*cn+c*_n+u*Wr+c*zc+u}var ll=0,Wu=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Wu.prototype.continuePlacement=function(l,u,c,d,y){for(var T=this._bucketParts;this._currentTileIndex<l.length;)if(u.getBucketParts(T,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort(function(S,M){return S.sortKey-M.sortKey}));this._currentPartIndex<T.length;)if(u.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,y())return!0;return!1};var Kl=function(l,u,c,d,y,T,S){this.placement=new Ze(l,y,T,S),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Kl.prototype.isDone=function(){return this._done},Kl.prototype.continuePlacement=function(l,u,c){for(var d=this,y=s.browser.now(),T=function(){var D=s.browser.now()-y;return!d._forceFullPlacement&&D>2};this._currentPlacementIndex>=0;){var S=u[l[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Wu(S)),this._inProgressLayer.continuePlacement(c[S.source],this.placement,this._showCollisionBoxes,S,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Kl.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Xu=512/s.EXTENT/2,cl=function(l,u,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<u.length;d++){var y=u.get(d),T=y.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,l)})}};cl.prototype.getScaledCoordinates=function(l,u){var c=Xu/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*s.EXTENT+l.anchorX)*c),y:Math.floor((u.canonical.y*s.EXTENT+l.anchorY)*c)}},cl.prototype.findMatches=function(l,u,c){for(var d=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),y=0;y<l.length;y++){var T=l.get(y);if(!T.crossTileID){var S=this.indexedSymbolInstances[T.key];if(S)for(var M=this.getScaledCoordinates(T,u),D=0,L=S;D<L.length;D+=1){var j=L[D];if(Math.abs(j.coord.x-M.x)<=d&&Math.abs(j.coord.y-M.y)<=d&&!c[j.crossTileID]){c[j.crossTileID]=!0,T.crossTileID=j.crossTileID;break}}}}};var ss=function(){this.maxCrossTileID=0};ss.prototype.generate=function(){return++this.maxCrossTileID};var ra=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ra.prototype.handleWrapJump=function(l){var u=Math.round((l-this.lng)/360);if(u!==0)for(var c in this.indexes){var d=this.indexes[c],y={};for(var T in d){var S=d[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),y[S.tileID.key]=S}this.indexes[c]=y}this.lng=l},ra.prototype.addBucket=function(l,u,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<u.symbolInstances.length;d++)u.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var y=this.usedCrossTileIDs[l.overscaledZ];for(var T in this.indexes){var S=this.indexes[T];if(Number(T)>l.overscaledZ)for(var M in S){var D=S[M];D.tileID.isChildOf(l)&&D.findMatches(u.symbolInstances,l,y)}else{var L=S[l.scaledTo(Number(T)).key];L&&L.findMatches(u.symbolInstances,l,y)}}for(var j=0;j<u.symbolInstances.length;j++){var z=u.symbolInstances.get(j);z.crossTileID||(z.crossTileID=c.generate(),y[z.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new cl(l,u.symbolInstances,u.bucketInstanceId),!0},ra.prototype.removeBucketCrossTileIDs=function(l,u){for(var c in u.indexedSymbolInstances)for(var d=0,y=u.indexedSymbolInstances[c];d<y.length;d+=1)delete this.usedCrossTileIDs[l][y[d].crossTileID]},ra.prototype.removeStaleBuckets=function(l){var u=!1;for(var c in this.indexes){var d=this.indexes[c];for(var y in d)l[d[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[y]),delete d[y],u=!0)}return u};var ia=function(){this.layerIndexes={},this.crossTileIDs=new ss,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ia.prototype.addLayer=function(l,u,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new ra);var y=!1,T={};d.handleWrapJump(c);for(var S=0,M=u;S<M.length;S+=1){var D=M[S],L=D.getBucket(l);L&&l.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(D.tileID,L,this.crossTileIDs)&&(y=!0),T[L.bucketInstanceId]=!0)}return d.removeStaleBuckets(T)&&(y=!0),y},ia.prototype.pruneUnusedLayers=function(l){var u={};for(var c in l.forEach(function(d){u[d]=!0}),this.layerIndexes)u[c]||delete this.layerIndexes[c]};var na=function(l,u){return s.emitValidationErrors(l,u&&u.filter(function(c){return c.identifier!=="source.canvas"}))},Fo=s.pick(at,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Lo=s.pick(at,["setCenter","setZoom","setBearing","setPitch"]),Vc=function(){var l={},u=s.styleSpec.$version;for(var c in s.styleSpec.$root){var d,y=s.styleSpec.$root[c];y.required&&(d=c==="version"?u:y.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),os=function(l){function u(c,d){var y=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Xe(qe(),this),this.imageManager=new Y,this.imageManager.setEventedParent(this),this.glyphManager=new pe(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Ve(256,512),this.crossTileSymbolIndex=new ia,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());var T=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(S){T.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},function(M,D){if(s.triggerPluginCompletionEvent(M),D&&D.every(function(j){return j}))for(var L in T.sourceCaches)T.sourceCaches[L].reload()})}),this.on("data",function(S){if(S.dataType==="source"&&S.sourceDataType==="metadata"){var M=y.sourceCaches[S.sourceId];if(M){var D=M.getSource();if(D&&D.vectorLayerIds)for(var L in y._layers){var j=y._layers[L];j.source===D.id&&y._validateLayer(j)}}}})}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.loadURL=function(c,d){var y=this;d===void 0&&(d={}),this.fire(new s.Event("dataloading",{dataType:"style"}));var T=typeof d.validate=="boolean"?d.validate:!s.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var S=this.map._requestManager.transformRequest(c,s.ResourceType.Style);this._request=s.getJSON(S,function(M,D){y._request=null,M?y.fire(new s.ErrorEvent(M)):D&&y._load(D,T)})},u.prototype.loadJSON=function(c,d){var y=this;d===void 0&&(d={}),this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.browser.frame(function(){y._request=null,y._load(c,d.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Vc,!1)},u.prototype._load=function(c,d){if(!d||!na(this,s.validateStyle(c))){for(var y in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(y,c.sources[y],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var T=nt(this.stylesheet.layers);this._order=T.map(function(L){return L.id}),this._layers={},this._serializedLayers={};for(var S=0,M=T;S<M.length;S+=1){var D=M[S];(D=s.createStyleLayer(D)).setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D,this._serializedLayers[D.id]=D.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Le(this.stylesheet.light),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}},u.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(y,T,S){var M,D,L,j=s.browser.devicePixelRatio>1?"@2x":"",z=s.getJSON(T.transformRequest(T.normalizeSpriteURL(y,j,".json"),s.ResourceType.SpriteJSON),function(Q,ie){z=null,L||(L=Q,M=ie,te())}),W=s.getImage(T.transformRequest(T.normalizeSpriteURL(y,j,".png"),s.ResourceType.SpriteImage),function(Q,ie){W=null,L||(L=Q,D=ie,te())});function te(){if(L)S(L);else if(M&&D){var Q=s.browser.getImageData(D),ie={};for(var K in M){var J=M[K],_e=J.width,Ee=J.height,Ie=J.x,Me=J.y,Ge=J.sdf,Qe=J.pixelRatio,st=J.stretchX,rt=J.stretchY,lt=J.content,At=new s.RGBAImage({width:_e,height:Ee});s.RGBAImage.copy(Q,At,{x:Ie,y:Me},{x:0,y:0},{width:_e,height:Ee}),ie[K]={data:At,pixelRatio:Qe,sdf:Ge,stretchX:st,stretchY:rt,content:lt}}S(null,ie)}}return{cancel:function(){z&&(z.cancel(),z=null),W&&(W.cancel(),W=null)}}}(c,this.map._requestManager,function(y,T){if(d._spriteRequest=null,y)d.fire(new s.ErrorEvent(y));else if(T)for(var S in T)d.imageManager.addImage(S,T[S]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new s.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var y=c.sourceLayer;if(y){var T=d.getSource();(T.type==="geojson"||T.vectorLayerIds&&T.vectorLayerIds.indexOf(y)===-1)&&this.fire(new s.ErrorEvent(new Error('Source layer "'+y+'" does not exist on source "'+T.id+'" as specified by style layer "'+c.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(c){for(var d=[],y=0,T=c;y<T.length;y+=1){var S=this._layers[T[y]];S.type!=="custom"&&d.push(S.serialize())}return d},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var y=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);for(var S in(y.length||T.length)&&this._updateWorkerLayers(y,T),this._updatedSources){var M=this._updatedSources[S];M==="reload"?this._reloadSource(S):M==="clear"&&this._clearSource(S)}for(var D in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[D].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var L={};for(var j in this.sourceCaches){var z=this.sourceCaches[j];L[j]=z.used,z.used=!1}for(var W=0,te=this._order;W<te.length;W+=1){var Q=this._layers[te[W]];Q.recalculate(c,this._availableImages),!Q.isHidden(c.zoom)&&Q.source&&(this.sourceCaches[Q.source].used=!0)}for(var ie in L){var K=this.sourceCaches[ie];L[ie]!==K.used&&K.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ie}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new s.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},u.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(c){var d=this;if(this._checkLoaded(),na(this,s.validateStyle(c)))return!1;(c=s.clone$1(c)).layers=nt(c.layers);var y=function(S,M){if(!S)return[{command:at.setStyle,args:[M]}];var D=[];try{if(!s.deepEqual(S.version,M.version))return[{command:at.setStyle,args:[M]}];s.deepEqual(S.center,M.center)||D.push({command:at.setCenter,args:[M.center]}),s.deepEqual(S.zoom,M.zoom)||D.push({command:at.setZoom,args:[M.zoom]}),s.deepEqual(S.bearing,M.bearing)||D.push({command:at.setBearing,args:[M.bearing]}),s.deepEqual(S.pitch,M.pitch)||D.push({command:at.setPitch,args:[M.pitch]}),s.deepEqual(S.sprite,M.sprite)||D.push({command:at.setSprite,args:[M.sprite]}),s.deepEqual(S.glyphs,M.glyphs)||D.push({command:at.setGlyphs,args:[M.glyphs]}),s.deepEqual(S.transition,M.transition)||D.push({command:at.setTransition,args:[M.transition]}),s.deepEqual(S.light,M.light)||D.push({command:at.setLight,args:[M.light]});var L={},j=[];(function(W,te,Q,ie){var K;for(K in te=te||{},W=W||{})W.hasOwnProperty(K)&&(te.hasOwnProperty(K)||ct(K,Q,ie));for(K in te)te.hasOwnProperty(K)&&(W.hasOwnProperty(K)?s.deepEqual(W[K],te[K])||(W[K].type==="geojson"&&te[K].type==="geojson"&&Ir(W,te,K)?Q.push({command:at.setGeoJSONSourceData,args:[K,te[K].data]}):It(K,te,Q,ie)):er(K,te,Q))})(S.sources,M.sources,j,L);var z=[];S.layers&&S.layers.forEach(function(W){L[W.source]?D.push({command:at.removeLayer,args:[W.id]}):z.push(W)}),D=D.concat(j),function(W,te,Q){te=te||[];var ie,K,J,_e,Ee,Ie,Me,Ge=(W=W||[]).map(Lr),Qe=te.map(Lr),st=W.reduce(ur,{}),rt=te.reduce(ur,{}),lt=Ge.slice(),At=Object.create(null);for(ie=0,K=0;ie<Ge.length;ie++)rt.hasOwnProperty(J=Ge[ie])?K++:(Q.push({command:at.removeLayer,args:[J]}),lt.splice(lt.indexOf(J,K),1));for(ie=0,K=0;ie<Qe.length;ie++)lt[lt.length-1-ie]!==(J=Qe[Qe.length-1-ie])&&(st.hasOwnProperty(J)?(Q.push({command:at.removeLayer,args:[J]}),lt.splice(lt.lastIndexOf(J,lt.length-K),1)):K++,Q.push({command:at.addLayer,args:[rt[J],Ie=lt[lt.length-ie]]}),lt.splice(lt.length-ie,0,J),At[J]=!0);for(ie=0;ie<Qe.length;ie++)if(_e=st[J=Qe[ie]],Ee=rt[J],!At[J]&&!s.deepEqual(_e,Ee))if(s.deepEqual(_e.source,Ee.source)&&s.deepEqual(_e["source-layer"],Ee["source-layer"])&&s.deepEqual(_e.type,Ee.type)){for(Me in yr(_e.layout,Ee.layout,Q,J,null,at.setLayoutProperty),yr(_e.paint,Ee.paint,Q,J,null,at.setPaintProperty),s.deepEqual(_e.filter,Ee.filter)||Q.push({command:at.setFilter,args:[J,Ee.filter]}),s.deepEqual(_e.minzoom,Ee.minzoom)&&s.deepEqual(_e.maxzoom,Ee.maxzoom)||Q.push({command:at.setLayerZoomRange,args:[J,Ee.minzoom,Ee.maxzoom]}),_e)_e.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?yr(_e[Me],Ee[Me],Q,J,Me.slice(6),at.setPaintProperty):s.deepEqual(_e[Me],Ee[Me])||Q.push({command:at.setLayerProperty,args:[J,Me,Ee[Me]]}));for(Me in Ee)Ee.hasOwnProperty(Me)&&!_e.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?yr(_e[Me],Ee[Me],Q,J,Me.slice(6),at.setPaintProperty):s.deepEqual(_e[Me],Ee[Me])||Q.push({command:at.setLayerProperty,args:[J,Me,Ee[Me]]}))}else Q.push({command:at.removeLayer,args:[J]}),Ie=lt[lt.lastIndexOf(J)+1],Q.push({command:at.addLayer,args:[Ee,Ie]})}(z,M.layers,D)}catch(W){console.warn("Unable to compute style diff:",W),D=[{command:at.setStyle,args:[M]}]}return D}(this.serialize(),c).filter(function(S){return!(S.command in Lo)});if(y.length===0)return!1;var T=y.filter(function(S){return!(S.command in Fo)});if(T.length>0)throw new Error("Unimplemented: "+T.map(function(S){return S.command}).join(", ")+".");return y.forEach(function(S){S.command!=="setTransition"&&d[S.command].apply(d,S.args)}),this.stylesheet=c,!0},u.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},u.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},u.prototype.getImage=function(c){return this.imageManager.getImage(c)},u.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},u.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(c,d,y){var T=this;if(y===void 0&&(y={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(s.validateStyle.source,"sources."+c,d,null,y))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var S=this.sourceCaches[c]=new we(c,d,this.dispatcher);S.style=this,S.setEventedParent(this,function(){return{isSourceLoaded:T.loaded(),source:S.serialize(),sourceId:c}}),S.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new s.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var y=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],y.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),y.setEventedParent(null),y.clearTiles(),y.onRemove&&y.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},u.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},u.prototype.addLayer=function(c,d,y){y===void 0&&(y={}),this._checkLoaded();var T=c.id;if(this.getLayer(T))this.fire(new s.ErrorEvent(new Error('Layer with id "'+T+'" already exists on this map')));else{var S;if(c.type==="custom"){if(na(this,s.validateCustomStyleLayer(c)))return;S=s.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(T,c.source),c=s.clone$1(c),c=s.extend(c,{source:T})),this._validate(s.validateStyle.layer,"layers."+T,c,{arrayIndex:-1},y))return;S=s.createStyleLayer(c),this._validateLayer(S),S.setEventedParent(this,{layer:{id:T}}),this._serializedLayers[S.id]=S.serialize()}var M=d?this._order.indexOf(d):this._order.length;if(d&&M===-1)this.fire(new s.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(M,0,T),this._layerOrderChanged=!0,this._layers[T]=S,this._removedLayers[T]&&S.source&&S.type!=="custom"){var D=this._removedLayers[T];delete this._removedLayers[T],D.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}},u.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var y=this._order.indexOf(c);this._order.splice(y,1);var T=d?this._order.indexOf(d):this._order.length;d&&T===-1?this.fire(new s.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(T,0,c),this._layerOrderChanged=!0)}}else this.fire(new s.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var y=this._order.indexOf(c);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new s.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(c){return this._layers[c]},u.prototype.hasLayer=function(c){return c in this._layers},u.prototype.setLayerZoomRange=function(c,d,y){this._checkLoaded();var T=this.getLayer(c);T?T.minzoom===d&&T.maxzoom===y||(d!=null&&(T.minzoom=d),y!=null&&(T.maxzoom=y),this._updateLayer(T)):this.fire(new s.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(c,d,y){y===void 0&&(y={}),this._checkLoaded();var T=this.getLayer(c);if(T){if(!s.deepEqual(T.filter,d))return d==null?(T.filter=void 0,void this._updateLayer(T)):void(this._validate(s.validateStyle.filter,"layers."+T.id+".filter",d,null,y)||(T.filter=s.clone$1(d),this._updateLayer(T)))}else this.fire(new s.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(c){return s.clone$1(this.getLayer(c).filter)},u.prototype.setLayoutProperty=function(c,d,y,T){T===void 0&&(T={}),this._checkLoaded();var S=this.getLayer(c);S?s.deepEqual(S.getLayoutProperty(d),y)||(S.setLayoutProperty(d,y,T),this._updateLayer(S)):this.fire(new s.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(c,d){var y=this.getLayer(c);if(y)return y.getLayoutProperty(d);this.fire(new s.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(c,d,y,T){T===void 0&&(T={}),this._checkLoaded();var S=this.getLayer(c);S?s.deepEqual(S.getPaintProperty(d),y)||(S.setPaintProperty(d,y,T)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new s.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},u.prototype.setFeatureState=function(c,d){this._checkLoaded();var y=c.source,T=c.sourceLayer,S=this.sourceCaches[y];if(S!==void 0){var M=S.getSource().type;M==="geojson"&&T?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||T?(c.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),S.setFeatureState(T,c.id,d)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(c,d){this._checkLoaded();var y=c.source,T=this.sourceCaches[y];if(T!==void 0){var S=T.getSource().type,M=S==="vector"?c.sourceLayer:void 0;S!=="vector"||M?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):T.removeFeatureState(M,c.id,d):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,y=c.sourceLayer,T=this.sourceCaches[d];if(T!==void 0){if(T.getSource().type!=="vector"||y)return c.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),T.getFeatureState(y,c.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},u.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,y=function(st){return d._layers[st].type==="fill-extrusion"},T={},S=[],M=this._order.length-1;M>=0;M--){var D=this._order[M];if(y(D)){T[D]=M;for(var L=0,j=c;L<j.length;L+=1){var z=j[L][D];if(z)for(var W=0,te=z;W<te.length;W+=1)S.push(te[W])}}}S.sort(function(st,rt){return rt.intersectionZ-st.intersectionZ});for(var Q=[],ie=this._order.length-1;ie>=0;ie--){var K=this._order[ie];if(y(K))for(var J=S.length-1;J>=0;J--){var _e=S[J].feature;if(T[_e.layer.id]<ie)break;Q.push(_e),S.pop()}else for(var Ee=0,Ie=c;Ee<Ie.length;Ee+=1){var Me=Ie[Ee][K];if(Me)for(var Ge=0,Qe=Me;Ge<Qe.length;Ge+=1)Q.push(Qe[Ge].feature)}}return Q},u.prototype.queryRenderedFeatures=function(c,d,y){d&&d.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var T={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var S=0,M=d.layers;S<M.length;S+=1){var D=M[S],L=this._layers[D];if(!L)return this.fire(new s.ErrorEvent(new Error("The layer '"+D+"' does not exist in the map's style and cannot be queried for features."))),[];T[L.source]=!0}}var j=[];for(var z in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!T[z]||j.push(Sr(this.sourceCaches[z],this._layers,this._serializedLayers,c,d,y));return this.placement&&j.push(function(W,te,Q,ie,K,J,_e){for(var Ee={},Ie=J.queryRenderedSymbols(ie),Me=[],Ge=0,Qe=Object.keys(Ie).map(Number);Ge<Qe.length;Ge+=1)Me.push(_e[Qe[Ge]]);Me.sort(Ur);for(var st=function(){var ft=lt[rt],Zt=ft.featureIndex.lookupSymbolFeatures(Ie[ft.bucketInstanceId],te,ft.bucketIndex,ft.sourceLayerIndex,K.filter,K.layers,K.availableImages,W);for(var xt in Zt){var or=Ee[xt]=Ee[xt]||[],Tr=Zt[xt];Tr.sort(function(wr,ar){var nr=ft.featureSortOrder;if(nr){var wn=nr.indexOf(wr.featureIndex);return nr.indexOf(ar.featureIndex)-wn}return ar.featureIndex-wr.featureIndex});for(var hr=0,cr=Tr;hr<cr.length;hr+=1)or.push(cr[hr])}},rt=0,lt=Me;rt<lt.length;rt+=1)st();var At=function(ft){Ee[ft].forEach(function(Zt){var xt=Zt.feature,or=Q[W[ft].source].getFeatureState(xt.layer["source-layer"],xt.id);xt.source=xt.layer.source,xt.layer["source-layer"]&&(xt.sourceLayer=xt.layer["source-layer"]),xt.state=or})};for(var Tt in Ee)At(Tt);return Ee}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(j)},u.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var y=this.sourceCaches[c];return y?function(T,S){for(var M=T.getRenderableIds().map(function(te){return T.getTileByID(te)}),D=[],L={},j=0;j<M.length;j++){var z=M[j],W=z.tileID.canonical.key;L[W]||(L[W]=!0,z.querySourceFeatures(D,S))}return D}(y,d):[]},u.prototype.addSourceType=function(c,d,y){return u.getSourceType(c)?y(new Error('A source type called "'+c+'" already exists.')):(u.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},y):y(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var y=this.light.getLight(),T=!1;for(var S in c)if(!s.deepEqual(c[S],y[S])){T=!0;break}if(T){var M={now:s.browser.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(M)}},u.prototype._validate=function(c,d,y,T,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&na(this,c.call(s.validateStyle,s.extend({key:d,style:this.serialize(),value:y,styleSpec:s.styleSpec},T)))},u.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},u.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},u.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},u.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},u.prototype._updatePlacement=function(c,d,y,T,S){S===void 0&&(S=!1);for(var M=!1,D=!1,L={},j=0,z=this._order;j<z.length;j+=1){var W=this._layers[z[j]];if(W.type==="symbol"){if(!L[W.source]){var te=this.sourceCaches[W.source];L[W.source]=te.getRenderableIds(!0).map(function(_e){return te.getTileByID(_e)}).sort(function(_e,Ee){return Ee.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(Ee.tileID)?-1:1)})}var Q=this.crossTileSymbolIndex.addLayer(W,L[W.source],c.center.lng);M=M||Q}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.browser.now(),c.zoom))&&(this.pauseablePlacement=new Kl(c,this._order,S,d,y,T,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.browser.now()),D=!0),M&&this.pauseablePlacement.placement.setStale()),D||M)for(var ie=0,K=this._order;ie<K.length;ie+=1){var J=this._layers[K[ie]];J.type==="symbol"&&this.placement.updateLayerOpacities(J,L[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},u.prototype.getImages=function(c,d,y){this.imageManager.getImages(d.icons,y),this._updateTilesForChangedImages();var T=this.sourceCaches[d.source];T&&T.setDependencies(d.tileID.key,d.type,d.icons)},u.prototype.getGlyphs=function(c,d,y){this.glyphManager.getGlyphs(d.stacks,y)},u.prototype.getResource=function(c,d,y){return s.makeRequest(d,y)},u}(s.Evented);os.getSourceType=function(l){return ut[l]},os.setSourceType=function(l,u){ut[l]=u},os.registerForPluginStateChange=s.registerForPluginStateChange;var Hi=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ki=Qr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),sa=Qr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),$n=Qr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),qu=Qr(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),jc=Qr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ul=Qr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),$u=Qr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Zu=Qr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Qh=Qr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Ku=Qr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Hc=Qr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Ys=Qr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),hl=Qr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Yu=Qr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Yi=Qr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ko=Qr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Zn=Qr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),No=Qr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),oa=Qr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Uo=Qr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),aa=Qr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ra=Qr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),la=Qr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ca=Qr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ef=Qr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),tf=Qr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Qr(l,u){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=u.match(/attribute ([\w]+) ([\w]+)/g),y=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=T?T.concat(y):y,M={};return{fragmentSource:l=l.replace(c,function(D,L,j,z,W){return M[W]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_`+W+`
varying `+j+" "+z+" "+W+`;
#else
uniform `+j+" "+z+" u_"+W+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+W+`
    `+j+" "+z+" "+W+" = u_"+W+`;
#endif
`}),vertexSource:u=u.replace(c,function(D,L,j,z,W){var te=z==="float"?"vec2":"vec4",Q=W.match(/color/)?"color":te;return M[W]?L==="define"?`
#ifndef HAS_UNIFORM_u_`+W+`
uniform lowp float u_`+W+`_t;
attribute `+j+" "+te+" a_"+W+`;
varying `+j+" "+z+" "+W+`;
#else
uniform `+j+" "+z+" u_"+W+`;
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_`+W+`
    `+W+" = a_"+W+`;
#else
    `+j+" "+z+" "+W+" = u_"+W+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+W+`
    `+W+" = unpack_mix_"+Q+"(a_"+W+", u_"+W+`_t);
#else
    `+j+" "+z+" "+W+" = u_"+W+`;
#endif
`:L==="define"?`
#ifndef HAS_UNIFORM_u_`+W+`
uniform lowp float u_`+W+`_t;
attribute `+j+" "+te+" a_"+W+`;
#else
uniform `+j+" "+z+" u_"+W+`;
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_`+W+`
    `+j+" "+z+" "+W+" = a_"+W+`;
#else
    `+j+" "+z+" "+W+" = u_"+W+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+W+`
    `+j+" "+z+" "+W+" = unpack_mix_"+Q+"(a_"+W+", u_"+W+`_t);
#else
    `+j+" "+z+" "+W+" = u_"+W+`;
#endif
`}),staticAttributes:d,staticUniforms:S}}var _A=Object.freeze({__proto__:null,prelude:Ki,background:sa,backgroundPattern:$n,circle:qu,clippingMask:jc,heatmap:ul,heatmapTexture:$u,collisionBox:Zu,collisionCircle:Qh,debug:Ku,fill:Hc,fillOutline:Ys,fillOutlinePattern:hl,fillPattern:Yu,fillExtrusion:Yi,fillExtrusionPattern:ko,hillshadePrepare:Zn,hillshade:No,line:oa,lineGradient:Uo,linePattern:aa,lineSDF:Ra,raster:la,symbolIcon:ca,symbolSDF:ef,symbolTextAndIcon:tf}),Gc=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function rf(l){for(var u=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");u.push(d.pop())}return u}Gc.prototype.bind=function(l,u,c,d,y,T,S,M){this.context=l;for(var D=this.boundPaintVertexBuffers.length!==d.length,L=0;!D&&L<d.length;L++)this.boundPaintVertexBuffers[L]!==d[L]&&(D=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===c&&!D&&this.boundIndexBuffer===y&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===M?(l.bindVertexArrayOES.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),M&&M.bind()):this.freshBind(u,c,d,y,T,S,M)},Gc.prototype.freshBind=function(l,u,c,d,y,T,S){var M,D=l.numAttributes,L=this.context,j=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=l,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=S;else{M=L.currentNumAttributes||0;for(var z=D;z<M;z++)j.disableVertexAttribArray(z)}u.enableAttributes(j,l);for(var W=0,te=c;W<te.length;W+=1)te[W].enableAttributes(j,l);T&&T.enableAttributes(j,l),S&&S.enableAttributes(j,l),u.bind(),u.setVertexAttribPointers(j,l,y);for(var Q=0,ie=c;Q<ie.length;Q+=1){var K=ie[Q];K.bind(),K.setVertexAttribPointers(j,l,y)}T&&(T.bind(),T.setVertexAttribPointers(j,l,y)),d&&d.bind(),S&&(S.bind(),S.setVertexAttribPointers(j,l,y)),L.currentNumAttributes=D},Gc.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var nf=function(l,u,c,d,y,T){var S=l.gl;this.program=S.createProgram();for(var M=rf(c.staticAttributes),D=d?d.getBinderAttributes():[],L=M.concat(D),j=c.staticUniforms?rf(c.staticUniforms):[],z=d?d.getBinderUniforms():[],W=[],te=0,Q=j.concat(z);te<Q.length;te+=1){var ie=Q[te];W.indexOf(ie)<0&&W.push(ie)}var K=d?d.defines():[];T&&K.push("#define OVERDRAW_INSPECTOR;");var J=K.concat(Ki.fragmentSource,c.fragmentSource).join(`
`),_e=K.concat(Ki.vertexSource,c.vertexSource).join(`
`),Ee=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Ee,J),S.compileShader(Ee),S.attachShader(this.program,Ee);var Ie=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Ie,_e),S.compileShader(Ie),S.attachShader(this.program,Ie),this.attributes={};var Me={};this.numAttributes=L.length;for(var Ge=0;Ge<this.numAttributes;Ge++)L[Ge]&&(S.bindAttribLocation(this.program,Ge,L[Ge]),this.attributes[L[Ge]]=Ge);S.linkProgram(this.program),S.deleteShader(Ie),S.deleteShader(Ee);for(var Qe=0;Qe<W.length;Qe++){var st=W[Qe];if(st&&!Me[st]){var rt=S.getUniformLocation(this.program,st);rt&&(Me[st]=rt)}}this.fixedUniforms=y(l,Me),this.binderUniforms=d?d.getUniforms(l,Me):[]}}};function Yl(l,u,c){var d=1/ai(c,1,u.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),T=c.tileSize*Math.pow(2,u.transform.tileZoom)/y,S=T*(c.tileID.canonical.x+c.tileID.wrap*y),M=T*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[S>>16,M>>16],u_pixel_coord_lower:[65535&S,65535&M]}}nf.prototype.draw=function(l,u,c,d,y,T,S,M,D,L,j,z,W,te,Q,ie){var K,J=l.gl;if(!this.failedToCreate){for(var _e in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(y),l.setCullFace(T),this.fixedUniforms)this.fixedUniforms[_e].set(S[_e]);te&&te.setUniforms(l,this.binderUniforms,z,{zoom:W});for(var Ee=(K={},K[J.LINES]=2,K[J.TRIANGLES]=3,K[J.LINE_STRIP]=1,K)[u],Ie=0,Me=j.get();Ie<Me.length;Ie+=1){var Ge=Me[Ie],Qe=Ge.vaos||(Ge.vaos={});(Qe[M]||(Qe[M]=new Gc)).bind(l,this,D,te?te.getPaintVertexBuffers():[],L,Ge.vertexOffset,Q,ie),J.drawElements(u,Ge.primitiveLength*Ee,J.UNSIGNED_SHORT,Ge.primitiveOffset*Ee*2)}}};var sf=function(l,u,c,d){var y=u.style.light,T=y.properties.get("position"),S=[T.x,T.y,T.z],M=s.create$1();y.properties.get("anchor")==="viewport"&&s.fromRotation(M,-u.transform.angle),s.transformMat3(S,S,M);var D=y.properties.get("color");return{u_matrix:l,u_lightpos:S,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+c,u_opacity:d}},Ba=function(l,u,c,d,y,T,S){return s.extend(sf(l,u,c,d),Yl(T,u,S),{u_height_factor:-Math.pow(2,y.overscaledZ)/S.tileSize/8})},ua=function(l){return{u_matrix:l}},Js=function(l,u,c,d){return s.extend(ua(l),Yl(c,u,d))},of=function(l,u){return{u_matrix:l,u_world:u}},Wc=function(l,u,c,d,y){return s.extend(Js(l,u,c,d),{u_world:y})},Xc=function(l,u,c,d){var y,T,S=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var M=ai(c,1,S.zoom);y=!0,T=[M,M]}else y=!1,T=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(u.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:s.browser.devicePixelRatio,u_extrude_scale:T}},Bs=function(l,u,c){var d=ai(c,1,u.zoom),y=Math.pow(2,u.zoom-c.tileID.overscaledZ),T=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[u.pixelsToGLUnits[0]/(d*y),u.pixelsToGLUnits[1]/(d*y)],u_overscale_factor:T}},af=function(l,u,c){return{u_matrix:l,u_inv_matrix:u,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},zo=function(l,u,c){return c===void 0&&(c=1),{u_matrix:l,u_color:u,u_overlay:0,u_overlay_scale:c}},ha=function(l){return{u_matrix:l}},lf=function(l,u,c,d){return{u_matrix:l,u_extrude_scale:ai(u,1,c),u_intensity:d}},fl=function(l,u,c){var d=l.transform;return{u_matrix:cf(l,u,c),u_ratio:1/ai(u,1,d.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},ei=function(l,u,c,d){return s.extend(fl(l,u,c),{u_image:0,u_image_height:d})},dl=function(l,u,c,d){var y=l.transform,T=ti(u,y);return{u_matrix:cf(l,u,c),u_texsize:u.imageAtlasTexture.size,u_ratio:1/ai(u,1,y.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_image:0,u_scale:[T,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},qc=function(l,u,c,d,y){var T=l.lineAtlas,S=ti(u,l.transform),M=c.layout.get("line-cap")==="round",D=T.getDash(d.from,M),L=T.getDash(d.to,M),j=D.width*y.fromScale,z=L.width*y.toScale;return s.extend(fl(l,u,c),{u_patternscale_a:[S/j,-D.height/2],u_patternscale_b:[S/z,-L.height/2],u_sdfgamma:T.width/(256*Math.min(j,z)*s.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:L.y,u_mix:y.t})};function ti(l,u){return 1/ai(l,1,u.tileZoom)}function cf(l,u,c){return l.translatePosMatrix(u.tileID.posMatrix,u,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var yA=function(l,u,c,d,y){return{u_matrix:l,u_tl_parent:u,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(S=y.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(T=y.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:uf(y.paint.get("raster-hue-rotate"))};var T,S};function uf(l){l*=Math.PI/180;var u=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*u-c+1)/3,(Math.sqrt(3)*u-c+1)/3]}var $c,Al=function(l,u,c,d,y,T,S,M,D,L){var j=y.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:j.width/j.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:S,u_coord_matrix:M,u_is_text:+D,u_pitch_with_map:+d,u_texsize:L,u_texture:0}},Jl=function(l,u,c,d,y,T,S,M,D,L,j){var z=y.transform;return s.extend(Al(l,u,c,d,y,T,S,M,D,L),{u_gamma_scale:d?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:s.browser.devicePixelRatio,u_is_halo:+j})},Zc=function(l,u,c,d,y,T,S,M,D,L){return s.extend(Jl(l,u,c,d,y,T,S,M,!0,D,!0),{u_texsize_icon:L,u_texture_icon:1})},yn=function(l,u,c){return{u_matrix:l,u_opacity:u,u_color:c}},fa=function(l,u,c,d,y,T){return s.extend(function(S,M,D,L){var j=D.imageManager.getPattern(S.from.toString()),z=D.imageManager.getPattern(S.to.toString()),W=D.imageManager.getPixelSize(),te=W.width,Q=W.height,ie=Math.pow(2,L.tileID.overscaledZ),K=L.tileSize*Math.pow(2,D.transform.tileZoom)/ie,J=K*(L.tileID.canonical.x+L.tileID.wrap*ie),_e=K*L.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[te,Q],u_mix:M.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/ai(L,1,D.transform.tileZoom),u_pixel_coord_upper:[J>>16,_e>>16],u_pixel_coord_lower:[65535&J,65535&_e]}}(d,T,c,y),{u_matrix:l,u_opacity:u})},da={fillExtrusion:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_lightpos:new s.Uniform3f(l,u.u_lightpos),u_lightintensity:new s.Uniform1f(l,u.u_lightintensity),u_lightcolor:new s.Uniform3f(l,u.u_lightcolor),u_vertical_gradient:new s.Uniform1f(l,u.u_vertical_gradient),u_opacity:new s.Uniform1f(l,u.u_opacity)}},fillExtrusionPattern:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_lightpos:new s.Uniform3f(l,u.u_lightpos),u_lightintensity:new s.Uniform1f(l,u.u_lightintensity),u_lightcolor:new s.Uniform3f(l,u.u_lightcolor),u_vertical_gradient:new s.Uniform1f(l,u.u_vertical_gradient),u_height_factor:new s.Uniform1f(l,u.u_height_factor),u_image:new s.Uniform1i(l,u.u_image),u_texsize:new s.Uniform2f(l,u.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,u.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,u.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,u.u_scale),u_fade:new s.Uniform1f(l,u.u_fade),u_opacity:new s.Uniform1f(l,u.u_opacity)}},fill:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix)}},fillPattern:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_image:new s.Uniform1i(l,u.u_image),u_texsize:new s.Uniform2f(l,u.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,u.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,u.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,u.u_scale),u_fade:new s.Uniform1f(l,u.u_fade)}},fillOutline:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_world:new s.Uniform2f(l,u.u_world)}},fillOutlinePattern:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_world:new s.Uniform2f(l,u.u_world),u_image:new s.Uniform1i(l,u.u_image),u_texsize:new s.Uniform2f(l,u.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,u.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,u.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,u.u_scale),u_fade:new s.Uniform1f(l,u.u_fade)}},circle:function(l,u){return{u_camera_to_center_distance:new s.Uniform1f(l,u.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(l,u.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(l,u.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(l,u.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(l,u.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(l,u.u_matrix)}},collisionBox:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_camera_to_center_distance:new s.Uniform1f(l,u.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(l,u.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(l,u.u_extrude_scale),u_overscale_factor:new s.Uniform1f(l,u.u_overscale_factor)}},collisionCircle:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_inv_matrix:new s.UniformMatrix4f(l,u.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(l,u.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(l,u.u_viewport_size)}},debug:function(l,u){return{u_color:new s.UniformColor(l,u.u_color),u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_overlay:new s.Uniform1i(l,u.u_overlay),u_overlay_scale:new s.Uniform1f(l,u.u_overlay_scale)}},clippingMask:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix)}},heatmap:function(l,u){return{u_extrude_scale:new s.Uniform1f(l,u.u_extrude_scale),u_intensity:new s.Uniform1f(l,u.u_intensity),u_matrix:new s.UniformMatrix4f(l,u.u_matrix)}},heatmapTexture:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_world:new s.Uniform2f(l,u.u_world),u_image:new s.Uniform1i(l,u.u_image),u_color_ramp:new s.Uniform1i(l,u.u_color_ramp),u_opacity:new s.Uniform1f(l,u.u_opacity)}},hillshade:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_image:new s.Uniform1i(l,u.u_image),u_latrange:new s.Uniform2f(l,u.u_latrange),u_light:new s.Uniform2f(l,u.u_light),u_shadow:new s.UniformColor(l,u.u_shadow),u_highlight:new s.UniformColor(l,u.u_highlight),u_accent:new s.UniformColor(l,u.u_accent)}},hillshadePrepare:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_image:new s.Uniform1i(l,u.u_image),u_dimension:new s.Uniform2f(l,u.u_dimension),u_zoom:new s.Uniform1f(l,u.u_zoom),u_unpack:new s.Uniform4f(l,u.u_unpack)}},line:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_ratio:new s.Uniform1f(l,u.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,u.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,u.u_units_to_pixels)}},lineGradient:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_ratio:new s.Uniform1f(l,u.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,u.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,u.u_units_to_pixels),u_image:new s.Uniform1i(l,u.u_image),u_image_height:new s.Uniform1f(l,u.u_image_height)}},linePattern:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_texsize:new s.Uniform2f(l,u.u_texsize),u_ratio:new s.Uniform1f(l,u.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,u.u_device_pixel_ratio),u_image:new s.Uniform1i(l,u.u_image),u_units_to_pixels:new s.Uniform2f(l,u.u_units_to_pixels),u_scale:new s.Uniform3f(l,u.u_scale),u_fade:new s.Uniform1f(l,u.u_fade)}},lineSDF:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_ratio:new s.Uniform1f(l,u.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,u.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,u.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(l,u.u_patternscale_a),u_patternscale_b:new s.Uniform2f(l,u.u_patternscale_b),u_sdfgamma:new s.Uniform1f(l,u.u_sdfgamma),u_image:new s.Uniform1i(l,u.u_image),u_tex_y_a:new s.Uniform1f(l,u.u_tex_y_a),u_tex_y_b:new s.Uniform1f(l,u.u_tex_y_b),u_mix:new s.Uniform1f(l,u.u_mix)}},raster:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_tl_parent:new s.Uniform2f(l,u.u_tl_parent),u_scale_parent:new s.Uniform1f(l,u.u_scale_parent),u_buffer_scale:new s.Uniform1f(l,u.u_buffer_scale),u_fade_t:new s.Uniform1f(l,u.u_fade_t),u_opacity:new s.Uniform1f(l,u.u_opacity),u_image0:new s.Uniform1i(l,u.u_image0),u_image1:new s.Uniform1i(l,u.u_image1),u_brightness_low:new s.Uniform1f(l,u.u_brightness_low),u_brightness_high:new s.Uniform1f(l,u.u_brightness_high),u_saturation_factor:new s.Uniform1f(l,u.u_saturation_factor),u_contrast_factor:new s.Uniform1f(l,u.u_contrast_factor),u_spin_weights:new s.Uniform3f(l,u.u_spin_weights)}},symbolIcon:function(l,u){return{u_is_size_zoom_constant:new s.Uniform1i(l,u.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,u.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,u.u_size_t),u_size:new s.Uniform1f(l,u.u_size),u_camera_to_center_distance:new s.Uniform1f(l,u.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,u.u_pitch),u_rotate_symbol:new s.Uniform1i(l,u.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,u.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,u.u_fade_change),u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,u.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,u.u_coord_matrix),u_is_text:new s.Uniform1i(l,u.u_is_text),u_pitch_with_map:new s.Uniform1i(l,u.u_pitch_with_map),u_texsize:new s.Uniform2f(l,u.u_texsize),u_texture:new s.Uniform1i(l,u.u_texture)}},symbolSDF:function(l,u){return{u_is_size_zoom_constant:new s.Uniform1i(l,u.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,u.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,u.u_size_t),u_size:new s.Uniform1f(l,u.u_size),u_camera_to_center_distance:new s.Uniform1f(l,u.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,u.u_pitch),u_rotate_symbol:new s.Uniform1i(l,u.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,u.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,u.u_fade_change),u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,u.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,u.u_coord_matrix),u_is_text:new s.Uniform1i(l,u.u_is_text),u_pitch_with_map:new s.Uniform1i(l,u.u_pitch_with_map),u_texsize:new s.Uniform2f(l,u.u_texsize),u_texture:new s.Uniform1i(l,u.u_texture),u_gamma_scale:new s.Uniform1f(l,u.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(l,u.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(l,u.u_is_halo)}},symbolTextAndIcon:function(l,u){return{u_is_size_zoom_constant:new s.Uniform1i(l,u.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,u.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,u.u_size_t),u_size:new s.Uniform1f(l,u.u_size),u_camera_to_center_distance:new s.Uniform1f(l,u.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,u.u_pitch),u_rotate_symbol:new s.Uniform1i(l,u.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,u.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,u.u_fade_change),u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,u.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,u.u_coord_matrix),u_is_text:new s.Uniform1i(l,u.u_is_text),u_pitch_with_map:new s.Uniform1i(l,u.u_pitch_with_map),u_texsize:new s.Uniform2f(l,u.u_texsize),u_texsize_icon:new s.Uniform2f(l,u.u_texsize_icon),u_texture:new s.Uniform1i(l,u.u_texture),u_texture_icon:new s.Uniform1i(l,u.u_texture_icon),u_gamma_scale:new s.Uniform1f(l,u.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(l,u.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(l,u.u_is_halo)}},background:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_opacity:new s.Uniform1f(l,u.u_opacity),u_color:new s.UniformColor(l,u.u_color)}},backgroundPattern:function(l,u){return{u_matrix:new s.UniformMatrix4f(l,u.u_matrix),u_opacity:new s.Uniform1f(l,u.u_opacity),u_image:new s.Uniform1i(l,u.u_image),u_pattern_tl_a:new s.Uniform2f(l,u.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(l,u.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(l,u.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(l,u.u_pattern_br_b),u_texsize:new s.Uniform2f(l,u.u_texsize),u_mix:new s.Uniform1f(l,u.u_mix),u_pattern_size_a:new s.Uniform2f(l,u.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(l,u.u_pattern_size_b),u_scale_a:new s.Uniform1f(l,u.u_scale_a),u_scale_b:new s.Uniform1f(l,u.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(l,u.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,u.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(l,u.u_tile_units_to_pixels)}}};function pl(l,u,c,d,y,T,S){for(var M=l.context,D=M.gl,L=l.useProgram("collisionBox"),j=[],z=0,W=0,te=0;te<d.length;te++){var Q=d[te],ie=u.getTile(Q),K=ie.getBucket(c);if(K){var J=Q.posMatrix;y[0]===0&&y[1]===0||(J=l.translatePosMatrix(Q.posMatrix,ie,y,T));var _e=S?K.textCollisionBox:K.iconCollisionBox,Ee=K.collisionCircleArray;if(Ee.length>0){var Ie=s.create(),Me=J;s.mul(Ie,K.placementInvProjMatrix,l.transform.glCoordMatrix),s.mul(Ie,Ie,K.placementViewportMatrix),j.push({circleArray:Ee,circleOffset:W,transform:Me,invTransform:Ie}),W=z+=Ee.length/4}_e&&L.draw(M,D.LINES,fe.disabled,be.disabled,l.colorModeForRenderPass(),De.disabled,Bs(J,l.transform,ie),c.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,l.transform.zoom,null,null,_e.collisionVertexBuffer)}}if(S&&j.length){var Ge=l.useProgram("collisionCircle"),Qe=new s.StructArrayLayout2f1f2i16;Qe.resize(4*z),Qe._trim();for(var st=0,rt=0,lt=j;rt<lt.length;rt+=1)for(var At=lt[rt],Tt=0;Tt<At.circleArray.length/4;Tt++){var ft=4*Tt,Zt=At.circleArray[ft+0],xt=At.circleArray[ft+1],or=At.circleArray[ft+2],Tr=At.circleArray[ft+3];Qe.emplace(st++,Zt,xt,or,Tr,0),Qe.emplace(st++,Zt,xt,or,Tr,1),Qe.emplace(st++,Zt,xt,or,Tr,2),Qe.emplace(st++,Zt,xt,or,Tr,3)}(!$c||$c.length<2*z)&&($c=function(Wi){var Jn=2*Wi,Bn=new s.StructArrayLayout3ui6;Bn.resize(Jn),Bn._trim();for(var Li=0;Li<Jn;Li++){var Qi=6*Li;Bn.uint16[Qi+0]=4*Li+0,Bn.uint16[Qi+1]=4*Li+1,Bn.uint16[Qi+2]=4*Li+2,Bn.uint16[Qi+3]=4*Li+2,Bn.uint16[Qi+4]=4*Li+3,Bn.uint16[Qi+5]=4*Li+0}return Bn}(z));for(var hr=M.createIndexBuffer($c,!0),cr=M.createVertexBuffer(Qe,s.collisionCircleLayout.members,!0),wr=0,ar=j;wr<ar.length;wr+=1){var nr=ar[wr],wn=af(nr.transform,nr.invTransform,l.transform);Ge.draw(M,D.TRIANGLES,fe.disabled,be.disabled,l.colorModeForRenderPass(),De.disabled,wn,c.id,cr,hr,s.SegmentVector.simpleSegment(0,2*nr.circleOffset,nr.circleArray.length,nr.circleArray.length/2),null,l.transform.zoom,null,null,null)}cr.destroy(),hr.destroy()}}var ys=s.identity(new Float32Array(16));function hf(l,u,c,d,y,T){var S=s.getAnchorAlignment(l),M=-(S.horizontalAlign-.5)*u,D=-(S.verticalAlign-.5)*c,L=s.evaluateVariableOffset(l,d);return new s.Point((M/y+L[0])*T,(D/y+L[1])*T)}function vs(l,u,c,d,y,T,S,M,D,L,j){var z=l.text.placedSymbolArray,W=l.text.dynamicLayoutVertexArray,te=l.icon.dynamicLayoutVertexArray,Q={};W.clear();for(var ie=0;ie<z.length;ie++){var K=z.get(ie),J=K.hidden||!K.crossTileID||l.allowVerticalPlacement&&!K.placedOrientation?null:d[K.crossTileID];if(J){var _e=new s.Point(K.anchorX,K.anchorY),Ee=Ar(_e,c?M:S),Ie=pr(T.cameraToCenterDistance,Ee.signedDistanceFromCamera),Me=y.evaluateSizeForFeature(l.textSizeData,L,K)*Ie/s.ONE_EM;c&&(Me*=l.tilePixelRatio/D);for(var Ge=hf(J.anchor,J.width,J.height,J.textOffset,J.textBoxScale,Me),Qe=c?Ar(_e.add(Ge),S).point:Ee.point.add(u?Ge.rotate(-T.angle):Ge),st=l.allowVerticalPlacement&&K.placedOrientation===s.WritingMode.vertical?Math.PI/2:0,rt=0;rt<K.numGlyphs;rt++)s.addDynamicAttributes(W,Qe,st);j&&K.associatedIconIndex>=0&&(Q[K.associatedIconIndex]={shiftedAnchor:Qe,angle:st})}else ue(K.numGlyphs,W)}if(j){te.clear();for(var lt=l.icon.placedSymbolArray,At=0;At<lt.length;At++){var Tt=lt.get(At);if(Tt.hidden)ue(Tt.numGlyphs,te);else{var ft=Q[At];if(ft)for(var Zt=0;Zt<Tt.numGlyphs;Zt++)s.addDynamicAttributes(te,ft.shiftedAnchor,ft.angle);else ue(Tt.numGlyphs,te)}}l.icon.dynamicLayoutVertexBuffer.updateData(te)}l.text.dynamicLayoutVertexBuffer.updateData(W)}function Ju(l,u,c){return c.iconsInText&&u?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Vo(l,u,c,d,y,T,S,M,D,L,j,z){for(var W=l.context,te=W.gl,Q=l.transform,ie=M==="map",K=D==="map",J=ie&&c.layout.get("symbol-placement")!=="point",_e=ie&&!K&&!J,Ee=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ie=!1,Me=l.depthModeForSublayer(0,fe.ReadOnly),Ge=c.layout.get("text-variable-anchor"),Qe=[],st=0,rt=d;st<rt.length;st+=1){var lt=rt[st],At=u.getTile(lt),Tt=At.getBucket(c);if(Tt){var ft=y?Tt.text:Tt.icon;if(ft&&ft.segments.get().length){var Zt=ft.programConfigurations.get(c.id),xt=y||Tt.sdfIcons,or=y?Tt.textSizeData:Tt.iconSizeData,Tr=K||Q.pitch!==0,hr=l.useProgram(Ju(xt,y,Tt),Zt),cr=s.evaluateSizeForZoom(or,Q.zoom),wr=void 0,ar=[0,0],nr=void 0,wn=void 0,Wi=null,Jn=void 0;if(y)nr=At.glyphAtlasTexture,wn=te.LINEAR,wr=At.glyphAtlasTexture.size,Tt.iconsInText&&(ar=At.imageAtlasTexture.size,Wi=At.imageAtlasTexture,Jn=Tr||l.options.rotating||l.options.zooming||or.kind==="composite"||or.kind==="camera"?te.LINEAR:te.NEAREST);else{var Bn=c.layout.get("icon-size").constantOr(0)!==1||Tt.iconsNeedLinear;nr=At.imageAtlasTexture,wn=xt||l.options.rotating||l.options.zooming||Bn||Tr?te.LINEAR:te.NEAREST,wr=At.imageAtlasTexture.size}var Li=ai(At,1,l.transform.zoom),Qi=Fr(lt.posMatrix,K,ie,l.transform,Li),ks=zr(lt.posMatrix,K,ie,l.transform,Li),fs=Ge&&Tt.hasTextData(),bl=c.layout.get("icon-text-fit")!=="none"&&fs&&Tt.hasIconData();J&&me(Tt,lt.posMatrix,l,y,Qi,ks,K,L);var xs=l.translatePosMatrix(lt.posMatrix,At,T,S),Wo=J||y&&Ge||bl?ys:Qi,bo=l.translatePosMatrix(ks,At,T,S,!0),nh=xt&&c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ou={program:hr,buffers:ft,uniformValues:xt?Tt.iconsInText?Zc(or.kind,cr,_e,K,l,xs,Wo,bo,wr,ar):Jl(or.kind,cr,_e,K,l,xs,Wo,bo,y,wr,!0):Al(or.kind,cr,_e,K,l,xs,Wo,bo,y,wr),atlasTexture:nr,atlasTextureIcon:Wi,atlasInterpolation:wn,atlasInterpolationIcon:Jn,isSDF:xt,hasHalo:nh};if(Ee&&Tt.canOverlap){Ie=!0;for(var xl=0,au=ft.segments.get();xl<au.length;xl+=1){var sh=au[xl];Qe.push({segments:new s.SegmentVector([sh]),sortKey:sh.sortKey,state:ou})}}else Qe.push({segments:ft.segments,sortKey:0,state:ou})}}}Ie&&Qe.sort(function(wl,lc){return wl.sortKey-lc.sortKey});for(var ya=0,oh=Qe;ya<oh.length;ya+=1){var va=oh[ya],Tn=va.state;if(W.activeTexture.set(te.TEXTURE0),Tn.atlasTexture.bind(Tn.atlasInterpolation,te.CLAMP_TO_EDGE),Tn.atlasTextureIcon&&(W.activeTexture.set(te.TEXTURE1),Tn.atlasTextureIcon&&Tn.atlasTextureIcon.bind(Tn.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Tn.isSDF){var Na=Tn.uniformValues;Tn.hasHalo&&(Na.u_is_halo=1,fo(Tn.buffers,va.segments,c,l,Tn.program,Me,j,z,Na)),Na.u_is_halo=0}fo(Tn.buffers,va.segments,c,l,Tn.program,Me,j,z,Tn.uniformValues)}}function fo(l,u,c,d,y,T,S,M,D){var L=d.context;y.draw(L,L.gl.TRIANGLES,T,S,M,De.disabled,D,c.id,l.layoutVertexBuffer,l.indexBuffer,u,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Aa(l,u,c,d,y,T,S){var M,D,L,j,z,W=l.context.gl,te=c.paint.get("fill-pattern"),Q=te&&te.constantOr(1),ie=c.getCrossfadeParameters();S?(D=Q&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",M=W.LINES):(D=Q?"fillPattern":"fill",M=W.TRIANGLES);for(var K=0,J=d;K<J.length;K+=1){var _e=J[K],Ee=u.getTile(_e);if(!Q||Ee.patternsLoaded()){var Ie=Ee.getBucket(c);if(Ie){var Me=Ie.programConfigurations.get(c.id),Ge=l.useProgram(D,Me);Q&&(l.context.activeTexture.set(W.TEXTURE0),Ee.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Me.updatePaintBuffers(ie));var Qe=te.constantOr(null);if(Qe&&Ee.imageAtlas){var st=Ee.imageAtlas,rt=st.patternPositions[Qe.to.toString()],lt=st.patternPositions[Qe.from.toString()];rt&&lt&&Me.setConstantPatternPositions(rt,lt)}var At=l.translatePosMatrix(_e.posMatrix,Ee,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(S){j=Ie.indexBuffer2,z=Ie.segments2;var Tt=[W.drawingBufferWidth,W.drawingBufferHeight];L=D==="fillOutlinePattern"&&Q?Wc(At,l,ie,Ee,Tt):of(At,Tt)}else j=Ie.indexBuffer,z=Ie.segments,L=Q?Js(At,l,ie,Ee):ua(At);Ge.draw(l.context,M,y,l.stencilModeForClipping(_e),T,De.disabled,L,c.id,Ie.layoutVertexBuffer,j,z,c.paint,l.transform.zoom,Me)}}}}function Oa(l,u,c,d,y,T,S){for(var M=l.context,D=M.gl,L=c.paint.get("fill-extrusion-pattern"),j=L.constantOr(1),z=c.getCrossfadeParameters(),W=c.paint.get("fill-extrusion-opacity"),te=0,Q=d;te<Q.length;te+=1){var ie=Q[te],K=u.getTile(ie),J=K.getBucket(c);if(J){var _e=J.programConfigurations.get(c.id),Ee=l.useProgram(j?"fillExtrusionPattern":"fillExtrusion",_e);j&&(l.context.activeTexture.set(D.TEXTURE0),K.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),_e.updatePaintBuffers(z));var Ie=L.constantOr(null);if(Ie&&K.imageAtlas){var Me=K.imageAtlas,Ge=Me.patternPositions[Ie.to.toString()],Qe=Me.patternPositions[Ie.from.toString()];Ge&&Qe&&_e.setConstantPatternPositions(Ge,Qe)}var st=l.translatePosMatrix(ie.posMatrix,K,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),rt=c.paint.get("fill-extrusion-vertical-gradient"),lt=j?Ba(st,l,rt,W,ie,z,K):sf(st,l,rt,W);Ee.draw(M,M.gl.TRIANGLES,y,T,S,De.backCCW,lt,c.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,c.paint,l.transform.zoom,_e)}}}function Kc(l,u,c,d,y,T){var S=l.context,M=S.gl,D=u.fbo;if(D){var L=l.useProgram("hillshade");S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get());var j=function(z,W,te){var Q=te.paint.get("hillshade-shadow-color"),ie=te.paint.get("hillshade-highlight-color"),K=te.paint.get("hillshade-accent-color"),J=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(J-=z.transform.angle);var _e,Ee,Ie,Me=!z.options.moving;return{u_matrix:z.transform.calculatePosMatrix(W.tileID.toUnwrapped(),Me),u_image:0,u_latrange:(_e=W.tileID,Ee=Math.pow(2,_e.canonical.z),Ie=_e.canonical.y,[new s.MercatorCoordinate(0,Ie/Ee).toLngLat().lat,new s.MercatorCoordinate(0,(Ie+1)/Ee).toLngLat().lat]),u_light:[te.paint.get("hillshade-exaggeration"),J],u_shadow:Q,u_highlight:ie,u_accent:K}}(l,u,c);L.draw(S,M.TRIANGLES,d,y,T,De.disabled,j,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function ff(l,u,c,d,y,T){var S=l.context,M=S.gl,D=u.dem;if(D&&D.data){var L=D.dim,j=D.stride,z=D.getPixels();if(S.activeTexture.set(M.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||l.getTileTexture(j),u.demTexture){var W=u.demTexture;W.update(z,{premultiply:!1}),W.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else u.demTexture=new s.Texture(S,z,M.RGBA,{premultiply:!1}),u.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);S.activeTexture.set(M.TEXTURE0);var te=u.fbo;if(!te){var Q=new s.Texture(S,{width:L,height:L,data:null},M.RGBA);Q.bind(M.LINEAR,M.CLAMP_TO_EDGE),(te=u.fbo=S.createFramebuffer(L,L,!0)).colorAttachment.set(Q.texture)}S.bindFramebuffer.set(te.framebuffer),S.viewport.set([0,0,L,L]),l.useProgram("hillshadePrepare").draw(S,M.TRIANGLES,d,y,T,De.disabled,function(ie,K){var J=K.stride,_e=s.create();return s.ortho(_e,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(_e,_e,[0,-s.EXTENT,0]),{u_matrix:_e,u_image:1,u_dimension:[J,J],u_zoom:ie.overscaledZ,u_unpack:K.getUnpackVector()}}(u.tileID,D),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Yc(l,u,c,d,y){var T=d.paint.get("raster-fade-duration");if(T>0){var S=s.browser.now(),M=(S-l.timeAdded)/T,D=u?(S-u.timeAdded)/T:-1,L=c.getSource(),j=y.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),z=!u||Math.abs(u.tileID.overscaledZ-j)>Math.abs(l.tileID.overscaledZ-j),W=z&&l.refreshedUponExpiration?1:s.clamp(z?M:1-D,0,1);return l.refreshedUponExpiration&&M>=1&&(l.refreshedUponExpiration=!1),u?{opacity:1,mix:1-W}:{opacity:W,mix:0}}return{opacity:1,mix:0}}var Ql=new s.Color(1,0,0,1),df=new s.Color(0,1,0,1),Af=new s.Color(0,0,1,1),ec=new s.Color(1,0,1,1),Jc=new s.Color(0,1,1,1);function Da(l,u,c,d){tc(l,0,u+c/2,l.transform.width,c,d)}function pa(l,u,c,d){tc(l,u-c/2,0,c,l.transform.height,d)}function tc(l,u,c,d,y,T){var S=l.context,M=S.gl;M.enable(M.SCISSOR_TEST),M.scissor(u*s.browser.devicePixelRatio,c*s.browser.devicePixelRatio,d*s.browser.devicePixelRatio,y*s.browser.devicePixelRatio),S.clear({color:T}),M.disable(M.SCISSOR_TEST)}function gl(l,u,c){var d=l.context,y=d.gl,T=c.posMatrix,S=l.useProgram("debug"),M=fe.disabled,D=be.disabled,L=l.colorModeForRenderPass();d.activeTexture.set(y.TEXTURE0),l.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),S.draw(d,y.LINE_STRIP,M,D,L,De.disabled,zo(T,s.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var j=u.getTileByID(c.key).latestRawTileData,z=Math.floor((j&&j.byteLength||0)/1024),W=u.getTile(c).tileSize,te=512/Math.min(W,512)*(c.overscaledZ/l.transform.zoom)*.5,Q=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Q+=" => "+c.overscaledZ),function(ie,K){ie.initDebugOverlayCanvas();var J=ie.debugOverlayCanvas,_e=ie.context.gl,Ee=ie.debugOverlayCanvas.getContext("2d");Ee.clearRect(0,0,J.width,J.height),Ee.shadowColor="white",Ee.shadowBlur=2,Ee.lineWidth=1.5,Ee.strokeStyle="white",Ee.textBaseline="top",Ee.font="bold 36px Open Sans, sans-serif",Ee.fillText(K,5,5),Ee.strokeText(K,5,5),ie.debugOverlayTexture.update(J),ie.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(l,Q+" "+z+"kb"),S.draw(d,y.TRIANGLES,M,D,Oe.alphaBlended,De.disabled,zo(T,s.Color.transparent,te),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Fa={symbol:function(l,u,c,d,y){if(l.renderPass==="translucent"){var T=be.disabled,S=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(M,D,L,j,z,W,te){for(var Q=D.transform,ie=z==="map",K=W==="map",J=0,_e=M;J<_e.length;J+=1){var Ee=_e[J],Ie=j.getTile(Ee),Me=Ie.getBucket(L);if(Me&&Me.text&&Me.text.segments.get().length){var Ge=s.evaluateSizeForZoom(Me.textSizeData,Q.zoom),Qe=ai(Ie,1,D.transform.zoom),st=Fr(Ee.posMatrix,K,ie,D.transform,Qe),rt=L.layout.get("icon-text-fit")!=="none"&&Me.hasIconData();if(Ge){var lt=Math.pow(2,Q.zoom-Ie.tileID.overscaledZ);vs(Me,ie,K,te,s.symbolSize,Q,st,Ee.posMatrix,lt,Ge,rt)}}}}(d,l,c,u,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),c.paint.get("icon-opacity").constantOr(1)!==0&&Vo(l,u,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),T,S),c.paint.get("text-opacity").constantOr(1)!==0&&Vo(l,u,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),T,S),u.map.showCollisionBoxes&&(pl(l,u,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),pl(l,u,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,u,c,d){if(l.renderPass==="translucent"){var y=c.paint.get("circle-opacity"),T=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),M=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)!==0||T.constantOr(1)!==0&&S.constantOr(1)!==0){for(var D=l.context,L=D.gl,j=l.depthModeForSublayer(0,fe.ReadOnly),z=be.disabled,W=l.colorModeForRenderPass(),te=[],Q=0;Q<d.length;Q++){var ie=d[Q],K=u.getTile(ie),J=K.getBucket(c);if(J){var _e=J.programConfigurations.get(c.id),Ee={programConfiguration:_e,program:l.useProgram("circle",_e),layoutVertexBuffer:J.layoutVertexBuffer,indexBuffer:J.indexBuffer,uniformValues:Xc(l,ie,K,c)};if(M)for(var Ie=0,Me=J.segments.get();Ie<Me.length;Ie+=1){var Ge=Me[Ie];te.push({segments:new s.SegmentVector([Ge]),sortKey:Ge.sortKey,state:Ee})}else te.push({segments:J.segments,sortKey:0,state:Ee})}}M&&te.sort(function(At,Tt){return At.sortKey-Tt.sortKey});for(var Qe=0,st=te;Qe<st.length;Qe+=1){var rt=st[Qe],lt=rt.state;lt.program.draw(D,L.TRIANGLES,j,z,W,De.disabled,lt.uniformValues,c.id,lt.layoutVertexBuffer,lt.indexBuffer,rt.segments,c.paint,l.transform.zoom,lt.programConfiguration)}}}},heatmap:function(l,u,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var y=l.context,T=y.gl,S=be.disabled,M=new Oe([T.ONE,T.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(te,Q,ie){var K=te.gl;te.activeTexture.set(K.TEXTURE1),te.viewport.set([0,0,Q.width/4,Q.height/4]);var J=ie.heatmapFbo;if(J)K.bindTexture(K.TEXTURE_2D,J.colorAttachment.get()),te.bindFramebuffer.set(J.framebuffer);else{var _e=K.createTexture();K.bindTexture(K.TEXTURE_2D,_e),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),J=ie.heatmapFbo=te.createFramebuffer(Q.width/4,Q.height/4,!1),function(Ee,Ie,Me,Ge){var Qe=Ee.gl;Qe.texImage2D(Qe.TEXTURE_2D,0,Qe.RGBA,Ie.width/4,Ie.height/4,0,Qe.RGBA,Ee.extRenderToTextureHalfFloat?Ee.extTextureHalfFloat.HALF_FLOAT_OES:Qe.UNSIGNED_BYTE,null),Ge.colorAttachment.set(Me)}(te,Q,_e,J)}})(y,l,c),y.clear({color:s.Color.transparent});for(var D=0;D<d.length;D++){var L=d[D];if(!u.hasRenderableParent(L)){var j=u.getTile(L),z=j.getBucket(c);if(z){var W=z.programConfigurations.get(c.id);l.useProgram("heatmap",W).draw(y,T.TRIANGLES,fe.disabled,S,M,De.disabled,lf(L.posMatrix,j,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,c.paint,l.transform.zoom,W)}}}y.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(te,Q){var ie=te.context,K=ie.gl,J=Q.heatmapFbo;if(J){ie.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,J.colorAttachment.get()),ie.activeTexture.set(K.TEXTURE1);var _e=Q.colorRampTexture;_e||(_e=Q.colorRampTexture=new s.Texture(ie,Q.colorRamp,K.RGBA)),_e.bind(K.LINEAR,K.CLAMP_TO_EDGE),te.useProgram("heatmapTexture").draw(ie,K.TRIANGLES,fe.disabled,be.disabled,te.colorModeForRenderPass(),De.disabled,function(Ee,Ie,Me,Ge){var Qe=s.create();s.ortho(Qe,0,Ee.width,Ee.height,0,0,1);var st=Ee.context.gl;return{u_matrix:Qe,u_world:[st.drawingBufferWidth,st.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ie.paint.get("heatmap-opacity")}}(te,Q),Q.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments,Q.paint,te.transform.zoom)}}(l,c))},line:function(l,u,c,d){if(l.renderPass==="translucent"){var y=c.paint.get("line-opacity"),T=c.paint.get("line-width");if(y.constantOr(1)!==0&&T.constantOr(1)!==0)for(var S=l.depthModeForSublayer(0,fe.ReadOnly),M=l.colorModeForRenderPass(),D=c.paint.get("line-dasharray"),L=c.paint.get("line-pattern"),j=L.constantOr(1),z=c.paint.get("line-gradient"),W=c.getCrossfadeParameters(),te=j?"linePattern":D?"lineSDF":z?"lineGradient":"line",Q=l.context,ie=Q.gl,K=!0,J=0,_e=d;J<_e.length;J+=1){var Ee=_e[J],Ie=u.getTile(Ee);if(!j||Ie.patternsLoaded()){var Me=Ie.getBucket(c);if(Me){var Ge=Me.programConfigurations.get(c.id),Qe=l.context.program.get(),st=l.useProgram(te,Ge),rt=K||st.program!==Qe,lt=L.constantOr(null);if(lt&&Ie.imageAtlas){var At=Ie.imageAtlas,Tt=At.patternPositions[lt.to.toString()],ft=At.patternPositions[lt.from.toString()];Tt&&ft&&Ge.setConstantPatternPositions(Tt,ft)}var Zt=j?dl(l,Ie,c,W):D?qc(l,Ie,c,D,W):z?ei(l,Ie,c,Me.lineClipsArray.length):fl(l,Ie,c);if(j)Q.activeTexture.set(ie.TEXTURE0),Ie.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Ge.updatePaintBuffers(W);else if(D&&(rt||l.lineAtlas.dirty))Q.activeTexture.set(ie.TEXTURE0),l.lineAtlas.bind(Q);else if(z){var xt=Me.gradients[c.id],or=xt.texture;if(c.gradientVersion!==xt.version){var Tr=256;if(c.stepInterpolant){var hr=u.getSource().maxzoom,cr=Ee.canonical.z===hr?Math.ceil(1<<l.transform.maxZoom-Ee.canonical.z):1;Tr=s.clamp(s.nextPowerOfTwo(Me.maxLineLength/s.EXTENT*1024*cr),256,Q.maxTextureSize)}xt.gradient=s.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Tr,image:xt.gradient||void 0,clips:Me.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new s.Texture(Q,xt.gradient,ie.RGBA),xt.version=c.gradientVersion,or=xt.texture}Q.activeTexture.set(ie.TEXTURE0),or.bind(c.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}st.draw(Q,ie.TRIANGLES,S,l.stencilModeForClipping(Ee),M,De.disabled,Zt,c.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,c.paint,l.transform.zoom,Ge,Me.layoutVertexBuffer2),K=!1}}}}},fill:function(l,u,c,d){var y=c.paint.get("fill-color"),T=c.paint.get("fill-opacity");if(T.constantOr(1)!==0){var S=l.colorModeForRenderPass(),M=c.paint.get("fill-pattern"),D=l.opaquePassEnabledForLayer()&&!M.constantOr(1)&&y.constantOr(s.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===D){var L=l.depthModeForSublayer(1,l.renderPass==="opaque"?fe.ReadWrite:fe.ReadOnly);Aa(l,u,c,d,L,S,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var j=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,fe.ReadOnly);Aa(l,u,c,d,j,S,!0)}}},"fill-extrusion":function(l,u,c,d){var y=c.paint.get("fill-extrusion-opacity");if(y!==0&&l.renderPass==="translucent"){var T=new fe(l.context.gl.LEQUAL,fe.ReadWrite,l.depthRangeFor3D);if(y!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))Oa(l,u,c,d,T,be.disabled,Oe.disabled),Oa(l,u,c,d,T,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var S=l.colorModeForRenderPass();Oa(l,u,c,d,T,be.disabled,S)}}},hillshade:function(l,u,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var y=l.context,T=l.depthModeForSublayer(0,fe.ReadOnly),S=l.colorModeForRenderPass(),M=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],D=M[0],L=0,j=M[1];L<j.length;L+=1){var z=j[L],W=u.getTile(z);W.needsHillshadePrepare&&l.renderPass==="offscreen"?ff(l,W,c,T,be.disabled,S):l.renderPass==="translucent"&&Kc(l,W,c,T,D[z.overscaledZ],S)}y.viewport.set([0,0,l.width,l.height])}},raster:function(l,u,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var y=l.context,T=y.gl,S=u.getSource(),M=l.useProgram("raster"),D=l.colorModeForRenderPass(),L=S instanceof Qt?[{},d]:l.stencilConfigForOverlap(d),j=L[0],z=L[1],W=z[z.length-1].overscaledZ,te=!l.options.moving,Q=0,ie=z;Q<ie.length;Q+=1){var K=ie[Q],J=l.depthModeForSublayer(K.overscaledZ-W,c.paint.get("raster-opacity")===1?fe.ReadWrite:fe.ReadOnly,T.LESS),_e=u.getTile(K),Ee=l.transform.calculatePosMatrix(K.toUnwrapped(),te);_e.registerFadeDuration(c.paint.get("raster-fade-duration"));var Ie=u.findLoadedParent(K,0),Me=Yc(_e,Ie,u,c,l.transform),Ge=void 0,Qe=void 0,st=c.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;y.activeTexture.set(T.TEXTURE0),_e.texture.bind(st,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),y.activeTexture.set(T.TEXTURE1),Ie?(Ie.texture.bind(st,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),Ge=Math.pow(2,Ie.tileID.overscaledZ-_e.tileID.overscaledZ),Qe=[_e.tileID.canonical.x*Ge%1,_e.tileID.canonical.y*Ge%1]):_e.texture.bind(st,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);var rt=yA(Ee,Qe||[0,0],Ge||1,Me,c);S instanceof Qt?M.draw(y,T.TRIANGLES,J,be.disabled,D,De.disabled,rt,c.id,S.boundsBuffer,l.quadTriangleIndexBuffer,S.boundsSegments):M.draw(y,T.TRIANGLES,J,j[K.overscaledZ],D,De.disabled,rt,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,u,c){var d=c.paint.get("background-color"),y=c.paint.get("background-opacity");if(y!==0){var T=l.context,S=T.gl,M=l.transform,D=M.tileSize,L=c.paint.get("background-pattern");if(!l.isPatternMissing(L)){var j=!L&&d.a===1&&y===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===j){var z=be.disabled,W=l.depthModeForSublayer(0,j==="opaque"?fe.ReadWrite:fe.ReadOnly),te=l.colorModeForRenderPass(),Q=l.useProgram(L?"backgroundPattern":"background"),ie=M.coveringTiles({tileSize:D});L&&(T.activeTexture.set(S.TEXTURE0),l.imageManager.bind(l.context));for(var K=c.getCrossfadeParameters(),J=0,_e=ie;J<_e.length;J+=1){var Ee=_e[J],Ie=l.transform.calculatePosMatrix(Ee.toUnwrapped()),Me=L?fa(Ie,y,l,L,{tileID:Ee,tileSize:D},K):yn(Ie,y,d);Q.draw(T,S.TRIANGLES,W,z,te,De.disabled,Me,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,u,c){for(var d=0;d<c.length;d++)gl(l,u,c[d])},custom:function(l,u,c){var d=l.context,y=c.implementation;if(l.renderPass==="offscreen"){var T=y.prerender;T&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),T.call(y,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(be.disabled);var S=y.renderingMode==="3d"?new fe(l.context.gl.LEQUAL,fe.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,fe.ReadOnly);d.setDepthMode(S),y.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Ai=function(l,u){this.context=new ce(l),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=we.maxUnderzooming+we.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ia,this.gpuTimers={}};Ai.prototype.resize=function(l,u){if(this.width=l*s.browser.devicePixelRatio,this.height=u*s.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Ai.prototype.setup=function(){var l=this.context,u=new s.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(s.EXTENT,0),u.emplaceBack(0,s.EXTENT),u.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(u,Hi.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);var c=new s.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(s.EXTENT,0),c.emplaceBack(0,s.EXTENT),c.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=l.createVertexBuffer(c,Hi.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);var d=new s.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(s.EXTENT,0,s.EXTENT,0),d.emplaceBack(0,s.EXTENT,0,s.EXTENT),d.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,Ot.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);var y=new s.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(y,Hi.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);var T=new s.StructArrayLayout1ui2;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(T);var S=new s.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S),this.emptyTexture=new s.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var M=this.context.gl;this.stencilClearMode=new be({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)},Ai.prototype.clearStencil=function(){var l=this.context,u=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=s.create();s.ortho(c,0,this.width,this.height,0,0,1),s.scale(c,c,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,u.TRIANGLES,fe.disabled,this.stencilClearMode,Oe.disabled,De.disabled,ha(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ai.prototype._renderTileClippingMasks=function(l,u){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&u&&u.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+u.length>256&&this.clearStencil(),c.setColorMode(Oe.disabled),c.setDepthMode(fe.disabled);var y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var T=0,S=u;T<S.length;T+=1){var M=S[T],D=this._tileClippingMaskIDs[M.key]=this.nextStencilID++;y.draw(c,d.TRIANGLES,fe.disabled,new be({func:d.ALWAYS,mask:0},D,255,d.KEEP,d.KEEP,d.REPLACE),Oe.disabled,De.disabled,ha(M.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ai.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,u=this.context.gl;return new be({func:u.NOTEQUAL,mask:255},l,255,u.KEEP,u.KEEP,u.REPLACE)},Ai.prototype.stencilModeForClipping=function(l){var u=this.context.gl;return new be({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,u.KEEP,u.KEEP,u.REPLACE)},Ai.prototype.stencilConfigForOverlap=function(l){var u,c=this.context.gl,d=l.sort(function(D,L){return L.overscaledZ-D.overscaledZ}),y=d[d.length-1].overscaledZ,T=d[0].overscaledZ-y+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();for(var S={},M=0;M<T;M++)S[M+y]=new be({func:c.GEQUAL,mask:255},M+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=T,[S,d]}return[(u={},u[y]=be.disabled,u),d]},Ai.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Oe([l.CONSTANT_COLOR,l.ONE],new s.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Oe.unblended:Oe.alphaBlended},Ai.prototype.depthModeForSublayer=function(l,u,c){if(!this.opaquePassEnabledForLayer())return fe.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new fe(c||this.context.gl.LEQUAL,u,[d,d])},Ai.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ai.prototype.render=function(l,u){var c=this;this.style=l,this.options=u,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.browser.now()),this.imageManager.beginFrame();var d=this.style._order,y=this.style.sourceCaches;for(var T in y){var S=y[T];S.used&&S.prepare(this.context)}var M,D,L={},j={},z={};for(var W in y){var te=y[W];L[W]=te.getVisibleCoordinates(),j[W]=L[W].slice().reverse(),z[W]=te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Q=0;Q<d.length;Q++)if(this.style._layers[d[Q]].is3D()){this.opaquePassCutoff=Q;break}this.renderPass="offscreen";for(var ie=0,K=d;ie<K.length;ie+=1){var J=this.style._layers[K[ie]];if(J.hasOffscreenPass()&&!J.isHidden(this.transform.zoom)){var _e=j[J.source];(J.type==="custom"||_e.length)&&this.renderLayer(this,y[J.source],J,_e)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var Ee=this.style._layers[d[this.currentLayer]],Ie=y[Ee.source],Me=L[Ee.source];this._renderTileClippingMasks(Ee,Me),this.renderLayer(this,Ie,Ee,Me)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Ge=this.style._layers[d[this.currentLayer]],Qe=y[Ge.source],st=(Ge.type==="symbol"?z:j)[Ge.source];this._renderTileClippingMasks(Ge,L[Ge.source]),this.renderLayer(this,Qe,Ge,st)}this.options.showTileBoundaries&&(s.values(this.style._layers).forEach(function(rt){rt.source&&!rt.isHidden(c.transform.zoom)&&(rt.source!==(D&&D.id)&&(D=c.style.sourceCaches[rt.source]),(!M||M.getSource().maxzoom<D.getSource().maxzoom)&&(M=D))}),M&&Fa.debug(this,M,M.getVisibleCoordinates())),this.options.showPadding&&function(rt){var lt=rt.transform.padding;Da(rt,rt.transform.height-(lt.top||0),3,Ql),Da(rt,lt.bottom||0,3,df),pa(rt,lt.left||0,3,Af),pa(rt,rt.transform.width-(lt.right||0),3,ec);var At=rt.transform.centerPoint;(function(Tt,ft,Zt,xt){tc(Tt,ft-1,Zt-10,2,20,xt),tc(Tt,ft-10,Zt-1,20,2,xt)})(rt,At.x,rt.transform.height-At.y,Jc)}(this),this.context.setDefault()},Ai.prototype.renderLayer=function(l,u,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Fa[c.type](l,u,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ai.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var u=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),c.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,c.query)}},Ai.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ai.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ai.prototype.queryGpuTimers=function(l){var u={};for(var c in l){var d=l[c],y=this.context.extTimerQuery,T=y.getQueryObjectEXT(d.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(d.query),u[c]=T}return u},Ai.prototype.translatePosMatrix=function(l,u,c,d,y){if(!c[0]&&!c[1])return l;var T=y?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(T){var S=Math.sin(T),M=Math.cos(T);c=[c[0]*M-c[1]*S,c[0]*S+c[1]*M]}var D=[y?c[0]:ai(u,c[0],this.transform.zoom),y?c[1]:ai(u,c[1],this.transform.zoom),0],L=new Float32Array(16);return s.translate(L,l,D),L},Ai.prototype.saveTileTexture=function(l){var u=this._tileTextures[l.size[0]];u?u.push(l):this._tileTextures[l.size[0]]=[l]},Ai.prototype.getTileTexture=function(l){var u=this._tileTextures[l];return u&&u.length>0?u.pop():null},Ai.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var u=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!u||!c},Ai.prototype.useProgram=function(l,u){this.cache=this.cache||{};var c=""+l+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new nf(this.context,l,_A[l],u,da[l],this._showOverdrawInspector)),this.cache[c]},Ai.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ai.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ai.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ai.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Qc=function(l,u){this.points=l,this.planes=u};Qc.fromInvProjectionMatrix=function(l,u,c){var d=Math.pow(2,c),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(S){return s.transformMat4([],S,l)}).map(function(S){return s.scale$1([],S,1/S[3]/u*d)}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(S){var M=s.sub([],y[S[0]],y[S[1]]),D=s.sub([],y[S[2]],y[S[1]]),L=s.normalize([],s.cross([],M,D)),j=-s.dot(L,y[S[1]]);return L.concat(j)});return new Qc(y,T)};var La=function(l,u){this.min=l,this.max=u,this.center=s.scale$2([],s.add([],this.min,this.max),.5)};La.prototype.quadrant=function(l){for(var u=[l%2==0,l<2],c=s.clone$2(this.min),d=s.clone$2(this.max),y=0;y<u.length;y++)c[y]=u[y]?this.min[y]:this.center[y],d[y]=u[y]?this.center[y]:this.max[y];return d[2]=this.max[2],new La(c,d)},La.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},La.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},La.prototype.intersects=function(l){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var y=l.planes[d],T=0,S=0;S<u.length;S++)T+=s.dot$1(y,u[S])>=0;if(T===0)return 0;T!==u.length&&(c=!1)}if(c)return 2;for(var M=0;M<3;M++){for(var D=Number.MAX_VALUE,L=-Number.MAX_VALUE,j=0;j<l.points.length;j++){var z=l.points[j][M]-this.min[M];D=Math.min(D,z),L=Math.max(L,z)}if(L<0||D>this.max[M]-this.min[M])return 0}return 1};var ga=function(l,u,c,d){if(l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(u)||u<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=u,this.left=c,this.right=d};ga.prototype.interpolate=function(l,u,c){return u.top!=null&&l.top!=null&&(this.top=s.number(l.top,u.top,c)),u.bottom!=null&&l.bottom!=null&&(this.bottom=s.number(l.bottom,u.bottom,c)),u.left!=null&&l.left!=null&&(this.left=s.number(l.left,u.left,c)),u.right!=null&&l.right!=null&&(this.right=s.number(l.right,u.right,c)),this},ga.prototype.getCenter=function(l,u){var c=s.clamp((this.left+l-this.right)/2,0,l),d=s.clamp((this.top+u-this.bottom)/2,0,u);return new s.Point(c,d)},ga.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},ga.prototype.clone=function(){return new ga(this.top,this.bottom,this.left,this.right)},ga.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var kr=function(l,u,c,d,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||y,this._minZoom=l||0,this._maxZoom=u||22,this._minPitch=c??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ga,this._posMatrixCache={},this._alignedPosMatrixCache={}},li={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};kr.prototype.clone=function(){var l=new kr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},li.minZoom.get=function(){return this._minZoom},li.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},li.maxZoom.get=function(){return this._maxZoom},li.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},li.minPitch.get=function(){return this._minPitch},li.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},li.maxPitch.get=function(){return this._maxPitch},li.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},li.renderWorldCopies.get=function(){return this._renderWorldCopies},li.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},li.worldSize.get=function(){return this.tileSize*this.scale},li.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},li.size.get=function(){return new s.Point(this.width,this.height)},li.bearing.get=function(){return-this.angle/Math.PI*180},li.bearing.set=function(l){var u=-s.wrap(l,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=s.create$2(),s.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},li.pitch.get=function(){return this._pitch/Math.PI*180},li.pitch.set=function(l){var u=s.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},li.fov.get=function(){return this._fov/Math.PI*180},li.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},li.zoom.get=function(){return this._zoom},li.zoom.set=function(l){var u=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},li.center.get=function(){return this._center},li.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},li.padding.get=function(){return this._edgeInsets.toJSON()},li.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},li.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},kr.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},kr.prototype.interpolatePadding=function(l,u,c){this._unmodified=!1,this._edgeInsets.interpolate(l,u,c),this._constrain(),this._calcMatrices()},kr.prototype.coveringZoomLevel=function(l){var u=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,u)},kr.prototype.getVisibleUnwrappedCoordinates=function(l){var u=[new s.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new s.Point(0,0)),d=this.pointCoordinate(new s.Point(this.width,0)),y=this.pointCoordinate(new s.Point(this.width,this.height)),T=this.pointCoordinate(new s.Point(0,this.height)),S=Math.floor(Math.min(c.x,d.x,y.x,T.x)),M=Math.floor(Math.max(c.x,d.x,y.x,T.x)),D=S-1;D<=M+1;D++)D!==0&&u.push(new s.UnwrappedTileID(D,l));return u},kr.prototype.coveringTiles=function(l){var u=this.coveringZoomLevel(l),c=u;if(l.minzoom!==void 0&&u<l.minzoom)return[];l.maxzoom!==void 0&&u>l.maxzoom&&(u=l.maxzoom);var d=s.MercatorCoordinate.fromLngLat(this.center),y=Math.pow(2,u),T=[y*d.x,y*d.y,0],S=Qc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),M=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(M=u);var D=function(rt){return{aabb:new La([rt*y,0,0],[(rt+1)*y,y,0]),zoom:0,x:0,y:0,wrap:rt,fullyVisible:!1}},L=[],j=[],z=u,W=l.reparseOverscaled?c:u;if(this._renderWorldCopies)for(var te=1;te<=3;te++)L.push(D(-te)),L.push(D(te));for(L.push(D(0));L.length>0;){var Q=L.pop(),ie=Q.x,K=Q.y,J=Q.fullyVisible;if(!J){var _e=Q.aabb.intersects(S);if(_e===0)continue;J=_e===2}var Ee=Q.aabb.distanceX(T),Ie=Q.aabb.distanceY(T),Me=Math.max(Math.abs(Ee),Math.abs(Ie));if(Q.zoom===z||Me>3+(1<<z-Q.zoom)-2&&Q.zoom>=M)j.push({tileID:new s.OverscaledTileID(Q.zoom===z?W:Q.zoom,Q.wrap,Q.zoom,ie,K),distanceSq:s.sqrLen([T[0]-.5-ie,T[1]-.5-K])});else for(var Ge=0;Ge<4;Ge++){var Qe=(ie<<1)+Ge%2,st=(K<<1)+(Ge>>1);L.push({aabb:Q.aabb.quadrant(Ge),zoom:Q.zoom+1,x:Qe,y:st,wrap:Q.wrap,fullyVisible:J})}}return j.sort(function(rt,lt){return rt.distanceSq-lt.distanceSq}).map(function(rt){return rt.tileID})},kr.prototype.resize=function(l,u){this.width=l,this.height=u,this.pixelsToGLUnits=[2/l,-2/u],this._constrain(),this._calcMatrices()},li.unmodified.get=function(){return this._unmodified},kr.prototype.zoomScale=function(l){return Math.pow(2,l)},kr.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},kr.prototype.project=function(l){var u=s.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(l.lng)*this.worldSize,s.mercatorYfromLat(u)*this.worldSize)},kr.prototype.unproject=function(l){return new s.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},li.point.get=function(){return this.project(this.center)},kr.prototype.setLocationAtPoint=function(l,u){var c=this.pointCoordinate(u),d=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(l),T=new s.MercatorCoordinate(y.x-(c.x-d.x),y.y-(c.y-d.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())},kr.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},kr.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},kr.prototype.locationCoordinate=function(l){return s.MercatorCoordinate.fromLngLat(l)},kr.prototype.coordinateLocation=function(l){return l.toLngLat()},kr.prototype.pointCoordinate=function(l){var u=[l.x,l.y,0,1],c=[l.x,l.y,1,1];s.transformMat4(u,u,this.pixelMatrixInverse),s.transformMat4(c,c,this.pixelMatrixInverse);var d=u[3],y=c[3],T=u[1]/d,S=c[1]/y,M=u[2]/d,D=c[2]/y,L=M===D?0:(0-M)/(D-M);return new s.MercatorCoordinate(s.number(u[0]/d,c[0]/y,L)/this.worldSize,s.number(T,S,L)/this.worldSize)},kr.prototype.coordinatePoint=function(l){var u=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.transformMat4(u,u,this.pixelMatrix),new s.Point(u[0]/u[3],u[1]/u[3])},kr.prototype.getBounds=function(){return new s.LngLatBounds().extend(this.pointLocation(new s.Point(0,0))).extend(this.pointLocation(new s.Point(this.width,0))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))},kr.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},kr.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},kr.prototype.calculatePosMatrix=function(l,u){u===void 0&&(u=!1);var c=l.key,d=u?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var y=l.canonical,T=this.worldSize/this.zoomScale(y.z),S=y.x+Math.pow(2,y.z)*l.wrap,M=s.identity(new Float64Array(16));return s.translate(M,M,[S*T,y.y*T,0]),s.scale(M,M,[T/s.EXTENT,T/s.EXTENT,1]),s.multiply(M,u?this.alignedProjMatrix:this.projMatrix,M),d[c]=new Float32Array(M),d[c]},kr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},kr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,u,c,d,y=-90,T=90,S=-180,M=180,D=this.size,L=this._unmodified;if(this.latRange){var j=this.latRange;y=s.mercatorYfromLat(j[1])*this.worldSize,l=(T=s.mercatorYfromLat(j[0])*this.worldSize)-y<D.y?D.y/(T-y):0}if(this.lngRange){var z=this.lngRange;S=s.mercatorXfromLng(z[0])*this.worldSize,u=(M=s.mercatorXfromLng(z[1])*this.worldSize)-S<D.x?D.x/(M-S):0}var W=this.point,te=Math.max(u||0,l||0);if(te)return this.center=this.unproject(new s.Point(u?(M+S)/2:W.x,l?(T+y)/2:W.y)),this.zoom+=this.scaleZoom(te),this._unmodified=L,void(this._constraining=!1);if(this.latRange){var Q=W.y,ie=D.y/2;Q-ie<y&&(d=y+ie),Q+ie>T&&(d=T-ie)}if(this.lngRange){var K=W.x,J=D.x/2;K-J<S&&(c=S+J),K+J>M&&(c=M-J)}c===void 0&&d===void 0||(this.center=this.unproject(new s.Point(c!==void 0?c:W.x,d!==void 0?d:W.y))),this._unmodified=L,this._constraining=!1}},kr.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(s.clamp(Math.PI-u-c,.01,Math.PI-.01)),y=this.point,T=y.x,S=y.y,M=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),D=this.height/50,L=new Float64Array(16);s.perspective(L,this._fov,this.width/this.height,D,M),L[8]=2*-l.x/this.width,L[9]=2*l.y/this.height,s.scale(L,L,[1,-1,1]),s.translate(L,L,[0,0,-this.cameraToCenterDistance]),s.rotateX(L,L,this._pitch),s.rotateZ(L,L,this.angle),s.translate(L,L,[-T,-S,0]),this.mercatorMatrix=s.scale([],L,[this.worldSize,this.worldSize,this.worldSize]),s.scale(L,L,[1,1,s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=L,this.invProjMatrix=s.invert([],this.projMatrix);var j=this.width%2/2,z=this.height%2/2,W=Math.cos(this.angle),te=Math.sin(this.angle),Q=T-Math.round(T)+W*j+te*z,ie=S-Math.round(S)+W*z+te*j,K=new Float64Array(L);if(s.translate(K,K,[Q>.5?Q-1:Q,ie>.5?ie-1:ie,0]),this.alignedProjMatrix=K,L=s.create(),s.scale(L,L,[this.width/2,-this.height/2,1]),s.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=s.create(),s.scale(L,L,[1,-1,1]),s.translate(L,L,[-1,-1,0]),s.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(L=s.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=L,this._posMatrixCache={},this._alignedPosMatrixCache={}}},kr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new s.Point(0,0)),u=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},kr.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,l))},kr.prototype.getCameraQueryGeometry=function(l){var u=this.getCameraPoint();if(l.length===1)return[l[0],u];for(var c=u.x,d=u.y,y=u.x,T=u.y,S=0,M=l;S<M.length;S+=1){var D=M[S];c=Math.min(c,D.x),d=Math.min(d,D.y),y=Math.max(y,D.x),T=Math.max(T,D.y)}return[new s.Point(c,d),new s.Point(y,d),new s.Point(y,T),new s.Point(c,T),new s.Point(c,d)]},Object.defineProperties(kr.prototype,li);var Kn=function(l){var u,c,d,y;this._hashName=l&&encodeURIComponent(l),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),c=!1,d=null,y=function(){d=null,c&&(u(),d=setTimeout(y,300),c=!1)},function(){return c=!0,d||y(),d})};Kn.prototype.addTo=function(l){return this._map=l,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Kn.prototype.remove=function(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Kn.prototype.getHashString=function(l){var u=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,d),T=Math.round(u.lng*y)/y,S=Math.round(u.lat*y)/y,M=this._map.getBearing(),D=this._map.getPitch(),L="";if(L+=l?"/"+T+"/"+S+"/"+c:c+"/"+S+"/"+T,(M||D)&&(L+="/"+Math.round(10*M)/10),D&&(L+="/"+Math.round(D)),this._hashName){var j=this._hashName,z=!1,W=s.window.location.hash.slice(1).split("&").map(function(te){var Q=te.split("=")[0];return Q===j?(z=!0,Q+"="+L):te}).filter(function(te){return te});return z||W.push(j+"="+L),"#"+W.join("&")}return"#"+L},Kn.prototype._getCurrentHash=function(){var l,u=this,c=s.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===u._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Kn.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:u,pitch:+(l[4]||0)}),!0}return!1},Kn.prototype._updateHashUnthrottled=function(){var l=s.window.location.href.replace(/(#.+)?$/,this.getHashString());try{s.window.history.replaceState(s.window.history.state,null,l)}catch{}};var ml={linearity:.3,easing:s.bezier(0,0,.3,1)},ma=s.extend({deceleration:2500,maxSpeed:1400},ml),rc=s.extend({deceleration:20,maxSpeed:1400},ml),vA=s.extend({deceleration:1e3,maxSpeed:360},ml),bA=s.extend({deceleration:1e3,maxSpeed:90},ml),ic=function(l){this._map=l,this.clear()};function nc(l,u){(!l.duration||l.duration<u.duration)&&(l.duration=u.duration,l.easing=u.easing)}function jo(l,u,c){var d=c.maxSpeed,y=c.linearity,T=c.deceleration,S=s.clamp(l*y/(u/1e3),-d,d),M=Math.abs(S)/(T*y);return{easing:c.easing,duration:1e3*M,amount:S*(M/2)}}ic.prototype.clear=function(){this._inertiaBuffer=[]},ic.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.browser.now(),settings:l})},ic.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,u=s.browser.now();l.length>0&&u-l[0].time>160;)l.shift()},ic.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var y=d[c].settings;u.zoom+=y.zoomDelta||0,u.bearing+=y.bearingDelta||0,u.pitch+=y.pitchDelta||0,y.panDelta&&u.pan._add(y.panDelta),y.around&&(u.around=y.around),y.pinchAround&&(u.pinchAround=y.pinchAround)}var T=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(u.pan.mag()){var M=jo(u.pan.mag(),T,s.extend({},ma,l||{}));S.offset=u.pan.mult(M.amount/u.pan.mag()),S.center=this._map.transform.center,nc(S,M)}if(u.zoom){var D=jo(u.zoom,T,rc);S.zoom=this._map.transform.zoom+D.amount,nc(S,D)}if(u.bearing){var L=jo(u.bearing,T,vA);S.bearing=this._map.transform.bearing+s.clamp(L.amount,-179,179),nc(S,L)}if(u.pitch){var j=jo(u.pitch,T,bA);S.pitch=this._map.transform.pitch+j.amount,nc(S,j)}if(S.zoom||S.bearing){var z=u.pinchAround===void 0?u.around:u.pinchAround;S.around=z?this._map.unproject(z):this._map.getCenter()}return this.clear(),s.extend(S,{noMoveStart:!0})}};var Ji=function(l){function u(d,y,T,S){S===void 0&&(S={});var M=A.mousePos(y.getCanvasContainer(),T),D=y.unproject(M);l.call(this,d,s.extend({point:M,lngLat:D,originalEvent:T},S)),this._defaultPrevented=!1,this.target=y}l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u;var c={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,c),u}(s.Event),_l=function(l){function u(d,y,T){var S=d==="touchend"?T.changedTouches:T.touches,M=A.touchPos(y.getCanvasContainer(),S),D=M.map(function(z){return y.unproject(z)}),L=M.reduce(function(z,W,te,Q){return z.add(W.div(Q.length))},new s.Point(0,0)),j=y.unproject(L);l.call(this,d,{points:M,point:L,lngLats:D,lngLat:j,originalEvent:T}),this._defaultPrevented=!1}l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u;var c={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,c),u}(s.Event),pf=function(l){function u(d,y,T){l.call(this,d,{originalEvent:T}),this._defaultPrevented=!1}l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u;var c={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,c),u}(s.Event),Fi=function(l,u){this._map=l,this._clickTolerance=u.clickTolerance};Fi.prototype.reset=function(){delete this._mousedownPos},Fi.prototype.wheel=function(l){return this._firePreventable(new pf(l.type,this._map,l))},Fi.prototype.mousedown=function(l,u){return this._mousedownPos=u,this._firePreventable(new Ji(l.type,this._map,l))},Fi.prototype.mouseup=function(l){this._map.fire(new Ji(l.type,this._map,l))},Fi.prototype.click=function(l,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Ji(l.type,this._map,l))},Fi.prototype.dblclick=function(l){return this._firePreventable(new Ji(l.type,this._map,l))},Fi.prototype.mouseover=function(l){this._map.fire(new Ji(l.type,this._map,l))},Fi.prototype.mouseout=function(l){this._map.fire(new Ji(l.type,this._map,l))},Fi.prototype.touchstart=function(l){return this._firePreventable(new _l(l.type,this._map,l))},Fi.prototype.touchmove=function(l){this._map.fire(new _l(l.type,this._map,l))},Fi.prototype.touchend=function(l){this._map.fire(new _l(l.type,this._map,l))},Fi.prototype.touchcancel=function(l){this._map.fire(new _l(l.type,this._map,l))},Fi.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Fi.prototype.isEnabled=function(){return!0},Fi.prototype.isActive=function(){return!1},Fi.prototype.enable=function(){},Fi.prototype.disable=function(){};var Ct=function(l){this._map=l};Ct.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Ct.prototype.mousemove=function(l){this._map.fire(new Ji(l.type,this._map,l))},Ct.prototype.mousedown=function(){this._delayContextMenu=!0},Ct.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Ct.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Ji(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},Ct.prototype.isEnabled=function(){return!0},Ct.prototype.isActive=function(){return!1},Ct.prototype.enable=function(){},Ct.prototype.disable=function(){};var Yn=function(l,u){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=u.clickTolerance||1};function eu(l,u){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=u[d];return c}Yn.prototype.isEnabled=function(){return!!this._enabled},Yn.prototype.isActive=function(){return!!this._active},Yn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Yn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Yn.prototype.mousedown=function(l,u){this.isEnabled()&&l.shiftKey&&l.button===0&&(A.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},Yn.prototype.mousemoveWindow=function(l,u){if(this._active){var c=u;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=A.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var y=Math.min(d.x,c.x),T=Math.max(d.x,c.x),S=Math.min(d.y,c.y),M=Math.max(d.y,c.y);A.setTransform(this._box,"translate("+y+"px,"+S+"px)"),this._box.style.width=T-y+"px",this._box.style.height=M-S+"px"}}},Yn.prototype.mouseupWindow=function(l,u){var c=this;if(this._active&&l.button===0){var d=this._startPos,y=u;if(this.reset(),A.suppressClick(),d.x!==y.x||d.y!==y.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(T){return T.fitScreenCoordinates(d,y,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},Yn.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},Yn.prototype.blur=function(){this.reset()},Yn.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(A.remove(this._box),this._box=null),A.enableDrag(),delete this._startPos,delete this._lastPos},Yn.prototype._fireEvent=function(l,u){return this._map.fire(new s.Event(l,{originalEvent:u}))};var yl=function(l){this.reset(),this.numTouches=l.numTouches};yl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},yl.prototype.touchstart=function(l,u,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var y=new s.Point(0,0),T=0,S=d;T<S.length;T+=1)y._add(S[T]);return y.div(d.length)}(u),this.touches=eu(c,u)))},yl.prototype.touchmove=function(l,u,c){if(!this.aborted&&this.centroid){var d=eu(c,u);for(var y in this.touches){var T=d[y];(!T||T.dist(this.touches[y])>30)&&(this.aborted=!0)}}},yl.prototype.touchend=function(l,u,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Qs=function(l){this.singleTap=new yl(l),this.numTaps=l.numTaps,this.reset()};Qs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Qs.prototype.touchstart=function(l,u,c){this.singleTap.touchstart(l,u,c)},Qs.prototype.touchmove=function(l,u,c){this.singleTap.touchmove(l,u,c)},Qs.prototype.touchend=function(l,u,c){var d=this.singleTap.touchend(l,u,c);if(d){var y=l.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(d)<30;if(y&&T||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var as=function(){this._zoomIn=new Qs({numTouches:1,numTaps:2}),this._zoomOut=new Qs({numTouches:2,numTaps:1}),this.reset()};as.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},as.prototype.touchstart=function(l,u,c){this._zoomIn.touchstart(l,u,c),this._zoomOut.touchstart(l,u,c)},as.prototype.touchmove=function(l,u,c){this._zoomIn.touchmove(l,u,c),this._zoomOut.touchmove(l,u,c)},as.prototype.touchend=function(l,u,c){var d=this,y=this._zoomIn.touchend(l,u,c),T=this._zoomOut.touchend(l,u,c);return y?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(S){return S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:l})}}):T?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(S){return S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(T)},{originalEvent:l})}}):void 0},as.prototype.touchcancel=function(){this.reset()},as.prototype.enable=function(){this._enabled=!0},as.prototype.disable=function(){this._enabled=!1,this.reset()},as.prototype.isEnabled=function(){return this._enabled},as.prototype.isActive=function(){return this._active};var Qu={0:1,2:2},bt=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};bt.prototype.blur=function(){this.reset()},bt.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},bt.prototype._correctButton=function(l,u){return!1},bt.prototype._move=function(l,u){return{}},bt.prototype.mousedown=function(l,u){if(!this._lastPoint){var c=A.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=u,this._eventButton=c)}},bt.prototype.mousemoveWindow=function(l,u){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,y){var T=Qu[y];return d.buttons===void 0||(d.buttons&T)!==T}(l,this._eventButton))this.reset();else if(this._moved||!(u.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(c,u)}},bt.prototype.mouseupWindow=function(l){this._lastPoint&&A.mouseButton(l)===this._eventButton&&(this._moved&&A.suppressClick(),this.reset())},bt.prototype.enable=function(){this._enabled=!0},bt.prototype.disable=function(){this._enabled=!1,this.reset()},bt.prototype.isEnabled=function(){return this._enabled},bt.prototype.isActive=function(){return this._active};var tu=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},u.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},u}(bt),sc=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},u.prototype._move=function(c,d){var y=.8*(d.x-c.x);if(y)return this._active=!0,{bearingDelta:y}},u.prototype.contextmenu=function(c){c.preventDefault()},u}(bt),eh=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},u.prototype._move=function(c,d){var y=-.5*(d.y-c.y);if(y)return this._active=!0,{pitchDelta:y}},u.prototype.contextmenu=function(c){c.preventDefault()},u}(bt),Os=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Os.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)},Os.prototype.touchstart=function(l,u,c){return this._calculateTransform(l,u,c)},Os.prototype.touchmove=function(l,u,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,u,c)},Os.prototype.touchend=function(l,u,c){this._calculateTransform(l,u,c),this._active&&c.length<this._minTouches&&this.reset()},Os.prototype.touchcancel=function(){this.reset()},Os.prototype._calculateTransform=function(l,u,c){c.length>0&&(this._active=!0);var d=eu(c,u),y=new s.Point(0,0),T=new s.Point(0,0),S=0;for(var M in d){var D=d[M],L=this._touches[M];L&&(y._add(D),T._add(D.sub(L)),S++,d[M]=D)}if(this._touches=d,!(S<this._minTouches)&&T.mag()){var j=T.div(S);if(this._sum._add(j),!(this._sum.mag()<this._clickTolerance))return{around:y.div(S),panDelta:j}}},Os.prototype.enable=function(){this._enabled=!0},Os.prototype.disable=function(){this._enabled=!1,this.reset()},Os.prototype.isEnabled=function(){return this._enabled},Os.prototype.isActive=function(){return this._active};var ls=function(){this.reset()};function ru(l,u,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return u[d]}function iu(l,u){return Math.log(l/u)/Math.LN2}ls.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ls.prototype._start=function(l){},ls.prototype._move=function(l,u,c){return{}},ls.prototype.touchstart=function(l,u,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([u[0],u[1]]))},ls.prototype.touchmove=function(l,u,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,y=d[1],T=ru(c,u,d[0]),S=ru(c,u,y);if(T&&S){var M=this._aroundCenter?null:T.add(S).div(2);return this._move([T,S],M,l)}}},ls.prototype.touchend=function(l,u,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,y=d[1],T=ru(c,u,d[0]),S=ru(c,u,y);T&&S||(this._active&&A.suppressClick(),this.reset())}},ls.prototype.touchcancel=function(){this.reset()},ls.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},ls.prototype.disable=function(){this._enabled=!1,this.reset()},ls.prototype.isEnabled=function(){return this._enabled},ls.prototype.isActive=function(){return this._active};var cs=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},u.prototype._move=function(c,d){var y=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(iu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:iu(this._distance,y),pinchAround:d}},u}(ls);function Ho(l,u){return 180*l.angleWith(u)/Math.PI}var gf=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},u.prototype._move=function(c,d){var y=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ho(this._vector,y),pinchAround:d}},u.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,y=Ho(c,this._startVector);return Math.abs(y)<d},u}(ls);function oc(l){return Math.abs(l.y)>Math.abs(l.x)}var th=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(c){this._lastPoints=c,oc(c[0].sub(c[1]))&&(this._valid=!1)},u.prototype._move=function(c,d,y){var T=c[0].sub(this._lastPoints[0]),S=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(T,S,y.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(T.y+S.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(c,d,y){if(this._valid!==void 0)return this._valid;var T=c.mag()>=2,S=d.mag()>=2;if(T||S){if(!T||!S)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;var M=c.y>0==d.y>0;return oc(c)&&oc(d)&&M}},u}(ls),rh={panStep:100,bearingStep:15,pitchStep:10},Ds=function(){var l=rh;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function us(l){return l*(2-l)}Ds.prototype.blur=function(){this.reset()},Ds.prototype.reset=function(){this._active=!1},Ds.prototype.keydown=function(l){var u=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,y=0,T=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),T=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),T=1);break;case 38:l.shiftKey?y=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?y=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,y=0),{cameraAnimation:function(M){var D=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:us,zoom:c?Math.round(D)+c*(l.shiftKey?2:1):D,bearing:M.getBearing()+d*u._bearingStep,pitch:M.getPitch()+y*u._pitchStep,offset:[-T*u._panStep,-S*u._panStep],center:M.getCenter()},{originalEvent:l})}}}},Ds.prototype.enable=function(){this._enabled=!0},Ds.prototype.disable=function(){this._enabled=!1,this.reset()},Ds.prototype.isEnabled=function(){return this._enabled},Ds.prototype.isActive=function(){return this._active},Ds.prototype.disableRotation=function(){this._rotationDisabled=!0},Ds.prototype.enableRotation=function(){this._rotationDisabled=!1};var Jt=function(l,u){this._map=l,this._el=l.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,s.bindAll(["_onTimeout"],this)};Jt.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Jt.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Jt.prototype.isEnabled=function(){return!!this._enabled},Jt.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Jt.prototype.isZooming=function(){return!!this._zooming},Jt.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Jt.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Jt.prototype.wheel=function(l){if(this.isEnabled()){var u=l.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=s.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),l.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=l,this._delta-=u,this._active||this._start(l)),l.preventDefault()}},Jt.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Jt.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=A.mousePos(this._el,l);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Jt.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var y=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(y*d))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var T,S=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,M=this._startZoom,D=this._easing,L=!1;if(this._type==="wheel"&&M&&D){var j=Math.min((s.browser.now()-this._lastWheelEventTime)/200,1),z=D(j);T=s.number(M,S,z),j<1?this._frameId||(this._frameId=!0):L=!0}else T=S,L=!0;return this._active=!0,L&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!L,zoomDelta:T-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Jt.prototype._smoothOutEasing=function(l){var u=s.ease;if(this._prevEase){var c=this._prevEase,d=(s.browser.now()-c.start)/c.duration,y=c.easing(d+.01)-c.easing(d),T=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-T*T);u=s.bezier(T,S,.25,1)}return this._prevEase={start:s.browser.now(),duration:l,easing:u},u},Jt.prototype.blur=function(){this.reset()},Jt.prototype.reset=function(){this._active=!1};var Ao=function(l,u){this._clickZoom=l,this._tapZoom=u};Ao.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ao.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ao.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ao.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Fs=function(){this.reset()};Fs.prototype.reset=function(){this._active=!1},Fs.prototype.blur=function(){this.reset()},Fs.prototype.dblclick=function(l,u){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(u)},{originalEvent:l})}}},Fs.prototype.enable=function(){this._enabled=!0},Fs.prototype.disable=function(){this._enabled=!1,this.reset()},Fs.prototype.isEnabled=function(){return this._enabled},Fs.prototype.isActive=function(){return this._active};var Gi=function(){this._tap=new Qs({numTouches:1,numTaps:1}),this.reset()};Gi.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Gi.prototype.touchstart=function(l,u,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=u[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,u,c))},Gi.prototype.touchmove=function(l,u,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=u[0],y=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(l,u,c)},Gi.prototype.touchend=function(l,u,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,u,c)&&(this._tapTime=l.timeStamp)},Gi.prototype.touchcancel=function(){this.reset()},Gi.prototype.enable=function(){this._enabled=!0},Gi.prototype.disable=function(){this._enabled=!1,this.reset()},Gi.prototype.isEnabled=function(){return this._enabled},Gi.prototype.isActive=function(){return this._active};var vn=function(l,u,c){this._el=l,this._mousePan=u,this._touchPan=c};vn.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},vn.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},vn.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},vn.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var _a=function(l,u,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=u,this._mousePitch=c};_a.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},_a.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},_a.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},_a.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var eo=function(l,u,c,d){this._el=l,this._touchZoom=u,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};eo.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},eo.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},eo.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},eo.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},eo.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},eo.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Nn=function(l){return l.zoom||l.drag||l.pitch||l.rotate},vl=function(l){function u(){l.apply(this,arguments)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u}(s.Event);function jt(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Lt=function(l,u){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ic(l),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),s.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[s.window,"blur",void 0]];for(var d=0,y=this._listeners;d<y.length;d+=1){var T=y[d],S=T[0];A.addEventListener(S,T[1],S===s.window.document?this.handleWindowEvent:this.handleEvent,T[2])}};Lt.prototype.destroy=function(){for(var l=0,u=this._listeners;l<u.length;l+=1){var c=u[l],d=c[0];A.removeEventListener(d,c[1],d===s.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Lt.prototype._addDefaultHandlers=function(l){var u=this._map,c=u.getCanvasContainer();this._add("mapEvent",new Fi(u,l));var d=u.boxZoom=new Yn(u,l);this._add("boxZoom",d);var y=new as,T=new Fs;u.doubleClickZoom=new Ao(T,y),this._add("tapZoom",y),this._add("clickZoom",T);var S=new Gi;this._add("tapDragZoom",S);var M=u.touchPitch=new th;this._add("touchPitch",M);var D=new sc(l),L=new eh(l);u.dragRotate=new _a(l,D,L),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);var j=new tu(l),z=new Os(l);u.dragPan=new vn(c,j,z),this._add("mousePan",j),this._add("touchPan",z,["touchZoom","touchRotate"]);var W=new gf,te=new cs;u.touchZoomRotate=new eo(c,te,W,S),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]);var Q=u.scrollZoom=new Jt(u,this);this._add("scrollZoom",Q,["mousePan"]);var ie=u.keyboard=new Ds;this._add("keyboard",ie),this._add("blockableMapEvent",new Ct(u));for(var K=0,J=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];K<J.length;K+=1){var _e=J[K];l.interactive&&l[_e]&&u[_e].enable(l[_e])}},Lt.prototype._add=function(l,u,c){this._handlers.push({handlerName:l,handler:u,allowed:c}),this._handlersById[l]=u},Lt.prototype.stop=function(l){if(!this._updatingCamera){for(var u=0,c=this._handlers;u<c.length;u+=1)c[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Lt.prototype.isActive=function(){for(var l=0,u=this._handlers;l<u.length;l+=1)if(u[l].handler.isActive())return!0;return!1},Lt.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Lt.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Lt.prototype.isMoving=function(){return!!Nn(this._eventsInProgress)||this.isZooming()},Lt.prototype._blockedByActive=function(l,u,c){for(var d in l)if(d!==c&&(!u||u.indexOf(d)<0))return!0;return!1},Lt.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Lt.prototype._getMapTouches=function(l){for(var u=[],c=0,d=l;c<d.length;c+=1){var y=d[c];this._el.contains(y.target)&&u.push(y)}return u},Lt.prototype.handleEvent=function(l,u){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},y={},T={},S=l.touches?this._getMapTouches(l.touches):void 0,M=S?A.touchPos(this._el,S):A.mousePos(this._el,l),D=0,L=this._handlers;D<L.length;D+=1){var j=L[D],z=j.handlerName,W=j.handler,te=j.allowed;if(W.isEnabled()){var Q=void 0;this._blockedByActive(T,te,z)?W.reset():W[u||l.type]&&(Q=W[u||l.type](l,M,S),this.mergeHandlerResult(d,y,Q,z,c),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||W.isActive())&&(T[z]=W)}}var ie={};for(var K in this._previousActiveHandlers)T[K]||(ie[K]=c);this._previousActiveHandlers=T,(Object.keys(ie).length||jt(d))&&(this._changes.push([d,y,ie]),this._triggerRenderFrame()),(Object.keys(T).length||jt(d))&&this._map._stop(!0),this._updatingCamera=!1;var J=d.cameraAnimation;J&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],J(this._map))},Lt.prototype.mergeHandlerResult=function(l,u,c,d,y){if(c){s.extend(l,c);var T={handlerName:d,originalEvent:c.originalEvent||y};c.zoomDelta!==void 0&&(u.zoom=T),c.panDelta!==void 0&&(u.drag=T),c.pitchDelta!==void 0&&(u.pitch=T),c.bearingDelta!==void 0&&(u.rotate=T)}},Lt.prototype._applyChanges=function(){for(var l={},u={},c={},d=0,y=this._changes;d<y.length;d+=1){var T=y[d],S=T[0],M=T[1],D=T[2];S.panDelta&&(l.panDelta=(l.panDelta||new s.Point(0,0))._add(S.panDelta)),S.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(l.around=S.around),S.pinchAround!==void 0&&(l.pinchAround=S.pinchAround),S.noInertia&&(l.noInertia=S.noInertia),s.extend(u,M),s.extend(c,D)}this._updateMapTransform(l,u,c),this._changes=[]},Lt.prototype._updateMapTransform=function(l,u,c){var d=this._map,y=d.transform;if(!jt(l))return this._fireEvents(u,c,!0);var T=l.panDelta,S=l.zoomDelta,M=l.bearingDelta,D=l.pitchDelta,L=l.around,j=l.pinchAround;j!==void 0&&(L=j),d._stop(!0),L=L||d.transform.centerPoint;var z=y.pointLocation(T?L.sub(T):L);M&&(y.bearing+=M),D&&(y.pitch+=D),S&&(y.zoom+=S),y.setLocationAtPoint(z,L),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(u,c,!0)},Lt.prototype._fireEvents=function(l,u,c){var d=this,y=Nn(this._eventsInProgress),T=Nn(l),S={};for(var M in l)this._eventsInProgress[M]||(S[M+"start"]=l[M].originalEvent),this._eventsInProgress[M]=l[M];for(var D in!y&&T&&this._fireEvent("movestart",T.originalEvent),S)this._fireEvent(D,S[D]);for(var L in T&&this._fireEvent("move",T.originalEvent),l)this._fireEvent(L,l[L].originalEvent);var j,z={};for(var W in this._eventsInProgress){var te=this._eventsInProgress[W],Q=te.handlerName,ie=te.originalEvent;this._handlersById[Q].isActive()||(delete this._eventsInProgress[W],z[W+"end"]=j=u[Q]||ie)}for(var K in z)this._fireEvent(K,z[K]);var J=Nn(this._eventsInProgress);if(c&&(y||T)&&!J){this._updatingCamera=!0;var _e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ee=function(Ie){return Ie!==0&&-d._bearingSnap<Ie&&Ie<d._bearingSnap};_e?(Ee(_e.bearing||this._map.getBearing())&&(_e.bearing=0),this._map.easeTo(_e,{originalEvent:j})):(this._map.fire(new s.Event("moveend",{originalEvent:j})),Ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Lt.prototype._fireEvent=function(l,u){this._map.fire(new s.Event(l,u?{originalEvent:u}:{}))},Lt.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete l._frameId,l.handleEvent(new vl("renderFrame",{timeStamp:u})),l._applyChanges()})},Lt.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var ac=function(l){function u(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.getCenter=function(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},u.prototype.panBy=function(c,d,y){return c=s.Point.convert(c).mult(-1),this.panTo(this.transform.center,s.extend({offset:c},d),y)},u.prototype.panTo=function(c,d,y){return this.easeTo(s.extend({center:c},d),y)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},u.prototype.zoomTo=function(c,d,y){return this.easeTo(s.extend({zoom:c},d),y)},u.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},u.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},u.prototype.rotateTo=function(c,d,y){return this.easeTo(s.extend({bearing:c},d),y)},u.prototype.resetNorth=function(c,d){return this.rotateTo(0,s.extend({duration:1e3},c),d),this},u.prototype.resetNorthPitch=function(c,d){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},c),d),this},u.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},u.prototype.cameraForBounds=function(c,d){c=s.LngLatBounds.convert(c);var y=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),y,d)},u.prototype._cameraForBoxAndBearing=function(c,d,y,T){var S={top:0,bottom:0,right:0,left:0};if(typeof(T=s.extend({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},T)).padding=="number"){var M=T.padding;T.padding={top:M,bottom:M,right:M,left:M}}T.padding=s.extend(S,T.padding);var D=this.transform,L=D.padding,j=D.project(s.LngLat.convert(c)),z=D.project(s.LngLat.convert(d)),W=j.rotate(-y*Math.PI/180),te=z.rotate(-y*Math.PI/180),Q=new s.Point(Math.max(W.x,te.x),Math.max(W.y,te.y)),ie=new s.Point(Math.min(W.x,te.x),Math.min(W.y,te.y)),K=Q.sub(ie),J=(D.width-(L.left+L.right+T.padding.left+T.padding.right))/K.x,_e=(D.height-(L.top+L.bottom+T.padding.top+T.padding.bottom))/K.y;if(!(_e<0||J<0)){var Ee=Math.min(D.scaleZoom(D.scale*Math.min(J,_e)),T.maxZoom),Ie=typeof T.offset.x=="number"?new s.Point(T.offset.x,T.offset.y):s.Point.convert(T.offset),Me=new s.Point((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(y*Math.PI/180),Ge=Ie.add(Me).mult(D.scale/D.zoomScale(Ee));return{center:D.unproject(j.add(z).div(2).sub(Ge)),zoom:Ee,bearing:y}}s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(c,d,y){return this._fitInternal(this.cameraForBounds(c,d),d,y)},u.prototype.fitScreenCoordinates=function(c,d,y,T,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(c)),this.transform.pointLocation(s.Point.convert(d)),y,T),T,S)},u.prototype._fitInternal=function(c,d,y){return c?(delete(d=s.extend(c,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this},u.prototype.jumpTo=function(c,d){this.stop();var y=this.transform,T=!1,S=!1,M=!1;return"zoom"in c&&y.zoom!==+c.zoom&&(T=!0,y.zoom=+c.zoom),c.center!==void 0&&(y.center=s.LngLat.convert(c.center)),"bearing"in c&&y.bearing!==+c.bearing&&(S=!0,y.bearing=+c.bearing),"pitch"in c&&y.pitch!==+c.pitch&&(M=!0,y.pitch=+c.pitch),c.padding==null||y.isPaddingEqual(c.padding)||(y.padding=c.padding),this.fire(new s.Event("movestart",d)).fire(new s.Event("move",d)),T&&this.fire(new s.Event("zoomstart",d)).fire(new s.Event("zoom",d)).fire(new s.Event("zoomend",d)),S&&this.fire(new s.Event("rotatestart",d)).fire(new s.Event("rotate",d)).fire(new s.Event("rotateend",d)),M&&this.fire(new s.Event("pitchstart",d)).fire(new s.Event("pitch",d)).fire(new s.Event("pitchend",d)),this.fire(new s.Event("moveend",d))},u.prototype.easeTo=function(c,d){var y=this;this._stop(!1,c.easeId),((c=s.extend({offset:[0,0],duration:500,easing:s.ease},c)).animate===!1||!c.essential&&s.browser.prefersReducedMotion)&&(c.duration=0);var T=this.transform,S=this.getZoom(),M=this.getBearing(),D=this.getPitch(),L=this.getPadding(),j="zoom"in c?+c.zoom:S,z="bearing"in c?this._normalizeBearing(c.bearing,M):M,W="pitch"in c?+c.pitch:D,te="padding"in c?c.padding:T.padding,Q=s.Point.convert(c.offset),ie=T.centerPoint.add(Q),K=T.pointLocation(ie),J=s.LngLat.convert(c.center||K);this._normalizeCenter(J);var _e,Ee,Ie=T.project(K),Me=T.project(J).sub(Ie),Ge=T.zoomScale(j-S);c.around&&(_e=s.LngLat.convert(c.around),Ee=T.locationPoint(_e));var Qe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||j!==S,this._rotating=this._rotating||M!==z,this._pitching=this._pitching||W!==D,this._padding=!T.isPaddingEqual(te),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,Qe),this._ease(function(st){if(y._zooming&&(T.zoom=s.number(S,j,st)),y._rotating&&(T.bearing=s.number(M,z,st)),y._pitching&&(T.pitch=s.number(D,W,st)),y._padding&&(T.interpolatePadding(L,te,st),ie=T.centerPoint.add(Q)),_e)T.setLocationAtPoint(_e,Ee);else{var rt=T.zoomScale(T.zoom-S),lt=j>S?Math.min(2,Ge):Math.max(.5,Ge),At=Math.pow(lt,1-st),Tt=T.unproject(Ie.add(Me.mult(st*At)).mult(rt));T.setLocationAtPoint(T.renderWorldCopies?Tt.wrap():Tt,ie)}y._fireMoveEvents(d)},function(st){y._afterEase(d,st)},c),this},u.prototype._prepareEase=function(c,d,y){y===void 0&&(y={}),this._moving=!0,d||y.moving||this.fire(new s.Event("movestart",c)),this._zooming&&!y.zooming&&this.fire(new s.Event("zoomstart",c)),this._rotating&&!y.rotating&&this.fire(new s.Event("rotatestart",c)),this._pitching&&!y.pitching&&this.fire(new s.Event("pitchstart",c))},u.prototype._fireMoveEvents=function(c){this.fire(new s.Event("move",c)),this._zooming&&this.fire(new s.Event("zoom",c)),this._rotating&&this.fire(new s.Event("rotate",c)),this._pitching&&this.fire(new s.Event("pitch",c))},u.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var y=this._zooming,T=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new s.Event("zoomend",c)),T&&this.fire(new s.Event("rotateend",c)),S&&this.fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c))}},u.prototype.flyTo=function(c,d){var y=this;if(!c.essential&&s.browser.prefersReducedMotion){var T=s.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(T,d)}this.stop(),c=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},c);var S=this.transform,M=this.getZoom(),D=this.getBearing(),L=this.getPitch(),j=this.getPadding(),z="zoom"in c?s.clamp(+c.zoom,S.minZoom,S.maxZoom):M,W="bearing"in c?this._normalizeBearing(c.bearing,D):D,te="pitch"in c?+c.pitch:L,Q="padding"in c?c.padding:S.padding,ie=S.zoomScale(z-M),K=s.Point.convert(c.offset),J=S.centerPoint.add(K),_e=S.pointLocation(J),Ee=s.LngLat.convert(c.center||_e);this._normalizeCenter(Ee);var Ie=S.project(_e),Me=S.project(Ee).sub(Ie),Ge=c.curve,Qe=Math.max(S.width,S.height),st=Qe/ie,rt=Me.mag();if("minZoom"in c){var lt=s.clamp(Math.min(c.minZoom,M,z),S.minZoom,S.maxZoom),At=Qe/S.zoomScale(lt-M);Ge=Math.sqrt(At/rt*2)}var Tt=Ge*Ge;function ft(ar){var nr=(st*st-Qe*Qe+(ar?-1:1)*Tt*Tt*rt*rt)/(2*(ar?st:Qe)*Tt*rt);return Math.log(Math.sqrt(nr*nr+1)-nr)}function Zt(ar){return(Math.exp(ar)-Math.exp(-ar))/2}function xt(ar){return(Math.exp(ar)+Math.exp(-ar))/2}var or=ft(0),Tr=function(ar){return xt(or)/xt(or+Ge*ar)},hr=function(ar){return Qe*((xt(or)*(Zt(nr=or+Ge*ar)/xt(nr))-Zt(or))/Tt)/rt;var nr},cr=(ft(1)-or)/Ge;if(Math.abs(rt)<1e-6||!isFinite(cr)){if(Math.abs(Qe-st)<1e-6)return this.easeTo(c,d);var wr=st<Qe?-1:1;cr=Math.abs(Math.log(st/Qe))/Ge,hr=function(){return 0},Tr=function(ar){return Math.exp(wr*Ge*ar)}}return c.duration="duration"in c?+c.duration:1e3*cr/("screenSpeed"in c?+c.screenSpeed/Ge:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=D!==W,this._pitching=te!==L,this._padding=!S.isPaddingEqual(Q),this._prepareEase(d,!1),this._ease(function(ar){var nr=ar*cr,wn=1/Tr(nr);S.zoom=ar===1?z:M+S.scaleZoom(wn),y._rotating&&(S.bearing=s.number(D,W,ar)),y._pitching&&(S.pitch=s.number(L,te,ar)),y._padding&&(S.interpolatePadding(j,Q,ar),J=S.centerPoint.add(K));var Wi=ar===1?Ee:S.unproject(Ie.add(Me.mult(hr(nr))).mult(wn));S.setLocationAtPoint(S.renderWorldCopies?Wi.wrap():Wi,J),y._fireMoveEvents(d)},function(){return y._afterEase(d)},c),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,d)}if(!c){var T=this.handlers;T&&T.stop(!1)}return this},u.prototype._ease=function(c,d,y){y.animate===!1||y.duration===0?(c(1),d()):(this._easeStart=s.browser.now(),this._easeOptions=y,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var c=Math.min((s.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(c,d){c=s.wrap(c,-180,180);var y=Math.abs(c-d);return Math.abs(c-360-d)<y&&(c-=360),Math.abs(c+360-d)<y&&(c+=360),c},u.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var y=c.lng-d.center.lng;c.lng+=y>180?-360:y<-180?360:0}},u}(s.Evented),Un=function(l){l===void 0&&(l={}),this.options=l,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Un.prototype.getDefaultPosition=function(){return"bottom-right"},Un.prototype.onAdd=function(l){var u=this.options&&this.options.compact;return this._map=l,this._container=A.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=A.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Un.prototype.onRemove=function(){A.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Un.prototype._setElementTitle=function(l,u){var c=this._map._getUIString("AttributionControl."+u);l.title=c,l.setAttribute("aria-label",c)},Un.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Un.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(l){var c=u.reduce(function(d,y,T){return y.value&&(d+=y.key+"="+y.value+(T<u.length-1?"&":"")),d},"?");l.href=s.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},Un.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Un.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(M){return typeof M!="string"?"":M})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var c=this._map.style.sourceCaches;for(var d in c){var y=c[d];if(y.used){var T=y.getSource();T.attribution&&l.indexOf(T.attribution)<0&&l.push(T.attribution)}}l.sort(function(M,D){return M.length-D.length});var S=(l=l.filter(function(M,D){for(var L=D+1;L<l.length;L++)if(l[L].indexOf(M)>=0)return!1;return!0})).join(" | ");S!==this._attribHTML&&(this._attribHTML=S,l.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Un.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var to=function(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)};to.prototype.onAdd=function(l){this._map=l,this._container=A.create("div","mapboxgl-ctrl");var u=A.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},to.prototype.onRemove=function(){A.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},to.prototype.getDefaultPosition=function(){return"bottom-left"},to.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},to.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var u in l)if(l[u].getSource().mapbox_logo)return!0;return!1}},to.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var u=l[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var bn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};bn.prototype.add=function(l){var u=++this._id;return this._queue.push({callback:l,id:u,cancelled:!1}),u},bn.prototype.remove=function(l){for(var u=this._currentlyRunning,c=0,d=u?this._queue.concat(u):this._queue;c<d.length;c+=1){var y=d[c];if(y.id===l)return void(y.cancelled=!0)}},bn.prototype.run=function(l){l===void 0&&(l=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=u;c<d.length;c+=1){var y=d[c];if(!y.cancelled&&(y.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},bn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var po={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},ih=s.window.HTMLImageElement,ro=s.window.HTMLElement,Rr=s.window.ImageBitmap,$t={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},io=function(l){function u(d){var y=this;if((d=s.extend({},$t,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var T=new kr(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,T,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new bn,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},po,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new s.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=s.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof ro))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return y._update(!1)}),this.on("moveend",function(){return y._update(!1)}),this.on("zoom",function(){return y._update(!0)}),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Lt(this,d),this._hash=d.hash&&new Kn(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,s.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Un({customAttribution:d.customAttribution})),this.addControl(new to,d.logoPosition),this.on("style.load",function(){y.transform.unmodified&&y.jumpTo(y.style.stylesheet)}),this.on("data",function(S){y._update(S.dataType==="style"),y.fire(new s.Event(S.dataType+"data",S))}),this.on("dataloading",function(S){y.fire(new s.Event(S.dataType+"dataloading",S))})}l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(d,y){if(y===void 0&&(y=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var T=d.onAdd(this);this._controls.push(d);var S=this._controlPositions[y];return y.indexOf("bottom")!==-1?S.insertBefore(T,S.firstChild):S.appendChild(T),this},u.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var y=this._controls.indexOf(d);return y>-1&&this._controls.splice(y,1),d.onRemove(this),this},u.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},u.prototype.resize=function(d){var y=this._containerDimensions(),T=y[0],S=y[1];if(T===this.transform.width&&S===this.transform.height)return this;this._resizeCanvas(T,S),this.transform.resize(T,S),this.painter.resize(T,S);var M=!this._moving;return M&&this.fire(new s.Event("movestart",d)).fire(new s.Event("move",d)),this.fire(new s.Event("resize",d)),M&&this.fire(new s.Event("moveend",d)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(s.LngLatBounds.convert(d)),this._update()},u.prototype.setMinZoom=function(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(d){if((d=d??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},u.prototype.project=function(d){return this.transform.locationPoint(s.LngLat.convert(d))},u.prototype.unproject=function(d){return this.transform.pointLocation(s.Point.convert(d))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(d,y,T){var S,M=this;if(d==="mouseenter"||d==="mouseover"){var D=!1;return{layer:y,listener:T,delegates:{mousemove:function(j){var z=M.getLayer(y)?M.queryRenderedFeatures(j.point,{layers:[y]}):[];z.length?D||(D=!0,T.call(M,new Ji(d,M,j.originalEvent,{features:z}))):D=!1},mouseout:function(){D=!1}}}}if(d==="mouseleave"||d==="mouseout"){var L=!1;return{layer:y,listener:T,delegates:{mousemove:function(j){(M.getLayer(y)?M.queryRenderedFeatures(j.point,{layers:[y]}):[]).length?L=!0:L&&(L=!1,T.call(M,new Ji(d,M,j.originalEvent)))},mouseout:function(j){L&&(L=!1,T.call(M,new Ji(d,M,j.originalEvent)))}}}}return{layer:y,listener:T,delegates:(S={},S[d]=function(j){var z=M.getLayer(y)?M.queryRenderedFeatures(j.point,{layers:[y]}):[];z.length&&(j.features=z,T.call(M,j),delete j.features)},S)}},u.prototype.on=function(d,y,T){if(T===void 0)return l.prototype.on.call(this,d,y);var S=this._createDelegatedListener(d,y,T);for(var M in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(S),S.delegates)this.on(M,S.delegates[M]);return this},u.prototype.once=function(d,y,T){if(T===void 0)return l.prototype.once.call(this,d,y);var S=this._createDelegatedListener(d,y,T);for(var M in S.delegates)this.once(M,S.delegates[M]);return this},u.prototype.off=function(d,y,T){var S=this;return T===void 0?l.prototype.off.call(this,d,y):(this._delegatedListeners&&this._delegatedListeners[d]&&function(M){for(var D=M[d],L=0;L<D.length;L++){var j=D[L];if(j.layer===y&&j.listener===T){for(var z in j.delegates)S.off(z,j.delegates[z]);return D.splice(L,1),S}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(d,y){if(!this.style)return[];var T;if(y!==void 0||d===void 0||d instanceof s.Point||Array.isArray(d)||(y=d,d=void 0),y=y||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof s.Point||typeof d[0]=="number")T=[s.Point.convert(d)];else{var S=s.Point.convert(d[0]),M=s.Point.convert(d[1]);T=[S,new s.Point(M.x,S.y),M,new s.Point(S.x,M.y),S]}return this.style.queryRenderedFeatures(T,y,this.transform)},u.prototype.querySourceFeatures=function(d,y){return this.style.querySourceFeatures(d,y)},u.prototype.setStyle=function(d,y){return(y=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},y)).diff!==!1&&y.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,y),this):(this._localIdeographFontFamily=y.localIdeographFontFamily,this._updateStyle(d,y))},u.prototype._getUIString=function(d){var y=this._locale[d];if(y==null)throw new Error("Missing UI string '"+d+"'");return y},u.prototype._updateStyle=function(d,y){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new os(this,y||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new os(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(d,y){var T=this;if(typeof d=="string"){var S=this._requestManager.normalizeStyleURL(d),M=this._requestManager.transformRequest(S,s.ResourceType.Style);s.getJSON(M,function(D,L){D?T.fire(new s.ErrorEvent(D)):L&&T._updateDiff(L,y)})}else typeof d=="object"&&this._updateDiff(d,y)},u.prototype._updateDiff=function(d,y){try{this.style.setState(d)&&this._update(!0)}catch(T){s.warnOnce("Unable to perform style diff: "+(T.message||T.error||T)+".  Rebuilding the style from scratch."),this._updateStyle(d,y)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(d,y){return this._lazyInitEmptyStyle(),this.style.addSource(d,y),this._update(!0)},u.prototype.isSourceLoaded=function(d){var y=this.style&&this.style.sourceCaches[d];if(y!==void 0)return y.loaded();this.fire(new s.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},u.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var y in d){var T=d[y]._tiles;for(var S in T){var M=T[S];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(d,y,T){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,y,T)},u.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},u.prototype.getSource=function(d){return this.style.getSource(d)},u.prototype.addImage=function(d,y,T){T===void 0&&(T={});var S=T.pixelRatio;S===void 0&&(S=1);var M=T.sdf;M===void 0&&(M=!1);var D=T.stretchX,L=T.stretchY,j=T.content;if(this._lazyInitEmptyStyle(),y instanceof ih||Rr&&y instanceof Rr){var z=s.browser.getImageData(y);this.style.addImage(d,{data:new s.RGBAImage({width:z.width,height:z.height},z.data),pixelRatio:S,stretchX:D,stretchY:L,content:j,sdf:M,version:0})}else{if(y.width===void 0||y.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var W=y;this.style.addImage(d,{data:new s.RGBAImage({width:y.width,height:y.height},new Uint8Array(y.data)),pixelRatio:S,stretchX:D,stretchY:L,content:j,sdf:M,version:0,userImage:W}),W.onAdd&&W.onAdd(this,d)}},u.prototype.updateImage=function(d,y){var T=this.style.getImage(d);if(!T)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var S=y instanceof ih||Rr&&y instanceof Rr?s.browser.getImageData(y):y,M=S.width,D=S.height,L=S.data;return M===void 0||D===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):M!==T.data.width||D!==T.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(T.data.replace(L,!(y instanceof ih||Rr&&y instanceof Rr)),void this.style.updateImage(d,T))},u.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(d){this.style.removeImage(d)},u.prototype.loadImage=function(d,y){s.getImage(this._requestManager.transformRequest(d,s.ResourceType.Image),y)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(d,y){return this._lazyInitEmptyStyle(),this.style.addLayer(d,y),this._update(!0)},u.prototype.moveLayer=function(d,y){return this.style.moveLayer(d,y),this._update(!0)},u.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},u.prototype.getLayer=function(d){return this.style.getLayer(d)},u.prototype.setLayerZoomRange=function(d,y,T){return this.style.setLayerZoomRange(d,y,T),this._update(!0)},u.prototype.setFilter=function(d,y,T){return T===void 0&&(T={}),this.style.setFilter(d,y,T),this._update(!0)},u.prototype.getFilter=function(d){return this.style.getFilter(d)},u.prototype.setPaintProperty=function(d,y,T,S){return S===void 0&&(S={}),this.style.setPaintProperty(d,y,T,S),this._update(!0)},u.prototype.getPaintProperty=function(d,y){return this.style.getPaintProperty(d,y)},u.prototype.setLayoutProperty=function(d,y,T,S){return S===void 0&&(S={}),this.style.setLayoutProperty(d,y,T,S),this._update(!0)},u.prototype.getLayoutProperty=function(d,y){return this.style.getLayoutProperty(d,y)},u.prototype.setLight=function(d,y){return y===void 0&&(y={}),this._lazyInitEmptyStyle(),this.style.setLight(d,y),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(d,y){return this.style.setFeatureState(d,y),this._update()},u.prototype.removeFeatureState=function(d,y){return this.style.removeFeatureState(d,y),this._update()},u.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var d=0,y=0;return this._container&&(d=this._container.clientWidth||400,y=this._container.clientHeight||300),[d,y]},u.prototype._detectMissingCSS=function(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=A.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var y=this._canvasContainer=A.create("div","mapboxgl-canvas-container",d);this._interactive&&y.classList.add("mapboxgl-interactive"),this._canvas=A.create("canvas","mapboxgl-canvas",y),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var T=this._containerDimensions();this._resizeCanvas(T[0],T[1]);var S=this._controlContainer=A.create("div","mapboxgl-control-container",d),M=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(D){M[D]=A.create("div","mapboxgl-ctrl-"+D,S)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(d,y){var T=s.browser.devicePixelRatio||1;this._canvas.width=T*d,this._canvas.height=T*y,this._canvas.style.width=d+"px",this._canvas.style.height=y+"px"},u.prototype._setupPainter=function(){var d=s.extend({},f.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),y=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);y?(this.painter=new Ai(y,this.transform),s.webpSupported.testSupport(y)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:d}))},u.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:d}))},u.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},u.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},u.prototype._render=function(d){var y,T=this,S=0,M=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(y=M.createQueryEXT(),M.beginQueryEXT(M.TIME_ELAPSED_EXT,y),S=s.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var D=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var L=this.transform.zoom,j=s.browser.now();this.style.zoomHistory.update(L,j);var z=new s.EvaluationParameters(L,{now:j,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),W=z.crossFadingFactor();W===1&&W===this._crossFadingFactor||(D=!0,this._crossFadingFactor=W),this.style.update(z)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var te=s.browser.now()-S;M.endQueryEXT(M.TIME_ELAPSED_EXT,y),setTimeout(function(){var K=M.getQueryObjectEXT(y,M.QUERY_RESULT_EXT)/1e6;M.deleteQueryEXT(y),T.fire(new s.Event("gpu-timing-frame",{cpuTime:te,gpuTime:K}))},50)}if(this.listens("gpu-timing-layer")){var Q=this.painter.collectGpuTimers();setTimeout(function(){var K=T.painter.queryGpuTimers(Q);T.fire(new s.Event("gpu-timing-layer",{layerTimes:K}))},50)}var ie=this._sourcesDirty||this._styleDirty||this._placementDirty;return ie||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||ie||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,y=this._controls;d<y.length;d+=1)y[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));var T=this.painter.context.gl.getExtension("WEBGL_lose_context");T&&T.loseContext(),Cr(this._canvasContainer),Cr(this._controlContainer),Cr(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new s.Event("remove"))},u.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=s.browser.frame(function(y){d._frame=null,d._render(y)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},u.prototype._setCacheLimits=function(d,y){s.setCacheLimits(d,y)},c.version.get=function(){return s.version},Object.defineProperties(u.prototype,c),u}(ac);function Cr(l){l.parentNode&&l.parentNode.removeChild(l)}var xn={showCompass:!0,showZoom:!0,visualizePitch:!1},go=function(l){var u=this;this.options=s.extend({},xn,l),this._container=A.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return u._map.zoomIn({},{originalEvent:c})}),A.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return u._map.zoomOut({},{originalEvent:c})}),A.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:c}):u._map.resetNorth({},{originalEvent:c})}),this._compassIcon=A.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};go.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),u=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},go.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},go.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zn(this._map,this._compass,this.options.visualizePitch)),this._container},go.prototype.onRemove=function(){A.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},go.prototype._createButton=function(l,u){var c=A.create("button",l,this._container);return c.type="button",c.addEventListener("click",u),c},go.prototype._setButtonTitle=function(l,u){var c=this._map._getUIString("NavigationControl."+u);l.title=c,l.setAttribute("aria-label",c)};var zn=function(l,u,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new sc({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new eh({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),A.addEventListener(u,"mousedown",this.mousedown),A.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),A.addEventListener(u,"touchmove",this.touchmove),A.addEventListener(u,"touchend",this.touchend),A.addEventListener(u,"touchcancel",this.reset)};function Ls(l,u,c){if(l=new s.LngLat(l.lng,l.lat),u){var d=new s.LngLat(l.lng-360,l.lat),y=new s.LngLat(l.lng+360,l.lat),T=c.locationPoint(l).distSqr(u);c.locationPoint(d).distSqr(u)<T?l=d:c.locationPoint(y).distSqr(u)<T&&(l=y)}for(;Math.abs(l.lng-c.center.lng)>180;){var S=c.locationPoint(l);if(S.x>=0&&S.y>=0&&S.x<=c.width&&S.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}zn.prototype.down=function(l,u){this.mouseRotate.mousedown(l,u),this.mousePitch&&this.mousePitch.mousedown(l,u),A.disableDrag()},zn.prototype.move=function(l,u){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,u);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var y=this.mousePitch.mousemoveWindow(l,u);y&&y.pitchDelta&&c.setPitch(c.getPitch()+y.pitchDelta)}},zn.prototype.off=function(){var l=this.element;A.removeEventListener(l,"mousedown",this.mousedown),A.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),A.removeEventListener(l,"touchmove",this.touchmove),A.removeEventListener(l,"touchend",this.touchend),A.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},zn.prototype.offTemp=function(){A.enableDrag(),A.removeEventListener(s.window,"mousemove",this.mousemove),A.removeEventListener(s.window,"mouseup",this.mouseup)},zn.prototype.mousedown=function(l){this.down(s.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),A.mousePos(this.element,l)),A.addEventListener(s.window,"mousemove",this.mousemove),A.addEventListener(s.window,"mouseup",this.mouseup)},zn.prototype.mousemove=function(l){this.move(l,A.mousePos(this.element,l))},zn.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},zn.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=A.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},zn.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=A.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},zn.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},zn.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var mo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function un(l,u,c){var d=l.classList;for(var y in mo)d.remove("mapboxgl-"+c+"-anchor-"+y);d.add("mapboxgl-"+c+"-anchor-"+u)}var Go,_o=function(l){function u(c,d){if(l.call(this),(c instanceof s.window.HTMLElement||d)&&(c=s.extend({element:c},d)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=s.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=A.create("div"),this._element.setAttribute("aria-label","Map marker");var y=A.createNS("http://www.w3.org/2000/svg","svg");y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height","41px"),y.setAttributeNS(null,"width","27px"),y.setAttributeNS(null,"viewBox","0 0 27 41");var T=A.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");var S=A.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");var M=A.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");for(var D=0,L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];D<L.length;D+=1){var j=L[D],z=A.createNS("http://www.w3.org/2000/svg","ellipse");z.setAttributeNS(null,"opacity","0.04"),z.setAttributeNS(null,"cx","10.5"),z.setAttributeNS(null,"cy","5.80029008"),z.setAttributeNS(null,"rx",j.rx),z.setAttributeNS(null,"ry",j.ry),M.appendChild(z)}var W=A.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"fill",this._color);var te=A.createNS("http://www.w3.org/2000/svg","path");te.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),W.appendChild(te);var Q=A.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"fill","#000000");var ie=A.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Q.appendChild(ie);var K=A.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(6.0, 7.0)"),K.setAttributeNS(null,"fill","#FFFFFF");var J=A.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _e=A.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#000000"),_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962");var Ee=A.createNS("http://www.w3.org/2000/svg","circle");Ee.setAttributeNS(null,"fill","#FFFFFF"),Ee.setAttributeNS(null,"cx","5.5"),Ee.setAttributeNS(null,"cy","5.5"),Ee.setAttributeNS(null,"r","5.4999962"),J.appendChild(_e),J.appendChild(Ee),S.appendChild(M),S.appendChild(W),S.appendChild(Q),S.appendChild(K),S.appendChild(J),y.appendChild(S),y.setAttributeNS(null,"height",41*this._scale+"px"),y.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(y),this._offset=s.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ie){Ie.preventDefault()}),this._element.addEventListener("mousedown",function(Ie){Ie.preventDefault()}),un(this._element,this._anchor,"marker"),this._popup=null}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),A.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(c){return this._lngLat=s.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(c){var d=c.code,y=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&y!==32&&y!==13||this.togglePopup()},u.prototype._onMapClick=function(c){var d=c.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},u.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ls(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),A.setTransform(this._element,mo[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+y+" "+d)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(c){return this._offset=s.Point.convert(c),this._update(),this},u.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(s.Evented),nu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},_t=0,St=!1,su=function(l){function u(c){l.call(this),this.options=s.extend({},nu,c),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.onAdd=function(c){var d;return this._map=c,this._container=A.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Go!==void 0?d(Go):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(function(y){d(Go=y.state!=="denied")}):d(Go=!!s.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),A.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,_t=0,St=!1},u.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),y=c.coords;return d&&(y.longitude<d.getWest()||y.longitude>d.getEast()||y.latitude<d.getSouth()||y.latitude>d.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",c)),this._finish()}},u.prototype._updateCamera=function(c){var d=new s.LngLat(c.coords.longitude,c.coords.latitude),y=c.coords.accuracy,T=this._map.getBearing(),S=s.extend({bearing:T},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(y),S,{geolocateSource:!0})},u.prototype._updateMarker=function(c){if(c){var d=new s.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),y=this._map.unproject([1,c]),T=d.distanceTo(y),S=Math.ceil(2*this._accuracy/T);this._circleElement.style.width=S+"px",this._circleElement.style.height=S+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&St)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",c)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(S){return S.preventDefault()}),this._geolocateButton=A.create("button","mapboxgl-ctrl-geolocate",this._container),A.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y)}else{var T=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new _o(this._dotElement),this._circleElement=A.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _o({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(S){S.geolocateSource||d._watchState!=="ACTIVE_LOCK"||S.originalEvent&&S.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new s.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":_t--,St=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++_t>1?(c={maximumAge:6e5,timeout:0},St=!0):(c=this.options.positionOptions,St=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(s.Evented),yo={maxWidth:100,unit:"metric"},no=function(l){this.options=s.extend({},yo,l),s.bindAll(["_onMove","setUnit"],this)};function ka(l,u,c){var d=c&&c.maxWidth||100,y=l._container.clientHeight/2,T=l.unproject([0,y]),S=l.unproject([d,y]),M=T.distanceTo(S);if(c&&c.unit==="imperial"){var D=3.2808*M;D>5280?hs(u,d,D/5280,l._getUIString("ScaleControl.Miles")):hs(u,d,D,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?hs(u,d,M/1852,l._getUIString("ScaleControl.NauticalMiles")):M>=1e3?hs(u,d,M/1e3,l._getUIString("ScaleControl.Kilometers")):hs(u,d,M,l._getUIString("ScaleControl.Meters"))}function hs(l,u,c,d){var y,T,S,M=(y=c,(T=Math.pow(10,(""+Math.floor(y)).length-1))*(S=(S=y/T)>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(D){var L=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*L)/L}(S)));l.style.width=u*(M/c)+"px",l.innerHTML=M+"&nbsp;"+d}no.prototype.getDefaultPosition=function(){return"bottom-left"},no.prototype._onMove=function(){ka(this._map,this._container,this.options)},no.prototype.onAdd=function(l){return this._map=l,this._container=A.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},no.prototype.onRemove=function(){A.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},no.prototype.setUnit=function(l){this.options.unit=l,ka(this._map,this._container,this.options)};var bs=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof s.window.HTMLElement?this._container=l.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in s.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in s.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in s.window.document&&(this._fullscreenchange="MSFullscreenChange")};bs.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=A.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},bs.prototype.onRemove=function(){A.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},bs.prototype._checkFullscreenSupport=function(){return!!(s.window.document.fullscreenEnabled||s.window.document.mozFullScreenEnabled||s.window.document.msFullscreenEnabled||s.window.document.webkitFullscreenEnabled)},bs.prototype._setupUI=function(){var l=this._fullscreenButton=A.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);A.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},bs.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},bs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},bs.prototype._isFullscreen=function(){return this._fullscreen},bs.prototype._changeIcon=function(){(s.window.document.fullscreenElement||s.window.document.mozFullScreenElement||s.window.document.webkitFullscreenElement||s.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},bs.prototype._onClickFullscreen=function(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.mozCancelFullScreen?s.window.document.mozCancelFullScreen():s.window.document.msExitFullscreen?s.window.document.msExitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var vo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},m=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),g=function(l){function u(c){l.call(this),this.options=s.extend(Object.create(vo),c),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(u.__proto__=l),(u.prototype=Object.create(l&&l.prototype)).constructor=u,u.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&A.remove(this._content),this._container&&(A.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(c){return this._lngLat=s.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(c){return this.setDOMContent(s.window.document.createTextNode(c))},u.prototype.setHTML=function(c){var d,y=s.window.document.createDocumentFragment(),T=s.window.document.createElement("body");for(T.innerHTML=c;d=T.firstChild;)y.appendChild(d);return this.setDOMContent(y)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},u.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=A.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},u.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},u.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},u.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=A.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(c){this._update(c.point)},u.prototype._onMouseMove=function(c){this._update(c.point)},u.prototype._onDrag=function(c){this._update(c.point)},u.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=A.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=A.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(z){return d._container.classList.add(z)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ls(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var y=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),T=this.options.anchor,S=function z(W){if(W){if(typeof W=="number"){var te=Math.round(Math.sqrt(.5*Math.pow(W,2)));return{center:new s.Point(0,0),top:new s.Point(0,W),"top-left":new s.Point(te,te),"top-right":new s.Point(-te,te),bottom:new s.Point(0,-W),"bottom-left":new s.Point(te,-te),"bottom-right":new s.Point(-te,-te),left:new s.Point(W,0),right:new s.Point(-W,0)}}if(W instanceof s.Point||Array.isArray(W)){var Q=s.Point.convert(W);return{center:Q,top:Q,"top-left":Q,"top-right":Q,bottom:Q,"bottom-left":Q,"bottom-right":Q,left:Q,right:Q}}return{center:s.Point.convert(W.center||[0,0]),top:s.Point.convert(W.top||[0,0]),"top-left":s.Point.convert(W["top-left"]||[0,0]),"top-right":s.Point.convert(W["top-right"]||[0,0]),bottom:s.Point.convert(W.bottom||[0,0]),"bottom-left":s.Point.convert(W["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(W["bottom-right"]||[0,0]),left:s.Point.convert(W.left||[0,0]),right:s.Point.convert(W.right||[0,0])}}return z(new s.Point(0,0))}(this.options.offset);if(!T){var M,D=this._container.offsetWidth,L=this._container.offsetHeight;M=y.y+S.bottom.y<L?["top"]:y.y>this._map.transform.height-L?["bottom"]:[],y.x<D/2?M.push("left"):y.x>this._map.transform.width-D/2&&M.push("right"),T=M.length===0?"bottom":M.join("-")}var j=y.add(S[T]).round();A.setTransform(this._container,mo[T]+" translate("+j.x+"px,"+j.y+"px)"),un(this._container,T,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(m);c&&c.focus()}},u.prototype._onClose=function(){this.remove()},u}(s.Evented),b={version:s.version,supported:f,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:io,NavigationControl:go,GeolocateControl:su,AttributionControl:Un,ScaleControl:no,FullscreenControl:bs,Popup:g,Marker:_o,Style:os,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,config:s.config,prewarm:function(){qe().acquire(ke)},clearPrewarmedResources:function(){var l=ne;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(ke),ne=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(l){s.config.ACCESS_TOKEN=l},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(l){s.config.API_URL=l},get workerCount(){return _.workerCount},set workerCount(l){_.workerCount=l},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){s.clearTileCache(l)},workerUrl:""};return b}),n})})(R4);var Mq=R4.exports;const Wl=oA(Mq);var Rq=1e-7;function bb(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function B4(t,e){if(t===e)return!0;if(bb(t)&&bb(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(!B4(t[r],e[r]))return!1;return!0}return Math.abs(t-e)<=Rq}function bg(t,e,r){return Math.max(e,Math.min(r,t))}function Vm(t,e,r){return bb(t)?t.map(function(i,n){return Vm(i,e[n],r)}):r*e+(1-r)*t}function Ga(t,e){if(!t)throw new Error(e||"react-map-gl: assertion failed.")}function IC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function MC(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?IC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):IC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var Ph={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},Cv={pitch:0,bearing:0,altitude:1.5},RC=5,Bq=1.2,Ud=function(){function t(e){var r=e.width,i=e.height,n=e.latitude,o=e.longitude,s=e.zoom,f=e.bearing,A=f===void 0?Cv.bearing:f,v=e.pitch,w=v===void 0?Cv.pitch:v,C=e.altitude,I=C===void 0?Cv.altitude:C,B=e.maxZoom,F=B===void 0?Ph.maxZoom:B,N=e.minZoom,V=N===void 0?Ph.minZoom:N,G=e.maxPitch,Y=G===void 0?Ph.maxPitch:G,Z=e.minPitch,se=Z===void 0?Ph.minPitch:Z,ge=e.transitionDuration,Pe=e.transitionEasing,Ue=e.transitionInterpolator,Fe=e.transitionInterruption,pe=e.startPanLngLat,Te=e.startZoomLngLat,Ae=e.startRotatePos,Le=e.startBearing,Ve=e.startPitch,Xe=e.startZoom;Lu(this,t),Ga(Number.isFinite(r),"`width` must be supplied"),Ga(Number.isFinite(i),"`height` must be supplied"),Ga(Number.isFinite(o),"`longitude` must be supplied"),Ga(Number.isFinite(n),"`latitude` must be supplied"),Ga(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:r,height:i,latitude:n,longitude:o,zoom:s,bearing:A,pitch:w,altitude:I,maxZoom:F,minZoom:V,maxPitch:Y,minPitch:se,transitionDuration:ge,transitionEasing:Pe,transitionInterpolator:Ue,transitionInterruption:Fe}),this._state={startPanLngLat:pe,startZoomLngLat:Te,startRotatePos:Ae,startBearing:Le,startPitch:Ve,startZoom:Xe}}return Fu(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(r){var i=r.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(i)})}},{key:"pan",value:function(r){var i=r.pos,n=r.startPos,o=this._state.startPanLngLat||this._unproject(n);if(!o)return this;var s=this._calculateNewLngLat({startPanLngLat:o,pos:i}),f=Gn(s,2),A=f[0],v=f[1];return this._getUpdatedMapState({longitude:A,latitude:v})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(r){var i=r.pos;return this._getUpdatedMapState({startRotatePos:i,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(r){var i=r.pos,n=r.deltaAngleX,o=n===void 0?0:n,s=r.deltaAngleY,f=s===void 0?0:s,A=this._state,v=A.startRotatePos,w=A.startBearing,C=A.startPitch;if(!Number.isFinite(w)||!Number.isFinite(C))return this;var I;return i?I=this._calculateNewPitchAndBearing(MC(MC({},this._getRotationParams(i,v)),{},{startBearing:w,startPitch:C})):I={bearing:w+o,pitch:C+f},this._getUpdatedMapState(I)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(r){var i=r.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(i),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(r){var i=r.pos,n=r.startPos,o=r.scale;Ga(o>0,"`scale` must be a positive number");var s=this._state,f=s.startZoom,A=s.startZoomLngLat;Number.isFinite(f)||(f=this._viewportProps.zoom,A=this._unproject(n)||this._unproject(i)),Ga(A,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var v=this._calculateNewZoom({scale:o,startZoom:f||0}),w=new jl(Object.assign({},this._viewportProps,{zoom:v})),C=w.getMapCenterByLngLatPosition({lngLat:A,pos:i}),I=Gn(C,2),B=I[0],F=I[1];return this._getUpdatedMapState({zoom:v,longitude:B,latitude:F})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(r){return new t(Object.assign({},this._viewportProps,this._state,r))}},{key:"_applyConstraints",value:function(r){var i=r.maxZoom,n=r.minZoom,o=r.zoom;r.zoom=bg(o,n,i);var s=r.maxPitch,f=r.minPitch,A=r.pitch;return r.pitch=bg(A,f,s),Object.assign(r,iq(r)),r}},{key:"_unproject",value:function(r){var i=new jl(this._viewportProps);return r&&i.unproject(r)}},{key:"_calculateNewLngLat",value:function(r){var i=r.startPanLngLat,n=r.pos,o=new jl(this._viewportProps);return o.getMapCenterByLngLatPosition({lngLat:i,pos:n})}},{key:"_calculateNewZoom",value:function(r){var i=r.scale,n=r.startZoom,o=this._viewportProps,s=o.maxZoom,f=o.minZoom,A=n+Math.log2(i);return bg(A,f,s)}},{key:"_calculateNewPitchAndBearing",value:function(r){var i=r.deltaScaleX,n=r.deltaScaleY,o=r.startBearing,s=r.startPitch;n=bg(n,-1,1);var f=this._viewportProps,A=f.minPitch,v=f.maxPitch,w=o+180*i,C=s;return n>0?C=s+n*(v-s):n<0&&(C=s-n*(A-s)),{pitch:C,bearing:w}}},{key:"_getRotationParams",value:function(r,i){var n=r[0]-i[0],o=r[1]-i[1],s=r[1],f=i[1],A=this._viewportProps,v=A.width,w=A.height,C=n/v,I=0;return o>0?Math.abs(w-f)>RC&&(I=o/(f-w)*Bq):o<0&&f>RC&&(I=1-s/f),I=Math.min(1,Math.max(-1,I)),{deltaScaleX:C,deltaScaleY:I}}}]),t}();function Oq(t){return t[0].toLowerCase()+t.slice(1)}function Dq(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ph;for(var r in e){var i=r.slice(0,3),n=Oq(r.slice(3));if(i==="min"&&t[n]<e[r]||i==="max"&&t[n]>e[r])return!1}return!0}function BC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function OC(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?BC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):BC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var qh=it.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),Y2=qh.Provider;function Fq(t){var e=t.value,r=t.children,i=it.useState(null),n=Gn(i,2),o=n[0],s=n[1],f=it.useContext(qh);return e=OC(OC({setMap:s},f),{},{map:f&&f.map||o},e),it.createElement(Y2,{value:e},r)}qh.Provider=Fq;var xb=typeof window<"u"?it.useLayoutEffect:it.useEffect;function DC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function Ha(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?DC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):DC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var Lq="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",O4="A valid API access token is required to use Mapbox data";function kq(){}function D4(t){var e=t.props,r=t.width,i=t.height;return new jl(Ha(Ha(Ha({},e),e.viewState),{},{width:r,height:i}))}var Nq=401,FC={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},Uq=Object.assign({},Xh.propTypes,{width:$e.oneOfType([$e.number,$e.string]),height:$e.oneOfType([$e.number,$e.string]),onResize:$e.func,disableTokenWarning:$e.bool,visible:$e.bool,className:$e.string,style:$e.object,visibilityConstraints:$e.object}),zq=Object.assign({},Xh.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:kq,className:"",style:null,visibilityConstraints:Ph});function Vq(){var t={position:"absolute",left:0,top:0};return it.createElement("div",{key:"warning",id:"no-token-warning",style:t},it.createElement("h3",{key:"header"},O4),it.createElement("div",{key:"text"},"For information on setting up your basemap, read"),it.createElement("a",{key:"link",href:Lq},"Note on Map Tokens"))}function jq(t){return{getMap:function(){return t.current&&t.current.getMap()},queryRenderedFeatures:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.current&&t.current.getMap();return n&&n.queryRenderedFeatures(r,i)}}}var Fc=it.forwardRef(function(t,e){var r=it.useState(!0),i=Gn(r,2),n=i[0],o=i[1],s=it.useState({width:0,height:0}),f=Gn(s,2),A=f[0],v=f[1],w=it.useRef(null),C=it.useRef(null),I=it.useRef(null),B=it.useRef(null),F=it.useContext(qh);xb(function(){if(Fc.supported()){var Te=new Xh(Ha(Ha(Ha({},t),A),{},{mapboxgl:Wl,container:C.current,onError:function(Ve){var Xe=Ve.error&&Ve.error.status||Ve.status;Xe===Nq&&n&&(console.error(O4),o(!1)),t.onError(Ve)}}));w.current=Te,F&&F.setMap&&F.setMap(Te.getMap());var Ae=new Tq(function(Le){if(Le[0].contentRect){var Ve=Le[0].contentRect,Xe=Ve.width,dt=Ve.height;v({width:Xe,height:dt}),t.onResize({width:Xe,height:dt})}});return Ae.observe(I.current),function(){Te.finalize(),w.current=null,Ae.disconnect()}}},[]),xb(function(){w.current&&w.current.setProps(Ha(Ha({},t),A))});var N=w.current&&w.current.getMap();it.useImperativeHandle(e,function(){return jq(w)},[]);var V=it.useCallback(function(Te){var Ae=Te.target;Ae===B.current&&Ae.scrollTo(0,0)},[]),G=N&&it.createElement(Y2,{value:Ha(Ha({},F),{},{viewport:F.viewport||D4(Ha({map:N,props:t},A)),map:N,container:F.container||I.current})},it.createElement("div",{key:"map-overlays",className:"overlays",ref:B,style:FC,onScroll:V},t.children)),Y=t.className,Z=t.width,se=t.height,ge=t.style,Pe=t.visibilityConstraints,Ue=Object.assign({position:"relative"},ge,{width:Z,height:se}),Fe=t.visible&&Dq(t.viewState||t,Pe),pe=Object.assign({},FC,{visibility:Fe?"inherit":"hidden"});return it.createElement("div",{key:"map-container",ref:I,style:Ue},it.createElement("div",{key:"map-mapbox",ref:C,style:pe,className:Y}),G,!n&&!t.disableTokenWarning&&it.createElement(Vq,null))});Fc.supported=function(){return Wl&&Wl.supported()};Fc.propTypes=Uq;Fc.defaultProps=zq;function Hq(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=Gq(t))||e){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(v){throw v},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,f;return{s:function(){r=t[Symbol.iterator]()},n:function(){var v=r.next();return o=v.done,v},e:function(v){s=!0,f=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw f}}}}function Gq(t,e){if(t){if(typeof t=="string")return LC(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return LC(t,e)}}function LC(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}var F4=function(){function t(){Lu(this,t),Wt(this,"propNames",[])}return Fu(t,[{key:"arePropsEqual",value:function(r,i){var n=Hq(this.propNames||[]),o;try{for(n.s();!(o=n.n()).done;){var s=o.value;if(!B4(r[s],i[s]))return!1}}catch(f){n.e(f)}finally{n.f()}return!0}},{key:"initializeProps",value:function(r,i){return{start:r,end:i}}},{key:"interpolateProps",value:function(r,i,n){Ga(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(r,i){return i.transitionDuration}}]),t}(),Wq={longitude:1,bearing:1};function jm(t){return Number.isFinite(t)||Array.isArray(t)}function Xq(t){return t in Wq}function wb(t,e,r){return Xq(t)&&Math.abs(r-e)>180&&(r=r<0?r+360:r-360),r}function Pv(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=qq(t))||e){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(v){throw v},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,f;return{s:function(){r=t[Symbol.iterator]()},n:function(){var v=r.next();return o=v.done,v},e:function(v){s=!0,f=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw f}}}}function qq(t,e){if(t){if(typeof t=="string")return kC(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kC(t,e)}}function kC(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function $q(t){var e=Zq();return function(){var i=Gd(t),n;if(e){var o=Gd(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return l2(this,n)}}function Zq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Kq=["longitude","latitude","zoom","bearing","pitch"],Yq=["latitude","longitude","zoom","width","height"],NC=["bearing","pitch"],Jq={speed:1.2,curve:1.414};(function(t){a2(r,t);var e=$q(r);function r(){var i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Lu(this,r),i=e.call(this),Wt(yu(i),"propNames",Kq),i.props=Object.assign({},Jq,n),i}return Fu(r,[{key:"initializeProps",value:function(n,o){var s={},f={},A=Pv(Yq),v;try{for(A.s();!(v=A.n()).done;){var w=v.value,C=n[w],I=o[w];Ga(jm(C)&&jm(I),"".concat(w," must be supplied for transition")),s[w]=C,f[w]=wb(w,C,I)}}catch(Y){A.e(Y)}finally{A.f()}var B=Pv(NC),F;try{for(B.s();!(F=B.n()).done;){var N=F.value,V=n[N]||0,G=o[N]||0;s[N]=V,f[N]=wb(N,V,G)}}catch(Y){B.e(Y)}finally{B.f()}return{start:s,end:f}}},{key:"interpolateProps",value:function(n,o,s){var f=sq(n,o,s,this.props),A=Pv(NC),v;try{for(A.s();!(v=A.n()).done;){var w=v.value;f[w]=Vm(n[w],o[w],s)}}catch(C){A.e(C)}finally{A.f()}return f}},{key:"getDuration",value:function(n,o){var s=o.transitionDuration;return s==="auto"&&(s=oq(n,o,this.props)),s}}]),r})(F4);function UC(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=Qq(t))||e){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(v){throw v},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,f;return{s:function(){r=t[Symbol.iterator]()},n:function(){var v=r.next();return o=v.done,v},e:function(v){s=!0,f=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw f}}}}function Qq(t,e){if(t){if(typeof t=="string")return zC(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zC(t,e)}}function zC(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function e$(t){var e=t$();return function(){var i=Gd(t),n;if(e){var o=Gd(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return l2(this,n)}}function t$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var r$=["longitude","latitude","zoom","bearing","pitch"],Ep=function(t){a2(r,t);var e=e$(r);function r(){var i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Lu(this,r),i=e.call(this),Array.isArray(n)&&(n={transitionProps:n}),i.propNames=n.transitionProps||r$,n.around&&(i.around=n.around),i}return Fu(r,[{key:"initializeProps",value:function(n,o){var s={},f={};if(this.around){s.around=this.around;var A=new jl(n).unproject(this.around);Object.assign(f,o,{around:new jl(o).project(A),aroundLngLat:A})}var v=UC(this.propNames),w;try{for(v.s();!(w=v.n()).done;){var C=w.value,I=n[C],B=o[C];Ga(jm(I)&&jm(B),"".concat(C," must be supplied for transition")),s[C]=I,f[C]=wb(C,I,B)}}catch(F){v.e(F)}finally{v.f()}return{start:s,end:f}}},{key:"interpolateProps",value:function(n,o,s){var f={},A=UC(this.propNames),v;try{for(A.s();!(v=A.n()).done;){var w=v.value;f[w]=Vm(n[w],o[w],s)}}catch(N){A.e(N)}finally{A.f()}if(o.around){var C=new jl(Object.assign({},o,f)).getMapCenterByLngLatPosition({lngLat:o.aroundLngLat,pos:Vm(n.around,o.around,s)}),I=Gn(C,2),B=I[0],F=I[1];f.longitude=B,f.latitude=F}return f}}]),r}(F4),Sp=function(){};function i$(t,e){var r=t(e);return function(i){return 1/(1-r)*(t(i*(1-e)+e)-r)}}var Cp={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},n$={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new Ep,transitionInterruption:Cp.BREAK,onTransitionStart:Sp,onTransitionInterrupt:Sp,onTransitionEnd:Sp},J2=function(){function t(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Lu(this,t),Wt(this,"_animationFrame",null),Wt(this,"_onTransitionFrame",function(){e._animationFrame=requestAnimationFrame(e._onTransitionFrame),e._updateViewport()}),this.props=null,this.onViewportChange=r.onViewportChange||Sp,this.onStateChange=r.onStateChange||Sp,this.time=r.getTime||Date.now}return Fu(t,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(r){var i=this.props;if(this.props=r,!i||this._shouldIgnoreViewportChange(i,r))return!1;if(this._isTransitionEnabled(r)){var n=Object.assign({},i),o=Object.assign({},r);if(this._isTransitionInProgress()&&(i.onTransitionInterrupt(),this.state.interruption===Cp.SNAP_TO_END?Object.assign(n,this.state.endProps):Object.assign(n,this.state.propsInTransition),this.state.interruption===Cp.UPDATE)){var s=this.time(),f=(s-this.state.startTime)/this.state.duration;o.transitionDuration=this.state.duration-(s-this.state.startTime),o.transitionEasing=i$(this.state.easing,f),o.transitionInterpolator=n.transitionInterpolator}return o.onTransitionStart(),this._triggerTransition(n,o),!0}return this._isTransitionInProgress()&&(i.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(r){var i=r.transitionDuration,n=r.transitionInterpolator;return(i>0||i==="auto")&&!!n}},{key:"_isUpdateDueToCurrentTransition",value:function(r){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(r,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(r,i){return r?this._isTransitionInProgress()?this.state.interruption===Cp.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(r,i):!0:!0}},{key:"_triggerTransition",value:function(r,i){Ga(this._isTransitionEnabled(i)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var n=i.transitionInterpolator,o=n.getDuration?n.getDuration(r,i):i.transitionDuration;if(o!==0){var s=i.transitionInterpolator.initializeProps(r,i),f={inTransition:!0,isZooming:r.zoom!==i.zoom,isPanning:r.longitude!==i.longitude||r.latitude!==i.latitude,isRotating:r.bearing!==i.bearing||r.pitch!==i.pitch};this.state={duration:o,easing:i.transitionEasing,interpolator:i.transitionInterpolator,interruption:i.transitionInterruption,startTime:this.time(),startProps:s.start,endProps:s.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(f)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var r=this.time(),i=this.state,n=i.startTime,o=i.duration,s=i.easing,f=i.interpolator,A=i.startProps,v=i.endProps,w=!1,C=(r-n)/o;C>=1&&(C=1,w=!0),C=s(C);var I=f.interpolateProps(A,v,C),B=new Ud(Object.assign({},this.props,I));this.state.propsInTransition=B.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),w&&(this._endTransition(),this.props.onTransitionEnd())}}]),t}();Wt(J2,"defaultProps",n$);function VC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function ao(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?VC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):VC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var gh={transitionDuration:0},yc={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new Ep,transitionInterruption:Cp.BREAK},xg=300,wg=function(e){return 1-(1-e)*(1-e)},Jf={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},L4=function(){function t(){var e=this;Lu(this,t),Wt(this,"events",[]),Wt(this,"scrollZoom",!0),Wt(this,"dragPan",!0),Wt(this,"dragRotate",!0),Wt(this,"doubleClickZoom",!0),Wt(this,"touchZoom",!0),Wt(this,"touchRotate",!1),Wt(this,"keyboard",!0),Wt(this,"_interactionState",{isDragging:!1}),Wt(this,"_events",{}),Wt(this,"_setInteractionState",function(r){Object.assign(e._interactionState,r),e.onStateChange&&e.onStateChange(e._interactionState)}),Wt(this,"_onTransition",function(r,i){e.onViewportChange(r,e._interactionState,i)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new J2({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return Fu(t,[{key:"handleEvent",value:function(r){this.mapState=this.getMapState();var i=this._eventStartBlocked;switch(r.type){case"panstart":return i?!1:this._onPanStart(r);case"panmove":return this._onPan(r);case"panend":return this._onPanEnd(r);case"pinchstart":return i?!1:this._onPinchStart(r);case"pinchmove":return this._onPinch(r);case"pinchend":return this._onPinchEnd(r);case"tripanstart":return i?!1:this._onTriplePanStart(r);case"tripanmove":return this._onTriplePan(r);case"tripanend":return this._onTriplePanEnd(r);case"doubletap":return this._onDoubleTap(r);case"wheel":return this._onWheel(r);case"keydown":return this._onKeyDown(r);default:return!1}}},{key:"getCenter",value:function(r){var i=r.offsetCenter,n=i.x,o=i.y;return[n,o]}},{key:"isFunctionKeyPressed",value:function(r){var i=r.srcEvent;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}},{key:"blockEvents",value:function(r){var i=this,n=setTimeout(function(){i._eventStartBlocked===n&&(i._eventStartBlocked=null)},r);this._eventStartBlocked=n}},{key:"updateViewport",value:function(r,i,n){var o=this.mapState instanceof Ud?this.mapState.getViewportProps():this.mapState,s=ao(ao({},r.getViewportProps()),i),f=Object.keys(s).some(function(A){return o[A]!==s[A]});this._state=r.getState(),this._setInteractionState(n),f&&this.onViewportChange(s,this._interactionState,o)}},{key:"getMapState",value:function(r){return new Ud(ao(ao(ao({},this.mapStateProps),this._state),r))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(r){var i=r.onViewportChange,n=r.onStateChange,o=r.eventManager,s=o===void 0?this.eventManager:o,f=r.isInteractive,A=f===void 0?!0:f,v=r.scrollZoom,w=v===void 0?this.scrollZoom:v,C=r.dragPan,I=C===void 0?this.dragPan:C,B=r.dragRotate,F=B===void 0?this.dragRotate:B,N=r.doubleClickZoom,V=N===void 0?this.doubleClickZoom:N,G=r.touchZoom,Y=G===void 0?this.touchZoom:G,Z=r.touchRotate,se=Z===void 0?this.touchRotate:Z,ge=r.keyboard,Pe=ge===void 0?this.keyboard:ge;this.onViewportChange=i,this.onStateChange=n;var Ue=this.mapStateProps||{},Fe=Ue.height!==r.height||Ue.width!==r.width;this.mapStateProps=r,Fe&&(this.mapState=Ue,this.updateViewport(new Ud(r))),this._transitionManager.processViewportChange(r),this.eventManager!==s&&(this.eventManager=s,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(Jf.WHEEL,A&&!!w),this.toggleEvents(Jf.PAN,A&&!!(I||F)),this.toggleEvents(Jf.PINCH,A&&!!(Y||se)),this.toggleEvents(Jf.TRIPLE_PAN,A&&!!se),this.toggleEvents(Jf.DOUBLE_TAP,A&&!!V),this.toggleEvents(Jf.KEYBOARD,A&&!!Pe),this.scrollZoom=w,this.dragPan=I,this.dragRotate=F,this.doubleClickZoom=V,this.touchZoom=Y,this.touchRotate=se,this.keyboard=Pe}},{key:"toggleEvents",value:function(r,i){var n=this;this.eventManager&&r.forEach(function(o){n._events[o]!==i&&(n._events[o]=i,i?n.eventManager.on(o,n.handleEvent):n.eventManager.off(o,n.handleEvent))})}},{key:"_onPanStart",value:function(r){var i=this.getCenter(r);this._panRotate=this.isFunctionKeyPressed(r)||r.rightButton;var n=this._panRotate?this.mapState.rotateStart({pos:i}):this.mapState.panStart({pos:i});return this.updateViewport(n,gh,{isDragging:!0}),!0}},{key:"_onPan",value:function(r){return this.isDragging()?this._panRotate?this._onPanRotate(r):this._onPanMove(r):!1}},{key:"_onPanEnd",value:function(r){return this.isDragging()?this._panRotate?this._onPanRotateEnd(r):this._onPanMoveEnd(r):!1}},{key:"_onPanMove",value:function(r){if(!this.dragPan)return!1;var i=this.getCenter(r),n=this.mapState.pan({pos:i});return this.updateViewport(n,gh,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(r){if(this.dragPan){var i=this.dragPan.inertia,n=i===void 0?xg:i;if(n&&r.velocity){var o=this.getCenter(r),s=[o[0]+r.velocityX*n/2,o[1]+r.velocityY*n/2],f=this.mapState.pan({pos:s}).panEnd();return this.updateViewport(f,ao(ao({},yc),{},{transitionDuration:n,transitionEasing:wg}),{isDragging:!1,isPanning:!0}),!0}}var A=this.mapState.panEnd();return this.updateViewport(A,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(r){if(!this.dragRotate)return!1;var i=this.getCenter(r),n=this.mapState.rotate({pos:i});return this.updateViewport(n,gh,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(r){if(this.dragRotate){var i=this.dragRotate.inertia,n=i===void 0?xg:i;if(n&&r.velocity){var o=this.getCenter(r),s=[o[0]+r.velocityX*n/2,o[1]+r.velocityY*n/2],f=this.mapState.rotate({pos:s}).rotateEnd();return this.updateViewport(f,ao(ao({},yc),{},{transitionDuration:n,transitionEasing:wg}),{isDragging:!1,isRotating:!0}),!0}}var A=this.mapState.panEnd();return this.updateViewport(A,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(r){if(!this.scrollZoom)return!1;var i=this.scrollZoom,n=i.speed,o=n===void 0?.01:n,s=i.smooth,f=s===void 0?!1:s;r.preventDefault();var A=this.getCenter(r),v=r.delta,w=2/(1+Math.exp(-Math.abs(v*o)));v<0&&w!==0&&(w=1/w);var C=this.mapState.zoom({pos:A,scale:w});return C.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(C,ao(ao({},yc),{},{transitionInterpolator:new Ep({around:A}),transitionDuration:f?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(r){var i=this.getCenter(r),n=this.mapState.zoomStart({pos:i}).rotateStart({pos:i});return this._startPinchRotation=r.rotation,this._lastPinchEvent=r,this.updateViewport(n,gh,{isDragging:!0}),!0}},{key:"_onPinch",value:function(r){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var i=this.mapState;if(this.touchZoom){var n=r.scale,o=this.getCenter(r);i=i.zoom({pos:o,scale:n})}if(this.touchRotate){var s=r.rotation;i=i.rotate({deltaAngleX:this._startPinchRotation-s})}return this.updateViewport(i,gh,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=r,!0}},{key:"_onPinchEnd",value:function(r){if(!this.isDragging())return!1;if(this.touchZoom){var i=this.touchZoom.inertia,n=i===void 0?xg:i,o=this._lastPinchEvent;if(n&&o&&r.scale!==o.scale){var s=this.getCenter(r),f=this.mapState.rotateEnd(),A=Math.log2(r.scale),v=(A-Math.log2(o.scale))/(r.deltaTime-o.deltaTime),w=Math.pow(2,A+v*n/2);return f=f.zoom({pos:s,scale:w}).zoomEnd(),this.updateViewport(f,ao(ao({},yc),{},{transitionInterpolator:new Ep({around:s}),transitionDuration:n,transitionEasing:wg}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(n),!0}}var C=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(C,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(r){var i=this.getCenter(r),n=this.mapState.rotateStart({pos:i});return this.updateViewport(n,gh,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(r){if(!this.isDragging()||!this.touchRotate)return!1;var i=this.getCenter(r);i[0]-=r.deltaX;var n=this.mapState.rotate({pos:i});return this.updateViewport(n,gh,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(r){if(!this.isDragging())return!1;if(this.touchRotate){var i=this.touchRotate.inertia,n=i===void 0?xg:i;if(n&&r.velocityY){var o=this.getCenter(r),s=[o[0],o[1]+=r.velocityY*n/2],f=this.mapState.rotate({pos:s});return this.updateViewport(f,ao(ao({},yc),{},{transitionDuration:n,transitionEasing:wg}),{isDragging:!1,isRotating:!0}),this.blockEvents(n),!1}}var A=this.mapState.rotateEnd();return this.updateViewport(A,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(r){if(!this.doubleClickZoom)return!1;var i=this.getCenter(r),n=this.isFunctionKeyPressed(r),o=this.mapState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(o,Object.assign({},yc,{transitionInterpolator:new Ep({around:i})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(r){if(!this.keyboard)return!1;var i=this.isFunctionKeyPressed(r),n=this.keyboard,o=n.zoomSpeed,s=o===void 0?2:o,f=n.moveSpeed,A=f===void 0?100:f,v=n.rotateSpeedX,w=v===void 0?15:v,C=n.rotateSpeedY,I=C===void 0?10:C,B=this.mapStateProps,F;switch(r.srcEvent.keyCode){case 189:i?F=this.getMapState({zoom:B.zoom-Math.log2(s)-1}):F=this.getMapState({zoom:B.zoom-Math.log2(s)});break;case 187:i?F=this.getMapState({zoom:B.zoom+Math.log2(s)+1}):F=this.getMapState({zoom:B.zoom+Math.log2(s)});break;case 37:i?F=this.getMapState({bearing:B.bearing-w}):F=this.mapState.pan({pos:[A,0],startPos:[0,0]});break;case 39:i?F=this.getMapState({bearing:B.bearing+w}):F=this.mapState.pan({pos:[-A,0],startPos:[0,0]});break;case 38:i?F=this.getMapState({pitch:B.pitch+I}):F=this.mapState.pan({pos:[0,A],startPos:[0,0]});break;case 40:i?F=this.getMapState({pitch:B.pitch-I}):F=this.mapState.pan({pos:[0,-A],startPos:[0,0]});break;default:return!1}return this.updateViewport(F,yc)}}]),t}();function jC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function gc(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?jC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):jC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var s$=Object.assign({},Fc.propTypes,{maxZoom:$e.number,minZoom:$e.number,maxPitch:$e.number,minPitch:$e.number,onViewStateChange:$e.func,onViewportChange:$e.func,onInteractionStateChange:$e.func,transitionDuration:$e.oneOfType([$e.number,$e.string]),transitionInterpolator:$e.object,transitionInterruption:$e.number,transitionEasing:$e.func,onTransitionStart:$e.func,onTransitionInterrupt:$e.func,onTransitionEnd:$e.func,scrollZoom:$e.oneOfType([$e.bool,$e.object]),dragPan:$e.oneOfType([$e.bool,$e.object]),dragRotate:$e.oneOfType([$e.bool,$e.object]),doubleClickZoom:$e.bool,touchZoom:$e.oneOfType([$e.bool,$e.object]),touchRotate:$e.oneOfType([$e.bool,$e.object]),keyboard:$e.oneOfType([$e.bool,$e.object]),onHover:$e.func,onClick:$e.func,onDblClick:$e.func,onContextMenu:$e.func,onMouseDown:$e.func,onMouseMove:$e.func,onMouseUp:$e.func,onTouchStart:$e.func,onTouchMove:$e.func,onTouchEnd:$e.func,onMouseEnter:$e.func,onMouseLeave:$e.func,onMouseOut:$e.func,onWheel:$e.func,touchAction:$e.string,eventRecognizerOptions:$e.object,clickRadius:$e.number,interactiveLayerIds:$e.array,getCursor:$e.func,controller:$e.instanceOf(L4)}),o$=function(e){var r=e.isDragging,i=e.isHovering;return r?"grabbing":i?"pointer":"grab"},a$=Object.assign({},Fc.defaultProps,Ph,J2.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:o$});function Q2(t){if(t.lngLat||!t.offsetCenter)return t;var e=t.offsetCenter,r=e.x,i=e.y;if(!Number.isFinite(r)||!Number.isFinite(i))return t;var n=[r,i];return t.point=n,t.lngLat=this.viewport.unproject(n),t}function k4(t){var e=this.map;if(!e||!t)return null;var r={},i=this.props.clickRadius;this.props.interactiveLayerIds&&(r.layers=this.props.interactiveLayerIds);try{return e.queryRenderedFeatures(i?[[t[0]-i,t[1]+i],[t[0]+i,t[1]-i]]:t,r)}catch{return null}}function Ec(t,e){var r=this.props[t];r&&r(Q2.call(this,e))}function l$(t){Ec.call(this,t.pointerType==="touch"?"onTouchStart":"onMouseDown",t)}function c$(t){Ec.call(this,t.pointerType==="touch"?"onTouchEnd":"onMouseUp",t)}function u$(t){if(Ec.call(this,t.pointerType==="touch"?"onTouchMove":"onMouseMove",t),!this.state.isDragging){var e=this.props,r=e.onHover,i=e.interactiveLayerIds,n;t=Q2.call(this,t),(i||r)&&(n=k4.call(this,t.point));var o=!!(i&&n&&n.length>0),s=o&&!this.state.isHovering,f=!o&&this.state.isHovering;(r||s)&&(t.features=n,r&&r(t)),s&&Ec.call(this,"onMouseEnter",t),f&&Ec.call(this,"onMouseLeave",t),(s||f)&&this.setState({isHovering:o})}}function HC(t){var e=this.props,r=e.onClick,i=e.onNativeClick,n=e.onDblClick,o=e.doubleClickZoom,s=[],f=n||o;switch(t.type){case"anyclick":s.push(i),f||s.push(r);break;case"click":f&&s.push(r);break}s=s.filter(Boolean),s.length&&(t=Q2.call(this,t),t.features=k4.call(this,t.point),s.forEach(function(A){return A(t)}))}function h$(t){return{getMap:t.current&&t.current.getMap,queryRenderedFeatures:t.current&&t.current.queryRenderedFeatures}}var ex=it.forwardRef(function(t,e){var r=it.useContext(qh),i=it.useMemo(function(){return t.controller||new L4},[]),n=it.useMemo(function(){return new e4(null,{touchAction:t.touchAction,recognizerOptions:t.eventRecognizerOptions})},[]),o=it.useRef(null),s=it.useRef(null),f=it.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),A=f.current;A.props=t,A.map=s.current&&s.current.getMap(),A.setState=function(Pe){A.state=gc(gc({},A.state),Pe),o.current.style.cursor=t.getCursor(A.state)};var v=!0,w,C,I=function(Ue,Fe,pe){if(v){w=[Ue,Fe,pe];return}var Te=A.props,Ae=Te.onViewStateChange,Le=Te.onViewportChange;Ae&&Ae({viewState:Ue,interactionState:Fe,oldViewState:pe}),Le&&Le(Ue,Fe,pe)};it.useImperativeHandle(e,function(){return h$(s)},[]);var B=it.useMemo(function(){return gc(gc({},r),{},{eventManager:n,container:r.container||o.current})},[r,o.current]);B.onViewportChange=I,B.viewport=r.viewport||D4(A),A.viewport=B.viewport;var F=function(Ue){var Fe=Ue.isDragging,pe=Fe===void 0?!1:Fe;if(pe!==A.state.isDragging&&A.setState({isDragging:pe}),v){C=Ue;return}var Te=A.props.onInteractionStateChange;Te&&Te(Ue)},N=function(){A.width&&A.height&&i.setOptions(gc(gc(gc({},A.props),A.props.viewState),{},{isInteractive:!!(A.props.onViewStateChange||A.props.onViewportChange),onViewportChange:I,onStateChange:F,eventManager:n,width:A.width,height:A.height}))},V=function(Ue){var Fe=Ue.width,pe=Ue.height;A.width=Fe,A.height=pe,N(),A.props.onResize({width:Fe,height:pe})};it.useEffect(function(){return n.setElement(o.current),n.on({pointerdown:l$.bind(A),pointermove:u$.bind(A),pointerup:c$.bind(A),pointerleave:Ec.bind(A,"onMouseOut"),click:HC.bind(A),anyclick:HC.bind(A),dblclick:Ec.bind(A,"onDblClick"),wheel:Ec.bind(A,"onWheel"),contextmenu:Ec.bind(A,"onContextMenu")}),function(){n.destroy()}},[]),xb(function(){w&&I.apply(void 0,TL(w)),C&&F(C)}),N();var G=t.width,Y=t.height,Z=t.style,se=t.getCursor,ge=it.useMemo(function(){return gc(gc({position:"relative"},Z),{},{width:G,height:Y,cursor:se(A.state)})},[Z,G,Y,se,A.state]);return(!w||!A._child)&&(A._child=it.createElement(Y2,{value:B},it.createElement("div",{key:"event-canvas",ref:o,style:ge},it.createElement(Fc,jM({},t,{width:"100%",height:"100%",style:null,onResize:V,ref:s}))))),v=!1,A._child});ex.supported=Fc.supported;ex.propTypes=s$;ex.defaultProps=a$;$e.string.isRequired,$e.string;var f$=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];$e.oneOf(f$).isRequired,$e.string,$e.string,$e.string;var Nu={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},sl={captureScroll:$e.bool,captureDrag:$e.bool,captureClick:$e.bool,captureDoubleClick:$e.bool,capturePointerMove:$e.bool};function d$(t){var e=t.containerRef.current,r=t.context.eventManager;if(!(!e||!r)){var i={wheel:function(o){var s=t.props;s.captureScroll&&o.stopPropagation(),s.onScroll&&s.onScroll(o,t)},panstart:function(o){var s=t.props;s.captureDrag&&o.stopPropagation(),s.onDragStart&&s.onDragStart(o,t)},anyclick:function(o){var s=t.props;s.captureClick&&o.stopPropagation(),s.onNativeClick&&s.onNativeClick(o,t)},click:function(o){var s=t.props;s.captureClick&&o.stopPropagation(),s.onClick&&s.onClick(o,t)},dblclick:function(o){var s=t.props;s.captureDoubleClick&&o.stopPropagation(),s.onDoubleClick&&s.onDoubleClick(o,t)},pointermove:function(o){var s=t.props;s.capturePointerMove&&o.stopPropagation(),s.onPointerMove&&s.onPointerMove(o,t)}};return r.watch(i,e),function(){r.off(i)}}}function Uu(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=it.useContext(qh),r=it.useRef(null),i=it.useRef({props:t,state:{},context:e,containerRef:r}),n=i.current;return n.props=t,n.context=e,it.useEffect(function(){return d$(n)},[e.eventManager]),n}function A$(t){var e=p$();return function(){var i=Gd(t),n;if(e){var o=Gd(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return l2(this,n)}}function p$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function g$(t){var e=t.instance,r=Uu(t),i=r.context,n=r.containerRef;return e._context=i,e._containerRef=n,e._render()}var N4=function(t){a2(r,t);var e=A$(r);function r(){var i;Lu(this,r);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return i=e.call.apply(e,[this].concat(o)),Wt(yu(i),"_context",{}),Wt(yu(i),"_containerRef",it.createRef()),Wt(yu(i),"_onScroll",function(f){}),Wt(yu(i),"_onDragStart",function(f){}),Wt(yu(i),"_onDblClick",function(f){}),Wt(yu(i),"_onClick",function(f){}),Wt(yu(i),"_onPointerMove",function(f){}),i}return Fu(r,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return it.createElement(g$,jM({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),r}(it.PureComponent);Wt(N4,"propTypes",sl);Wt(N4,"defaultProps",Nu);function GC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function WC(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?GC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):GC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var m$=Object.assign({},sl,{draggable:$e.bool,onDrag:$e.func,onDragEnd:$e.func,onDragStart:$e.func,offsetLeft:$e.number,offsetTop:$e.number}),_$=Object.assign({},Nu,{draggable:!1,offsetLeft:0,offsetTop:0});function U4(t){var e=t.offsetCenter,r=e.x,i=e.y;return[r,i]}function y$(t,e){var r=t.center,i=r.x,n=r.y;if(e){var o=e.getBoundingClientRect();return[o.left-i,o.top-n]}return null}function tx(t,e,r,i){var n=t[0]+e[0]-r.offsetLeft,o=t[1]+e[1]-r.offsetTop;return i.viewport.unproject([n,o])}function v$(t,e){var r=e.props,i=e.callbacks,n=e.state,o=e.context,s=e.containerRef,f=r.draggable;if(f){t.stopPropagation();var A=U4(t),v=y$(t,s.current);if(n.setDragPos(A),n.setDragOffset(v),i.onDragStart&&v){var w=Object.assign({},t);w.lngLat=tx(A,v,r,o),i.onDragStart(w)}}}function b$(t,e){var r=e.props,i=e.callbacks,n=e.state,o=e.context;t.stopPropagation();var s=U4(t);n.setDragPos(s);var f=n.dragOffset;if(i.onDrag&&f){var A=Object.assign({},t);A.lngLat=tx(s,f,r,o),i.onDrag(A)}}function x$(t,e){var r=e.props,i=e.callbacks,n=e.state,o=e.context;t.stopPropagation();var s=n.dragPos,f=n.dragOffset;if(n.setDragPos(null),n.setDragOffset(null),i.onDragEnd&&s&&f){var A=Object.assign({},t);A.lngLat=tx(s,f,r,o),i.onDragEnd(A)}}function w$(t,e){var r=e.state;t.stopPropagation(),r.setDragPos(null),r.setDragOffset(null)}function T$(t){var e=t.context.eventManager;if(!(!e||!t.state.dragPos)){var r={panmove:function(n){return b$(n,t)},panend:function(n){return x$(n,t)},pancancel:function(n){return w$(n,t)}};return e.watch(r),function(){e.off(r)}}}function E$(t){var e=it.useState(null),r=Gn(e,2),i=r[0],n=r[1],o=it.useState(null),s=Gn(o,2),f=s[0],A=s[1],v=Uu(WC(WC({},t),{},{onDragStart:v$}));return v.callbacks=t,v.state.dragPos=i,v.state.setDragPos=n,v.state.dragOffset=f,v.state.setDragOffset=A,it.useEffect(function(){return T$(v)},[v.context.eventManager,!!i]),v}var XC=typeof window<"u"&&window.devicePixelRatio||1,Gp=function(e){return Math.round(e*XC)/XC},qC=function(e,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return r;var n=i==="x"?e.offsetWidth:e.offsetHeight;return Gp(r/100*n)/n*100};function $C(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function S$(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?$C(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$C(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var C$=Object.assign({},m$,{className:$e.string,longitude:$e.number.isRequired,latitude:$e.number.isRequired,style:$e.object}),P$=Object.assign({},_$,{className:""});function I$(t){var e=t.props,r=t.state,i=t.context,n=e.longitude,o=e.latitude,s=e.offsetLeft,f=e.offsetTop,A=r.dragPos,v=r.dragOffset;if(A&&v)return[A[0]+v[0],A[1]+v[1]];var w=i.viewport.project([n,o]),C=Gn(w,2),I=C[0],B=C[1];return I+=s,B+=f,[I,B]}function rx(t){var e=E$(t),r=e.state,i=e.containerRef,n=t.children,o=t.className,s=t.draggable,f=t.style,A=r.dragPos,v=I$(e),w=Gn(v,2),C=w[0],I=w[1],B="translate(".concat(Gp(C),"px, ").concat(Gp(I),"px)"),F=s?A?"grabbing":"grab":"auto",N=it.useMemo(function(){var G=S$({position:"absolute",left:0,top:0,transform:B,cursor:F},f);return it.createElement("div",{className:"mapboxgl-marker ".concat(o),ref:e.containerRef,style:G},n)},[n,o]),V=i.current;return V&&(V.style.transform=B,V.style.cursor=F),N}rx.defaultProps=P$;rx.propTypes=C$;it.memo(rx);var Wp={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},M$=Object.keys(Wp);function R$(t){var e=t.x,r=t.y,i=t.width,n=t.height,o=t.selfWidth,s=t.selfHeight,f=t.anchor,A=t.padding,v=A===void 0?0:A,w=Wp[f],C=w.x,I=w.y,B=r-I*s,F=B+s,N=Math.max(0,v-B)+Math.max(0,F-n+v);if(N>0){var V=I,G=N;for(I=0;I<=1;I+=.5)B=r-I*s,F=B+s,N=Math.max(0,v-B)+Math.max(0,F-n+v),N<G&&(G=N,V=I);I=V}var Y=.5;I===.5&&(C=Math.floor(C),Y=1);var Z=e-C*o,se=Z+o,ge=Math.max(0,v-Z)+Math.max(0,se-i+v);if(ge>0){var Pe=C,Ue=ge;for(C=0;C<=1;C+=Y)Z=e-C*o,se=Z+o,ge=Math.max(0,v-Z)+Math.max(0,se-i+v),ge<Ue&&(Ue=ge,Pe=C);C=Pe}return M$.find(function(Fe){var pe=Wp[Fe];return pe.x===C&&pe.y===I})||f}var B$=Object.assign({},sl,{className:$e.string,longitude:$e.number.isRequired,latitude:$e.number.isRequired,altitude:$e.number,offsetLeft:$e.number,offsetTop:$e.number,tipSize:$e.number,closeButton:$e.bool,closeOnClick:$e.bool,anchor:$e.oneOf(Object.keys(Wp)),dynamicPosition:$e.bool,sortByDepth:$e.bool,onClose:$e.func}),O$=Object.assign({},Nu,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function D$(t,e,r,i){var n=Gn(i,2),o=n[0],s=n[1],f=t.anchor,A=t.dynamicPosition,v=t.tipSize;return r&&A?R$({x:o,y:s,anchor:f,padding:v,width:e.width,height:e.height,selfWidth:r.clientWidth,selfHeight:r.clientHeight}):f}function F$(t,e,r,i,n){var o=Gn(i,3),s=o[0],f=o[1],A=o[2],v=t.offsetLeft,w=t.offsetTop,C=t.sortByDepth,I=Wp[n],B=s+v,F=f+w,N=qC(r,-I.x*100),V=qC(r,-I.y*100,"y"),G={position:"absolute",transform:`
      translate(`.concat(N,"%, ").concat(V,`%)
      translate(`).concat(Gp(B),"px, ").concat(Gp(F),`px)
    `),display:void 0,zIndex:void 0};return C&&(A>1||A<-1||s<0||s>e.width||f<0||f>e.height?G.display="none":G.zIndex=Math.floor((1-A)/2*1e5)),G}function ix(t){var e=it.useRef(null),r=Uu(t),i=r.context,n=r.containerRef,o=it.useState(!1),s=Gn(o,2),f=s[1];it.useEffect(function(){f(!0)},[e.current]),it.useEffect(function(){if(i.eventManager&&t.closeOnClick){var se=function(){return r.props.onClose()};return i.eventManager.on("anyclick",se),function(){i.eventManager.off("anyclick",se)}}},[i.eventManager,t.closeOnClick]);var A=i.viewport,v=t.className,w=t.longitude,C=t.latitude,I=t.altitude,B=t.tipSize,F=t.closeButton,N=t.children,V=A.project([w,C,I]),G=D$(t,A,e.current,V),Y=F$(t,A,n.current,V,G),Z=it.useCallback(function(se){r.props.onClose();var ge=r.context.eventManager;ge&&ge.once("click",function(Pe){return Pe.stopPropagation()},se.target)},[]);return it.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(G," ").concat(v),style:Y,ref:n},it.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:B}}),it.createElement("div",{key:"content",ref:e,className:"mapboxgl-popup-content"},F&&it.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:Z},""),N))}ix.propTypes=B$;ix.defaultProps=O$;it.memo(ix);function ZC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function L$(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ZC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ZC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var k$=Object.assign({},sl,{toggleLabel:$e.string,className:$e.string,style:$e.object,compact:$e.bool,customAttribution:$e.oneOfType([$e.string,$e.arrayOf($e.string)])}),N$=Object.assign({},Nu,{className:"",toggleLabel:"Toggle Attribution"});function U$(t,e,r,i){var n=new Wl.AttributionControl(t);return n._map=e,n._container=r,n._innerContainer=i,n._updateAttributions(),n._updateEditLink(),e.on("styledata",n._updateData),e.on("sourcedata",n._updateData),n}function z$(t){t._map.off("styledata",t._updateData),t._map.off("sourcedata",t._updateData)}function nx(t){var e=Uu(t),r=e.context,i=e.containerRef,n=it.useRef(null),o=it.useState(!1),s=Gn(o,2),f=s[0],A=s[1];it.useEffect(function(){var I;return r.map&&(I=U$({customAttribution:t.customAttribution},r.map,i.current,n.current)),function(){return I&&z$(I)}},[r.map]);var v=t.compact===void 0?r.viewport.width<=640:t.compact;it.useEffect(function(){!v&&f&&A(!1)},[v]);var w=it.useCallback(function(){return A(function(I){return!I})},[]),C=it.useMemo(function(){return L$({position:"absolute"},t.style)},[t.style]);return it.createElement("div",{style:C,className:t.className},it.createElement("div",{ref:i,"aria-pressed":f,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(v?"mapboxgl-compact":""," ").concat(f?"mapboxgl-compact-show":"")},it.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:t.toggleLabel,onClick:w}),it.createElement("div",{ref:n,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}nx.propTypes=k$;nx.defaultProps=N$;it.memo(nx);function KC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function V$(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?KC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):KC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var j$=Object.assign({},sl,{className:$e.string,style:$e.object,container:$e.object,label:$e.string}),H$=Object.assign({},Nu,{className:"",container:null,label:"Toggle fullscreen"});function sx(t){var e=Uu(t),r=e.context,i=e.containerRef,n=it.useState(!1),o=Gn(n,2),s=o[0],f=o[1],A=it.useState(!1),v=Gn(A,2),w=v[0],C=v[1],I=it.useState(null),B=Gn(I,2),F=B[0],N=B[1];it.useEffect(function(){var ge=new Wl.FullscreenControl;N(ge),C(ge._checkFullscreenSupport());var Pe=function(){var Fe=!ge._fullscreen;ge._fullscreen=Fe,f(Fe)};return xc.addEventListener(ge._fullscreenchange,Pe),function(){xc.removeEventListener(ge._fullscreenchange,Pe)}},[]);var V=function(){F&&(F._container=t.container||r.container,F._onClickFullscreen())},G=it.useMemo(function(){return V$({position:"absolute"},t.style)},[t.style]);if(!w)return null;var Y=t.className,Z=t.label,se=s?"shrink":"fullscreen";return it.createElement("div",{style:G,className:Y},it.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:i},it.createElement("button",{key:se,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(se),type:"button",title:Z,onClick:V},it.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}sx.propTypes=j$;sx.defaultProps=H$;it.memo(sx);var Qf;function G$(){return Qf!==void 0?Promise.resolve(Qf):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(t){return Qf=t.state!=="denied",Qf}):(Qf=!!window.navigator.geolocation,Promise.resolve(Qf))}function YC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function W$(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?YC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):YC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var JC=function(){},X$=Object.assign({},sl,{className:$e.string,style:$e.object,label:$e.string,disabledLabel:$e.string,auto:$e.bool,positionOptions:$e.object,fitBoundsOptions:$e.object,trackUserLocation:$e.bool,showUserLocation:$e.bool,showAccuracyCircle:$e.bool,showUserHeading:$e.bool,onViewStateChange:$e.func,onViewportChange:$e.func,onGeolocate:$e.func}),q$=Object.assign({},Nu,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function $$(t){var e=new Wl.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,i=e.toBounds(r);return[[i._ne.lng,i._ne.lat],[i._sw.lng,i._sw.lat]]}function Z$(t,e,r){var i=new Wl.GeolocateControl(e);i._container=xc.createElement("div"),i._map={on:function(){},_getUIString:function(){return""}},i._setupUI(!0),i._map=t.map,i._geolocateButton=r;var n=t.eventManager;return i.options.trackUserLocation&&n&&n.on("panstart",function(){i._watchState==="ACTIVE_LOCK"&&(i._watchState="BACKGROUND",r.classList.add("mapboxgl-ctrl-geolocate-background"),r.classList.remove("mapboxgl-ctrl-geolocate-active"))}),i.on("geolocate",e.onGeolocate),i}function K$(t,e){var r=e.context,i=e.props,n=$$(t),o=r.viewport.fitBounds(n,i.fitBoundsOptions),s=o.longitude,f=o.latitude,A=o.zoom,v=Object.assign({},r.viewport,{longitude:s,latitude:f,zoom:A}),w=new Ud(v),C=Object.assign({},w.getViewportProps(),yc),I=i.onViewportChange||r.onViewportChange||JC,B=i.onViewStateChange||r.onViewStateChange||JC;B({viewState:C}),I(C)}function ox(t){var e=Uu(t),r=e.context,i=e.containerRef,n=it.useRef(null),o=it.useState(null),s=Gn(o,2),f=s[0],A=s[1],v=it.useState(!1),w=Gn(v,2),C=w[0],I=w[1];it.useEffect(function(){var Z;return r.map&&G$().then(function(se){I(se),n.current&&(Z=Z$(r,t,n.current),Z._updateCamera=function(ge){return K$(ge,e)},A(Z))}),function(){Z&&Z._clearWatch()}},[r.map]);var B=it.useCallback(function(){f&&(f.options=e.props,f.trigger())},[f]);it.useEffect(function(){t.auto&&B()},[f,t.auto]),it.useEffect(function(){f&&f._onZoom()},[r.viewport.zoom]);var F=t.className,N=t.label,V=t.disabledLabel,G=t.trackUserLocation,Y=it.useMemo(function(){return W$({position:"absolute"},t.style)},[t.style]);return it.createElement("div",{style:Y,className:F},it.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:i},it.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:n,disabled:!C,"aria-pressed":!G,type:"button",title:C?N:V,"aria-label":C?N:V,onClick:B},it.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}ox.propTypes=X$;ox.defaultProps=q$;it.memo(ox);function Y$(t,e){for(var r=(t||"").split(".").map(Number),i=e.split(".").map(Number),n=0;n<3;n++){var o=r[n]||0,s=i[n]||0;if(o<s)return-1;if(o>s)return 1}return 0}function QC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function J$(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?QC(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):QC(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var e3=function(){},Q$=Object.assign({},sl,{className:$e.string,style:$e.object,onViewStateChange:$e.func,onViewportChange:$e.func,showCompass:$e.bool,showZoom:$e.bool,zoomInLabel:$e.string,zoomOutLabel:$e.string,compassLabel:$e.string}),eZ=Object.assign({},Nu,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),tZ=1,Tb=2;function rZ(t){return Y$(t,"1.6.0")>=0?Tb:tZ}function Iv(t,e,r){var i=t.viewport,n=new Ud(Object.assign({},i,r)),o=Object.assign({},n.getViewportProps(),yc),s=e.onViewportChange||t.onViewportChange||e3,f=e.onViewStateChange||t.onViewStateChange||e3;f({viewState:o}),s(o)}function Mv(t,e,r,i){return it.createElement("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),type:"button",title:e,onClick:r},i||it.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function iZ(t){var e=it.useMemo(function(){return t.map?rZ(t.map.version):Tb},[t.map]),r=t.viewport.bearing,i={transform:"rotate(".concat(-r,"deg)")};return e===Tb?it.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:i}):it.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:i})}function ax(t){var e=Uu(t),r=e.context,i=e.containerRef,n=function(){Iv(r,t,{zoom:r.viewport.zoom+1})},o=function(){Iv(r,t,{zoom:r.viewport.zoom-1})},s=function(){Iv(r,t,{bearing:0,pitch:0})},f=t.className,A=t.showCompass,v=t.showZoom,w=t.zoomInLabel,C=t.zoomOutLabel,I=t.compassLabel,B=it.useMemo(function(){return J$({position:"absolute"},t.style)},[t.style]);return it.createElement("div",{style:B,className:f},it.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:i},v&&Mv("zoom-in",w,n),v&&Mv("zoom-out",C,o),A&&Mv("compass",I,s,iZ(r))))}ax.propTypes=Q$;ax.defaultProps=eZ;const nZ=it.memo(ax);function t3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function sZ(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?t3(Object(r),!0).forEach(function(i){Wt(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):t3(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var oZ=Object.assign({},sl,{className:$e.string,style:$e.object,maxWidth:$e.number,unit:$e.oneOf(["imperial","metric","nautical"])}),aZ=Object.assign({},Nu,{className:"",maxWidth:100,unit:"metric"});function lx(t){var e=Uu(t),r=e.context,i=e.containerRef,n=it.useState(null),o=Gn(n,2),s=o[0],f=o[1];it.useEffect(function(){if(r.map){var v=new Wl.ScaleControl;v._map=r.map,v._container=i.current,f(v)}},[r.map]),s&&(s.options=t,s._onMove&&s._onMove());var A=it.useMemo(function(){return sZ({position:"absolute"},t.style)},[t.style]);return it.createElement("div",{style:A,className:t.className},it.createElement("div",{ref:i,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}lx.propTypes=oZ;lx.defaultProps=aZ;it.memo(lx);Object.assign({},sl,{redraw:$e.func.isRequired});Object.assign({},sl,{redraw:$e.func.isRequired,style:$e.object});Object.assign({},sl,{redraw:$e.func.isRequired,style:$e.object});Wl&&Wl.setRTLTextPlugin;/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const r3="\uFEFF",Ko={parse:lZ,unparse:cZ,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:r3,BAD_DELIMITERS:["\r",`
`,'"',r3],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:Eb,ParserHandle:V4,ChunkStreamer:z4,StringStreamer:Qd};function lZ(t,e,r){e=e||{};var i=e.dynamicTyping||!1;if(co(i)&&(e.dynamicTypingFunction=i,i={}),e.dynamicTyping=i,e.transform=co(e.transform)?e.transform:!1,e.worker&&Ko.WORKERS_SUPPORTED){var n=newWorker();n.userStep=e.step,n.userChunk=e.chunk,n.userComplete=e.complete,n.userError=e.error,e.step=co(e.step),e.chunk=co(e.chunk),e.complete=co(e.complete),e.error=co(e.error),delete e.worker,n.postMessage({input:t,config:e,workerId:n.id});return}var o=null;return typeof t=="string"&&(o=new Qd(e)),o||(o=new r(e)),o.stream(t)}function cZ(t,e){var r=!1,i=!0,n=",",o=`\r
`,s='"',f=s+s,A=!1,v=null;C();var w=new RegExp(Xp(s),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return B(null,t,A);if(typeof t[0]=="object")return B(v||I(t[0]),t,A)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:I(t.data[0])),!Array.isArray(t.data[0])&&typeof t.data[0]!="object"&&(t.data=[t.data])),B(t.fields||[],t.data||[],A);throw new Error("Unable to serialize unrecognized input");function C(){if(typeof e=="object"){if(typeof e.delimiter=="string"&&!Ko.BAD_DELIMITERS.filter(function(V){return e.delimiter.indexOf(V)!==-1}).length&&(n=e.delimiter),(typeof e.quotes=="boolean"||Array.isArray(e.quotes))&&(r=e.quotes),(typeof e.skipEmptyLines=="boolean"||typeof e.skipEmptyLines=="string")&&(A=e.skipEmptyLines),typeof e.newline=="string"&&(o=e.newline),typeof e.quoteChar=="string"&&(s=e.quoteChar),typeof e.header=="boolean"&&(i=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");v=e.columns}e.escapeChar!==void 0&&(f=e.escapeChar+s)}}function I(V){if(typeof V!="object")return[];var G=[];for(var Y in V)G.push(Y);return G}function B(V,G,Y){var Z="";typeof V=="string"&&(V=JSON.parse(V)),typeof G=="string"&&(G=JSON.parse(G));var se=Array.isArray(V)&&V.length>0,ge=!Array.isArray(G[0]);if(se&&i){for(var Pe=0;Pe<V.length;Pe++)Pe>0&&(Z+=n),Z+=F(V[Pe],Pe);G.length>0&&(Z+=o)}for(var Ue=0;Ue<G.length;Ue++){var Fe=se?V.length:G[Ue].length,pe=!1,Te=se?Object.keys(G[Ue]).length===0:G[Ue].length===0;if(Y&&!se&&(pe=Y==="greedy"?G[Ue].join("").trim()==="":G[Ue].length===1&&G[Ue][0].length===0),Y==="greedy"&&se){for(var Ae=[],Le=0;Le<Fe;Le++){var Ve=ge?V[Le]:Le;Ae.push(G[Ue][Ve])}pe=Ae.join("").trim()===""}if(!pe){for(var Xe=0;Xe<Fe;Xe++){Xe>0&&!Te&&(Z+=n);var dt=se&&ge?V[Xe]:Xe;Z+=F(G[Ue][dt],Xe)}Ue<G.length-1&&(!Y||Fe>0&&!Te)&&(Z+=o)}}return Z}function F(V,G){if(typeof V>"u"||V===null)return"";if(V.constructor===Date)return JSON.stringify(V).slice(1,25);V=V.toString().replace(w,f);var Y=typeof r=="boolean"&&r||Array.isArray(r)&&r[G]||N(V,Ko.BAD_DELIMITERS)||V.indexOf(n)>-1||V.charAt(0)===" "||V.charAt(V.length-1)===" ";return Y?s+V+s:V}function N(V,G){for(var Y=0;Y<G.length;Y++)if(V.indexOf(G[Y])>-1)return!0;return!1}}function z4(t){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},e.call(this,t),this.parseChunk=function(r,i){if(this.isFirstChunk&&co(this._config.beforeFirstChunk)){var n=this._config.beforeFirstChunk(r);n!==void 0&&(r=n)}this.isFirstChunk=!1;var o=this._partialLine+r;this._partialLine="";var s=this._handle.parse(o,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var f=s.meta.cursor;this._finished||(this._partialLine=o.substring(f-this._baseIndex),this._baseIndex=f),s&&s.data&&(this._rowCount+=s.data.length);var A=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(co(this._config.chunk)&&!i){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return;s=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),!this._completed&&A&&co(this._config.complete)&&(!s||!s.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),!A&&(!s||!s.meta.paused)&&this._nextChunk(),s}},this._sendError=function(r){co(this._config.error)&&this._config.error(r)};function e(r){var i=cx(r);i.chunkSize=parseInt(i.chunkSize),!r.step&&!r.chunk&&(i.chunkSize=null),this._handle=new V4(i),this._handle.streamer=this,this._config=i}}function Qd(t){t=t||{},z4.call(this,t);var e;this.stream=function(r){return e=r,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var r=this._config.chunkSize,i=r?e.substr(0,r):e;return e=r?e.substr(r):"",this._finished=!e,this.parseChunk(i)}}}Qd.prototype=Object.create(Qd.prototype);Qd.prototype.constructor=Qd;function V4(t){var e=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,r=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,i=this,n=0,o=0,s,f,A=!1,v=!1,w,C=[],I={data:[],errors:[],meta:{}};if(co(t.step)){var B=t.step;t.step=function(Fe){if(I=Fe,V())N();else{if(N(),!I.data||I.data.length===0)return;n+=Fe.data.length,t.preview&&n>t.preview?f.abort():B(I,i)}}}this.parse=function(Fe,pe,Te){var Ae=t.quoteChar||'"';if(t.newline||(t.newline=Pe(Fe,Ae)),w=!1,t.delimiter)co(t.delimiter)&&(t.delimiter=t.delimiter(Fe),I.meta.delimiter=t.delimiter);else{var Le=ge(Fe,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);Le.successful?t.delimiter=Le.bestDelimiter:(w=!0,t.delimiter=Ko.DefaultDelimiter),I.meta.delimiter=t.delimiter}var Ve=cx(t);return t.preview&&t.header&&Ve.preview++,s=Fe,f=new Eb(Ve),I=f.parse(s,pe,Te),N(),A?{meta:{paused:!0}}:I||{meta:{paused:!1}}},this.paused=function(){return A},this.pause=function(){A=!0,f.abort(),s=s.substr(f.getCharIndex())},this.resume=function(){A=!1,i.streamer.parseChunk(s,!0)},this.aborted=function(){return v},this.abort=function(){v=!0,f.abort(),I.meta.aborted=!0,co(t.complete)&&t.complete(I),s=""};function F(Fe){return t.skipEmptyLines==="greedy"?Fe.join("").trim()==="":Fe.length===1&&Fe[0].length===0}function N(){if(I&&w&&(Ue("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+Ko.DefaultDelimiter+"'"),w=!1),t.skipEmptyLines)for(var Fe=0;Fe<I.data.length;Fe++)F(I.data[Fe])&&I.data.splice(Fe--,1);return V()&&G(),se()}function V(){return t.header&&C.length===0}function G(){if(!I)return;function Fe(Te){co(t.transformHeader)&&(Te=t.transformHeader(Te)),C.push(Te)}if(Array.isArray(I.data[0])){for(var pe=0;V()&&pe<I.data.length;pe++)I.data[pe].forEach(Fe);I.data.splice(0,1)}else I.data.forEach(Fe)}function Y(Fe){return t.dynamicTypingFunction&&t.dynamicTyping[Fe]===void 0&&(t.dynamicTyping[Fe]=t.dynamicTypingFunction(Fe)),(t.dynamicTyping[Fe]||t.dynamicTyping)===!0}function Z(Fe,pe){return Y(Fe)?pe==="true"||pe==="TRUE"?!0:pe==="false"||pe==="FALSE"?!1:e.test(pe)?parseFloat(pe):r.test(pe)?new Date(pe):pe===""?null:pe:pe}function se(){if(!I||!I.data||!t.header&&!t.dynamicTyping&&!t.transform)return I;function Fe(Te,Ae){var Le=t.header?{}:[],Ve;for(Ve=0;Ve<Te.length;Ve++){var Xe=Ve,dt=Te[Ve];t.header&&(Xe=Ve>=C.length?"__parsed_extra":C[Ve]),t.transform&&(dt=t.transform(dt,Xe)),dt=Z(Xe,dt),Xe==="__parsed_extra"?(Le[Xe]=Le[Xe]||[],Le[Xe].push(dt)):Le[Xe]=dt}return t.header&&(Ve>C.length?Ue("FieldMismatch","TooManyFields","Too many fields: expected "+C.length+" fields but parsed "+Ve,o+Ae):Ve<C.length&&Ue("FieldMismatch","TooFewFields","Too few fields: expected "+C.length+" fields but parsed "+Ve,o+Ae)),Le}var pe=1;return!I.data[0]||Array.isArray(I.data[0])?(I.data=I.data.map(Fe),pe=I.data.length):I.data=Fe(I.data,0),t.header&&I.meta&&(I.meta.fields=C),o+=pe,I}function ge(Fe,pe,Te,Ae,Le){var Ve,Xe,dt;Le=Le||[",","	","|",";",Ko.RECORD_SEP,Ko.UNIT_SEP];for(var Nt=0;Nt<Le.length;Nt++){var gr=Le[Nt],mr=0,_r=0,rr=0;dt=void 0;for(var Ot=new Eb({comments:Ae,delimiter:gr,newline:pe,preview:10}).parse(Fe),Qt=0;Qt<Ot.data.length;Qt++){if(Te&&F(Ot.data[Qt])){rr++;continue}var qt=Ot.data[Qt].length;if(_r+=qt,typeof dt>"u"){dt=0;continue}else qt>1&&(mr+=Math.abs(qt-dt),dt=qt)}Ot.data.length>0&&(_r/=Ot.data.length-rr),(typeof Xe>"u"||mr>Xe)&&_r>1.99&&(Xe=mr,Ve=gr)}return t.delimiter=Ve,{successful:!!Ve,bestDelimiter:Ve}}function Pe(Fe,pe){Fe=Fe.substr(0,1024*1024);var Te=new RegExp(Xp(pe)+"([^]*?)"+Xp(pe),"gm");Fe=Fe.replace(Te,"");var Ae=Fe.split("\r"),Le=Fe.split(`
`),Ve=Le.length>1&&Le[0].length<Ae[0].length;if(Ae.length===1||Ve)return`
`;for(var Xe=0,dt=0;dt<Ae.length;dt++)Ae[dt][0]===`
`&&Xe++;return Xe>=Ae.length/2?`\r
`:"\r"}function Ue(Fe,pe,Te,Ae){I.errors.push({type:Fe,code:pe,message:Te,row:Ae})}}function Xp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Eb(t){t=t||{};var e=t.delimiter,r=t.newline,i=t.comments,n=t.step,o=t.preview,s=t.fastMode,f;t.quoteChar===void 0?f='"':f=t.quoteChar;var A=f;if(t.escapeChar!==void 0&&(A=t.escapeChar),(typeof e!="string"||Ko.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),i===e)throw new Error("Comment character same as delimiter");i===!0?i="#":(typeof i!="string"||Ko.BAD_DELIMITERS.indexOf(i)>-1)&&(i=!1),r!==`
`&&r!=="\r"&&r!==`\r
`&&(r=`
`);var v=0,w=!1;this.parse=function(C,I,B){if(typeof C!="string")throw new Error("Input must be a string");var F=C.length,N=e.length,V=r.length,G=i.length,Y=co(n);v=0;var Z=[],se=[],ge=[],Pe=0;if(!C)return Ot();if(s||s!==!1&&C.indexOf(f)===-1){for(var Ue=C.split(r),Fe=0;Fe<Ue.length;Fe++){if(ge=Ue[Fe],v+=ge.length,Fe!==Ue.length-1)v+=r.length;else if(B)return Ot();if(!(i&&ge.substr(0,G)===i)){if(Y){if(Z=[],gr(ge.split(e)),Qt(),w)return Ot()}else gr(ge.split(e));if(o&&Fe>=o)return Z=Z.slice(0,o),Ot(!0)}}return Ot()}for(var pe=C.indexOf(e,v),Te=C.indexOf(r,v),Ae=new RegExp(Xp(A)+Xp(f),"g"),Le;;){if(C[v]===f){for(Le=v,v++;;){if(Le=C.indexOf(f,Le+1),Le===-1)return B||se.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Z.length,index:v}),_r();if(Le===F-1){var Ve=C.substring(v,Le).replace(Ae,f);return _r(Ve)}if(f===A&&C[Le+1]===A){Le++;continue}if(!(f!==A&&Le!==0&&C[Le-1]===A)){var Xe=Te===-1?pe:Math.min(pe,Te),dt=mr(Xe);if(C[Le+1+dt]===e){if(ge.push(C.substring(v,Le).replace(Ae,f)),v=Le+1+dt+N,pe=C.indexOf(e,v),Te=C.indexOf(r,v),Y&&(Qt(),w))return Ot();if(o&&Z.length>=o)return Ot(!0);break}var Nt=mr(Te);if(C.substr(Le+1+Nt,V)===r){if(ge.push(C.substring(v,Le).replace(Ae,f)),rr(Le+1+Nt+V),pe=C.indexOf(e,v),Y&&(Qt(),w))return Ot();if(o&&Z.length>=o)return Ot(!0);break}se.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Z.length,index:v}),Le++}}if(Y&&(Qt(),w))return Ot();if(o&&Z.length>=o)return Ot(!0);continue}if(i&&ge.length===0&&C.substr(v,G)===i){if(Te===-1)return Ot();v=Te+V,Te=C.indexOf(r,v),pe=C.indexOf(e,v);continue}if(pe!==-1&&(pe<Te||Te===-1)){ge.push(C.substring(v,pe)),v=pe+N,pe=C.indexOf(e,v);continue}if(Te!==-1){if(ge.push(C.substring(v,Te)),rr(Te+V),Y&&(Qt(),w))return Ot();if(o&&Z.length>=o)return Ot(!0);continue}break}return _r();function gr(qt){Z.push(qt),Pe=v}function mr(qt){var Rt=0;if(qt!==-1){var ut=C.substring(Le+1,qt);ut&&ut.trim()===""&&(Rt=ut.length)}return Rt}function _r(qt){return B||(typeof qt>"u"&&(qt=C.substr(v)),ge.push(qt),v=F,gr(ge),Y&&Qt()),Ot()}function rr(qt){v=qt,gr(ge),ge=[],Te=C.indexOf(r,v)}function Ot(qt,Rt){var ut=Rt||!1;return{data:ut?Z[0]:Z,errors:se,meta:{delimiter:e,linebreak:r,aborted:w,truncated:!!qt,cursor:Pe+(I||0)}}}function Qt(){n(Ot(void 0,!0)),Z=[],se=[]}},this.abort=function(){w=!0},this.getCharIndex=function(){return v}}function cx(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var r in t)e[r]=cx(t[r]);return e}function co(t){return typeof t=="function"}const{ChunkStreamer:j4}=Ko;function Hm(t){t=t||{},j4.call(this,t),this.textDecoder=new TextDecoder(this._config.encoding),this.stream=async function(e){this._input=e;try{for await(const r of e)this.parseChunk(this.getStringChunk(r));this._finished=!0,this.parseChunk("")}catch(r){this._sendError(r)}},this._nextChunk=function(){},this.getStringChunk=function(e){return typeof e=="string"?e:this.textDecoder.decode(e,{stream:!0})}}Hm.prototype=Object.create(j4.prototype);Hm.prototype.constructor=Hm;const uZ="4.2.4",ux="object-row-table",hx={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:uZ,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(t,e)=>i3(new TextDecoder().decode(t),e),parseText:(t,e)=>i3(t,e),parseInBatches:hZ,options:{csv:{shape:ux,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function i3(t,e){const r={...hx.options.csv,...e==null?void 0:e.csv},i=fZ(t),o=r.header==="auto"?H4(i):!!r.header,s={...r,header:o,download:!1,transformHeader:o?G4():void 0,error:C=>{throw new Error(C)}},f=Ko.parse(t,s),A=f.data,v=f.meta.fields||W4(r.columnPrefix,i.length),w=r.shape||ux;switch(w){case"object-row-table":return{shape:"object-row-table",data:A.map(C=>Array.isArray(C)?mR(C,v):C)};case"array-row-table":return{shape:"array-row-table",data:A.map(C=>Array.isArray(C)?C:_R(C,v))};default:throw new Error(w)}}function hZ(t,e){e={...e},e.batchSize==="auto"&&(e.batchSize=4e3);const r={...hx.options.csv,...e==null?void 0:e.csv},i=new J8;let n=!0,o=null,s=null,f=null;const A={...r,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(v){let w=v.data;if(r.skipEmptyLines&&w.flat().join("").trim()==="")return;const C=v.meta.cursor;if(n&&!o&&(r.header==="auto"?H4(w):!!r.header)){o=w.map(G4());return}n&&(n=!1,o||(o=W4(r.columnPrefix,w.length)),f=dZ(w,o)),r.optimizeMemoryUsage&&(w=JSON.parse(JSON.stringify(w)));const I=r.shape||ux;s=s||new S1(f,{shape:I,...e});try{s.addRow(w);const B=s&&s.getFullBatch({bytesUsed:C});B&&i.enqueue(B)}catch(B){i.enqueue(B)}},complete(v){try{const w=v.meta.cursor,C=s&&s.getFinalBatch({bytesUsed:w});C&&i.enqueue(C)}catch(w){i.enqueue(w)}i.close()}};return Ko.parse(t,A,Hm),i}function H4(t){return t&&t.every(e=>typeof e=="string")}function fZ(t){return Ko.parse(t,{download:!1,dynamicTyping:!0,preview:1}).data[0]}function G4(){const t=new Set;return e=>{let r=e,i=1;for(;t.has(r);)r=`${e}.${i}`,i++;return t.add(r),r}}function W4(t,e=0){const r=[];for(let i=0;i<e;i++)r.push(`${t}${i+1}`);return r}function dZ(t,e){const r=e?{}:[];for(let i=0;i<t.length;i++){const n=e&&e[i]||i;switch(typeof t[i]){case"number":case"boolean":r[n]={name:String(n),index:i,type:Float32Array};break;case"string":default:r[n]={name:String(n),index:i,type:Array}}}return r}function Yo(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const X4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},q4={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},AZ=1.33,n3=["SCALAR","VEC2","VEC3","VEC4"],pZ=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],gZ=new Map(pZ),mZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_Z={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},yZ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function $4(t){return n3[t-1]||n3[0]}function fx(t){const e=gZ.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function dx(t,e){const r=yZ[t.componentType],i=mZ[t.type],n=_Z[t.componentType],o=t.count*i,s=t.count*i*n;Yo(s>=0&&s<=e.byteLength);const f=q4[t.componentType],A=X4[t.type];return{ArrayType:r,length:o,byteLength:s,componentByteSize:f,numberOfComponentsInElement:A}}function Z4(t){let{images:e,bufferViews:r}=t;e=e||[],r=r||[];const i=e.map(s=>s.bufferView);r=r.filter(s=>!i.includes(s));const n=r.reduce((s,f)=>s+f.byteLength,0),o=e.reduce((s,f)=>{const{width:A,height:v}=f.image;return s+A*v},0);return n+Math.ceil(4*o*AZ)}function vZ(t,e,r){const i=t.bufferViews[r];Yo(i);const n=i.buffer,o=e[n];Yo(o);const s=(i.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,i.byteLength)}function bZ(t,e,r){var N,V;const i=typeof r=="number"?(N=t.accessors)==null?void 0:N[r]:r;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const n=(V=t.bufferViews)==null?void 0:V[i.bufferView||0];if(!n)throw new Error(`No gltf buffer view for accessor ${n}`);const{arrayBuffer:o,byteOffset:s}=e[n.buffer],f=(s||0)+(i.byteOffset||0)+(n.byteOffset||0),{ArrayType:A,length:v,componentByteSize:w,numberOfComponentsInElement:C}=dx(i,n),I=w*C,B=n.byteStride||I;if(typeof n.byteStride>"u"||n.byteStride===I)return new A(o,f,v);const F=new A(v);for(let G=0;G<i.count;G++){const Y=new A(o,f+G*B,C);F.set(Y,G*C)}return F}function xZ(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class qs{constructor(e){U(this,"gltf");U(this,"sourceBuffers");U(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||xZ(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const r=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof r=="string"||typeof i=="string"}getExtension(e){const r=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return r?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;const i=this.json[e]&&this.json[e][r];if(!i)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const r=e.buffer,i=this.gltf.buffers[r];Yo(i);const n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){const r=this.getAccessor(e);return bZ(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);const r=this.getBufferView(e.bufferView),n=this.getBuffer(r.buffer).data,o=r.byteOffset||0;return new Uint8Array(n,o,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,i){return e.extensions=e.extensions||{},e.extensions[r]=i,this.registerUsedExtension(r),this}setObjectExtension(e,r,i){const n=e.extensions||{};n[r]=i}removeObjectExtension(e,r){const i=(e==null?void 0:e.extensions)||{};if(i[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(r)||n.push(r)}delete i[r]}addExtension(e,r={}){return Yo(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return Yo(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var r;if((r=this.json.extensions)!=null&&r[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(e)||i.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){const{meshIndex:r,matrix:i}=e;this.json.nodes=this.json.nodes||[];const n={mesh:r};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:r,indices:i,material:n,mode:o=4}=e,f={primitives:[{attributes:this._addAttributes(r),mode:o}]};if(i){const A=this._addIndices(i);f.primitives[0].indices=A}return Number.isFinite(n)&&(f.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(f),this.json.meshes.length-1}addPointCloud(e){const i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,r){const i=y2(e),n=r||(i==null?void 0:i.mimeType),s={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,r=0,i=this.byteLength){const n=e.byteLength;Yo(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:r,byteOffset:i,byteLength:n};return this.byteLength+=i0(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,r){const i={bufferView:e,type:$4(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){const i=this.addBufferView(e);let n={min:r.min,max:r.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,r.size));const o={size:r.size,componentType:fx(e),count:Math.round(e.length/r.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(o,r))}addTexture(e){const{imageIndex:r}=e,i={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var o,s;this.gltf.buffers=[];const e=this.byteLength,r=new ArrayBuffer(e),i=new Uint8Array(r);let n=0;for(const f of this.sourceBuffers||[])n=Sk(f,i,n);(s=(o=this.json)==null?void 0:o.buffers)!=null&&s[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,r){let i=!0;for(;i;){const n=e.indexOf(r);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){const r={};for(const i in e){const n=e[i],o=this._getGltfAttributeName(i),s=this.addBinaryBuffer(n.value,n);r[o]=s}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){const i={min:null,max:null};if(e.length<r)return i;i.min=[],i.max=[];const n=e.subarray(0,r);for(const o of n)i.min.push(o),i.max.push(o);for(let o=r;o<e.length;o+=r)for(let s=0;s<r;s++)i.min[0+s]=Math.min(i.min[0+s],e[o+s]),i.max[0+s]=Math.max(i.max[0+s],e[o+s]);return i}}function s3(t){return(t%1+1)%1}const K4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},wZ={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},Y4={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Ax(t,e){return Y4[e]*K4[t]}function O_(t,e,r,i){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const n=t.getTypedArrayForBufferView(e),o=D_(n,"SCALAR",r,i+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function D_(t,e,r,i=1){const n=K4[e],o=wZ[r],s=Y4[r],f=i*n,A=f*s;let v=t.buffer,w=t.byteOffset;return w%s!==0&&(v=new Uint8Array(v).slice(w,w+A).buffer,w=0),new o(v,w,f)}function px(t,e,r){var v,w,C,I,B;const i=`TEXCOORD_${e.texCoord||0}`,n=r.attributes[i],o=t.getTypedArrayForAccessor(n),s=t.gltf.json,f=e.index,A=(w=(v=s.textures)==null?void 0:v[f])==null?void 0:w.source;if(typeof A<"u"){const F=(I=(C=s.images)==null?void 0:C[A])==null?void 0:I.mimeType,N=(B=t.gltf.images)==null?void 0:B[A];if(N&&typeof N.width<"u"){const V=[];for(let G=0;G<o.length;G+=2){const Y=TZ(N,F,o,G,e.channels);V.push(Y)}return V}}return[]}function J4(t,e,r,i,n){if(!(r!=null&&r.length))return;const o=[];for(const w of r){let C=i.findIndex(I=>I===w);C===-1&&(C=i.push(w)-1),o.push(C)}const s=new Uint32Array(o),f=t.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,A=t.addBufferView(s,f,0),v=t.addAccessor(A,{size:1,componentType:fx(s),count:s.length});n.attributes[e]=v}function TZ(t,e,r,i,n=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=r[i],f=r[i+1];let A=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(A=4);const v=EZ(s,f,t,A);let w=0;for(const C of n){const I=typeof C=="number"?Object.values(o)[C]:o[C],B=v+I.offset,F=yR(t);if(F.data.length<=B)throw new Error(`${F.data.length} <= ${B}`);const N=F.data[B];w|=N<<I.shift}return w}function EZ(t,e,r,i=1){const n=r.width,o=s3(t)*(n-1),s=Math.round(o),f=r.height,A=s3(e)*(f-1),v=Math.round(A),w=r.components?r.components:i;return(v*n+s)*w}function Q4(t,e,r,i,n){const o=[];for(let s=0;s<e;s++){const f=r[s],A=r[s+1]-r[s];if(A+f>i)break;const v=f/n,w=A/n;o.push(t.slice(v,v+w))}return o}function eO(t,e,r){const i=[];for(let n=0;n<e;n++){const o=n*r;i.push(t.slice(o,o+r))}return i}function tO(t,e,r,i){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){const n=[],o=new TextDecoder("utf8");let s=0;for(let f=0;f<t;f++){const A=i[f+1]-i[f];if(A+s<=e.length){const v=e.subarray(s,A+s),w=o.decode(v);n.push(w),s+=A}}return n}return[]}const rO="EXT_mesh_features",SZ=rO;async function CZ(t,e){const r=new qs(t);PZ(r,e)}function PZ(t,e){const r=t.gltf.json;if(r.meshes)for(const i of r.meshes)for(const n of i.primitives)IZ(t,n,e)}function IZ(t,e,r){var o,s,f;if(!((o=r==null?void 0:r.gltf)!=null&&o.loadBuffers))return;const i=(s=e.extensions)==null?void 0:s[rO],n=i==null?void 0:i.featureIds;if(n)for(const A of n){let v;if(typeof A.attribute<"u"){const w=`_FEATURE_ID_${A.attribute}`,C=e.attributes[w];v=t.getTypedArrayForAccessor(C)}else typeof A.texture<"u"&&((f=r==null?void 0:r.gltf)!=null&&f.loadImages)?v=px(t,A.texture,e):v=[];A.data=v}}const MZ=Object.freeze(Object.defineProperty({__proto__:null,decode:CZ,name:SZ},Symbol.toStringTag,{value:"Module"})),gx="EXT_structural_metadata",RZ=gx;async function BZ(t,e){const r=new qs(t);OZ(r,e)}function OZ(t,e){var i,n;if(!((i=e.gltf)!=null&&i.loadBuffers))return;const r=t.getExtension(gx);r&&((n=e.gltf)!=null&&n.loadImages&&DZ(t,r),FZ(t,r))}function DZ(t,e){const r=e.propertyTextures,i=t.gltf.json;if(r&&i.meshes)for(const n of i.meshes)for(const o of n.primitives)kZ(t,r,o,e)}function FZ(t,e){const r=e.schema;if(!r)return;const i=r.classes,n=e.propertyTables;if(i&&n)for(const o in i){const s=LZ(n,o);s&&UZ(t,r,s)}}function LZ(t,e){for(const r of t)if(r.class===e)return r;return null}function kZ(t,e,r,i){var s;if(!e)return;const n=(s=r.extensions)==null?void 0:s[gx],o=n==null?void 0:n.propertyTextures;if(o)for(const f of o){const A=e[f];NZ(t,A,r,i)}}function NZ(t,e,r,i){var o;if(!e.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);const n=e.class;for(const s in e.properties){const f=`${n}_${s}`,A=(o=e.properties)==null?void 0:o[s];if(!A)continue;A.data||(A.data=[]);const v=A.data,w=px(t,A,r);w!==null&&(J4(t,f,w,v,r),A.data=v,i.dataAttributeNames.push(f))}}function UZ(t,e,r){var o,s;const i=(o=e.classes)==null?void 0:o[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const n=r.count;for(const f in i.properties){const A=i.properties[f],v=(s=r.properties)==null?void 0:s[f];if(v){const w=zZ(t,e,A,n,v);v.data=w}}}function zZ(t,e,r,i,n){let o=[];const s=n.values,f=t.getTypedArrayForBufferView(s),A=VZ(t,r,n,i),v=jZ(t,n,i);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=HZ(r,i,f,A);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{o=tO(i,f,A,v);break}case"ENUM":{o=GZ(e,r,i,f,A);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return o}function VZ(t,e,r,i){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?O_(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",i):null}function jZ(t,e,r){return typeof e.stringOffsets<"u"?O_(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function HZ(t,e,r,i){const n=t.array,o=t.count,s=Ax(t.type,t.componentType),f=r.byteLength/s;let A;return t.componentType?A=D_(r,t.type,t.componentType,f):A=r,n?i?Q4(A,e,i,r.length,s):o?eO(A,e,o):[]:A}function GZ(t,e,r,i,n){var C;const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=(C=t.enums)==null?void 0:C[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const f=s.valueType||"UINT16",A=Ax(e.type,f),v=i.byteLength/A;let w=D_(i,e.type,f,v);if(w||(w=i),e.array){if(n)return WZ({valuesData:w,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i.length,elementSize:A,enumEntry:s});const I=e.count;return I?XZ(w,r,I,s):[]}return mx(w,0,r,s)}function WZ(t){const{valuesData:e,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n,elementSize:o,enumEntry:s}=t,f=[];for(let A=0;A<r;A++){const v=i[A],w=i[A+1]-i[A];if(w+v>n)break;const C=v/o,I=w/o,B=mx(e,C,I,s);f.push(B)}return f}function XZ(t,e,r,i){const n=[];for(let o=0;o<e;o++){const s=r*o,f=mx(t,s,r,i);n.push(f)}return n}function mx(t,e,r,i){const n=[];for(let o=0;o<r;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)n.push("");else{const s=t[e+o],f=qZ(i,s);f?n.push(f.name):n.push("")}return n}function qZ(t,e){for(const r of t.values)if(r.value===e)return r;return null}const $Z=Object.freeze(Object.defineProperty({__proto__:null,decode:BZ,name:RZ},Symbol.toStringTag,{value:"Module"})),iO="EXT_feature_metadata",ZZ=iO;async function KZ(t,e){const r=new qs(t);YZ(r,e)}function YZ(t,e){var i,n;if(!((i=e.gltf)!=null&&i.loadBuffers))return;const r=t.getExtension(iO);r&&((n=e.gltf)!=null&&n.loadImages&&JZ(t,r),QZ(t,r))}function JZ(t,e){const r=e.schema;if(!r)return;const i=r.classes,{featureTextures:n}=e;if(i&&n)for(const o in i){const s=i[o],f=tK(n,o);f&&iK(t,f,s)}}function QZ(t,e){const r=e.schema;if(!r)return;const i=r.classes,n=e.featureTables;if(i&&n)for(const o in i){const s=eK(n,o);s&&rK(t,r,s)}}function eK(t,e){for(const r in t){const i=t[r];if(i.class===e)return i}return null}function tK(t,e){for(const r in t){const i=t[r];if(i.class===e)return i}return null}function rK(t,e,r){var o,s;if(!r.class)return;const i=(o=e.classes)==null?void 0:o[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const n=r.count;for(const f in i.properties){const A=i.properties[f],v=(s=r.properties)==null?void 0:s[f];if(v){const w=nK(t,e,A,n,v);v.data=w}}}function iK(t,e,r){var n;const i=e.class;for(const o in r.properties){const s=(n=e==null?void 0:e.properties)==null?void 0:n[o];if(s){const f=cK(t,s,i);s.data=f}}}function nK(t,e,r,i,n){let o=[];const s=n.bufferView,f=t.getTypedArrayForBufferView(s),A=sK(t,r,n,i),v=oK(t,r,n,i);return r.type==="STRING"||r.componentType==="STRING"?o=tO(i,f,A,v):aK(r)&&(o=lK(r,i,f,A)),o}function sK(t,e,r,i){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?O_(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",i):null}function oK(t,e,r,i){return typeof r.stringOffsetBufferView<"u"?O_(t,r.stringOffsetBufferView,r.offsetType||"UINT32",i):null}function aK(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function lK(t,e,r,i){const n=t.type==="ARRAY",o=t.componentCount,s="SCALAR",f=t.componentType||t.type,A=Ax(s,f),v=r.byteLength/A,w=D_(r,s,f,v);return n?i?Q4(w,e,i,r.length,A):o?eO(w,e,o):[]:w}function cK(t,e,r){const i=t.gltf.json;if(!i.meshes)return[];const n=[];for(const o of i.meshes)for(const s of o.primitives)uK(t,r,e,n,s);return n}function uK(t,e,r,i,n){const o={channels:r.channels,...r.texture},s=px(t,o,n);s&&J4(t,e,s,i,n)}const hK=Object.freeze(Object.defineProperty({__proto__:null,decode:KZ,name:ZZ},Symbol.toStringTag,{value:"Module"})),fK="4.2.4",dK="4.2.4",Gm={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let o3;async function a3(t){ek(t.modules);const e=tk("basis");return e||(o3||(o3=AK(t)),await o3)}async function AK(t){let e=null,r=null;return[e,r]=await Promise.all([await Rh(Gm.TRANSCODER,"textures",t),await Rh(Gm.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await pK(e,r)}function pK(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{const{BasisFile:o,initializeBasis:s}=n;s(),i({BasisFile:o})})})}let Rv;async function l3(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Rv=Rv||gK(t),await Rv)}async function gK(t){let e=null,r=null;return[e,r]=await Promise.all([await Rh(Gm.ENCODER,"textures",t),await Rh(Gm.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await mK(e,r)}function mK(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{const{BasisFile:o,KTX2File:s,initializeBasis:f,BasisEncoder:A}=n;f(),i({BasisFile:o,KTX2File:s,BasisEncoder:A})})})}const ed={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},_K=["","WEBKIT_","MOZ_"],c3={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Tg=null;function yK(t){if(!Tg){t=t||vK()||void 0,Tg=new Set;for(const e of _K)for(const r in c3)if(t&&t.getExtension(`${e}${r}`)){const i=c3[r];Tg.add(i)}}return Tg}function vK(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var u3,h3,f3,d3,A3,p3,g3,m3;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(u3||(u3={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(h3||(h3={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(f3||(f3={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(d3||(d3={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(A3||(A3={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(p3||(p3={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(g3||(g3={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(m3||(m3={}));const qo=[171,75,84,88,32,50,48,187,13,10,26,10];function bK(t){const e=new Uint8Array(t);return!(e.byteLength<qo.length||e[0]!==qo[0]||e[1]!==qo[1]||e[2]!==qo[2]||e[3]!==qo[3]||e[4]!==qo[4]||e[5]!==qo[5]||e[6]!==qo[6]||e[7]!==qo[7]||e[8]!==qo[8]||e[9]!==qo[9]||e[10]!==qo[10]||e[11]!==qo[11])}const xK={etc1:{basisFormat:0,compressed:!0,format:ed.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:ed.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:ed.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:ed.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:ed.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:ed.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function wK(t,e){if(e.basis.containerFormat==="auto"){if(bK(t)){const i=await l3(e);return _3(i.KTX2File,t,e)}const{BasisFile:r}=await a3(e);return Bv(r,t,e)}switch(e.basis.module){case"encoder":const r=await l3(e);switch(e.basis.containerFormat){case"ktx2":return _3(r.KTX2File,t,e);case"basis":default:return Bv(r.BasisFile,t,e)}case"transcoder":default:const{BasisFile:i}=await a3(e);return Bv(i,t,e)}}function Bv(t,e,r){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const n=i.getNumImages(),o=[];for(let s=0;s<n;s++){const f=i.getNumLevels(s),A=[];for(let v=0;v<f;v++)A.push(TK(i,s,v,r));o.push(A)}return o}finally{i.close(),i.delete()}}function TK(t,e,r,i){const n=t.getImageWidth(e,r),o=t.getImageHeight(e,r),s=t.getHasAlpha(),{compressed:f,format:A,basisFormat:v}=nO(i,s),w=t.getImageTranscodedSizeInBytes(e,r,v),C=new Uint8Array(w);if(!t.transcodeImage(C,e,r,v,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:o,data:C,compressed:f,format:A,hasAlpha:s}}function _3(t,e,r){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=i.getLevels(),o=[];for(let s=0;s<n;s++){o.push(EK(i,s,r));break}return[o]}finally{i.close(),i.delete()}}function EK(t,e,r){const{alphaFlag:i,height:n,width:o}=t.getImageLevelInfo(e,0,0),{compressed:s,format:f,basisFormat:A}=nO(r,i),v=t.getImageTranscodedSizeInBytes(e,0,0,A),w=new Uint8Array(v);if(!t.transcodeImage(w,e,0,0,A,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:w,compressed:s,levelSize:v,hasAlpha:i,format:f}}function nO(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=sO()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),xK[r]}function sO(){const t=yK();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const SK={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:dK,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},CK={...SK,parse:wK},eA=!0,y3=1735152710,_x=12,Wm=8,PK=1313821514,IK=5130562,MK=0,RK=0,BK=1;function OK(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function DK(t,e=0,r={}){const i=new DataView(t),{magic:n=y3}=r,o=i.getUint32(e,!1);return o===n||o===y3}function FK(t,e,r=0,i={}){const n=new DataView(e),o=OK(n,r+0),s=n.getUint32(r+4,eA),f=n.getUint32(r+8,eA);switch(Object.assign(t,{header:{byteOffset:r,byteLength:f,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),r+=_x,t.version){case 1:return LK(t,n,r);case 2:return kK(t,n,r,i={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function LK(t,e,r){Ni(t.header.byteLength>_x+Wm);const i=e.getUint32(r+0,eA),n=e.getUint32(r+4,eA);return r+=Wm,Ni(n===MK),Sb(t,e,r,i),r+=i,r+=Cb(t,e,r,t.header.byteLength),r}function kK(t,e,r,i){return Ni(t.header.byteLength>_x+Wm),NK(t,e,r,i),r+t.header.byteLength}function NK(t,e,r,i){for(;r+8<=t.header.byteLength;){const n=e.getUint32(r+0,eA),o=e.getUint32(r+4,eA);switch(r+=Wm,o){case PK:Sb(t,e,r,n);break;case IK:Cb(t,e,r,n);break;case RK:i.strict||Sb(t,e,r,n);break;case BK:i.strict||Cb(t,e,r,n);break}r+=i0(n,4)}return r}function Sb(t,e,r,i){const n=new Uint8Array(e.buffer,r,i),s=new TextDecoder("utf8").decode(n);return t.json=JSON.parse(s),i0(i,4)}function Cb(t,e,r,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:i,arrayBuffer:e.buffer}),i0(i,4)}function oO(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const i=e.baseUri||e.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return i.substr(0,i.lastIndexOf("/")+1)+t}const UK="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",zK="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",VK=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),jK=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),HK={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},GK={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function WK(t,e,r,i,n,o="NONE"){const s=await XK();ZK(s,s.exports[GK[n]],t,e,r,i,s.exports[HK[o||"NONE"]])}let Ov;async function XK(){return Ov||(Ov=qK()),Ov}async function qK(){let t=UK;WebAssembly.validate(VK)&&(t=zK,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate($K(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function $K(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){const n=t.charCodeAt(i);e[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let r=0;for(let i=0;i<t.length;++i)e[r++]=e[i]<60?jK[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,r)}function ZK(t,e,r,i,n,o,s){const f=t.exports.sbrk,A=i+3&-4,v=f(A*n),w=f(o.length),C=new Uint8Array(t.exports.memory.buffer);C.set(o,w);const I=e(v,i,n,w,o.length);if(I===0&&s&&s(v,A,n),r.set(C.subarray(v,v+i*n)),f(v-f(0)),I!==0)throw new Error(`Malformed buffer data: ${I}`)}const Xm="EXT_meshopt_compression",KK=Xm;async function YK(t,e){var n,o;const r=new qs(t);if(!((n=e==null?void 0:e.gltf)!=null&&n.decompressMeshes)||!((o=e.gltf)!=null&&o.loadBuffers))return;const i=[];for(const s of t.json.bufferViews||[])i.push(JK(r,s));await Promise.all(i),r.removeExtension(Xm)}async function JK(t,e){const r=t.getObjectExtension(e,Xm);if(r){const{byteOffset:i=0,byteLength:n=0,byteStride:o,count:s,mode:f,filter:A="NONE",buffer:v}=r,w=t.gltf.buffers[v],C=new Uint8Array(w.arrayBuffer,w.byteOffset+i,n),I=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await WK(I,s,o,C,f,A),t.removeObjectExtension(e,Xm)}}const QK=Object.freeze(Object.defineProperty({__proto__:null,decode:YK,name:KK},Symbol.toStringTag,{value:"Module"})),gd="EXT_texture_webp",eY=gd;function tY(t,e){const r=new qs(t);if(!R5("image/webp")){if(r.getRequiredExtensions().includes(gd))throw new Error(`gltf: Required extension ${gd} not supported by browser`);return}const{json:i}=r;for(const n of i.textures||[]){const o=r.getObjectExtension(n,gd);o&&(n.source=o.source),r.removeObjectExtension(n,gd)}r.removeExtension(gd)}const rY=Object.freeze(Object.defineProperty({__proto__:null,name:eY,preprocess:tY},Symbol.toStringTag,{value:"Module"})),lm="KHR_texture_basisu",iY=lm;function nY(t,e){const r=new qs(t),{json:i}=r;for(const n of i.textures||[]){const o=r.getObjectExtension(n,lm);o&&(n.source=o.source,r.removeObjectExtension(n,lm))}r.removeExtension(lm)}const sY=Object.freeze(Object.defineProperty({__proto__:null,name:iY,preprocess:nY},Symbol.toStringTag,{value:"Module"})),oY="4.2.4",aY={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:oY,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function lY(t,e,r){const i=aO(e.metadata),n=[],o=cY(e.attributes);for(const s in t){const f=t[s],A=v3(s,f,o[s]);n.push(A)}if(r){const s=v3("indices",r);n.push(s)}return{fields:n,metadata:i}}function cY(t){const e={};for(const r in t){const i=t[r];e[i.name||"undefined"]=i}return e}function v3(t,e,r){const i=r?aO(r.metadata):void 0;return K8(t,e,i)}function aO(t){Object.entries(t);const e={};for(const r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}const b3={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},uY={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},hY=4;class fY{constructor(e){U(this,"draco");U(this,"decoder");U(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,r={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(r);const n=this.decoder.GetEncodedGeometryType(i),o=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(n){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(i,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(i,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){const I=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(I)}const f=this._getDracoLoaderData(o,n,r),A=this._getMeshData(o,f,r),v=m2(A.attributes),w=lY(A.attributes,f,A.indices);return{loader:"draco",loaderData:f,header:{vertexCount:o.num_points(),boundingBox:v},...A,schema:w}}finally{this.draco.destroy(i),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,r,i){const n=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,i);return{geometry_type:r,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:o}}_getDracoAttributes(e,r){const i={};for(let n=0;n<e.num_attributes();n++){const o=this.decoder.GetAttribute(e,n),s=this._getAttributeMetadata(e,n);i[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:n,metadata:s};const f=this._getQuantizationTransform(o,r);f&&(i[o.unique_id()].quantization_transform=f);const A=this._getOctahedronTransform(o,r);A&&(i[o.unique_id()].octahedron_transform=A)}return i}_getMeshData(e,r,i){const n=this._getMeshAttributes(r,e,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,r,i){const n={};for(const o of Object.values(e.attributes)){const s=this._deduceAttributeName(o,i);o.name=s;const f=this._getAttributeValues(r,o);if(f){const{value:A,size:v}=f;n[s]={value:A,size:v,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return n}_getTriangleListIndices(e){const i=e.num_faces()*3,n=i*hY,o=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,o),new Uint32Array(this.draco.HEAPF32.buffer,o,i).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,r),pY(r)}finally{this.draco.destroy(r)}}_getAttributeValues(e,r){const i=uY[r.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;const n=r.num_components,s=e.num_points()*n,f=s*i.BYTES_PER_ELEMENT,A=dY(this.draco,i);let v;const w=this.draco._malloc(f);try{const C=this.decoder.GetAttribute(e,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,C,A,f,w),v=new i(this.draco.HEAPF32.buffer,w,s).slice()}finally{this.draco._free(w)}return{value:v,size:n}}_deduceAttributeName(e,r){const i=e.unique_id;for(const[s,f]of Object.entries(r.extraAttributes||{}))if(f===i)return s;const n=e.attribute_type;for(const s in b3)if(this.draco[s]===n)return b3[s];const o=r.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){const r=this.decoder.GetMetadata(e);return this._getDracoMetadata(r)}_getAttributeMetadata(e,r){const i=this.decoder.GetAttributeMetadata(e,r);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const r={},i=this.metadataQuerier.NumEntries(e);for(let n=0;n<i;n++){const o=this.metadataQuerier.GetEntryName(e,n);r[o]=this._getDracoMetadataField(e,o)}return r}_getDracoMetadataField(e,r){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,r,i);const n=AY(i);return{int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:r=[],octahedronAttributes:i=[]}=e,n=[...r,...i];for(const o of n)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,r){const{quantizedAttributes:i=[]}=r,n=e.attribute_type();if(i.map(s=>this.decoder[s]).includes(n)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(f=>s.min_value(f))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(e,r){const{octahedronAttributes:i=[]}=r,n=e.attribute_type();if(i.map(s=>this.decoder[s]).includes(n)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}function dY(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function AY(t){const e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}function pY(t){const e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}const gY="1.5.6",mY="1.4.1",Dv=`https://www.gstatic.com/draco/versioned/decoders/${gY}`,Co={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Fv={[Co.DECODER]:`${Dv}/${Co.DECODER}`,[Co.DECODER_WASM]:`${Dv}/${Co.DECODER_WASM}`,[Co.FALLBACK_DECODER]:`${Dv}/${Co.FALLBACK_DECODER}`,[Co.ENCODER]:`https://raw.githubusercontent.com/google/draco/${mY}/javascript/${Co.ENCODER}`};let Lv;async function _Y(t){const e=t.modules||{};return e.draco3d?Lv||(Lv=e.draco3d.createDecoderModule({}).then(r=>({draco:r}))):Lv||(Lv=yY(t)),await Lv}async function yY(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await Rh(Fv[Co.FALLBACK_DECODER],"draco",t,Co.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await Rh(Fv[Co.DECODER],"draco",t,Co.DECODER),await Rh(Fv[Co.DECODER_WASM],"draco",t,Co.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await vY(e,r)}function vY(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(i=>{t({...r,onModuleLoaded:n=>i({draco:n})})})}const lO={...aY,parse:bY};async function bY(t,e){const{draco:r}=await _Y(e),i=new fY(r);try{return i.parseSync(t,e==null?void 0:e.draco)}finally{i.destroy()}}function xY(t){const e={};for(const r in t){const i=t[r];if(r!=="indices"){const n=cO(i);e[r]=n}}return e}function cO(t){const{buffer:e,size:r,count:i}=wY(t);return{value:e,size:r,byteOffset:0,count:i,type:$4(r),componentType:fx(e)}}function wY(t){let e=t,r=1,i=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=TY(e,Float32Array)),i=e.length/r),{buffer:e,size:r,count:i}}function TY(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}const Lh="KHR_draco_mesh_compression",EY=Lh;function SY(t,e,r){const i=new qs(t);for(const n of uO(i))i.getObjectExtension(n,Lh)}async function CY(t,e,r){var o;if(!((o=e==null?void 0:e.gltf)!=null&&o.decompressMeshes))return;const i=new qs(t),n=[];for(const s of uO(i))i.getObjectExtension(s,Lh)&&n.push(IY(i,s,e,r));await Promise.all(n),i.removeExtension(Lh)}function PY(t,e={}){const r=new qs(t);for(const i of r.json.meshes||[])MY(),r.addRequiredExtension(Lh)}async function IY(t,e,r,i){const n=t.getObjectExtension(e,Lh);if(!n)return;const o=t.getTypedArrayForBufferView(n.bufferView),s=h2(o.buffer,o.byteOffset),f={...r};delete f["3d-tiles"];const A=await aA(s,lO,f,i),v=xY(A.attributes);for(const[w,C]of Object.entries(v))if(w in e.attributes){const I=e.attributes[w],B=t.getAccessor(I);B!=null&&B.min&&(B!=null&&B.max)&&(C.min=B.min,C.max=B.max)}e.attributes=v,A.indices&&(e.indices=cO(A.indices)),t.removeObjectExtension(e,Lh),RY(e)}function MY(t,e,r=4,i,n){if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided")}function RY(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*uO(t){for(const e of t.json.meshes||[])for(const r of e.primitives)yield r}const BY=Object.freeze(Object.defineProperty({__proto__:null,decode:CY,encode:PY,name:EY,preprocess:SY},Symbol.toStringTag,{value:"Module"})),F_="KHR_texture_transform",OY=F_,Eg=new Ke,DY=new Mn,FY=new Mn;async function LY(t,e){var o;if(!new qs(t).hasExtension(F_)||!((o=e.gltf)!=null&&o.loadBuffers))return;const n=t.json.materials||[];for(let s=0;s<n.length;s++)kY(s,t)}function kY(t,e){var o,s,f,A;const r=(o=e.json.materials)==null?void 0:o[t],i=[(s=r==null?void 0:r.pbrMetallicRoughness)==null?void 0:s.baseColorTexture,r==null?void 0:r.emissiveTexture,r==null?void 0:r.normalTexture,r==null?void 0:r.occlusionTexture,(f=r==null?void 0:r.pbrMetallicRoughness)==null?void 0:f.metallicRoughnessTexture],n=[];for(const v of i)v&&((A=v==null?void 0:v.extensions)!=null&&A[F_])&&NY(e,t,v,n)}function NY(t,e,r,i){const n=UY(r,i);if(!n)return;const o=t.json.meshes||[];for(const s of o)for(const f of s.primitives){const A=f.material;Number.isFinite(A)&&e===A&&zY(t,f,n)}}function UY(t,e){var s;const r=(s=t.extensions)==null?void 0:s[F_],{texCoord:i=0}=t,{texCoord:n=i}=r;if(!(e.findIndex(([f,A])=>f===i&&A===n)!==-1)){const f=HY(r);return i!==n&&(t.texCoord=n),e.push([i,n]),{originalTexCoord:i,texCoord:n,matrix:f}}return null}function zY(t,e,r){var f,A;const{originalTexCoord:i,texCoord:n,matrix:o}=r,s=e.attributes[`TEXCOORD_${i}`];if(Number.isFinite(s)){const v=(f=t.json.accessors)==null?void 0:f[s];if(v&&v.bufferView){const w=(A=t.json.bufferViews)==null?void 0:A[v.bufferView];if(w){const{arrayBuffer:C,byteOffset:I}=t.buffers[w.buffer],B=(I||0)+(v.byteOffset||0)+(w.byteOffset||0),{ArrayType:F,length:N}=dx(v,w),V=q4[v.componentType],G=X4[v.type],Y=w.byteStride||V*G,Z=new Float32Array(N);for(let se=0;se<v.count;se++){const ge=new F(C,B+se*Y,2);Eg.set(ge[0],ge[1],1),Eg.transformByMatrix3(o),Z.set([Eg[0],Eg[1]],se*G)}i===n?VY(v,w,t.buffers,Z):jY(n,v,e,t,Z)}}}}function VY(t,e,r,i){t.componentType=5126,r.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function jY(t,e,r,i,n){i.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const o=i.json.bufferViews;if(!o)return;o.push({buffer:i.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const s=i.json.accessors;s&&(s.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=s.length-1)}function HY(t){const{offset:e=[0,0],rotation:r=0,scale:i=[1,1]}=t,n=new Mn().set(1,0,0,0,1,0,e[0],e[1],1),o=DY.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),s=FY.set(i[0],0,0,0,i[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(s)}const GY=Object.freeze(Object.defineProperty({__proto__:null,decode:LY,name:OY},Symbol.toStringTag,{value:"Module"})),Ih="KHR_lights_punctual",WY=Ih;async function XY(t){const e=new qs(t),{json:r}=e,i=e.getExtension(Ih);i&&(e.json.lights=i.lights,e.removeExtension(Ih));for(const n of r.nodes||[]){const o=e.getObjectExtension(n,Ih);o&&(n.light=o.light),e.removeObjectExtension(n,Ih)}}async function qY(t){const e=new qs(t),{json:r}=e;if(r.lights){const i=e.addExtension(Ih);Yo(!i.lights),i.lights=r.lights,delete r.lights}if(e.json.lights){for(const i of e.json.lights){const n=i.node;e.addObjectExtension(n,Ih,i)}delete e.json.lights}}const $Y=Object.freeze(Object.defineProperty({__proto__:null,decode:XY,encode:qY,name:WY},Symbol.toStringTag,{value:"Module"})),qp="KHR_materials_unlit",ZY=qp;async function KY(t){const e=new qs(t),{json:r}=e;for(const i of r.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,qp);e.removeExtension(qp)}function YY(t){const e=new qs(t),{json:r}=e;if(e.materials)for(const i of r.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,qp,{}),e.addExtension(qp))}const JY=Object.freeze(Object.defineProperty({__proto__:null,decode:KY,encode:YY,name:ZY},Symbol.toStringTag,{value:"Module"})),gp="KHR_techniques_webgl",QY=gp;async function eJ(t){const e=new qs(t),{json:r}=e,i=e.getExtension(gp);if(i){const n=rJ(i,e);for(const o of r.materials||[]){const s=e.getObjectExtension(o,gp);s&&(o.technique=Object.assign({},s,n[s.technique]),o.technique.values=iJ(o.technique,e)),e.removeObjectExtension(o,gp)}e.removeExtension(gp)}}async function tJ(t,e){}function rJ(t,e){const{programs:r=[],shaders:i=[],techniques:n=[]}=t,o=new TextDecoder;return i.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(s=>{s.fragmentShader=i[s.fragmentShader],s.vertexShader=i[s.vertexShader]}),n.forEach(s=>{s.program=r[s.program]}),n}function iJ(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in r)&&(r[i]=t.uniforms[i].value)}),Object.keys(r).forEach(i=>{typeof r[i]=="object"&&r[i].index!==void 0&&(r[i].texture=e.getTexture(r[i].index))}),r}const nJ=Object.freeze(Object.defineProperty({__proto__:null,decode:eJ,encode:tJ,name:QY},Symbol.toStringTag,{value:"Module"})),hO=[$Z,MZ,QK,rY,sY,BY,$Y,JY,nJ,GY,hK];function sJ(t,e={},r){var n;const i=hO.filter(o=>fO(o.name,e));for(const o of i)(n=o.preprocess)==null||n.call(o,t,e,r)}async function oJ(t,e={},r){var n;const i=hO.filter(o=>fO(o.name,e));for(const o of i)await((n=o.decode)==null?void 0:n.call(o,t,e,r))}function fO(t,e){var n;const r=((n=e==null?void 0:e.gltf)==null?void 0:n.excludeExtensions)||{};return!(t in r&&!r[t])}const kv="KHR_binary_glTF";function aJ(t){const e=new qs(t),{json:r}=e;for(const i of r.images||[]){const n=e.getObjectExtension(i,kv);n&&Object.assign(i,n),e.removeObjectExtension(i,kv)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(kv)}const x3={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},lJ={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class cJ{constructor(){U(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});U(this,"json")}normalize(e,r){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),aJ(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const r in x3)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){const i=e[r];if(!(!i||Array.isArray(i))){e[r]=[];for(const n in i){const o=i[n];o.id=o.id||n;const s=e[r].length;e[r].push(o),this.idToIndexMap[r][n]=s}}}_convertObjectIdsToArrayIndices(e){for(const r in x3)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const r of e.meshes)this._convertMeshIds(r);for(const r of e.nodes)this._convertNodeIds(r);for(const r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const r of e.primitives){const{attributes:i,indices:n,material:o}=r;for(const s in i)i[s]=this._convertIdToIndex(i[s],"accessor");n&&(r.indices=this._convertIdToIndex(n,"accessor")),o&&(r.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(const i of e[r])for(const n in i){const o=i[n],s=this._convertIdToIndex(o,n);i[n]=s}}_convertIdToIndex(e,r){const i=lJ[r];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return n}return e}_updateObjects(e){for(const r of this.json.buffers)delete r.type}_updateMaterial(e){var r,i,n;for(const o of e.materials){o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((r=o.values)==null?void 0:r.tex)||((i=o.values)==null?void 0:i.texture2d_0)||((n=o.values)==null?void 0:n.diffuseTex),f=e.textures.findIndex(A=>A.id===s);f!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:f})}}}function uJ(t,e={}){return new cJ().normalize(t,e)}async function hJ(t,e,r=0,i,n){var o,s,f;return fJ(t,e,r,i),uJ(t,{normalize:(o=i==null?void 0:i.gltf)==null?void 0:o.normalize}),sJ(t,i,n),(s=i==null?void 0:i.gltf)!=null&&s.loadBuffers&&t.json.buffers&&await dJ(t,i,n),(f=i==null?void 0:i.gltf)!=null&&f.loadImages&&await AJ(t,i,n),await oJ(t,i,n),t}function fJ(t,e,r,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!DK(e,r,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=xk(e);else if(e instanceof ArrayBuffer){const s={};r=FK(s,e,r,i.glb),Yo(s.type==="glTF",`Invalid GLB magic string ${s.type}`),t._glb=s,t.json=s.json}else Yo(!1,"GLTF: must be ArrayBuffer or string");const n=t.json.buffers||[];if(t.buffers=new Array(n.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:s}=t._glb;t.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function dJ(t,e,r){var n,o;const i=t.json.buffers||[];for(let s=0;s<i.length;++s){const f=i[s];if(f.uri){const{fetch:A}=r;Yo(A);const v=oO(f.uri,e),w=await((n=r==null?void 0:r.fetch)==null?void 0:n.call(r,v)),C=await((o=w==null?void 0:w.arrayBuffer)==null?void 0:o.call(w));t.buffers[s]={arrayBuffer:C,byteOffset:0,byteLength:C.byteLength},delete f.uri}else t.buffers[s]===null&&(t.buffers[s]={arrayBuffer:new ArrayBuffer(f.byteLength),byteOffset:0,byteLength:f.byteLength})}}async function AJ(t,e,r){const i=pJ(t),n=t.json.images||[],o=[];for(const s of i)o.push(gJ(t,n[s],s,e,r));return await Promise.all(o)}function pJ(t){const e=new Set,r=t.json.textures||[];for(const i of r)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function gJ(t,e,r,i,n){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const f=oO(e.uri,i),{fetch:A}=n;o=await(await A(f)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const f=vZ(t.json,t.buffers,e.bufferView);o=h2(f.buffer,f.byteOffset,f.byteLength)}Yo(o,"glTF image has no data");let s=await aA(o,[Lp,CK],{...i,mimeType:e.mimeType,basis:i.basis||{format:sO()}},n);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),t.images=t.images||[],t.images[r]=s}const tA={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:fK,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:mJ,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function mJ(t,e={},r){e={...tA.options,...e},e.gltf={...tA.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await hJ({},t,i,e,r)}const _J={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},xa={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},vJ={magFilter:xa.TEXTURE_MAG_FILTER,minFilter:xa.TEXTURE_MIN_FILTER,wrapS:xa.TEXTURE_WRAP_S,wrapT:xa.TEXTURE_WRAP_T},bJ={[xa.TEXTURE_MAG_FILTER]:xa.LINEAR,[xa.TEXTURE_MIN_FILTER]:xa.NEAREST_MIPMAP_LINEAR,[xa.TEXTURE_WRAP_S]:xa.REPEAT,[xa.TEXTURE_WRAP_T]:xa.REPEAT};function xJ(){return{id:"default-sampler",parameters:bJ}}function wJ(t){return yJ[t]}function TJ(t){return _J[t]}class EJ{constructor(){U(this,"baseUri","");U(this,"jsonUnprocessed");U(this,"json");U(this,"buffers",[]);U(this,"images",[])}postProcess(e,r={}){const{json:i,buffers:n=[],images:o=[]}=e,{baseUri:s=""}=e;return Yo(i),this.baseUri=s,this.buffers=n,this.images=o,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,r),this.json}_resolveTree(e,r={}){const i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((n,o)=>this._resolveBufferView(n,o))),e.images&&(i.images=e.images.map((n,o)=>this._resolveImage(n,o))),e.samplers&&(i.samplers=e.samplers.map((n,o)=>this._resolveSampler(n,o))),e.textures&&(i.textures=e.textures.map((n,o)=>this._resolveTexture(n,o))),e.accessors&&(i.accessors=e.accessors.map((n,o)=>this._resolveAccessor(n,o))),e.materials&&(i.materials=e.materials.map((n,o)=>this._resolveMaterial(n,o))),e.meshes&&(i.meshes=e.meshes.map((n,o)=>this._resolveMesh(n,o))),e.nodes&&(i.nodes=e.nodes.map((n,o)=>this._resolveNode(n,o)),i.nodes=i.nodes.map((n,o)=>this._resolveNodeChildren(n))),e.skins&&(i.skins=e.skins.map((n,o)=>this._resolveSkin(n,o))),e.scenes&&(i.scenes=e.scenes.map((n,o)=>this._resolveScene(n,o))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,r){if(typeof r=="object")return r;const i=e&&e[r];return i||console.warn(`glTF file error: Could not find ${e}[${r}]`),i}_resolveScene(e,r){return{...e,id:e.id||`scene-${r}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,r){const i={...e,id:(e==null?void 0:e.id)||`node-${r}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((n,o)=>{const s=this.getMesh(o);return n.id=s.id,n.primitives=n.primitives.concat(s.primitives),n},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(r=>this.getNode(r))),e}_resolveSkin(e,r){const i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${r}`,inverseBindMatrices:i}}_resolveMesh(e,r){const i={...e,id:e.id||`mesh-${r}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(n=>{const o={...n,attributes:{},indices:void 0,material:void 0},s=n.attributes;for(const f in s)o.attributes[f]=this.getAccessor(s[f]);return n.indices!==void 0&&(o.indices=this.getAccessor(n.indices)),n.material!==void 0&&(o.material=this.getMaterial(n.material)),o})),i}_resolveMaterial(e,r){const i={...e,id:e.id||`material-${r}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};const n=i.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,r){const i=wJ(e.componentType),n=TJ(e.type),o=i*n,s={...e,id:e.id||`accessor-${r}`,bytesPerComponent:i,components:n,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const f=s.bufferView.buffer,{ArrayType:A,byteLength:v}=dx(s,s.bufferView),w=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+f.byteOffset;let C=f.arrayBuffer.slice(w,w+v);s.bufferView.byteStride&&(C=this._getValueFromInterleavedBuffer(f,w,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new A(C)}return s}_getValueFromInterleavedBuffer(e,r,i,n,o){const s=new Uint8Array(o*n);for(let f=0;f<o;f++){const A=r+f*i;s.set(new Uint8Array(e.arrayBuffer.slice(A,A+n)),f*n)}return s.buffer}_resolveTexture(e,r){return{...e,id:e.id||`texture-${r}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):xJ(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,r){const i={id:e.id||`sampler-${r}`,...e,parameters:{}};for(const n in i){const o=this._enumSamplerParameter(n);o!==void 0&&(i.parameters[o]=i[n])}return i}_enumSamplerParameter(e){return vJ[e]}_resolveImage(e,r){const i={...e,id:e.id||`image-${r}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},n=this.images[r];return n&&(i.image=n),i}_resolveBufferView(e,r){const i=e.buffer,n=this.buffers[i].arrayBuffer;let o=this.buffers[i].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${r}`,...e,buffer:this.buffers[i],data:new Uint8Array(n,o,e.byteLength)}}_resolveCamera(e,r){const i={...e,id:e.id||`camera-${r}`};return i.perspective,i.orthographic,i}}function yx(t,e){return new EJ().postProcess(t,e)}const SJ=t=>{throw new Error(`Reached a branch with non-exhaustive item: ${t}`)},CJ=({error:t,width:e,deltaType:r})=>t instanceof PJ?ms(Gy,{width:e,name:"No Mapbox token provided",message:Ll(aE,{children:[Ll("p",{children:["To use ",Ll(Hy,{children:["st.",r]})," or"," ",ms(Hy,{children:"st.map"})," you need to set up a Mapbox access token."]}),Ll("p",{children:["To get a token, create an account at"," ",ms("a",{href:"https://mapbox.com",children:"https://mapbox.com"}),". It's free for moderate usage levels!"]}),Ll("p",{children:["Once you have a token, just set it using the Streamlit config option ",ms(Hy,{children:"mapbox.token"})," and don't forget to restart your Streamlit server at this point if it's still running, then reload this tab."]}),Ll("p",{children:["See"," ",ms("a",{href:"https://docs.streamlit.io/develop/api-reference/configuration/config.toml",children:"our documentation"})," ","for more info on how to set config options."]})]})}):t instanceof dO?ms(Gy,{width:e,name:"Error fetching Streamlit Mapbox token",message:Ll(aE,{children:[ms("p",{children:"This app requires an internet connection."}),ms("p",{children:"Please check your connection and try again."}),Ll("p",{children:["If you think this is a bug, please file bug report"," ",ms("a",{href:"https://github.com/streamlit/streamlit/issues/new/choose",children:"here"}),"."]})]})}):ms(Gy,{width:e,name:"Error fetching Streamlit Mapbox token",message:t.message});class PJ extends Error{}class dO extends Error{}const w3="https://data.streamlit.io/tokens.json",T3="mapbox",IJ=t=>e=>{const i=class i extends it.PureComponent{constructor(o){super(o),this.initMapboxToken=async()=>{try{const s=await EL.get(w3),{[T3]:f}=s.data;if(!f)throw new Error(`Missing token ${T3}`);this.setState({mapboxToken:f,isFetching:!1})}catch(s){const f=IL(s);throw this.setState({mapboxTokenError:f,isFetching:!1}),new dO(`${f.message} (${w3})`)}},this.render=()=>{const{mapboxToken:s,mapboxTokenError:f,isFetching:A}=this.state,{width:v}=this.props;return f?ms(CJ,{width:v,error:f,deltaType:t}):A?ms(SL,{element:lE.create({style:lE.SkeletonStyle.ELEMENT})}):ms(e,{...this.props,mapboxToken:s,width:v})},this.state={isFetching:!0,mapboxToken:void 0,mapboxTokenError:void 0}}componentDidMount(){const o=this.props.element.mapboxToken||this.context.libConfig.mapboxToken;o?this.setState({mapboxToken:o,isFetching:!1}):this.initMapboxToken()}};i.displayName=`withMapboxToken(${e.displayName||e.name})`,i.contextType=CL;let r=i;return PL(r,e)},E3=HM("div",{target:"evcls2j0"})(({width:t,height:e})=>({position:"relative",height:e,width:t})),MJ=HM("div",{target:"evcls2j1"})(({theme:t})=>({position:"absolute",right:"2.625rem",top:t.spacing.md,zIndex:t.zIndices.priority,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:t.colors.bgColor},"button:not(:disabled)":{background:t.colors.bgColor,width:t.iconSizes.twoXL,height:t.iconSizes.twoXL,"& + button":{borderTopColor:t.colors.borderColor},".mapboxgl-ctrl-icon":{backgroundSize:t.iconSizes.twoXL,"&:hover":{backgroundColor:t.colors.darkenedBgMix25}},"& span":{filter:GM(t)?"":"invert(100%)"}}})),RJ=({container:t,element:e,heightFallback:r="auto",isFullScreen:i,shouldUseContainerWidth:n,widthFallback:o="auto"})=>{const s=it.useMemo(()=>n||i?"100%":e.width||t.width||o,[t.width,e.width,i,n,o]),f=it.useMemo(()=>i&&t.height?t.height:e.height||t.height||r,[i,e.height,t.height,r]);return{width:s,height:f}},BJ=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec3 positions;
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = positions.x;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, positions.y);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (useShortestPath) {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,OJ=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,qm=[0,0,0,255],DJ={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:qm},getTargetColor:{type:"accessor",value:qm},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class c0 extends Wn{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:BJ,fs:OJ,modules:[uo,Mo]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:qm},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:qm},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){var o;super.updateState(e);const{props:r,oldProps:i,changeFlags:n}=e;(n.extensionsChanged||r.numSegments!==i.numSegments)&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:r,widthScale:i,widthMinPixels:n,widthMaxPixels:o,greatCircle:s,wrapLongitude:f}=this.props,A=this.state.model;A.setUniforms(e),A.setUniforms({greatCircle:s,widthUnits:Qo[r],widthScale:i,widthMinPixels:n,widthMaxPixels:o,useShortestPath:f}),A.draw(this.context.renderPass)}_getModel(){const{numSegments:e}=this.props;let r=[];for(let n=0;n<e;n++)r=r.concat([n,1,0,n,-1,0]);const i=new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _s({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(r)}}}),isInstanced:!0});return i.setUniforms({numSegments:e}),i}}c0.layerName="ArcLayer";c0.defaultProps=DJ;const FJ=new Uint32Array([0,2,1,0,3,2]),LJ=new Float32Array([0,1,0,0,1,0,1,1]);function kJ(t,e){if(!e)return NJ(t);const r=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),n=Math.ceil(r/e)+1,o=Math.ceil(i/e)+1,s=(n-1)*(o-1)*6,f=new Uint32Array(s),A=new Float32Array(n*o*2),v=new Float64Array(n*o*3);let w=0,C=0;for(let I=0;I<n;I++){const B=I/(n-1);for(let F=0;F<o;F++){const N=F/(o-1),V=UJ(t,B,N);v[w*3+0]=V[0],v[w*3+1]=V[1],v[w*3+2]=V[2]||0,A[w*2+0]=B,A[w*2+1]=1-N,I>0&&F>0&&(f[C++]=w-o,f[C++]=w-o-1,f[C++]=w-1,f[C++]=w-o,f[C++]=w-1,f[C++]=w),w++}}return{vertexCount:s,positions:v,indices:f,texCoords:A}}function NJ(t){const e=new Float64Array(12);for(let r=0;r<t.length;r++)e[r*3+0]=t[r][0],e[r*3+1]=t[r][1],e[r*3+2]=t[r][2]||0;return{vertexCount:6,positions:e,indices:FJ,texCoords:LJ}}function UJ(t,e,r){return el(el(t[0],t[1],r),el(t[3],t[2],r),e)}const zJ=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,VJ=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,jJ=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

${VJ}

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,HJ={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:br.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class L_ extends Wn{getShaders(){return super.getShaders({vs:zJ,fs:jJ,modules:[uo,Mo]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const r=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:r},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:r},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:r}})}updateState({props:e,oldProps:r,changeFlags:i}){var o;const n=this.getAttributeManager();if(i.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),n.invalidateAll()),e.bounds!==r.bounds){const s=this.state.mesh,f=this._createMesh();this.state.model.setVertexCount(f.vertexCount);for(const A in f)s&&s[A]!==f[A]&&n.invalidate(A);this.setState({mesh:f,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==r._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:r}=this.props,i=e.info;if(!i.color||!r)return i.bitmap=null,i;const{width:n,height:o}=r;i.index=0;const s=GJ(i.color);return i.bitmap={size:{width:n,height:o},uv:s,pixel:[Math.floor(s[0]*n),Math.floor(s[1]*o)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let r=e;return S3(e)&&(r=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),kJ(r,this.context.viewport.resolution)}_getModel(){return new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{uniforms:r,moduleParameters:i}=e,{model:n,coordinateConversion:o,bounds:s,disablePicking:f}=this.state,{image:A,desaturate:v,transparentColor:w,tintColor:C}=this.props;i.picking.isActive&&f||A&&n&&(n.setUniforms(r),n.setBindings({bitmapTexture:A}),n.setUniforms({desaturate:v,transparentColor:w.map(I=>I/255),tintColor:C.slice(0,3).map(I=>I/255),coordinateConversion:o,bounds:s}),n.draw(this.context.renderPass))}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:r,DEFAULT:i}=br;let{_imageCoordinateSystem:n}=this.props;if(n!==i){const{bounds:o}=this.props;if(!S3(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const s=this.context.viewport.resolution?e:r;if(n=n===e?e:r,n===e&&s===r)return{coordinateConversion:-1,bounds:o};if(n===r&&s===e){const f=Rc([o[0],o[1]]),A=Rc([o[2],o[3]]);return{coordinateConversion:1,bounds:[f[0],f[1],A[0],A[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}L_.layerName="BitmapLayer";L_.defaultProps=HJ;function GJ(t){const[e,r,i]=t,n=(i&240)/256,o=(i&15)/16;return[(e+o)/256,(r+n)/256]}function S3(t){return Number.isFinite(t[0])}const WJ=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,XJ=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,qJ=1024,$J=4,C3=()=>{},P3={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},ZJ={x:0,y:0,width:0,height:0};function KJ(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function YJ(t,e,r,i){const n=Math.min(r/e.width,i/e.height),o=Math.floor(e.width*n),s=Math.floor(e.height*n);return n===1?{data:e,width:o,height:s}:(t.canvas.height=s,t.canvas.width=o,t.clearRect(0,0,o,s),t.drawImage(e,0,0,e.width,e.height,0,0,o,s),{data:t.canvas,width:o,height:s})}function $p(t){return t&&(t.id||t.url)}function JJ(t,e,r,i){const{width:n,height:o,device:s}=t,f=s.createTexture({format:"rgba8unorm",width:e,height:r,sampler:i}),A=s.createCommandEncoder();return A.copyTextureToTexture({source:t,destination:f,width:n,height:o}),A.finish(),t.destroy(),f}function I3(t,e,r){for(let i=0;i<e.length;i++){const{icon:n,xOffset:o}=e[i],s=$p(n);t[s]={...n,x:o,y:r}}}function QJ({icons:t,buffer:e,mapping:r={},xOffset:i=0,yOffset:n=0,rowHeight:o=0,canvasWidth:s}){let f=[];for(let A=0;A<t.length;A++){const v=t[A],w=$p(v);if(!r[w]){const{height:C,width:I}=v;i+I+e>s&&(I3(r,f,n),i=0,n=o+n+e,o=0,f=[]),f.push({icon:v,xOffset:i}),i=i+I+e,o=Math.max(o,C)}}return f.length>0&&I3(r,f,n),{mapping:r,rowHeight:o,xOffset:i,yOffset:n,canvasWidth:s,canvasHeight:KJ(o+n+e)}}function eQ(t,e,r){if(!t||!e)return null;r=r||{};const i={},{iterable:n,objectInfo:o}=ql(t);for(const s of n){o.index++;const f=e(s,o),A=$p(f);if(!f)throw new Error("Icon is missing.");if(!f.url)throw new Error("Icon url is missing.");!i[A]&&(!r[A]||f.url!==r[A].url)&&(i[A]={...f,source:s,sourceIndex:o.index})}return i}class tQ{constructor(e,{onUpdate:r=C3,onError:i=C3}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=$J,this._canvasWidth=qJ,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=r,this.onError=i}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const r=this._autoPacking?$p(e):e;return this._mapping[r]||ZJ}setProps({loadOptions:e,autoPacking:r,iconAtlas:i,iconMapping:n,textureParameters:o}){var s;e&&(this._loadOptions=e),r!==void 0&&(this._autoPacking=r),n&&(this._mapping=n),i&&((s=this._texture)==null||s.delete(),this._texture=null,this._externalTexture=i),o&&(this._textureParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,r){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(eQ(e,r,this._mapping)||{});if(i.length>0){const{mapping:n,xOffset:o,yOffset:s,rowHeight:f,canvasHeight:A}=QJ({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=f,this._mapping=n,this._xOffset=o,this._yOffset=s,this._canvasHeight=A,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||P3})),this._texture.height!==this._canvasHeight&&(this._texture=JJ(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||P3)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const r=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,Ic(i.url,this._loadOptions).then(n=>{const o=$p(i),s=this._mapping[o],{x:f,y:A,width:v,height:w}=s,{data:C,width:I,height:B}=YJ(r,n,v,w);this._texture.setSubImageData({data:C,x:f+(v-I)/2,y:A+(w-B)/2,width:I,height:B}),s.width=I,s.height=B,this._texture.generateMipmap(),this.onUpdate()}).catch(n=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:n})}).finally(()=>{this._pendingCount--})}}const AO=[0,0,0,255],rQ={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:AO},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class dA extends Wn{getShaders(){return super.getShaders({vs:WJ,fs:XJ,modules:[uo,Mo]})}initializeState(){this.state={iconManager:new tQ(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:AO},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var B;super.updateState(e);const{props:r,oldProps:i,changeFlags:n}=e,o=this.getAttributeManager(),{iconAtlas:s,iconMapping:f,data:A,getIcon:v,textureParameters:w}=r,{iconManager:C}=this.state;if(typeof s=="string")return;const I=s||this.internalState.isAsyncPropLoading("iconAtlas");C.setProps({loadOptions:r.loadOptions,autoPacking:!I,iconAtlas:s,iconMapping:I?f:null,textureParameters:w}),I?i.iconMapping!==r.iconMapping&&o.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&C.packIcons(A,v),n.extensionsChanged&&((B=this.state.model)==null||B.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:r,sizeMinPixels:i,sizeMaxPixels:n,sizeUnits:o,billboard:s,alphaCutoff:f}=this.props,{iconManager:A}=this.state,v=A.getTexture();if(v){const w=this.state.model;w.setBindings({iconsTexture:v}),w.setUniforms(e),w.setUniforms({iconsTextureDim:[v.width,v.height],sizeUnits:Qo[o],sizeScale:r,sizeMinPixels:i,sizeMaxPixels:n,billboard:s,alphaCutoff:f}),w.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _s({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var i;const r=(i=this.getCurrentLayer())==null?void 0:i.props.onIconError;r?r(e):fr.error(e.error.message)()}getInstanceOffset(e){const{width:r,height:i,anchorX:n=r/2,anchorY:o=i/2}=this.state.iconManager.getIconMapping(e);return[r/2-n,i/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:r,y:i,width:n,height:o}=this.state.iconManager.getIconMapping(e);return[r,i,n,o]}}dA.defaultProps=rQ;dA.layerName="IconLayer";const iQ=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (useShortestPath > 0.5 || useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * useShortestPath > 180.) {
source_world.x += 360. * useShortestPath;
source_world = splitLine(source_world, target_world, 180. * useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * useShortestPath < -180.) {
target_world.x += 360. * useShortestPath;
target_world = splitLine(source_world, target_world, 180. * useShortestPath);
target_world_64low = vec3(0.0);
} else if (useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nQ=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,sQ=[0,0,0,255],oQ={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:sQ},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class u0 extends Wn{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:iQ,fs:nQ,modules:[uo,Mo]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e),e.changeFlags.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:r,widthScale:i,widthMinPixels:n,widthMaxPixels:o,wrapLongitude:s}=this.props,f=this.state.model;f.setUniforms(e),f.setUniforms({widthUnits:Qo[r],widthScale:i,widthMinPixels:n,widthMaxPixels:o,useShortestPath:s?1:0}),f.draw(this.context.renderPass),s&&(f.setUniforms({useShortestPath:-1}),f.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _s({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}u0.layerName="LineLayer";u0.defaultProps=oQ;const aQ=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,lQ=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,pO=[0,0,0,255],gO=[0,0,1],cQ={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:gO},getColor:{type:"accessor",value:pO},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function uQ(t){const{header:e,attributes:r}=t;if(!(!e||!r)&&(t.length=e.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){const{size:i,value:n}=r.COLOR_0;r.instanceColors={size:i,type:"unorm8",value:n}}}class h0 extends Wn{getShaders(){return super.getShaders({vs:aQ,fs:lQ,modules:[uo,E_,Mo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:gO},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:pO}})}updateState(e){var n;const{changeFlags:r,props:i}=e;super.updateState(e),r.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&uQ(i.data)}draw({uniforms:e}){const{pointSize:r,sizeUnits:i}=this.props,n=this.state.model;n.setUniforms(e),n.setUniforms({sizeUnits:Qo[i],radiusPixels:r}),n.draw(this.context.renderPass)}_getModel(){const e=[];for(let r=0;r<3;r++){const i=r/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _s({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}h0.layerName="PointCloudLayer";h0.defaultProps=cQ;const hQ=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,fQ=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,M3=[0,0,0,255],dQ={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:M3},getLineColor:{type:"accessor",value:M3},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class f0 extends Wn{getShaders(){return super.getShaders({vs:hQ,fs:fQ,modules:[uo,Mo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e),e.changeFlags.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:r,radiusScale:i,radiusMinPixels:n,radiusMaxPixels:o,stroked:s,filled:f,billboard:A,antialiasing:v,lineWidthUnits:w,lineWidthScale:C,lineWidthMinPixels:I,lineWidthMaxPixels:B}=this.props,F=this.state.model;F.setUniforms(e),F.setUniforms({stroked:s?1:0,filled:f,billboard:A,antialiasing:v,radiusUnits:Qo[r],radiusScale:i,radiusMinPixels:n,radiusMaxPixels:o,lineWidthUnits:Qo[w],lineWidthScale:C,lineWidthMinPixels:I,lineWidthMaxPixels:B}),F.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _s({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}f0.defaultProps=dQ;f0.layerName="ScatterplotLayer";const vx={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function bx(t,e,r={}){return AQ(t,r)!==e?(pQ(t,r),!0):!1}function AQ(t,e={}){return Math.sign(Zm(t,e))}const $m={x:0,y:1,z:2};function Zm(t,e={}){const{start:r=0,end:i=t.length,plane:n="xy"}=e,o=e.size||2;let s=0;const f=$m[n[0]],A=$m[n[1]];for(let v=r,w=i-o;v<i;v+=o)s+=(t[v+f]-t[w+f])*(t[v+A]+t[w+A]),w=v;return s/2}function pQ(t,e){const{start:r=0,end:i=t.length,size:n=2}=e,o=(i-r)/n,s=Math.floor(o/2);for(let f=0;f<s;++f){const A=r+f*n,v=r+(o-1-f)*n;for(let w=0;w<n;++w){const C=t[A+w];t[A+w]=t[v+w],t[v+w]=C}}}function gQ(t,e,r=2,i,n="xy"){const o=e&&e.length,s=o?e[0]*r:t.length;let f=mO(t,0,s,r,!0,i&&i[0],n);const A=[];if(!f||f.next===f.prev)return A;let v,w,C,I,B,F,N;if(o&&(f=bQ(t,e,f,r,i,n)),t.length>80*r){I=w=t[0],B=C=t[1];for(let V=r;V<s;V+=r)F=t[V],N=t[V+1],F<I&&(I=F),N<B&&(B=N),F>w&&(w=F),N>C&&(C=N);v=Math.max(w-I,C-B),v=v!==0?32767/v:0}return Zp(f,A,r,I,B,v,0),A}function mO(t,e,r,i,n,o,s){let f,A;o===void 0&&(o=Zm(t,{start:e,end:r,size:i,plane:s}));let v=$m[s[0]],w=$m[s[1]];if(n===o<0)for(f=e;f<r;f+=i)A=R3(f,t[f+v],t[f+w],A);else for(f=r-i;f>=e;f-=i)A=R3(f,t[f+v],t[f+w],A);return A&&k_(A,A.next)&&(Yp(A),A=A.next),A}function kh(t,e){if(!t)return t;e||(e=t);let r=t,i;do if(i=!1,!r.steiner&&(k_(r,r.next)||An(r.prev,r,r.next)===0)){if(Yp(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function Zp(t,e,r,i,n,o,s){if(!t)return;!s&&o&&SQ(t,i,n,o);let f=t,A,v;for(;t.prev!==t.next;){if(A=t.prev,v=t.next,o?_Q(t,i,n,o):mQ(t)){e.push(A.i/r|0),e.push(t.i/r|0),e.push(v.i/r|0),Yp(t),t=v.next,f=v.next;continue}if(t=v,t===f){s?s===1?(t=yQ(kh(t),e,r),Zp(t,e,r,i,n,o,2)):s===2&&vQ(t,e,r,i,n,o):Zp(kh(t),e,r,i,n,o,1);break}}}function mQ(t){const e=t.prev,r=t,i=t.next;if(An(e,r,i)>=0)return!1;const n=e.x,o=r.x,s=i.x,f=e.y,A=r.y,v=i.y,w=n<o?n<s?n:s:o<s?o:s,C=f<A?f<v?f:v:A<v?A:v,I=n>o?n>s?n:s:o>s?o:s,B=f>A?f>v?f:v:A>v?A:v;let F=i.next;for(;F!==e;){if(F.x>=w&&F.x<=I&&F.y>=C&&F.y<=B&&Ed(n,f,o,A,s,v,F.x,F.y)&&An(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function _Q(t,e,r,i){const n=t.prev,o=t,s=t.next;if(An(n,o,s)>=0)return!1;const f=n.x,A=o.x,v=s.x,w=n.y,C=o.y,I=s.y,B=f<A?f<v?f:v:A<v?A:v,F=w<C?w<I?w:I:C<I?C:I,N=f>A?f>v?f:v:A>v?A:v,V=w>C?w>I?w:I:C>I?C:I,G=Pb(B,F,e,r,i),Y=Pb(N,V,e,r,i);let Z=t.prevZ,se=t.nextZ;for(;Z&&Z.z>=G&&se&&se.z<=Y;){if(Z.x>=B&&Z.x<=N&&Z.y>=F&&Z.y<=V&&Z!==n&&Z!==s&&Ed(f,w,A,C,v,I,Z.x,Z.y)&&An(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,se.x>=B&&se.x<=N&&se.y>=F&&se.y<=V&&se!==n&&se!==s&&Ed(f,w,A,C,v,I,se.x,se.y)&&An(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;Z&&Z.z>=G;){if(Z.x>=B&&Z.x<=N&&Z.y>=F&&Z.y<=V&&Z!==n&&Z!==s&&Ed(f,w,A,C,v,I,Z.x,Z.y)&&An(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;se&&se.z<=Y;){if(se.x>=B&&se.x<=N&&se.y>=F&&se.y<=V&&se!==n&&se!==s&&Ed(f,w,A,C,v,I,se.x,se.y)&&An(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function yQ(t,e,r){let i=t;do{const n=i.prev,o=i.next.next;!k_(n,o)&&_O(n,i,i.next,o)&&Kp(n,o)&&Kp(o,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(o.i/r|0),Yp(i),Yp(i.next),i=t=o),i=i.next}while(i!==t);return kh(i)}function vQ(t,e,r,i,n,o){let s=t;do{let f=s.next.next;for(;f!==s.prev;){if(s.i!==f.i&&IQ(s,f)){let A=yO(s,f);s=kh(s,s.next),A=kh(A,A.next),Zp(s,e,r,i,n,o,0),Zp(A,e,r,i,n,o,0);return}f=f.next}s=s.next}while(s!==t)}function bQ(t,e,r,i,n,o){const s=[];let f,A,v,w,C;for(f=0,A=e.length;f<A;f++)v=e[f]*i,w=f<A-1?e[f+1]*i:t.length,C=mO(t,v,w,i,!1,n&&n[f+1],o),C===C.next&&(C.steiner=!0),s.push(PQ(C));for(s.sort(xQ),f=0;f<s.length;f++)r=wQ(s[f],r);return r}function xQ(t,e){return t.x-e.x}function wQ(t,e){const r=TQ(t,e);if(!r)return e;const i=yO(r,t);return kh(i,i.next),kh(r,r.next)}function TQ(t,e){let r=e;const i=t.x,n=t.y;let o=-1/0,s;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){const I=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(I<=i&&I>o&&(o=I,s=r.x<r.next.x?r:r.next,I===i))return s}r=r.next}while(r!==e);if(!s)return null;const f=s,A=s.x,v=s.y;let w=1/0,C;r=s;do i>=r.x&&r.x>=A&&i!==r.x&&Ed(n<v?i:o,n,A,v,n<v?o:i,n,r.x,r.y)&&(C=Math.abs(n-r.y)/(i-r.x),Kp(r,t)&&(C<w||C===w&&(r.x>s.x||r.x===s.x&&EQ(s,r)))&&(s=r,w=C)),r=r.next;while(r!==f);return s}function EQ(t,e){return An(t.prev,t,e.prev)<0&&An(e.next,t,t.next)<0}function SQ(t,e,r,i){let n=t;do n.z===0&&(n.z=Pb(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,CQ(n)}function CQ(t){let e,r,i=1,n,o,s,f,A,v;do{for(o=t,t=null,v=null,n=0;o;){for(n++,f=o,s=0,r=0;r<i&&(s++,f=f.nextZ,!!f);r++);for(A=i;s>0||A>0&&f;)s!==0&&(A===0||!f||o.z<=f.z)?(e=o,o=o.nextZ,s--):(e=f,f=f.nextZ,A--),v?v.nextZ=e:t=e,e.prevZ=v,v=e;o=f}v.nextZ=null,i*=2}while(n>1);return t}function Pb(t,e,r,i,n){return t=(t-r)*n|0,e=(e-i)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function PQ(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Ed(t,e,r,i,n,o,s,f){return(n-s)*(e-f)>=(t-s)*(o-f)&&(t-s)*(i-f)>=(r-s)*(e-f)&&(r-s)*(o-f)>=(n-s)*(i-f)}function IQ(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!MQ(t,e)&&(Kp(t,e)&&Kp(e,t)&&RQ(t,e)&&(An(t.prev,t,e.prev)||An(t,e.prev,e))||k_(t,e)&&An(t.prev,t,t.next)>0&&An(e.prev,e,e.next)>0)}function An(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function k_(t,e){return t.x===e.x&&t.y===e.y}function _O(t,e,r,i){const n=Cg(An(t,e,r)),o=Cg(An(t,e,i)),s=Cg(An(r,i,t)),f=Cg(An(r,i,e));return!!(n!==o&&s!==f||n===0&&Sg(t,r,e)||o===0&&Sg(t,i,e)||s===0&&Sg(r,t,i)||f===0&&Sg(r,e,i))}function Sg(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Cg(t){return t>0?1:t<0?-1:0}function MQ(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&_O(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Kp(t,e){return An(t.prev,t,t.next)<0?An(t,e,t.next)>=0&&An(t,t.prev,e)>=0:An(t,e,t.prev)<0||An(t,t.next,e)<0}function RQ(t,e){let r=t,i=!1;const n=(t.x+e.x)/2,o=(t.y+e.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function yO(t,e){const r=new Ib(t.i,t.x,t.y),i=new Ib(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function R3(t,e,r,i){const n=new Ib(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Yp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}class Ib{constructor(e,r,i){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=e,this.x=r,this.y=i}}function Ja(t,e){const r=e.length,i=t.length;if(i>0){let n=!0;for(let o=0;o<r;o++)if(t[i-r+o]!==e[o]){n=!1;break}if(n)return!1}for(let n=0;n<r;n++)t[i+n]=e[n];return!0}function Mb(t,e){const r=e.length;for(let i=0;i<r;i++)t[i]=e[i]}function Jp(t,e,r,i,n=[]){const o=i+e*r;for(let s=0;s<r;s++)n[s]=t[o+s];return n}function Rb(t,e,r,i,n=[]){let o,s;if(r&8)o=(i[3]-t[1])/(e[1]-t[1]),s=3;else if(r&4)o=(i[1]-t[1])/(e[1]-t[1]),s=1;else if(r&2)o=(i[2]-t[0])/(e[0]-t[0]),s=2;else if(r&1)o=(i[0]-t[0])/(e[0]-t[0]),s=0;else return null;for(let f=0;f<t.length;f++)n[f]=(s&1)===f?i[s]:o*(e[f]-t[f])+t[f];return n}function cm(t,e){let r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function vO(t,e){const{size:r=2,broken:i=!1,gridResolution:n=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:f=t.length}=e||{},A=(f-s)/r;let v=[];const w=[v],C=Jp(t,0,r,s);let I,B;const F=xO(C,n,o,[]),N=[];Ja(v,C);for(let V=1;V<A;V++){for(I=Jp(t,V,r,s,I),B=cm(I,F);B;){Rb(C,I,B,F,N);const G=cm(N,F);G&&(Rb(C,N,G,F,N),B=G),Ja(v,N),Mb(C,N),OQ(F,n,B),i&&v.length>r&&(v=[],w.push(v),Ja(v,C)),B=cm(I,F)}Ja(v,I),Mb(C,I)}return i?w:w[0]}const B3=0,BQ=1;function bO(t,e=null,r){if(!t.length)return[];const{size:i=2,gridResolution:n=10,gridOffset:o=[0,0],edgeTypes:s=!1}=r||{},f=[],A=[{pos:t,types:s?new Array(t.length/i).fill(BQ):null,holes:e||[]}],v=[[],[]];let w=[];for(;A.length;){const{pos:C,types:I,holes:B}=A.shift();DQ(C,i,B[0]||C.length,v),w=xO(v[0],n,o,w);const F=cm(v[1],w);if(F){let N=O3(C,I,i,0,B[0]||C.length,w,F);const V={pos:N[0].pos,types:N[0].types,holes:[]},G={pos:N[1].pos,types:N[1].types,holes:[]};A.push(V,G);for(let Y=0;Y<B.length;Y++)N=O3(C,I,i,B[Y],B[Y+1]||C.length,w,F),N[0]&&(V.holes.push(V.pos.length),V.pos=Pg(V.pos,N[0].pos),s&&(V.types=Pg(V.types,N[0].types))),N[1]&&(G.holes.push(G.pos.length),G.pos=Pg(G.pos,N[1].pos),s&&(G.types=Pg(G.types,N[1].types)))}else{const N={positions:C};s&&(N.edgeTypes=I),B.length&&(N.holeIndices=B),f.push(N)}}return f}function O3(t,e,r,i,n,o,s){const f=(n-i)/r,A=[],v=[],w=[],C=[],I=[];let B,F,N;const V=Jp(t,f-1,r,i);let G=Math.sign(s&8?V[1]-o[3]:V[0]-o[2]),Y=e&&e[f-1],Z=0,se=0;for(let ge=0;ge<f;ge++)B=Jp(t,ge,r,i,B),F=Math.sign(s&8?B[1]-o[3]:B[0]-o[2]),N=e&&e[i/r+ge],F&&G&&G!==F&&(Rb(V,B,s,o,I),Ja(A,I)&&w.push(Y),Ja(v,I)&&C.push(Y)),F<=0?(Ja(A,B)&&w.push(N),Z-=F):w.length&&(w[w.length-1]=B3),F>=0?(Ja(v,B)&&C.push(N),se+=F):C.length&&(C[C.length-1]=B3),Mb(V,B),G=F,Y=N;return[Z?{pos:A,types:e&&w}:null,se?{pos:v,types:e&&C}:null]}function xO(t,e,r,i){const n=Math.floor((t[0]-r[0])/e)*e+r[0],o=Math.floor((t[1]-r[1])/e)*e+r[1];return i[0]=n,i[1]=o,i[2]=n+e,i[3]=o+e,i}function OQ(t,e,r){r&8?(t[1]+=e,t[3]+=e):r&4?(t[1]-=e,t[3]-=e):r&2?(t[0]+=e,t[2]+=e):r&1&&(t[0]-=e,t[2]-=e)}function DQ(t,e,r,i){let n=1/0,o=-1/0,s=1/0,f=-1/0;for(let A=0;A<r;A+=e){const v=t[A],w=t[A+1];n=v<n?v:n,o=v>o?v:o,s=w<s?w:s,f=w>f?w:f}return i[0][0]=n,i[0][1]=s,i[1][0]=o,i[1][1]=f,i}function Pg(t,e){for(let r=0;r<e.length;r++)t.push(e[r]);return t}const FQ=85.051129;function LQ(t,e){const{size:r=2,startIndex:i=0,endIndex:n=t.length,normalize:o=!0}=e||{},s=t.slice(i,n);wO(s,r,0,n-i);const f=vO(s,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const A of f)TO(A,r);return f}function kQ(t,e=null,r){const{size:i=2,normalize:n=!0,edgeTypes:o=!1}=r||{};e=e||[];const s=[],f=[];let A=0,v=0;for(let C=0;C<=e.length;C++){const I=e[C]||t.length,B=v,F=NQ(t,i,A,I);for(let N=F;N<I;N++)s[v++]=t[N];for(let N=A;N<F;N++)s[v++]=t[N];wO(s,i,B,v),UQ(s,i,B,v,r==null?void 0:r.maxLatitude),A=I,f[C]=v}f.pop();const w=bO(s,f,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(n)for(const C of w)TO(C.positions,i);return w}function NQ(t,e,r,i){let n=-1,o=-1;for(let s=r+1;s<i;s+=e){const f=Math.abs(t[s]);f>n&&(n=f,o=s-1)}return o}function UQ(t,e,r,i,n=FQ){const o=t[r],s=t[i-e];if(Math.abs(o-s)>180){const f=Jp(t,0,e,r);f[0]+=Math.round((s-o)/360)*360,Ja(t,f),f[1]=Math.sign(f[1])*n,Ja(t,f),f[0]=o,Ja(t,f)}}function wO(t,e,r,i){let n=t[0],o;for(let s=r;s<i;s+=e){o=t[s];const f=o-n;(f>180||f<-180)&&(o-=Math.round(f/360)*360),t[s]=n=o}}function TO(t,e){let r;const i=t.length/e;for(let o=0;o<i&&(r=t[o*e],(r+180)%360===0);o++);const n=-Math.round(r/360)*360;if(n!==0)for(let o=0;o<i;o++)t[o*e]+=n}class zQ extends _s{constructor(e){const{indices:r,attributes:i}=VQ(e);super({...e,indices:r,attributes:i})}}function VQ(t){const{radius:e,height:r=1,nradial:i=10}=t;let{vertices:n}=t;n&&(fr.assert(n.length>=i),n=n.flatMap(B=>[B[0],B[1]]),bx(n,vx.COUNTER_CLOCKWISE));const o=r>0,s=i+1,f=o?s*3+1:i,A=Math.PI*2/i,v=new Uint16Array(o?i*3*2:0),w=new Float32Array(f*3),C=new Float32Array(f*3);let I=0;if(o){for(let B=0;B<s;B++){const F=B*A,N=B%i,V=Math.sin(F),G=Math.cos(F);for(let Y=0;Y<2;Y++)w[I+0]=n?n[N*2]:G*e,w[I+1]=n?n[N*2+1]:V*e,w[I+2]=(1/2-Y)*r,C[I+0]=n?n[N*2]:G,C[I+1]=n?n[N*2+1]:V,I+=3}w[I+0]=w[I-3],w[I+1]=w[I-2],w[I+2]=w[I-1],I+=3}for(let B=o?0:1;B<s;B++){const F=Math.floor(B/2)*Math.sign(.5-B%2),N=F*A,V=(F+i)%i,G=Math.sin(N),Y=Math.cos(N);w[I+0]=n?n[V*2]:Y*e,w[I+1]=n?n[V*2+1]:G*e,w[I+2]=r/2,C[I+2]=1,I+=3}if(o){let B=0;for(let F=0;F<i;F++)v[B++]=F*2+0,v[B++]=F*2+2,v[B++]=F*2+0,v[B++]=F*2+1,v[B++]=F*2+1,v[B++]=F*2+3}return{indices:v,attributes:{POSITION:{size:3,value:w},NORMAL:{size:3,value:C}}}}const jQ=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
} else if (stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
if (isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = radius * coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
if (radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded && !isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,HQ=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (extruded && !isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Km=[0,0,0,255],GQ={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:Km},getLineColor:{type:"accessor",value:Km},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Lc extends Wn{getShaders(){const e={},{flatShading:r}=this.props;return r&&(e.FLAT_SHADING=1),super.getShaders({vs:jQ,fs:HQ,defines:e,modules:[uo,r?pB:E_,Mo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:Km},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:Km},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var f;super.updateState(e);const{props:r,oldProps:i,changeFlags:n}=e,o=n.extensionsChanged||r.flatShading!==i.flatShading;o&&((f=this.state.models)==null||f.forEach(A=>A.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(o||r.diskResolution!==i.diskResolution||r.vertices!==i.vertices||(r.extruded||r.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(r)}getGeometry(e,r,i){const n=new zQ({radius:1,height:i?2:0,vertices:r,nradial:e});let o=0;if(r)for(let s=0;s<e;s++){const f=r[s],A=Math.sqrt(f[0]*f[0]+f[1]*f[1]);o+=A/e}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*o}),n}_getModels(){const e=this.getShaders(),r=this.getAttributeManager().getBufferLayouts(),i=new zi(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:r,isInstanced:!0}),n=new zi(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:r,isInstanced:!0});return{fillModel:i,wireframeModel:n,models:[n,i]}}_updateGeometry({diskResolution:e,vertices:r,extruded:i,stroked:n}){const o=this.getGeometry(e,r,i||n);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});const s=this.state.fillModel,f=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),f.setGeometry(o),f.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:r,lineWidthScale:i,lineWidthMinPixels:n,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:f,extruded:A,filled:v,stroked:w,wireframe:C,offset:I,coverage:B,radius:F,angle:N}=this.props,V=this.state.fillModel,G=this.state.wireframeModel,{fillVertexCount:Y,edgeDistance:Z}=this.state,se={...e,radius:F,angle:N/180*Math.PI,offset:I,extruded:A,stroked:w,coverage:B,elevationScale:f,edgeDistance:Z,radiusUnits:Qo[s],widthUnits:Qo[r],widthScale:i,widthMinPixels:n,widthMaxPixels:o};A&&C&&(G.setUniforms(se),G.setUniforms({isStroke:!0}),G.draw(this.context.renderPass)),V.setUniforms(se),v&&(V.setVertexCount(Y),V.setUniforms({isStroke:!1}),V.draw(this.context.renderPass)),!A&&w&&(V.setVertexCount(Y*2/3),V.setUniforms({isStroke:!0}),V.draw(this.context.renderPass))}}Lc.layerName="ColumnLayer";Lc.defaultProps=GQ;const WQ={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class N_ extends Lc{_updateGeometry(){const e=new MB;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{elevationScale:r,extruded:i,offset:n,coverage:o,cellSize:s,angle:f,radiusUnits:A}=this.props,v=this.state.fillModel;v.setUniforms(e),v.setUniforms({radius:s/2,radiusUnits:Qo[A],angle:f,offset:n,extruded:i,coverage:o,elevationScale:r,edgeDistance:1,isStroke:!1}),v.draw(this.context.renderPass)}}N_.layerName="GridCellLayer";N_.defaultProps=WQ;function XQ(t,e,r,i){let n;if(Array.isArray(t[0])){const o=t.length*e;n=new Array(o);for(let s=0;s<t.length;s++)for(let f=0;f<e;f++)n[s*e+f]=t[s][f]||0}else n=t;return r?vO(n,{size:e,gridResolution:r}):i?LQ(n,{size:e}):n}const qQ=1,$Q=2,Nv=4;class ZQ extends A4{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?XQ(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(D3(e)){let i=0;for(const n of e)i+=this.getGeometrySize(n);return i}const r=this.getPathLength(e);return r<2?0:this.isClosed(e)?r<3?0:r+2:r}updateGeometryAttributes(e,r){if(r.geometrySize!==0)if(e&&D3(e))for(const i of e){const n=this.getGeometrySize(i);r.geometrySize=n,this.updateGeometryAttributes(i,r),r.vertexStart+=n}else this._updateSegmentTypes(e,r),this._updatePositions(e,r)}_updateSegmentTypes(e,r){const i=this.attributes.segmentTypes,n=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:s}=r;i.fill(0,o,o+s),n?(i[o]=Nv,i[o+s-2]=Nv):(i[o]+=qQ,i[o+s-2]+=$Q),i[o+s-1]=Nv}_updatePositions(e,r){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:n,geometrySize:o}=r,s=new Array(3);for(let f=n,A=0;A<o;f++,A++)this.getPointOnPath(e,A,s),i[f*3]=s[0],i[f*3+1]=s[1],i[f*3+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,r,i=[]){const{positionSize:n}=this;r*n>=e.length&&(r+=1-e.length/n);const o=r*n;return i[0]=e[o],i[1]=e[o+1],i[2]=n===3&&e[o+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:r}=this,i=e.length-r;return e[0]===e[i]&&e[1]===e[i+1]&&(r===2||e[2]===e[i+2])}}function D3(t){return Array.isArray(t[0])}const KQ=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,YQ=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,EO=[0,0,0,255],JQ={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:EO},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Uv={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class $h extends Wn{getShaders(){return super.getShaders({vs:KQ,fs:YQ,modules:[uo,Mo]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Uv,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Uv,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Uv,defaultValue:EO},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:n,target:o})=>this.encodePickingColor(i&&i.__source?i.__source.index:n,o)}}),this.setState({pathTesselator:new ZQ({fp64:this.use64bitPositions()})})}updateState(e){var s;super.updateState(e);const{props:r,changeFlags:i}=e,n=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:f}=this.state,A=r.data.attributes||{};f.updateGeometry({data:r.data,geometryBuffer:A.getPath,buffers:A,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:f.instanceCount,startIndices:f.vertexStarts}),i.dataChanged||n.invalidateAll()}i.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(e){const r=super.getPickingInfo(e),{index:i}=r,n=this.props.data;return n[0]&&n[0].__source&&(r.object=n.find(o=>o.__source.index===i)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let i=0;i<r.length;i++)r[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:r,capRounded:i,billboard:n,miterLimit:o,widthUnits:s,widthScale:f,widthMinPixels:A,widthMaxPixels:v}=this.props,w=this.state.model;w.setUniforms(e),w.setUniforms({jointType:Number(r),capType:Number(i),billboard:n,widthUnits:Qo[s],widthScale:f,miterLimit:o,widthMinPixels:A,widthMaxPixels:v}),w.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _s({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateSegmentTypes(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("segmentTypes")}}$h.defaultProps=JQ;$h.layerName="PathLayer";var xx={exports:{}};xx.exports=U_;xx.exports.default=U_;function U_(t,e,r){r=r||2;var i=e&&e.length,n=i?e[0]*r:t.length,o=SO(t,0,n,r,!0),s=[];if(!o||o.next===o.prev)return s;var f,A,v,w,C,I,B;if(i&&(o=iee(t,e,o,r)),t.length>80*r){f=v=t[0],A=w=t[1];for(var F=r;F<n;F+=r)C=t[F],I=t[F+1],C<f&&(f=C),I<A&&(A=I),C>v&&(v=C),I>w&&(w=I);B=Math.max(v-f,w-A),B=B!==0?32767/B:0}return Qp(o,s,r,f,A,B,0),s}function SO(t,e,r,i,n){var o,s;if(n===Db(t,e,r,i)>0)for(o=e;o<r;o+=i)s=F3(o,t[o],t[o+1],s);else for(o=r-i;o>=e;o-=i)s=F3(o,t[o],t[o+1],s);return s&&z_(s,s.next)&&(t0(s),s=s.next),s}function Nh(t,e){if(!t)return t;e||(e=t);var r=t,i;do if(i=!1,!r.steiner&&(z_(r,r.next)||pn(r.prev,r,r.next)===0)){if(t0(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function Qp(t,e,r,i,n,o,s){if(t){!s&&o&&lee(t,i,n,o);for(var f=t,A,v;t.prev!==t.next;){if(A=t.prev,v=t.next,o?eee(t,i,n,o):QQ(t)){e.push(A.i/r|0),e.push(t.i/r|0),e.push(v.i/r|0),t0(t),t=v.next,f=v.next;continue}if(t=v,t===f){s?s===1?(t=tee(Nh(t),e,r),Qp(t,e,r,i,n,o,2)):s===2&&ree(t,e,r,i,n,o):Qp(Nh(t),e,r,i,n,o,1);break}}}}function QQ(t){var e=t.prev,r=t,i=t.next;if(pn(e,r,i)>=0)return!1;for(var n=e.x,o=r.x,s=i.x,f=e.y,A=r.y,v=i.y,w=n<o?n<s?n:s:o<s?o:s,C=f<A?f<v?f:v:A<v?A:v,I=n>o?n>s?n:s:o>s?o:s,B=f>A?f>v?f:v:A>v?A:v,F=i.next;F!==e;){if(F.x>=w&&F.x<=I&&F.y>=C&&F.y<=B&&Sd(n,f,o,A,s,v,F.x,F.y)&&pn(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function eee(t,e,r,i){var n=t.prev,o=t,s=t.next;if(pn(n,o,s)>=0)return!1;for(var f=n.x,A=o.x,v=s.x,w=n.y,C=o.y,I=s.y,B=f<A?f<v?f:v:A<v?A:v,F=w<C?w<I?w:I:C<I?C:I,N=f>A?f>v?f:v:A>v?A:v,V=w>C?w>I?w:I:C>I?C:I,G=Bb(B,F,e,r,i),Y=Bb(N,V,e,r,i),Z=t.prevZ,se=t.nextZ;Z&&Z.z>=G&&se&&se.z<=Y;){if(Z.x>=B&&Z.x<=N&&Z.y>=F&&Z.y<=V&&Z!==n&&Z!==s&&Sd(f,w,A,C,v,I,Z.x,Z.y)&&pn(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,se.x>=B&&se.x<=N&&se.y>=F&&se.y<=V&&se!==n&&se!==s&&Sd(f,w,A,C,v,I,se.x,se.y)&&pn(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;Z&&Z.z>=G;){if(Z.x>=B&&Z.x<=N&&Z.y>=F&&Z.y<=V&&Z!==n&&Z!==s&&Sd(f,w,A,C,v,I,Z.x,Z.y)&&pn(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;se&&se.z<=Y;){if(se.x>=B&&se.x<=N&&se.y>=F&&se.y<=V&&se!==n&&se!==s&&Sd(f,w,A,C,v,I,se.x,se.y)&&pn(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function tee(t,e,r){var i=t;do{var n=i.prev,o=i.next.next;!z_(n,o)&&CO(n,i,i.next,o)&&e0(n,o)&&e0(o,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(o.i/r|0),t0(i),t0(i.next),i=t=o),i=i.next}while(i!==t);return Nh(i)}function ree(t,e,r,i,n,o){var s=t;do{for(var f=s.next.next;f!==s.prev;){if(s.i!==f.i&&hee(s,f)){var A=PO(s,f);s=Nh(s,s.next),A=Nh(A,A.next),Qp(s,e,r,i,n,o,0),Qp(A,e,r,i,n,o,0);return}f=f.next}s=s.next}while(s!==t)}function iee(t,e,r,i){var n=[],o,s,f,A,v;for(o=0,s=e.length;o<s;o++)f=e[o]*i,A=o<s-1?e[o+1]*i:t.length,v=SO(t,f,A,i,!1),v===v.next&&(v.steiner=!0),n.push(uee(v));for(n.sort(nee),o=0;o<n.length;o++)r=see(n[o],r);return r}function nee(t,e){return t.x-e.x}function see(t,e){var r=oee(t,e);if(!r)return e;var i=PO(r,t);return Nh(i,i.next),Nh(r,r.next)}function oee(t,e){var r=e,i=t.x,n=t.y,o=-1/0,s;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var f=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(f<=i&&f>o&&(o=f,s=r.x<r.next.x?r:r.next,f===i))return s}r=r.next}while(r!==e);if(!s)return null;var A=s,v=s.x,w=s.y,C=1/0,I;r=s;do i>=r.x&&r.x>=v&&i!==r.x&&Sd(n<w?i:o,n,v,w,n<w?o:i,n,r.x,r.y)&&(I=Math.abs(n-r.y)/(i-r.x),e0(r,t)&&(I<C||I===C&&(r.x>s.x||r.x===s.x&&aee(s,r)))&&(s=r,C=I)),r=r.next;while(r!==A);return s}function aee(t,e){return pn(t.prev,t,e.prev)<0&&pn(e.next,t,t.next)<0}function lee(t,e,r,i){var n=t;do n.z===0&&(n.z=Bb(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,cee(n)}function cee(t){var e,r,i,n,o,s,f,A,v=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,i=r,f=0,e=0;e<v&&(f++,i=i.nextZ,!!i);e++);for(A=v;f>0||A>0&&i;)f!==0&&(A===0||!i||r.z<=i.z)?(n=r,r=r.nextZ,f--):(n=i,i=i.nextZ,A--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,v*=2}while(s>1);return t}function Bb(t,e,r,i,n){return t=(t-r)*n|0,e=(e-i)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function uee(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Sd(t,e,r,i,n,o,s,f){return(n-s)*(e-f)>=(t-s)*(o-f)&&(t-s)*(i-f)>=(r-s)*(e-f)&&(r-s)*(o-f)>=(n-s)*(i-f)}function hee(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!fee(t,e)&&(e0(t,e)&&e0(e,t)&&dee(t,e)&&(pn(t.prev,t,e.prev)||pn(t,e.prev,e))||z_(t,e)&&pn(t.prev,t,t.next)>0&&pn(e.prev,e,e.next)>0)}function pn(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function z_(t,e){return t.x===e.x&&t.y===e.y}function CO(t,e,r,i){var n=Mg(pn(t,e,r)),o=Mg(pn(t,e,i)),s=Mg(pn(r,i,t)),f=Mg(pn(r,i,e));return!!(n!==o&&s!==f||n===0&&Ig(t,r,e)||o===0&&Ig(t,i,e)||s===0&&Ig(r,t,i)||f===0&&Ig(r,e,i))}function Ig(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Mg(t){return t>0?1:t<0?-1:0}function fee(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&CO(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function e0(t,e){return pn(t.prev,t,t.next)<0?pn(t,e,t.next)>=0&&pn(t,t.prev,e)>=0:pn(t,e,t.prev)<0||pn(t,t.next,e)<0}function dee(t,e){var r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function PO(t,e){var r=new Ob(t.i,t.x,t.y),i=new Ob(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function F3(t,e,r,i){var n=new Ob(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function t0(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ob(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}U_.deviation=function(t,e,r,i){var n=e&&e.length,o=n?e[0]*r:t.length,s=Math.abs(Db(t,0,o,r));if(n)for(var f=0,A=e.length;f<A;f++){var v=e[f]*r,w=f<A-1?e[f+1]*r:t.length;s-=Math.abs(Db(t,v,w,r))}var C=0;for(f=0;f<i.length;f+=3){var I=i[f]*r,B=i[f+1]*r,F=i[f+2]*r;C+=Math.abs((t[I]-t[F])*(t[B+1]-t[I+1])-(t[I]-t[B])*(t[F+1]-t[I+1]))}return s===0&&C===0?0:Math.abs((C-s)/s)};function Db(t,e,r,i){for(var n=0,o=e,s=r-i;o<r;o+=i)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}U_.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)r.vertices.push(t[n][o][s]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r};var Aee=xx.exports;const IO=oA(Aee),Rg=vx.CLOCKWISE,L3=vx.COUNTER_CLOCKWISE,Cu={isClosed:!0};function pee(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function mp(t){return"positions"in t?t.positions:t}function um(t){return"holeIndices"in t?t.holeIndices:null}function gee(t){return Array.isArray(t[0])}function mee(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function _ee(t){const e=t[0],r=t[t.length-1];return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function yee(t,e,r,i){for(let n=0;n<e;n++)if(t[r+n]!==t[i-e+n])return!1;return!0}function k3(t,e,r,i,n){let o=e;const s=r.length;for(let f=0;f<s;f++)for(let A=0;A<i;A++)t[o++]=r[f][A]||0;if(!_ee(r))for(let f=0;f<i;f++)t[o++]=r[0][f]||0;return Cu.start=e,Cu.end=o,Cu.size=i,bx(t,n,Cu),o}function N3(t,e,r,i,n=0,o,s){o=o||r.length;const f=o-n;if(f<=0)return e;let A=e;for(let v=0;v<f;v++)t[A++]=r[n+v];if(!yee(r,i,n,o))for(let v=0;v<i;v++)t[A++]=r[n+v];return Cu.start=e,Cu.end=A,Cu.size=i,bx(t,s,Cu),A}function MO(t,e){pee(t);const r=[],i=[];if("positions"in t){const{positions:n,holeIndices:o}=t;if(o){let s=0;for(let f=0;f<=o.length;f++)s=N3(r,s,n,e,o[f-1],o[f],f===0?Rg:L3),i.push(s);return i.pop(),{positions:r,holeIndices:i}}t=n}if(!gee(t))return N3(r,0,t,e,0,r.length,Rg),r;if(!mee(t)){let n=0;for(const[o,s]of t.entries())n=k3(r,n,s,e,o===0?Rg:L3),i.push(n);return i.pop(),{positions:r,holeIndices:i}}return k3(r,0,t,e,Rg),r}function zv(t,e,r){const i=t.length/3;let n=0;for(let o=0;o<i;o++){const s=(o+1)%i;n+=t[o*3+e]*t[s*3+r],n-=t[s*3+e]*t[o*3+r]}return Math.abs(n/2)}function U3(t,e,r,i){const n=t.length/3;for(let o=0;o<n;o++){const s=o*3,f=t[s+0],A=t[s+1],v=t[s+2];t[s+e]=f,t[s+r]=A,t[s+i]=v}}function vee(t,e,r,i){let n=um(t);n&&(n=n.map(f=>f/e));let o=mp(t);const s=i&&e===3;if(r){const f=o.length;o=o.slice();const A=[];for(let v=0;v<f;v+=e){A[0]=o[v],A[1]=o[v+1],s&&(A[2]=o[v+2]);const w=r(A);o[v]=w[0],o[v+1]=w[1],s&&(o[v+2]=w[2])}}if(s){const f=zv(o,0,1),A=zv(o,0,2),v=zv(o,1,2);if(!f&&!A&&!v)return[];f>A&&f>v||(A>v?(r||(o=o.slice()),U3(o,0,2,1)):(r||(o=o.slice()),U3(o,2,0,1)))}return IO(o,n,e)}class bee extends A4{constructor(e){const{fp64:r,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:r}=this;return e==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[e]}updateGeometry(e){super.updateGeometry(e);const r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const r=MO(e,this.positionSize);return this.opts.resolution?bO(mp(r),um(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?kQ(mp(r),um(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return e}getGeometrySize(e){if(z3(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}return mp(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,r){if(e&&z3(e))for(const i of e){const n=this.getGeometrySize(i);r.geometrySize=n,this.updateGeometryAttributes(i,r),r.vertexStart+=n,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{const i=e;this._updateIndices(i,r),this._updatePositions(i,r),this._updateVertexValid(i,r)}}_updateIndices(e,{geometryIndex:r,vertexStart:i,indexStart:n}){const{attributes:o,indexStarts:s,typedArrayManager:f}=this;let A=o.indices;if(!A||!e)return;let v=n;const w=vee(e,this.positionSize,this.opts.preproject,this.opts.full3d);A=f.allocate(A,n+w.length,{copy:!0});for(let C=0;C<w.length;C++)A[v++]=w[C]+i;s[r+1]=n+w.length,o.indices=A}_updatePositions(e,{vertexStart:r,geometrySize:i}){const{attributes:{positions:n},positionSize:o}=this;if(!n||!e)return;const s=mp(e);for(let f=r,A=0;A<i;f++,A++){const v=s[A*o],w=s[A*o+1],C=o>2?s[A*o+2]:0;n[f*3]=v,n[f*3+1]=w,n[f*3+2]=C}}_updateVertexValid(e,{vertexStart:r,geometrySize:i}){const{positionSize:n}=this,o=this.attributes.vertexValid,s=e&&um(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,r):o.fill(1,r,r+i),s)for(let f=0;f<s.length;f++)o[r+s[f]/n-1]=0;o[r+i-1]=0}}function z3(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const RO=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,xee=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${RO}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,wee=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${RO}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Tee=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Ym=[0,0,0,255],Eee={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Ym},getLineColor:{type:"accessor",value:Ym},material:!0},Bg={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class zu extends Wn{getShaders(e){return super.getShaders({vs:e==="top"?xee:wee,fs:Tee,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[uo,E_,Mo]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&r===br.DEFAULT&&(r=br.LNGLAT);let n;r===br.LNGLAT&&(i?n=e.projectPosition.bind(e):n=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new bee({preproject:n,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),s=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Bg,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:Bg,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Bg,accessor:"getFillColor",defaultValue:Ym},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Bg,accessor:"getLineColor",defaultValue:Ym},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(f,{index:A,target:v})=>this.encodePickingColor(f&&f.__source?f.__source.index:A,v)}})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:i}=r,n=this.props.data;return n[0]&&n[0].__source&&(r.object=n.find(o=>o.__source.index===i)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let i=0;i<r.length;i++)r[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:r,filled:i,wireframe:n,elevationScale:o}=this.props,{topModel:s,sideModel:f,wireframeModel:A,polygonTesselator:v}=this.state,w={...e,extruded:!!r,elevationScale:o};A&&n&&(A.setInstanceCount(v.instanceCount-1),A.setUniforms(w),A.draw(this.context.renderPass)),f&&i&&(f.setInstanceCount(v.instanceCount-1),f.setUniforms(w),f.draw(this.context.renderPass)),s&&i&&(s.setVertexCount(v.vertexCount),s.setUniforms(w),s.draw(this.context.renderPass))}updateState(e){var f;super.updateState(e),this.updateGeometry(e);const{props:r,oldProps:i,changeFlags:n}=e,o=this.getAttributeManager();(n.extensionsChanged||r.filled!==i.filled||r.extruded!==i.extruded)&&((f=this.state.models)==null||f.forEach(A=>A.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:e,oldProps:r,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,s=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:r,extruded:i}=this.props;let n,o,s;if(r){const f=this.getShaders("top");f.defines.NON_INSTANCED_MODEL=1;const A=this.getAttributeManager().getBufferLayouts({isInstanced:!1});n=new zi(this.context.device,{...f,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:A,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const f=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new zi(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:f,uniforms:{isWireframe:!1},geometry:new _s({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new zi(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:f,uniforms:{isWireframe:!0},geometry:new _s({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,s,n].filter(Boolean),topModel:n,sideModel:o,wireframeModel:s}}calculateIndices(e){const{polygonTesselator:r}=this.state;e.startIndices=r.indexStarts,e.value=r.get("indices")}calculatePositions(e){const{polygonTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}zu.defaultProps=Eee;zu.layerName="SolidPolygonLayer";function BO({data:t,getIndex:e,dataRange:r,replace:i}){const{startRow:n=0,endRow:o=1/0}=r,s=t.length;let f=s,A=s;for(let I=0;I<s;I++){const B=e(t[I]);if(f>I&&B>=n&&(f=I),B>=o){A=I;break}}let v=f;const C=A-f!==i.length?t.slice(A):void 0;for(let I=0;I<i.length;I++)t[v++]=i[I];if(C){for(let I=0;I<C.length;I++)t[v++]=C[I];t.length=v}return{startRow:f,endRow:f+i.length}}const OO=[0,0,0,255],See=[0,0,0,255],Cee={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:See},getLineColor:{type:"accessor",value:OO},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Vu extends rs{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&fr.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(r&&Array.isArray(e.dataChanged)){const i=this.state.paths.slice(),n=e.dataChanged.map(o=>BO({data:i,getIndex:s=>s.__source.index,dataRange:o,replace:this._getPaths(o)}));this.setState({paths:i,pathsDiff:n})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:r,getPolygon:i,positionFormat:n,_normalize:o}=this.props,s=[],f=n==="XY"?2:3,{startRow:A,endRow:v}=e,{iterable:w,objectInfo:C}=ql(r,A,v);for(const I of w){C.index++;let B=i(I,C);o&&(B=MO(B,f));const{holeIndices:F}=B,N=B.positions||B;if(F)for(let V=0;V<=F.length;V++){const G=N.slice(F[V-1]||0,F[V]||N.length);s.push(this.getSubLayerRow({path:G},I,C.index))}else s.push(this.getSubLayerRow({path:N},I,C.index))}return s}renderLayers(){const{data:e,_dataDiff:r,stroked:i,filled:n,extruded:o,wireframe:s,_normalize:f,_windingOrder:A,elevationScale:v,transitions:w,positionFormat:C}=this.props,{lineWidthUnits:I,lineWidthScale:B,lineWidthMinPixels:F,lineWidthMaxPixels:N,lineJointRounded:V,lineMiterLimit:G,lineDashJustified:Y}=this.props,{getFillColor:Z,getLineColor:se,getLineWidth:ge,getLineDashArray:Pe,getElevation:Ue,getPolygon:Fe,updateTriggers:pe,material:Te}=this.props,{paths:Ae,pathsDiff:Le}=this.state,Ve=this.getSubLayerClass("fill",zu),Xe=this.getSubLayerClass("stroke",$h),dt=this.shouldRenderSubLayer("fill",Ae)&&new Ve({_dataDiff:r,extruded:o,elevationScale:v,filled:n,wireframe:s,_normalize:f,_windingOrder:A,getElevation:Ue,getFillColor:Z,getLineColor:o&&s?se:OO,material:Te,transitions:w},this.getSubLayerProps({id:"fill",updateTriggers:pe&&{getPolygon:pe.getPolygon,getElevation:pe.getElevation,getFillColor:pe.getFillColor,lineColors:o&&s,getLineColor:pe.getLineColor}}),{data:e,positionFormat:C,getPolygon:Fe}),Nt=!o&&i&&this.shouldRenderSubLayer("stroke",Ae)&&new Xe({_dataDiff:Le&&(()=>Le),widthUnits:I,widthScale:B,widthMinPixels:F,widthMaxPixels:N,jointRounded:V,miterLimit:G,dashJustified:Y,_pathType:"loop",transitions:w&&{getWidth:w.getLineWidth,getColor:w.getLineColor,getPath:w.getPolygon},getColor:this.getSubLayerAccessor(se),getWidth:this.getSubLayerAccessor(ge),getDashArray:this.getSubLayerAccessor(Pe)},this.getSubLayerProps({id:"stroke",updateTriggers:pe&&{getWidth:pe.getLineWidth,getColor:pe.getLineColor,getDashArray:pe.getLineDashArray}}),{data:Ae,positionFormat:C,getPath:gr=>gr.path});return[!o&&dt,Nt,o&&dt]}}Vu.layerName="PolygonLayer";Vu.defaultProps=Cee;function Pee(t,e){if(!t)return null;const r="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[r];return r!==-1?Iee(t,i,r):null}function Iee(t,e,r){const i={properties:{...t.properties[e]}};for(const n in t.numericProps)i.properties[n]=t.numericProps[n].value[r];return i}function Mee(t,e){const r={points:null,lines:null,polygons:null};for(const i in r){const n=t[i].globalFeatureIds.value;r[i]=new Uint8ClampedArray(n.length*3);const o=[];for(let s=0;s<n.length;s++)e(n[s],o),r[i][s*3+0]=o[0],r[i][s*3+1]=o[1],r[i][s*3+2]=o[2]}return r}const Ree=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Vv=192/256,V3=[],Bee={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class V_ extends dA{getShaders(){return{...super.getShaders(),fs:Ree}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(r,{index:i,target:n})=>this.encodePickingColor(i,n)}})}updateState(e){super.updateState(e);const{props:r,oldProps:i}=e;let{outlineColor:n}=r;n!==i.outlineColor&&(n=n.map(o=>o/255),n[3]=Number.isFinite(n[3])?n[3]:1,this.setState({outlineColor:n})),!r.sdf&&r.outlineWidth&&fr.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:r,smoothing:i,outlineWidth:n}=this.props,{outlineColor:o}=this.state,s=n?Math.max(i,Vv*(1-n)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:Vv,outlineBuffer:s,gamma:i,sdf:!!r,outlineColor:o},super.draw(e),r&&n){const{iconManager:f}=this.state,A=f.getTexture(),v=this.state.model;A&&(v.setUniforms({outlineBuffer:Vv}),v.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(r=>super.getInstanceOffset(r)):V3}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(r=>super.getInstanceIconFrame(r)):V3}}V_.defaultProps=Bee;V_.layerName="MultiIconLayer";const Pp=1e20;class Oee{constructor({fontSize:e=24,buffer:r=3,radius:i=8,cutoff:n=.25,fontFamily:o="sans-serif",fontWeight:s="normal",fontStyle:f="normal"}={}){this.buffer=r,this.cutoff=n,this.radius=i;const A=this.size=e+r*4,v=this._createCanvas(A),w=this.ctx=v.getContext("2d",{willReadFrequently:!0});w.font=`${f} ${s} ${e}px ${o}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(e){const r=document.createElement("canvas");return r.width=r.height=e,r}draw(e){const{width:r,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:o,actualBoundingBoxRight:s}=this.ctx.measureText(e),f=Math.ceil(i),A=0,v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-o))),w=Math.min(this.size-this.buffer,f+Math.ceil(n)),C=v+2*this.buffer,I=w+2*this.buffer,B=Math.max(C*I,0),F=new Uint8ClampedArray(B),N={data:F,width:C,height:I,glyphWidth:v,glyphHeight:w,glyphTop:f,glyphLeft:A,glyphAdvance:r};if(v===0||w===0)return N;const{ctx:V,buffer:G,gridInner:Y,gridOuter:Z}=this;V.clearRect(G,G,v,w),V.fillText(e,G,G+f);const se=V.getImageData(G,G,v,w);Z.fill(Pp,0,B),Y.fill(0,0,B);for(let ge=0;ge<w;ge++)for(let Pe=0;Pe<v;Pe++){const Ue=se.data[4*(ge*v+Pe)+3]/255;if(Ue===0)continue;const Fe=(ge+G)*C+Pe+G;if(Ue===1)Z[Fe]=0,Y[Fe]=Pp;else{const pe=.5-Ue;Z[Fe]=pe>0?pe*pe:0,Y[Fe]=pe<0?pe*pe:0}}j3(Z,0,0,C,I,C,this.f,this.v,this.z),j3(Y,G,G,v,w,C,this.f,this.v,this.z);for(let ge=0;ge<B;ge++){const Pe=Math.sqrt(Z[ge])-Math.sqrt(Y[ge]);F[ge]=Math.round(255-255*(Pe/this.radius+this.cutoff))}return N}}function j3(t,e,r,i,n,o,s,f,A){for(let v=e;v<e+i;v++)H3(t,r*o+v,o,n,s,f,A);for(let v=r;v<r+n;v++)H3(t,v*o+e,1,i,s,f,A)}function H3(t,e,r,i,n,o,s){o[0]=0,s[0]=-Pp,s[1]=Pp,n[0]=t[e];for(let f=1,A=0,v=0;f<i;f++){n[f]=t[e+f*r];const w=f*f;do{const C=o[A];v=(n[f]-n[C]+w-C*C)/(f-C)/2}while(v<=s[A]&&--A>-1);A++,o[A]=f,s[A]=v,s[A+1]=Pp}for(let f=0,A=0;f<i;f++){for(;s[A+1]<f;)A++;const v=o[A],w=f-v;t[e+f*r]=n[v]+w*w}}const Dee=32,Fee=[];function Lee(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function kee({characterSet:t,getFontWidth:e,fontHeight:r,buffer:i,maxCanvasWidth:n,mapping:o={},xOffset:s=0,yOffset:f=0}){let A=0,v=s;const w=r+i*2;for(const C of t)if(!o[C]){const I=e(C);v+I+i*2>n&&(v=0,A++),o[C]={x:v+i,y:f+A*w+i,width:I,height:w,layoutWidth:I,layoutHeight:r},v+=I+i*2}return{mapping:o,xOffset:v,yOffset:f+A*w,canvasHeight:Lee(f+(A+1)*w)}}function DO(t,e,r,i){var o;let n=0;for(let s=e;s<r;s++){const f=t[s];n+=((o=i[f])==null?void 0:o.layoutWidth)||0}return n}function FO(t,e,r,i,n,o){let s=e,f=0;for(let A=e;A<r;A++){const v=DO(t,A,A+1,n);f+v>i&&(s<A&&o.push(A),s=A,f=0),f+=v}return f}function Nee(t,e,r,i,n,o){let s=e,f=e,A=e,v=0;for(let w=e;w<r;w++)if((t[w]===" "||t[w+1]===" "||w+1===r)&&(A=w+1),A>f){let C=DO(t,f,A,n);v+C>i&&(s<f&&(o.push(f),s=f,v=0),C>i&&(C=FO(t,f,A,i,n,o),s=o[o.length-1])),f=A,v+=C}return v}function Uee(t,e,r,i,n=0,o){o===void 0&&(o=t.length);const s=[];return e==="break-all"?FO(t,n,o,r,i,s):Nee(t,n,o,r,i,s),s}function zee(t,e,r,i,n,o){let s=0,f=0;for(let A=e;A<r;A++){const v=t[A],w=i[v];w?(f||(f=w.layoutHeight),n[A]=s+w.layoutWidth/2,s+=w.layoutWidth):(fr.warn(`Missing character: ${v} (${v.codePointAt(0)})`)(),n[A]=s,s+=Dee)}o[0]=s,o[1]=f}function Vee(t,e,r,i,n){var V;const o=Array.from(t),s=o.length,f=new Array(s),A=new Array(s),v=new Array(s),w=(r==="break-word"||r==="break-all")&&isFinite(i)&&i>0,C=[0,0],I=[0,0];let B=0,F=0,N=0;for(let G=0;G<=s;G++){const Y=o[G];if((Y===`
`||G===s)&&(N=G),N>F){const Z=w?Uee(o,r,i,n,F,N):Fee;for(let se=0;se<=Z.length;se++){const ge=se===0?F:Z[se-1],Pe=se<Z.length?Z[se]:N;zee(o,ge,Pe,n,f,I);for(let Ue=ge;Ue<Pe;Ue++){const Fe=o[Ue],pe=((V=n[Fe])==null?void 0:V.layoutOffsetY)||0;A[Ue]=B+I[1]/2+pe,v[Ue]=I[0]}B=B+I[1]*e,C[0]=Math.max(C[0],I[0])}F=N}Y===`
`&&(f[F]=0,A[F]=0,v[F]=0,F++)}return C[1]=B,{x:f,y:A,rowWidth:v,size:C}}function jee({value:t,length:e,stride:r,offset:i,startIndices:n,characterSet:o}){const s=t.BYTES_PER_ELEMENT,f=r?r/s:1,A=i?i/s:0,v=n[e]||Math.ceil((t.length-A)/f),w=o&&new Set,C=new Array(e);let I=t;if(f>1||A>0){const B=t.constructor;I=new B(v);for(let F=0;F<v;F++)I[F]=t[F*f+A]}for(let B=0;B<e;B++){const F=n[B],N=n[B+1]||v,V=I.subarray(F,N);C[B]=String.fromCodePoint.apply(null,V),w&&V.forEach(w.add,w)}if(w)for(const B of w)o.add(String.fromCodePoint(B));return{texts:C,characterCount:v}}class LO{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const r=this._cache[e];return r&&(this._deleteOrder(e),this._appendOrder(e)),r}set(e,r){this._cache[e]?(this.delete(e),this._cache[e]=r,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=r,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const r=this._order.indexOf(e);r>=0&&this._order.splice(r,1)}_appendOrder(e){this._order.push(e)}}function Hee(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const zd={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Hee(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},G3=1024,W3=.9,X3=1.2,kO=3;let Jm=new LO(kO);function Gee(t,e){let r;typeof e=="string"?r=new Set(Array.from(e)):r=new Set(e);const i=Jm.get(t);if(!i)return r;for(const n in i.mapping)r.has(n)&&r.delete(n);return r}function Wee(t,e){for(let r=0;r<t.length;r++)e.data[4*r+3]=t[r]}function q3(t,e,r,i){t.font=`${i} ${r}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function Xee(t){fr.assert(Number.isFinite(t)&&t>=kO,"Invalid cache limit"),Jm=new LO(t)}class qee{constructor(){this.props={...zd}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:r}=this.props;return(e*X3+r*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const r=Gee(this._key,this.props.characterSet),i=Jm.get(this._key);if(i&&r.size===0){this._atlas!==i&&(this._atlas=i);return}const n=this._generateFontAtlas(r,i);this._atlas=n,Jm.set(this._key,n)}_generateFontAtlas(e,r){const{fontFamily:i,fontWeight:n,fontSize:o,buffer:s,sdf:f,radius:A,cutoff:v}=this.props;let w=r&&r.data;w||(w=document.createElement("canvas"),w.width=G3);const C=w.getContext("2d",{willReadFrequently:!0});q3(C,i,o,n);const{mapping:I,canvasHeight:B,xOffset:F,yOffset:N}=kee({getFontWidth:V=>C.measureText(V).width,fontHeight:o*X3,buffer:s,characterSet:e,maxCanvasWidth:G3,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(w.height!==B){const V=C.getImageData(0,0,w.width,w.height);w.height=B,C.putImageData(V,0,0)}if(q3(C,i,o,n),f){const V=new Oee({fontSize:o,buffer:s,radius:A,cutoff:v,fontFamily:i,fontWeight:`${n}`});for(const G of e){const{data:Y,width:Z,height:se,glyphTop:ge}=V.draw(G);I[G].width=Z,I[G].layoutOffsetY=o*W3-ge;const Pe=C.createImageData(Z,se);Wee(Y,Pe),C.putImageData(Pe,I[G].x,I[G].y)}}else for(const V of e)C.fillText(V,I[V].x,I[V].y+s+o*W3);return{xOffset:F,yOffset:N,mapping:I,data:w,width:w.width,height:w.height}}_getKey(){const{fontFamily:e,fontWeight:r,fontSize:i,buffer:n,sdf:o,radius:s,cutoff:f}=this.props;return o?`${e} ${r} ${i} ${n} ${s} ${f}`:`${e} ${r} ${i} ${n}`}}const $ee=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Zee=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Kee={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class d0 extends Wn{getShaders(){return super.getShaders({vs:$ee,fs:Zee,modules:[uo,Mo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e);const{changeFlags:r}=e;r.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:r,sizeScale:i,sizeUnits:n,sizeMinPixels:o,sizeMaxPixels:s,getLineWidth:f}=this.props;let{padding:A}=this.props;A.length<4&&(A=[A[0],A[1],A[0],A[1]]);const v=this.state.model;v.setUniforms(e),v.setUniforms({billboard:r,stroked:!!f,padding:A,sizeUnits:Qo[n],sizeScale:i,sizeMinPixels:o,sizeMaxPixels:s}),v.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _s({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}d0.defaultProps=Kee;d0.layerName="TextBackgroundLayer";const $3={start:1,middle:0,end:-1},Z3={top:1,center:0,bottom:-1},jv=[0,0,0,255],Yee=1,Jee={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:jv},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:zd.characterSet},fontFamily:zd.fontFamily,fontWeight:zd.fontWeight,lineHeight:Yee,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:jv},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:jv},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Zh extends rs{constructor(){super(...arguments),this.getBoundingRect=(e,r)=>{let{size:[i,n]}=this.transformParagraph(e,r);const{fontSize:o}=this.state.fontAtlasManager.props;i/=o,n/=o;const{getTextAnchor:s,getAlignmentBaseline:f}=this.props,A=$3[typeof s=="function"?s(e,r):s],v=Z3[typeof f=="function"?f(e,r):f];return[(A-1)*i/2,(v-1)*n/2,i,n]},this.getIconOffsets=(e,r)=>{const{getTextAnchor:i,getAlignmentBaseline:n}=this.props,{x:o,y:s,rowWidth:f,size:[A,v]}=this.transformParagraph(e,r),w=$3[typeof i=="function"?i(e,r):i],C=Z3[typeof n=="function"?n(e,r):n],I=o.length,B=new Array(I*2);let F=0;for(let N=0;N<I;N++){const V=(1-w)*(A-f[N])/2;B[F++]=(w-1)*A/2+V+o[N],B[F++]=(C-1)*v/2+s[N]}return B}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new qee},this.props.maxWidth>0&&fr.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:r,oldProps:i,changeFlags:n}=e;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==i.lineHeight||r.wordBreak!==i.wordBreak||r.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:r,fontWeight:i}=this.props,{fontAtlasManager:n,characterSet:o}=this.state,s={...e,characterSet:o,fontFamily:r,fontWeight:i};if(!n.mapping)return n.setProps(s),!0;for(const f in s)if(s[f]!==n.props[f])return n.setProps(s),!0;return!1}_updateText(){var A;const{data:e,characterSet:r}=this.props,i=(A=e.attributes)==null?void 0:A.getText;let{getText:n}=this.props,o=e.startIndices,s;const f=r==="auto"&&new Set;if(i&&o){const{texts:v,characterCount:w}=jee({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:o,characterSet:f});s=w,n=(C,{index:I})=>v[I]}else{const{iterable:v,objectInfo:w}=ql(e);o=[0],s=0;for(const C of v){w.index++;const I=Array.from(n(C,w)||"");f&&I.forEach(f.add,f),s+=I.length,o.push(s)}}this.setState({getText:n,startIndices:o,numInstances:s,characterSet:f||r})}transformParagraph(e,r){const{fontAtlasManager:i}=this.state,n=i.mapping,o=this.state.getText,{wordBreak:s,lineHeight:f,maxWidth:A}=this.props,v=o(e,r)||"";return Vee(v,f,s,A*i.props.fontSize,n)}renderLayers(){const{startIndices:e,numInstances:r,getText:i,fontAtlasManager:{scale:n,atlas:o,mapping:s},styleVersion:f}=this.state,{data:A,_dataDiff:v,getPosition:w,getColor:C,getSize:I,getAngle:B,getPixelOffset:F,getBackgroundColor:N,getBorderColor:V,getBorderWidth:G,backgroundPadding:Y,background:Z,billboard:se,fontSettings:ge,outlineWidth:Pe,outlineColor:Ue,sizeScale:Fe,sizeUnits:pe,sizeMinPixels:Te,sizeMaxPixels:Ae,transitions:Le,updateTriggers:Ve}=this.props,Xe=this.getSubLayerClass("characters",V_),dt=this.getSubLayerClass("background",d0);return[Z&&new dt({getFillColor:N,getLineColor:V,getLineWidth:G,padding:Y,getPosition:w,getSize:I,getAngle:B,getPixelOffset:F,billboard:se,sizeScale:Fe,sizeUnits:pe,sizeMinPixels:Te,sizeMaxPixels:Ae,transitions:Le&&{getPosition:Le.getPosition,getAngle:Le.getAngle,getSize:Le.getSize,getFillColor:Le.getBackgroundColor,getLineColor:Le.getBorderColor,getLineWidth:Le.getBorderWidth,getPixelOffset:Le.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Ve.getPosition,getAngle:Ve.getAngle,getSize:Ve.getSize,getFillColor:Ve.getBackgroundColor,getLineColor:Ve.getBorderColor,getLineWidth:Ve.getBorderWidth,getPixelOffset:Ve.getPixelOffset,getBoundingRect:{getText:Ve.getText,getTextAnchor:Ve.getTextAnchor,getAlignmentBaseline:Ve.getAlignmentBaseline,styleVersion:f}}}),{data:A.attributes&&A.attributes.background?{length:A.length,attributes:A.attributes.background}:A,_dataDiff:v,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Xe({sdf:ge.sdf,smoothing:Number.isFinite(ge.smoothing)?ge.smoothing:zd.smoothing,outlineWidth:Pe/(ge.radius||zd.radius),outlineColor:Ue,iconAtlas:o,iconMapping:s,getPosition:w,getColor:C,getSize:I,getAngle:B,getPixelOffset:F,billboard:se,sizeScale:Fe*n,sizeUnits:pe,sizeMinPixels:Te*n,sizeMaxPixels:Ae*n,transitions:Le&&{getPosition:Le.getPosition,getAngle:Le.getAngle,getColor:Le.getColor,getSize:Le.getSize,getPixelOffset:Le.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Ve.getText,getPosition:Ve.getPosition,getAngle:Ve.getAngle,getColor:Ve.getColor,getSize:Ve.getSize,getPixelOffset:Ve.getPixelOffset,getIconOffsets:{getTextAnchor:Ve.getTextAnchor,getAlignmentBaseline:Ve.getAlignmentBaseline,styleVersion:f}}}),{data:A,_dataDiff:v,startIndices:e,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){Xee(e)}}Zh.defaultProps=Jee;Zh.layerName="TextLayer";const hm={circle:{type:f0,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:dA,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Zh,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},fm={type:$h,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Fb={type:zu,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function ep({type:t,props:e}){const r={};for(const i in e)r[i]=t.defaultProps[e[i]];return r}function Hv(t,e){const{transitions:r,updateTriggers:i}=t.props,n={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(const o in e){const s=e[o];let f=t.props[o];o.startsWith("get")&&(f=t.getSubLayerAccessor(f),n.updateTriggers[s]=i[o],r&&(n.transitions[s]=r[o])),n[s]=f}return n}function Qee(t){if(Array.isArray(t))return t;switch(fr.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return fr.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function K3(t,e,r={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:o=t.length}=r;for(let s=n;s<o;s++){const f=t[s],{geometry:A}=f;if(A)if(A.type==="GeometryCollection"){fr.assert(Array.isArray(A.geometries),"GeoJSON does not have geometries array");const{geometries:v}=A;for(let w=0;w<v.length;w++){const C=v[w];Y3(C,i,e,f,s)}}else Y3(A,i,e,f,s)}return i}function Y3(t,e,r,i,n){const{type:o,coordinates:s}=t,{pointFeatures:f,lineFeatures:A,polygonFeatures:v,polygonOutlineFeatures:w}=e;if(!tte(o,s)){fr.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":f.push(r({geometry:t},i,n));break;case"MultiPoint":s.forEach(C=>{f.push(r({geometry:{type:"Point",coordinates:C}},i,n))});break;case"LineString":A.push(r({geometry:t},i,n));break;case"MultiLineString":s.forEach(C=>{A.push(r({geometry:{type:"LineString",coordinates:C}},i,n))});break;case"Polygon":v.push(r({geometry:t},i,n)),s.forEach(C=>{w.push(r({geometry:{type:"LineString",coordinates:C}},i,n))});break;case"MultiPolygon":s.forEach(C=>{v.push(r({geometry:{type:"Polygon",coordinates:C}},i,n)),C.forEach(I=>{w.push(r({geometry:{type:"LineString",coordinates:I}},i,n))})});break}}const ete={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function tte(t,e){let r=ete[t];for(fr.assert(r,`Unknown GeoJSON type ${t}`);e&&--r>0;)e=e[0];return e&&Number.isFinite(e[0])}function NO(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Og(t){return t.geometry.coordinates}function rte(t,e){const r=NO(),{pointFeatures:i,lineFeatures:n,polygonFeatures:o,polygonOutlineFeatures:s}=t;return r.points.data=i,r.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),r.points.getPosition=Og,r.lines.data=n,r.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),r.lines.getPath=Og,r.polygons.data=o,r.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),r.polygons.getPolygon=Og,r.polygonsOutline.data=s,r.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),r.polygonsOutline.getPath=Og,r}function ite(t,e){const r=NO(),{points:i,lines:n,polygons:o}=t,s=Mee(t,e);return r.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:s.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:3,value:s.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines._pathType="open",r.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:3,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},r.polygons._normalize=!1,o.triangles&&(r.polygons.data.attributes.indices=o.triangles.value),r.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:3,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},r.polygonsOutline._pathType="open",r}const nte=["points","linestrings","polygons"],ste={...ep(hm.circle),...ep(hm.icon),...ep(hm.text),...ep(fm),...ep(Fb),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class kc extends rs{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:r}){if(!r.dataChanged)return;const{data:i}=this.props,n=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:n}),n?this._updateStateBinary({props:e,changeFlags:r}):this._updateStateJSON({props:e,changeFlags:r})}_updateStateBinary({props:e,changeFlags:r}){const i=ite(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:r}){const i=Qee(e.data),n=this.getSubLayerRow.bind(this);let o={};const s={};if(Array.isArray(r.dataChanged)){const A=this.state.features;for(const v in A)o[v]=A[v].slice(),s[v]=[];for(const v of r.dataChanged){const w=K3(i,n,v);for(const C in A)s[C].push(BO({data:o[C],getIndex:I=>I.__source.index,dataRange:v,replace:w[C]}))}}else o=K3(i,n);const f=rte(o,s);this.setState({features:o,featuresDiff:s,layerProps:f})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:i,sourceLayer:n}=r;return r.featureType=nte.find(o=>n.id.startsWith(`${this.id}-${o}-`)),i>=0&&n.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[i]),r}_updateAutoHighlight(e){const r=`${this.id}-points-`,i=e.featureType==="points";for(const n of this.getSubLayers())n.id.startsWith(r)===i&&n.updateAutoHighlight(e)}_renderPolygonLayer(){var s;const{extruded:e,wireframe:r}=this.props,{layerProps:i}=this.state,n="polygons-fill",o=this.shouldRenderSubLayer(n,(s=i.polygons)==null?void 0:s.data)&&this.getSubLayerClass(n,Fb.type);if(o){const f=Hv(this,Fb.props),A=e&&r;return A||delete f.getLineColor,f.updateTriggers.lineColors=A,new o(f,this.getSubLayerProps({id:n,updateTriggers:f.updateTriggers}),i.polygons)}return null}_renderLineLayers(){var A,v;const{extruded:e,stroked:r}=this.props,{layerProps:i}=this.state,n="polygons-stroke",o="linestrings",s=!e&&r&&this.shouldRenderSubLayer(n,(A=i.polygonsOutline)==null?void 0:A.data)&&this.getSubLayerClass(n,fm.type),f=this.shouldRenderSubLayer(o,(v=i.lines)==null?void 0:v.data)&&this.getSubLayerClass(o,fm.type);if(s||f){const w=Hv(this,fm.props);return[s&&new s(w,this.getSubLayerProps({id:n,updateTriggers:w.updateTriggers}),i.polygonsOutline),f&&new f(w,this.getSubLayerProps({id:o,updateTriggers:w.updateTriggers}),i.lines)]}return null}_renderPointLayers(){var f;const{pointType:e}=this.props,{layerProps:r,binary:i}=this.state;let{highlightedObjectIndex:n}=this.props;!i&&Number.isFinite(n)&&(n=r.points.data.findIndex(A=>A.__source.index===n));const o=new Set(e.split("+")),s=[];for(const A of o){const v=`points-${A}`,w=hm[A],C=w&&this.shouldRenderSubLayer(v,(f=r.points)==null?void 0:f.data)&&this.getSubLayerClass(v,w.type);if(C){const I=Hv(this,w.props);let B=r.points;if(A==="text"&&i){const{instancePickingColors:F,...N}=B.data.attributes;B={...B,data:{...B.data,attributes:N}}}s.push(new C(I,this.getSubLayerProps({id:v,updateTriggers:I.updateTriggers,highlightedObjectIndex:n}),B))}}return s}renderLayers(){const{extruded:e}=this.props,r=this._renderPolygonLayer(),i=this._renderLineLayers(),n=this._renderPointLayers();return[!e&&r,i,n,e&&r]}getSubLayerAccessor(e){const{binary:r}=this.state;return!r||typeof e!="function"?super.getSubLayerAccessor(e):(i,n)=>{const{data:o,index:s}=n,f=Pee(o,s);return e(f,n)}}}kc.layerName="GeoJsonLayer";kc.defaultProps=ste;const ote=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:c0,BitmapLayer:L_,ColumnLayer:Lc,GeoJsonLayer:kc,GridCellLayer:N_,IconLayer:dA,LineLayer:u0,PathLayer:$h,PointCloudLayer:h0,PolygonLayer:Vu,ScatterplotLayer:f0,SolidPolygonLayer:zu,TextLayer:Zh,_MultiIconLayer:V_,_TextBackgroundLayer:d0},Symbol.toStringTag,{value:"Module"}));function ate(t){return typeof t=="string"?t.charAt(0).toLowerCase()+t.slice(1):t}function Lb(t){if(Array.isArray(t))return t.map(e=>Lb(e));if(t&&typeof t=="object"){const e={};for(const[r,i]of Object.entries(t))e[ate(r)]=Lb(i);return e}return t}var wx={},j_={};(function(t){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+e+"]["+r+"]*",n=new RegExp("^"+i+"$"),o=function(f,A){const v=[];let w=A.exec(f);for(;w;){const C=[];C.startIndex=A.lastIndex-w[0].length;const I=w.length;for(let B=0;B<I;B++)C.push(w[B]);v.push(C),w=A.exec(f)}return v},s=function(f){const A=n.exec(f);return!(A===null||typeof A>"u")};t.isExist=function(f){return typeof f<"u"},t.isEmptyObject=function(f){return Object.keys(f).length===0},t.merge=function(f,A,v){if(A){const w=Object.keys(A),C=w.length;for(let I=0;I<C;I++)v==="strict"?f[w[I]]=[A[w[I]]]:f[w[I]]=A[w[I]]}},t.getValue=function(f){return t.isExist(f)?f:""},t.isName=s,t.getAllMatches=o,t.nameRegexp=i})(j_);const Tx=j_,lte={allowBooleanAttributes:!1,unpairedTags:[]};wx.validate=function(t,e){e=Object.assign({},lte,e);const r=[];let i=!1,n=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(let o=0;o<t.length;o++)if(t[o]==="<"&&t[o+1]==="?"){if(o+=2,o=Q3(t,o),o.err)return o}else if(t[o]==="<"){let s=o;if(o++,t[o]==="!"){o=eP(t,o);continue}else{let f=!1;t[o]==="/"&&(f=!0,o++);let A="";for(;o<t.length&&t[o]!==">"&&t[o]!==" "&&t[o]!=="	"&&t[o]!==`
`&&t[o]!=="\r";o++)A+=t[o];if(A=A.trim(),A[A.length-1]==="/"&&(A=A.substring(0,A.length-1),o--),!gte(A)){let C;return A.trim().length===0?C="Invalid space after '<'.":C="Tag '"+A+"' is an invalid name.",Ln("InvalidTag",C,lo(t,o))}const v=hte(t,o);if(v===!1)return Ln("InvalidAttr","Attributes for '"+A+"' have open quote.",lo(t,o));let w=v.value;if(o=v.index,w[w.length-1]==="/"){const C=o-w.length;w=w.substring(0,w.length-1);const I=tP(w,e);if(I===!0)i=!0;else return Ln(I.err.code,I.err.msg,lo(t,C+I.err.line))}else if(f)if(v.tagClosed){if(w.trim().length>0)return Ln("InvalidTag","Closing tag '"+A+"' can't have attributes or invalid starting.",lo(t,s));if(r.length===0)return Ln("InvalidTag","Closing tag '"+A+"' has not been opened.",lo(t,s));{const C=r.pop();if(A!==C.tagName){let I=lo(t,C.tagStartPos);return Ln("InvalidTag","Expected closing tag '"+C.tagName+"' (opened in line "+I.line+", col "+I.col+") instead of closing tag '"+A+"'.",lo(t,s))}r.length==0&&(n=!0)}}else return Ln("InvalidTag","Closing tag '"+A+"' doesn't have proper closing.",lo(t,o));else{const C=tP(w,e);if(C!==!0)return Ln(C.err.code,C.err.msg,lo(t,o-w.length+C.err.line));if(n===!0)return Ln("InvalidXml","Multiple possible root nodes found.",lo(t,o));e.unpairedTags.indexOf(A)!==-1||r.push({tagName:A,tagStartPos:s}),i=!0}for(o++;o<t.length;o++)if(t[o]==="<")if(t[o+1]==="!"){o++,o=eP(t,o);continue}else if(t[o+1]==="?"){if(o=Q3(t,++o),o.err)return o}else break;else if(t[o]==="&"){const C=Ate(t,o);if(C==-1)return Ln("InvalidChar","char '&' is not expected.",lo(t,o));o=C}else if(n===!0&&!J3(t[o]))return Ln("InvalidXml","Extra text at the end",lo(t,o));t[o]==="<"&&o--}}else{if(J3(t[o]))continue;return Ln("InvalidChar","char '"+t[o]+"' is not expected.",lo(t,o))}if(i){if(r.length==1)return Ln("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",lo(t,r[0].tagStartPos));if(r.length>0)return Ln("InvalidXml","Invalid '"+JSON.stringify(r.map(o=>o.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Ln("InvalidXml","Start tag expected.",1);return!0};function J3(t){return t===" "||t==="	"||t===`
`||t==="\r"}function Q3(t,e){const r=e;for(;e<t.length;e++)if(t[e]=="?"||t[e]==" "){const i=t.substr(r,e-r);if(e>5&&i==="xml")return Ln("InvalidXml","XML declaration allowed only at the start of the document.",lo(t,e));if(t[e]=="?"&&t[e+1]==">"){e++;break}else continue}return e}function eP(t,e){if(t.length>e+5&&t[e+1]==="-"&&t[e+2]==="-"){for(e+=3;e<t.length;e++)if(t[e]==="-"&&t[e+1]==="-"&&t[e+2]===">"){e+=2;break}}else if(t.length>e+8&&t[e+1]==="D"&&t[e+2]==="O"&&t[e+3]==="C"&&t[e+4]==="T"&&t[e+5]==="Y"&&t[e+6]==="P"&&t[e+7]==="E"){let r=1;for(e+=8;e<t.length;e++)if(t[e]==="<")r++;else if(t[e]===">"&&(r--,r===0))break}else if(t.length>e+9&&t[e+1]==="["&&t[e+2]==="C"&&t[e+3]==="D"&&t[e+4]==="A"&&t[e+5]==="T"&&t[e+6]==="A"&&t[e+7]==="["){for(e+=8;e<t.length;e++)if(t[e]==="]"&&t[e+1]==="]"&&t[e+2]===">"){e+=2;break}}return e}const cte='"',ute="'";function hte(t,e){let r="",i="",n=!1;for(;e<t.length;e++){if(t[e]===cte||t[e]===ute)i===""?i=t[e]:i!==t[e]||(i="");else if(t[e]===">"&&i===""){n=!0;break}r+=t[e]}return i!==""?!1:{value:r,index:e,tagClosed:n}}const fte=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function tP(t,e){const r=Tx.getAllMatches(t,fte),i={};for(let n=0;n<r.length;n++){if(r[n][1].length===0)return Ln("InvalidAttr","Attribute '"+r[n][2]+"' has no space in starting.",tp(r[n]));if(r[n][3]!==void 0&&r[n][4]===void 0)return Ln("InvalidAttr","Attribute '"+r[n][2]+"' is without value.",tp(r[n]));if(r[n][3]===void 0&&!e.allowBooleanAttributes)return Ln("InvalidAttr","boolean attribute '"+r[n][2]+"' is not allowed.",tp(r[n]));const o=r[n][2];if(!pte(o))return Ln("InvalidAttr","Attribute '"+o+"' is an invalid name.",tp(r[n]));if(!i.hasOwnProperty(o))i[o]=1;else return Ln("InvalidAttr","Attribute '"+o+"' is repeated.",tp(r[n]))}return!0}function dte(t,e){let r=/\d/;for(t[e]==="x"&&(e++,r=/[\da-fA-F]/);e<t.length;e++){if(t[e]===";")return e;if(!t[e].match(r))break}return-1}function Ate(t,e){if(e++,t[e]===";")return-1;if(t[e]==="#")return e++,dte(t,e);let r=0;for(;e<t.length;e++,r++)if(!(t[e].match(/\w/)&&r<20)){if(t[e]===";")break;return-1}return e}function Ln(t,e,r){return{err:{code:t,msg:e,line:r.line||r,col:r.col}}}function pte(t){return Tx.isName(t)}function gte(t){return Tx.isName(t)}function lo(t,e){const r=t.substring(0,e).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function tp(t){return t.startIndex+t[1].length}var Ex={};const UO={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,e,r){return t}},mte=function(t){return Object.assign({},UO,t)};Ex.buildOptions=mte;Ex.defaultOptions=UO;class _te{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,r){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:r})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}var yte=_te;const vte=j_;function bte(t,e){const r={};if(t[e+3]==="O"&&t[e+4]==="C"&&t[e+5]==="T"&&t[e+6]==="Y"&&t[e+7]==="P"&&t[e+8]==="E"){e=e+9;let i=1,n=!1,o=!1,s="";for(;e<t.length;e++)if(t[e]==="<"&&!o){if(n&&Tte(t,e))e+=7,[entityName,val,e]=xte(t,e+1),val.indexOf("&")===-1&&(r[Pte(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&Ete(t,e))e+=8;else if(n&&Ste(t,e))e+=8;else if(n&&Cte(t,e))e+=9;else if(wte)o=!0;else throw new Error("Invalid DOCTYPE");i++,s=""}else if(t[e]===">"){if(o?t[e-1]==="-"&&t[e-2]==="-"&&(o=!1,i--):i--,i===0)break}else t[e]==="["?n=!0:s+=t[e];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:e}}function xte(t,e){let r="";for(;e<t.length&&t[e]!=="'"&&t[e]!=='"';e++)r+=t[e];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");const i=t[e++];let n="";for(;e<t.length&&t[e]!==i;e++)n+=t[e];return[r,n,e]}function wte(t,e){return t[e+1]==="!"&&t[e+2]==="-"&&t[e+3]==="-"}function Tte(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="N"&&t[e+4]==="T"&&t[e+5]==="I"&&t[e+6]==="T"&&t[e+7]==="Y"}function Ete(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="L"&&t[e+4]==="E"&&t[e+5]==="M"&&t[e+6]==="E"&&t[e+7]==="N"&&t[e+8]==="T"}function Ste(t,e){return t[e+1]==="!"&&t[e+2]==="A"&&t[e+3]==="T"&&t[e+4]==="T"&&t[e+5]==="L"&&t[e+6]==="I"&&t[e+7]==="S"&&t[e+8]==="T"}function Cte(t,e){return t[e+1]==="!"&&t[e+2]==="N"&&t[e+3]==="O"&&t[e+4]==="T"&&t[e+5]==="A"&&t[e+6]==="T"&&t[e+7]==="I"&&t[e+8]==="O"&&t[e+9]==="N"}function Pte(t){if(vte.isName(t))return t;throw new Error(`Invalid entity name ${t}`)}var Ite=bte;const Mte=/^[-+]?0x[a-fA-F0-9]+$/,Rte=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Bte={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Ote(t,e={}){if(e=Object.assign({},Bte,e),!t||typeof t!="string")return t;let r=t.trim();if(e.skipLike!==void 0&&e.skipLike.test(r))return t;if(e.hex&&Mte.test(r))return Number.parseInt(r,16);{const i=Rte.exec(r);if(i){const n=i[1],o=i[2];let s=Dte(i[3]);const f=i[4]||i[6];if(!e.leadingZeros&&o.length>0&&n&&r[2]!==".")return t;if(!e.leadingZeros&&o.length>0&&!n&&r[1]!==".")return t;{const A=Number(r),v=""+A;return v.search(/[eE]/)!==-1||f?e.eNotation?A:t:r.indexOf(".")!==-1?v==="0"&&s===""||v===s||n&&v==="-"+s?A:t:o?s===v||n+s===v?A:t:r===v||r===n+v?A:t}}else return t}}function Dte(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substr(0,t.length-1))),t}var Fte=Ote;function Lte(t){return typeof t=="function"?t:Array.isArray(t)?e=>{for(const r of t)if(typeof r=="string"&&e===r||r instanceof RegExp&&r.test(e))return!0}:()=>!1}var zO=Lte;const VO=j_,rp=yte,kte=Ite,Nte=Fte,Ute=zO;let zte=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(r,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(r,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=Vte,this.parseXml=Xte,this.parseTextData=jte,this.resolveNameSpace=Hte,this.buildAttributesMap=Wte,this.isItStopNode=Kte,this.replaceEntitiesValue=$te,this.readStopNodeData=Jte,this.saveTextToParentTag=Zte,this.addChild=qte,this.ignoreAttributesFn=Ute(this.options.ignoreAttributes)}};function Vte(t){const e=Object.keys(t);for(let r=0;r<e.length;r++){const i=e[r];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:t[i]}}}function jte(t,e,r,i,n,o,s){if(t!==void 0&&(this.options.trimValues&&!i&&(t=t.trim()),t.length>0)){s||(t=this.replaceEntitiesValue(t));const f=this.options.tagValueProcessor(e,t,r,n,o);return f==null?t:typeof f!=typeof t||f!==t?f:this.options.trimValues?Nb(t,this.options.parseTagValue,this.options.numberParseOptions):t.trim()===t?Nb(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function Hte(t){if(this.options.removeNSPrefix){const e=t.split(":"),r=t.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(t=r+e[1])}return t}const Gte=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Wte(t,e,r){if(this.options.ignoreAttributes!==!0&&typeof t=="string"){const i=VO.getAllMatches(t,Gte),n=i.length,o={};for(let s=0;s<n;s++){const f=this.resolveNameSpace(i[s][1]);if(this.ignoreAttributesFn(f,e))continue;let A=i[s][4],v=this.options.attributeNamePrefix+f;if(f.length)if(this.options.transformAttributeName&&(v=this.options.transformAttributeName(v)),v==="__proto__"&&(v="#__proto__"),A!==void 0){this.options.trimValues&&(A=A.trim()),A=this.replaceEntitiesValue(A);const w=this.options.attributeValueProcessor(f,A,e);w==null?o[v]=A:typeof w!=typeof A||w!==A?o[v]=w:o[v]=Nb(A,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(o[v]=!0)}if(!Object.keys(o).length)return;if(this.options.attributesGroupName){const s={};return s[this.options.attributesGroupName]=o,s}return o}}const Xte=function(t){t=t.replace(/\r\n?/g,`
`);const e=new rp("!xml");let r=e,i="",n="";for(let o=0;o<t.length;o++)if(t[o]==="<")if(t[o+1]==="/"){const f=Mh(t,">",o,"Closing Tag is not closed.");let A=t.substring(o+2,f).trim();if(this.options.removeNSPrefix){const C=A.indexOf(":");C!==-1&&(A=A.substr(C+1))}this.options.transformTagName&&(A=this.options.transformTagName(A)),r&&(i=this.saveTextToParentTag(i,r,n));const v=n.substring(n.lastIndexOf(".")+1);if(A&&this.options.unpairedTags.indexOf(A)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${A}>`);let w=0;v&&this.options.unpairedTags.indexOf(v)!==-1?(w=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):w=n.lastIndexOf("."),n=n.substring(0,w),r=this.tagsNodeStack.pop(),i="",o=f}else if(t[o+1]==="?"){let f=kb(t,o,!1,"?>");if(!f)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,r,n),!(this.options.ignoreDeclaration&&f.tagName==="?xml"||this.options.ignorePiTags)){const A=new rp(f.tagName);A.add(this.options.textNodeName,""),f.tagName!==f.tagExp&&f.attrExpPresent&&(A[":@"]=this.buildAttributesMap(f.tagExp,n,f.tagName)),this.addChild(r,A,n)}o=f.closeIndex+1}else if(t.substr(o+1,3)==="!--"){const f=Mh(t,"-->",o+4,"Comment is not closed.");if(this.options.commentPropName){const A=t.substring(o+4,f-2);i=this.saveTextToParentTag(i,r,n),r.add(this.options.commentPropName,[{[this.options.textNodeName]:A}])}o=f}else if(t.substr(o+1,2)==="!D"){const f=kte(t,o);this.docTypeEntities=f.entities,o=f.i}else if(t.substr(o+1,2)==="!["){const f=Mh(t,"]]>",o,"CDATA is not closed.")-2,A=t.substring(o+9,f);i=this.saveTextToParentTag(i,r,n);let v=this.parseTextData(A,r.tagname,n,!0,!1,!0,!0);v==null&&(v=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:A}]):r.add(this.options.textNodeName,v),o=f+2}else{let f=kb(t,o,this.options.removeNSPrefix),A=f.tagName;const v=f.rawTagName;let w=f.tagExp,C=f.attrExpPresent,I=f.closeIndex;this.options.transformTagName&&(A=this.options.transformTagName(A)),r&&i&&r.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,r,n,!1));const B=r;if(B&&this.options.unpairedTags.indexOf(B.tagname)!==-1&&(r=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),A!==e.tagname&&(n+=n?"."+A:A),this.isItStopNode(this.options.stopNodes,n,A)){let F="";if(w.length>0&&w.lastIndexOf("/")===w.length-1)A[A.length-1]==="/"?(A=A.substr(0,A.length-1),n=n.substr(0,n.length-1),w=A):w=w.substr(0,w.length-1),o=f.closeIndex;else if(this.options.unpairedTags.indexOf(A)!==-1)o=f.closeIndex;else{const V=this.readStopNodeData(t,v,I+1);if(!V)throw new Error(`Unexpected end of ${v}`);o=V.i,F=V.tagContent}const N=new rp(A);A!==w&&C&&(N[":@"]=this.buildAttributesMap(w,n,A)),F&&(F=this.parseTextData(F,A,n,!0,C,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),N.add(this.options.textNodeName,F),this.addChild(r,N,n)}else{if(w.length>0&&w.lastIndexOf("/")===w.length-1){A[A.length-1]==="/"?(A=A.substr(0,A.length-1),n=n.substr(0,n.length-1),w=A):w=w.substr(0,w.length-1),this.options.transformTagName&&(A=this.options.transformTagName(A));const F=new rp(A);A!==w&&C&&(F[":@"]=this.buildAttributesMap(w,n,A)),this.addChild(r,F,n),n=n.substr(0,n.lastIndexOf("."))}else{const F=new rp(A);this.tagsNodeStack.push(r),A!==w&&C&&(F[":@"]=this.buildAttributesMap(w,n,A)),this.addChild(r,F,n),r=F}i="",o=I}}else i+=t[o];return e.child};function qte(t,e,r){const i=this.options.updateTag(e.tagname,r,e[":@"]);i===!1||(typeof i=="string"&&(e.tagname=i),t.addChild(e))}const $te=function(t){if(this.options.processEntities){for(let e in this.docTypeEntities){const r=this.docTypeEntities[e];t=t.replace(r.regx,r.val)}for(let e in this.lastEntities){const r=this.lastEntities[e];t=t.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const r=this.htmlEntities[e];t=t.replace(r.regex,r.val)}t=t.replace(this.ampEntity.regex,this.ampEntity.val)}return t};function Zte(t,e,r,i){return t&&(i===void 0&&(i=Object.keys(e.child).length===0),t=this.parseTextData(t,e.tagname,r,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,i),t!==void 0&&t!==""&&e.add(this.options.textNodeName,t),t=""),t}function Kte(t,e,r){const i="*."+r;for(const n in t){const o=t[n];if(i===o||e===o)return!0}return!1}function Yte(t,e,r=">"){let i,n="";for(let o=e;o<t.length;o++){let s=t[o];if(i)s===i&&(i="");else if(s==='"'||s==="'")i=s;else if(s===r[0])if(r[1]){if(t[o+1]===r[1])return{data:n,index:o}}else return{data:n,index:o};else s==="	"&&(s=" ");n+=s}}function Mh(t,e,r,i){const n=t.indexOf(e,r);if(n===-1)throw new Error(i);return n+e.length-1}function kb(t,e,r,i=">"){const n=Yte(t,e+1,i);if(!n)return;let o=n.data;const s=n.index,f=o.search(/\s/);let A=o,v=!0;f!==-1&&(A=o.substring(0,f),o=o.substring(f+1).trimStart());const w=A;if(r){const C=A.indexOf(":");C!==-1&&(A=A.substr(C+1),v=A!==n.data.substr(C+1))}return{tagName:A,tagExp:o,closeIndex:s,attrExpPresent:v,rawTagName:w}}function Jte(t,e,r){const i=r;let n=1;for(;r<t.length;r++)if(t[r]==="<")if(t[r+1]==="/"){const o=Mh(t,">",r,`${e} is not closed`);if(t.substring(r+2,o).trim()===e&&(n--,n===0))return{tagContent:t.substring(i,r),i:o};r=o}else if(t[r+1]==="?")r=Mh(t,"?>",r+1,"StopNode is not closed.");else if(t.substr(r+1,3)==="!--")r=Mh(t,"-->",r+3,"StopNode is not closed.");else if(t.substr(r+1,2)==="![")r=Mh(t,"]]>",r,"StopNode is not closed.")-2;else{const o=kb(t,r,">");o&&((o&&o.tagName)===e&&o.tagExp[o.tagExp.length-1]!=="/"&&n++,r=o.closeIndex)}}function Nb(t,e,r){if(e&&typeof t=="string"){const i=t.trim();return i==="true"?!0:i==="false"?!1:Nte(t,r)}else return VO.isExist(t)?t:""}var Qte=zte,jO={};function ere(t,e){return HO(t,e)}function HO(t,e,r){let i;const n={};for(let o=0;o<t.length;o++){const s=t[o],f=tre(s);let A="";if(r===void 0?A=f:A=r+"."+f,f===e.textNodeName)i===void 0?i=s[f]:i+=""+s[f];else{if(f===void 0)continue;if(s[f]){let v=HO(s[f],e,A);const w=ire(v,e);s[":@"]?rre(v,s[":@"],A,e):Object.keys(v).length===1&&v[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?v=v[e.textNodeName]:Object.keys(v).length===0&&(e.alwaysCreateTextNode?v[e.textNodeName]="":v=""),n[f]!==void 0&&n.hasOwnProperty(f)?(Array.isArray(n[f])||(n[f]=[n[f]]),n[f].push(v)):e.isArray(f,A,w)?n[f]=[v]:n[f]=v}}}return typeof i=="string"?i.length>0&&(n[e.textNodeName]=i):i!==void 0&&(n[e.textNodeName]=i),n}function tre(t){const e=Object.keys(t);for(let r=0;r<e.length;r++){const i=e[r];if(i!==":@")return i}}function rre(t,e,r,i){if(e){const n=Object.keys(e),o=n.length;for(let s=0;s<o;s++){const f=n[s];i.isArray(f,r+"."+f,!0,!0)?t[f]=[e[f]]:t[f]=e[f]}}}function ire(t,e){const{textNodeName:r}=e,i=Object.keys(t).length;return!!(i===0||i===1&&(t[r]||typeof t[r]=="boolean"||t[r]===0))}jO.prettify=ere;const{buildOptions:nre}=Ex,sre=Qte,{prettify:ore}=jO,are=wx;let lre=class{constructor(e){this.externalEntities={},this.options=nre(e)}parse(e,r){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});const o=are.validate(e,r);if(o!==!0)throw Error(`${o.err.msg}:${o.err.line}:${o.err.col}`)}const i=new sre(this.options);i.addExternalEntities(this.externalEntities);const n=i.parseXml(e);return this.options.preserveOrder||n===void 0?n:ore(n,this.options)}addEntity(e,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=r}};var cre=lre;const ure=`
`;function hre(t,e){let r="";return e.format&&e.indentBy.length>0&&(r=ure),GO(t,e,"",r)}function GO(t,e,r,i){let n="",o=!1;for(let s=0;s<t.length;s++){const f=t[s],A=fre(f);if(A===void 0)continue;let v="";if(r.length===0?v=A:v=`${r}.${A}`,A===e.textNodeName){let F=f[A];dre(v,e)||(F=e.tagValueProcessor(A,F),F=WO(F,e)),o&&(n+=i),n+=F,o=!1;continue}else if(A===e.cdataPropName){o&&(n+=i),n+=`<![CDATA[${f[A][0][e.textNodeName]}]]>`,o=!1;continue}else if(A===e.commentPropName){n+=i+`<!--${f[A][0][e.textNodeName]}-->`,o=!0;continue}else if(A[0]==="?"){const F=rP(f[":@"],e),N=A==="?xml"?"":i;let V=f[A][0][e.textNodeName];V=V.length!==0?" "+V:"",n+=N+`<${A}${V}${F}?>`,o=!0;continue}let w=i;w!==""&&(w+=e.indentBy);const C=rP(f[":@"],e),I=i+`<${A}${C}`,B=GO(f[A],e,v,w);e.unpairedTags.indexOf(A)!==-1?e.suppressUnpairedNode?n+=I+">":n+=I+"/>":(!B||B.length===0)&&e.suppressEmptyNode?n+=I+"/>":B&&B.endsWith(">")?n+=I+`>${B}${i}</${A}>`:(n+=I+">",B&&i!==""&&(B.includes("/>")||B.includes("</"))?n+=i+e.indentBy+B+i:n+=B,n+=`</${A}>`),o=!0}return n}function fre(t){const e=Object.keys(t);for(let r=0;r<e.length;r++){const i=e[r];if(t.hasOwnProperty(i)&&i!==":@")return i}}function rP(t,e){let r="";if(t&&!e.ignoreAttributes)for(let i in t){if(!t.hasOwnProperty(i))continue;let n=e.attributeValueProcessor(i,t[i]);n=WO(n,e),n===!0&&e.suppressBooleanAttributes?r+=` ${i.substr(e.attributeNamePrefix.length)}`:r+=` ${i.substr(e.attributeNamePrefix.length)}="${n}"`}return r}function dre(t,e){t=t.substr(0,t.length-e.textNodeName.length-1);let r=t.substr(t.lastIndexOf(".")+1);for(let i in e.stopNodes)if(e.stopNodes[i]===t||e.stopNodes[i]==="*."+r)return!0;return!1}function WO(t,e){if(t&&t.length>0&&e.processEntities)for(let r=0;r<e.entities.length;r++){const i=e.entities[r];t=t.replace(i.regex,i.val)}return t}var Are=hre;const pre=Are,gre=zO,mre={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ju(t){this.options=Object.assign({},mre,t),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=gre(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=vre),this.processTextOrObjNode=_re,this.options.format?(this.indentate=yre,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}ju.prototype.build=function(t){return this.options.preserveOrder?pre(t,this.options):(Array.isArray(t)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t={[this.options.arrayNodeName]:t}),this.j2x(t,0,[]).val)};ju.prototype.j2x=function(t,e,r){let i="",n="";const o=r.join(".");for(let s in t)if(Object.prototype.hasOwnProperty.call(t,s))if(typeof t[s]>"u")this.isAttribute(s)&&(n+="");else if(t[s]===null)this.isAttribute(s)?n+="":s[0]==="?"?n+=this.indentate(e)+"<"+s+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+s+"/"+this.tagEndChar;else if(t[s]instanceof Date)n+=this.buildTextValNode(t[s],s,"",e);else if(typeof t[s]!="object"){const f=this.isAttribute(s);if(f&&!this.ignoreAttributesFn(f,o))i+=this.buildAttrPairStr(f,""+t[s]);else if(!f)if(s===this.options.textNodeName){let A=this.options.tagValueProcessor(s,""+t[s]);n+=this.replaceEntitiesValue(A)}else n+=this.buildTextValNode(t[s],s,"",e)}else if(Array.isArray(t[s])){const f=t[s].length;let A="",v="";for(let w=0;w<f;w++){const C=t[s][w];if(!(typeof C>"u"))if(C===null)s[0]==="?"?n+=this.indentate(e)+"<"+s+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+s+"/"+this.tagEndChar;else if(typeof C=="object")if(this.options.oneListGroup){const I=this.j2x(C,e+1,r.concat(s));A+=I.val,this.options.attributesGroupName&&C.hasOwnProperty(this.options.attributesGroupName)&&(v+=I.attrStr)}else A+=this.processTextOrObjNode(C,s,e,r);else if(this.options.oneListGroup){let I=this.options.tagValueProcessor(s,C);I=this.replaceEntitiesValue(I),A+=I}else A+=this.buildTextValNode(C,s,"",e)}this.options.oneListGroup&&(A=this.buildObjectNode(A,s,v,e)),n+=A}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){const f=Object.keys(t[s]),A=f.length;for(let v=0;v<A;v++)i+=this.buildAttrPairStr(f[v],""+t[s][f[v]])}else n+=this.processTextOrObjNode(t[s],s,e,r);return{attrStr:i,val:n}};ju.prototype.buildAttrPairStr=function(t,e){return e=this.options.attributeValueProcessor(t,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+t:" "+t+'="'+e+'"'};function _re(t,e,r,i){const n=this.j2x(t,r+1,i.concat(e));return t[this.options.textNodeName]!==void 0&&Object.keys(t).length===1?this.buildTextValNode(t[this.options.textNodeName],e,n.attrStr,r):this.buildObjectNode(n.val,e,n.attrStr,r)}ju.prototype.buildObjectNode=function(t,e,r,i){if(t==="")return e[0]==="?"?this.indentate(i)+"<"+e+r+"?"+this.tagEndChar:this.indentate(i)+"<"+e+r+this.closeTag(e)+this.tagEndChar;{let n="</"+e+this.tagEndChar,o="";return e[0]==="?"&&(o="?",n=""),(r||r==="")&&t.indexOf("<")===-1?this.indentate(i)+"<"+e+r+o+">"+t+n:this.options.commentPropName!==!1&&e===this.options.commentPropName&&o.length===0?this.indentate(i)+`<!--${t}-->`+this.newLine:this.indentate(i)+"<"+e+r+o+this.tagEndChar+t+this.indentate(i)+n}};ju.prototype.closeTag=function(t){let e="";return this.options.unpairedTags.indexOf(t)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${t}`,e};ju.prototype.buildTextValNode=function(t,e,r,i){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${t}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(i)+`<!--${t}-->`+this.newLine;if(e[0]==="?")return this.indentate(i)+"<"+e+r+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(e,t);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+e+r+this.closeTag(e)+this.tagEndChar:this.indentate(i)+"<"+e+r+">"+n+"</"+e+this.tagEndChar}};ju.prototype.replaceEntitiesValue=function(t){if(t&&t.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const r=this.options.entities[e];t=t.replace(r.regex,r.val)}return t};function yre(t){return this.options.indentBy.repeat(t)}function vre(t){return t.startsWith(this.options.attributeNamePrefix)&&t!==this.options.textNodeName?t.substr(this.attrPrefixLen):!1}var bre=ju;const xre=wx,wre=cre,Tre=bre;var Ere={XMLParser:wre,XMLValidator:xre,XMLBuilder:Tre};function iP(t,e){if(e!=null&&e._parser&&e._parser!=="fast-xml-parser")throw new Error(e==null?void 0:e._parser);const r={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:e==null?void 0:e.removeNSPrefix,textNodeName:e==null?void 0:e.textNodeName,isArray:(n,o,s,f)=>{var v;return!!((v=e==null?void 0:e.arrayPaths)!=null&&v.some(w=>o===w))},...e==null?void 0:e._fastXML},i=Sre(t,r);return e!=null&&e.uncapitalizeKeys?Lb(i):i}function Sre(t,e){return new Ere.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(t)}const Cre="4.2.4",Io={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Cre,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:Pre,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(t,e)=>iP(new TextDecoder().decode(t),{...Io.options.xml,...e==null?void 0:e.xml}),parseTextSync:(t,e)=>iP(t,{...Io.options.xml,...e==null?void 0:e.xml})};function Pre(t){return t.startsWith("<?xml")}function Ire(t,e){var o,s,f;const r=(o=Io.parseTextSync)==null?void 0:o.call(Io,t,e),i=((s=r==null?void 0:r.ServiceExceptionReport)==null?void 0:s.ServiceException)||((f=r==null?void 0:r["ogc:ServiceExceptionReport"])==null?void 0:f["ogc:ServiceException"]);return typeof i=="string"?i:i.value||i.code||"Unknown error"}const Mre="4.2.4",vu={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:Mre,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:Rre,options:{wms:{throwOnError:!1}},parse:async(t,e)=>Gv(new TextDecoder().decode(t),e),parseSync:(t,e)=>Gv(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>Gv(t,e)};function Rre(t){return t.startsWith("<?xml")}function Gv(t,e){const r={...vu.options.wms,...e==null?void 0:e.wms},i=Ire(t,r),n=r.minimalErrors?i:`WMS Service error: ${i}`;if(r.throwOnError)throw new Error(n);return n}function rA(t){return Array.isArray(t)?t:t?[t]:[]}function H_(t){const e=rA(t);return e.length>0&&e.every(r=>typeof r=="string")?e:[]}function Dg(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseFloat(t);default:return}}function Wv(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseInt(t,10);default:return}}function Vd(t){switch(t){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function nP(t,e){var o;const r=(o=Io.parseTextSync)==null?void 0:o.call(Io,t,e),i=r.WMT_MS_Capabilities||r.WMS_Capabilities||r,n=Bre(i);if(e!=null&&e.inheritedLayerProps)for(const s of n.layers)qO(s,null);return e!=null&&e.includeRawJSON&&(n.json=i),e!=null&&e.includeXMLText&&(n.xml=t),n}function Bre(t){var i,n,o,s,f,A,v,w,C,I,B,F,N,V,G,Y;const e={version:String(t.version||""),name:String(((i=t.Service)==null?void 0:i.Name)||"unnamed"),title:(n=t.Service)!=null&&n.Title?String((o=t.Service)==null?void 0:o.Title):void 0,abstract:(s=t.Service)!=null&&s.Abstract?String((f=t.Service)==null?void 0:f.Abstract):void 0,keywords:H_((v=(A=t.Service)==null?void 0:A.KeywordList)==null?void 0:v.Keyword),fees:(w=t.Service)!=null&&w.Fees?JSON.stringify((C=t.Service)==null?void 0:C.Fees):void 0,accessConstraints:(I=t.Service)!=null&&I.AccessConstraints?JSON.stringify((B=t.Service)==null?void 0:B.AccessConstraints):void 0,layerLimit:Wv((F=t.Service)==null?void 0:F.LayerLimit),maxWidth:Wv((N=t.Service)==null?void 0:N.maxWidth),maxHeight:Wv((V=t.Service)==null?void 0:V.maxHeight),layers:[],requests:Ore((G=t.Capability)==null?void 0:G.Request),exceptions:Dre(t.Exception)},r=rA((Y=t.Capability)==null?void 0:Y.Layer);for(const Z of r)e.layers.push(XO(Z));for(const[Z,se]of Object.entries(e))se===void 0&&delete e[Z];return e}function Ore(t){const e={};for(const[r,i]of Object.entries(t||{})){const n=H_(i==null?void 0:i.Format);e[r]={mimeTypes:n}}return e}function Dre(t){if(rA(t==null?void 0:t.Format).length>0)return{mimeTypes:H_(t)}}function XO(t){var v;const e={title:String((t==null?void 0:t.Title)||""),name:(t==null?void 0:t.Name)&&String(t==null?void 0:t.Name),abstract:(t==null?void 0:t.Name)&&String(t==null?void 0:t.Abstract),keywords:H_((v=t.KeywordList)==null?void 0:v.Keyword)},r=(t==null?void 0:t.CRS)||(t==null?void 0:t.SRS);r&&Array.isArray(r)&&r.every(w=>typeof w=="string")&&(e.crs=r);let i=(t==null?void 0:t.EX_GeographicBoundingBox)&&Fre(t==null?void 0:t.EX_GeographicBoundingBox);i&&(e.geographicBoundingBox=i),i=(t==null?void 0:t.LatLonBoundingBox)&&Lre(t==null?void 0:t.LatLonBoundingBox),i&&(e.geographicBoundingBox=i);const n=(t==null?void 0:t.BoundingBox)&&kre(t==null?void 0:t.BoundingBox);n&&n.length>0&&(e.boundingBoxes=n);const s=rA(t==null?void 0:t.Dimension).map(w=>Ure(w));s.length&&(e.dimensions=s),t!=null&&t.opaque&&(e.opaque=Vd(t==null?void 0:t.opaque)),t!=null&&t.cascaded&&(e.cascaded=Vd(t==null?void 0:t.cascaded)),t!=null&&t.queryable&&(e.queryable=Vd(t==null?void 0:t.queryable));const f=rA(t==null?void 0:t.Layer),A=[];for(const w of f)A.push(XO(w));A.length>0&&(e.layers=A);for(const[w,C]of Object.entries(e))C===void 0&&delete e[w];return e}function Fre(t){const{westBoundLongitude:e,northBoundLatitude:r,eastBoundLongitude:i,southBoundLatitude:n}=t;return[[e,n],[i,r]]}function Lre(t){const{minx:e,miny:r,maxx:i,maxy:n}=t;return[[e,r],[i,n]]}function kre(t){return rA(t).map(r=>Nre(r))}function Nre(t){const{CRS:e,SRS:r,minx:i,miny:n,maxx:o,maxy:s,resx:f,resy:A}=t,v={crs:e||r,boundingBox:[[Dg(i),Dg(n)],[Dg(o),Dg(s)]]};return f&&(v.xResolution=f),A&&(v.yResolution=A),v}function Ure(t){const{name:e,units:r,value:i}=t,n={name:e,units:r,extent:i};return t.unitSymbol&&(n.unitSymbol=t.unitSymbol),t.default&&(n.defaultValue=t.default),t.multipleValues&&(n.multipleValues=Vd(t.multipleValues)),t.nearestValue&&(n.nearestValue=Vd(t.nearestValue)),t.current&&(n.current=Vd(t.current)),n}function qO(t,e){e!=null&&e.geographicBoundingBox&&!t.geographicBoundingBox&&(t.geographicBoundingBox=[...e.geographicBoundingBox]),e!=null&&e.crs&&!t.crs&&(t.crs=[...e.crs]),e!=null&&e.boundingBoxes&&!t.boundingBoxes&&(t.boundingBoxes=[...e.boundingBoxes]),e!=null&&e.dimensions&&!t.dimensions&&(t.dimensions=[...e.dimensions]);for(const r of t.layers||[])qO(r,t)}const zre="4.2.4",Sx={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:zre,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:Vre,options:{wms:{}},parse:async(t,e)=>nP(new TextDecoder().decode(t),e==null?void 0:e.wms),parseTextSync:(t,e)=>nP(t,e==null?void 0:e.wms)};function Vre(t){return t.startsWith("<?xml")}function sP(t,e){var o,s;const i=((s=((o=Io.parseTextSync)==null?void 0:o.call(Io,t,e)).FeatureInfoResponse)==null?void 0:s.FIELDS)||[];return{features:(Array.isArray(i)?i:[i]).map(f=>jre(f))}}function jre(t){return{attributes:t||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const Hre={...Sx,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(t,e)=>sP(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>sP(t,e)};function oP(t,e){var i;return(i=Io.parseTextSync)==null?void 0:i.call(Io,t,e)}const Gre={...Sx,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(t,e)=>oP(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>oP(t,e)};function Wre(t,e){const{type:r="auto"}=t,i=r==="auto"?qre(t.url,e):Xre(r,e);if(!i)throw new Error("Not a valid image source type");return i.create(t)}function Xre(t,e){for(const r of e)if(r.type===t)return r;return null}function qre(t,e){for(const r of e)if(r.testURL&&r.testURL(t))return r;return null}const $re={type:"wms",testURL:t=>t.toLowerCase().includes("wms"),create:t=>new Zre(t)};class Zre extends Fp{constructor(r){super(r);U(this,"url");U(this,"data");U(this,"substituteCRS84");U(this,"flipCRS");U(this,"wmsParameters");U(this,"vendorParameters");U(this,"capabilities",null);this.url=r.url,this.data=r.url,this.substituteCRS84=r.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...r.wmsParameters},this.vendorParameters=r.vendorParameters||{}}async getMetadata(){const r=await this.getCapabilities();return this.normalizeMetadata(r)}async getImage(r){const{boundingBox:i,bbox:n,...o}=r,s={bbox:i?[...i[0],...i[1]]:n,...o};return await this.getMap(s)}normalizeMetadata(r){return r}async getCapabilities(r,i){const n=this.getCapabilitiesURL(r,i),o=await this.fetch(n),s=await o.arrayBuffer();this._checkResponse(o,s);const f=await Sx.parse(s,this.loadOptions);return this.capabilities=f,f}async getMap(r,i){const n=this.getMapURL(r,i),o=await this.fetch(n),s=await o.arrayBuffer();this._checkResponse(o,s);try{return await Lp.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}async getFeatureInfo(r,i){const n=this.getFeatureInfoURL(r,i),o=await this.fetch(n),s=await o.arrayBuffer();return this._checkResponse(o,s),await Hre.parse(s,this.loadOptions)}async getFeatureInfoText(r,i){const n=this.getFeatureInfoURL(r,i),o=await this.fetch(n),s=await o.arrayBuffer();return this._checkResponse(o,s),new TextDecoder().decode(s)}async describeLayer(r,i){const n=this.describeLayerURL(r,i),o=await this.fetch(n),s=await o.arrayBuffer();return this._checkResponse(o,s),await Gre.parse(s,this.loadOptions)}async getLegendGraphic(r,i){const n=this.getLegendGraphicURL(r,i),o=await this.fetch(n),s=await o.arrayBuffer();this._checkResponse(o,s);try{return await Lp.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}getCapabilitiesURL(r,i){const n={version:this.wmsParameters.version,...r};return this._getWMSUrl("GetCapabilities",n,i)}getMapURL(r,i){r=this._getWMS130Parameters(r);const n={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...r};return this._getWMSUrl("GetMap",n,i)}getFeatureInfoURL(r,i){r=this._getWMS130Parameters(r);const{boundingBox:n,bbox:o}=r;r.bbox=n?[...n[0],...n[1]]:o;const s={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...r};return this._getWMSUrl("GetFeatureInfo",s,i)}describeLayerURL(r,i){const n={version:this.wmsParameters.version,...r};return this._getWMSUrl("DescribeLayer",n,i)}getLegendGraphicURL(r,i){const n={version:this.wmsParameters.version,...r};return this._getWMSUrl("GetLegendGraphic",n,i)}_parseWMSUrl(r){const[i,n]=r.split("?"),o=n.split("&"),s={};for(const f of o){const[A,v]=f.split("=");s[A]=v}return{url:i,parameters:s}}_getWMSUrl(r,i,n){let o=this.url,s=!0;const f={service:"WMS",version:i.version,request:r,...i,...this.vendorParameters,...n},A=["transparent","time","elevation"];for(const[v,w]of Object.entries(f))(!A.includes(v)||w)&&(o+=s?"?":"&",s=!1,o+=this._getURLParameter(v,w,i));return encodeURI(o)}_getWMS130Parameters(r){const i={...r};return i.srs&&(i.crs=i.crs||i.srs,delete i.srs),i}_getURLParameter(r,i,n){switch(r){case"crs":n.version!=="1.3.0"?r="srs":this.substituteCRS84&&i==="EPSG:4326"&&(i="CRS:84");break;case"srs":n.version==="1.3.0"&&(r="crs");break;case"bbox":const o=this._flipBoundingBox(i,n);o&&(i=o);break;case"x":n.version==="1.3.0"&&(r="i");break;case"y":n.version==="1.3.0"&&(r="j");break}return r=r.toUpperCase(),Array.isArray(i)?`${r}=${i.join(",")}`:`${r}=${i?String(i):""}`}_flipBoundingBox(r,i){if(!Array.isArray(r)||r.length!==4)return null;const n=i.version==="1.3.0"&&this.flipCRS.includes(i.crs||"")&&!(this.substituteCRS84&&i.crs==="EPSG:4326"),o=r;return n?[o[1],o[0],o[3],o[2]]:o}async _fetchArrayBuffer(r){const i=await this.fetch(r),n=await i.arrayBuffer();return this._checkResponse(i,n),n}_checkResponse(r,i){var o;const n=r.headers["content-type"];if(!r.ok||vu.mimeTypes.includes(n)){const s=YM(this.loadOptions,{wms:{throwOnError:!0}}),f=(o=vu.parseSync)==null?void 0:o.call(vu,i,s);throw new Error(f)}}_parseError(r){var n;const i=(n=vu.parseSync)==null?void 0:n.call(vu,r,this.loadOptions);return new Error(i)}}class Ub extends Fp{constructor(e){super(e)}async getMetadata(){throw new Error("ImageSource.getMetadata not implemented")}async getImage(e){const r=this.getGranularParameters(e),i=this.getURLFromTemplate(r),o=await(await this.fetch(i)).arrayBuffer();return await Lp.parse(o)}getGranularParameters(e){const[[r,i],[n,o]]=e.boundingBox;return{...e,east:r,north:i,south:o,west:n}}getURLFromTemplate(e){let r=this.props.url;for(const[i,n]of Object.entries(e))r=r.replace(`\${${i}}`,String(n)),r=r.replace(`{${i}}`,String(n));return r}}U(Ub,"type","template"),U(Ub,"testURL",e=>e.toLowerCase().includes("{"));class Kre extends Ub{constructor(r){super(r);U(this,"data");this.data=r.url}async getMetadata(){return await this.metadata()}async getImage(r){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(r){throw new Error("not implemented")}metadataURL(r){return`${this.props.url}?f=pjson`}exportImageURL(r){const i=`bbox=${r.bbox[0]},${r.bbox[1]},${r.bbox[2]},${r.bbox[3]}`,n=`size=${r.width},${r.height}`,o={...r,bbox:i,size:n};return delete o.width,delete o.height,this.getUrl("exportImage",o)}getUrl(r,i,n){let o=`${this.props.url}/${r}`,s=!0;for(const[f,A]of Object.entries(i))o+=s?"?":"&",s=!1,Array.isArray(A)?o+=`${f.toUpperCase()}=${A.join(",")}`:o+=`${f.toUpperCase()}=${A?String(A):""}`;return o}async checkResponse(r){if(!r.ok)throw new Error("error")}}const Yre={type:"arcgis-image-server",testURL:t=>t.toLowerCase().includes("ImageServer"),create:t=>new Kre(t)},Jre=[$re,Yre];function Qre(t){return Wre(t,Jre)}const aP=6378137*Math.PI;function lP(t){const e=Rc(t);return e[0]=(e[0]/256-1)*aP,e[1]=(e[1]/256-1)*aP,e}const eie={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(t,e)=>console.error(e,t)}};class Cx extends rs{get isLoaded(){var e;return((e=this.state)==null?void 0:e.loadCounter)===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:r,oldProps:i}){const{viewport:n}=this.context;e.dataChanged||r.serviceType!==i.serviceType?(this.state.imageSource=this._createImageSource(r),this._loadMetadata(),this.debounce(()=>this.loadImage(n,"image source changed"),0)):Ws(r.layers,i.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(n,"viewport changed")):this.debounce(()=>this.loadImage(n,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:e,image:r,lastRequestParameters:i}=this.state;return r&&new L_({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:i.srs==="EPSG:4326"?br.LNGLAT:br.CARTESIAN,bounds:e,image:r})}async getFeatureInfoText(e,r){var n,o;const{lastRequestParameters:i}=this.state;return i?await((o=(n=this.state.imageSource).getFeatureInfoText)==null?void 0:o.call(n,{...i,query_layers:i.layers,x:e,y:r,info_format:"application/vnd.ogc.gml"})):""}_createImageSource(e){if(e.data instanceof Fp)return e.data;if(typeof e.data=="string")return Qre({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){var r,i;const{imageSource:e}=this.state;try{this.state.loadCounter++;const n=await e.getMetadata();this.state.imageSource===e&&((r=this.getCurrentLayer())==null||r.props.onMetadataLoad(n))}catch(n){(i=this.getCurrentLayer())==null||i.props.onMetadataLoadError(n)}finally{this.state.loadCounter--}}async loadImage(e,r){var C,I;const{layers:i,serviceType:n}=this.props;if(n==="wms"&&i.length===0)return;const o=e.getBounds(),{width:s,height:f}=e,A=this.getRequestId();let{srs:v}=this.props;v==="auto"&&(v=e.resolution?"EPSG:4326":"EPSG:3857");const w={width:s,height:f,boundingBox:[[o[0],o[1]],[o[2],o[3]]],layers:i,crs:v};if(v==="EPSG:3857"){const B=lP([o[0],o[1]]),F=lP([o[2],o[3]]);w.boundingBox=[B,F]}try{this.state.loadCounter++,this.props.onImageLoadStart(A);const B=await this.state.imageSource.getImage(w);this.state.lastRequestId<A&&((C=this.getCurrentLayer())==null||C.props.onImageLoad(A),this.setState({image:B,bounds:o,lastRequestParameters:w,lastRequestId:A}))}catch(B){this.raiseError(B,"Load image"),(I=this.getCurrentLayer())==null||I.props.onImageLoadError(A,B)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,r=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),r)}}Cx.layerName="WMSLayer";Cx.defaultProps=eie;const tie={getHeight:{type:"accessor",value:0},greatCircle:!0};class Px extends c0{}Px.layerName="GreatCircleLayer";Px.defaultProps=tie;const rie={...Vu.defaultProps};class Hu extends rs{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:r,wireframe:i,filled:n,stroked:o,lineWidthUnits:s,lineWidthScale:f,lineWidthMinPixels:A,lineWidthMaxPixels:v,lineJointRounded:w,lineMiterLimit:C,lineDashJustified:I,getElevation:B,getFillColor:F,getLineColor:N,getLineWidth:V}=this.props,{updateTriggers:G,material:Y,transitions:Z}=this.props,se=this.getSubLayerClass("cell",Vu),{updateTriggers:ge,...Pe}=this.indexToBounds()||{};return new se({filled:n,wireframe:i,extruded:r,elevationScale:e,stroked:o,lineWidthUnits:s,lineWidthScale:f,lineWidthMinPixels:A,lineWidthMaxPixels:v,lineJointRounded:w,lineMiterLimit:C,lineDashJustified:I,material:Y,transitions:Z,getElevation:B,getFillColor:F,getLineColor:N,getLineWidth:V},this.getSubLayerProps({id:"cell",updateTriggers:G&&{...ge,getElevation:G.getElevation,getFillColor:G.getFillColor,getLineColor:G.getLineColor,getLineWidth:G.getLineWidth}}),Pe)}}Hu.layerName="GeoCellLayer";Hu.defaultProps=rie;var $O={exports:{}};(function(t){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(e,r){typeof kL=="function"&&t&&t.exports?t.exports=r():(e.dcodeIO=e.dcodeIO||{}).Long=r()})(VM,function(){function e(Te,Ae,Le){this.low=Te|0,this.high=Ae|0,this.unsigned=!!Le}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function r(Te){return(Te&&Te.__isLong__)===!0}e.isLong=r;var i={},n={};function o(Te,Ae){var Le,Ve,Xe;return Ae?(Te>>>=0,(Xe=0<=Te&&Te<256)&&(Ve=n[Te],Ve)?Ve:(Le=f(Te,(Te|0)<0?-1:0,!0),Xe&&(n[Te]=Le),Le)):(Te|=0,(Xe=-128<=Te&&Te<128)&&(Ve=i[Te],Ve)?Ve:(Le=f(Te,Te<0?-1:0,!1),Xe&&(i[Te]=Le),Le))}e.fromInt=o;function s(Te,Ae){if(isNaN(Te)||!isFinite(Te))return Ae?Y:G;if(Ae){if(Te<0)return Y;if(Te>=F)return Ue}else{if(Te<=-N)return Fe;if(Te+1>=N)return Pe}return Te<0?s(-Te,Ae).neg():f(Te%B|0,Te/B|0,Ae)}e.fromNumber=s;function f(Te,Ae,Le){return new e(Te,Ae,Le)}e.fromBits=f;var A=Math.pow;function v(Te,Ae,Le){if(Te.length===0)throw Error("empty string");if(Te==="NaN"||Te==="Infinity"||Te==="+Infinity"||Te==="-Infinity")return G;if(typeof Ae=="number"?(Le=Ae,Ae=!1):Ae=!!Ae,Le=Le||10,Le<2||36<Le)throw RangeError("radix");var Ve;if((Ve=Te.indexOf("-"))>0)throw Error("interior hyphen");if(Ve===0)return v(Te.substring(1),Ae,Le).neg();for(var Xe=s(A(Le,8)),dt=G,Nt=0;Nt<Te.length;Nt+=8){var gr=Math.min(8,Te.length-Nt),mr=parseInt(Te.substring(Nt,Nt+gr),Le);if(gr<8){var _r=s(A(Le,gr));dt=dt.mul(_r).add(s(mr))}else dt=dt.mul(Xe),dt=dt.add(s(mr))}return dt.unsigned=Ae,dt}e.fromString=v;function w(Te){return Te instanceof e?Te:typeof Te=="number"?s(Te):typeof Te=="string"?v(Te):f(Te.low,Te.high,Te.unsigned)}e.fromValue=w;var C=65536,I=1<<24,B=C*C,F=B*B,N=F/2,V=o(I),G=o(0);e.ZERO=G;var Y=o(0,!0);e.UZERO=Y;var Z=o(1);e.ONE=Z;var se=o(1,!0);e.UONE=se;var ge=o(-1);e.NEG_ONE=ge;var Pe=f(-1,2147483647,!1);e.MAX_VALUE=Pe;var Ue=f(-1,-1,!0);e.MAX_UNSIGNED_VALUE=Ue;var Fe=f(0,-2147483648,!1);e.MIN_VALUE=Fe;var pe=e.prototype;return pe.toInt=function(){return this.unsigned?this.low>>>0:this.low},pe.toNumber=function(){return this.unsigned?(this.high>>>0)*B+(this.low>>>0):this.high*B+(this.low>>>0)},pe.toString=function(Ae){if(Ae=Ae||10,Ae<2||36<Ae)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Fe)){var Le=s(Ae),Ve=this.div(Le),Xe=Ve.mul(Le).sub(this);return Ve.toString(Ae)+Xe.toInt().toString(Ae)}else return"-"+this.neg().toString(Ae);for(var dt=s(A(Ae,6),this.unsigned),Nt=this,gr="";;){var mr=Nt.div(dt),_r=Nt.sub(mr.mul(dt)).toInt()>>>0,rr=_r.toString(Ae);if(Nt=mr,Nt.isZero())return rr+gr;for(;rr.length<6;)rr="0"+rr;gr=""+rr+gr}},pe.getHighBits=function(){return this.high},pe.getHighBitsUnsigned=function(){return this.high>>>0},pe.getLowBits=function(){return this.low},pe.getLowBitsUnsigned=function(){return this.low>>>0},pe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Fe)?64:this.neg().getNumBitsAbs();for(var Ae=this.high!=0?this.high:this.low,Le=31;Le>0&&!(Ae&1<<Le);Le--);return this.high!=0?Le+33:Le+1},pe.isZero=function(){return this.high===0&&this.low===0},pe.isNegative=function(){return!this.unsigned&&this.high<0},pe.isPositive=function(){return this.unsigned||this.high>=0},pe.isOdd=function(){return(this.low&1)===1},pe.isEven=function(){return(this.low&1)===0},pe.equals=function(Ae){return r(Ae)||(Ae=w(Ae)),this.unsigned!==Ae.unsigned&&this.high>>>31===1&&Ae.high>>>31===1?!1:this.high===Ae.high&&this.low===Ae.low},pe.eq=pe.equals,pe.notEquals=function(Ae){return!this.eq(Ae)},pe.neq=pe.notEquals,pe.lessThan=function(Ae){return this.comp(Ae)<0},pe.lt=pe.lessThan,pe.lessThanOrEqual=function(Ae){return this.comp(Ae)<=0},pe.lte=pe.lessThanOrEqual,pe.greaterThan=function(Ae){return this.comp(Ae)>0},pe.gt=pe.greaterThan,pe.greaterThanOrEqual=function(Ae){return this.comp(Ae)>=0},pe.gte=pe.greaterThanOrEqual,pe.compare=function(Ae){if(r(Ae)||(Ae=w(Ae)),this.eq(Ae))return 0;var Le=this.isNegative(),Ve=Ae.isNegative();return Le&&!Ve?-1:!Le&&Ve?1:this.unsigned?Ae.high>>>0>this.high>>>0||Ae.high===this.high&&Ae.low>>>0>this.low>>>0?-1:1:this.sub(Ae).isNegative()?-1:1},pe.comp=pe.compare,pe.negate=function(){return!this.unsigned&&this.eq(Fe)?Fe:this.not().add(Z)},pe.neg=pe.negate,pe.add=function(Ae){r(Ae)||(Ae=w(Ae));var Le=this.high>>>16,Ve=this.high&65535,Xe=this.low>>>16,dt=this.low&65535,Nt=Ae.high>>>16,gr=Ae.high&65535,mr=Ae.low>>>16,_r=Ae.low&65535,rr=0,Ot=0,Qt=0,qt=0;return qt+=dt+_r,Qt+=qt>>>16,qt&=65535,Qt+=Xe+mr,Ot+=Qt>>>16,Qt&=65535,Ot+=Ve+gr,rr+=Ot>>>16,Ot&=65535,rr+=Le+Nt,rr&=65535,f(Qt<<16|qt,rr<<16|Ot,this.unsigned)},pe.subtract=function(Ae){return r(Ae)||(Ae=w(Ae)),this.add(Ae.neg())},pe.sub=pe.subtract,pe.multiply=function(Ae){if(this.isZero()||(r(Ae)||(Ae=w(Ae)),Ae.isZero()))return G;if(this.eq(Fe))return Ae.isOdd()?Fe:G;if(Ae.eq(Fe))return this.isOdd()?Fe:G;if(this.isNegative())return Ae.isNegative()?this.neg().mul(Ae.neg()):this.neg().mul(Ae).neg();if(Ae.isNegative())return this.mul(Ae.neg()).neg();if(this.lt(V)&&Ae.lt(V))return s(this.toNumber()*Ae.toNumber(),this.unsigned);var Le=this.high>>>16,Ve=this.high&65535,Xe=this.low>>>16,dt=this.low&65535,Nt=Ae.high>>>16,gr=Ae.high&65535,mr=Ae.low>>>16,_r=Ae.low&65535,rr=0,Ot=0,Qt=0,qt=0;return qt+=dt*_r,Qt+=qt>>>16,qt&=65535,Qt+=Xe*_r,Ot+=Qt>>>16,Qt&=65535,Qt+=dt*mr,Ot+=Qt>>>16,Qt&=65535,Ot+=Ve*_r,rr+=Ot>>>16,Ot&=65535,Ot+=Xe*mr,rr+=Ot>>>16,Ot&=65535,Ot+=dt*gr,rr+=Ot>>>16,Ot&=65535,rr+=Le*_r+Ve*mr+Xe*gr+dt*Nt,rr&=65535,f(Qt<<16|qt,rr<<16|Ot,this.unsigned)},pe.mul=pe.multiply,pe.divide=function(Ae){if(r(Ae)||(Ae=w(Ae)),Ae.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?Y:G;var Le,Ve,Xe;if(this.unsigned){if(Ae.unsigned||(Ae=Ae.toUnsigned()),Ae.gt(this))return Y;if(Ae.gt(this.shru(1)))return se;Xe=Y}else{if(this.eq(Fe)){if(Ae.eq(Z)||Ae.eq(ge))return Fe;if(Ae.eq(Fe))return Z;var dt=this.shr(1);return Le=dt.div(Ae).shl(1),Le.eq(G)?Ae.isNegative()?Z:ge:(Ve=this.sub(Ae.mul(Le)),Xe=Le.add(Ve.div(Ae)),Xe)}else if(Ae.eq(Fe))return this.unsigned?Y:G;if(this.isNegative())return Ae.isNegative()?this.neg().div(Ae.neg()):this.neg().div(Ae).neg();if(Ae.isNegative())return this.div(Ae.neg()).neg();Xe=G}for(Ve=this;Ve.gte(Ae);){Le=Math.max(1,Math.floor(Ve.toNumber()/Ae.toNumber()));for(var Nt=Math.ceil(Math.log(Le)/Math.LN2),gr=Nt<=48?1:A(2,Nt-48),mr=s(Le),_r=mr.mul(Ae);_r.isNegative()||_r.gt(Ve);)Le-=gr,mr=s(Le,this.unsigned),_r=mr.mul(Ae);mr.isZero()&&(mr=Z),Xe=Xe.add(mr),Ve=Ve.sub(_r)}return Xe},pe.div=pe.divide,pe.modulo=function(Ae){return r(Ae)||(Ae=w(Ae)),this.sub(this.div(Ae).mul(Ae))},pe.mod=pe.modulo,pe.not=function(){return f(~this.low,~this.high,this.unsigned)},pe.and=function(Ae){return r(Ae)||(Ae=w(Ae)),f(this.low&Ae.low,this.high&Ae.high,this.unsigned)},pe.or=function(Ae){return r(Ae)||(Ae=w(Ae)),f(this.low|Ae.low,this.high|Ae.high,this.unsigned)},pe.xor=function(Ae){return r(Ae)||(Ae=w(Ae)),f(this.low^Ae.low,this.high^Ae.high,this.unsigned)},pe.shiftLeft=function(Ae){return r(Ae)&&(Ae=Ae.toInt()),(Ae&=63)===0?this:Ae<32?f(this.low<<Ae,this.high<<Ae|this.low>>>32-Ae,this.unsigned):f(0,this.low<<Ae-32,this.unsigned)},pe.shl=pe.shiftLeft,pe.shiftRight=function(Ae){return r(Ae)&&(Ae=Ae.toInt()),(Ae&=63)===0?this:Ae<32?f(this.low>>>Ae|this.high<<32-Ae,this.high>>Ae,this.unsigned):f(this.high>>Ae-32,this.high>=0?0:-1,this.unsigned)},pe.shr=pe.shiftRight,pe.shiftRightUnsigned=function(Ae){if(r(Ae)&&(Ae=Ae.toInt()),Ae&=63,Ae===0)return this;var Le=this.high;if(Ae<32){var Ve=this.low;return f(Ve>>>Ae|Le<<32-Ae,Le>>>Ae,this.unsigned)}else return Ae===32?f(Le,0,this.unsigned):f(Le>>>Ae-32,0,this.unsigned)},pe.shru=pe.shiftRightUnsigned,pe.toSigned=function(){return this.unsigned?f(this.low,this.high,!1):this},pe.toUnsigned=function(){return this.unsigned?this:f(this.low,this.high,!0)},pe.toBytes=function(Te){return Te?this.toBytesLE():this.toBytesBE()},pe.toBytesLE=function(){var Te=this.high,Ae=this.low;return[Ae&255,Ae>>>8&255,Ae>>>16&255,Ae>>>24&255,Te&255,Te>>>8&255,Te>>>16&255,Te>>>24&255]},pe.toBytesBE=function(){var Te=this.high,Ae=this.low;return[Te>>>24&255,Te>>>16&255,Te>>>8&255,Te&255,Ae>>>24&255,Ae>>>16&255,Ae>>>8&255,Ae&255]},e})})($O);var iie=$O.exports;const dm=oA(iie),nie=3,sie=30,oie=2*sie+1,cP=180/Math.PI;function aie(t,e,r){const i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function uP(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function lie(t){return[uP(t[0]),uP(t[1])]}function cie(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function uie([t,e,r]){const i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*cP,i*cP]}function hie(t){let e=dm.fromString(t,!0,10).toString(2);for(;e.length<nie+oie;)e="0"+e;const r=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,r),o=n.length/2,s=dm.fromString(i,!0,2).toString(10);let f=dm.fromString(n,!0,2).toString(4);for(;f.length<o;)f="0"+f;return`${s}/${f}`}function fie(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}function die(t){const e=t.split("/"),r=parseInt(e[0],10),i=e[1],n=i.length,o=[0,0];let s;for(let f=n-1;f>=0;f--){s=n-f;const A=i[f];let v=0,w=0;A==="1"?w=1:A==="2"?(v=1,w=1):A==="3"&&(v=1);const C=Math.pow(2,s-1);fie(C,o,v,w),o[0]+=C*v,o[1]+=C*w}if(r%2===1){const f=o[0];o[0]=o[1],o[1]=f}return{face:r,ij:o,level:s}}function Aie(t){const e=t.padEnd(16,"0");return dm.fromString(e,16)}const pie=100;function gie({face:t,ij:e,level:r}){const i=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(pie*Math.pow(2,-r))),o=new Float64Array(4*n*2+2);let s=0,f=0;for(let A=0;A<4;A++){const v=i[A].slice(0),w=i[A+1],C=(w[0]-v[0])/n,I=(w[1]-v[1])/n;for(let B=0;B<n;B++){v[0]+=C,v[1]+=I;const F=aie(e,r,v),N=lie(F),V=cie(t,N),G=uie(V);Math.abs(G[1])>89.999&&(G[0]=f);const Y=G[0]-f;G[0]+=Y>180?-360:Y<-180?360:0,o[s++]=G[0],o[s++]=G[1],f=G[0]}}return o[s++]=o[0],o[s++]=o[1],o}function mie(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=Aie(t)}return hie(t.toString())}function _ie(t){const e=mie(t),r=die(e);return gie(r)}const yie={getS2Token:{type:"accessor",value:t=>t.token}};class G_ extends Hu{indexToBounds(){const{data:e,getS2Token:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>_ie(r(i,n))}}}G_.layerName="S2Layer";G_.defaultProps=yie;const Xv=512;function vie(t,e){let r=0,i=0,n=1<<t.length;const o=n/Xv;for(let s=0;s<t.length;s++){n>>=1;const f=parseInt(t[s]);f%2&&(r|=n),f>1&&(i|=n)}return[[r/o,Xv-i/o],[(r+e)/o,Xv-(i+e)/o]]}function bie(t,e=1){const[r,i]=vie(t,e),[n,o]=Gl(r),[s,f]=Gl(i);return[s,o,s,f,n,f,n,o,s,o]}const xie={getQuadkey:{type:"accessor",value:t=>t.quadkey}};class W_ extends Hu{indexToBounds(){const{data:e,extruded:r,getQuadkey:i}=this.props,n=r?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>bie(i(o,s),n),updateTriggers:{getPolygon:n}}}}W_.layerName="QuadkeyLayer";W_.defaultProps=xie;class ZO{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:r,onLoad:i,onError:n}){const{index:o,id:s,bbox:f,userData:A,zoom:v}=this,w=this._loaderId;this._abortController=new AbortController;const{signal:C}=this._abortController,I=await r.scheduleRequest(this,N=>N.isSelected?1:-1);if(!I){this._isCancelled=!0;return}if(this._isCancelled){I.done();return}let B=null,F;try{B=await e({index:o,id:s,bbox:f,userData:A,zoom:v,signal:C})}catch(N){F=N||!0}finally{I.done()}if(w===this._loaderId){if(this._loader=void 0,this.content=B,this._isCancelled&&!B){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,F?n(F,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Hs={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},hP=new Ke,wie=new Ke;class Ix{constructor(e=[0,0,0],r=[0,0,0],i){i=i||hP.copy(e).add(r).scale(.5),this.center=new Ke(i),this.halfDiagonal=new Ke(r).subtract(this.center),this.minimum=new Ke(e),this.maximum=new Ke(r)}clone(){return new Ix(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:r}=this,i=wie.from(e.normal),n=r.x*Math.abs(i.x)+r.y*Math.abs(i.y)+r.z*Math.abs(i.z),o=this.center.dot(i)+e.distance;return o-n>0?Hs.INSIDE:o+n<0?Hs.OUTSIDE:Hs.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const r=hP.from(e).subtract(this.center),{halfDiagonal:i}=this;let n=0,o;return o=Math.abs(r.x)-i.x,o>0&&(n+=o*o),o=Math.abs(r.y)-i.y,o>0&&(n+=o*o),o=Math.abs(r.z)-i.z,o>0&&(n+=o*o),n}}const ip=new Ke,fP=new Ke;class A0{constructor(e=[0,0,0],r=0){this.radius=-0,this.center=new Ke,this.fromCenterRadius(e,r)}fromCenterRadius(e,r){return this.center.from(e),this.radius=r,this}fromCornerPoints(e,r){return r=ip.from(r),this.center=new Ke().from(e).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new A0(this.center,this.radius)}union(e){const r=this.center,i=this.radius,n=e.center,o=e.radius,s=ip.copy(n).subtract(r),f=s.magnitude();if(i>=f+o)return this.clone();if(o>=f+i)return e.clone();const A=(i+f+o)*.5;return fP.copy(s).scale((-i+A)/f).add(r),this.center.copy(fP),this.radius=A,this}expand(e){const i=ip.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const r=J9(ip,e);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(e){const r=this.distanceTo(e);return r*r}distanceTo(e){const i=ip.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const r=this.center,i=this.radius,o=e.normal.dot(r)+e.distance;return o<-i?Hs.OUTSIDE:o<i?Hs.INTERSECTING:Hs.INSIDE}}const Tie=new Ke,Eie=new Ke,Fg=new Ke,Lg=new Ke,kg=new Ke,Sie=new Ke,Cie=new Ke,mc={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class p0{constructor(e=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new Ke().from(e),this.halfAxes=new Mn(r)}get halfSize(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new Ke(e).len(),new Ke(r).len(),new Ke(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new Ke(e).normalize(),o=new Ke(r).normalize(),s=new Ke(i).normalize();return new Up().fromMatrix3(new Mn([...n,...o,...s]))}fromCenterHalfSizeQuaternion(e,r,i){const n=new Up(i),o=new Mn().fromQuaternion(n);return o[0]=o[0]*r[0],o[1]=o[1]*r[0],o[2]=o[2]*r[0],o[3]=o[3]*r[1],o[4]=o[4]*r[1],o[5]=o[5]*r[1],o[6]=o[6]*r[2],o[7]=o[7]*r[2],o[8]=o[8]*r[2],this.center=new Ke().from(e),this.halfAxes=o,this}clone(){return new p0(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new A0){const r=this.halfAxes,i=r.getColumn(0,Fg),n=r.getColumn(1,Lg),o=r.getColumn(2,kg),s=Tie.copy(i).add(n).add(o);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){const r=this.center,i=e.normal,n=this.halfAxes,o=i.x,s=i.y,f=i.z,A=Math.abs(o*n[mc.COLUMN0ROW0]+s*n[mc.COLUMN0ROW1]+f*n[mc.COLUMN0ROW2])+Math.abs(o*n[mc.COLUMN1ROW0]+s*n[mc.COLUMN1ROW1]+f*n[mc.COLUMN1ROW2])+Math.abs(o*n[mc.COLUMN2ROW0]+s*n[mc.COLUMN2ROW1]+f*n[mc.COLUMN2ROW2]),v=i.dot(r)+e.distance;return v<=-A?Hs.OUTSIDE:v>=A?Hs.INSIDE:Hs.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const r=Eie.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,Fg),o=i.getColumn(1,Lg),s=i.getColumn(2,kg),f=n.magnitude(),A=o.magnitude(),v=s.magnitude();n.normalize(),o.normalize(),s.normalize();let w=0,C;return C=Math.abs(r.dot(n))-f,C>0&&(w+=C*C),C=Math.abs(r.dot(o))-A,C>0&&(w+=C*C),C=Math.abs(r.dot(s))-v,C>0&&(w+=C*C),w}computePlaneDistances(e,r,i=[-0,-0]){let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const s=this.center,f=this.halfAxes,A=f.getColumn(0,Fg),v=f.getColumn(1,Lg),w=f.getColumn(2,kg),C=Sie.copy(A).add(v).add(w).add(s),I=Cie.copy(C).subtract(e);let B=r.dot(I);return n=Math.min(B,n),o=Math.max(B,o),C.copy(s).add(A).add(v).subtract(w),I.copy(C).subtract(e),B=r.dot(I),n=Math.min(B,n),o=Math.max(B,o),C.copy(s).add(A).subtract(v).add(w),I.copy(C).subtract(e),B=r.dot(I),n=Math.min(B,n),o=Math.max(B,o),C.copy(s).add(A).subtract(v).subtract(w),I.copy(C).subtract(e),B=r.dot(I),n=Math.min(B,n),o=Math.max(B,o),s.copy(C).subtract(A).add(v).add(w),I.copy(C).subtract(e),B=r.dot(I),n=Math.min(B,n),o=Math.max(B,o),s.copy(C).subtract(A).add(v).subtract(w),I.copy(C).subtract(e),B=r.dot(I),n=Math.min(B,n),o=Math.max(B,o),s.copy(C).subtract(A).subtract(v).add(w),I.copy(C).subtract(e),B=r.dot(I),n=Math.min(B,n),o=Math.max(B,o),s.copy(C).subtract(A).subtract(v).subtract(w),I.copy(C).subtract(e),B=r.dot(I),n=Math.min(B,n),o=Math.max(B,o),i[0]=n,i[1]=o,i}transform(e){this.center.transformAsPoint(e);const r=this.halfAxes.getColumn(0,Fg);r.transformAsPoint(e);const i=this.halfAxes.getColumn(1,Lg);i.transformAsPoint(e);const n=this.halfAxes.getColumn(2,kg);return n.transformAsPoint(e),this.halfAxes=new Mn([...r,...i,...n]),this}getTransform(){throw new Error("not implemented")}}const dP=new Ke,AP=new Ke;class Xa{constructor(e=[0,0,1],r=0){this.normal=new Ke,this.distance=-0,this.fromNormalDistance(e,r)}fromNormalDistance(e,r){return qa(Number.isFinite(r)),this.normal.from(e).normalize(),this.distance=r,this}fromPointNormal(e,r){e=dP.from(e),this.normal.from(r).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,r,i,n){return this.normal.set(e,r,i),qa(Ca(this.normal.len(),1)),this.distance=n,this}clone(){return new Xa(this.normal,this.distance)}equals(e){return Ca(this.distance,e.distance)&&Ca(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const r=AP.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,r)}projectPointOntoPlane(e,r=[0,0,0]){const i=dP.from(e),n=this.getPointDistance(i),o=AP.copy(this.normal).scale(n);return i.subtract(o).to(r)}}const pP=[new Ke([1,0,0]),new Ke([0,1,0]),new Ke([0,0,1])],gP=new Ke,Pie=new Ke;class Jo{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*pP.length;const r=e.center,i=e.radius;let n=0;for(const o of pP){let s=this.planes[n],f=this.planes[n+1];s||(s=this.planes[n]=new Xa),f||(f=this.planes[n+1]=new Xa);const A=gP.copy(o).scale(-i).add(r);s.fromPointNormal(A,o);const v=gP.copy(o).scale(i).add(r),w=Pie.copy(o).negate();f.fromPointNormal(v,w),n+=2}return this}computeVisibility(e){let r=Hs.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case Hs.OUTSIDE:return Hs.OUTSIDE;case Hs.INTERSECTING:r=Hs.INTERSECTING;break}return r}computeVisibilityWithPlaneMask(e,r){if(qa(Number.isFinite(r),"parentPlaneMask is required."),r===Jo.MASK_OUTSIDE||r===Jo.MASK_INSIDE)return r;let i=Jo.MASK_INSIDE;const n=this.planes;for(let o=0;o<this.planes.length;++o){const s=o<31?1<<o:0;if(o<31&&!(r&s))continue;const f=n[o],A=e.intersectPlane(f);if(A===Hs.OUTSIDE)return Jo.MASK_OUTSIDE;A===Hs.INTERSECTING&&(i|=s)}return i}}Jo.MASK_OUTSIDE=4294967295;Jo.MASK_INSIDE=0;Jo.MASK_INDETERMINATE=2147483647;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;new Ke;const Fl=new Mn,Iie=new Mn,Mie=new Mn,Ng=new Mn,mP=new Mn;function Rie(t,e={}){const r=kz,i=10;let n=0,o=0;const s=Iie,f=Mie;s.identity(),f.copy(t);const A=r*Bie(f);for(;o<i&&Oie(f)>A;)Die(f,Ng),mP.copy(Ng).transpose(),f.multiplyRight(Ng),f.multiplyLeft(mP),s.multiplyRight(Ng),++n>2&&(++o,n=0);return e.unitary=s.toTarget(e.unitary),e.diagonal=f.toTarget(e.diagonal),e}function Bie(t){let e=0;for(let r=0;r<9;++r){const i=t[r];e+=i*i}return Math.sqrt(e)}const zb=[1,0,0],Vb=[2,2,1];function Oie(t){let e=0;for(let r=0;r<3;++r){const i=t[Fl.getElementIndex(Vb[r],zb[r])];e+=2*i*i}return Math.sqrt(e)}function Die(t,e){const r=hB;let i=0,n=1;for(let v=0;v<3;++v){const w=Math.abs(t[Fl.getElementIndex(Vb[v],zb[v])]);w>i&&(n=v,i=w)}const o=zb[n],s=Vb[n];let f=1,A=0;if(Math.abs(t[Fl.getElementIndex(s,o)])>r){const v=t[Fl.getElementIndex(s,s)],w=t[Fl.getElementIndex(o,o)],C=t[Fl.getElementIndex(s,o)],I=(v-w)/2/C;let B;I<0?B=-1/(-I+Math.sqrt(1+I*I)):B=1/(I+Math.sqrt(1+I*I)),f=1/Math.sqrt(1+B*B),A=B*f}return Mn.IDENTITY.to(e),e[Fl.getElementIndex(o,o)]=e[Fl.getElementIndex(s,s)]=f,e[Fl.getElementIndex(s,o)]=A,e[Fl.getElementIndex(o,s)]=-A,e}const mu=new Ke,Fie=new Ke,Lie=new Ke,kie=new Ke,Nie=new Ke,Uie=new Mn,zie={diagonal:new Mn,unitary:new Mn};function KO(t,e=new p0){if(!t||t.length===0)return e.halfAxes=new Mn([0,0,0,0,0,0,0,0,0]),e.center=new Ke,e;const r=t.length,i=new Ke(0,0,0);for(const pe of t)i.add(pe);const n=1/r;i.multiplyByScalar(n);let o=0,s=0,f=0,A=0,v=0,w=0;for(const pe of t){const Te=mu.copy(pe).subtract(i);o+=Te.x*Te.x,s+=Te.x*Te.y,f+=Te.x*Te.z,A+=Te.y*Te.y,v+=Te.y*Te.z,w+=Te.z*Te.z}o*=n,s*=n,f*=n,A*=n,v*=n,w*=n;const C=Uie;C[0]=o,C[1]=s,C[2]=f,C[3]=s,C[4]=A,C[5]=v,C[6]=f,C[7]=v,C[8]=w;const{unitary:I}=Rie(C,zie),B=e.halfAxes.copy(I);let F=B.getColumn(0,Lie),N=B.getColumn(1,kie),V=B.getColumn(2,Nie),G=-Number.MAX_VALUE,Y=-Number.MAX_VALUE,Z=-Number.MAX_VALUE,se=Number.MAX_VALUE,ge=Number.MAX_VALUE,Pe=Number.MAX_VALUE;for(const pe of t)mu.copy(pe),G=Math.max(mu.dot(F),G),Y=Math.max(mu.dot(N),Y),Z=Math.max(mu.dot(V),Z),se=Math.min(mu.dot(F),se),ge=Math.min(mu.dot(N),ge),Pe=Math.min(mu.dot(V),Pe);F=F.multiplyByScalar(.5*(se+G)),N=N.multiplyByScalar(.5*(ge+Y)),V=V.multiplyByScalar(.5*(Pe+Z)),e.center.copy(F).add(N).add(V);const Ue=Fie.set(G-se,Y-ge,Z-Pe).multiplyByScalar(.5),Fe=new Mn([Ue[0],0,0,0,Ue[1],0,0,0,Ue[2]]);return e.halfAxes.multiplyRight(Fe),e}const Cd=512,_P=3,YO=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],JO=YO.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),Vie=JO.concat([[.25,.5],[.75,.5]]);class Pd{constructor(e,r,i){this.x=e,this.y=r,this.z=i}get children(){if(!this._children){const e=this.x*2,r=this.y*2,i=this.z+1;this._children=[new Pd(e,r,i),new Pd(e,r+1,i),new Pd(e+1,r,i),new Pd(e+1,r+1,i)]}return this._children}update(e){const{viewport:r,cullingVolume:i,elevationBounds:n,minZ:o,maxZ:s,bounds:f,offset:A,project:v}=e,w=this.getBoundingVolume(n,A,v);if(f&&!this.insideBounds(f)||i.computeVisibility(w)<0)return!1;if(!this.childVisible){let{z:I}=this;if(I<s&&I>=o){const B=w.distanceTo(r.cameraPosition)*r.scale/r.height;I+=Math.floor(Math.log2(B))}if(I>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const I of this.children)I.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const r of this._children)r.getSelected(e);return e}insideBounds([e,r,i,n]){const o=Math.pow(2,this.z),s=Cd/o;return this.x*s<i&&this.y*s<n&&(this.x+1)*s>e&&(this.y+1)*s>r}getBoundingVolume(e,r,i){if(i){const A=this.z<1?Vie:this.z<2?JO:YO,v=[];for(const w of A){const C=Hb(this.x+w[0],this.y+w[1],this.z);C[2]=e[0],v.push(i(C)),e[0]!==e[1]&&(C[2]=e[1],v.push(i(C)))}return KO(v)}const n=Math.pow(2,this.z),o=Cd/n,s=this.x*o+r*Cd,f=Cd-(this.y+1)*o;return new Ix([s,f,e[0]],[s+o,f+o,e[1]])}}function jie(t,e,r,i){const n=t instanceof dX&&t.resolution?t.projectPosition:null,o=Object.values(t.getFrustumPlanes()).map(({normal:B,distance:F})=>new Xa(B.clone().negate(),F)),s=new Jo(o),f=t.distanceScales.unitsPerMeter[2],A=r&&r[0]*f||0,v=r&&r[1]*f||0,w=t instanceof zp&&t.pitch<=60?e:0;if(i){const[B,F,N,V]=i,G=Rc([B,V]),Y=Rc([N,F]);i=[G[0],Cd-G[1],Y[0],Cd-Y[1]]}const C=new Pd(0,0,0),I={viewport:t,project:n,cullingVolume:s,elevationBounds:[A,v],minZ:w,maxZ:e,bounds:i,offset:0};if(C.update(I),t instanceof zp&&t.subViewports&&t.subViewports.length>1){for(I.offset=-1;C.update(I)&&!(--I.offset<-_P););for(I.offset=1;C.update(I)&&!(++I.offset>_P););}return C.getSelected()}const Bc=512,Hie=[-1/0,-1/0,1/0,1/0],Qm={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(r=>typeof r=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const r=t.length;if(r!==e.length)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}};function QO(t,e){const r=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...r.map(n=>n[0])),Math.min(...r.map(n=>n[1])),Math.max(...r.map(n=>n[0])),Math.max(...r.map(n=>n[1]))]}function Gie(t){return Math.abs(t.split("").reduce((e,r)=>(e<<5)-e+r.charCodeAt(0)|0,0))}function Uh(t,e){if(!t||!t.length)return null;const{index:r,id:i}=e;if(Array.isArray(t)){const o=Gie(i)%t.length;t=t[o]}let n=t;for(const o of Object.keys(r)){const s=new RegExp(`{${o}}`,"g");n=n.replace(s,String(r[o]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),n}function Wie(t,e,r){let i;return i=t.getBounds(),t.isGeospatial?[Math.max(i[0],r[0]),Math.max(i[1],r[1]),Math.min(i[2],r[2]),Math.min(i[3],r[3])]:[Math.max(Math.min(i[0],r[2]),r[0]),Math.max(Math.min(i[1],r[3]),r[1]),Math.min(Math.max(i[2],r[0]),r[2]),Math.min(Math.max(i[3],r[1]),r[3])]}function Xie({viewport:t,z:e,cullRect:r}){return(t.subViewports||[t]).map(n=>jb(n,e||0,r))}function jb(t,e,r){if(!Array.isArray(e)){const o=r.x-t.x,s=r.y-t.y,{width:f,height:A}=r,v={targetZ:e},w=t.unproject([o,s],v),C=t.unproject([o+f,s],v),I=t.unproject([o,s+A],v),B=t.unproject([o+f,s+A],v);return[Math.min(w[0],C[0],I[0],B[0]),Math.min(w[1],C[1],I[1],B[1]),Math.max(w[0],C[0],I[0],B[0]),Math.max(w[1],C[1],I[1],B[1])]}const i=jb(t,e[0],r),n=jb(t,e[1],r);return[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[2],n[2]),Math.max(i[3],n[3])]}function qie(t,e,r){return r?QO(t,r).map(n=>n*e/Bc):t.map(i=>i*e/Bc)}function Mx(t,e){return Math.pow(2,t)*Bc/e}function Hb(t,e,r){const i=Mx(r,Bc),n=t/i*360-180,o=Math.PI-2*Math.PI*e/i,s=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[n,s]}function yP(t,e,r,i){const n=Mx(r,i);return[t/n*Bc,e/n*Bc]}function $ie(t,e,r,i,n=Bc){if(t.isGeospatial){const[v,w]=Hb(e,r,i),[C,I]=Hb(e+1,r+1,i);return{west:v,north:w,east:C,south:I}}const[o,s]=yP(e,r,i,n),[f,A]=yP(e+1,r+1,i,n);return{left:o,top:s,right:f,bottom:A}}function Zie(t,e,r,i,n){const o=Wie(t,null,i),s=Mx(e,r),[f,A,v,w]=qie(o,s,n),C=[];for(let I=Math.floor(f);I<v;I++)for(let B=Math.floor(A);B<w;B++)C.push({x:I,y:B,z:e});return C}function Kie({viewport:t,maxZoom:e,minZoom:r,zRange:i,extent:n,tileSize:o=Bc,modelMatrix:s,modelMatrixInverse:f,zoomOffset:A=0}){let v=t.isGeospatial?Math.round(t.zoom+Math.log2(Bc/o))+A:Math.ceil(t.zoom)+A;if(typeof r=="number"&&Number.isFinite(r)&&v<r){if(!n)return[];v=r}typeof e=="number"&&Number.isFinite(e)&&v>e&&(v=e);let w=n;return s&&f&&n&&!t.isGeospatial&&(w=QO(n,s)),t.isGeospatial?jie(t,v,i,n):Zie(t,v,o,w||Hie,f)}function Yie(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function Jie(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function Qie(t){let e={},r;return i=>{for(const n in i)if(!ene(i[n],e[n])){r=t(i),e=i;break}return r}}function ene(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}const vP=1,X_=2,tne="never",rne="no-overlap",Rx="best-available",ine=5,nne={[Rx]:one,[rne]:ane,[tne]:()=>{}},sne={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class q_{constructor(e){this._getCullBounds=Qie(Xie),this.opts={...sne,...e},this.setOptions(this.opts),this.onTileLoad=r=>{var i,n;(n=(i=this.opts).onTileLoad)==null||n.call(i,r),this.opts.maxCacheByteSize!=null&&(this._cacheByteSize+=r.byteLength,this._resizeCache())},this._requestScheduler=new rR({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Gr,this._modelMatrixInverse=new Gr}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const r=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(r)?this._cache.delete(e):r.setNeedsReload()}}update(e,{zRange:r,modelMatrix:i}={zRange:null,modelMatrix:null}){const n=i?new Gr(i):new Gr,o=!n.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Ca(this._zRange,r)||o){o&&(this._modelMatrixInverse=n.clone().invert(),this._modelMatrix=n),this._viewport=e,this._zRange=r;const f=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:r,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=f.map(A=>this._getTile(A,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(f=>this._getTile(f.index,!0)));const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(e,r){if(!e.isVisible)return!1;if(r&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:r}),{bbox:n}=e;for(const[o,s,f,A]of i){let v;if("west"in n)v=n.west<f&&n.east>o&&n.south<A&&n.north>s;else{const w=Math.min(n.top,n.bottom),C=Math.max(n.top,n.bottom);v=n.left<f&&n.right>o&&w<A&&C>s}if(v)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:r,minZoom:i,zRange:n,modelMatrix:o,modelMatrixInverse:s}){const{tileSize:f,extent:A,zoomOffset:v}=this.opts;return Kie({viewport:e,maxZoom:r,minZoom:i,zRange:n,tileSize:f,extent:A,modelMatrix:o,modelMatrixInverse:s,zoomOffset:v})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:r}=this.opts;return{bbox:$ie(this._viewport,e.x,e.y,e.z,r)}}getParentIndex(e){const r=Math.floor(e.x/2),i=Math.floor(e.y/2),n=e.z-1;return{x:r,y:i,z:n}}updateTileStates(){const e=this.opts.refinementStrategy||Rx,r=new Array(this._cache.size);let i=0;for(const n of this._cache.values())r[i++]=n.isVisible,n.isSelected=!1,n.isVisible=!1;for(const n of this._selectedTiles)n.isSelected=!0,n.isVisible=!0;(typeof e=="function"?e:nne[e])(Array.from(this._cache.values())),i=0;for(const n of this._cache.values())if(r[i++]!==n.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,r=[];let i=0;for(const n of this._cache.values())n.isLoading&&(i++,!n.isSelected&&!n.isVisible&&r.push(n));for(;e>0&&i>e&&r.length>0;)r.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const r of e.values())r.parent=null,r.children&&(r.children.length=0);for(const r of e.values()){const i=this._getNearestAncestor(r);r.parent=i,i!=null&&i.children&&i.children.push(r)}}_resizeCache(){var s,f;const{_cache:e,opts:r}=this,i=r.maxCacheSize??(r.maxCacheByteSize!=null?1/0:ine*this.selectedTiles.length),n=r.maxCacheByteSize??1/0;if(e.size>i||this._cacheByteSize>n){for(const[A,v]of e)if(!v.isVisible&&!v.isSelected&&(this._cacheByteSize-=r.maxCacheByteSize!=null?v.byteLength:0,e.delete(A),(f=(s=this.opts).onTileUnload)==null||f.call(s,v)),e.size<=i&&this._cacheByteSize<=n)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((A,v)=>A.zoom-v.zoom),this._dirty=!1)}_getTile(e,r){const i=this.getTileId(e);let n=this._cache.get(i),o=!1;return!n&&r?(n=new ZO(e),Object.assign(n,this.getTileMetadata(n.index)),Object.assign(n,{id:i,zoom:this.getTileZoom(n.index)}),o=!0,this._cache.set(i,n),this._dirty=!0):n&&n.needsReload&&(o=!0),n&&o&&n.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),n}_getNearestAncestor(e){const{_minZoom:r=0}=this;let i=e.index;for(;this.getTileZoom(i)>r;){i=this.getParentIndex(i);const n=this._getTile(i);if(n)return n}return null}}function one(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!eD(e)&&Bx(e);for(const e of t)e.isVisible=!!(e.state&X_)}function ane(t){for(const r of t)r.state=0;for(const r of t)r.isSelected&&eD(r);const e=Array.from(t).sort((r,i)=>r.zoom-i.zoom);for(const r of e)if(r.isVisible=!!(r.state&X_),r.children&&(r.isVisible||r.state&vP))for(const i of r.children)i.state=vP;else r.isSelected&&Bx(r)}function eD(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=X_,!0;e=e.parent}return!1}function Bx(t){for(const e of t.children)e.isLoaded||e.content?e.state|=X_:Bx(e)}const lne={TilesetClass:q_,data:{type:"data",value:[]},dataComparator:Qm.equal,renderSubLayers:{type:"function",value:t=>new kc(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Rx,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class Nc extends rs{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,r;(r=(e=this.state)==null?void 0:e.tileset)==null||r.finalize()}get isLoaded(){var e,r,i;return!!((i=(r=(e=this.state)==null?void 0:e.tileset)==null?void 0:r.selectedTiles)!=null&&i.every(n=>n.isLoaded&&n.layers&&n.layers.every(o=>o.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:r}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);r?i&&(r.setOptions(this._getTilesetOptions()),n?r.reloadAll():r.tiles.forEach(o=>{o.layers=null})):(r=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:r})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:r,maxCacheByteSize:i,refinementStrategy:n,extent:o,maxZoom:s,minZoom:f,maxRequests:A,debounceTime:v,zoomOffset:w}=this.props;return{maxCacheSize:r,maxCacheByteSize:i,maxZoom:s,minZoom:f,tileSize:e,refinementStrategy:n,extent:o,maxRequests:A,debounceTime:v,zoomOffset:w,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:r,modelMatrix:i}=this.props,n=e.update(this.context.viewport,{zRange:r,modelMatrix:i}),{isLoaded:o}=e,s=this.state.isLoaded!==o,f=this.state.frameNumber!==n;o&&(s||f)&&this._onViewportLoad(),f&&this.setState({frameNumber:n}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:r}=this.props;r&&r(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,r){this.props.onTileError(e),r.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:r,getTileData:i,fetch:n}=this.props,{signal:o}=e;return e.url=typeof r=="string"||Array.isArray(r)?Uh(r,e):null,i?i(e):n&&e.url?n(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const r=e.sourceLayer,i=r.props.tile,n=e.info;return n.picked&&(n.tile=i),n.sourceTile=i,n.sourceTileSubLayer=r,n}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const r=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)r&&e.layers[0]&&Object.keys(r).some(i=>e.layers[0].props[i]!==r[i])&&(e.layers=e.layers.map(i=>i.clone(r)));else{const i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=S_(i,Boolean).map(n=>n.clone({tile:e,...r}))}return e.layers})}filterSubLayer({layer:e,cullRect:r}){const{tile:i}=e.props;return this.state.tileset.isTileVisible(i,r)}}Nc.defaultProps=lne;Nc.layerName="TileLayer";const cne={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class $_ extends $h{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
in float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:r,trailLength:i,currentTime:n}=this.props;e.uniforms={...e.uniforms,fadeTrail:r,trailLength:i,currentTime:n},super.draw(e)}}$_.layerName="TripsLayer";$_.defaultProps=cne;var lr=function(t){t=t||{};var e=typeof t<"u"?t:{},r={},i;for(i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);var n="";function o(he){return e.locateFile?e.locateFile(he,n):n+he}var s;typeof document<"u"&&document.currentScript&&(n=document.currentScript.src),n.indexOf("blob:")!==0?n=n.substr(0,n.lastIndexOf("/")+1):n="",s=function(Re,ze,ke){var _=new XMLHttpRequest;_.open("GET",Re,!0),_.responseType="arraybuffer",_.onload=function(){if(_.status==200||_.status==0&&_.response){ze(_.response);return}var ht=Ks(Re);if(ht){ze(ht.buffer);return}ke()},_.onerror=ke,_.send(null)};var f=e.print||console.log.bind(console),A=e.printErr||console.warn.bind(console);for(i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);r=null,e.arguments&&e.arguments;var v=0,w=function(he){v=he},C=function(){return v},I=8;function B(he,Re,ze,ke){switch(ze=ze||"i8",ze.charAt(ze.length-1)==="*"&&(ze="i32"),ze){case"i1":Le[he>>0]=Re;break;case"i8":Le[he>>0]=Re;break;case"i16":Xe[he>>1]=Re;break;case"i32":dt[he>>2]=Re;break;case"i64":is=[Re>>>0,(Oi=Re,+dr(Oi)>=1?Oi>0?(xi(+oi(Oi/4294967296),4294967295)|0)>>>0:~~+gn((Oi-+(~~Oi>>>0))/4294967296)>>>0:0)],dt[he>>2]=is[0],dt[he+4>>2]=is[1];break;case"float":Nt[he>>2]=Re;break;case"double":gr[he>>3]=Re;break;default:we("invalid type for setValue: "+ze)}}function F(he,Re,ze){switch(Re=Re||"i8",Re.charAt(Re.length-1)==="*"&&(Re="i32"),Re){case"i1":return Le[he>>0];case"i8":return Le[he>>0];case"i16":return Xe[he>>1];case"i32":return dt[he>>2];case"i64":return dt[he>>2];case"float":return Nt[he>>2];case"double":return gr[he>>3];default:we("invalid type for getValue: "+Re)}return null}var N=!1;function V(he,Re){he||we("Assertion failed: "+Re)}function G(he){var Re=e["_"+he];return V(Re,"Cannot call unknown function "+he+", make sure it is exported"),Re}function Y(he,Re,ze,ke,_){var ne={string:function(It){var Ir=0;if(It!=null&&It!==0){var yr=(It.length<<2)+1;Ir=vi(yr),Fe(It,Ir,yr)}return Ir},array:function(It){var Ir=vi(It.length);return pe(It,Ir),Ir}};function ht(It){return Re==="string"?Pe(It):Re==="boolean"?!!It:It}var qe=G(he),gt=[],nt=0;if(ke)for(var at=0;at<ke.length;at++){var er=ne[ze[at]];er?(nt===0&&(nt=ee()),gt[at]=er(ke[at])):gt[at]=ke[at]}var ct=qe.apply(null,gt);return ct=ht(ct),nt!==0&&$(nt),ct}function Z(he,Re,ze,ke){ze=ze||[];var _=ze.every(function(ht){return ht==="number"}),ne=Re!=="string";return ne&&_&&!ke?G(he):function(){return Y(he,Re,ze,arguments)}}var se=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function ge(he,Re,ze){for(var ke=Re+ze,_=Re;he[_]&&!(_>=ke);)++_;if(_-Re>16&&he.subarray&&se)return se.decode(he.subarray(Re,_));for(var ne="";Re<_;){var ht=he[Re++];if(!(ht&128)){ne+=String.fromCharCode(ht);continue}var qe=he[Re++]&63;if((ht&224)==192){ne+=String.fromCharCode((ht&31)<<6|qe);continue}var gt=he[Re++]&63;if((ht&240)==224?ht=(ht&15)<<12|qe<<6|gt:ht=(ht&7)<<18|qe<<12|gt<<6|he[Re++]&63,ht<65536)ne+=String.fromCharCode(ht);else{var nt=ht-65536;ne+=String.fromCharCode(55296|nt>>10,56320|nt&1023)}}return ne}function Pe(he,Re){return he?ge(Ve,he,Re):""}function Ue(he,Re,ze,ke){if(!(ke>0))return 0;for(var _=ze,ne=ze+ke-1,ht=0;ht<he.length;++ht){var qe=he.charCodeAt(ht);if(qe>=55296&&qe<=57343){var gt=he.charCodeAt(++ht);qe=65536+((qe&1023)<<10)|gt&1023}if(qe<=127){if(ze>=ne)break;Re[ze++]=qe}else if(qe<=2047){if(ze+1>=ne)break;Re[ze++]=192|qe>>6,Re[ze++]=128|qe&63}else if(qe<=65535){if(ze+2>=ne)break;Re[ze++]=224|qe>>12,Re[ze++]=128|qe>>6&63,Re[ze++]=128|qe&63}else{if(ze+3>=ne)break;Re[ze++]=240|qe>>18,Re[ze++]=128|qe>>12&63,Re[ze++]=128|qe>>6&63,Re[ze++]=128|qe&63}}return Re[ze]=0,ze-_}function Fe(he,Re,ze){return Ue(he,Ve,Re,ze)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function pe(he,Re){Le.set(he,Re)}function Te(he,Re){return he%Re>0&&(he+=Re-he%Re),he}var Ae,Le,Ve,Xe,dt,Nt,gr;function mr(he){Ae=he,e.HEAP8=Le=new Int8Array(he),e.HEAP16=Xe=new Int16Array(he),e.HEAP32=dt=new Int32Array(he),e.HEAPU8=Ve=new Uint8Array(he),e.HEAPU16=new Uint16Array(he),e.HEAPU32=new Uint32Array(he),e.HEAPF32=Nt=new Float32Array(he),e.HEAPF64=gr=new Float64Array(he)}var _r=5267040,rr=24128,Ot=e.TOTAL_MEMORY||33554432;e.buffer?Ae=e.buffer:Ae=new ArrayBuffer(Ot),Ot=Ae.byteLength,mr(Ae),dt[rr>>2]=_r;function Qt(he){for(;he.length>0;){var Re=he.shift();if(typeof Re=="function"){Re();continue}var ze=Re.func;typeof ze=="number"?Re.arg===void 0?e.dynCall_v(ze):e.dynCall_vi(ze,Re.arg):ze(Re.arg===void 0?null:Re.arg)}}var qt=[],Rt=[],ut=[],Vi=[];function Sr(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Pi(e.preRun.shift());Qt(qt)}function Ur(){Qt(Rt)}function Dt(){Qt(ut)}function $r(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)yi(e.postRun.shift());Qt(Vi)}function Pi(he){qt.unshift(he)}function yi(he){Vi.unshift(he)}var dr=Math.abs,gn=Math.ceil,oi=Math.floor,xi=Math.min,an=0,$i=null;function Zs(he){an++,e.monitorRunDependencies&&e.monitorRunDependencies(an)}function ln(he){if(an--,e.monitorRunDependencies&&e.monitorRunDependencies(an),an==0&&$i){var Re=$i;$i=null,Re()}}e.preloadedImages={},e.preloadedAudios={};var ni=null,Is="data:application/octet-stream;base64,";function nn(he){return String.prototype.startsWith?he.startsWith(Is):he.indexOf(Is)===0}var Oi,is;ni="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var vt=24144;function Yt(he){return he}function Mr(he){var Re=/\b__Z[\w\d_]+/g;return he.replace(Re,function(ze){var ke=ze;return ze===ke?ze:ke+" ["+ze+"]"})}function qr(){var he=new Error;if(!he.stack){try{throw new Error(0)}catch(Re){he=Re}if(!he.stack)return"(no stack trace available)"}return he.stack.toString()}function kn(){var he=qr();return e.extraStackTrace&&(he+=`
`+e.extraStackTrace()),Mr(he)}function Di(he,Re,ze,ke){we("Assertion failed: "+Pe(he)+", at: "+[Re?Pe(Re):"unknown filename",ze,ke?Pe(ke):"unknown function"])}function mn(){return Le.length}function Xn(he,Re,ze){Ve.set(Ve.subarray(Re,Re+ze),he)}function ho(he){return e.___errno_location&&(dt[e.___errno_location()>>2]=he),he}function Ro(he){we("OOM")}function ea(he){try{var Re=new ArrayBuffer(he);return Re.byteLength!=he?void 0:(new Int8Array(Re).set(Le),Ma(Re),mr(Re),1)}catch{}}function Ia(he){var Re=mn(),ze=16777216,ke=2147483648-ze;if(he>ke)return!1;for(var _=16777216,ne=Math.max(Re,_);ne<he;)ne<=536870912?ne=Te(2*ne,ze):ne=Math.min(Te((3*ne+2147483648)/4,ze),ke);var ht=ea(ne);return!!ht}var Bo=typeof atob=="function"?atob:function(he){var Re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ze="",ke,_,ne,ht,qe,gt,nt,at=0;he=he.replace(/[^A-Za-z0-9\+\/\=]/g,"");do ht=Re.indexOf(he.charAt(at++)),qe=Re.indexOf(he.charAt(at++)),gt=Re.indexOf(he.charAt(at++)),nt=Re.indexOf(he.charAt(at++)),ke=ht<<2|qe>>4,_=(qe&15)<<4|gt>>2,ne=(gt&3)<<6|nt,ze=ze+String.fromCharCode(ke),gt!==64&&(ze=ze+String.fromCharCode(_)),nt!==64&&(ze=ze+String.fromCharCode(ne));while(at<he.length);return ze};function al(he){try{for(var Re=Bo(he),ze=new Uint8Array(Re.length),ke=0;ke<Re.length;++ke)ze[ke]=Re.charCodeAt(ke);return ze}catch{throw new Error("Converting base64 string to bytes failed.")}}function Ks(he){if(nn(he))return al(he.slice(Is.length))}var Ms={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Rs={a:we,b:w,c:C,d:Di,e:ho,f:mn,g:Xn,h:Ia,i:Ro,j:Yt,k:Mr,l:ea,m:qr,n:kn,o:vt,p:rr},yt=function(he,Re,ze){"almost asm";var ke=new he.Int8Array(ze),_=new he.Int32Array(ze);new he.Uint8Array(ze),new he.Float32Array(ze);var ne=new he.Float64Array(ze),ht=Re.o|0,qe=Re.p|0,gt=he.Math.floor,nt=he.Math.abs,at=he.Math.sqrt,er=he.Math.pow,ct=he.Math.cos,It=he.Math.sin,Ir=he.Math.tan,yr=he.Math.acos,Lr=he.Math.asin,ur=he.Math.atan,Yr=he.Math.atan2,xr=he.Math.ceil,Fr=he.Math.imul,zr=he.Math.min,Ar=he.Math.max,pr=he.Math.clz32,ir=Re.b,me=Re.c,zt=Re.d,hi=Re.e,ta=Re.f,Oo=Re.g,di=Re.h,Do=Re.i,ue=24160;function Ii(m){return ke=new Int8Array(m),_=new Int32Array(m),ne=new Float64Array(m),ze=m,!0}function Zi(m){m=m|0;var g=0;return g=ue,ue=ue+m|0,ue=ue+15&-16,g|0}function ai(){return ue|0}function ns(m){m=m|0,ue=m}function Rn(m,g){m=m|0,ue=m}function Zl(m,g){m=m|0,g=g|0;var b=0,l=0,u=0;return(m|0)<0?(g=2,g|0):(m|0)>13780509?(g=Kn(15,g)|0,g|0):(b=((m|0)<0)<<31>>31,u=un(m|0,b|0,3,0)|0,l=me()|0,b=Cr(m|0,b|0,1,0)|0,b=un(u|0,l|0,b|0,me()|0)|0,b=Cr(b|0,me()|0,1,0)|0,m=me()|0,_[g>>2]=b,_[g+4>>2]=m,g=0,g|0)}function qn(m,g,b,l){return m=m|0,g=g|0,b=b|0,l=l|0,Uc(m,g,b,l,0)|0}function Uc(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0;if(T=ue,ue=ue+16|0,d=T,!(le(m,g,b,l,u)|0))return l=0,ue=T,l|0;do if((b|0)>=0){if((b|0)>13780509){if(c=Kn(15,d)|0,c|0)break;y=d,d=_[y>>2]|0,y=_[y+4>>2]|0}else c=((b|0)<0)<<31>>31,S=un(b|0,c|0,3,0)|0,y=me()|0,c=Cr(b|0,c|0,1,0)|0,c=un(S|0,y|0,c|0,me()|0)|0,c=Cr(c|0,me()|0,1,0)|0,y=me()|0,_[d>>2]=c,_[d+4>>2]=y,d=c;if(hs(l|0,0,d<<3|0)|0,u|0){hs(u|0,0,d<<2|0)|0,c=de(m,g,b,l,u,d,y,0)|0;break}c=io(d,4)|0,c?(S=de(m,g,b,l,c,d,y,0)|0,$t(c),c=S):c=13}else c=2;while(!1);return S=c,ue=T,S|0}function le(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0;if(W=ue,ue=ue+16|0,j=W,z=W+8|0,L=j,_[L>>2]=m,_[L+4>>2]=g,(b|0)<0)return z=2,ue=W,z|0;if(c=l,_[c>>2]=m,_[c+4>>2]=g,c=(u|0)!=0,c&&(_[u>>2]=0),ti(m,g)|0)return z=9,ue=W,z|0;_[z>>2]=0;e:do if((b|0)>=1)if(c)for(M=1,S=0,D=0,L=1,c=m;;){if(!(S|D)){if(c=Ce(c,g,4,z,j)|0,c|0)break e;if(g=j,c=_[g>>2]|0,g=_[g+4>>2]|0,ti(c,g)|0){c=9;break e}}if(c=Ce(c,g,_[22384+(D<<2)>>2]|0,z,j)|0,c|0)break e;if(g=j,c=_[g>>2]|0,g=_[g+4>>2]|0,m=l+(M<<3)|0,_[m>>2]=c,_[m+4>>2]=g,_[u+(M<<2)>>2]=L,m=S+1|0,d=(m|0)==(L|0),y=D+1|0,T=(y|0)==6,ti(c,g)|0){c=9;break e}if(L=L+(T&d&1)|0,(L|0)>(b|0)){c=0;break}else M=M+1|0,S=d?0:m,D=d?T?0:y:D}else for(M=1,S=0,D=0,L=1,c=m;;){if(!(S|D)){if(c=Ce(c,g,4,z,j)|0,c|0)break e;if(g=j,c=_[g>>2]|0,g=_[g+4>>2]|0,ti(c,g)|0){c=9;break e}}if(c=Ce(c,g,_[22384+(D<<2)>>2]|0,z,j)|0,c|0)break e;if(g=j,c=_[g>>2]|0,g=_[g+4>>2]|0,m=l+(M<<3)|0,_[m>>2]=c,_[m+4>>2]=g,m=S+1|0,d=(m|0)==(L|0),y=D+1|0,T=(y|0)==6,ti(c,g)|0){c=9;break e}if(L=L+(T&d&1)|0,(L|0)>(b|0)){c=0;break}else M=M+1|0,S=d?0:m,D=d?T?0:y:D}else c=0;while(!1);return z=c,ue=W,z|0}function de(m,g,b,l,u,c,d,y){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0,c=c|0,d=d|0,y=y|0;var T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0;if(W=ue,ue=ue+16|0,j=W+8|0,z=W,T=_o(m|0,g|0,c|0,d|0)|0,M=me()|0,D=l+(T<<3)|0,te=D,Q=_[te>>2]|0,te=_[te+4>>2]|0,S=(Q|0)==(m|0)&(te|0)==(g|0),!((Q|0)==0&(te|0)==0|S))do T=Cr(T|0,M|0,1,0)|0,T=Go(T|0,me()|0,c|0,d|0)|0,M=me()|0,D=l+(T<<3)|0,Q=D,te=_[Q>>2]|0,Q=_[Q+4>>2]|0,S=(te|0)==(m|0)&(Q|0)==(g|0);while(!((te|0)==0&(Q|0)==0|S));if(T=u+(T<<2)|0,S&&(_[T>>2]|0)<=(y|0)||(Q=D,_[Q>>2]=m,_[Q+4>>2]=g,_[T>>2]=y,(y|0)>=(b|0)))return Q=0,ue=W,Q|0;switch(S=y+1|0,_[j>>2]=0,T=Ce(m,g,2,j,z)|0,T|0){case 9:{L=9;break}case 0:{T=z,T=de(_[T>>2]|0,_[T+4>>2]|0,b,l,u,c,d,S)|0,T||(L=9);break}}e:do if((L|0)==9){switch(_[j>>2]=0,T=Ce(m,g,3,j,z)|0,T|0){case 9:break;case 0:{if(T=z,T=de(_[T>>2]|0,_[T+4>>2]|0,b,l,u,c,d,S)|0,T|0)break e;break}default:break e}switch(_[j>>2]=0,T=Ce(m,g,1,j,z)|0,T|0){case 9:break;case 0:{if(T=z,T=de(_[T>>2]|0,_[T+4>>2]|0,b,l,u,c,d,S)|0,T|0)break e;break}default:break e}switch(_[j>>2]=0,T=Ce(m,g,5,j,z)|0,T|0){case 9:break;case 0:{if(T=z,T=de(_[T>>2]|0,_[T+4>>2]|0,b,l,u,c,d,S)|0,T|0)break e;break}default:break e}switch(_[j>>2]=0,T=Ce(m,g,4,j,z)|0,T|0){case 9:break;case 0:{if(T=z,T=de(_[T>>2]|0,_[T+4>>2]|0,b,l,u,c,d,S)|0,T|0)break e;break}default:break e}switch(_[j>>2]=0,T=Ce(m,g,6,j,z)|0,T|0){case 9:break;case 0:{if(T=z,T=de(_[T>>2]|0,_[T+4>>2]|0,b,l,u,c,d,S)|0,T|0)break e;break}default:break e}return Q=0,ue=W,Q|0}while(!1);return Q=T,ue=W,Q|0}function Ce(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0;if(b>>>0>6)return u=1,u|0;if(D=(_[l>>2]|0)%6|0,_[l>>2]=D,(D|0)>0){c=0;do b=ko(b)|0,c=c+1|0;while((c|0)<(_[l>>2]|0))}if(D=_t(m|0,g|0,45)|0,me()|0,M=D&127,M>>>0>121)return u=5,u|0;T=yn(m,g)|0,c=_t(m|0,g|0,52)|0,me()|0,c=c&15;e:do if(!c)S=8;else{for(;;){if(d=(15-c|0)*3|0,y=_t(m|0,g|0,d|0)|0,me()|0,y=y&7,(y|0)==7){g=5;break}if(z=(vs(c)|0)==0,c=c+-1|0,L=St(7,0,d|0)|0,g=g&~(me()|0),j=St(_[(z?432:16)+(y*28|0)+(b<<2)>>2]|0,0,d|0)|0,d=me()|0,b=_[(z?640:224)+(y*28|0)+(b<<2)>>2]|0,m=j|m&~L,g=d|g,!b){b=0;break e}if(!c){S=8;break e}}return g|0}while(!1);(S|0)==8&&(z=_[848+(M*28|0)+(b<<2)>>2]|0,j=St(z|0,0,45)|0,m=j|m,g=me()|0|g&-1040385,b=_[4272+(M*28|0)+(b<<2)>>2]|0,(z&127|0)==127&&(z=St(_[848+(M*28|0)+20>>2]|0,0,45)|0,g=me()|0|g&-1040385,b=_[4272+(M*28|0)+20>>2]|0,m=da(z|m,g)|0,g=me()|0,_[l>>2]=(_[l>>2]|0)+1)),y=_t(m|0,g|0,45)|0,me()|0,y=y&127;e:do if(Wr(y)|0){t:do if((yn(m,g)|0)==1){if((M|0)!=(y|0))if(Xu(y,_[7696+(M*28|0)>>2]|0)|0){m=ys(m,g)|0,d=1,g=me()|0;break}else zt(23313,22416,436,22424);switch(T|0){case 3:{m=da(m,g)|0,g=me()|0,_[l>>2]=(_[l>>2]|0)+1,d=0;break t}case 5:{m=ys(m,g)|0,g=me()|0,_[l>>2]=(_[l>>2]|0)+5,d=0;break t}case 0:return z=9,z|0;default:return z=1,z|0}}else d=0;while(!1);if((b|0)>0){c=0;do m=fa(m,g)|0,g=me()|0,c=c+1|0;while((c|0)!=(b|0))}if((M|0)!=(y|0)){if(!(zc(y)|0)){if((d|0)!=0|(yn(m,g)|0)!=5)break;_[l>>2]=(_[l>>2]|0)+1;break}switch(D&127){case 8:case 118:break e}(yn(m,g)|0)!=3&&(_[l>>2]=(_[l>>2]|0)+1)}}else if((b|0)>0){c=0;do m=da(m,g)|0,g=me()|0,c=c+1|0;while((c|0)!=(b|0))}while(!1);return _[l>>2]=((_[l>>2]|0)+b|0)%6|0,z=u,_[z>>2]=m,_[z+4>>2]=g,z=0,z|0}function Ze(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0;for(y=ue,ue=ue+16|0,c=y,d=y+8|0,u=(ti(m,g)|0)==0,u=u?1:2;;){if(_[d>>2]=0,S=(Ce(m,g,u,d,c)|0)==0,T=c,S&((_[T>>2]|0)==(b|0)?(_[T+4>>2]|0)==(l|0):0)){m=4;break}if(u=u+1|0,u>>>0>=7){u=7,m=4;break}}return(m|0)==4?(ue=y,u|0):0}function mt(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0;if(z=ue,ue=ue+16|0,L=z,j=z+8|0,D=L,_[D>>2]=m,_[D+4>>2]=g,!b)return j=l,_[j>>2]=m,_[j+4>>2]=g,j=0,ue=z,j|0;_[j>>2]=0;e:do if(ti(m,g)|0)m=9;else{if(c=(b|0)>0,c){u=0,D=m;do{if(m=Ce(D,g,4,j,L)|0,m|0)break e;if(g=L,D=_[g>>2]|0,g=_[g+4>>2]|0,u=u+1|0,ti(D,g)|0){m=9;break e}}while((u|0)<(b|0));if(M=l,_[M>>2]=D,_[M+4>>2]=g,M=b+-1|0,c){S=0,m=1;do{if(u=22384+(S<<2)|0,(S|0)==5)for(d=_[u>>2]|0,c=0,u=m;;){if(m=L,m=Ce(_[m>>2]|0,_[m+4>>2]|0,d,j,L)|0,m|0)break e;if((c|0)!=(M|0))if(T=L,y=_[T>>2]|0,T=_[T+4>>2]|0,m=l+(u<<3)|0,_[m>>2]=y,_[m+4>>2]=T,!(ti(y,T)|0))m=u+1|0;else{m=9;break e}else m=u;if(c=c+1|0,(c|0)>=(b|0))break;u=m}else for(d=L,T=_[u>>2]|0,y=0,u=m,c=_[d>>2]|0,d=_[d+4>>2]|0;;){if(m=Ce(c,d,T,j,L)|0,m|0)break e;if(d=L,c=_[d>>2]|0,d=_[d+4>>2]|0,m=l+(u<<3)|0,_[m>>2]=c,_[m+4>>2]=d,m=u+1|0,ti(c,d)|0){m=9;break e}if(y=y+1|0,(y|0)>=(b|0))break;u=m}S=S+1|0}while(S>>>0<6);m=L,d=D,u=_[m>>2]|0,c=g,m=_[m+4>>2]|0}else d=D,u=D,c=g,m=g}else d=l,_[d>>2]=m,_[d+4>>2]=g,d=m,u=m,c=g,m=g;m=(d|0)==(u|0)&(c|0)==(m|0)?0:9}while(!1);return j=m,ue=z,j|0}function Vt(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0;if(y=ue,ue=ue+48|0,u=y+16|0,c=y+8|0,d=y,b|0)return d=15,ue=y,d|0;if(S=m,T=_[S+4>>2]|0,b=c,_[b>>2]=_[S>>2],_[b+4>>2]=T,sc(c,u),g=Lo(u,g,d)|0,!g){if(b=_[c>>2]|0,c=_[m+8>>2]|0,(c|0)>0){u=_[m+12>>2]|0,g=0;do b=(_[u+(g<<3)>>2]|0)+b|0,g=g+1|0;while((g|0)<(c|0))}g=d,u=_[g>>2]|0,g=_[g+4>>2]|0,c=((b|0)<0)<<31>>31,(g|0)<(c|0)|(g|0)==(c|0)&u>>>0<b>>>0?(g=d,_[g>>2]=b,_[g+4>>2]=c,g=c):b=u,T=Cr(b|0,g|0,12,0)|0,S=me()|0,g=d,_[g>>2]=T,_[g+4>>2]=S,g=l,_[g>>2]=T,_[g+4>>2]=S,g=0}return S=g,ue=y,S|0}function Vr(m,g,b,l,u,c,d){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0,c=c|0,d=d|0;var y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0,J=0,_e=0,Ee=0,Ie=0,Me=0,Ge=0,Qe=0,st=0,rt=0,lt=0,At=0,Tt=0,ft=0,Zt=0,xt=0,or=0;if(Tt=ue,ue=ue+64|0,st=Tt+48|0,rt=Tt+32|0,lt=Tt+24|0,_e=Tt+8|0,Ee=Tt,T=_[m>>2]|0,(T|0)<=0)return At=0,ue=Tt,At|0;for(Ie=m+4|0,Me=st+8|0,Ge=rt+8|0,Qe=_e+8|0,y=0,K=0;;){S=_[Ie>>2]|0,ie=S+(K<<4)|0,_[st>>2]=_[ie>>2],_[st+4>>2]=_[ie+4>>2],_[st+8>>2]=_[ie+8>>2],_[st+12>>2]=_[ie+12>>2],(K|0)==(T+-1|0)?(_[rt>>2]=_[S>>2],_[rt+4>>2]=_[S+4>>2],_[rt+8>>2]=_[S+8>>2],_[rt+12>>2]=_[S+12>>2]):(ie=S+(K+1<<4)|0,_[rt>>2]=_[ie>>2],_[rt+4>>2]=_[ie+4>>2],_[rt+8>>2]=_[ie+8>>2],_[rt+12>>2]=_[ie+12>>2]),T=Vc(st,rt,l,lt)|0;e:do if(T)S=0,y=T;else if(S=lt,T=_[S>>2]|0,S=_[S+4>>2]|0,(S|0)>0|(S|0)==0&T>>>0>0){Q=0,ie=0;t:for(;;){if(or=+ne[st>>3],te=xn(T|0,S|0,Q|0,ie|0)|0,xt=+(te>>>0)+4294967296*+(me()|0),ft=+(T>>>0)+4294967296*+(S|0),Zt=+(Q>>>0)+4294967296*+(ie|0),ne[_e>>3]=or*xt/ft+ +ne[rt>>3]*Zt/ft,ne[Qe>>3]=+ne[Me>>3]*xt/ft+ +ne[Ge>>3]*Zt/ft,T=Ju(_e,l,Ee)|0,T|0){y=T;break}te=Ee,W=_[te>>2]|0,te=_[te+4>>2]|0,L=_o(W|0,te|0,g|0,b|0)|0,M=me()|0,T=d+(L<<3)|0,D=T,S=_[D>>2]|0,D=_[D+4>>2]|0;r:do if((S|0)==0&(D|0)==0)J=T,At=16;else for(j=0,z=0;;){if((j|0)>(b|0)|(j|0)==(b|0)&z>>>0>g>>>0){y=1;break t}if((S|0)==(W|0)&(D|0)==(te|0))break r;if(T=Cr(L|0,M|0,1,0)|0,L=Go(T|0,me()|0,g|0,b|0)|0,M=me()|0,z=Cr(z|0,j|0,1,0)|0,j=me()|0,T=d+(L<<3)|0,D=T,S=_[D>>2]|0,D=_[D+4>>2]|0,(S|0)==0&(D|0)==0){J=T,At=16;break}}while(!1);if((At|0)==16&&(At=0,!((W|0)==0&(te|0)==0))&&(z=J,_[z>>2]=W,_[z+4>>2]=te,z=c+(_[u>>2]<<3)|0,_[z>>2]=W,_[z+4>>2]=te,z=u,z=Cr(_[z>>2]|0,_[z+4>>2]|0,1,0)|0,W=me()|0,te=u,_[te>>2]=z,_[te+4>>2]=W),Q=Cr(Q|0,ie|0,1,0)|0,ie=me()|0,S=lt,T=_[S>>2]|0,S=_[S+4>>2]|0,!((S|0)>(ie|0)|(S|0)==(ie|0)&T>>>0>Q>>>0)){S=1;break e}}S=0}else S=1;while(!1);if(K=K+1|0,!S){At=21;break}if(T=_[m>>2]|0,(K|0)>=(T|0)){y=0,At=21;break}}return(At|0)==21?(ue=Tt,y|0):0}function ji(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0,J=0,_e=0,Ee=0,Ie=0,Me=0,Ge=0,Qe=0,st=0,rt=0,lt=0,At=0,Tt=0,ft=0,Zt=0,xt=0;if(xt=ue,ue=ue+112|0,At=xt+80|0,T=xt+72|0,Tt=xt,ft=xt+56|0,b|0)return Zt=15,ue=xt,Zt|0;if(S=m+8|0,Zt=Rr((_[S>>2]<<5)+32|0)|0,!Zt)return Zt=13,ue=xt,Zt|0;if(eh(m,Zt),rt=m,lt=_[rt+4>>2]|0,b=T,_[b>>2]=_[rt>>2],_[b+4>>2]=lt,sc(T,At),b=Lo(At,g,Tt)|0,b)rt=0,lt=0;else{if(b=_[T>>2]|0,c=_[S>>2]|0,(c|0)>0){d=_[m+12>>2]|0,u=0;do b=(_[d+(u<<3)>>2]|0)+b|0,u=u+1|0;while((u|0)!=(c|0));u=b}else u=b;b=Tt,c=_[b>>2]|0,b=_[b+4>>2]|0,d=((u|0)<0)<<31>>31,(b|0)<(d|0)|(b|0)==(d|0)&c>>>0<u>>>0?(b=Tt,_[b>>2]=u,_[b+4>>2]=d,b=d):u=c,rt=Cr(u|0,b|0,12,0)|0,lt=me()|0,b=Tt,_[b>>2]=rt,_[b+4>>2]=lt,b=0}if(b|0)return $t(Zt),Zt=b,ue=xt,Zt|0;if(u=io(rt,8)|0,!u)return $t(Zt),Zt=13,ue=xt,Zt|0;if(y=io(rt,8)|0,!y)return $t(Zt),$t(u),Zt=13,ue=xt,Zt|0;Qe=At,_[Qe>>2]=0,_[Qe+4>>2]=0,Qe=m,st=_[Qe+4>>2]|0,b=T,_[b>>2]=_[Qe>>2],_[b+4>>2]=st,b=Vr(T,rt,lt,g,At,u,y)|0;e:do if(b)$t(u),$t(y),$t(Zt);else{t:do if((_[S>>2]|0)>0){for(d=m+12|0,c=0;b=Vr((_[d>>2]|0)+(c<<3)|0,rt,lt,g,At,u,y)|0,c=c+1|0,!(b|0);)if((c|0)>=(_[S>>2]|0))break t;$t(u),$t(y),$t(Zt);break e}while(!1);(lt|0)>0|(lt|0)==0&rt>>>0>0&&hs(y|0,0,rt<<3|0)|0,st=At,Qe=_[st+4>>2]|0;t:do if((Qe|0)>0|(Qe|0)==0&(_[st>>2]|0)>>>0>0){Ie=u,Me=y,Ge=u,Qe=y,st=u,b=u,J=u,_e=y,Ee=y,u=y;r:for(;;){for(te=0,Q=0,ie=0,K=0,c=0,d=0;;){y=Tt,T=y+56|0;do _[y>>2]=0,y=y+4|0;while((y|0)<(T|0));if(g=Ie+(te<<3)|0,S=_[g>>2]|0,g=_[g+4>>2]|0,le(S,g,1,Tt,0)|0){y=Tt,T=y+56|0;do _[y>>2]=0,y=y+4|0;while((y|0)<(T|0));y=io(7,4)|0,y|0&&(de(S,g,1,Tt,y,7,0,0)|0,$t(y))}for(W=0;;){z=Tt+(W<<3)|0,j=_[z>>2]|0,z=_[z+4>>2]|0;i:do if((j|0)==0&(z|0)==0)y=c,T=d;else{if(M=_o(j|0,z|0,rt|0,lt|0)|0,S=me()|0,y=l+(M<<3)|0,g=y,T=_[g>>2]|0,g=_[g+4>>2]|0,!((T|0)==0&(g|0)==0)){D=0,L=0;do{if((D|0)>(lt|0)|(D|0)==(lt|0)&L>>>0>rt>>>0)break r;if((T|0)==(j|0)&(g|0)==(z|0)){y=c,T=d;break i}y=Cr(M|0,S|0,1,0)|0,M=Go(y|0,me()|0,rt|0,lt|0)|0,S=me()|0,L=Cr(L|0,D|0,1,0)|0,D=me()|0,y=l+(M<<3)|0,g=y,T=_[g>>2]|0,g=_[g+4>>2]|0}while(!((T|0)==0&(g|0)==0))}(j|0)==0&(z|0)==0?(y=c,T=d):(Aa(j,z,ft)|0,Os(m,Zt,ft)|0&&(L=Cr(c|0,d|0,1,0)|0,d=me()|0,D=y,_[D>>2]=j,_[D+4>>2]=z,c=Me+(c<<3)|0,_[c>>2]=j,_[c+4>>2]=z,c=L),y=c,T=d)}while(!1);if(W=W+1|0,W>>>0>=7)break;c=y,d=T}if(te=Cr(te|0,Q|0,1,0)|0,Q=me()|0,ie=Cr(ie|0,K|0,1,0)|0,K=me()|0,d=At,c=_[d>>2]|0,d=_[d+4>>2]|0,(K|0)<(d|0)|(K|0)==(d|0)&ie>>>0<c>>>0)c=y,d=T;else break}if((d|0)>0|(d|0)==0&c>>>0>0){c=0,d=0;do K=Ie+(c<<3)|0,_[K>>2]=0,_[K+4>>2]=0,c=Cr(c|0,d|0,1,0)|0,d=me()|0,K=At,ie=_[K+4>>2]|0;while((d|0)<(ie|0)|((d|0)==(ie|0)?c>>>0<(_[K>>2]|0)>>>0:0))}if(K=At,_[K>>2]=y,_[K+4>>2]=T,(T|0)>0|(T|0)==0&y>>>0>0)W=u,te=Ee,Q=st,ie=_e,K=Me,u=J,Ee=b,_e=Ge,J=W,b=te,st=Qe,Qe=Q,Ge=ie,Me=Ie,Ie=K;else break t}$t(Ge),$t(Qe),$t(Zt),b=1;break e}else b=y;while(!1);$t(Zt),$t(u),$t(b),b=0}while(!1);return Zt=b,ue=xt,Zt|0}function cn(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0;if(M=ue,ue=ue+176|0,T=M,(g|0)<1)return vl(b,0,0),S=0,ue=M,S|0;for(y=m,y=_t(_[y>>2]|0,_[y+4>>2]|0,52)|0,me()|0,vl(b,(g|0)>6?g:6,y&15),y=0;l=m+(y<<3)|0,l=Oa(_[l>>2]|0,_[l+4>>2]|0,T)|0,!(l|0);){if(l=_[T>>2]|0,(l|0)>0){d=0;do c=T+8+(d<<4)|0,d=d+1|0,l=T+8+(((d|0)%(l|0)|0)<<4)|0,u=to(b,l,c)|0,u?ac(b,u)|0:Un(b,c,l)|0,l=_[T>>2]|0;while((d|0)<(l|0))}if(y=y+1|0,(y|0)>=(g|0)){l=0,S=13;break}}return(S|0)==13?(ue=M,l|0):(jt(b),S=l,ue=M,S|0)}function _n(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0;if(c=ue,ue=ue+32|0,l=c,u=c+16|0,m=cn(m,g,u)|0,m|0)return b=m,ue=c,b|0;if(_[b>>2]=0,_[b+4>>2]=0,_[b+8>>2]=0,m=Lt(u)|0,m|0)do{g=jo(b)|0;do Ji(g,m)|0,d=m+16|0,_[l>>2]=_[d>>2],_[l+4>>2]=_[d+4>>2],_[l+8>>2]=_[d+8>>2],_[l+12>>2]=_[d+12>>2],ac(u,m)|0,m=bn(u,l)|0;while(m|0);m=Lt(u)|0}while(m|0);return jt(u),m=pf(b)|0,m?(_l(b),d=m,ue=c,d|0):(d=0,ue=c,d|0)}function Wr(m){return m=m|0,m>>>0>121?(m=0,m|0):(m=_[7696+(m*28|0)+16>>2]|0,m|0)}function zc(m){return m=m|0,(m|0)==4|(m|0)==117|0}function Gu(m){return m=m|0,_[11120+((_[m>>2]|0)*216|0)+((_[m+4>>2]|0)*72|0)+((_[m+8>>2]|0)*24|0)+(_[m+12>>2]<<3)>>2]|0}function ll(m){return m=m|0,_[11120+((_[m>>2]|0)*216|0)+((_[m+4>>2]|0)*72|0)+((_[m+8>>2]|0)*24|0)+(_[m+12>>2]<<3)+4>>2]|0}function Wu(m,g){m=m|0,g=g|0,m=7696+(m*28|0)|0,_[g>>2]=_[m>>2],_[g+4>>2]=_[m+4>>2],_[g+8>>2]=_[m+8>>2],_[g+12>>2]=_[m+12>>2]}function Kl(m,g){m=m|0,g=g|0;var b=0,l=0;if(g>>>0>20)return g=-1,g|0;do if((_[11120+(g*216|0)>>2]|0)!=(m|0))if((_[11120+(g*216|0)+8>>2]|0)!=(m|0))if((_[11120+(g*216|0)+16>>2]|0)!=(m|0))if((_[11120+(g*216|0)+24>>2]|0)!=(m|0))if((_[11120+(g*216|0)+32>>2]|0)!=(m|0))if((_[11120+(g*216|0)+40>>2]|0)!=(m|0))if((_[11120+(g*216|0)+48>>2]|0)!=(m|0))if((_[11120+(g*216|0)+56>>2]|0)!=(m|0))if((_[11120+(g*216|0)+64>>2]|0)!=(m|0))if((_[11120+(g*216|0)+72>>2]|0)!=(m|0))if((_[11120+(g*216|0)+80>>2]|0)!=(m|0))if((_[11120+(g*216|0)+88>>2]|0)!=(m|0))if((_[11120+(g*216|0)+96>>2]|0)!=(m|0))if((_[11120+(g*216|0)+104>>2]|0)!=(m|0))if((_[11120+(g*216|0)+112>>2]|0)!=(m|0))if((_[11120+(g*216|0)+120>>2]|0)!=(m|0))if((_[11120+(g*216|0)+128>>2]|0)!=(m|0))if((_[11120+(g*216|0)+136>>2]|0)==(m|0))m=2,b=1,l=2;else{if((_[11120+(g*216|0)+144>>2]|0)==(m|0)){m=0,b=2,l=0;break}if((_[11120+(g*216|0)+152>>2]|0)==(m|0)){m=0,b=2,l=1;break}if((_[11120+(g*216|0)+160>>2]|0)==(m|0)){m=0,b=2,l=2;break}if((_[11120+(g*216|0)+168>>2]|0)==(m|0)){m=1,b=2,l=0;break}if((_[11120+(g*216|0)+176>>2]|0)==(m|0)){m=1,b=2,l=1;break}if((_[11120+(g*216|0)+184>>2]|0)==(m|0)){m=1,b=2,l=2;break}if((_[11120+(g*216|0)+192>>2]|0)==(m|0)){m=2,b=2,l=0;break}if((_[11120+(g*216|0)+200>>2]|0)==(m|0)){m=2,b=2,l=1;break}if((_[11120+(g*216|0)+208>>2]|0)==(m|0)){m=2,b=2,l=2;break}else m=-1;return m|0}else m=2,b=1,l=1;else m=2,b=1,l=0;else m=1,b=1,l=2;else m=1,b=1,l=1;else m=1,b=1,l=0;else m=0,b=1,l=2;else m=0,b=1,l=1;else m=0,b=1,l=0;else m=2,b=0,l=2;else m=2,b=0,l=1;else m=2,b=0,l=0;else m=1,b=0,l=2;else m=1,b=0,l=1;else m=1,b=0,l=0;else m=0,b=0,l=2;else m=0,b=0,l=1;else m=0,b=0,l=0;while(!1);return g=_[11120+(g*216|0)+(b*72|0)+(m*24|0)+(l<<3)+4>>2]|0,g|0}function Xu(m,g){return m=m|0,g=g|0,(_[7696+(m*28|0)+20>>2]|0)==(g|0)?(g=1,g|0):(g=(_[7696+(m*28|0)+24>>2]|0)==(g|0),g|0)}function cl(m,g){return m=m|0,g=g|0,_[848+(m*28|0)+(g<<2)>>2]|0}function ss(m,g){return m=m|0,g=g|0,(_[848+(m*28|0)>>2]|0)==(g|0)?(g=0,g|0):(_[848+(m*28|0)+4>>2]|0)==(g|0)?(g=1,g|0):(_[848+(m*28|0)+8>>2]|0)==(g|0)?(g=2,g|0):(_[848+(m*28|0)+12>>2]|0)==(g|0)?(g=3,g|0):(_[848+(m*28|0)+16>>2]|0)==(g|0)?(g=4,g|0):(_[848+(m*28|0)+20>>2]|0)==(g|0)?(g=5,g|0):((_[848+(m*28|0)+24>>2]|0)==(g|0)?6:7)|0}function ra(){return 122}function ia(m){m=m|0;var g=0,b=0,l=0;g=0;do St(g|0,0,45)|0,l=me()|0|134225919,b=m+(g<<3)|0,_[b>>2]=-1,_[b+4>>2]=l,g=g+1|0;while((g|0)!=122);return 0}function na(m){return m=m|0,+ne[m+16>>3]<+ne[m+24>>3]|0}function Fo(m,g){m=m|0,g=g|0;var b=0,l=0,u=0;return b=+ne[g>>3],!(b>=+ne[m+8>>3])||!(b<=+ne[m>>3])?(g=0,g|0):(l=+ne[m+16>>3],b=+ne[m+24>>3],u=+ne[g+8>>3],g=u>=b,m=u<=l&1,l<b?g&&(m=1):g||(m=0),g=(m|0)!=0,g|0)}function Lo(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0;z=ue,ue=ue+288|0,M=z+264|0,D=z+96|0,S=z,y=S,T=y+96|0;do _[y>>2]=0,y=y+4|0;while((y|0)<(T|0));return g=Ql(g,S)|0,g|0?(j=g,ue=z,j|0):(T=S,S=_[T>>2]|0,T=_[T+4>>2]|0,Aa(S,T,M)|0,Oa(S,T,D)|0,d=+gl(M,D+8|0),ne[M>>3]=+ne[m>>3],T=M+8|0,ne[T>>3]=+ne[m+16>>3],ne[D>>3]=+ne[m+8>>3],S=D+8|0,ne[S>>3]=+ne[m+24>>3],u=+gl(M,D),te=+ne[T>>3]-+ne[S>>3],c=+nt(+te),W=+ne[M>>3]-+ne[D>>3],l=+nt(+W),!(te==0|W==0)&&(te=+su(+c,+l),te=+xr(+(u*u/+yo(+(te/+yo(+c,+l)),3)/(d*(d*2.59807621135)*.8))),ne[ht>>3]=te,L=~~te>>>0,j=+nt(te)>=1?te>0?~~+zr(+gt(te/4294967296),4294967295)>>>0:~~+xr((te-+(~~te>>>0))/4294967296)>>>0:0,(_[ht+4>>2]&2146435072|0)!=2146435072)?(D=(L|0)==0&(j|0)==0,g=b,_[g>>2]=D?1:L,_[g+4>>2]=D?0:j,g=0):g=1,j=g,ue=z,j|0)}function Vc(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0,M=0;S=ue,ue=ue+288|0,d=S+264|0,y=S+96|0,T=S,u=T,c=u+96|0;do _[u>>2]=0,u=u+4|0;while((u|0)<(c|0));return b=Ql(b,T)|0,b|0?(l=b,ue=S,l|0):(b=T,u=_[b>>2]|0,b=_[b+4>>2]|0,Aa(u,b,d)|0,Oa(u,b,y)|0,M=+gl(d,y+8|0),M=+xr(+(+gl(m,g)/(M*2))),ne[ht>>3]=M,b=~~M>>>0,u=+nt(M)>=1?M>0?~~+zr(+gt(M/4294967296),4294967295)>>>0:~~+xr((M-+(~~M>>>0))/4294967296)>>>0:0,(_[ht+4>>2]&2146435072|0)==2146435072?(l=1,ue=S,l|0):(T=(b|0)==0&(u|0)==0,_[l>>2]=T?1:b,_[l+4>>2]=T?0:u,l=0,ue=S,l|0))}function os(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0,_[m>>2]=g,_[m+4>>2]=b,_[m+8>>2]=l}function Hi(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0;D=g+8|0,_[D>>2]=0,T=+ne[m>>3],d=+nt(+T),S=+ne[m+8>>3],y=+nt(+S)/.8660254037844386,d=d+y*.5,b=~~d,m=~~y,d=d-+(b|0),y=y-+(m|0);do if(d<.5)if(d<.3333333333333333)if(_[g>>2]=b,y<(d+1)*.5){_[g+4>>2]=m;break}else{m=m+1|0,_[g+4>>2]=m;break}else if(L=1-d,m=(!(y<L)&1)+m|0,_[g+4>>2]=m,L<=y&y<d*2){b=b+1|0,_[g>>2]=b;break}else{_[g>>2]=b;break}else{if(!(d<.6666666666666666))if(b=b+1|0,_[g>>2]=b,y<d*.5){_[g+4>>2]=m;break}else{m=m+1|0,_[g+4>>2]=m;break}if(y<1-d){if(_[g+4>>2]=m,d*2+-1<y){_[g>>2]=b;break}}else m=m+1|0,_[g+4>>2]=m;b=b+1|0,_[g>>2]=b}while(!1);do if(T<0)if(m&1){M=(m+1|0)/2|0,M=xn(b|0,((b|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-((+(M>>>0)+4294967296*+(me()|0))*2+1)),_[g>>2]=b;break}else{M=(m|0)/2|0,M=xn(b|0,((b|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-(+(M>>>0)+4294967296*+(me()|0))*2),_[g>>2]=b;break}while(!1);M=g+4|0,S<0&&(b=b-((m<<1|1|0)/2|0)|0,_[g>>2]=b,m=0-m|0,_[M>>2]=m),l=m-b|0,(b|0)<0?(u=0-b|0,_[M>>2]=l,_[D>>2]=u,_[g>>2]=0,m=l,b=0):u=0,(m|0)<0&&(b=b-m|0,_[g>>2]=b,u=u-m|0,_[D>>2]=u,_[M>>2]=0,m=0),c=b-u|0,l=m-u|0,(u|0)<0&&(_[g>>2]=c,_[M>>2]=l,_[D>>2]=0,m=l,b=c,u=0),l=(m|0)<(b|0)?m:b,l=(u|0)<(l|0)?u:l,!((l|0)<=0)&&(_[g>>2]=b-l,_[M>>2]=m-l,_[D>>2]=u-l)}function Ki(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0;g=_[m>>2]|0,d=m+4|0,b=_[d>>2]|0,(g|0)<0&&(b=b-g|0,_[d>>2]=b,c=m+8|0,_[c>>2]=(_[c>>2]|0)-g,_[m>>2]=0,g=0),(b|0)<0?(g=g-b|0,_[m>>2]=g,c=m+8|0,u=(_[c>>2]|0)-b|0,_[c>>2]=u,_[d>>2]=0,b=0):(u=m+8|0,c=u,u=_[u>>2]|0),(u|0)<0&&(g=g-u|0,_[m>>2]=g,b=b-u|0,_[d>>2]=b,_[c>>2]=0,u=0),l=(b|0)<(g|0)?b:g,l=(u|0)<(l|0)?u:l,!((l|0)<=0)&&(_[m>>2]=g-l,_[d>>2]=b-l,_[c>>2]=u-l)}function sa(m,g){m=m|0,g=g|0;var b=0,l=0;l=_[m+8>>2]|0,b=+((_[m+4>>2]|0)-l|0),ne[g>>3]=+((_[m>>2]|0)-l|0)-b*.5,ne[g+8>>3]=b*.8660254037844386}function $n(m,g,b){m=m|0,g=g|0,b=b|0,_[b>>2]=(_[g>>2]|0)+(_[m>>2]|0),_[b+4>>2]=(_[g+4>>2]|0)+(_[m+4>>2]|0),_[b+8>>2]=(_[g+8>>2]|0)+(_[m+8>>2]|0)}function qu(m,g,b){m=m|0,g=g|0,b=b|0,_[b>>2]=(_[m>>2]|0)-(_[g>>2]|0),_[b+4>>2]=(_[m+4>>2]|0)-(_[g+4>>2]|0),_[b+8>>2]=(_[m+8>>2]|0)-(_[g+8>>2]|0)}function jc(m,g){m=m|0,g=g|0;var b=0,l=0;b=Fr(_[m>>2]|0,g)|0,_[m>>2]=b,b=m+4|0,l=Fr(_[b>>2]|0,g)|0,_[b>>2]=l,m=m+8|0,g=Fr(_[m>>2]|0,g)|0,_[m>>2]=g}function ul(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;d=_[m>>2]|0,y=(d|0)<0,l=(_[m+4>>2]|0)-(y?d:0)|0,c=(l|0)<0,u=(c?0-l|0:0)+((_[m+8>>2]|0)-(y?d:0))|0,b=(u|0)<0,m=b?0:u,g=(c?0:l)-(b?u:0)|0,u=(y?0:d)-(c?l:0)-(b?u:0)|0,b=(g|0)<(u|0)?g:u,b=(m|0)<(b|0)?m:b,l=(b|0)>0,m=m-(l?b:0)|0,g=g-(l?b:0)|0;e:do switch(u-(l?b:0)|0){case 0:switch(g|0){case 0:return y=m|0?(m|0)==1?1:7:0,y|0;case 1:return y=m|0?(m|0)==1?3:7:2,y|0;default:break e}case 1:switch(g|0){case 0:return y=m|0?(m|0)==1?5:7:4,y|0;case 1:{if(!m)m=6;else break e;return m|0}default:break e}}while(!1);return y=7,y|0}function $u(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;d=m+8|0,u=_[d>>2]|0,c=(_[m>>2]|0)-u|0,y=m+4|0,u=(_[y>>2]|0)-u|0;do if(c>>>0>715827881|u>>>0>715827881){if(b=(c|0)>0,b){if((2147483647-c|0)<(c|0)||(2147483647-(c<<1)|0)<(c|0))return y=1,y|0}else if((-2147483648-c|0)>(c|0)||(-2147483648-(c<<1)|0)>(c|0))return y=1,y|0;if(g=c*3|0,(u|0)>0){if((2147483647-u|0)<(u|0))return y=1,y|0}else if((-2147483648-u|0)>(u|0))return y=1,y|0;if(l=u<<1,(c|0)>-1){if((g|-2147483648|0)>=(u|0))return y=1,y|0}else if((g^-2147483648|0)<(u|0))return y=1,y|0;if(b){if((2147483647-c|0)<(l|0))g=1;else{b=l;break}return g|0}else{if((-2147483648-c|0)>(l|0))g=1;else{b=l;break}return g|0}}else b=u<<1,g=c*3|0;while(!1);l=ro(+(g-u|0)/7)|0,_[m>>2]=l,u=ro(+(b+c|0)/7)|0,_[y>>2]=u,_[d>>2]=0,b=(u|0)<(l|0),g=b?l:u,b=b?u:l;do if((b|0)<0){if((g|0)>0){if((g|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-g|0)>=(b|0)))break;zt(23313,22444,355,22455)}if((b|0)==-2147483648|(-2147483648-g|0)>(b|0)&&zt(23313,22444,355,22455),(g|0)>-1){if((g|-2147483648|0)<(b|0))break;zt(23313,22444,355,22455)}else{if((g^-2147483648|0)>=(b|0))break;zt(23313,22444,355,22455)}}while(!1);return g=u-l|0,(l|0)<0?(b=0-l|0,_[y>>2]=g,_[d>>2]=b,_[m>>2]=0,l=0):(g=u,b=0),(g|0)<0&&(l=l-g|0,_[m>>2]=l,b=b-g|0,_[d>>2]=b,_[y>>2]=0,g=0),c=l-b|0,u=g-b|0,(b|0)<0?(_[m>>2]=c,_[y>>2]=u,_[d>>2]=0,g=u,u=c,b=0):u=l,l=(g|0)<(u|0)?g:u,l=(b|0)<(l|0)?b:l,(l|0)<=0?(y=0,y|0):(_[m>>2]=u-l,_[y>>2]=g-l,_[d>>2]=b-l,y=0,y|0)}function Zu(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;d=m+8|0,u=_[d>>2]|0,c=(_[m>>2]|0)-u|0,y=m+4|0,u=(_[y>>2]|0)-u|0;do if(c>>>0>715827881|u>>>0>715827881){if(b=(c|0)>0,b){if((2147483647-c|0)<(c|0))return y=1,y|0}else if((-2147483648-c|0)>(c|0))return y=1,y|0;if(g=c<<1,(u|0)>0){if((2147483647-u|0)<(u|0)||(2147483647-(u<<1)|0)<(u|0))return y=1,y|0}else if((-2147483648-u|0)>(u|0)||(-2147483648-(u<<1)|0)>(u|0))return y=1,y|0;if(l=u*3|0,b){if((2147483647-g|0)<(u|0))return y=1,y|0}else if((-2147483648-g|0)>(u|0))return y=1,y|0;if((u|0)>-1){if((l|-2147483648|0)<(c|0)){b=l;break}else g=1;return g|0}else{if((l^-2147483648|0)<(c|0))g=1;else{b=l;break}return g|0}}else b=u*3|0,g=c<<1;while(!1);l=ro(+(g+u|0)/7)|0,_[m>>2]=l,u=ro(+(b-c|0)/7)|0,_[y>>2]=u,_[d>>2]=0,b=(u|0)<(l|0),g=b?l:u,b=b?u:l;do if((b|0)<0){if((g|0)>0){if((g|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-g|0)>=(b|0)))break;zt(23313,22444,404,22469)}if((b|0)==-2147483648|(-2147483648-g|0)>(b|0)&&zt(23313,22444,404,22469),(g|0)>-1){if((g|-2147483648|0)<(b|0))break;zt(23313,22444,404,22469)}else{if((g^-2147483648|0)>=(b|0))break;zt(23313,22444,404,22469)}}while(!1);return g=u-l|0,(l|0)<0?(b=0-l|0,_[y>>2]=g,_[d>>2]=b,_[m>>2]=0,l=0):(g=u,b=0),(g|0)<0&&(l=l-g|0,_[m>>2]=l,b=b-g|0,_[d>>2]=b,_[y>>2]=0,g=0),c=l-b|0,u=g-b|0,(b|0)<0?(_[m>>2]=c,_[y>>2]=u,_[d>>2]=0,g=u,u=c,b=0):u=l,l=(g|0)<(u|0)?g:u,l=(b|0)<(l|0)?b:l,(l|0)<=0?(y=0,y|0):(_[m>>2]=u-l,_[y>>2]=g-l,_[d>>2]=b-l,y=0,y|0)}function Qh(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;d=m+8|0,b=_[d>>2]|0,g=(_[m>>2]|0)-b|0,y=m+4|0,b=(_[y>>2]|0)-b|0,l=ro(+((g*3|0)-b|0)/7)|0,_[m>>2]=l,g=ro(+((b<<1)+g|0)/7)|0,_[y>>2]=g,_[d>>2]=0,b=g-l|0,(l|0)<0?(c=0-l|0,_[y>>2]=b,_[d>>2]=c,_[m>>2]=0,g=b,l=0,b=c):b=0,(g|0)<0&&(l=l-g|0,_[m>>2]=l,b=b-g|0,_[d>>2]=b,_[y>>2]=0,g=0),c=l-b|0,u=g-b|0,(b|0)<0?(_[m>>2]=c,_[y>>2]=u,_[d>>2]=0,g=u,u=c,b=0):u=l,l=(g|0)<(u|0)?g:u,l=(b|0)<(l|0)?b:l,!((l|0)<=0)&&(_[m>>2]=u-l,_[y>>2]=g-l,_[d>>2]=b-l)}function Ku(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;d=m+8|0,b=_[d>>2]|0,g=(_[m>>2]|0)-b|0,y=m+4|0,b=(_[y>>2]|0)-b|0,l=ro(+((g<<1)+b|0)/7)|0,_[m>>2]=l,g=ro(+((b*3|0)-g|0)/7)|0,_[y>>2]=g,_[d>>2]=0,b=g-l|0,(l|0)<0?(c=0-l|0,_[y>>2]=b,_[d>>2]=c,_[m>>2]=0,g=b,l=0,b=c):b=0,(g|0)<0&&(l=l-g|0,_[m>>2]=l,b=b-g|0,_[d>>2]=b,_[y>>2]=0,g=0),c=l-b|0,u=g-b|0,(b|0)<0?(_[m>>2]=c,_[y>>2]=u,_[d>>2]=0,g=u,u=c,b=0):u=l,l=(g|0)<(u|0)?g:u,l=(b|0)<(l|0)?b:l,!((l|0)<=0)&&(_[m>>2]=u-l,_[y>>2]=g-l,_[d>>2]=b-l)}function Hc(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;g=_[m>>2]|0,d=m+4|0,b=_[d>>2]|0,y=m+8|0,l=_[y>>2]|0,u=b+(g*3|0)|0,_[m>>2]=u,b=l+(b*3|0)|0,_[d>>2]=b,g=(l*3|0)+g|0,_[y>>2]=g,l=b-u|0,(u|0)<0?(g=g-u|0,_[d>>2]=l,_[y>>2]=g,_[m>>2]=0,b=l,l=0):l=u,(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),c=l-g|0,u=b-g|0,(g|0)<0?(_[m>>2]=c,_[d>>2]=u,_[y>>2]=0,l=c,g=0):u=b,b=(u|0)<(l|0)?u:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[d>>2]=u-b,_[y>>2]=g-b)}function Ys(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;u=_[m>>2]|0,d=m+4|0,g=_[d>>2]|0,y=m+8|0,b=_[y>>2]|0,l=(g*3|0)+u|0,u=b+(u*3|0)|0,_[m>>2]=u,_[d>>2]=l,g=(b*3|0)+g|0,_[y>>2]=g,b=l-u|0,(u|0)<0?(g=g-u|0,_[d>>2]=b,_[y>>2]=g,_[m>>2]=0,u=0):b=l,(b|0)<0&&(u=u-b|0,_[m>>2]=u,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),c=u-g|0,l=b-g|0,(g|0)<0?(_[m>>2]=c,_[d>>2]=l,_[y>>2]=0,u=c,g=0):l=b,b=(l|0)<(u|0)?l:u,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=u-b,_[d>>2]=l-b,_[y>>2]=g-b)}function hl(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0;(g+-1|0)>>>0>=6||(u=(_[15440+(g*12|0)>>2]|0)+(_[m>>2]|0)|0,_[m>>2]=u,y=m+4|0,l=(_[15440+(g*12|0)+4>>2]|0)+(_[y>>2]|0)|0,_[y>>2]=l,d=m+8|0,g=(_[15440+(g*12|0)+8>>2]|0)+(_[d>>2]|0)|0,_[d>>2]=g,b=l-u|0,(u|0)<0?(g=g-u|0,_[y>>2]=b,_[d>>2]=g,_[m>>2]=0,l=0):(b=l,l=u),(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[d>>2]=g,_[y>>2]=0,b=0),c=l-g|0,u=b-g|0,(g|0)<0?(_[m>>2]=c,_[y>>2]=u,_[d>>2]=0,l=c,g=0):u=b,b=(u|0)<(l|0)?u:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[y>>2]=u-b,_[d>>2]=g-b))}function Yu(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;u=_[m>>2]|0,d=m+4|0,g=_[d>>2]|0,y=m+8|0,b=_[y>>2]|0,l=g+u|0,u=b+u|0,_[m>>2]=u,_[d>>2]=l,g=b+g|0,_[y>>2]=g,b=l-u|0,(u|0)<0?(g=g-u|0,_[d>>2]=b,_[y>>2]=g,_[m>>2]=0,l=0):(b=l,l=u),(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),c=l-g|0,u=b-g|0,(g|0)<0?(_[m>>2]=c,_[d>>2]=u,_[y>>2]=0,l=c,g=0):u=b,b=(u|0)<(l|0)?u:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[d>>2]=u-b,_[y>>2]=g-b)}function Yi(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;g=_[m>>2]|0,d=m+4|0,l=_[d>>2]|0,y=m+8|0,b=_[y>>2]|0,u=l+g|0,_[m>>2]=u,l=b+l|0,_[d>>2]=l,g=b+g|0,_[y>>2]=g,b=l-u|0,(u|0)<0?(g=g-u|0,_[d>>2]=b,_[y>>2]=g,_[m>>2]=0,l=0):(b=l,l=u),(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),c=l-g|0,u=b-g|0,(g|0)<0?(_[m>>2]=c,_[d>>2]=u,_[y>>2]=0,l=c,g=0):u=b,b=(u|0)<(l|0)?u:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[d>>2]=u-b,_[y>>2]=g-b)}function ko(m){switch(m=m|0,m|0){case 1:{m=5;break}case 5:{m=4;break}case 4:{m=6;break}case 6:{m=2;break}case 2:{m=3;break}case 3:{m=1;break}}return m|0}function Zn(m){switch(m=m|0,m|0){case 1:{m=3;break}case 3:{m=2;break}case 2:{m=6;break}case 6:{m=4;break}case 4:{m=5;break}case 5:{m=1;break}}return m|0}function No(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;g=_[m>>2]|0,d=m+4|0,b=_[d>>2]|0,y=m+8|0,l=_[y>>2]|0,u=b+(g<<1)|0,_[m>>2]=u,b=l+(b<<1)|0,_[d>>2]=b,g=(l<<1)+g|0,_[y>>2]=g,l=b-u|0,(u|0)<0?(g=g-u|0,_[d>>2]=l,_[y>>2]=g,_[m>>2]=0,b=l,l=0):l=u,(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),c=l-g|0,u=b-g|0,(g|0)<0?(_[m>>2]=c,_[d>>2]=u,_[y>>2]=0,l=c,g=0):u=b,b=(u|0)<(l|0)?u:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[d>>2]=u-b,_[y>>2]=g-b)}function oa(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;u=_[m>>2]|0,d=m+4|0,g=_[d>>2]|0,y=m+8|0,b=_[y>>2]|0,l=(g<<1)+u|0,u=b+(u<<1)|0,_[m>>2]=u,_[d>>2]=l,g=(b<<1)+g|0,_[y>>2]=g,b=l-u|0,(u|0)<0?(g=g-u|0,_[d>>2]=b,_[y>>2]=g,_[m>>2]=0,u=0):b=l,(b|0)<0&&(u=u-b|0,_[m>>2]=u,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),c=u-g|0,l=b-g|0,(g|0)<0?(_[m>>2]=c,_[d>>2]=l,_[y>>2]=0,u=c,g=0):l=b,b=(l|0)<(u|0)?l:u,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=u-b,_[d>>2]=l-b,_[y>>2]=g-b)}function Uo(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0;return d=(_[m>>2]|0)-(_[g>>2]|0)|0,y=(d|0)<0,l=(_[m+4>>2]|0)-(_[g+4>>2]|0)-(y?d:0)|0,c=(l|0)<0,u=(y?0-d|0:0)+(_[m+8>>2]|0)-(_[g+8>>2]|0)+(c?0-l|0:0)|0,m=(u|0)<0,g=m?0:u,b=(c?0:l)-(m?u:0)|0,u=(y?0:d)-(c?l:0)-(m?u:0)|0,m=(b|0)<(u|0)?b:u,m=(g|0)<(m|0)?g:m,l=(m|0)>0,g=g-(l?m:0)|0,b=b-(l?m:0)|0,m=u-(l?m:0)|0,m=(m|0)>-1?m:0-m|0,b=(b|0)>-1?b:0-b|0,g=(g|0)>-1?g:0-g|0,g=(b|0)>(g|0)?b:g,((m|0)>(g|0)?m:g)|0}function aa(m,g){m=m|0,g=g|0;var b=0;b=_[m+8>>2]|0,_[g>>2]=(_[m>>2]|0)-b,_[g+4>>2]=(_[m+4>>2]|0)-b}function Ra(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0;l=_[m>>2]|0,_[g>>2]=l,u=_[m+4>>2]|0,d=g+4|0,_[d>>2]=u,y=g+8|0,_[y>>2]=0,b=(u|0)<(l|0),m=b?l:u,b=b?u:l;do if((b|0)<0){if((m|0)>0){if((m|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-m|0)>=(b|0)))break;return m=1,m|0}if((b|0)==-2147483648|(-2147483648-m|0)>(b|0))return g=1,g|0;if((m|0)>-1){if((m|-2147483648|0)<(b|0))break;return m=1,m|0}else{if((m^-2147483648|0)<(b|0))m=1;else break;return m|0}}while(!1);return m=u-l|0,(l|0)<0?(b=0-l|0,_[d>>2]=m,_[y>>2]=b,_[g>>2]=0,l=0):(m=u,b=0),(m|0)<0&&(l=l-m|0,_[g>>2]=l,b=b-m|0,_[y>>2]=b,_[d>>2]=0,m=0),c=l-b|0,u=m-b|0,(b|0)<0?(_[g>>2]=c,_[d>>2]=u,_[y>>2]=0,m=u,u=c,b=0):u=l,l=(m|0)<(u|0)?m:u,l=(b|0)<(l|0)?b:l,(l|0)<=0?(g=0,g|0):(_[g>>2]=u-l,_[d>>2]=m-l,_[y>>2]=b-l,g=0,g|0)}function la(m){m=m|0;var g=0,b=0,l=0,u=0;g=m+8|0,u=_[g>>2]|0,b=u-(_[m>>2]|0)|0,_[m>>2]=b,l=m+4|0,m=(_[l>>2]|0)-u|0,_[l>>2]=m,_[g>>2]=0-(m+b)}function ca(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;b=_[m>>2]|0,g=0-b|0,_[m>>2]=g,d=m+8|0,_[d>>2]=0,y=m+4|0,l=_[y>>2]|0,u=l+b|0,(b|0)>0?(_[y>>2]=u,_[d>>2]=b,_[m>>2]=0,g=0,l=u):b=0,(l|0)<0?(c=g-l|0,_[m>>2]=c,b=b-l|0,_[d>>2]=b,_[y>>2]=0,u=c-b|0,g=0-b|0,(b|0)<0?(_[m>>2]=u,_[y>>2]=g,_[d>>2]=0,l=g,b=0):(l=0,u=c)):u=g,g=(l|0)<(u|0)?l:u,g=(b|0)<(g|0)?b:g,!((g|0)<=0)&&(_[m>>2]=u-g,_[y>>2]=l-g,_[d>>2]=b-g)}function ef(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0;if(D=ue,ue=ue+64|0,M=D,y=D+56|0,!(!0&(g&2013265920|0)==134217728&(!0&(l&2013265920|0)==134217728)))return u=5,ue=D,u|0;if((m|0)==(b|0)&(g|0)==(l|0))return _[u>>2]=0,u=0,ue=D,u|0;if(d=_t(m|0,g|0,52)|0,me()|0,d=d&15,S=_t(b|0,l|0,52)|0,me()|0,(d|0)!=(S&15|0))return u=12,ue=D,u|0;if(c=d+-1|0,d>>>0>1){dl(m,g,c,M)|0,dl(b,l,c,y)|0,S=M,T=_[S>>2]|0,S=_[S+4>>2]|0;e:do if((T|0)==(_[y>>2]|0)&&(S|0)==(_[y+4>>2]|0)){d=(d^15)*3|0,c=_t(m|0,g|0,d|0)|0,me()|0,c=c&7,d=_t(b|0,l|0,d|0)|0,me()|0,d=d&7;do if((c|0)==0|(d|0)==0)_[u>>2]=1,c=0;else if((c|0)==7)c=5;else{if((c|0)==1|(d|0)==1&&ti(T,S)|0){c=5;break}if((_[15536+(c<<2)>>2]|0)!=(d|0)&&(_[15568+(c<<2)>>2]|0)!=(d|0))break e;_[u>>2]=1,c=0}while(!1);return u=c,ue=D,u|0}while(!1)}c=M,d=c+56|0;do _[c>>2]=0,c=c+4|0;while((c|0)<(d|0));return qn(m,g,1,M)|0,g=M,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0))&&(g=M+8|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))&&(g=M+16|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))&&(g=M+24|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))&&(g=M+32|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))&&(g=M+40|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))?(c=M+48|0,c=((_[c>>2]|0)==(b|0)?(_[c+4>>2]|0)==(l|0):0)&1):c=1,_[u>>2]=c,u=0,ue=D,u|0}function tf(m,g,b,l,u){return m=m|0,g=g|0,b=b|0,l=l|0,u=u|0,b=Ze(m,g,b,l)|0,(b|0)==7?(u=11,u|0):(l=St(b|0,0,56)|0,g=g&-2130706433|(me()|0)|268435456,_[u>>2]=m|l,_[u+4>>2]=g,u=0,u|0)}function Qr(m,g,b){return m=m|0,g=g|0,b=b|0,!0&(g&2013265920|0)==268435456?(_[b>>2]=m,_[b+4>>2]=g&-2130706433|134217728,b=0,b|0):(b=6,b|0)}function _A(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0;return u=ue,ue=ue+16|0,l=u,_[l>>2]=0,!0&(g&2013265920|0)==268435456?(c=_t(m|0,g|0,56)|0,me()|0,l=Ce(m,g&-2130706433|134217728,c&7,l,b)|0,ue=u,l|0):(l=6,ue=u,l|0)}function Gc(m,g){m=m|0,g=g|0;var b=0;switch(b=_t(m|0,g|0,56)|0,me()|0,b&7){case 0:case 7:return b=0,b|0}return b=g&-2130706433|134217728,!(!0&(g&2013265920|0)==268435456)||!0&(g&117440512|0)==16777216&(ti(m,b)|0)!=0?(b=0,b|0):(b=ei(m,b)|0,b|0)}function rf(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0;return u=ue,ue=ue+16|0,l=u,!0&(g&2013265920|0)==268435456?(c=g&-2130706433|134217728,d=b,_[d>>2]=m,_[d+4>>2]=c,_[l>>2]=0,g=_t(m|0,g|0,56)|0,me()|0,l=Ce(m,c,g&7,l,b+8|0)|0,ue=u,l|0):(l=6,ue=u,l|0)}function nf(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0;return u=(ti(m,g)|0)==0,g=g&-2130706433,l=b,_[l>>2]=u?m:0,_[l+4>>2]=u?g|285212672:0,l=b+8|0,_[l>>2]=m,_[l+4>>2]=g|301989888,l=b+16|0,_[l>>2]=m,_[l+4>>2]=g|318767104,l=b+24|0,_[l>>2]=m,_[l+4>>2]=g|335544320,l=b+32|0,_[l>>2]=m,_[l+4>>2]=g|352321536,b=b+40|0,_[b>>2]=m,_[b+4>>2]=g|369098752,0}function Yl(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0;return d=ue,ue=ue+16|0,u=d,c=g&-2130706433|134217728,!0&(g&2013265920|0)==268435456?(l=_t(m|0,g|0,56)|0,me()|0,l=Fs(m,c,l&7)|0,(l|0)==-1?(_[b>>2]=0,c=6,ue=d,c|0):(fo(m,c,u)|0&&zt(23313,22484,282,22499),g=_t(m|0,g|0,52)|0,me()|0,g=g&15,ti(m,c)|0?Wc(u,g,l,2,b):zo(u,g,l,2,b),c=0,ue=d,c|0)):(c=6,ue=d,c|0)}function sf(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0;l=ue,ue=ue+16|0,u=l,Ba(m,g,b,u),Hi(u,b+4|0),ue=l}function Ba(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0;if(y=ue,ue=ue+16|0,T=y,ua(m,b,T),c=+yr(+(1-+ne[T>>3]*.5)),c<1e-16){_[l>>2]=0,_[l+4>>2]=0,_[l+8>>2]=0,_[l+12>>2]=0,ue=y;return}if(T=_[b>>2]|0,u=+ne[15920+(T*24|0)>>3],u=+Da(u-+Da(+Ai(15600+(T<<4)|0,m))),vs(g)|0?d=+Da(u+-.3334731722518321):d=u,u=+Ir(+c)/.381966011250105,(g|0)>0){m=0;do u=u*2.6457513110645907,m=m+1|0;while((m|0)!=(g|0))}c=+ct(+d)*u,ne[l>>3]=c,d=+It(+d)*u,ne[l+8>>3]=d,ue=y}function ua(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0;if(c=ue,ue=ue+32|0,u=c,Ao(m,u),_[g>>2]=0,ne[b>>3]=5,l=+Jt(16400,u),l<+ne[b>>3]&&(_[g>>2]=0,ne[b>>3]=l),l=+Jt(16424,u),l<+ne[b>>3]&&(_[g>>2]=1,ne[b>>3]=l),l=+Jt(16448,u),l<+ne[b>>3]&&(_[g>>2]=2,ne[b>>3]=l),l=+Jt(16472,u),l<+ne[b>>3]&&(_[g>>2]=3,ne[b>>3]=l),l=+Jt(16496,u),l<+ne[b>>3]&&(_[g>>2]=4,ne[b>>3]=l),l=+Jt(16520,u),l<+ne[b>>3]&&(_[g>>2]=5,ne[b>>3]=l),l=+Jt(16544,u),l<+ne[b>>3]&&(_[g>>2]=6,ne[b>>3]=l),l=+Jt(16568,u),l<+ne[b>>3]&&(_[g>>2]=7,ne[b>>3]=l),l=+Jt(16592,u),l<+ne[b>>3]&&(_[g>>2]=8,ne[b>>3]=l),l=+Jt(16616,u),l<+ne[b>>3]&&(_[g>>2]=9,ne[b>>3]=l),l=+Jt(16640,u),l<+ne[b>>3]&&(_[g>>2]=10,ne[b>>3]=l),l=+Jt(16664,u),l<+ne[b>>3]&&(_[g>>2]=11,ne[b>>3]=l),l=+Jt(16688,u),l<+ne[b>>3]&&(_[g>>2]=12,ne[b>>3]=l),l=+Jt(16712,u),l<+ne[b>>3]&&(_[g>>2]=13,ne[b>>3]=l),l=+Jt(16736,u),l<+ne[b>>3]&&(_[g>>2]=14,ne[b>>3]=l),l=+Jt(16760,u),l<+ne[b>>3]&&(_[g>>2]=15,ne[b>>3]=l),l=+Jt(16784,u),l<+ne[b>>3]&&(_[g>>2]=16,ne[b>>3]=l),l=+Jt(16808,u),l<+ne[b>>3]&&(_[g>>2]=17,ne[b>>3]=l),l=+Jt(16832,u),l<+ne[b>>3]&&(_[g>>2]=18,ne[b>>3]=l),l=+Jt(16856,u),!(l<+ne[b>>3])){ue=c;return}_[g>>2]=19,ne[b>>3]=l,ue=c}function Js(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0;if(c=+rh(m),c<1e-16){g=15600+(g<<4)|0,_[u>>2]=_[g>>2],_[u+4>>2]=_[g+4>>2],_[u+8>>2]=_[g+8>>2],_[u+12>>2]=_[g+12>>2];return}if(d=+Yr(+ +ne[m+8>>3],+ +ne[m>>3]),(b|0)>0){m=0;do c=c/2.6457513110645907,m=m+1|0;while((m|0)!=(b|0))}l?(c=c/3,b=(vs(b)|0)==0,c=+ur(+((b?c:c/2.6457513110645907)*.381966011250105))):(c=+ur(+(c*.381966011250105)),vs(b)|0&&(d=+Da(d+.3334731722518321))),Qc(15600+(g<<4)|0,+Da(+ne[15920+(g*24|0)>>3]-d),c,u)}function of(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0;l=ue,ue=ue+16|0,u=l,sa(m+4|0,u),Js(u,_[m>>2]|0,g,0,b),ue=l}function Wc(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0,J=0,_e=0,Ee=0,Ie=0,Me=0,Ge=0,Qe=0,st=0,rt=0,lt=0,At=0,Tt=0,ft=0;if(At=ue,ue=ue+272|0,c=At+256|0,ie=At+240|0,st=At,rt=At+224|0,lt=At+208|0,K=At+176|0,J=At+160|0,_e=At+192|0,Ee=At+144|0,Ie=At+128|0,Me=At+112|0,Ge=At+96|0,Qe=At+80|0,_[c>>2]=g,_[ie>>2]=_[m>>2],_[ie+4>>2]=_[m+4>>2],_[ie+8>>2]=_[m+8>>2],_[ie+12>>2]=_[m+12>>2],Xc(ie,c,st),_[u>>2]=0,ie=l+b+((l|0)==5&1)|0,(ie|0)<=(b|0)){ue=At;return}T=_[c>>2]|0,S=rt+4|0,M=K+4|0,D=b+5|0,L=16880+(T<<2)|0,j=16960+(T<<2)|0,z=Ie+8|0,W=Me+8|0,te=Ge+8|0,Q=lt+4|0,y=b;e:for(;;){d=st+(((y|0)%5|0)<<4)|0,_[lt>>2]=_[d>>2],_[lt+4>>2]=_[d+4>>2],_[lt+8>>2]=_[d+8>>2],_[lt+12>>2]=_[d+12>>2];do;while((Bs(lt,T,0,1)|0)==2);if((y|0)>(b|0)&(vs(g)|0)!=0){if(_[K>>2]=_[lt>>2],_[K+4>>2]=_[lt+4>>2],_[K+8>>2]=_[lt+8>>2],_[K+12>>2]=_[lt+12>>2],sa(S,J),l=_[K>>2]|0,c=_[17040+(l*80|0)+(_[rt>>2]<<2)>>2]|0,_[K>>2]=_[18640+(l*80|0)+(c*20|0)>>2],d=_[18640+(l*80|0)+(c*20|0)+16>>2]|0,(d|0)>0){m=0;do Yu(M),m=m+1|0;while((m|0)<(d|0))}switch(d=18640+(l*80|0)+(c*20|0)+4|0,_[_e>>2]=_[d>>2],_[_e+4>>2]=_[d+4>>2],_[_e+8>>2]=_[d+8>>2],jc(_e,(_[L>>2]|0)*3|0),$n(M,_e,M),Ki(M),sa(M,Ee),Tt=+(_[j>>2]|0),ne[Ie>>3]=Tt*3,ne[z>>3]=0,ft=Tt*-1.5,ne[Me>>3]=ft,ne[W>>3]=Tt*2.598076211353316,ne[Ge>>3]=ft,ne[te>>3]=Tt*-2.598076211353316,_[17040+((_[K>>2]|0)*80|0)+(_[lt>>2]<<2)>>2]|0){case 1:{m=Me,l=Ie;break}case 3:{m=Ge,l=Me;break}case 2:{m=Ie,l=Ge;break}default:{m=12;break e}}Ds(J,Ee,l,m,Qe),Js(Qe,_[K>>2]|0,T,1,u+8+(_[u>>2]<<4)|0),_[u>>2]=(_[u>>2]|0)+1}if((y|0)<(D|0)&&(sa(Q,K),Js(K,_[lt>>2]|0,T,1,u+8+(_[u>>2]<<4)|0),_[u>>2]=(_[u>>2]|0)+1),_[rt>>2]=_[lt>>2],_[rt+4>>2]=_[lt+4>>2],_[rt+8>>2]=_[lt+8>>2],_[rt+12>>2]=_[lt+12>>2],y=y+1|0,(y|0)>=(ie|0)){m=3;break}}if((m|0)==3){ue=At;return}else(m|0)==12&&zt(22522,22569,571,22579)}function Xc(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0;T=ue,ue=ue+128|0,l=T+64|0,u=T,c=l,d=20240,y=c+60|0;do _[c>>2]=_[d>>2],c=c+4|0,d=d+4|0;while((c|0)<(y|0));c=u,d=20304,y=c+60|0;do _[c>>2]=_[d>>2],c=c+4|0,d=d+4|0;while((c|0)<(y|0));y=(vs(_[g>>2]|0)|0)==0,l=y?l:u,u=m+4|0,No(u),oa(u),vs(_[g>>2]|0)|0&&(Ys(u),_[g>>2]=(_[g>>2]|0)+1),_[b>>2]=_[m>>2],g=b+4|0,$n(u,l,g),Ki(g),_[b+16>>2]=_[m>>2],g=b+20|0,$n(u,l+12|0,g),Ki(g),_[b+32>>2]=_[m>>2],g=b+36|0,$n(u,l+24|0,g),Ki(g),_[b+48>>2]=_[m>>2],g=b+52|0,$n(u,l+36|0,g),Ki(g),_[b+64>>2]=_[m>>2],b=b+68|0,$n(u,l+48|0,b),Ki(b),ue=T}function Bs(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0;if(z=ue,ue=ue+32|0,L=z+12|0,y=z,j=m+4|0,D=_[16960+(g<<2)>>2]|0,M=(l|0)!=0,D=M?D*3|0:D,u=_[j>>2]|0,S=m+8|0,d=_[S>>2]|0,M){if(c=m+12|0,l=_[c>>2]|0,u=d+u+l|0,(u|0)==(D|0))return j=1,ue=z,j|0;T=c}else T=m+12|0,l=_[T>>2]|0,u=d+u+l|0;if((u|0)<=(D|0))return j=0,ue=z,j|0;do if((l|0)>0){if(l=_[m>>2]|0,(d|0)>0){c=18640+(l*80|0)+60|0,l=m;break}l=18640+(l*80|0)+40|0,b?(os(L,D,0,0),qu(j,L,y),Yi(y),$n(y,L,j),c=l,l=m):(c=l,l=m)}else c=18640+((_[m>>2]|0)*80|0)+20|0,l=m;while(!1);if(_[l>>2]=_[c>>2],u=c+16|0,(_[u>>2]|0)>0){l=0;do Yu(j),l=l+1|0;while((l|0)<(_[u>>2]|0))}return m=c+4|0,_[L>>2]=_[m>>2],_[L+4>>2]=_[m+4>>2],_[L+8>>2]=_[m+8>>2],g=_[16880+(g<<2)>>2]|0,jc(L,M?g*3|0:g),$n(j,L,j),Ki(j),M?l=((_[S>>2]|0)+(_[j>>2]|0)+(_[T>>2]|0)|0)==(D|0)?1:2:l=2,j=l,ue=z,j|0}function af(m,g){m=m|0,g=g|0;var b=0;do b=Bs(m,g,0,1)|0;while((b|0)==2);return b|0}function zo(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0,J=0,_e=0,Ee=0,Ie=0,Me=0,Ge=0,Qe=0,st=0;if(Ge=ue,ue=ue+240|0,c=Ge+224|0,_e=Ge+208|0,Ee=Ge,Ie=Ge+192|0,Me=Ge+176|0,te=Ge+160|0,Q=Ge+144|0,ie=Ge+128|0,K=Ge+112|0,J=Ge+96|0,_[c>>2]=g,_[_e>>2]=_[m>>2],_[_e+4>>2]=_[m+4>>2],_[_e+8>>2]=_[m+8>>2],_[_e+12>>2]=_[m+12>>2],ha(_e,c,Ee),_[u>>2]=0,W=l+b+((l|0)==6&1)|0,(W|0)<=(b|0)){ue=Ge;return}T=_[c>>2]|0,S=b+6|0,M=16960+(T<<2)|0,D=Q+8|0,L=ie+8|0,j=K+8|0,z=Ie+4|0,d=0,y=b,l=-1;e:for(;;){if(c=(y|0)%6|0,m=Ee+(c<<4)|0,_[Ie>>2]=_[m>>2],_[Ie+4>>2]=_[m+4>>2],_[Ie+8>>2]=_[m+8>>2],_[Ie+12>>2]=_[m+12>>2],m=d,d=Bs(Ie,T,0,1)|0,(y|0)>(b|0)&(vs(g)|0)!=0&&(m|0)!=1&&(_[Ie>>2]|0)!=(l|0)){switch(sa(Ee+(((c+5|0)%6|0)<<4)+4|0,Me),sa(Ee+(c<<4)+4|0,te),Qe=+(_[M>>2]|0),ne[Q>>3]=Qe*3,ne[D>>3]=0,st=Qe*-1.5,ne[ie>>3]=st,ne[L>>3]=Qe*2.598076211353316,ne[K>>3]=st,ne[j>>3]=Qe*-2.598076211353316,c=_[_e>>2]|0,_[17040+(c*80|0)+(((l|0)==(c|0)?_[Ie>>2]|0:l)<<2)>>2]|0){case 1:{m=ie,l=Q;break}case 3:{m=K,l=ie;break}case 2:{m=Q,l=K;break}default:{m=8;break e}}Ds(Me,te,l,m,J),!(us(Me,J)|0)&&!(us(te,J)|0)&&(Js(J,_[_e>>2]|0,T,1,u+8+(_[u>>2]<<4)|0),_[u>>2]=(_[u>>2]|0)+1)}if((y|0)<(S|0)&&(sa(z,Me),Js(Me,_[Ie>>2]|0,T,1,u+8+(_[u>>2]<<4)|0),_[u>>2]=(_[u>>2]|0)+1),y=y+1|0,(y|0)>=(W|0)){m=3;break}else l=_[Ie>>2]|0}if((m|0)==3){ue=Ge;return}else(m|0)==8&&zt(22606,22569,736,22651)}function ha(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0;T=ue,ue=ue+160|0,l=T+80|0,u=T,c=l,d=20368,y=c+72|0;do _[c>>2]=_[d>>2],c=c+4|0,d=d+4|0;while((c|0)<(y|0));c=u,d=20448,y=c+72|0;do _[c>>2]=_[d>>2],c=c+4|0,d=d+4|0;while((c|0)<(y|0));y=(vs(_[g>>2]|0)|0)==0,l=y?l:u,u=m+4|0,No(u),oa(u),vs(_[g>>2]|0)|0&&(Ys(u),_[g>>2]=(_[g>>2]|0)+1),_[b>>2]=_[m>>2],g=b+4|0,$n(u,l,g),Ki(g),_[b+16>>2]=_[m>>2],g=b+20|0,$n(u,l+12|0,g),Ki(g),_[b+32>>2]=_[m>>2],g=b+36|0,$n(u,l+24|0,g),Ki(g),_[b+48>>2]=_[m>>2],g=b+52|0,$n(u,l+36|0,g),Ki(g),_[b+64>>2]=_[m>>2],g=b+68|0,$n(u,l+48|0,g),Ki(g),_[b+80>>2]=_[m>>2],b=b+84|0,$n(u,l+60|0,b),Ki(b),ue=T}function lf(m,g){return m=m|0,g=g|0,g=_t(m|0,g|0,52)|0,me()|0,g&15|0}function fl(m,g){return m=m|0,g=g|0,g=_t(m|0,g|0,45)|0,me()|0,g&127|0}function ei(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0;if(!(!0&(g&-16777216|0)==134217728)||(d=_t(m|0,g|0,45)|0,me()|0,d=d&127,d>>>0>121))return g=0,g|0;b=_t(m|0,g|0,52)|0,me()|0,b=b&15;do if(b|0){for(u=1,l=0;;){if(c=_t(m|0,g|0,(15-u|0)*3|0)|0,me()|0,c=c&7,(c|0)!=0&(l^1))if((c|0)==1&(Wr(d)|0)!=0){y=0,l=13;break}else l=1;if((c|0)==7){y=0,l=13;break}if(u>>>0<b>>>0)u=u+1|0;else{l=9;break}}if((l|0)==9){if((b|0)==15)y=1;else break;return y|0}else if((l|0)==13)return y|0}while(!1);for(;;){if(y=_t(m|0,g|0,(14-b|0)*3|0)|0,me()|0,!((y&7|0)==7&!0)){y=0,l=13;break}if(b>>>0<14)b=b+1|0;else{y=1,l=13;break}}return(l|0)==13?y|0:0}function dl(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0;if(c=_t(m|0,g|0,52)|0,me()|0,c=c&15,b>>>0>15)return l=4,l|0;if((c|0)<(b|0))return l=12,l|0;if((c|0)==(b|0))return _[l>>2]=m,_[l+4>>2]=g,l=0,l|0;if(u=St(b|0,0,52)|0,u=u|m,m=me()|0|g&-15728641,(c|0)>(b|0))do g=St(7,0,(14-b|0)*3|0)|0,b=b+1|0,u=g|u,m=me()|0|m;while((b|0)<(c|0));return _[l>>2]=u,_[l+4>>2]=m,l=0,l|0}function qc(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0;if(c=_t(m|0,g|0,52)|0,me()|0,c=c&15,!((b|0)<16&(c|0)<=(b|0)))return l=4,l|0;u=b-c|0,b=_t(m|0,g|0,45)|0,me()|0;e:do if(!(Wr(b&127)|0))b=bt(7,0,u,((u|0)<0)<<31>>31)|0,u=me()|0;else{t:do if(c|0){for(b=1;d=St(7,0,(15-b|0)*3|0)|0,!!((d&m|0)==0&((me()|0)&g|0)==0);)if(b>>>0<c>>>0)b=b+1|0;else break t;b=bt(7,0,u,((u|0)<0)<<31>>31)|0,u=me()|0;break e}while(!1);b=bt(7,0,u,((u|0)<0)<<31>>31)|0,b=un(b|0,me()|0,5,0)|0,b=Cr(b|0,me()|0,-5,-1)|0,b=Ls(b|0,me()|0,6,0)|0,b=Cr(b|0,me()|0,1,0)|0,u=me()|0}while(!1);return d=l,_[d>>2]=b,_[d+4>>2]=u,d=0,d|0}function ti(m,g){m=m|0,g=g|0;var b=0,l=0,u=0;if(u=_t(m|0,g|0,45)|0,me()|0,!(Wr(u&127)|0))return u=0,u|0;u=_t(m|0,g|0,52)|0,me()|0,u=u&15;e:do if(!u)b=0;else for(l=1;;){if(b=_t(m|0,g|0,(15-l|0)*3|0)|0,me()|0,b=b&7,b|0)break e;if(l>>>0<u>>>0)l=l+1|0;else{b=0;break}}while(!1);return u=(b|0)==0&1,u|0}function cf(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0;if(d=ue,ue=ue+16|0,c=d,ec(c,m,g,b),g=c,m=_[g>>2]|0,g=_[g+4>>2]|0,(m|0)==0&(g|0)==0)return ue=d,0;u=0,b=0;do y=l+(u<<3)|0,_[y>>2]=m,_[y+4>>2]=g,u=Cr(u|0,b|0,1,0)|0,b=me()|0,Jc(c),y=c,m=_[y>>2]|0,g=_[y+4>>2]|0;while(!((m|0)==0&(g|0)==0));return ue=d,0}function yA(m,g,b,l){return m=m|0,g=g|0,b=b|0,l=l|0,(l|0)<(b|0)?(b=g,l=m,ir(b|0),l|0):(b=St(-1,-1,((l-b|0)*3|0)+3|0)|0,l=St(~b|0,~(me()|0)|0,(15-l|0)*3|0)|0,b=~(me()|0)&g,l=~l&m,ir(b|0),l|0)}function uf(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0;return u=_t(m|0,g|0,52)|0,me()|0,u=u&15,(b|0)<16&(u|0)<=(b|0)?((u|0)<(b|0)&&(u=St(-1,-1,((b+-1-u|0)*3|0)+3|0)|0,u=St(~u|0,~(me()|0)|0,(15-b|0)*3|0)|0,g=~(me()|0)&g,m=~u&m),u=St(b|0,0,52)|0,b=g&-15728641|(me()|0),_[l>>2]=m|u,_[l+4>>2]=b,l=0,l|0):(l=4,l|0)}function $c(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0,J=0,_e=0,Ee=0,Ie=0,Me=0;if((b|0)==0&(l|0)==0)return Ie=0,Ie|0;if(u=m,c=_[u>>2]|0,u=_[u+4>>2]|0,!0&(u&15728640|0)==0){if(!((l|0)>0|(l|0)==0&b>>>0>0)||(Ie=g,_[Ie>>2]=c,_[Ie+4>>2]=u,(b|0)==1&(l|0)==0))return Ie=0,Ie|0;u=1;do _e=m+(u<<3)|0,Ee=_[_e+4>>2]|0,Ie=g+(u<<3)|0,_[Ie>>2]=_[_e>>2],_[Ie+4>>2]=Ee,u=u+1|0;while(0<(l|0)|(l|0)==0&u>>>0<b>>>0);return u=0,u|0}if(J=b<<3,Ee=Rr(J)|0,!Ee)return Ie=13,Ie|0;if(ka(Ee|0,m|0,J|0)|0,_e=io(b,8)|0,!_e)return $t(Ee),Ie=13,Ie|0;e:do if(b|0){t:for(;;){u=Ee,Q=_[u>>2]|0,u=_[u+4>>2]|0,ie=_t(Q|0,u|0,52)|0,me()|0,ie=ie&15,K=ie+-1|0,te=(b|0)>0;r:do if((ie|0)!=0&te){if(j=((b|0)<0)<<31>>31,z=St(K|0,0,52)|0,W=me()|0,K>>>0>15){if(!((Q|0)==0&(u|0)==0)){Ie=17;break t}for(c=0;;){if(c=c+1|0,(c|0)>=(b|0))break r;if(l=Ee+(c<<3)|0,W=_[l>>2]|0,l=_[l+4>>2]|0,!((W|0)==0&(l|0)==0)){u=l,Ie=17;break t}}}for(c=0,m=Q,l=u;;){if(!((m|0)==0&(l|0)==0)){if(!(!0&(l&117440512|0)==0)){Ie=22;break t}if(y=_t(m|0,l|0,52)|0,me()|0,y=y&15,(y|0)<(K|0)){u=12,Ie=28;break t}if((y|0)!=(K|0)&&(m=m|z,l=l&-15728641|W,y>>>0>=ie>>>0)){d=K;do L=St(7,0,(14-d|0)*3|0)|0,d=d+1|0,m=L|m,l=me()|0|l;while(d>>>0<y>>>0)}if(d=_o(m|0,l|0,b|0,j|0)|0,me()|0,S=_e+(d<<3)|0,y=S,T=_[y>>2]|0,y=_[y+4>>2]|0,(T|0)==0&(y|0)==0)d=S;else for(L=0;;){if((L|0)>(b|0)){Ie=32;break t}if((T|0)==(m|0)&(y&-117440513|0)==(l|0)){M=_t(T|0,y|0,56)|0,me()|0,M=M&7,D=M+1|0,Me=_t(T|0,y|0,45)|0,me()|0;i:do if(!(Wr(Me&127)|0))y=7;else{if(T=_t(T|0,y|0,52)|0,me()|0,T=T&15,!T){y=6;break}for(y=1;;){if(Me=St(7,0,(15-y|0)*3|0)|0,!((Me&m|0)==0&((me()|0)&l|0)==0)){y=7;break i}if(y>>>0<T>>>0)y=y+1|0;else{y=6;break}}}while(!1);if((M+2|0)>>>0>y>>>0){Ie=42;break t}Me=St(D|0,0,56)|0,l=me()|0|l&-117440513,D=S,_[D>>2]=0,_[D+4>>2]=0,m=Me|m}else d=(d+1|0)%(b|0)|0;if(S=_e+(d<<3)|0,y=S,T=_[y>>2]|0,y=_[y+4>>2]|0,(T|0)==0&(y|0)==0){d=S;break}else L=L+1|0}Me=d,_[Me>>2]=m,_[Me+4>>2]=l}if(c=c+1|0,(c|0)>=(b|0))break r;l=Ee+(c<<3)|0,m=_[l>>2]|0,l=_[l+4>>2]|0}}while(!1);if((b+5|0)>>>0<11){Ie=85;break}if(W=io((b|0)/6|0,8)|0,!W){Ie=49;break}r:do if(te){L=0,D=0;do{if(y=_e+(L<<3)|0,l=y,c=_[l>>2]|0,l=_[l+4>>2]|0,!((c|0)==0&(l|0)==0)){T=_t(c|0,l|0,56)|0,me()|0,T=T&7,m=T+1|0,S=l&-117440513,Me=_t(c|0,l|0,45)|0,me()|0;i:do if(Wr(Me&127)|0){if(M=_t(c|0,l|0,52)|0,me()|0,M=M&15,M|0)for(d=1;;){if(Me=St(7,0,(15-d|0)*3|0)|0,!((c&Me|0)==0&(S&(me()|0)|0)==0))break i;if(d>>>0<M>>>0)d=d+1|0;else break}l=St(m|0,0,56)|0,c=l|c,l=me()|0|S,m=y,_[m>>2]=c,_[m+4>>2]=l,m=T+2|0}while(!1);(m|0)==7&&(Me=W+(D<<3)|0,_[Me>>2]=c,_[Me+4>>2]=l&-117440513,D=D+1|0)}L=L+1|0}while((L|0)!=(b|0));if(te){if(L=((b|0)<0)<<31>>31,j=St(K|0,0,52)|0,z=me()|0,K>>>0>15){if(!((Q|0)==0&(u|0)==0)){u=4,Ie=84;break t}for(u=0;;){if(u=u+1|0,(u|0)>=(b|0)){c=0,u=D;break r}if(Me=Ee+(u<<3)|0,!((_[Me>>2]|0)==0&(_[Me+4>>2]|0)==0)){u=4,Ie=84;break t}}}for(M=0,c=0,S=Q;;){do if(!((S|0)==0&(u|0)==0)){if(y=_t(S|0,u|0,52)|0,me()|0,y=y&15,(y|0)<(K|0)){u=12,Ie=84;break t}do if((y|0)==(K|0))l=S,y=u;else{if(l=S|j,m=u&-15728641|z,y>>>0<ie>>>0){y=m;break}d=K;do Me=St(7,0,(14-d|0)*3|0)|0,d=d+1|0,l=Me|l,m=me()|0|m;while(d>>>0<y>>>0);y=m}while(!1);for(d=_o(l|0,y|0,b|0,L|0)|0,me()|0,m=0;;){if((m|0)>(b|0)){Ie=77;break t}if(Me=_e+(d<<3)|0,T=_[Me+4>>2]|0,(T&-117440513|0)==(y|0)&&(_[Me>>2]|0)==(l|0)){Ie=79;break}if(d=(d+1|0)%(b|0)|0,Me=_e+(d<<3)|0,(_[Me>>2]|0)==(l|0)&&(_[Me+4>>2]|0)==(y|0))break;m=m+1|0}if((Ie|0)==79&&(Ie=0,!0&(T&117440512|0)==100663296))break;Me=g+(c<<3)|0,_[Me>>2]=S,_[Me+4>>2]=u,c=c+1|0}while(!1);if(u=M+1|0,(u|0)>=(b|0)){u=D;break r}Me=Ee+(u<<3)|0,M=u,S=_[Me>>2]|0,u=_[Me+4>>2]|0}}else c=0,u=D}else c=0,u=0;while(!1);if(hs(_e|0,0,J|0)|0,ka(Ee|0,W|0,u<<3|0)|0,$t(W),u)g=g+(c<<3)|0,b=u;else break e}if((Ie|0)==17)!0&(u&117440512|0)==0?(u=4,Ie=28):Ie=22;else if((Ie|0)==32)zt(23313,22674,362,22684);else{if((Ie|0)==42)return $t(Ee),$t(_e),Me=10,Me|0;if((Ie|0)==49)return $t(Ee),$t(_e),Me=13,Me|0;if((Ie|0)==77)zt(23313,22674,462,22684);else{if((Ie|0)==84)return $t(W),$t(Ee),$t(_e),Me=u,Me|0;if((Ie|0)==85){ka(g|0,Ee|0,b<<3|0)|0;break}}}if((Ie|0)==22)return $t(Ee),$t(_e),Me=5,Me|0;if((Ie|0)==28)return $t(Ee),$t(_e),Me=u,Me|0}while(!1);return $t(Ee),$t(_e),Me=0,Me|0}function Al(m,g,b,l,u,c,d){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0,c=c|0,d=d|0;var y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0;if(W=ue,ue=ue+16|0,z=W,!((b|0)>0|(b|0)==0&g>>>0>0))return z=0,ue=W,z|0;if((d|0)>=16)return z=12,ue=W,z|0;L=0,j=0,D=0,y=0;e:for(;;){if(S=m+(L<<3)|0,T=_[S>>2]|0,S=_[S+4>>2]|0,M=_t(T|0,S|0,52)|0,me()|0,(M&15|0)>(d|0)){y=12,T=11;break}if(ec(z,T,S,d),M=z,S=_[M>>2]|0,M=_[M+4>>2]|0,(S|0)==0&(M|0)==0)T=D;else{T=D;do{if(!((y|0)<(c|0)|(y|0)==(c|0)&T>>>0<u>>>0)){T=10;break e}D=l+(T<<3)|0,_[D>>2]=S,_[D+4>>2]=M,T=Cr(T|0,y|0,1,0)|0,y=me()|0,Jc(z),D=z,S=_[D>>2]|0,M=_[D+4>>2]|0}while(!((S|0)==0&(M|0)==0))}if(L=Cr(L|0,j|0,1,0)|0,j=me()|0,(j|0)<(b|0)|(j|0)==(b|0)&L>>>0<g>>>0)D=T;else{y=0,T=11;break}}return(T|0)==10?(z=14,ue=W,z|0):(T|0)==11?(ue=W,y|0):0}function Jl(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0;L=ue,ue=ue+16|0,D=L;e:do if((b|0)>0|(b|0)==0&g>>>0>0){for(S=0,d=0,c=0,M=0;;){if(T=m+(S<<3)|0,y=_[T>>2]|0,T=_[T+4>>2]|0,!((y|0)==0&(T|0)==0)&&(T=(qc(y,T,l,D)|0)==0,y=D,d=Cr(_[y>>2]|0,_[y+4>>2]|0,d|0,c|0)|0,c=me()|0,!T)){c=12;break}if(S=Cr(S|0,M|0,1,0)|0,M=me()|0,!((M|0)<(b|0)|(M|0)==(b|0)&S>>>0<g>>>0))break e}return ue=L,c|0}else d=0,c=0;while(!1);return _[u>>2]=d,_[u+4>>2]=c,u=0,ue=L,u|0}function Zc(m,g){return m=m|0,g=g|0,g=_t(m|0,g|0,52)|0,me()|0,g&1|0}function yn(m,g){m=m|0,g=g|0;var b=0,l=0,u=0;if(u=_t(m|0,g|0,52)|0,me()|0,u=u&15,!u)return u=0,u|0;for(l=1;;){if(b=_t(m|0,g|0,(15-l|0)*3|0)|0,me()|0,b=b&7,b|0){l=5;break}if(l>>>0<u>>>0)l=l+1|0;else{b=0,l=5;break}}return(l|0)==5?b|0:0}function fa(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0,T=0;if(T=_t(m|0,g|0,52)|0,me()|0,T=T&15,!T)return y=g,T=m,ir(y|0),T|0;for(y=1,b=0;;){c=(15-y|0)*3|0,l=St(7,0,c|0)|0,u=me()|0,d=_t(m|0,g|0,c|0)|0,me()|0,c=St(ko(d&7)|0,0,c|0)|0,d=me()|0,m=c|m&~l,g=d|g&~u;e:do if(!b)if((c&l|0)==0&(d&u|0)==0)b=0;else if(l=_t(m|0,g|0,52)|0,me()|0,l=l&15,!l)b=1;else{b=1;t:for(;;){switch(d=_t(m|0,g|0,(15-b|0)*3|0)|0,me()|0,d&7){case 1:break t;case 0:break;default:{b=1;break e}}if(b>>>0<l>>>0)b=b+1|0;else{b=1;break e}}for(b=1;;)if(d=(15-b|0)*3|0,u=_t(m|0,g|0,d|0)|0,me()|0,c=St(7,0,d|0)|0,g=g&~(me()|0),d=St(ko(u&7)|0,0,d|0)|0,m=m&~c|d,g=g|(me()|0),b>>>0<l>>>0)b=b+1|0;else{b=1;break}}while(!1);if(y>>>0<T>>>0)y=y+1|0;else break}return ir(g|0),m|0}function da(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0;if(l=_t(m|0,g|0,52)|0,me()|0,l=l&15,!l)return b=g,l=m,ir(b|0),l|0;for(b=1;c=(15-b|0)*3|0,d=_t(m|0,g|0,c|0)|0,me()|0,u=St(7,0,c|0)|0,g=g&~(me()|0),c=St(ko(d&7)|0,0,c|0)|0,m=c|m&~u,g=me()|0|g,b>>>0<l>>>0;)b=b+1|0;return ir(g|0),m|0}function pl(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0,T=0;if(T=_t(m|0,g|0,52)|0,me()|0,T=T&15,!T)return y=g,T=m,ir(y|0),T|0;for(y=1,b=0;;){c=(15-y|0)*3|0,l=St(7,0,c|0)|0,u=me()|0,d=_t(m|0,g|0,c|0)|0,me()|0,c=St(Zn(d&7)|0,0,c|0)|0,d=me()|0,m=c|m&~l,g=d|g&~u;e:do if(!b)if((c&l|0)==0&(d&u|0)==0)b=0;else if(l=_t(m|0,g|0,52)|0,me()|0,l=l&15,!l)b=1;else{b=1;t:for(;;){switch(d=_t(m|0,g|0,(15-b|0)*3|0)|0,me()|0,d&7){case 1:break t;case 0:break;default:{b=1;break e}}if(b>>>0<l>>>0)b=b+1|0;else{b=1;break e}}for(b=1;;)if(u=(15-b|0)*3|0,c=St(7,0,u|0)|0,d=g&~(me()|0),g=_t(m|0,g|0,u|0)|0,me()|0,g=St(Zn(g&7)|0,0,u|0)|0,m=m&~c|g,g=d|(me()|0),b>>>0<l>>>0)b=b+1|0;else{b=1;break}}while(!1);if(y>>>0<T>>>0)y=y+1|0;else break}return ir(g|0),m|0}function ys(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0;if(l=_t(m|0,g|0,52)|0,me()|0,l=l&15,!l)return b=g,l=m,ir(b|0),l|0;for(b=1;d=(15-b|0)*3|0,c=St(7,0,d|0)|0,u=g&~(me()|0),g=_t(m|0,g|0,d|0)|0,me()|0,g=St(Zn(g&7)|0,0,d|0)|0,m=g|m&~c,g=me()|0|u,b>>>0<l>>>0;)b=b+1|0;return ir(g|0),m|0}function hf(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0;if(T=ue,ue=ue+64|0,y=T+40|0,l=T+24|0,u=T+12|0,c=T,St(g|0,0,52)|0,b=me()|0|134225919,!g)return(_[m+4>>2]|0)>2||(_[m+8>>2]|0)>2||(_[m+12>>2]|0)>2?(d=0,y=0,ir(d|0),ue=T,y|0):(St(Gu(m)|0,0,45)|0,d=me()|0|b,y=-1,ir(d|0),ue=T,y|0);if(_[y>>2]=_[m>>2],_[y+4>>2]=_[m+4>>2],_[y+8>>2]=_[m+8>>2],_[y+12>>2]=_[m+12>>2],d=y+4|0,(g|0)>0)for(m=-1;_[l>>2]=_[d>>2],_[l+4>>2]=_[d+4>>2],_[l+8>>2]=_[d+8>>2],g&1?(Qh(d),_[u>>2]=_[d>>2],_[u+4>>2]=_[d+4>>2],_[u+8>>2]=_[d+8>>2],Hc(u)):(Ku(d),_[u>>2]=_[d>>2],_[u+4>>2]=_[d+4>>2],_[u+8>>2]=_[d+8>>2],Ys(u)),qu(l,u,c),Ki(c),M=(15-g|0)*3|0,S=St(7,0,M|0)|0,b=b&~(me()|0),M=St(ul(c)|0,0,M|0)|0,m=M|m&~S,b=me()|0|b,(g|0)>1;)g=g+-1|0;else m=-1;e:do if((_[d>>2]|0)<=2&&(_[y+8>>2]|0)<=2&&(_[y+12>>2]|0)<=2){if(l=Gu(y)|0,g=St(l|0,0,45)|0,g=g|m,m=me()|0|b&-1040385,c=ll(y)|0,!(Wr(l)|0)){if((c|0)<=0)break;for(u=0;;){if(l=_t(g|0,m|0,52)|0,me()|0,l=l&15,l)for(b=1;M=(15-b|0)*3|0,y=_t(g|0,m|0,M|0)|0,me()|0,S=St(7,0,M|0)|0,m=m&~(me()|0),M=St(ko(y&7)|0,0,M|0)|0,g=g&~S|M,m=m|(me()|0),b>>>0<l>>>0;)b=b+1|0;if(u=u+1|0,(u|0)==(c|0))break e}}u=_t(g|0,m|0,52)|0,me()|0,u=u&15;t:do if(u){b=1;r:for(;;){switch(M=_t(g|0,m|0,(15-b|0)*3|0)|0,me()|0,M&7){case 1:break r;case 0:break;default:break t}if(b>>>0<u>>>0)b=b+1|0;else break t}if(Xu(l,_[y>>2]|0)|0)for(b=1;y=(15-b|0)*3|0,S=St(7,0,y|0)|0,M=m&~(me()|0),m=_t(g|0,m|0,y|0)|0,me()|0,m=St(Zn(m&7)|0,0,y|0)|0,g=g&~S|m,m=M|(me()|0),b>>>0<u>>>0;)b=b+1|0;else for(b=1;M=(15-b|0)*3|0,y=_t(g|0,m|0,M|0)|0,me()|0,S=St(7,0,M|0)|0,m=m&~(me()|0),M=St(ko(y&7)|0,0,M|0)|0,g=g&~S|M,m=m|(me()|0),b>>>0<u>>>0;)b=b+1|0}while(!1);if((c|0)>0){b=0;do g=fa(g,m)|0,m=me()|0,b=b+1|0;while((b|0)!=(c|0))}}else g=0,m=0;while(!1);return S=m,M=g,ir(S|0),ue=T,M|0}function vs(m){return m=m|0,(m|0)%2|0|0}function Ju(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0;return u=ue,ue=ue+16|0,l=u,g>>>0>15?(l=4,ue=u,l|0):(_[m+4>>2]&2146435072|0)==2146435072||(_[m+8+4>>2]&2146435072|0)==2146435072?(l=3,ue=u,l|0):(sf(m,g,l),g=hf(l,g)|0,l=me()|0,_[b>>2]=g,_[b+4>>2]=l,(g|0)==0&(l|0)==0&&zt(23313,22674,786,22697),l=0,ue=u,l|0)}function Vo(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0;if(u=b+4|0,c=_t(m|0,g|0,52)|0,me()|0,c=c&15,d=_t(m|0,g|0,45)|0,me()|0,l=(c|0)==0,Wr(d&127)|0){if(l)return d=1,d|0;l=1}else{if(l)return d=0,d|0;!(_[u>>2]|0)&&!(_[b+8>>2]|0)?l=(_[b+12>>2]|0)!=0&1:l=1}for(b=1;b&1?Hc(u):Ys(u),d=_t(m|0,g|0,(15-b|0)*3|0)|0,me()|0,hl(u,d&7),b>>>0<c>>>0;)b=b+1|0;return l|0}function fo(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0;if(M=ue,ue=ue+16|0,T=M,S=_t(m|0,g|0,45)|0,me()|0,S=S&127,S>>>0>121)return _[b>>2]=0,_[b+4>>2]=0,_[b+8>>2]=0,_[b+12>>2]=0,S=5,ue=M,S|0;e:do if(Wr(S)|0&&(c=_t(m|0,g|0,52)|0,me()|0,c=c&15,(c|0)!=0)){l=1;t:for(;;){switch(y=_t(m|0,g|0,(15-l|0)*3|0)|0,me()|0,y&7){case 5:break t;case 0:break;default:{l=g;break e}}if(l>>>0<c>>>0)l=l+1|0;else{l=g;break e}}for(u=1,l=g;g=(15-u|0)*3|0,d=St(7,0,g|0)|0,y=l&~(me()|0),l=_t(m|0,l|0,g|0)|0,me()|0,l=St(Zn(l&7)|0,0,g|0)|0,m=m&~d|l,l=y|(me()|0),u>>>0<c>>>0;)u=u+1|0}else l=g;while(!1);if(y=7696+(S*28|0)|0,_[b>>2]=_[y>>2],_[b+4>>2]=_[y+4>>2],_[b+8>>2]=_[y+8>>2],_[b+12>>2]=_[y+12>>2],!(Vo(m,l,b)|0))return S=0,ue=M,S|0;if(d=b+4|0,_[T>>2]=_[d>>2],_[T+4>>2]=_[d+4>>2],_[T+8>>2]=_[d+8>>2],c=_t(m|0,l|0,52)|0,me()|0,y=c&15,c&1?(Ys(d),c=y+1|0):c=y,!(Wr(S)|0))l=0;else{e:do if(!y)l=0;else for(g=1;;){if(u=_t(m|0,l|0,(15-g|0)*3|0)|0,me()|0,u=u&7,u|0){l=u;break e}if(g>>>0<y>>>0)g=g+1|0;else{l=0;break}}while(!1);l=(l|0)==4&1}if(!(Bs(b,c,l,0)|0))(c|0)!=(y|0)&&(_[d>>2]=_[T>>2],_[d+4>>2]=_[T+4>>2],_[d+8>>2]=_[T+8>>2]);else{if(Wr(S)|0)do;while(Bs(b,c,0,0)|0);(c|0)!=(y|0)&&Ku(d)}return S=0,ue=M,S|0}function Aa(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0;return c=ue,ue=ue+16|0,l=c,u=fo(m,g,l)|0,u|0?(ue=c,u|0):(u=_t(m|0,g|0,52)|0,me()|0,of(l,u&15,b),u=0,ue=c,u|0)}function Oa(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0;if(d=ue,ue=ue+16|0,c=d,l=fo(m,g,c)|0,l|0)return c=l,ue=d,c|0;l=_t(m|0,g|0,45)|0,me()|0,l=(Wr(l&127)|0)==0,u=_t(m|0,g|0,52)|0,me()|0,u=u&15;e:do if(!l){if(u|0)for(l=1;;){if(y=St(7,0,(15-l|0)*3|0)|0,!((y&m|0)==0&((me()|0)&g|0)==0))break e;if(l>>>0<u>>>0)l=l+1|0;else break}return Wc(c,u,0,5,b),y=0,ue=d,y|0}while(!1);return zo(c,u,0,6,b),y=0,ue=d,y|0}function Kc(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0;if(u=_t(m|0,g|0,45)|0,me()|0,!(Wr(u&127)|0))return u=2,_[b>>2]=u,0;if(u=_t(m|0,g|0,52)|0,me()|0,u=u&15,!u)return u=5,_[b>>2]=u,0;for(l=1;;){if(c=St(7,0,(15-l|0)*3|0)|0,!((c&m|0)==0&((me()|0)&g|0)==0)){l=2,m=6;break}if(l>>>0<u>>>0)l=l+1|0;else{l=5,m=6;break}}return(m|0)==6&&(_[b>>2]=l),0}function ff(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0;D=ue,ue=ue+128|0,S=D+112|0,c=D+96|0,M=D,u=_t(m|0,g|0,52)|0,me()|0,y=u&15,_[S>>2]=y,d=_t(m|0,g|0,45)|0,me()|0,d=d&127;e:do if(Wr(d)|0){if(y|0)for(l=1;;){if(T=St(7,0,(15-l|0)*3|0)|0,!((T&m|0)==0&((me()|0)&g|0)==0)){u=0;break e}if(l>>>0<y>>>0)l=l+1|0;else break}if(u&1)u=1;else return T=St(y+1|0,0,52)|0,M=me()|0|g&-15728641,S=St(7,0,(14-y|0)*3|0)|0,M=ff((T|m)&~S,M&~(me()|0),b)|0,ue=D,M|0}else u=0;while(!1);if(l=fo(m,g,c)|0,!l){u?(Xc(c,S,M),T=5):(ha(c,S,M),T=6);e:do if(Wr(d)|0)if(!y)m=5;else for(l=1;;){if(d=St(7,0,(15-l|0)*3|0)|0,!((d&m|0)==0&((me()|0)&g|0)==0)){m=2;break e}if(l>>>0<y>>>0)l=l+1|0;else{m=5;break}}else m=2;while(!1);hs(b|0,-1,m<<2|0)|0;e:do if(u)for(c=0;;){if(d=M+(c<<4)|0,af(d,_[S>>2]|0)|0,d=_[d>>2]|0,y=_[b>>2]|0,(y|0)==-1|(y|0)==(d|0))l=b;else{u=0;do{if(u=u+1|0,u>>>0>=m>>>0){l=1;break e}l=b+(u<<2)|0,y=_[l>>2]|0}while(!((y|0)==-1|(y|0)==(d|0)))}if(_[l>>2]=d,c=c+1|0,c>>>0>=T>>>0){l=0;break}}else for(c=0;;){if(d=M+(c<<4)|0,Bs(d,_[S>>2]|0,0,1)|0,d=_[d>>2]|0,y=_[b>>2]|0,(y|0)==-1|(y|0)==(d|0))l=b;else{u=0;do{if(u=u+1|0,u>>>0>=m>>>0){l=1;break e}l=b+(u<<2)|0,y=_[l>>2]|0}while(!((y|0)==-1|(y|0)==(d|0)))}if(_[l>>2]=d,c=c+1|0,c>>>0>=T>>>0){l=0;break}}while(!1)}return M=l,ue=D,M|0}function Yc(){return 12}function Ql(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0,T=0;if(m>>>0>15)return y=4,y|0;if(St(m|0,0,52)|0,y=me()|0|134225919,!m){b=0,l=0;do Wr(l)|0&&(St(l|0,0,45)|0,d=y|(me()|0),m=g+(b<<3)|0,_[m>>2]=-1,_[m+4>>2]=d,b=b+1|0),l=l+1|0;while((l|0)!=122);return b=0,b|0}b=0,d=0;do{if(Wr(d)|0){for(St(d|0,0,45)|0,l=1,u=-1,c=y|(me()|0);T=St(7,0,(15-l|0)*3|0)|0,u=u&~T,c=c&~(me()|0),(l|0)!=(m|0);)l=l+1|0;T=g+(b<<3)|0,_[T>>2]=u,_[T+4>>2]=c,b=b+1|0}d=d+1|0}while((d|0)!=122);return b=0,b|0}function df(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0;if(ie=ue,ue=ue+16|0,te=ie,Q=_t(m|0,g|0,52)|0,me()|0,Q=Q&15,b>>>0>15)return Q=4,ue=ie,Q|0;if((Q|0)<(b|0))return Q=12,ue=ie,Q|0;if((Q|0)!=(b|0))if(c=St(b|0,0,52)|0,c=c|m,y=me()|0|g&-15728641,(Q|0)>(b|0)){T=b;do W=St(7,0,(14-T|0)*3|0)|0,T=T+1|0,c=W|c,y=me()|0|y;while((T|0)<(Q|0));W=c}else W=c;else W=m,y=g;z=_t(W|0,y|0,45)|0,me()|0;e:do if(Wr(z&127)|0){if(T=_t(W|0,y|0,52)|0,me()|0,T=T&15,T|0)for(c=1;;){if(z=St(7,0,(15-c|0)*3|0)|0,!((z&W|0)==0&((me()|0)&y|0)==0)){S=33;break e}if(c>>>0<T>>>0)c=c+1|0;else break}if(z=l,_[z>>2]=0,_[z+4>>2]=0,(Q|0)>(b|0)){for(z=g&-15728641,j=Q;;){if(L=j,j=j+-1|0,j>>>0>15|(Q|0)<(j|0)){S=19;break}if((Q|0)!=(j|0))if(c=St(j|0,0,52)|0,c=c|m,T=me()|0|z,(Q|0)<(L|0))D=c;else{S=j;do D=St(7,0,(14-S|0)*3|0)|0,S=S+1|0,c=D|c,T=me()|0|T;while((S|0)<(Q|0));D=c}else D=m,T=g;if(M=_t(D|0,T|0,45)|0,me()|0,!(Wr(M&127)|0))c=0;else{M=_t(D|0,T|0,52)|0,me()|0,M=M&15;t:do if(!M)c=0;else for(S=1;;){if(c=_t(D|0,T|0,(15-S|0)*3|0)|0,me()|0,c=c&7,c|0)break t;if(S>>>0<M>>>0)S=S+1|0;else{c=0;break}}while(!1);c=(c|0)==0&1}if(T=_t(m|0,g|0,(15-L|0)*3|0)|0,me()|0,T=T&7,(T|0)==7){u=5,S=42;break}if(c=(c|0)!=0,(T|0)==1&c){u=5,S=42;break}if(D=T+(((T|0)!=0&c)<<31>>31)|0,D|0&&(S=Q-L|0,S=bt(7,0,S,((S|0)<0)<<31>>31)|0,M=me()|0,c?(c=un(S|0,M|0,5,0)|0,c=Cr(c|0,me()|0,-5,-1)|0,c=Ls(c|0,me()|0,6,0)|0,c=Cr(c|0,me()|0,1,0)|0,T=me()|0):(c=S,T=M),L=D+-1|0,L=un(S|0,M|0,L|0,((L|0)<0)<<31>>31|0)|0,L=Cr(c|0,T|0,L|0,me()|0)|0,D=me()|0,M=l,M=Cr(L|0,D|0,_[M>>2]|0,_[M+4>>2]|0)|0,D=me()|0,L=l,_[L>>2]=M,_[L+4>>2]=D),(j|0)<=(b|0)){S=37;break}}if((S|0)==19)zt(23313,22674,1099,22710);else if((S|0)==37){d=l,u=_[d+4>>2]|0,d=_[d>>2]|0;break}else if((S|0)==42)return ue=ie,u|0}else u=0,d=0}else S=33;while(!1);e:do if((S|0)==33)if(z=l,_[z>>2]=0,_[z+4>>2]=0,(Q|0)>(b|0)){for(c=Q;;){if(u=_t(m|0,g|0,(15-c|0)*3|0)|0,me()|0,u=u&7,(u|0)==7){u=5;break}if(d=Q-c|0,d=bt(7,0,d,((d|0)<0)<<31>>31)|0,u=un(d|0,me()|0,u|0,0)|0,d=me()|0,z=l,d=Cr(_[z>>2]|0,_[z+4>>2]|0,u|0,d|0)|0,u=me()|0,z=l,_[z>>2]=d,_[z+4>>2]=u,c=c+-1|0,(c|0)<=(b|0))break e}return ue=ie,u|0}else u=0,d=0;while(!1);return qc(W,y,Q,te)|0&&zt(23313,22674,1063,22725),Q=te,te=_[Q+4>>2]|0,((u|0)>-1|(u|0)==-1&d>>>0>4294967295)&((te|0)>(u|0)|((te|0)==(u|0)?(_[Q>>2]|0)>>>0>d>>>0:0))?(Q=0,ue=ie,Q|0):(zt(23313,22674,1139,22710),0)}function Af(m,g,b,l,u,c){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0,c=c|0;var d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0;if(D=ue,ue=ue+16|0,d=D,u>>>0>15)return c=4,ue=D,c|0;if(y=_t(b|0,l|0,52)|0,me()|0,y=y&15,(y|0)>(u|0))return c=12,ue=D,c|0;if(qc(b,l,u,d)|0&&zt(23313,22674,1063,22725),M=d,S=_[M+4>>2]|0,!(((g|0)>-1|(g|0)==-1&m>>>0>4294967295)&((S|0)>(g|0)|((S|0)==(g|0)?(_[M>>2]|0)>>>0>m>>>0:0))))return c=2,ue=D,c|0;M=u-y|0,u=St(u|0,0,52)|0,T=me()|0|l&-15728641,S=c,_[S>>2]=u|b,_[S+4>>2]=T,S=_t(b|0,l|0,45)|0,me()|0;e:do if(Wr(S&127)|0){if(y|0)for(d=1;;){if(S=St(7,0,(15-d|0)*3|0)|0,!((S&b|0)==0&((me()|0)&l|0)==0))break e;if(d>>>0<y>>>0)d=d+1|0;else break}if((M|0)<1)return c=0,ue=D,c|0;for(S=y^15,l=-1,T=1,d=1;;){y=M-T|0,y=bt(7,0,y,((y|0)<0)<<31>>31)|0,b=me()|0;do if(d)if(d=un(y|0,b|0,5,0)|0,d=Cr(d|0,me()|0,-5,-1)|0,d=Ls(d|0,me()|0,6,0)|0,u=me()|0,(g|0)>(u|0)|(g|0)==(u|0)&m>>>0>d>>>0){g=Cr(m|0,g|0,-1,-1)|0,g=xn(g|0,me()|0,d|0,u|0)|0,d=me()|0,L=c,z=_[L>>2]|0,L=_[L+4>>2]|0,W=(S+l|0)*3|0,j=St(7,0,W|0)|0,L=L&~(me()|0),l=Ls(g|0,d|0,y|0,b|0)|0,m=me()|0,u=Cr(l|0,m|0,2,0)|0,W=St(u|0,me()|0,W|0)|0,L=me()|0|L,u=c,_[u>>2]=W|z&~j,_[u+4>>2]=L,m=un(l|0,m|0,y|0,b|0)|0,m=xn(g|0,d|0,m|0,me()|0)|0,d=0,g=me()|0;break}else{W=c,j=_[W>>2]|0,W=_[W+4>>2]|0,z=St(7,0,(S+l|0)*3|0)|0,W=W&~(me()|0),d=c,_[d>>2]=j&~z,_[d+4>>2]=W,d=1;break}else j=c,u=_[j>>2]|0,j=_[j+4>>2]|0,l=(S+l|0)*3|0,L=St(7,0,l|0)|0,j=j&~(me()|0),W=Ls(m|0,g|0,y|0,b|0)|0,d=me()|0,l=St(W|0,d|0,l|0)|0,j=me()|0|j,z=c,_[z>>2]=l|u&~L,_[z+4>>2]=j,d=un(W|0,d|0,y|0,b|0)|0,m=xn(m|0,g|0,d|0,me()|0)|0,d=0,g=me()|0;while(!1);if((M|0)>(T|0))l=~T,T=T+1|0;else{g=0;break}}return ue=D,g|0}while(!1);if((M|0)<1)return W=0,ue=D,W|0;for(u=y^15,d=1;;)if(z=M-d|0,z=bt(7,0,z,((z|0)<0)<<31>>31)|0,W=me()|0,T=c,b=_[T>>2]|0,T=_[T+4>>2]|0,y=(u-d|0)*3|0,l=St(7,0,y|0)|0,T=T&~(me()|0),L=Ls(m|0,g|0,z|0,W|0)|0,j=me()|0,y=St(L|0,j|0,y|0)|0,T=me()|0|T,S=c,_[S>>2]=y|b&~l,_[S+4>>2]=T,W=un(L|0,j|0,z|0,W|0)|0,m=xn(m|0,g|0,W|0,me()|0)|0,g=me()|0,(M|0)<=(d|0)){g=0;break}else d=d+1|0;return ue=D,g|0}function ec(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0;u=_t(g|0,b|0,52)|0,me()|0,u=u&15,(g|0)==0&(b|0)==0|((l|0)>15|(u|0)>(l|0))?(l=-1,u=-1,g=0,b=0):(c=yA(g,b,u+1|0,l)|0,b=(me()|0)&-15728641,g=St(l|0,0,52)|0,g=c|g,b=b|(me()|0),c=(ti(g,b)|0)==0,l=c?-1:l),c=m,_[c>>2]=g,_[c+4>>2]=b,_[m+8>>2]=u,_[m+12>>2]=l}function Jc(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0,T=0,S=0;if(b=m,g=_[b>>2]|0,b=_[b+4>>2]|0,!((g|0)==0&(b|0)==0)&&(l=_t(g|0,b|0,52)|0,me()|0,l=l&15,y=St(1,0,(l^15)*3|0)|0,g=Cr(y|0,me()|0,g|0,b|0)|0,b=me()|0,y=m,_[y>>2]=g,_[y+4>>2]=b,y=m+8|0,d=_[y>>2]|0,!((l|0)<(d|0)))){for(T=m+12|0,c=l;;){if((c|0)==(d|0)){l=5;break}if(S=(c|0)==(_[T>>2]|0),u=(15-c|0)*3|0,l=_t(g|0,b|0,u|0)|0,me()|0,l=l&7,S&((l|0)==1&!0)){l=7;break}if(!((l|0)==7&!0)){l=10;break}if(S=St(1,0,u|0)|0,g=Cr(g|0,b|0,S|0,me()|0)|0,b=me()|0,S=m,_[S>>2]=g,_[S+4>>2]=b,(c|0)>(d|0))c=c+-1|0;else{l=10;break}}if((l|0)==5){S=m,_[S>>2]=0,_[S+4>>2]=0,_[y>>2]=-1,_[T>>2]=-1;return}else if((l|0)==7){d=St(1,0,u|0)|0,d=Cr(g|0,b|0,d|0,me()|0)|0,y=me()|0,S=m,_[S>>2]=d,_[S+4>>2]=y,_[T>>2]=c+-1;return}else if((l|0)==10)return}}function Da(m){m=+m;var g=0;return g=m<0?m+6.283185307179586:m,+(m>=6.283185307179586?g+-6.283185307179586:g)}function pa(m,g){return m=m|0,g=g|0,+nt(+(+ne[m>>3]-+ne[g>>3]))<17453292519943298e-27?(g=+nt(+(+ne[m+8>>3]-+ne[g+8>>3]))<17453292519943298e-27,g|0):(g=0,g|0)}function tc(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0;return u=+ne[g>>3],l=+ne[m>>3],c=+It(+((u-l)*.5)),b=+It(+((+ne[g+8>>3]-+ne[m+8>>3])*.5)),b=c*c+b*(+ct(+u)*+ct(+l)*b),+(+Yr(+ +at(+b),+ +at(+(1-b)))*2)}function gl(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0;return u=+ne[g>>3],l=+ne[m>>3],c=+It(+((u-l)*.5)),b=+It(+((+ne[g+8>>3]-+ne[m+8>>3])*.5)),b=c*c+b*(+ct(+u)*+ct(+l)*b),+(+Yr(+ +at(+b),+ +at(+(1-b)))*2*6371.007180918475)}function Fa(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0;return u=+ne[g>>3],l=+ne[m>>3],c=+It(+((u-l)*.5)),b=+It(+((+ne[g+8>>3]-+ne[m+8>>3])*.5)),b=c*c+b*(+ct(+u)*+ct(+l)*b),+(+Yr(+ +at(+b),+ +at(+(1-b)))*2*6371.007180918475*1e3)}function Ai(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0;return c=+ne[g>>3],l=+ct(+c),u=+ne[g+8>>3]-+ne[m+8>>3],d=l*+It(+u),b=+ne[m>>3],+ +Yr(+d,+(+It(+c)*+ct(+b)-+ct(+u)*(l*+It(+b))))}function Qc(m,g,b,l){m=m|0,g=+g,b=+b,l=l|0;var u=0,c=0,d=0,y=0;if(b<1e-16){_[l>>2]=_[m>>2],_[l+4>>2]=_[m+4>>2],_[l+8>>2]=_[m+8>>2],_[l+12>>2]=_[m+12>>2];return}c=g<0?g+6.283185307179586:g,c=g>=6.283185307179586?c+-6.283185307179586:c;do if(c<1e-16)g=+ne[m>>3]+b,ne[l>>3]=g,u=l;else{if(u=+nt(+(c+-3.141592653589793))<1e-16,g=+ne[m>>3],u){g=g-b,ne[l>>3]=g,u=l;break}if(d=+ct(+b),b=+It(+b),g=d*+It(+g)+ +ct(+c)*(b*+ct(+g)),g=g>1?1:g,g=+Lr(+(g<-1?-1:g)),ne[l>>3]=g,+nt(+(g+-1.5707963267948966))<1e-16){ne[l>>3]=1.5707963267948966,ne[l+8>>3]=0;return}if(+nt(+(g+1.5707963267948966))<1e-16){ne[l>>3]=-1.5707963267948966,ne[l+8>>3]=0;return}if(y=+ct(+g),c=b*+It(+c)/y,b=+ne[m>>3],g=(d-+It(+g)*+It(+b))/+ct(+b)/y,d=c>1?1:c,g=g>1?1:g,g=+ne[m+8>>3]+ +Yr(+(d<-1?-1:d),+(g<-1?-1:g)),g>3.141592653589793)do g=g+-6.283185307179586;while(g>3.141592653589793);if(g<-3.141592653589793)do g=g+6.283185307179586;while(g<-3.141592653589793);ne[l+8>>3]=g;return}while(!1);if(+nt(+(g+-1.5707963267948966))<1e-16){ne[u>>3]=1.5707963267948966,ne[l+8>>3]=0;return}if(+nt(+(g+1.5707963267948966))<1e-16){ne[u>>3]=-1.5707963267948966,ne[l+8>>3]=0;return}if(g=+ne[m+8>>3],g>3.141592653589793)do g=g+-6.283185307179586;while(g>3.141592653589793);if(g<-3.141592653589793)do g=g+6.283185307179586;while(g<-3.141592653589793);ne[l+8>>3]=g}function La(m,g){return m=m|0,g=g|0,m>>>0>15?(g=4,g|0):(ne[g>>3]=+ne[20528+(m<<3)>>3],g=0,g|0)}function ga(m,g){return m=m|0,g=g|0,m>>>0>15?(g=4,g|0):(ne[g>>3]=+ne[20656+(m<<3)>>3],g=0,g|0)}function kr(m,g){return m=m|0,g=g|0,m>>>0>15?(g=4,g|0):(ne[g>>3]=+ne[20784+(m<<3)>>3],g=0,g|0)}function li(m,g){return m=m|0,g=g|0,m>>>0>15?(g=4,g|0):(ne[g>>3]=+ne[20912+(m<<3)>>3],g=0,g|0)}function Kn(m,g){m=m|0,g=g|0;var b=0;return m>>>0>15?(g=4,g|0):(b=bt(7,0,m,((m|0)<0)<<31>>31)|0,b=un(b|0,me()|0,120,0)|0,m=me()|0,_[g>>2]=b|2,_[g+4>>2]=m,g=0,g|0)}function ml(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0;return L=+ne[g>>3],M=+ne[m>>3],T=+It(+((L-M)*.5)),c=+ne[g+8>>3],S=+ne[m+8>>3],d=+It(+((c-S)*.5)),y=+ct(+M),D=+ct(+L),d=T*T+d*(D*y*d),d=+Yr(+ +at(+d),+ +at(+(1-d)))*2,T=+ne[b>>3],L=+It(+((T-L)*.5)),l=+ne[b+8>>3],c=+It(+((l-c)*.5)),u=+ct(+T),c=L*L+c*(D*u*c),c=+Yr(+ +at(+c),+ +at(+(1-c)))*2,T=+It(+((M-T)*.5)),l=+It(+((S-l)*.5)),l=T*T+l*(y*u*l),l=+Yr(+ +at(+l),+ +at(+(1-l)))*2,u=(d+c+l)*.5,+(+ur(+ +at(+(+Ir(+(u*.5))*+Ir(+((u-d)*.5))*+Ir(+((u-c)*.5))*+Ir(+((u-l)*.5)))))*4)}function ma(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0;if(y=ue,ue=ue+192|0,c=y+168|0,d=y,u=Aa(m,g,c)|0,u|0)return b=u,ue=y,b|0;if(Oa(m,g,d)|0&&zt(23313,22742,386,22751),g=_[d>>2]|0,(g|0)>0){if(l=+ml(d+8|0,d+8+(((g|0)!=1&1)<<4)|0,c)+0,(g|0)!=1){m=1;do u=m,m=m+1|0,l=l+ +ml(d+8+(u<<4)|0,d+8+(((m|0)%(g|0)|0)<<4)|0,c);while((m|0)<(g|0))}}else l=0;return ne[b>>3]=l,b=0,ue=y,b|0}function rc(m,g,b){return m=m|0,g=g|0,b=b|0,m=ma(m,g,b)|0,m|0||(ne[b>>3]=+ne[b>>3]*6371.007180918475*6371.007180918475),m|0}function vA(m,g,b){return m=m|0,g=g|0,b=b|0,m=ma(m,g,b)|0,m|0||(ne[b>>3]=+ne[b>>3]*6371.007180918475*6371.007180918475*1e3*1e3),m|0}function bA(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0;if(y=ue,ue=ue+176|0,d=y,m=Yl(m,g,d)|0,m|0)return d=m,ue=y,d|0;if(ne[b>>3]=0,m=_[d>>2]|0,(m|0)<=1)return d=0,ue=y,d|0;g=m+-1|0,m=0,l=+ne[d+8>>3],u=+ne[d+16>>3],c=0;do m=m+1|0,S=l,l=+ne[d+8+(m<<4)>>3],M=+It(+((l-S)*.5)),T=u,u=+ne[d+8+(m<<4)+8>>3],T=+It(+((u-T)*.5)),T=M*M+T*(+ct(+l)*+ct(+S)*T),c=c+ +Yr(+ +at(+T),+ +at(+(1-T)))*2;while((m|0)<(g|0));return ne[b>>3]=c,d=0,ue=y,d|0}function ic(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0;if(y=ue,ue=ue+176|0,d=y,m=Yl(m,g,d)|0,m|0)return d=m,c=+ne[b>>3],c=c*6371.007180918475,ne[b>>3]=c,ue=y,d|0;if(ne[b>>3]=0,m=_[d>>2]|0,(m|0)<=1)return d=0,c=0,c=c*6371.007180918475,ne[b>>3]=c,ue=y,d|0;g=m+-1|0,m=0,l=+ne[d+8>>3],u=+ne[d+16>>3],c=0;do m=m+1|0,S=l,l=+ne[d+8+(m<<4)>>3],M=+It(+((l-S)*.5)),T=u,u=+ne[d+8+(m<<4)+8>>3],T=+It(+((u-T)*.5)),T=M*M+T*(+ct(+S)*+ct(+l)*T),c=c+ +Yr(+ +at(+T),+ +at(+(1-T)))*2;while((m|0)!=(g|0));return ne[b>>3]=c,d=0,M=c,M=M*6371.007180918475,ne[b>>3]=M,ue=y,d|0}function nc(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0;if(y=ue,ue=ue+176|0,d=y,m=Yl(m,g,d)|0,m|0)return d=m,c=+ne[b>>3],c=c*6371.007180918475,c=c*1e3,ne[b>>3]=c,ue=y,d|0;if(ne[b>>3]=0,m=_[d>>2]|0,(m|0)<=1)return d=0,c=0,c=c*6371.007180918475,c=c*1e3,ne[b>>3]=c,ue=y,d|0;g=m+-1|0,m=0,l=+ne[d+8>>3],u=+ne[d+16>>3],c=0;do m=m+1|0,S=l,l=+ne[d+8+(m<<4)>>3],M=+It(+((l-S)*.5)),T=u,u=+ne[d+8+(m<<4)+8>>3],T=+It(+((u-T)*.5)),T=M*M+T*(+ct(+S)*+ct(+l)*T),c=c+ +Yr(+ +at(+T),+ +at(+(1-T)))*2;while((m|0)!=(g|0));return ne[b>>3]=c,d=0,M=c,M=M*6371.007180918475,M=M*1e3,ne[b>>3]=M,ue=y,d|0}function jo(m){m=m|0;var g=0,b=0,l=0;return g=io(1,12)|0,g||zt(22832,22787,49,22845),b=m+4|0,l=_[b>>2]|0,l|0?(l=l+8|0,_[l>>2]=g,_[b>>2]=g,g|0):(_[m>>2]|0&&zt(22862,22787,61,22885),l=m,_[l>>2]=g,_[b>>2]=g,g|0)}function Ji(m,g){m=m|0,g=g|0;var b=0,l=0;return l=Rr(24)|0,l||zt(22899,22787,78,22913),_[l>>2]=_[g>>2],_[l+4>>2]=_[g+4>>2],_[l+8>>2]=_[g+8>>2],_[l+12>>2]=_[g+12>>2],_[l+16>>2]=0,g=m+4|0,b=_[g>>2]|0,b|0?(_[b+16>>2]=l,_[g>>2]=l,l|0):(_[m>>2]|0&&zt(22928,22787,82,22913),_[m>>2]=l,_[g>>2]=l,l|0)}function _l(m){m=m|0;var g=0,b=0,l=0,u=0;if(m)for(l=1;;){if(g=_[m>>2]|0,g|0)do{if(b=_[g>>2]|0,b|0)do u=b,b=_[b+16>>2]|0,$t(u);while(b|0);u=g,g=_[g+8>>2]|0,$t(u)}while(g|0);if(g=m,m=_[m+8>>2]|0,l||$t(g),m)l=0;else break}}function pf(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0,J=0,_e=0,Ee=0,Ie=0,Me=0,Ge=0,Qe=0,st=0,rt=0,lt=0,At=0,Tt=0,ft=0;if(u=m+8|0,_[u>>2]|0)return ft=1,ft|0;if(l=_[m>>2]|0,!l)return ft=0,ft|0;g=l,b=0;do b=b+1|0,g=_[g+8>>2]|0;while(g|0);if(b>>>0<2)return ft=0,ft|0;At=Rr(b<<2)|0,At||zt(22948,22787,317,22967),lt=Rr(b<<5)|0,lt||zt(22989,22787,321,22967),_[m>>2]=0,Ee=m+4|0,_[Ee>>2]=0,_[u>>2]=0,b=0,rt=0,_e=0,D=0;e:for(;;){if(M=_[l>>2]|0,M){c=0,d=M;do{if(T=+ne[d+8>>3],g=d,d=_[d+16>>2]|0,S=(d|0)==0,u=S?M:d,y=+ne[u+8>>3],+nt(+(T-y))>3.141592653589793){ft=14;break}c=c+(y-T)*(+ne[g>>3]+ +ne[u>>3])}while(!S);if((ft|0)==14){ft=0,c=0,g=M;do J=+ne[g+8>>3],st=g+16|0,Qe=_[st>>2]|0,Qe=Qe|0?Qe:M,K=+ne[Qe+8>>3],c=c+(+ne[g>>3]+ +ne[Qe>>3])*((K<0?K+6.283185307179586:K)-(J<0?J+6.283185307179586:J)),g=_[(g|0?st:l)>>2]|0;while(g|0)}c>0?(_[At+(rt<<2)>>2]=l,rt=rt+1|0,u=_e,g=D):ft=19}else ft=19;if((ft|0)==19){ft=0;do if(b){if(g=b+8|0,_[g>>2]|0){ft=21;break e}if(b=io(1,12)|0,!b){ft=23;break e}_[g>>2]=b,u=b+4|0,d=b,g=D}else if(D){u=Ee,d=D+8|0,g=l,b=m;break}else if(_[m>>2]|0){ft=27;break e}else{u=Ee,d=m,g=l,b=m;break}while(!1);if(_[d>>2]=l,_[u>>2]=l,d=lt+(_e<<5)|0,S=_[l>>2]|0,S){for(M=lt+(_e<<5)+8|0,ne[M>>3]=17976931348623157e292,D=lt+(_e<<5)+24|0,ne[D>>3]=17976931348623157e292,ne[d>>3]=-17976931348623157e292,L=lt+(_e<<5)+16|0,ne[L>>3]=-17976931348623157e292,Q=17976931348623157e292,ie=-17976931348623157e292,u=0,j=S,T=17976931348623157e292,W=17976931348623157e292,te=-17976931348623157e292,y=-17976931348623157e292;c=+ne[j>>3],J=+ne[j+8>>3],j=_[j+16>>2]|0,z=(j|0)==0,K=+ne[(z?S:j)+8>>3],c<T&&(ne[M>>3]=c,T=c),J<W&&(ne[D>>3]=J,W=J),c>te?ne[d>>3]=c:c=te,J>y&&(ne[L>>3]=J,y=J),Q=J>0&J<Q?J:Q,ie=J<0&J>ie?J:ie,u=u|+nt(+(J-K))>3.141592653589793,!z;)te=c;u&&(ne[L>>3]=ie,ne[D>>3]=Q)}else _[d>>2]=0,_[d+4>>2]=0,_[d+8>>2]=0,_[d+12>>2]=0,_[d+16>>2]=0,_[d+20>>2]=0,_[d+24>>2]=0,_[d+28>>2]=0;u=_e+1|0}if(st=l+8|0,l=_[st>>2]|0,_[st>>2]=0,l)_e=u,D=g;else{ft=45;break}}if((ft|0)==21)zt(22765,22787,35,22799);else if((ft|0)==23)zt(22819,22787,37,22799);else if((ft|0)==27)zt(22862,22787,61,22885);else if((ft|0)==45){e:do if((rt|0)>0){for(st=(u|0)==0,Ge=u<<2,Qe=(m|0)==0,Me=0,g=0;;){if(Ie=_[At+(Me<<2)>>2]|0,st)ft=73;else{if(_e=Rr(Ge)|0,!_e){ft=50;break}if(Ee=Rr(Ge)|0,!Ee){ft=52;break}t:do if(Qe)b=0;else{for(u=0,b=0,d=m;l=lt+(u<<5)|0,Fi(_[d>>2]|0,l,_[Ie>>2]|0)|0?(_[_e+(b<<2)>>2]=d,_[Ee+(b<<2)>>2]=l,z=b+1|0):z=b,d=_[d+8>>2]|0,d;)u=u+1|0,b=z;if((z|0)>0)if(l=_[_e>>2]|0,(z|0)==1)b=l;else for(L=0,j=-1,b=l,D=l;;){for(S=_[D>>2]|0,l=0,d=0;u=_[_[_e+(d<<2)>>2]>>2]|0,(u|0)==(S|0)?M=l:M=l+((Fi(u,_[Ee+(d<<2)>>2]|0,_[S>>2]|0)|0)&1)|0,d=d+1|0,(d|0)!=(z|0);)l=M;if(u=(M|0)>(j|0),b=u?D:b,l=L+1|0,(l|0)==(z|0))break t;L=l,j=u?M:j,D=_[_e+(l<<2)>>2]|0}else b=0}while(!1);if($t(_e),$t(Ee),b){if(u=b+4|0,l=_[u>>2]|0,l)b=l+8|0;else if(_[b>>2]|0){ft=70;break}_[b>>2]=Ie,_[u>>2]=Ie}else ft=73}if((ft|0)==73){if(ft=0,g=_[Ie>>2]|0,g|0)do Ee=g,g=_[g+16>>2]|0,$t(Ee);while(g|0);$t(Ie),g=1}if(Me=Me+1|0,(Me|0)>=(rt|0)){Tt=g;break e}}(ft|0)==50?zt(23004,22787,249,23023):(ft|0)==52?zt(23042,22787,252,23023):(ft|0)==70&&zt(22862,22787,61,22885)}else Tt=0;while(!1);return $t(At),$t(lt),ft=Tt,ft|0}return 0}function Fi(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0;if(!(Fo(g,b)|0)||(g=na(g)|0,l=+ne[b>>3],u=+ne[b+8>>3],u=g&u<0?u+6.283185307179586:u,m=_[m>>2]|0,!m))return m=0,m|0;if(g){g=0,S=u,b=m;e:for(;;){for(;d=+ne[b>>3],u=+ne[b+8>>3],b=b+16|0,M=_[b>>2]|0,M=M|0?M:m,c=+ne[M>>3],y=+ne[M+8>>3],d>c?(T=d,d=y):(T=c,c=d,d=u,u=y),l=l==c|l==T?l+2220446049250313e-31:l,!!(l<c|l>T);)if(b=_[b>>2]|0,!b){b=22;break e}if(y=d<0?d+6.283185307179586:d,d=u<0?u+6.283185307179586:u,S=y==S|d==S?S+-2220446049250313e-31:S,T=y+(d-y)*((l-c)/(T-c)),(T<0?T+6.283185307179586:T)>S&&(g=g^1),b=_[b>>2]|0,!b){b=22;break}}if((b|0)==22)return g|0}else{g=0,S=u,b=m;e:for(;;){for(;d=+ne[b>>3],u=+ne[b+8>>3],b=b+16|0,M=_[b>>2]|0,M=M|0?M:m,c=+ne[M>>3],y=+ne[M+8>>3],d>c?(T=d,d=y):(T=c,c=d,d=u,u=y),l=l==c|l==T?l+2220446049250313e-31:l,!!(l<c|l>T);)if(b=_[b>>2]|0,!b){b=22;break e}if(S=d==S|u==S?S+-2220446049250313e-31:S,d+(u-d)*((l-c)/(T-c))>S&&(g=g^1),b=_[b>>2]|0,!b){b=22;break}}if((b|0)==22)return g|0}return 0}function Ct(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0;if(ie=ue,ue=ue+32|0,Q=ie+16|0,te=ie,c=_t(m|0,g|0,52)|0,me()|0,c=c&15,j=_t(b|0,l|0,52)|0,me()|0,(c|0)!=(j&15|0))return Q=12,ue=ie,Q|0;if(S=_t(m|0,g|0,45)|0,me()|0,S=S&127,M=_t(b|0,l|0,45)|0,me()|0,M=M&127,S>>>0>121|M>>>0>121)return Q=5,ue=ie,Q|0;if(j=(S|0)!=(M|0),j){if(y=ss(S,M)|0,(y|0)==7)return Q=1,ue=ie,Q|0;T=ss(M,S)|0,(T|0)==7?zt(23066,23090,161,23100):(z=y,d=T)}else z=0,d=0;D=Wr(S)|0,L=Wr(M)|0,_[Q>>2]=0,_[Q+4>>2]=0,_[Q+8>>2]=0,_[Q+12>>2]=0;do if(z){if(M=_[4272+(S*28|0)+(z<<2)>>2]|0,y=(M|0)>0,L)if(y){S=0,T=b,y=l;do T=pl(T,y)|0,y=me()|0,d=Zn(d)|0,(d|0)==1&&(d=Zn(1)|0),S=S+1|0;while((S|0)!=(M|0));M=d,S=T,T=y}else M=d,S=b,T=l;else if(y){S=0,T=b,y=l;do T=ys(T,y)|0,y=me()|0,d=Zn(d)|0,S=S+1|0;while((S|0)!=(M|0));M=d,S=T,T=y}else M=d,S=b,T=l;if(Vo(S,T,Q)|0,j||zt(23115,23090,191,23100),y=(D|0)!=0,d=(L|0)!=0,y&d&&zt(23142,23090,192,23100),y){if(d=yn(m,g)|0,(d|0)==7){c=5;break}if(ke[21872+(d*7|0)+z>>0]|0){c=1;break}T=_[21040+(d*28|0)+(z<<2)>>2]|0,S=T}else if(d){if(d=yn(S,T)|0,(d|0)==7){c=5;break}if(ke[21872+(d*7|0)+M>>0]|0){c=1;break}S=0,T=_[21040+(M*28|0)+(d<<2)>>2]|0}else S=0,T=0;if((S|T|0)<0)c=5;else{if((T|0)>0){y=Q+4|0,d=0;do Yi(y),d=d+1|0;while((d|0)!=(T|0))}if(_[te>>2]=0,_[te+4>>2]=0,_[te+8>>2]=0,hl(te,z),c|0)for(;vs(c)|0?Hc(te):Ys(te),(c|0)>1;)c=c+-1|0;if((S|0)>0){c=0;do Yi(te),c=c+1|0;while((c|0)!=(S|0))}W=Q+4|0,$n(W,te,W),Ki(W),W=51}}else if(Vo(b,l,Q)|0,(D|0)!=0&(L|0)!=0)if((M|0)!=(S|0)&&zt(23173,23090,261,23100),d=yn(m,g)|0,c=yn(b,l)|0,(d|0)==7|(c|0)==7)c=5;else if(ke[21872+(d*7|0)+c>>0]|0)c=1;else if(d=_[21040+(d*28|0)+(c<<2)>>2]|0,(d|0)>0){y=Q+4|0,c=0;do Yi(y),c=c+1|0;while((c|0)!=(d|0));W=51}else W=51;else W=51;while(!1);return(W|0)==51&&(c=Q+4|0,_[u>>2]=_[c>>2],_[u+4>>2]=_[c+4>>2],_[u+8>>2]=_[c+8>>2],c=0),Q=c,ue=ie,Q|0}function Yn(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0;if(W=ue,ue=ue+48|0,S=W+36|0,d=W+24|0,y=W+12|0,T=W,u=_t(m|0,g|0,52)|0,me()|0,u=u&15,L=_t(m|0,g|0,45)|0,me()|0,L=L&127,L>>>0>121)return l=5,ue=W,l|0;if(M=Wr(L)|0,St(u|0,0,52)|0,te=me()|0|134225919,c=l,_[c>>2]=-1,_[c+4>>2]=te,!u)return u=ul(b)|0,(u|0)==7||(u=cl(L,u)|0,(u|0)==127)?(te=1,ue=W,te|0):(j=St(u|0,0,45)|0,z=me()|0,L=l,z=_[L+4>>2]&-1040385|z,te=l,_[te>>2]=_[L>>2]|j,_[te+4>>2]=z,te=0,ue=W,te|0);for(_[S>>2]=_[b>>2],_[S+4>>2]=_[b+4>>2],_[S+8>>2]=_[b+8>>2],b=u;;){if(c=b,b=b+-1|0,_[d>>2]=_[S>>2],_[d+4>>2]=_[S+4>>2],_[d+8>>2]=_[S+8>>2],vs(c)|0){if(u=$u(S)|0,u|0){b=13;break}_[y>>2]=_[S>>2],_[y+4>>2]=_[S+4>>2],_[y+8>>2]=_[S+8>>2],Hc(y)}else{if(u=Zu(S)|0,u|0){b=13;break}_[y>>2]=_[S>>2],_[y+4>>2]=_[S+4>>2],_[y+8>>2]=_[S+8>>2],Ys(y)}if(qu(d,y,T),Ki(T),u=l,ie=_[u>>2]|0,u=_[u+4>>2]|0,K=(15-c|0)*3|0,Q=St(7,0,K|0)|0,u=u&~(me()|0),K=St(ul(T)|0,0,K|0)|0,u=me()|0|u,te=l,_[te>>2]=K|ie&~Q,_[te+4>>2]=u,(c|0)<=1){b=14;break}}e:do if((b|0)!=13&&(b|0)==14)if((_[S>>2]|0)<=1&&(_[S+4>>2]|0)<=1&&(_[S+8>>2]|0)<=1){b=ul(S)|0,u=cl(L,b)|0,(u|0)==127?T=0:T=Wr(u)|0;t:do if(b){if(M){if(u=yn(m,g)|0,(u|0)==7){u=5;break e}if(c=_[21248+(u*28|0)+(b<<2)>>2]|0,(c|0)>0){u=b,b=0;do u=ko(u)|0,b=b+1|0;while((b|0)!=(c|0))}else u=b;if((u|0)==1){u=9;break e}b=cl(L,u)|0,(b|0)==127&&zt(23200,23090,411,23230),Wr(b)|0?zt(23245,23090,412,23230):(z=b,j=c,D=u)}else z=u,j=0,D=b;if(y=_[4272+(L*28|0)+(D<<2)>>2]|0,(y|0)<=-1&&zt(23276,23090,419,23230),!T){if((j|0)<0){u=5;break e}if(j|0){c=l,u=0,b=_[c>>2]|0,c=_[c+4>>2]|0;do b=da(b,c)|0,c=me()|0,K=l,_[K>>2]=b,_[K+4>>2]=c,u=u+1|0;while((u|0)<(j|0))}if((y|0)<=0){u=z,b=58;break}for(c=l,u=0,b=_[c>>2]|0,c=_[c+4>>2]|0;;)if(b=da(b,c)|0,c=me()|0,K=l,_[K>>2]=b,_[K+4>>2]=c,u=u+1|0,(u|0)==(y|0)){u=z,b=58;break t}}if(d=ss(z,L)|0,(d|0)==7&&zt(23066,23090,428,23230),u=l,b=_[u>>2]|0,u=_[u+4>>2]|0,(y|0)>0){c=0;do b=da(b,u)|0,u=me()|0,K=l,_[K>>2]=b,_[K+4>>2]=u,c=c+1|0;while((c|0)!=(y|0))}if(u=yn(b,u)|0,(u|0)==7&&zt(23313,23090,440,23230),b=zc(z)|0,b=_[(b?21664:21456)+(d*28|0)+(u<<2)>>2]|0,(b|0)<0&&zt(23313,23090,454,23230),!b)u=z,b=58;else{d=l,u=0,c=_[d>>2]|0,d=_[d+4>>2]|0;do c=fa(c,d)|0,d=me()|0,K=l,_[K>>2]=c,_[K+4>>2]=d,u=u+1|0;while((u|0)<(b|0));u=z,b=58}}else if((M|0)!=0&(T|0)!=0){if(b=yn(m,g)|0,c=l,c=yn(_[c>>2]|0,_[c+4>>2]|0)|0,(b|0)==7|(c|0)==7){u=5;break e}if(c=_[21248+(b*28|0)+(c<<2)>>2]|0,(c|0)<0){u=5;break e}if(!c)b=59;else{y=l,b=0,d=_[y>>2]|0,y=_[y+4>>2]|0;do d=da(d,y)|0,y=me()|0,K=l,_[K>>2]=d,_[K+4>>2]=y,b=b+1|0;while((b|0)<(c|0));b=58}}else b=58;while(!1);if((b|0)==58&&T&&(b=59),(b|0)==59&&(K=l,(yn(_[K>>2]|0,_[K+4>>2]|0)|0)==1)){u=9;break}K=l,Q=_[K>>2]|0,K=_[K+4>>2]&-1040385,ie=St(u|0,0,45)|0,K=K|(me()|0),u=l,_[u>>2]=Q|ie,_[u+4>>2]=K,u=0}else u=1;while(!1);return K=u,ue=W,K|0}function eu(m,g,b,l,u,c){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0,c=c|0;var d=0,y=0;return y=ue,ue=ue+16|0,d=y,u?m=15:(m=Ct(m,g,b,l,d)|0,m||(aa(d,c),m=0)),ue=y,m|0}function yl(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0;return d=ue,ue=ue+16|0,c=d,l?b=15:(b=Ra(b,c)|0,b||(b=Yn(m,g,c,u)|0)),ue=d,b|0}function Qs(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0;return T=ue,ue=ue+32|0,d=T+12|0,y=T,c=Ct(m,g,m,g,d)|0,c|0?(y=c,ue=T,y|0):(m=Ct(m,g,b,l,y)|0,m|0?(y=m,ue=T,y|0):(d=Uo(d,y)|0,y=u,_[y>>2]=d,_[y+4>>2]=((d|0)<0)<<31>>31,y=0,ue=T,y|0))}function as(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0;return T=ue,ue=ue+32|0,d=T+12|0,y=T,c=Ct(m,g,m,g,d)|0,!c&&(c=Ct(m,g,b,l,y)|0,!c)?(l=Uo(d,y)|0,l=Cr(l|0,((l|0)<0)<<31>>31|0,1,0)|0,d=me()|0,y=u,_[y>>2]=l,_[y+4>>2]=d,y=0,ue=T,y|0):(y=c,ue=T,y|0)}function Qu(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0,J=0,_e=0,Ee=0,Ie=0,Me=0;if(Ie=ue,ue=ue+48|0,d=Ie+24|0,y=Ie+12|0,Ee=Ie,c=Ct(m,g,m,g,d)|0,!c&&(c=Ct(m,g,b,l,y)|0,!c)){J=Uo(d,y)|0,_e=((J|0)<0)<<31>>31,_[d>>2]=0,_[d+4>>2]=0,_[d+8>>2]=0,_[y>>2]=0,_[y+4>>2]=0,_[y+8>>2]=0,Ct(m,g,m,g,d)|0&&zt(23313,23090,691,23299),Ct(m,g,b,l,y)|0&&zt(23313,23090,696,23299),la(d),la(y),J?(D=_[d>>2]|0,z=+(J|0),Q=d+4|0,L=_[Q>>2]|0,ie=d+8|0,j=_[ie>>2]|0,K=d,l=D,c=L,b=j,W=+((_[y>>2]|0)-D|0)/z,te=+((_[y+4>>2]|0)-L|0)/z,z=+((_[y+8>>2]|0)-j|0)/z):(c=d+4|0,b=d+8|0,Q=c,ie=b,K=d,l=_[d>>2]|0,c=_[c>>2]|0,b=_[b>>2]|0,W=0,te=0,z=0),_[Ee>>2]=l,j=Ee+4|0,_[j>>2]=c,L=Ee+8|0,_[L>>2]=b;e:do if((J|0)<0)c=0;else for(M=0,D=0,c=l;;){S=+(D>>>0)+4294967296*+(M|0),Me=W*S+ +(c|0),T=te*S+ +(_[Q>>2]|0),S=z*S+ +(_[ie>>2]|0),b=~~+no(+Me),d=~~+no(+T),c=~~+no(+S),Me=+nt(+(+(b|0)-Me)),T=+nt(+(+(d|0)-T)),S=+nt(+(+(c|0)-S));do if(Me>T&Me>S)b=0-(d+c)|0,l=d;else if(y=0-b|0,T>S){l=y-c|0;break}else{l=d,c=y-d|0;break}while(!1);if(_[Ee>>2]=b,_[j>>2]=l,_[L>>2]=c,ca(Ee),c=Yn(m,g,Ee,u+(D<<3)|0)|0,c|0)break e;if(!((M|0)<(_e|0)|(M|0)==(_e|0)&D>>>0<J>>>0)){c=0;break e}c=Cr(D|0,M|0,1,0)|0,y=me()|0,M=y,D=c,c=_[K>>2]|0}while(!1);return Ee=c,ue=Ie,Ee|0}return Ee=c,ue=Ie,Ee|0}function bt(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0;if((b|0)==0&(l|0)==0)return u=0,c=1,ir(u|0),c|0;c=m,u=g,m=1,g=0;do d=(b&1|0)==0&!0,m=un((d?1:c)|0,(d?0:u)|0,m|0,g|0)|0,g=me()|0,b=nu(b|0,l|0,1)|0,l=me()|0,c=un(c|0,u|0,c|0,u|0)|0,u=me()|0;while(!((b|0)==0&(l|0)==0));return ir(g|0),m|0}function tu(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0;if(!(Fo(g,b)|0)||(g=na(g)|0,l=+ne[b>>3],u=+ne[b+8>>3],u=g&u<0?u+6.283185307179586:u,L=_[m>>2]|0,(L|0)<=0))return L=0,L|0;if(D=_[m+4>>2]|0,g){g=0,M=u,b=-1,m=0;e:for(;;){for(S=m;d=+ne[D+(S<<4)>>3],u=+ne[D+(S<<4)+8>>3],m=(b+2|0)%(L|0)|0,c=+ne[D+(m<<4)>>3],y=+ne[D+(m<<4)+8>>3],d>c?(T=d,d=y):(T=c,c=d,d=u,u=y),l=l==c|l==T?l+2220446049250313e-31:l,!!(l<c|l>T);)if(b=S+1|0,(b|0)>=(L|0)){b=22;break e}else m=S,S=b,b=m;if(y=d<0?d+6.283185307179586:d,d=u<0?u+6.283185307179586:u,M=y==M|d==M?M+-2220446049250313e-31:M,T=y+(d-y)*((l-c)/(T-c)),(T<0?T+6.283185307179586:T)>M&&(g=g^1),m=S+1|0,(m|0)>=(L|0)){b=22;break}else b=S}if((b|0)==22)return g|0}else{g=0,M=u,b=-1,m=0;e:for(;;){for(S=m;d=+ne[D+(S<<4)>>3],u=+ne[D+(S<<4)+8>>3],m=(b+2|0)%(L|0)|0,c=+ne[D+(m<<4)>>3],y=+ne[D+(m<<4)+8>>3],d>c?(T=d,d=y):(T=c,c=d,d=u,u=y),l=l==c|l==T?l+2220446049250313e-31:l,!!(l<c|l>T);)if(b=S+1|0,(b|0)>=(L|0)){b=22;break e}else m=S,S=b,b=m;if(M=d==M|u==M?M+-2220446049250313e-31:M,d+(u-d)*((l-c)/(T-c))>M&&(g=g^1),m=S+1|0,(m|0)>=(L|0)){b=22;break}else b=S}if((b|0)==22)return g|0}return 0}function sc(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0;if(z=_[m>>2]|0,!z){_[g>>2]=0,_[g+4>>2]=0,_[g+8>>2]=0,_[g+12>>2]=0,_[g+16>>2]=0,_[g+20>>2]=0,_[g+24>>2]=0,_[g+28>>2]=0;return}if(W=g+8|0,ne[W>>3]=17976931348623157e292,te=g+24|0,ne[te>>3]=17976931348623157e292,ne[g>>3]=-17976931348623157e292,Q=g+16|0,ne[Q>>3]=-17976931348623157e292,!((z|0)<=0)){for(L=_[m+4>>2]|0,S=17976931348623157e292,M=-17976931348623157e292,D=0,m=-1,c=17976931348623157e292,d=17976931348623157e292,T=-17976931348623157e292,l=-17976931348623157e292,j=0;b=+ne[L+(j<<4)>>3],y=+ne[L+(j<<4)+8>>3],m=m+2|0,u=+ne[L+(((m|0)==(z|0)?0:m)<<4)+8>>3],b<c&&(ne[W>>3]=b,c=b),y<d&&(ne[te>>3]=y,d=y),b>T?ne[g>>3]=b:b=T,y>l&&(ne[Q>>3]=y,l=y),S=y>0&y<S?y:S,M=y<0&y>M?y:M,D=D|+nt(+(y-u))>3.141592653589793,m=j+1|0,(m|0)!=(z|0);)ie=j,T=b,j=m,m=ie;D&&(ne[Q>>3]=M,ne[te>>3]=S)}}function eh(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0,J=0,_e=0,Ee=0,Ie=0;if(z=_[m>>2]|0,z){if(W=g+8|0,ne[W>>3]=17976931348623157e292,te=g+24|0,ne[te>>3]=17976931348623157e292,ne[g>>3]=-17976931348623157e292,Q=g+16|0,ne[Q>>3]=-17976931348623157e292,(z|0)>0){for(u=_[m+4>>2]|0,L=17976931348623157e292,j=-17976931348623157e292,l=0,b=-1,T=17976931348623157e292,S=17976931348623157e292,D=-17976931348623157e292,d=-17976931348623157e292,ie=0;c=+ne[u+(ie<<4)>>3],M=+ne[u+(ie<<4)+8>>3],Ee=b+2|0,y=+ne[u+(((Ee|0)==(z|0)?0:Ee)<<4)+8>>3],c<T&&(ne[W>>3]=c,T=c),M<S&&(ne[te>>3]=M,S=M),c>D?ne[g>>3]=c:c=D,M>d&&(ne[Q>>3]=M,d=M),L=M>0&M<L?M:L,j=M<0&M>j?M:j,l=l|+nt(+(M-y))>3.141592653589793,b=ie+1|0,(b|0)!=(z|0);)Ee=ie,D=c,ie=b,b=Ee;l&&(ne[Q>>3]=j,ne[te>>3]=L)}}else _[g>>2]=0,_[g+4>>2]=0,_[g+8>>2]=0,_[g+12>>2]=0,_[g+16>>2]=0,_[g+20>>2]=0,_[g+24>>2]=0,_[g+28>>2]=0;if(Ee=m+8|0,b=_[Ee>>2]|0,!((b|0)<=0)){_e=m+12|0,J=0;do if(u=_[_e>>2]|0,l=J,J=J+1|0,te=g+(J<<5)|0,Q=_[u+(l<<3)>>2]|0,Q){if(ie=g+(J<<5)+8|0,ne[ie>>3]=17976931348623157e292,m=g+(J<<5)+24|0,ne[m>>3]=17976931348623157e292,ne[te>>3]=-17976931348623157e292,K=g+(J<<5)+16|0,ne[K>>3]=-17976931348623157e292,(Q|0)>0){for(z=_[u+(l<<3)+4>>2]|0,L=17976931348623157e292,j=-17976931348623157e292,u=0,l=-1,W=0,T=17976931348623157e292,S=17976931348623157e292,M=-17976931348623157e292,d=-17976931348623157e292;c=+ne[z+(W<<4)>>3],D=+ne[z+(W<<4)+8>>3],l=l+2|0,y=+ne[z+(((l|0)==(Q|0)?0:l)<<4)+8>>3],c<T&&(ne[ie>>3]=c,T=c),D<S&&(ne[m>>3]=D,S=D),c>M?ne[te>>3]=c:c=M,D>d&&(ne[K>>3]=D,d=D),L=D>0&D<L?D:L,j=D<0&D>j?D:j,u=u|+nt(+(D-y))>3.141592653589793,l=W+1|0,(l|0)!=(Q|0);)Ie=W,W=l,M=c,l=Ie;u&&(ne[K>>3]=j,ne[m>>3]=L)}}else _[te>>2]=0,_[te+4>>2]=0,_[te+8>>2]=0,_[te+12>>2]=0,_[te+16>>2]=0,_[te+20>>2]=0,_[te+24>>2]=0,_[te+28>>2]=0,b=_[Ee>>2]|0;while((J|0)<(b|0))}}function Os(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0;if(!(tu(m,g,b)|0))return u=0,u|0;if(u=m+8|0,(_[u>>2]|0)<=0)return u=1,u|0;for(l=m+12|0,m=0;;){if(c=m,m=m+1|0,tu((_[l>>2]|0)+(c<<3)|0,g+(m<<5)|0,b)|0){m=0,l=6;break}if((m|0)>=(_[u>>2]|0)){m=1,l=6;break}}return(l|0)==6?m|0:0}function ls(){return 8}function ru(){return 16}function iu(){return 168}function cs(){return 8}function Ho(){return 16}function gf(){return 12}function oc(){return 8}function th(m){return m=m|0,+(+((_[m>>2]|0)>>>0)+4294967296*+(_[m+4>>2]|0))}function rh(m){m=m|0;var g=0,b=0;return b=+ne[m>>3],g=+ne[m+8>>3],+ +at(+(b*b+g*g))}function Ds(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0;S=+ne[m>>3],T=+ne[g>>3]-S,y=+ne[m+8>>3],d=+ne[g+8>>3]-y,D=+ne[b>>3],c=+ne[l>>3]-D,L=+ne[b+8>>3],M=+ne[l+8>>3]-L,c=(c*(y-L)-(S-D)*M)/(T*M-d*c),ne[u>>3]=S+T*c,ne[u+8>>3]=y+d*c}function us(m,g){return m=m|0,g=g|0,+nt(+(+ne[m>>3]-+ne[g>>3]))<11920928955078125e-23?(g=+nt(+(+ne[m+8>>3]-+ne[g+8>>3]))<11920928955078125e-23,g|0):(g=0,g|0)}function Jt(m,g){m=m|0,g=g|0;var b=0,l=0,u=0;return u=+ne[m>>3]-+ne[g>>3],l=+ne[m+8>>3]-+ne[g+8>>3],b=+ne[m+16>>3]-+ne[g+16>>3],+(u*u+l*l+b*b)}function Ao(m,g){m=m|0,g=g|0;var b=0,l=0,u=0;b=+ne[m>>3],l=+ct(+b),b=+It(+b),ne[g+16>>3]=b,b=+ne[m+8>>3],u=l*+ct(+b),ne[g>>3]=u,b=l*+It(+b),ne[g+8>>3]=b}function Fs(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0;if(c=ue,ue=ue+16|0,u=c,l=ti(m,g)|0,(b+-1|0)>>>0>5||(l=(l|0)!=0,(b|0)==1&l))return u=-1,ue=c,u|0;do if(Gi(m,g,u)|0)l=-1;else if(l){l=((_[21936+(b<<2)>>2]|0)+5-(_[u>>2]|0)|0)%5|0;break}else{l=((_[21968+(b<<2)>>2]|0)+6-(_[u>>2]|0)|0)%6|0;break}while(!1);return u=l,ue=c,u|0}function Gi(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0,S=0;if(S=ue,ue=ue+32|0,d=S+16|0,y=S,l=fo(m,g,d)|0,l|0)return b=l,ue=S,b|0;c=fl(m,g)|0,T=yn(m,g)|0,Wu(c,y),l=Kl(c,_[d>>2]|0)|0;e:do if(Wr(c)|0){do switch(c|0){case 4:{m=0;break}case 14:{m=1;break}case 24:{m=2;break}case 38:{m=3;break}case 49:{m=4;break}case 58:{m=5;break}case 63:{m=6;break}case 72:{m=7;break}case 83:{m=8;break}case 97:{m=9;break}case 107:{m=10;break}case 117:{m=11;break}default:{l=1;break e}}while(!1);if(u=_[22e3+(m*24|0)+8>>2]|0,g=_[22e3+(m*24|0)+16>>2]|0,m=_[d>>2]|0,(m|0)!=(_[y>>2]|0)&&(y=zc(c)|0,m=_[d>>2]|0,y|(m|0)==(g|0)&&(l=(l+1|0)%6|0)),(T|0)==3&(m|0)==(g|0)){l=(l+5|0)%6|0,u=22;break}(T|0)==5&(m|0)==(u|0)&&(l=(l+1|0)%6|0),u=22}else u=22;while(!1);return(u|0)==22&&(_[b>>2]=l,l=0),b=l,ue=S,b|0}function vn(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0;if(K=ue,ue=ue+32|0,ie=K+24|0,te=K+20|0,z=K+8|0,j=K+16|0,L=K,T=(ti(m,g)|0)==0,T=T?6:5,M=_t(m|0,g|0,52)|0,me()|0,M=M&15,T>>>0<=b>>>0)return l=2,ue=K,l|0;D=(M|0)==0,!D&&(W=St(7,0,(M^15)*3|0)|0,(W&m|0)==0&((me()|0)&g|0)==0)?u=b:c=4;e:do if((c|0)==4){if(u=(ti(m,g)|0)!=0,((u?4:5)|0)<(b|0)||Gi(m,g,ie)|0||(c=(_[ie>>2]|0)+b|0,u?u=22288+(((c|0)%5|0)<<2)|0:u=22320+(((c|0)%6|0)<<2)|0,W=_[u>>2]|0,(W|0)==7))return l=1,ue=K,l|0;_[te>>2]=0,u=Ce(m,g,W,te,z)|0;do if(!u){if(y=z,S=_[y>>2]|0,y=_[y+4>>2]|0,d=y>>>0<g>>>0|(y|0)==(g|0)&S>>>0<m>>>0,c=d?S:m,d=d?y:g,!D&&(D=St(7,0,(M^15)*3|0)|0,(S&D|0)==0&(y&(me()|0)|0)==0))u=b;else{if(y=(b+-1+T|0)%(T|0)|0,u=ti(m,g)|0,(y|0)<0&&zt(23313,23315,245,23324),T=(u|0)!=0,((T?4:5)|0)<(y|0)&&zt(23313,23315,245,23324),Gi(m,g,ie)|0&&zt(23313,23315,245,23324),u=(_[ie>>2]|0)+y|0,T?u=22288+(((u|0)%5|0)<<2)|0:u=22320+(((u|0)%6|0)<<2)|0,y=_[u>>2]|0,(y|0)==7&&zt(23313,23315,245,23324),_[j>>2]=0,u=Ce(m,g,y,j,L)|0,u|0)break;S=L,T=_[S>>2]|0,S=_[S+4>>2]|0;do if(S>>>0<d>>>0|(S|0)==(d|0)&T>>>0<c>>>0){if(ti(T,S)|0?c=Ze(T,S,m,g)|0:c=_[22384+((((_[j>>2]|0)+(_[22352+(y<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,u=ti(T,S)|0,(c+-1|0)>>>0>5){u=-1,c=T,d=S;break}if(u=(u|0)!=0,(c|0)==1&u){u=-1,c=T,d=S;break}do if(Gi(T,S,ie)|0)u=-1;else if(u){u=((_[21936+(c<<2)>>2]|0)+5-(_[ie>>2]|0)|0)%5|0;break}else{u=((_[21968+(c<<2)>>2]|0)+6-(_[ie>>2]|0)|0)%6|0;break}while(!1);c=T,d=S}else u=b;while(!1);y=z,S=_[y>>2]|0,y=_[y+4>>2]|0}if((c|0)==(S|0)&(d|0)==(y|0)){if(T=(ti(S,y)|0)!=0,T?m=Ze(S,y,m,g)|0:m=_[22384+((((_[te>>2]|0)+(_[22352+(W<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,u=ti(S,y)|0,(m+-1|0)>>>0<=5&&(Q=(u|0)!=0,!((m|0)==1&Q)))do if(Gi(S,y,ie)|0)u=-1;else if(Q){u=((_[21936+(m<<2)>>2]|0)+5-(_[ie>>2]|0)|0)%5|0;break}else{u=((_[21968+(m<<2)>>2]|0)+6-(_[ie>>2]|0)|0)%6|0;break}while(!1);else u=-1;u=u+1|0,u=(u|0)==6|T&(u|0)==5?0:u}g=d,m=c;break e}while(!1);return l=u,ue=K,l|0}while(!1);return Q=St(u|0,0,56)|0,ie=me()|0|g&-2130706433|536870912,_[l>>2]=Q|m,_[l+4>>2]=ie,l=0,ue=K,l|0}function _a(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0;return c=(ti(m,g)|0)==0,l=vn(m,g,0,b)|0,u=(l|0)==0,c?!u||(l=vn(m,g,1,b+8|0)|0,l|0)||(l=vn(m,g,2,b+16|0)|0,l|0)||(l=vn(m,g,3,b+24|0)|0,l|0)||(l=vn(m,g,4,b+32|0)|0,l)?(c=l,c|0):vn(m,g,5,b+40|0)|0:!u||(l=vn(m,g,1,b+8|0)|0,l|0)||(l=vn(m,g,2,b+16|0)|0,l|0)||(l=vn(m,g,3,b+24|0)|0,l|0)||(l=vn(m,g,4,b+32|0)|0,l|0)?(c=l,c|0):(c=b+40|0,_[c>>2]=0,_[c+4>>2]=0,c=0,c|0)}function eo(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0,y=0,T=0;return T=ue,ue=ue+192|0,u=T,c=T+168|0,d=_t(m|0,g|0,56)|0,me()|0,d=d&7,y=g&-2130706433|134217728,l=fo(m,y,c)|0,l|0?(y=l,ue=T,y|0):(g=_t(m|0,g|0,52)|0,me()|0,g=g&15,ti(m,y)|0?Wc(c,g,d,1,u):zo(c,g,d,1,u),y=u+8|0,_[b>>2]=_[y>>2],_[b+4>>2]=_[y+4>>2],_[b+8>>2]=_[y+8>>2],_[b+12>>2]=_[y+12>>2],y=0,ue=T,y|0)}function Nn(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0;return u=ue,ue=ue+16|0,b=u,!(!0&(g&2013265920|0)==536870912)||(l=g&-2130706433|134217728,!(ei(m,l)|0))?(l=0,ue=u,l|0):(c=_t(m|0,g|0,56)|0,me()|0,c=(vn(m,l,c&7,b)|0)==0,l=b,l=c&((_[l>>2]|0)==(m|0)?(_[l+4>>2]|0)==(g|0):0)&1,ue=u,l|0)}function vl(m,g,b){m=m|0,g=g|0,b=b|0;var l=0;(g|0)>0?(l=io(g,4)|0,_[m>>2]=l,l||zt(23337,23360,40,23374)):_[m>>2]=0,_[m+4>>2]=g,_[m+8>>2]=0,_[m+12>>2]=b}function jt(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0;u=m+4|0,c=m+12|0,d=m+8|0;e:for(;;){for(b=_[u>>2]|0,g=0;;){if((g|0)>=(b|0))break e;if(l=_[m>>2]|0,y=_[l+(g<<2)>>2]|0,!y)g=g+1|0;else break}g=l+(~~(+nt(+(+er(10,+ +(15-(_[c>>2]|0)|0))*(+ne[y>>3]+ +ne[y+8>>3])))%+(b|0))>>>0<<2)|0,b=_[g>>2]|0;t:do if(b|0){if(l=y+32|0,(b|0)==(y|0))_[g>>2]=_[l>>2];else{if(b=b+32|0,g=_[b>>2]|0,!g)break;for(;(g|0)!=(y|0);)if(b=g+32|0,g=_[b>>2]|0,!g)break t;_[b>>2]=_[l>>2]}$t(y),_[d>>2]=(_[d>>2]|0)+-1}while(!1)}$t(_[m>>2]|0)}function Lt(m){m=m|0;var g=0,b=0,l=0;for(l=_[m+4>>2]|0,b=0;;){if((b|0)>=(l|0)){g=0,b=4;break}if(g=_[(_[m>>2]|0)+(b<<2)>>2]|0,!g)b=b+1|0;else{b=4;break}}return(b|0)==4?g|0:0}function ac(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0;if(b=~~(+nt(+(+er(10,+ +(15-(_[m+12>>2]|0)|0))*(+ne[g>>3]+ +ne[g+8>>3])))%+(_[m+4>>2]|0))>>>0,b=(_[m>>2]|0)+(b<<2)|0,l=_[b>>2]|0,!l)return c=1,c|0;c=g+32|0;do if((l|0)!=(g|0)){if(b=_[l+32>>2]|0,!b)return c=1,c|0;for(u=b;;){if((u|0)==(g|0)){u=8;break}if(b=_[u+32>>2]|0,b)l=u,u=b;else{b=1,u=10;break}}if((u|0)==8){_[l+32>>2]=_[c>>2];break}else if((u|0)==10)return b|0}else _[b>>2]=_[c>>2];while(!1);return $t(g),c=m+8|0,_[c>>2]=(_[c>>2]|0)+-1,c=0,c|0}function Un(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0;c=Rr(40)|0,c||zt(23390,23360,98,23403),_[c>>2]=_[g>>2],_[c+4>>2]=_[g+4>>2],_[c+8>>2]=_[g+8>>2],_[c+12>>2]=_[g+12>>2],u=c+16|0,_[u>>2]=_[b>>2],_[u+4>>2]=_[b+4>>2],_[u+8>>2]=_[b+8>>2],_[u+12>>2]=_[b+12>>2],_[c+32>>2]=0,u=~~(+nt(+(+er(10,+ +(15-(_[m+12>>2]|0)|0))*(+ne[g>>3]+ +ne[g+8>>3])))%+(_[m+4>>2]|0))>>>0,u=(_[m>>2]|0)+(u<<2)|0,l=_[u>>2]|0;do if(!l)_[u>>2]=c;else{for(;!(pa(l,g)|0&&pa(l+16|0,b)|0);)if(u=_[l+32>>2]|0,l=u|0?u:l,!(_[l+32>>2]|0)){d=10;break}if((d|0)==10){_[l+32>>2]=c;break}return $t(c),d=l,d|0}while(!1);return d=m+8|0,_[d>>2]=(_[d>>2]|0)+1,d=c,d|0}function to(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0;if(u=~~(+nt(+(+er(10,+ +(15-(_[m+12>>2]|0)|0))*(+ne[g>>3]+ +ne[g+8>>3])))%+(_[m+4>>2]|0))>>>0,u=_[(_[m>>2]|0)+(u<<2)>>2]|0,!u)return b=0,b|0;if(!b){for(m=u;;){if(pa(m,g)|0){l=10;break}if(m=_[m+32>>2]|0,!m){m=0,l=10;break}}if((l|0)==10)return m|0}for(m=u;;){if(pa(m,g)|0&&pa(m+16|0,b)|0){l=10;break}if(m=_[m+32>>2]|0,!m){m=0,l=10;break}}return(l|0)==10?m|0:0}function bn(m,g){m=m|0,g=g|0;var b=0;if(b=~~(+nt(+(+er(10,+ +(15-(_[m+12>>2]|0)|0))*(+ne[g>>3]+ +ne[g+8>>3])))%+(_[m+4>>2]|0))>>>0,m=_[(_[m>>2]|0)+(b<<2)>>2]|0,!m)return b=0,b|0;for(;;){if(pa(m,g)|0){g=5;break}if(m=_[m+32>>2]|0,!m){m=0,g=5;break}}return(g|0)==5?m|0:0}function po(){return 23424}function ih(m){return m=+m,+ +bs(+m)}function ro(m){return m=+m,~~+ih(m)|0}function Rr(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0,W=0,te=0,Q=0,ie=0,K=0,J=0,_e=0;_e=ue,ue=ue+16|0,L=_e;do if(m>>>0<245){if(S=m>>>0<11?16:m+11&-8,m=S>>>3,D=_[5857]|0,b=D>>>m,b&3|0)return g=(b&1^1)+m|0,m=23468+(g<<1<<2)|0,b=m+8|0,l=_[b>>2]|0,u=l+8|0,c=_[u>>2]|0,(c|0)==(m|0)?_[5857]=D&~(1<<g):(_[c+12>>2]=m,_[b>>2]=c),J=g<<3,_[l+4>>2]=J|3,J=l+J+4|0,_[J>>2]=_[J>>2]|1,J=u,ue=_e,J|0;if(M=_[5859]|0,S>>>0>M>>>0){if(b|0)return g=2<<m,g=b<<m&(g|0-g),g=(g&0-g)+-1|0,y=g>>>12&16,g=g>>>y,b=g>>>5&8,g=g>>>b,c=g>>>2&4,g=g>>>c,m=g>>>1&2,g=g>>>m,l=g>>>1&1,l=(b|y|c|m|l)+(g>>>l)|0,g=23468+(l<<1<<2)|0,m=g+8|0,c=_[m>>2]|0,y=c+8|0,b=_[y>>2]|0,(b|0)==(g|0)?(m=D&~(1<<l),_[5857]=m):(_[b+12>>2]=g,_[m>>2]=b,m=D),J=l<<3,d=J-S|0,_[c+4>>2]=S|3,u=c+S|0,_[u+4>>2]=d|1,_[c+J>>2]=d,M|0&&(l=_[5862]|0,g=M>>>3,b=23468+(g<<1<<2)|0,g=1<<g,m&g?(m=b+8|0,g=_[m>>2]|0):(_[5857]=m|g,g=b,m=b+8|0),_[m>>2]=l,_[g+12>>2]=l,_[l+8>>2]=g,_[l+12>>2]=b),_[5859]=d,_[5862]=u,J=y,ue=_e,J|0;if(c=_[5858]|0,c){for(b=(c&0-c)+-1|0,u=b>>>12&16,b=b>>>u,l=b>>>5&8,b=b>>>l,d=b>>>2&4,b=b>>>d,y=b>>>1&2,b=b>>>y,T=b>>>1&1,T=_[23732+((l|u|d|y|T)+(b>>>T)<<2)>>2]|0,b=T,y=T,T=(_[T+4>>2]&-8)-S|0;m=_[b+16>>2]|0,!(!m&&(m=_[b+20>>2]|0,!m));)d=(_[m+4>>2]&-8)-S|0,u=d>>>0<T>>>0,b=m,y=u?m:y,T=u?d:T;if(d=y+S|0,d>>>0>y>>>0){u=_[y+24>>2]|0,g=_[y+12>>2]|0;do if((g|0)==(y|0)){if(m=y+20|0,g=_[m>>2]|0,!g&&(m=y+16|0,g=_[m>>2]|0,!g)){b=0;break}for(;;)if(l=g+20|0,b=_[l>>2]|0,b)g=b,m=l;else if(l=g+16|0,b=_[l>>2]|0,b)g=b,m=l;else break;_[m>>2]=0,b=g}else b=_[y+8>>2]|0,_[b+12>>2]=g,_[g+8>>2]=b,b=g;while(!1);do if(u|0){if(g=_[y+28>>2]|0,m=23732+(g<<2)|0,(y|0)==(_[m>>2]|0)){if(_[m>>2]=b,!b){_[5858]=c&~(1<<g);break}}else if(J=u+16|0,_[((_[J>>2]|0)==(y|0)?J:u+20|0)>>2]=b,!b)break;_[b+24>>2]=u,g=_[y+16>>2]|0,g|0&&(_[b+16>>2]=g,_[g+24>>2]=b),g=_[y+20>>2]|0,g|0&&(_[b+20>>2]=g,_[g+24>>2]=b)}while(!1);return T>>>0<16?(J=T+S|0,_[y+4>>2]=J|3,J=y+J+4|0,_[J>>2]=_[J>>2]|1):(_[y+4>>2]=S|3,_[d+4>>2]=T|1,_[d+T>>2]=T,M|0&&(l=_[5862]|0,g=M>>>3,b=23468+(g<<1<<2)|0,g=1<<g,g&D?(m=b+8|0,g=_[m>>2]|0):(_[5857]=g|D,g=b,m=b+8|0),_[m>>2]=l,_[g+12>>2]=l,_[l+8>>2]=g,_[l+12>>2]=b),_[5859]=T,_[5862]=d),J=y+8|0,ue=_e,J|0}else D=S}else D=S}else D=S}else if(m>>>0<=4294967231)if(m=m+11|0,S=m&-8,l=_[5858]|0,l){u=0-S|0,m=m>>>8,m?S>>>0>16777215?T=31:(D=(m+1048320|0)>>>16&8,W=m<<D,y=(W+520192|0)>>>16&4,W=W<<y,T=(W+245760|0)>>>16&2,T=14-(y|D|T)+(W<<T>>>15)|0,T=S>>>(T+7|0)&1|T<<1):T=0,b=_[23732+(T<<2)>>2]|0;e:do if(!b)b=0,m=0,W=61;else for(m=0,y=S<<((T|0)==31?0:25-(T>>>1)|0),c=0;;){if(d=(_[b+4>>2]&-8)-S|0,d>>>0<u>>>0)if(d)m=b,u=d;else{m=b,u=0,W=65;break e}if(W=_[b+20>>2]|0,b=_[b+16+(y>>>31<<2)>>2]|0,c=(W|0)==0|(W|0)==(b|0)?c:W,b)y=y<<1;else{b=c,W=61;break}}while(!1);if((W|0)==61){if((b|0)==0&(m|0)==0){if(m=2<<T,m=(m|0-m)&l,!m){D=S;break}D=(m&0-m)+-1|0,d=D>>>12&16,D=D>>>d,c=D>>>5&8,D=D>>>c,y=D>>>2&4,D=D>>>y,T=D>>>1&2,D=D>>>T,b=D>>>1&1,m=0,b=_[23732+((c|d|y|T|b)+(D>>>b)<<2)>>2]|0}b?W=65:(y=m,d=u)}if((W|0)==65)for(c=b;;)if(D=(_[c+4>>2]&-8)-S|0,b=D>>>0<u>>>0,u=b?D:u,m=b?c:m,b=_[c+16>>2]|0,b||(b=_[c+20>>2]|0),b)c=b;else{y=m,d=u;break}if(y|0&&d>>>0<((_[5859]|0)-S|0)>>>0&&(M=y+S|0,M>>>0>y>>>0)){c=_[y+24>>2]|0,g=_[y+12>>2]|0;do if((g|0)==(y|0)){if(m=y+20|0,g=_[m>>2]|0,!g&&(m=y+16|0,g=_[m>>2]|0,!g)){g=0;break}for(;;)if(u=g+20|0,b=_[u>>2]|0,b)g=b,m=u;else if(u=g+16|0,b=_[u>>2]|0,b)g=b,m=u;else break;_[m>>2]=0}else J=_[y+8>>2]|0,_[J+12>>2]=g,_[g+8>>2]=J;while(!1);do if(c){if(m=_[y+28>>2]|0,b=23732+(m<<2)|0,(y|0)==(_[b>>2]|0)){if(_[b>>2]=g,!g){l=l&~(1<<m),_[5858]=l;break}}else if(J=c+16|0,_[((_[J>>2]|0)==(y|0)?J:c+20|0)>>2]=g,!g)break;_[g+24>>2]=c,m=_[y+16>>2]|0,m|0&&(_[g+16>>2]=m,_[m+24>>2]=g),m=_[y+20>>2]|0,m&&(_[g+20>>2]=m,_[m+24>>2]=g)}while(!1);e:do if(d>>>0<16)J=d+S|0,_[y+4>>2]=J|3,J=y+J+4|0,_[J>>2]=_[J>>2]|1;else{if(_[y+4>>2]=S|3,_[M+4>>2]=d|1,_[M+d>>2]=d,g=d>>>3,d>>>0<256){b=23468+(g<<1<<2)|0,m=_[5857]|0,g=1<<g,m&g?(m=b+8|0,g=_[m>>2]|0):(_[5857]=m|g,g=b,m=b+8|0),_[m>>2]=M,_[g+12>>2]=M,_[M+8>>2]=g,_[M+12>>2]=b;break}if(g=d>>>8,g?d>>>0>16777215?b=31:(K=(g+1048320|0)>>>16&8,J=g<<K,ie=(J+520192|0)>>>16&4,J=J<<ie,b=(J+245760|0)>>>16&2,b=14-(ie|K|b)+(J<<b>>>15)|0,b=d>>>(b+7|0)&1|b<<1):b=0,g=23732+(b<<2)|0,_[M+28>>2]=b,m=M+16|0,_[m+4>>2]=0,_[m>>2]=0,m=1<<b,!(l&m)){_[5858]=l|m,_[g>>2]=M,_[M+24>>2]=g,_[M+12>>2]=M,_[M+8>>2]=M;break}g=_[g>>2]|0;t:do if((_[g+4>>2]&-8|0)!=(d|0)){for(l=d<<((b|0)==31?0:25-(b>>>1)|0);b=g+16+(l>>>31<<2)|0,m=_[b>>2]|0,!!m;)if((_[m+4>>2]&-8|0)==(d|0)){g=m;break t}else l=l<<1,g=m;_[b>>2]=M,_[M+24>>2]=g,_[M+12>>2]=M,_[M+8>>2]=M;break e}while(!1);K=g+8|0,J=_[K>>2]|0,_[J+12>>2]=M,_[K>>2]=M,_[M+8>>2]=J,_[M+12>>2]=g,_[M+24>>2]=0}while(!1);return J=y+8|0,ue=_e,J|0}else D=S}else D=S;else D=-1;while(!1);if(b=_[5859]|0,b>>>0>=D>>>0)return g=b-D|0,m=_[5862]|0,g>>>0>15?(J=m+D|0,_[5862]=J,_[5859]=g,_[J+4>>2]=g|1,_[m+b>>2]=g,_[m+4>>2]=D|3):(_[5859]=0,_[5862]=0,_[m+4>>2]=b|3,J=m+b+4|0,_[J>>2]=_[J>>2]|1),J=m+8|0,ue=_e,J|0;if(d=_[5860]|0,d>>>0>D>>>0)return ie=d-D|0,_[5860]=ie,J=_[5863]|0,K=J+D|0,_[5863]=K,_[K+4>>2]=ie|1,_[J+4>>2]=D|3,J=J+8|0,ue=_e,J|0;if(_[5975]|0?m=_[5977]|0:(_[5977]=4096,_[5976]=4096,_[5978]=-1,_[5979]=-1,_[5980]=0,_[5968]=0,_[5975]=L&-16^1431655768,m=4096),y=D+48|0,T=D+47|0,c=m+T|0,u=0-m|0,S=c&u,S>>>0<=D>>>0||(m=_[5967]|0,m|0&&(M=_[5965]|0,L=M+S|0,L>>>0<=M>>>0|L>>>0>m>>>0)))return J=0,ue=_e,J|0;e:do if(_[5968]&4)g=0,W=143;else{b=_[5863]|0;t:do if(b){for(l=23876;L=_[l>>2]|0,!(L>>>0<=b>>>0&&(L+(_[l+4>>2]|0)|0)>>>0>b>>>0);)if(m=_[l+8>>2]|0,m)l=m;else{W=128;break t}if(g=c-d&u,g>>>0<2147483647)if(m=vo(g|0)|0,(m|0)==((_[l>>2]|0)+(_[l+4>>2]|0)|0)){if((m|0)!=-1){d=g,c=m,W=145;break e}}else l=m,W=136;else g=0}else W=128;while(!1);do if((W|0)==128)if(b=vo(0)|0,(b|0)!=-1&&(g=b,j=_[5976]|0,z=j+-1|0,g=(z&g|0?(z+g&0-j)-g|0:0)+S|0,j=_[5965]|0,z=g+j|0,g>>>0>D>>>0&g>>>0<2147483647)){if(L=_[5967]|0,L|0&&z>>>0<=j>>>0|z>>>0>L>>>0){g=0;break}if(m=vo(g|0)|0,(m|0)==(b|0)){d=g,c=b,W=145;break e}else l=m,W=136}else g=0;while(!1);do if((W|0)==136){if(b=0-g|0,!(y>>>0>g>>>0&(g>>>0<2147483647&(l|0)!=-1)))if((l|0)==-1){g=0;break}else{d=g,c=l,W=145;break e}if(m=_[5977]|0,m=T-g+m&0-m,m>>>0>=2147483647){d=g,c=l,W=145;break e}if((vo(m|0)|0)==-1){vo(b|0)|0,g=0;break}else{d=m+g|0,c=l,W=145;break e}}while(!1);_[5968]=_[5968]|4,W=143}while(!1);if((W|0)==143&&S>>>0<2147483647&&(ie=vo(S|0)|0,z=vo(0)|0,te=z-ie|0,Q=te>>>0>(D+40|0)>>>0,!((ie|0)==-1|Q^1|ie>>>0<z>>>0&((ie|0)!=-1&(z|0)!=-1)^1))&&(d=Q?te:g,c=ie,W=145),(W|0)==145){g=(_[5965]|0)+d|0,_[5965]=g,g>>>0>(_[5966]|0)>>>0&&(_[5966]=g),T=_[5863]|0;e:do if(T){for(g=23876;;){if(m=_[g>>2]|0,b=_[g+4>>2]|0,(c|0)==(m+b|0)){W=154;break}if(l=_[g+8>>2]|0,l)g=l;else break}if((W|0)==154&&(K=g+4|0,(_[g+12>>2]&8|0)==0)&&c>>>0>T>>>0&m>>>0<=T>>>0){_[K>>2]=b+d,J=(_[5860]|0)+d|0,ie=T+8|0,ie=ie&7|0?0-ie&7:0,K=T+ie|0,ie=J-ie|0,_[5863]=K,_[5860]=ie,_[K+4>>2]=ie|1,_[T+J+4>>2]=40,_[5864]=_[5979];break}for(c>>>0<(_[5861]|0)>>>0&&(_[5861]=c),b=c+d|0,g=23876;;){if((_[g>>2]|0)==(b|0)){W=162;break}if(m=_[g+8>>2]|0,m)g=m;else break}if((W|0)==162&&!(_[g+12>>2]&8|0)){_[g>>2]=c,M=g+4|0,_[M>>2]=(_[M>>2]|0)+d,M=c+8|0,M=c+(M&7|0?0-M&7:0)|0,g=b+8|0,g=b+(g&7|0?0-g&7:0)|0,S=M+D|0,y=g-M-D|0,_[M+4>>2]=D|3;t:do if((T|0)==(g|0))J=(_[5860]|0)+y|0,_[5860]=J,_[5863]=S,_[S+4>>2]=J|1;else{if((_[5862]|0)==(g|0)){J=(_[5859]|0)+y|0,_[5859]=J,_[5862]=S,_[S+4>>2]=J|1,_[S+J>>2]=J;break}if(m=_[g+4>>2]|0,(m&3|0)==1){d=m&-8,l=m>>>3;r:do if(m>>>0<256)if(m=_[g+8>>2]|0,b=_[g+12>>2]|0,(b|0)==(m|0)){_[5857]=_[5857]&~(1<<l);break}else{_[m+12>>2]=b,_[b+8>>2]=m;break}else{c=_[g+24>>2]|0,m=_[g+12>>2]|0;do if((m|0)==(g|0)){if(b=g+16|0,l=b+4|0,m=_[l>>2]|0,m)b=l;else if(m=_[b>>2]|0,!m){m=0;break}for(;;)if(u=m+20|0,l=_[u>>2]|0,l)m=l,b=u;else if(u=m+16|0,l=_[u>>2]|0,l)m=l,b=u;else break;_[b>>2]=0}else J=_[g+8>>2]|0,_[J+12>>2]=m,_[m+8>>2]=J;while(!1);if(!c)break;b=_[g+28>>2]|0,l=23732+(b<<2)|0;do if((_[l>>2]|0)!=(g|0)){if(J=c+16|0,_[((_[J>>2]|0)==(g|0)?J:c+20|0)>>2]=m,!m)break r}else{if(_[l>>2]=m,m|0)break;_[5858]=_[5858]&~(1<<b);break r}while(!1);if(_[m+24>>2]=c,b=g+16|0,l=_[b>>2]|0,l|0&&(_[m+16>>2]=l,_[l+24>>2]=m),b=_[b+4>>2]|0,!b)break;_[m+20>>2]=b,_[b+24>>2]=m}while(!1);g=g+d|0,u=d+y|0}else u=y;if(g=g+4|0,_[g>>2]=_[g>>2]&-2,_[S+4>>2]=u|1,_[S+u>>2]=u,g=u>>>3,u>>>0<256){b=23468+(g<<1<<2)|0,m=_[5857]|0,g=1<<g,m&g?(m=b+8|0,g=_[m>>2]|0):(_[5857]=m|g,g=b,m=b+8|0),_[m>>2]=S,_[g+12>>2]=S,_[S+8>>2]=g,_[S+12>>2]=b;break}g=u>>>8;do if(!g)l=0;else{if(u>>>0>16777215){l=31;break}K=(g+1048320|0)>>>16&8,J=g<<K,ie=(J+520192|0)>>>16&4,J=J<<ie,l=(J+245760|0)>>>16&2,l=14-(ie|K|l)+(J<<l>>>15)|0,l=u>>>(l+7|0)&1|l<<1}while(!1);if(g=23732+(l<<2)|0,_[S+28>>2]=l,m=S+16|0,_[m+4>>2]=0,_[m>>2]=0,m=_[5858]|0,b=1<<l,!(m&b)){_[5858]=m|b,_[g>>2]=S,_[S+24>>2]=g,_[S+12>>2]=S,_[S+8>>2]=S;break}g=_[g>>2]|0;r:do if((_[g+4>>2]&-8|0)!=(u|0)){for(l=u<<((l|0)==31?0:25-(l>>>1)|0);b=g+16+(l>>>31<<2)|0,m=_[b>>2]|0,!!m;)if((_[m+4>>2]&-8|0)==(u|0)){g=m;break r}else l=l<<1,g=m;_[b>>2]=S,_[S+24>>2]=g,_[S+12>>2]=S,_[S+8>>2]=S;break t}while(!1);K=g+8|0,J=_[K>>2]|0,_[J+12>>2]=S,_[K>>2]=S,_[S+8>>2]=J,_[S+12>>2]=g,_[S+24>>2]=0}while(!1);return J=M+8|0,ue=_e,J|0}for(g=23876;m=_[g>>2]|0,!(m>>>0<=T>>>0&&(J=m+(_[g+4>>2]|0)|0,J>>>0>T>>>0));)g=_[g+8>>2]|0;u=J+-47|0,m=u+8|0,m=u+(m&7|0?0-m&7:0)|0,u=T+16|0,m=m>>>0<u>>>0?T:m,g=m+8|0,b=d+-40|0,ie=c+8|0,ie=ie&7|0?0-ie&7:0,K=c+ie|0,ie=b-ie|0,_[5863]=K,_[5860]=ie,_[K+4>>2]=ie|1,_[c+b+4>>2]=40,_[5864]=_[5979],b=m+4|0,_[b>>2]=27,_[g>>2]=_[5969],_[g+4>>2]=_[5970],_[g+8>>2]=_[5971],_[g+12>>2]=_[5972],_[5969]=c,_[5970]=d,_[5972]=0,_[5971]=g,g=m+24|0;do K=g,g=g+4|0,_[g>>2]=7;while((K+8|0)>>>0<J>>>0);if((m|0)!=(T|0)){if(c=m-T|0,_[b>>2]=_[b>>2]&-2,_[T+4>>2]=c|1,_[m>>2]=c,g=c>>>3,c>>>0<256){b=23468+(g<<1<<2)|0,m=_[5857]|0,g=1<<g,m&g?(m=b+8|0,g=_[m>>2]|0):(_[5857]=m|g,g=b,m=b+8|0),_[m>>2]=T,_[g+12>>2]=T,_[T+8>>2]=g,_[T+12>>2]=b;break}if(g=c>>>8,g?c>>>0>16777215?l=31:(K=(g+1048320|0)>>>16&8,J=g<<K,ie=(J+520192|0)>>>16&4,J=J<<ie,l=(J+245760|0)>>>16&2,l=14-(ie|K|l)+(J<<l>>>15)|0,l=c>>>(l+7|0)&1|l<<1):l=0,b=23732+(l<<2)|0,_[T+28>>2]=l,_[T+20>>2]=0,_[u>>2]=0,g=_[5858]|0,m=1<<l,!(g&m)){_[5858]=g|m,_[b>>2]=T,_[T+24>>2]=b,_[T+12>>2]=T,_[T+8>>2]=T;break}g=_[b>>2]|0;t:do if((_[g+4>>2]&-8|0)!=(c|0)){for(l=c<<((l|0)==31?0:25-(l>>>1)|0);b=g+16+(l>>>31<<2)|0,m=_[b>>2]|0,!!m;)if((_[m+4>>2]&-8|0)==(c|0)){g=m;break t}else l=l<<1,g=m;_[b>>2]=T,_[T+24>>2]=g,_[T+12>>2]=T,_[T+8>>2]=T;break e}while(!1);K=g+8|0,J=_[K>>2]|0,_[J+12>>2]=T,_[K>>2]=T,_[T+8>>2]=J,_[T+12>>2]=g,_[T+24>>2]=0}}else J=_[5861]|0,(J|0)==0|c>>>0<J>>>0&&(_[5861]=c),_[5969]=c,_[5970]=d,_[5972]=0,_[5866]=_[5975],_[5865]=-1,_[5870]=23468,_[5869]=23468,_[5872]=23476,_[5871]=23476,_[5874]=23484,_[5873]=23484,_[5876]=23492,_[5875]=23492,_[5878]=23500,_[5877]=23500,_[5880]=23508,_[5879]=23508,_[5882]=23516,_[5881]=23516,_[5884]=23524,_[5883]=23524,_[5886]=23532,_[5885]=23532,_[5888]=23540,_[5887]=23540,_[5890]=23548,_[5889]=23548,_[5892]=23556,_[5891]=23556,_[5894]=23564,_[5893]=23564,_[5896]=23572,_[5895]=23572,_[5898]=23580,_[5897]=23580,_[5900]=23588,_[5899]=23588,_[5902]=23596,_[5901]=23596,_[5904]=23604,_[5903]=23604,_[5906]=23612,_[5905]=23612,_[5908]=23620,_[5907]=23620,_[5910]=23628,_[5909]=23628,_[5912]=23636,_[5911]=23636,_[5914]=23644,_[5913]=23644,_[5916]=23652,_[5915]=23652,_[5918]=23660,_[5917]=23660,_[5920]=23668,_[5919]=23668,_[5922]=23676,_[5921]=23676,_[5924]=23684,_[5923]=23684,_[5926]=23692,_[5925]=23692,_[5928]=23700,_[5927]=23700,_[5930]=23708,_[5929]=23708,_[5932]=23716,_[5931]=23716,J=d+-40|0,ie=c+8|0,ie=ie&7|0?0-ie&7:0,K=c+ie|0,ie=J-ie|0,_[5863]=K,_[5860]=ie,_[K+4>>2]=ie|1,_[c+J+4>>2]=40,_[5864]=_[5979];while(!1);if(g=_[5860]|0,g>>>0>D>>>0)return ie=g-D|0,_[5860]=ie,J=_[5863]|0,K=J+D|0,_[5863]=K,_[K+4>>2]=ie|1,_[J+4>>2]=D|3,J=J+8|0,ue=_e,J|0}return J=po()|0,_[J>>2]=12,J=0,ue=_e,J|0}function $t(m){m=m|0;var g=0,b=0,l=0,u=0,c=0,d=0,y=0,T=0;if(m){b=m+-8|0,u=_[5861]|0,m=_[m+-4>>2]|0,g=m&-8,T=b+g|0;do if(m&1)y=b,d=b;else{if(l=_[b>>2]|0,!(m&3)||(d=b+(0-l)|0,c=l+g|0,d>>>0<u>>>0))return;if((_[5862]|0)==(d|0)){if(m=T+4|0,g=_[m>>2]|0,(g&3|0)!=3){y=d,g=c;break}_[5859]=c,_[m>>2]=g&-2,_[d+4>>2]=c|1,_[d+c>>2]=c;return}if(b=l>>>3,l>>>0<256)if(m=_[d+8>>2]|0,g=_[d+12>>2]|0,(g|0)==(m|0)){_[5857]=_[5857]&~(1<<b),y=d,g=c;break}else{_[m+12>>2]=g,_[g+8>>2]=m,y=d,g=c;break}u=_[d+24>>2]|0,m=_[d+12>>2]|0;do if((m|0)==(d|0)){if(g=d+16|0,b=g+4|0,m=_[b>>2]|0,m)g=b;else if(m=_[g>>2]|0,!m){m=0;break}for(;;)if(l=m+20|0,b=_[l>>2]|0,b)m=b,g=l;else if(l=m+16|0,b=_[l>>2]|0,b)m=b,g=l;else break;_[g>>2]=0}else y=_[d+8>>2]|0,_[y+12>>2]=m,_[m+8>>2]=y;while(!1);if(u){if(g=_[d+28>>2]|0,b=23732+(g<<2)|0,(_[b>>2]|0)==(d|0)){if(_[b>>2]=m,!m){_[5858]=_[5858]&~(1<<g),y=d,g=c;break}}else if(y=u+16|0,_[((_[y>>2]|0)==(d|0)?y:u+20|0)>>2]=m,!m){y=d,g=c;break}_[m+24>>2]=u,g=d+16|0,b=_[g>>2]|0,b|0&&(_[m+16>>2]=b,_[b+24>>2]=m),g=_[g+4>>2]|0,g?(_[m+20>>2]=g,_[g+24>>2]=m,y=d,g=c):(y=d,g=c)}else y=d,g=c}while(!1);if(!(d>>>0>=T>>>0)&&(m=T+4|0,l=_[m>>2]|0,!!(l&1))){if(l&2)_[m>>2]=l&-2,_[y+4>>2]=g|1,_[d+g>>2]=g,u=g;else{if((_[5863]|0)==(T|0)){if(T=(_[5860]|0)+g|0,_[5860]=T,_[5863]=y,_[y+4>>2]=T|1,(y|0)!=(_[5862]|0))return;_[5862]=0,_[5859]=0;return}if((_[5862]|0)==(T|0)){T=(_[5859]|0)+g|0,_[5859]=T,_[5862]=d,_[y+4>>2]=T|1,_[d+T>>2]=T;return}u=(l&-8)+g|0,b=l>>>3;do if(l>>>0<256)if(g=_[T+8>>2]|0,m=_[T+12>>2]|0,(m|0)==(g|0)){_[5857]=_[5857]&~(1<<b);break}else{_[g+12>>2]=m,_[m+8>>2]=g;break}else{c=_[T+24>>2]|0,m=_[T+12>>2]|0;do if((m|0)==(T|0)){if(g=T+16|0,b=g+4|0,m=_[b>>2]|0,m)g=b;else if(m=_[g>>2]|0,!m){b=0;break}for(;;)if(l=m+20|0,b=_[l>>2]|0,b)m=b,g=l;else if(l=m+16|0,b=_[l>>2]|0,b)m=b,g=l;else break;_[g>>2]=0,b=m}else b=_[T+8>>2]|0,_[b+12>>2]=m,_[m+8>>2]=b,b=m;while(!1);if(c|0){if(m=_[T+28>>2]|0,g=23732+(m<<2)|0,(_[g>>2]|0)==(T|0)){if(_[g>>2]=b,!b){_[5858]=_[5858]&~(1<<m);break}}else if(l=c+16|0,_[((_[l>>2]|0)==(T|0)?l:c+20|0)>>2]=b,!b)break;_[b+24>>2]=c,m=T+16|0,g=_[m>>2]|0,g|0&&(_[b+16>>2]=g,_[g+24>>2]=b),m=_[m+4>>2]|0,m|0&&(_[b+20>>2]=m,_[m+24>>2]=b)}}while(!1);if(_[y+4>>2]=u|1,_[d+u>>2]=u,(y|0)==(_[5862]|0)){_[5859]=u;return}}if(m=u>>>3,u>>>0<256){b=23468+(m<<1<<2)|0,g=_[5857]|0,m=1<<m,g&m?(g=b+8|0,m=_[g>>2]|0):(_[5857]=g|m,m=b,g=b+8|0),_[g>>2]=y,_[m+12>>2]=y,_[y+8>>2]=m,_[y+12>>2]=b;return}m=u>>>8,m?u>>>0>16777215?l=31:(d=(m+1048320|0)>>>16&8,T=m<<d,c=(T+520192|0)>>>16&4,T=T<<c,l=(T+245760|0)>>>16&2,l=14-(c|d|l)+(T<<l>>>15)|0,l=u>>>(l+7|0)&1|l<<1):l=0,m=23732+(l<<2)|0,_[y+28>>2]=l,_[y+20>>2]=0,_[y+16>>2]=0,g=_[5858]|0,b=1<<l;e:do if(!(g&b))_[5858]=g|b,_[m>>2]=y,_[y+24>>2]=m,_[y+12>>2]=y,_[y+8>>2]=y;else{m=_[m>>2]|0;t:do if((_[m+4>>2]&-8|0)!=(u|0)){for(l=u<<((l|0)==31?0:25-(l>>>1)|0);b=m+16+(l>>>31<<2)|0,g=_[b>>2]|0,!!g;)if((_[g+4>>2]&-8|0)==(u|0)){m=g;break t}else l=l<<1,m=g;_[b>>2]=y,_[y+24>>2]=m,_[y+12>>2]=y,_[y+8>>2]=y;break e}while(!1);d=m+8|0,T=_[d>>2]|0,_[T+12>>2]=y,_[d>>2]=y,_[y+8>>2]=T,_[y+12>>2]=m,_[y+24>>2]=0}while(!1);if(T=(_[5865]|0)+-1|0,_[5865]=T,!(T|0)){for(m=23884;m=_[m>>2]|0,m;)m=m+8|0;_[5865]=-1}}}}function io(m,g){m=m|0,g=g|0;var b=0;return m?(b=Fr(g,m)|0,(g|m)>>>0>65535&&(b=((b>>>0)/(m>>>0)|0|0)==(g|0)?b:-1)):b=0,m=Rr(b)|0,!m||!(_[m+-4>>2]&3)||hs(m|0,0,b|0)|0,m|0}function Cr(m,g,b,l){return m=m|0,g=g|0,b=b|0,l=l|0,b=m+b>>>0,ir(g+l+(b>>>0<m>>>0|0)>>>0|0),b|0|0}function xn(m,g,b,l){return m=m|0,g=g|0,b=b|0,l=l|0,l=g-l-(b>>>0>m>>>0|0)>>>0,ir(l|0),m-b>>>0|0|0}function go(m){return m=m|0,(m?31-(pr(m^m-1)|0)|0:32)|0}function zn(m,g,b,l,u){m=m|0,g=g|0,b=b|0,l=l|0,u=u|0;var c=0,d=0,y=0,T=0,S=0,M=0,D=0,L=0,j=0,z=0;if(M=m,T=g,S=T,d=b,L=l,y=L,!S)return c=(u|0)!=0,y?c?(_[u>>2]=m|0,_[u+4>>2]=g&0,L=0,u=0,ir(L|0),u|0):(L=0,u=0,ir(L|0),u|0):(c&&(_[u>>2]=(M>>>0)%(d>>>0),_[u+4>>2]=0),L=0,u=(M>>>0)/(d>>>0)>>>0,ir(L|0),u|0);c=(y|0)==0;do if(d){if(!c){if(c=(pr(y|0)|0)-(pr(S|0)|0)|0,c>>>0<=31){D=c+1|0,y=31-c|0,g=c-31>>31,d=D,m=M>>>(D>>>0)&g|S<<y,g=S>>>(D>>>0)&g,c=0,y=M<<y;break}return u?(_[u>>2]=m|0,_[u+4>>2]=T|g&0,L=0,u=0,ir(L|0),u|0):(L=0,u=0,ir(L|0),u|0)}if(c=d-1|0,c&d|0){y=(pr(d|0)|0)+33-(pr(S|0)|0)|0,z=64-y|0,D=32-y|0,T=D>>31,j=y-32|0,g=j>>31,d=y,m=D-1>>31&S>>>(j>>>0)|(S<<D|M>>>(y>>>0))&g,g=g&S>>>(y>>>0),c=M<<z&T,y=(S<<z|M>>>(j>>>0))&T|M<<D&y-33>>31;break}return u|0&&(_[u>>2]=c&M,_[u+4>>2]=0),(d|0)==1?(j=T|g&0,z=m|0|0,ir(j|0),z|0):(z=go(d|0)|0,j=S>>>(z>>>0)|0,z=S<<32-z|M>>>(z>>>0)|0,ir(j|0),z|0)}else{if(c)return u|0&&(_[u>>2]=(S>>>0)%(d>>>0),_[u+4>>2]=0),j=0,z=(S>>>0)/(d>>>0)>>>0,ir(j|0),z|0;if(!M)return u|0&&(_[u>>2]=0,_[u+4>>2]=(S>>>0)%(y>>>0)),j=0,z=(S>>>0)/(y>>>0)>>>0,ir(j|0),z|0;if(c=y-1|0,!(c&y))return u|0&&(_[u>>2]=m|0,_[u+4>>2]=c&S|g&0),j=0,z=S>>>((go(y|0)|0)>>>0),ir(j|0),z|0;if(c=(pr(y|0)|0)-(pr(S|0)|0)|0,c>>>0<=30){g=c+1|0,y=31-c|0,d=g,m=S<<y|M>>>(g>>>0),g=S>>>(g>>>0),c=0,y=M<<y;break}return u?(_[u>>2]=m|0,_[u+4>>2]=T|g&0,j=0,z=0,ir(j|0),z|0):(j=0,z=0,ir(j|0),z|0)}while(!1);if(!d)S=y,T=0,y=0;else{D=b|0|0,M=L|l&0,S=Cr(D|0,M|0,-1,-1)|0,b=me()|0,T=y,y=0;do l=T,T=c>>>31|T<<1,c=y|c<<1,l=m<<1|l>>>31|0,L=m>>>31|g<<1|0,xn(S|0,b|0,l|0,L|0)|0,z=me()|0,j=z>>31|((z|0)<0?-1:0)<<1,y=j&1,m=xn(l|0,L|0,j&D|0,(((z|0)<0?-1:0)>>31|((z|0)<0?-1:0)<<1)&M|0)|0,g=me()|0,d=d-1|0;while(d|0);S=T,T=0}return d=0,u|0&&(_[u>>2]=m,_[u+4>>2]=g),j=(c|0)>>>31|(S|d)<<1|(d<<1|c>>>31)&0|T,z=(c<<1|0)&-2|y,ir(j|0),z|0}function Ls(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0;return S=g>>31|((g|0)<0?-1:0)<<1,T=((g|0)<0?-1:0)>>31|((g|0)<0?-1:0)<<1,c=l>>31|((l|0)<0?-1:0)<<1,u=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,y=xn(S^m|0,T^g|0,S|0,T|0)|0,d=me()|0,m=c^S,g=u^T,xn((zn(y,d,xn(c^b|0,u^l|0,c|0,u|0)|0,me()|0,0)|0)^m|0,(me()|0)^g|0,m|0,g|0)|0}function mo(m,g){m=m|0,g=g|0;var b=0,l=0,u=0,c=0;return c=m&65535,u=g&65535,b=Fr(u,c)|0,l=m>>>16,m=(b>>>16)+(Fr(u,l)|0)|0,u=g>>>16,g=Fr(u,c)|0,ir((m>>>16)+(Fr(u,l)|0)+(((m&65535)+g|0)>>>16)|0),m+g<<16|b&65535|0|0}function un(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0;return u=m,c=b,b=mo(u,c)|0,m=me()|0,ir((Fr(g,c)|0)+(Fr(l,u)|0)+m|m&0|0),b|0|0|0}function Go(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0,d=0,y=0,T=0,S=0;return u=ue,ue=ue+16|0,y=u|0,d=g>>31|((g|0)<0?-1:0)<<1,c=((g|0)<0?-1:0)>>31|((g|0)<0?-1:0)<<1,S=l>>31|((l|0)<0?-1:0)<<1,T=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,m=xn(d^m|0,c^g|0,d|0,c|0)|0,g=me()|0,zn(m,g,xn(S^b|0,T^l|0,S|0,T|0)|0,me()|0,y)|0,l=xn(_[y>>2]^d|0,_[y+4>>2]^c|0,d|0,c|0)|0,b=me()|0,ue=u,ir(b|0),l|0}function _o(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var u=0,c=0;return c=ue,ue=ue+16|0,u=c|0,zn(m,g,b,l,u)|0,ue=c,ir(_[u+4>>2]|0),_[u>>2]|0|0}function nu(m,g,b){return m=m|0,g=g|0,b=b|0,(b|0)<32?(ir(g>>b|0),m>>>b|(g&(1<<b)-1)<<32-b):(ir(((g|0)<0?-1:0)|0),g>>b-32|0)}function _t(m,g,b){return m=m|0,g=g|0,b=b|0,(b|0)<32?(ir(g>>>b|0),m>>>b|(g&(1<<b)-1)<<32-b):(ir(0),g>>>b-32|0)}function St(m,g,b){return m=m|0,g=g|0,b=b|0,(b|0)<32?(ir(g<<b|(m&(1<<b)-1<<32-b)>>>32-b|0),m<<b):(ir(m<<b-32|0),0)}function su(m,g){return m=+m,g=+g,m!=m?+g:g!=g?+m:+Ar(+m,+g)}function yo(m,g){return m=+m,g=+g,m!=m?+g:g!=g?+m:+zr(+m,+g)}function no(m){return m=+m,m>=0?+gt(m+.5):+xr(m-.5)}function ka(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0;if((b|0)>=8192)return Oo(m|0,g|0,b|0)|0,m|0;if(c=m|0,u=m+b|0,(m&3)==(g&3)){for(;m&3;){if(!b)return c|0;ke[m>>0]=ke[g>>0]|0,m=m+1|0,g=g+1|0,b=b-1|0}for(b=u&-4|0,l=b-64|0;(m|0)<=(l|0);)_[m>>2]=_[g>>2],_[m+4>>2]=_[g+4>>2],_[m+8>>2]=_[g+8>>2],_[m+12>>2]=_[g+12>>2],_[m+16>>2]=_[g+16>>2],_[m+20>>2]=_[g+20>>2],_[m+24>>2]=_[g+24>>2],_[m+28>>2]=_[g+28>>2],_[m+32>>2]=_[g+32>>2],_[m+36>>2]=_[g+36>>2],_[m+40>>2]=_[g+40>>2],_[m+44>>2]=_[g+44>>2],_[m+48>>2]=_[g+48>>2],_[m+52>>2]=_[g+52>>2],_[m+56>>2]=_[g+56>>2],_[m+60>>2]=_[g+60>>2],m=m+64|0,g=g+64|0;for(;(m|0)<(b|0);)_[m>>2]=_[g>>2],m=m+4|0,g=g+4|0}else for(b=u-4|0;(m|0)<(b|0);)ke[m>>0]=ke[g>>0]|0,ke[m+1>>0]=ke[g+1>>0]|0,ke[m+2>>0]=ke[g+2>>0]|0,ke[m+3>>0]=ke[g+3>>0]|0,m=m+4|0,g=g+4|0;for(;(m|0)<(u|0);)ke[m>>0]=ke[g>>0]|0,m=m+1|0,g=g+1|0;return c|0}function hs(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,u=0,c=0,d=0;if(c=m+b|0,g=g&255,(b|0)>=67){for(;m&3;)ke[m>>0]=g,m=m+1|0;for(l=c&-4|0,d=g|g<<8|g<<16|g<<24,u=l-64|0;(m|0)<=(u|0);)_[m>>2]=d,_[m+4>>2]=d,_[m+8>>2]=d,_[m+12>>2]=d,_[m+16>>2]=d,_[m+20>>2]=d,_[m+24>>2]=d,_[m+28>>2]=d,_[m+32>>2]=d,_[m+36>>2]=d,_[m+40>>2]=d,_[m+44>>2]=d,_[m+48>>2]=d,_[m+52>>2]=d,_[m+56>>2]=d,_[m+60>>2]=d,m=m+64|0;for(;(m|0)<(l|0);)_[m>>2]=d,m=m+4|0}for(;(m|0)<(c|0);)ke[m>>0]=g,m=m+1|0;return c-b|0}function bs(m){return m=+m,m>=0?+gt(m+.5):+xr(m-.5)}function vo(m){m=m|0;var g=0,b=0,l=0;return l=ta()|0,b=_[qe>>2]|0,g=b+m|0,(m|0)>0&(g|0)<(b|0)|(g|0)<0?(Do(g|0)|0,hi(12),-1):(g|0)>(l|0)&&!(di(g|0)|0)?(hi(12),-1):(_[qe>>2]=g,b|0)}return{___divdi3:Ls,___muldi3:un,___remdi3:Go,___uremdi3:_o,_areNeighborCells:ef,_bitshift64Ashr:nu,_bitshift64Lshr:_t,_bitshift64Shl:St,_calloc:io,_cellAreaKm2:rc,_cellAreaM2:vA,_cellAreaRads2:ma,_cellToBoundary:Oa,_cellToCenterChild:uf,_cellToChildPos:df,_cellToChildren:cf,_cellToChildrenSize:qc,_cellToLatLng:Aa,_cellToLocalIj:eu,_cellToParent:dl,_cellToVertex:vn,_cellToVertexes:_a,_cellsToDirectedEdge:tf,_cellsToLinkedMultiPolygon:_n,_childPosToCell:Af,_compactCells:$c,_destroyLinkedMultiPolygon:_l,_directedEdgeToBoundary:Yl,_directedEdgeToCells:rf,_edgeLengthKm:ic,_edgeLengthM:nc,_edgeLengthRads:bA,_emscripten_replace_memory:Ii,_free:$t,_getBaseCellNumber:fl,_getDirectedEdgeDestination:_A,_getDirectedEdgeOrigin:Qr,_getHexagonAreaAvgKm2:La,_getHexagonAreaAvgM2:ga,_getHexagonEdgeLengthAvgKm:kr,_getHexagonEdgeLengthAvgM:li,_getIcosahedronFaces:ff,_getNumCells:Kn,_getPentagons:Ql,_getRes0Cells:ia,_getResolution:lf,_greatCircleDistanceKm:gl,_greatCircleDistanceM:Fa,_greatCircleDistanceRads:tc,_gridDisk:qn,_gridDiskDistances:Uc,_gridDistance:Qs,_gridPathCells:Qu,_gridPathCellsSize:as,_gridRingUnsafe:mt,_i64Add:Cr,_i64Subtract:xn,_isPentagon:ti,_isResClassIII:Zc,_isValidCell:ei,_isValidDirectedEdge:Gc,_isValidVertex:Nn,_latLngToCell:Ju,_llvm_maxnum_f64:su,_llvm_minnum_f64:yo,_llvm_round_f64:no,_localIjToCell:yl,_malloc:Rr,_maxFaceCount:Kc,_maxGridDiskSize:Zl,_maxPolygonToCellsSize:Vt,_memcpy:ka,_memset:hs,_originToDirectedEdges:nf,_pentagonCount:Yc,_polygonToCells:ji,_readInt64AsDoubleFromPointer:th,_res0CellCount:ra,_round:bs,_sbrk:vo,_sizeOfCellBoundary:iu,_sizeOfCoordIJ:oc,_sizeOfGeoLoop:cs,_sizeOfGeoPolygon:Ho,_sizeOfH3Index:ls,_sizeOfLatLng:ru,_sizeOfLinkedGeoPolygon:gf,_uncompactCells:Al,_uncompactCellsSize:Jl,_vertexToLatLng:eo,establishStackSpace:Rn,stackAlloc:Zi,stackRestore:ns,stackSave:ai}}(Ms,Rs,Ae);e.___divdi3=yt.___divdi3,e.___muldi3=yt.___muldi3,e.___remdi3=yt.___remdi3,e.___uremdi3=yt.___uremdi3,e._areNeighborCells=yt._areNeighborCells,e._bitshift64Ashr=yt._bitshift64Ashr,e._bitshift64Lshr=yt._bitshift64Lshr,e._bitshift64Shl=yt._bitshift64Shl,e._calloc=yt._calloc,e._cellAreaKm2=yt._cellAreaKm2,e._cellAreaM2=yt._cellAreaM2,e._cellAreaRads2=yt._cellAreaRads2,e._cellToBoundary=yt._cellToBoundary,e._cellToCenterChild=yt._cellToCenterChild,e._cellToChildPos=yt._cellToChildPos,e._cellToChildren=yt._cellToChildren,e._cellToChildrenSize=yt._cellToChildrenSize,e._cellToLatLng=yt._cellToLatLng,e._cellToLocalIj=yt._cellToLocalIj,e._cellToParent=yt._cellToParent,e._cellToVertex=yt._cellToVertex,e._cellToVertexes=yt._cellToVertexes,e._cellsToDirectedEdge=yt._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=yt._cellsToLinkedMultiPolygon,e._childPosToCell=yt._childPosToCell,e._compactCells=yt._compactCells,e._destroyLinkedMultiPolygon=yt._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=yt._directedEdgeToBoundary,e._directedEdgeToCells=yt._directedEdgeToCells,e._edgeLengthKm=yt._edgeLengthKm,e._edgeLengthM=yt._edgeLengthM,e._edgeLengthRads=yt._edgeLengthRads;var Ma=e._emscripten_replace_memory=yt._emscripten_replace_memory;e._free=yt._free,e._getBaseCellNumber=yt._getBaseCellNumber,e._getDirectedEdgeDestination=yt._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=yt._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=yt._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=yt._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=yt._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=yt._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=yt._getIcosahedronFaces,e._getNumCells=yt._getNumCells,e._getPentagons=yt._getPentagons,e._getRes0Cells=yt._getRes0Cells,e._getResolution=yt._getResolution,e._greatCircleDistanceKm=yt._greatCircleDistanceKm,e._greatCircleDistanceM=yt._greatCircleDistanceM,e._greatCircleDistanceRads=yt._greatCircleDistanceRads,e._gridDisk=yt._gridDisk,e._gridDiskDistances=yt._gridDiskDistances,e._gridDistance=yt._gridDistance,e._gridPathCells=yt._gridPathCells,e._gridPathCellsSize=yt._gridPathCellsSize,e._gridRingUnsafe=yt._gridRingUnsafe,e._i64Add=yt._i64Add,e._i64Subtract=yt._i64Subtract,e._isPentagon=yt._isPentagon,e._isResClassIII=yt._isResClassIII,e._isValidCell=yt._isValidCell,e._isValidDirectedEdge=yt._isValidDirectedEdge,e._isValidVertex=yt._isValidVertex,e._latLngToCell=yt._latLngToCell,e._llvm_maxnum_f64=yt._llvm_maxnum_f64,e._llvm_minnum_f64=yt._llvm_minnum_f64,e._llvm_round_f64=yt._llvm_round_f64,e._localIjToCell=yt._localIjToCell,e._malloc=yt._malloc,e._maxFaceCount=yt._maxFaceCount,e._maxGridDiskSize=yt._maxGridDiskSize,e._maxPolygonToCellsSize=yt._maxPolygonToCellsSize,e._memcpy=yt._memcpy,e._memset=yt._memset,e._originToDirectedEdges=yt._originToDirectedEdges,e._pentagonCount=yt._pentagonCount,e._polygonToCells=yt._polygonToCells,e._readInt64AsDoubleFromPointer=yt._readInt64AsDoubleFromPointer,e._res0CellCount=yt._res0CellCount,e._round=yt._round,e._sbrk=yt._sbrk,e._sizeOfCellBoundary=yt._sizeOfCellBoundary,e._sizeOfCoordIJ=yt._sizeOfCoordIJ,e._sizeOfGeoLoop=yt._sizeOfGeoLoop,e._sizeOfGeoPolygon=yt._sizeOfGeoPolygon,e._sizeOfH3Index=yt._sizeOfH3Index,e._sizeOfLatLng=yt._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=yt._sizeOfLinkedGeoPolygon,e._uncompactCells=yt._uncompactCells,e._uncompactCellsSize=yt._uncompactCellsSize,e._vertexToLatLng=yt._vertexToLatLng,e.establishStackSpace=yt.establishStackSpace;var vi=e.stackAlloc=yt.stackAlloc,$=e.stackRestore=yt.stackRestore,ee=e.stackSave=yt.stackSave;if(e.asm=yt,e.cwrap=Z,e.setValue=B,e.getValue=F,ni){nn(ni)||(ni=o(ni));{Zs();var oe=function(he){he.byteLength&&(he=new Uint8Array(he)),Ve.set(he,I),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,ln()},fe=function(){s(ni,oe,function(){throw"could not load memory initializer "+ni})},be=Ks(ni);if(be)oe(be.buffer);else if(e.memoryInitializerRequest){var Oe=function(){var he=e.memoryInitializerRequest,Re=he.response;if(he.status!==200&&he.status!==0){var ze=Ks(e.memoryInitializerRequestURL);if(ze)Re=ze.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+he.status+", retrying "+ni),fe();return}}oe(Re)};e.memoryInitializerRequest.response?setTimeout(Oe,0):e.memoryInitializerRequest.addEventListener("load",Oe)}else fe()}}var De;$i=function he(){De||ce(),De||($i=he)};function ce(he){if(an>0||(Sr(),an>0))return;function Re(){De||(De=!0,!N&&(Ur(),Dt(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),$r()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),Re()},1)):Re()}e.run=ce;function we(he){throw e.onAbort&&e.onAbort(he),he+="",f(he),A(he),N=!0,"abort("+he+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=we,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return ce(),t}(typeof lr=="object"?lr:{}),jr="number",Pr=jr,np=jr,Or=jr,Dr=jr,Vs=jr,tr=jr,une=[["sizeOfH3Index",jr],["sizeOfLatLng",jr],["sizeOfCellBoundary",jr],["sizeOfGeoLoop",jr],["sizeOfGeoPolygon",jr],["sizeOfLinkedGeoPolygon",jr],["sizeOfCoordIJ",jr],["readInt64AsDoubleFromPointer",jr],["isValidCell",np,[Or,Dr]],["latLngToCell",Pr,[jr,jr,Vs,tr]],["cellToLatLng",Pr,[Or,Dr,tr]],["cellToBoundary",Pr,[Or,Dr,tr]],["maxGridDiskSize",Pr,[jr,tr]],["gridDisk",Pr,[Or,Dr,jr,tr]],["gridDiskDistances",Pr,[Or,Dr,jr,tr,tr]],["gridRingUnsafe",Pr,[Or,Dr,jr,tr]],["maxPolygonToCellsSize",Pr,[tr,Vs,jr,tr]],["polygonToCells",Pr,[tr,Vs,jr,tr]],["cellsToLinkedMultiPolygon",Pr,[tr,jr,tr]],["destroyLinkedMultiPolygon",null,[tr]],["compactCells",Pr,[tr,tr,jr,jr]],["uncompactCells",Pr,[tr,jr,jr,tr,jr,Vs]],["uncompactCellsSize",Pr,[tr,jr,jr,Vs,tr]],["isPentagon",np,[Or,Dr]],["isResClassIII",np,[Or,Dr]],["getBaseCellNumber",jr,[Or,Dr]],["getResolution",jr,[Or,Dr]],["maxFaceCount",Pr,[Or,Dr,tr]],["getIcosahedronFaces",Pr,[Or,Dr,tr]],["cellToParent",Pr,[Or,Dr,Vs,tr]],["cellToChildren",Pr,[Or,Dr,Vs,tr]],["cellToCenterChild",Pr,[Or,Dr,Vs,tr]],["cellToChildrenSize",Pr,[Or,Dr,Vs,tr]],["cellToChildPos",Pr,[Or,Dr,Vs,tr]],["childPosToCell",Pr,[jr,jr,Or,Dr,Vs,tr]],["areNeighborCells",Pr,[Or,Dr,Or,Dr,tr]],["cellsToDirectedEdge",Pr,[Or,Dr,Or,Dr,tr]],["getDirectedEdgeOrigin",Pr,[Or,Dr,tr]],["getDirectedEdgeDestination",Pr,[Or,Dr,tr]],["isValidDirectedEdge",np,[Or,Dr]],["directedEdgeToCells",Pr,[Or,Dr,tr]],["originToDirectedEdges",Pr,[Or,Dr,tr]],["directedEdgeToBoundary",Pr,[Or,Dr,tr]],["gridDistance",Pr,[Or,Dr,Or,Dr,tr]],["gridPathCells",Pr,[Or,Dr,Or,Dr,tr]],["gridPathCellsSize",Pr,[Or,Dr,Or,Dr,tr]],["cellToLocalIj",Pr,[Or,Dr,Or,Dr,jr,tr]],["localIjToCell",Pr,[Or,Dr,tr,jr,tr]],["getHexagonAreaAvgM2",Pr,[Vs,tr]],["getHexagonAreaAvgKm2",Pr,[Vs,tr]],["getHexagonEdgeLengthAvgM",Pr,[Vs,tr]],["getHexagonEdgeLengthAvgKm",Pr,[Vs,tr]],["greatCircleDistanceM",jr,[tr,tr]],["greatCircleDistanceKm",jr,[tr,tr]],["greatCircleDistanceRads",jr,[tr,tr]],["cellAreaM2",Pr,[Or,Dr,tr]],["cellAreaKm2",Pr,[Or,Dr,tr]],["cellAreaRads2",Pr,[Or,Dr,tr]],["edgeLengthM",Pr,[Or,Dr,tr]],["edgeLengthKm",Pr,[Or,Dr,tr]],["edgeLengthRads",Pr,[Or,Dr,tr]],["getNumCells",Pr,[Vs,tr]],["getRes0Cells",Pr,[tr]],["res0CellCount",jr],["getPentagons",Pr,[jr,tr]],["pentagonCount",jr],["cellToVertex",Pr,[Or,Dr,jr,tr]],["cellToVertexes",Pr,[Or,Dr,tr]],["vertexToLatLng",Pr,[Or,Dr,tr]],["isValidVertex",np,[Or,Dr]]],hne=0,fne=1,dne=2,Ane=3,tD=4,pne=5,gne=6,mne=7,_ne=8,yne=9,vne=10,bne=11,xne=12,wne=13,Tne=14,Ene=15,Ps={};Ps[hne]="Success";Ps[fne]="The operation failed but a more specific error is not available";Ps[dne]="Argument was outside of acceptable range";Ps[Ane]="Latitude or longitude arguments were outside of acceptable range";Ps[tD]="Resolution argument was outside of acceptable range";Ps[pne]="Cell argument was not valid";Ps[gne]="Directed edge argument was not valid";Ps[mne]="Undirected edge argument was not valid";Ps[_ne]="Vertex argument was not valid";Ps[yne]="Pentagon distortion was encountered";Ps[vne]="Duplicate input";Ps[bne]="Cell arguments were not neighbors";Ps[xne]="Cell arguments had incompatible resolutions";Ps[wne]="Memory allocation failed";Ps[Tne]="Bounds of provided memory were insufficient";Ps[Ene]="Mode or flags argument was not valid";var Ox=1e3,rD=1001,iD=1002,Z_={};Z_[Ox]="Unknown unit";Z_[rD]="Array length out of bounds";Z_[iD]="Got unexpected null value for H3 index";var Sne="Unknown error";function nD(t,e,r){var i=r&&"value"in r,n=new Error((t[e]||Sne)+" (code: "+e+(i?", value: "+r.value:"")+")");return n.code=e,n}function sD(t,e){var r=arguments.length===2?{value:e}:{};return nD(Ps,t,r)}function K_(t,e){var r=arguments.length===2?{value:e}:{};return nD(Z_,t,r)}function Xs(t){if(t!==0)throw sD(t)}var Si={};une.forEach(function(e){Si[e[0]]=lr.cwrap.apply(lr,e)});var Id=16,iA=4,bP=4,Xl=8,Dx=8,Du=Si.sizeOfH3Index(),Fx=Si.sizeOfLatLng(),Cne=Si.sizeOfCellBoundary(),Pne=Si.sizeOfGeoPolygon(),Ip=Si.sizeOfGeoLoop(),Ine=Si.sizeOfLinkedGeoPolygon();Si.sizeOfCoordIJ();var jd={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function oD(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw sD(tD,t);return t}function aD(t){if(!t)throw K_(iD);return t}var Mne=Math.pow(2,32)-1;function lD(t){if(t>Mne)throw K_(rD,t);return t}var Rne=/[^0-9a-fA-F]/;function il(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||Rne.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),Id),r=parseInt(t.substring(t.length-8),Id);return[r,e]}function xP(t){if(t>=0)return t.toString(Id);t=t&2147483647;var e=cD(8,t.toString(Id)),r=(parseInt(e[0],Id)+8).toString(Id);return e=r+e.substring(1),e}function Bne(t,e){return xP(e)+cD(8,xP(t))}function cD(t,e){for(var r=t-e.length,i="",n=0;n<r;n++)i+="0";return i=i+e,i}function wP(t,e,r){for(var i=t.length,n=lr._calloc(i,Fx),o=r?1:0,s=r?0:1,f=0;f<i*2;f+=2)lr.HEAPF64.set([t[f/2][o],t[f/2][s]].map(AD),n/Xl+f);return lr.HEAPU32.set([i,n],e/iA),e}function One(t,e){var r=t.length-1,i=lr._calloc(Pne),n=0,o=n+Ip,s=o+iA;wP(t[0],i+n,e);var f;if(r>0){f=lr._calloc(r,Ip);for(var A=0;A<r;A++)wP(t[A+1],f+Ip*A,e)}return lr.setValue(i+o,r,"i32"),lr.setValue(i+s,f,"i32"),i}function Dne(t){var e=0,r=e+Ip,i=r+iA,n=iA;lr._free(lr.getValue(t+e+n,"i8*"));var o=lr.getValue(t+r,"i32");if(o>0){for(var s=lr.getValue(t+i,"i32"),f=0;f<o;f++)lr._free(lr.getValue(s+Ip*f+n,"i8*"));lr._free(s)}lr._free(t)}function Lx(t,e){e===void 0&&(e=0);var r=lr.getValue(t+Du*e,"i32"),i=lr.getValue(t+Du*e+iA,"i32");return i?Bne(r,i):null}function uD(t,e){return e===void 0&&(e=0),lr.getValue(t+Xl*e,"double")}function kx(t){return Si.readInt64AsDoubleFromPointer(t)}function Fne(t,e,r){lr.HEAPU32.set(il(t),e/iA+2*r)}function Nx(t,e){for(var r=[],i=0;i<e;i++){var n=Lx(t,i);n!==null&&r.push(n)}return r}function Lne(t,e){for(var r=e.length,i=0;i<r;i++)Fne(e[i],t,i)}function e_(t){return $ne(lr.getValue(t,"double"))}function hD(t){return[e_(t),e_(t+Xl)]}function fD(t){return[e_(t+Xl),e_(t)]}function kne(t,e,r){for(var i=lr.getValue(t,"i32"),n=t+Xl,o=[],s=e?fD:hD,f=0;f<i*2;f+=2)o.push(s(n+Xl*f));return r&&o.push(o[0]),o}function Nne(t,e){for(var r=[],i=fD,n,o,s,f;t;){for(r.push(n=[]),o=lr.getValue(t,"i8*");o;){for(n.push(s=[]),f=lr.getValue(o,"i8*");f;)s.push(i(f)),f=lr.getValue(f+Xl*2,"i8*");s.push(s[0]),o=lr.getValue(o+bP*2,"i8*")}t=lr.getValue(t+bP*2,"i8*")}return r}function Une(t){var e=il(t),r=e[0],i=e[1];return!!Si.isPentagon(r,i)}function Gb(t){var e=il(t),r=e[0],i=e[1];return Si.isValidCell(r,i)?Si.getResolution(r,i):-1}function Ux(t,e,r){var i=lr._malloc(Fx);lr.HEAPF64.set([t,e].map(AD),i/Xl);var n=lr._malloc(Du);try{return Xs(Si.latLngToCell(i,r,n)),aD(Lx(n))}finally{lr._free(n),lr._free(i)}}function zx(t){var e=lr._malloc(Fx),r=il(t),i=r[0],n=r[1];try{return Xs(Si.cellToLatLng(i,n,e)),hD(e)}finally{lr._free(e)}}function dD(t,e){var r=lr._malloc(Cne),i=il(t),n=i[0],o=i[1];try{return Xs(Si.cellToBoundary(n,o,r)),kne(r,e,e)}finally{lr._free(r)}}function zne(t,e){var r=il(t),i=r[0],n=r[1],o=lr._malloc(Du);try{return Xs(Si.cellToParent(i,n,e,o)),aD(Lx(o))}finally{lr._free(o)}}function Vne(t,e){var r=il(t),i=r[0],n=r[1],o=lr._malloc(Dx);try{Xs(Si.maxGridDiskSize(e,o));var s=lD(kx(o)),f=lr._calloc(s,Du);try{return Xs(Si.gridDisk(i,n,e,f)),Nx(f,s)}finally{lr._free(f)}}finally{lr._free(o)}}function jne(t,e,r){if(oD(e),r=!!r,t.length===0||t[0].length===0)return[];var i=typeof t[0][0]=="number"?[t]:t,n=One(i,r),o=lr._malloc(Dx);try{Xs(Si.maxPolygonToCellsSize(n,e,0,o));var s=lD(kx(o)),f=lr._calloc(s,Du);try{return Xs(Si.polygonToCells(n,e,0,f)),Nx(f,s)}finally{lr._free(f)}}finally{lr._free(o),Dne(n)}}function Hne(t,e){if(!t||!t.length)return[];var r=t.length,i=lr._calloc(r,Du);Lne(i,t);var n=lr._calloc(Ine);try{return Xs(Si.cellsToLinkedMultiPolygon(i,r,n)),Nne(n,e)}finally{Si.destroyLinkedMultiPolygon(n),lr._free(n),lr._free(i)}}function Gne(t){var e=il(t),r=e[0],i=e[1],n=6,o=lr._calloc(n,Du);try{return Xs(Si.originToDirectedEdges(r,i,o)),Nx(o,n)}finally{lr._free(o)}}function Wne(t,e){var r=il(t),i=r[0],n=r[1],o=il(e),s=o[0],f=o[1],A=lr._malloc(Dx);try{return Xs(Si.gridDistance(i,n,s,f,A)),kx(A)}finally{lr._free(A)}}function Xne(t,e){var r=il(t),i=r[0],n=r[1],o=lr._malloc(Xl);try{switch(e){case jd.m:Xs(Si.edgeLengthM(i,n,o));break;case jd.km:Xs(Si.edgeLengthKm(i,n,o));break;case jd.rads:Xs(Si.edgeLengthRads(i,n,o));break;default:throw K_(Ox,e)}return uD(o)}finally{lr._free(o)}}function qne(t,e){oD(t);var r=lr._malloc(Xl);try{switch(e){case jd.m:Xs(Si.getHexagonEdgeLengthAvgM(t,r));break;case jd.km:Xs(Si.getHexagonEdgeLengthAvgKm(t,r));break;default:throw K_(Ox,e)}return uD(r)}finally{lr._free(r)}}function AD(t){return t*Math.PI/180}function $ne(t){return t*180/Math.PI}function Vx(t,e){e=e===void 0?t[0][0]:e;for(const r of t){const i=r[0]-e;i>180?r[0]-=360:i<-180&&(r[0]+=360)}}function Zne(t,e,r){const[i,n]=zx(t),o=e.length;Vx(e,n);const s=e[0]===e[o-1]?o-1:o;for(let f=0;f<s;f++)e[f][0]=el(n,e[f][0],r),e[f][1]=el(i,e[f][1],r)}function Kne(t,e,r){const i=t(e,r),[n,o]=zx(i);return[o,n]}function TP(t,e=1){const r=dD(t,!0);return e!==1?Zne(t,r,e):Vx(r),r}function Yne(t){const e=new Float64Array(t.length*2);let r=0;for(const i of t)e[r++]=i[0],e[r++]=i[1];return e}const Jne=10;function Qne(t,e){let r;return t==null?r=e:typeof t=="object"?r={...t,coverage:e}:r={getHexagon:t,coverage:e},r}const ese={...Vu.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};class $l extends rs{initializeState(){$l._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:r}){if(e.highPrecision!==!0&&(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagon)){const i=this._calculateH3DataProps();this.setState(i)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,r=!1,i=!1;const{iterable:n,objectInfo:o}=ql(this.props.data);for(const s of n){o.index++;const f=this.props.getHexagon(s,o),A=Gb(f);if(e<0){if(e=A,!this.props.highPrecision)break}else if(e!==A){i=!0;break}if(Une(f)){r=!0;break}}return{resolution:e,edgeLengthKM:e>=0?qne(e,"km"):0,hasMultipleRes:i,hasPentagon:r}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:r,hasMultipleRes:i}=this.state,{viewport:n}=this.context;return!!(n!=null&&n.resolution)||i||r||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:r,edgeLengthKM:i,centerHex:n}=this.state;if(r<0)return;const o=this.props.centerHexagon||Ux(e.latitude,e.longitude,r);if(n===o)return;if(n)try{if(Wne(n,o)*i<Jne)return}catch{}const{unitsPerMeter:s}=e.distanceScales;let f=TP(o);const[A,v]=zx(o),[w,C]=e.projectFlat([v,A]);f=f.map(I=>{const B=e.projectFlat(I);return[(B[0]-w)/s[0],(B[1]-C)/s[1]]}),this.setState({centerHex:o,vertices:f})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:r,coverage:i,extruded:n,wireframe:o,stroked:s,filled:f,lineWidthUnits:A,lineWidthScale:v,lineWidthMinPixels:w,lineWidthMaxPixels:C,getFillColor:I,getElevation:B,getLineColor:F,getLineWidth:N,transitions:V,updateTriggers:G}=this.props;return{elevationScale:e,extruded:n,coverage:i,wireframe:o,stroked:s,filled:f,lineWidthUnits:A,lineWidthScale:v,lineWidthMinPixels:w,lineWidthMaxPixels:C,material:r,getElevation:B,getFillColor:I,getLineColor:F,getLineWidth:N,transitions:V,updateTriggers:{getFillColor:G.getFillColor,getElevation:G.getElevation,getLineColor:G.getLineColor,getLineWidth:G.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:r,updateTriggers:i,coverage:n}=this.props,o=this.getSubLayerClass("hexagon-cell-hifi",Vu),s=this._getForwardProps();return s.updateTriggers.getPolygon=Qne(i.getHexagon,n),new o(s,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:s.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(f,A)=>{const v=r(f,A);return Yne(TP(v,n))}})}_renderColumnLayer(){const{data:e,getHexagon:r,updateTriggers:i}=this.props,n=this.getSubLayerClass("hexagon-cell",Lc),o=this._getForwardProps();return o.updateTriggers.getPosition=i.getHexagon,new n(o,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:o.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:Kne.bind(null,r)})}}$l.defaultProps=ese;$l.layerName="H3HexagonLayer";$l._checkH3Lib=()=>{};const tse={getHexagons:{type:"accessor",value:t=>t.hexagons}};class Y_ extends Hu{initializeState(){$l._checkH3Lib()}updateState({props:e,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagons){const{data:i,getHexagons:n}=e,o=[],{iterable:s,objectInfo:f}=ql(i);for(const A of s){f.index++;const v=n(A,f),w=Hne(v,!0);for(const C of w){for(const I of C)Vx(I);o.push(this.getSubLayerRow({polygon:C},A,f.index))}}this.setState({polygons:o})}}indexToBounds(){const{getElevation:e,getFillColor:r,getLineColor:i,getLineWidth:n}=this.props;return{data:this.state.polygons,getPolygon:o=>o.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(r),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(n)}}}Y_.layerName="H3ClusterLayer";Y_.defaultProps=tse;const qv=Math.PI/180,Ug=new Float32Array(16),EP=new Float32Array(12);function SP(t,e,r){const i=e[0]*qv,n=e[1]*qv,o=e[2]*qv,s=Math.sin(o),f=Math.sin(i),A=Math.sin(n),v=Math.cos(o),w=Math.cos(i),C=Math.cos(n),I=r[0],B=r[1],F=r[2];t[0]=I*C*w,t[1]=I*A*w,t[2]=I*-f,t[3]=B*(-A*v+C*f*s),t[4]=B*(C*v+A*f*s),t[5]=B*w*s,t[6]=F*(A*s+C*f*v),t[7]=F*(-C*s+A*f*v),t[8]=F*w*v}function CP(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const pD={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:r}){const{data:i,getOrientation:n,getScale:o,getTranslation:s,getTransformMatrix:f}=this.props,A=Array.isArray(f),v=A&&f.length===16,w=Array.isArray(o),C=Array.isArray(n),I=Array.isArray(s),B=v||!A&&!!f(i[0]);B?t.constant=v:t.constant=C&&w&&I;const F=t.value;if(t.constant){let N;B?(Ug.set(f),N=CP(Ug)):(N=EP,SP(N,n,o),N.set(s,9)),t.value=new Float32Array(N)}else{let N=e*t.size;const{iterable:V,objectInfo:G}=ql(i,e,r);for(const Y of V){G.index++;let Z;if(B)Ug.set(v?f:f(Y,G)),Z=CP(Ug);else{Z=EP;const se=C?n:n(Y,G),ge=w?o:o(Y,G);SP(Z,se,ge),Z.set(I?s:s(Y,G),9)}F[N++]=Z[0],F[N++]=Z[1],F[N++]=Z[2],F[N++]=Z[3],F[N++]=Z[4],F[N++]=Z[5],F[N++]=Z[6],F[N++]=Z[7],F[N++]=Z[8],F[N++]=Z[9],F[N++]=Z[10],F[N++]=Z[11]}}}};function gD(t,e){return e===br.CARTESIAN||e===br.METER_OFFSETS||e===br.DEFAULT&&!t.isGeospatial}const rse=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ise=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function $v(t){const e=t.positions||t.POSITION;fr.assert(e,'no "postions" or "POSITION" attribute in mesh');const r=e.value.length/e.size;let i=t.COLOR_0||t.colors;i||(i={size:3,value:new Float32Array(r*3).fill(1)});let n=t.NORMAL||t.normals;n||(n={size:3,value:new Float32Array(r*3).fill(0)});let o=t.TEXCOORD_0||t.texCoords;return o||(o={size:2,value:new Float32Array(r*2).fill(0)}),{positions:e,colors:i,normals:n,texCoords:o}}function PP(t){return t instanceof _s?(t.attributes=$v(t.attributes),t):t.attributes?new _s({...t,topology:"triangle-list",attributes:$v(t.attributes)}):new _s({topology:"triangle-list",attributes:$v(t)})}const nse=[0,0,0,255],sse={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:nse},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class zh extends Wn{getShaders(){return super.getShaders({vs:rse,fs:ise,modules:[uo,pB,Mo]})}getBounds(){var i;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:r}=this.props;if(!r)return null;if(e=(i=r.header)==null?void 0:i.boundingBox,!e){const{attributes:n}=PP(r);n.POSITION=n.POSITION||n.positions,e=m2(n)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:pD}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var o;super.updateState(e);const{props:r,oldProps:i,changeFlags:n}=e;if(r.mesh!==i.mesh||n.extensionsChanged){if(this.state.positionBounds=null,(o=this.state.model)==null||o.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);const s=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==i.texture&&r.texture instanceof Zo&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:r}=this.state;if(!r)return;const{viewport:i,renderPass:n}=this.context,{sizeScale:o,coordinateSystem:s,_instanced:f}=this.props;r.setUniforms(e),r.setUniforms({sizeScale:o,composeModelMatrix:!f||gD(i,s),flatShading:!this.state.hasNormals}),r.draw(n)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const r=new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:PP(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state;return r.setBindings({sampler:i||n}),r.setUniforms({hasTexture:!!i}),r}setTexture(e){const{emptyTexture:r,model:i}=this.state;i&&(i.setBindings({sampler:e||r}),i.setUniforms({hasTexture:!!e}))}}zh.defaultProps=sse;zh.layerName="SimpleMeshLayer";var $a;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})($a||($a={}));function mD(t,e,r,i){const n={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};n.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:o}=i;return o&&(n.bindings.u_DiffuseEnvSampler=o.diffuseEnvSampler,n.bindings.u_SpecularEnvSampler=o.specularEnvSampler,n.bindings.u_brdfLUT=o.brdfLutTexture,n.uniforms.u_ScaleIBLAmbient=[1,1]),i!=null&&i.pbrDebug&&(n.defines.PBR_DEBUG=1,n.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],n.uniforms.u_ScaleFGDSpec=[0,0,0,0]),r.NORMAL&&(n.defines.HAS_NORMALS=1),r.TANGENT&&(i!=null&&i.useTangents)&&(n.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(n.defines.HAS_UV=1),i!=null&&i.imageBasedLightingEnvironment&&(n.defines.USE_IBL=1),i!=null&&i.lights&&(n.defines.USE_LIGHTS=1),e&&ose(t,e,n),n}function ose(t,e,r){if(r.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&ase(t,e.pbrMetallicRoughness,r),e.normalTexture){Mp(t,e.normalTexture,"u_NormalSampler","HAS_NORMALMAP",r);const{scale:i=1}=e.normalTexture;r.uniforms.u_NormalScale=i}if(e.occlusionTexture){Mp(t,e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",r);const{strength:i=1}=e.occlusionTexture;r.uniforms.u_OcclusionStrength=i}switch(e.emissiveTexture&&(Mp(t,e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:i=.5}=e;r.defines.ALPHA_CUTOFF=1,r.uniforms.u_AlphaCutoff=i;break;case"BLEND":Et.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=$a.FUNC_ADD,r.glParameters.blendFunc=[$a.SRC_ALPHA,$a.ONE_MINUS_SRC_ALPHA,$a.ONE,$a.ONE_MINUS_SRC_ALPHA];break}}function ase(t,e,r){e.baseColorTexture&&Mp(t,e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&Mp(t,e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);const{metallicFactor:i=1,roughnessFactor:n=1}=e;r.uniforms.u_MetallicRoughnessValues=[i,n]}function Mp(t,e,r,i=null,n){var w,C;const o=((C=(w=e==null?void 0:e.texture)==null?void 0:w.sampler)==null?void 0:C.parameters)||{},s=e.texture.source.image;let f,A={};s.compressed?(f=s,A={[$a.TEXTURE_MIN_FILTER]:s.data.length>1?$a.LINEAR_MIPMAP_NEAREST:$a.LINEAR}):f={data:s};const v=t.createTexture({id:e.uniformName||e.id,parameters:{...o,...A},pixelStore:{[$a.UNPACK_FLIP_Y_WEBGL]:!1},...f});n.bindings[r]=v,i&&(n.defines[i]=1),n.generatedTextures.push(v)}const lse={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cse={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class use{constructor(e){U(this,"name");U(this,"startTime",0);U(this,"playing",!0);U(this,"speed",1);U(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:n,target:o,path:s})=>{mse(i,n,o,s),dse(o,o._node)})}}class hse{constructor(e){U(this,"animations");this.animations=e.animations.map((r,i)=>{const n=r.name||`Animation-${i}`,o=r.samplers.map(({input:f,interpolation:A="LINEAR",output:v})=>({input:IP(e.accessors[f]),interpolation:A,output:IP(e.accessors[v])})),s=r.channels.map(({sampler:f,target:A})=>({sampler:o[f],target:e.nodes[A.node],path:A.path}));return new use({name:n,channels:s})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(r=>r.animate(e))}getAnimations(){return this.animations}}function IP(t){if(!t._animation){const e=cse[t.componentType],r=lse[t.type],i=r*t.count,{buffer:n,byteOffset:o}=t.bufferView.data,s=new e(n,o+(t.byteOffset||0),i);if(r===1)t._animation=Array.from(s);else{const f=[];for(let A=0;A<s.length;A+=r)f.push(Array.from(s.slice(A,A+r)));t._animation=f}}return t._animation}const fse=new Gr;function dse(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const r=fse.fromQuaternion(t.rotation);e.matrix.multiplyRight(r)}t.scale&&e.matrix.scale(t.scale)}const Zv=new Up;function Ase(t,e,r,i,n){if(e==="rotation"){Zv.slerp({start:r,target:i,ratio:n});for(let o=0;o<Zv.length;o++)t[e][o]=Zv[o]}else for(let o=0;o<r.length;o++)t[e][o]=n*i[o]+(1-n)*r[o]}function pse(t,e,{p0:r,outTangent0:i,inTangent1:n,p1:o,tDiff:s,ratio:f}){for(let A=0;A<t[e].length;A++){const v=i[A]*s,w=n[A]*s;t[e][A]=(2*Math.pow(f,3)-3*Math.pow(f,2)+1)*r[A]+(Math.pow(f,3)-2*Math.pow(f,2)+f)*v+(-2*Math.pow(f,3)+3*Math.pow(f,2))*o[A]+(Math.pow(f,3)-Math.pow(f,2))*w}}function gse(t,e,r){for(let i=0;i<r.length;i++)t[e][i]=r[i]}function mse(t,{input:e,interpolation:r,output:i},n,o){const s=e[e.length-1],f=t%s,A=e.findIndex(I=>I>=f),v=Math.max(0,A-1);if(!Array.isArray(n[o]))switch(o){case"translation":n[o]=[0,0,0];break;case"rotation":n[o]=[0,0,0,1];break;case"scale":n[o]=[1,1,1];break;default:Et.warn(`Bad animation path ${o}`)()}_i(n[o].length===i[v].length);const w=e[v],C=e[A];switch(r){case"STEP":gse(n,o,i[v]);break;case"LINEAR":if(C>w){const I=(f-w)/(C-w);Ase(n,o,i[v],i[A],I)}break;case"CUBICSPLINE":if(C>w){const I=(f-w)/(C-w),B=C-w,F=i[3*v+1],N=i[3*v+2],V=i[3*A+0],G=i[3*A+1];pse(n,o,{p0:F,outTangent0:N,inTangent1:V,p1:G,tDiff:B,ratio:I})}break;default:Et.warn(`Interpolation ${r} not supported`)();break}}const _se=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,yse=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function vse(t,e){const{id:r,geometry:i,material:n,vertexCount:o,materialOptions:s,modelOptions:f}=e,A=mD(t,n,i.attributes,s);Et.info(4,"createGLTFModel defines: ",A.defines)();const v=[],w={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},C={id:r,geometry:i,topology:i.topology,vertexCount:o,modules:[D2],vs:MP(t,_se),fs:MP(t,yse),...f,bindings:{...A.bindings,...f.bindings},defines:{...A.defines,...f.defines},parameters:{...w,...A.parameters,...f.parameters},uniforms:{...A.uniforms,...f.uniforms}},I=new zi(t,C);return new eb({managedResources:v,model:I})}function MP(t,e){return`#version 300 es
${e}`}const bse={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class xse{constructor(e,r={}){U(this,"device");U(this,"options");U(this,"gltf");this.device=e,this.options={...bse,...r}}instantiate(e){return this.gltf=e,(e.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new hse(this.gltf):null}createScene(e){const i=(e.nodes||[]).map(o=>this.createNode(o));return new Ld({id:e.name||e.id,children:i})}createNode(e){if(!e._node){const i=(e.children||[]).map(o=>this.createNode(o));e.mesh&&i.push(this.createMesh(e.mesh));const n=new Ld({id:e.name||e.id,children:i});if(e.matrix)n.setMatrix(e.matrix);else{if(n.matrix.identity(),e.translation&&n.matrix.translate(e.translation),e.rotation){const o=new Gr().fromQuaternion(e.rotation);n.matrix.multiplyRight(o)}e.scale&&n.matrix.scale(e.scale)}e._node=n}return e._node}createMesh(e){if(!e._mesh){const i=(e.primitives||[]).map((o,s)=>this.createPrimitive(o,s,e)),n=new Ld({id:e.name||e.id,children:i});e._mesh=n}return e._mesh}createPrimitive(e,r,i){const n=e.name||`${i.name||i.id}-primitive-${r}`,o=wse(e.mode||4),s=e.indices?e.indices.count:this.getVertexCount(e.attributes),f=vse(this.device,{id:n,geometry:this.createGeometry(n,e,o),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:s});return f.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],f}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,r,i){const n={};for(const[o,s]of Object.entries(r.attributes)){const{components:f,size:A,value:v}=s;n[o]={size:A??f,value:v}}return new _s({id:e,topology:i,indices:r.indices.value,attributes:n})}createBuffer(e,r){e.bufferView||(e.bufferView={});const{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[r]||(i.lumaBuffers[r]=this.device.createBuffer({id:`from-${i.id}`,data:i.data||e.value})),i.lumaBuffers[r]}createSampler(e){return e}needsPOT(){return!1}}var vc;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(vc||(vc={}));function wse(t){switch(t){case vc.POINTS:return"point-list";case vc.LINES:return"line-list";case vc.LINE_STRIP:return"line-strip";case vc.LINE_LOOP:return"line-loop-webgl";case vc.TRIANGLES:return"triangle-list";case vc.TRIANGLE_STRIP:return"triangle-strip";case vc.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(t)}}function Tse(t,e,r){const i=new xse(t,r),n=i.instantiate(e),o=i.createAnimator();return{scenes:n,animator:o}}async function Ese(t){const e=[];return t.scenes.forEach(r=>{r.traverse(i=>{Object.values(i.model.uniforms).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await Sse(()=>e.some(r=>!r.loaded))}async function Sse(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const Cse=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Pse=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,_D=[255,255,255,255],Ise={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:_D},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[tA]};class g0 extends Wn{getShaders(){const e=[uo,Mo];return this.props._lighting==="pbr"&&e.push(D2),super.getShaders({vs:Cse,fs:Pse,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:_D,transition:!0},instanceModelMatrix:pD})}updateState(e){super.updateState(e);const{props:r,oldProps:i}=e;r.scenegraph!==i.scenegraph?this._updateScenegraph():r._animations!==i._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(e){var r;super.finalizeState(e),(r=this.state.scenegraph)==null||r.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var f;const e=this.props,{device:r}=this.context;let i=null;if(e.scenegraph instanceof Om)i={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const A=e.scenegraph,v=A.json?yx(A):A,w=Tse(r,v,this._getModelOptions());i={gltf:v,...w},Ese(w).then(()=>{this.setNeedsRedraw()}).catch(C=>{this.raiseError(C,"loading glTF")})}const n={layer:this,device:this.context.device},o=e.getScene(i,n),s=e.getAnimator(i,n);if(o instanceof Ld){(f=this.state.scenegraph)==null||f.destroy(),this._applyAnimationsProp(s,e._animations);const A=[];o.traverse(v=>{v instanceof eb&&A.push(v.model)}),this.setState({scenegraph:o,animator:s,models:A}),this.getAttributeManager().invalidateAll()}else o!==null&&fr.warn("invalid scenegraph:",o)()}_applyAnimationsProp(e,r){if(!e||!r)return;const i=e.getAnimations();Object.keys(r).sort().forEach(n=>{const o=r[n];if(n==="*")i.forEach(s=>{Object.assign(s,o)});else if(Number.isFinite(Number(n))){const s=Number(n);s>=0&&s<i.length?Object.assign(i[s],o):fr.warn(`animation ${n} not found`)()}else{const s=i.find(({name:f})=>f===n);s?Object.assign(s,o):fr.warn(`animation ${n} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let r;return e&&(typeof e=="function"?r=e({gl:this.context.gl,layer:this}):r=e),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:r,renderPass:i}=this.context,{sizeScale:n,sizeMinPixels:o,sizeMaxPixels:s,opacity:f,coordinateSystem:A}=this.props,v=this.getNumInstances();this.state.scenegraph.traverse((w,{worldMatrix:C})=>{if(w instanceof eb){const{model:I}=w;I.setInstanceCount(v),I.setUniforms({sizeScale:n,opacity:f,sizeMinPixels:o,sizeMaxPixels:s,composeModelMatrix:gD(r,A),sceneModelMatrix:C,u_Camera:I.uniforms.project_uCameraPosition}),I.draw(i)}})}}g0.defaultProps=Ise;g0.layerName="ScenegraphLayer";const Mse=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:g0,SimpleMeshLayer:zh},Symbol.toStringTag,{value:"Module"})),Rse=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Bse=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Ose(t){const e=t.positions||t.POSITION,r=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}const Dse={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class jx extends zh{getShaders(){const e=super.getShaders();return e.modules.push(D2),{...e,vs:Rse,fs:Bse}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const r=this.getAttributeManager();e&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:r,oldProps:i}=e;r.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(e){const{featureIds:r}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!r}),super.draw(e))}getModel(e){const{id:r,pbrMaterial:i}=this.props,n=this.parseMaterial(i,e);this.setState({parsedPBRMaterial:n});const o=this.getShaders();return Ose(e.attributes),new zi(this.context.device,{...this.getShaders(),id:r,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...o.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:r}=this.state;if(r){const{mesh:i}=this.props,n=this.parseMaterial(e,i);this.setState({parsedPBRMaterial:n}),r.setBindings(n.bindings),r.setUniforms(n.uniforms)}}parseMaterial(e,r){const i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return mD(this.context.device,{unlit:i,...e},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const r=this.props.featureIds,i=new Uint8ClampedArray(r.length*e.size),n=[];for(let o=0;o<r.length;o++)this.encodePickingColor(r[o],n),i[o*3]=n[0],i[o*3+1]=n[1],i[o*3+2]=n[2];e.value=i}finalizeState(e){var r;super.finalizeState(e),(r=this.state.parsedPBRMaterial)==null||r.generatedTextures.forEach(i=>i.destroy()),this.setState({parsedPBRMaterial:null})}}jx.layerName="MeshLayer";jx.defaultProps=Dse;const Fse=6378137,Lse=6378137,kse=6356752314245179e-9;function J_(t){return t}new Ke;function Nse(t,e=[],r=J_){return"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):"x"in t?(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function Use(t,e=[]){return Nse(t,e,ts._cartographicRadians?J_:g9)}function zse(t,e,r=J_){return"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):"x"in e?(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function Vse(t,e){return zse(t,e,ts._cartographicRadians?J_:m9)}const RP=1e-14,jse=new Ke,BP={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Kv={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},sp={east:new Ke,north:new Ke,up:new Ke,west:new Ke,south:new Ke,down:new Ke},Hse=new Ke,Gse=new Ke,Wse=new Ke;function OP(t,e,r,i,n,o){const s=BP[e]&&BP[e][r];qa(s&&(!i||i===s));let f,A,v;const w=jse.copy(n);if(Ca(w.x,0,RP)&&Ca(w.y,0,RP)){const I=Math.sign(w.z);f=Hse.fromArray(Kv[e]),e!=="east"&&e!=="west"&&f.scale(I),A=Gse.fromArray(Kv[r]),r!=="east"&&r!=="west"&&A.scale(I),v=Wse.fromArray(Kv[i]),i!=="east"&&i!=="west"&&v.scale(I)}else{const{up:I,east:B,north:F}=sp;B.set(-w.y,w.x,0).normalize(),t.geodeticSurfaceNormal(w,I),F.copy(I).cross(B);const{down:N,west:V,south:G}=sp;N.copy(I).scale(-1),V.copy(B).scale(-1),G.copy(F).scale(-1),f=sp[e],A=sp[r],v=sp[i]}return o[0]=f.x,o[1]=f.y,o[2]=f.z,o[3]=0,o[4]=A.x,o[5]=A.y,o[6]=A.z,o[7]=0,o[8]=v.x,o[9]=v.y,o[10]=v.z,o[11]=0,o[12]=w.x,o[13]=w.y,o[14]=w.z,o[15]=1,o}const td=new Ke,Xse=new Ke,qse=new Ke;function $se(t,e,r=[]){const{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:o}=e;td.from(t);const s=td.x,f=td.y,A=td.z,v=i.x,w=i.y,C=i.z,I=s*s*v*v,B=f*f*w*w,F=A*A*C*C,N=I+B+F,V=Math.sqrt(1/N);if(!Number.isFinite(V))return;const G=Xse;if(G.copy(t).scale(V),N<o)return G.to(r);const Y=n.x,Z=n.y,se=n.z,ge=qse;ge.set(G.x*Y*2,G.y*Z*2,G.z*se*2);let Pe=(1-V)*td.len()/(.5*ge.len()),Ue=0,Fe,pe,Te,Ae;do{Pe-=Ue,Fe=1/(1+Pe*Y),pe=1/(1+Pe*Z),Te=1/(1+Pe*se);const Le=Fe*Fe,Ve=pe*pe,Xe=Te*Te,dt=Le*Fe,Nt=Ve*pe,gr=Xe*Te;Ae=I*Le+B*Ve+F*Xe-1;const _r=-2*(I*dt*Y+B*Nt*Z+F*gr*se);Ue=Ae/_r}while(Math.abs(Ae)>Lz);return td.scale([Fe,pe,Te]).to(r)}const zg=new Ke,DP=new Ke,Zse=new Ke,ja=new Ke,Kse=new Ke,Vg=new Ke;class Ui{constructor(e=0,r=0,i=0){this.centerToleranceSquared=Fz,qa(e>=0),qa(r>=0),qa(i>=0),this.radii=new Ke(e,r,i),this.radiiSquared=new Ke(e*e,r*r,i*i),this.radiiToTheFourth=new Ke(e*e*e*e,r*r*r*r,i*i*i*i),this.oneOverRadii=new Ke(e===0?0:1/e,r===0?0:1/r,i===0?0:1/i),this.oneOverRadiiSquared=new Ke(e===0?0:1/(e*e),r===0?0:1/(r*r),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,r,i),this.maximumRadius=Math.max(e,r,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,r=[0,0,0]){const i=DP,n=Zse,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,i),n.copy(this.radiiSquared).scale(i);const s=Math.sqrt(i.dot(n));return n.scale(1/s),i.scale(o),n.add(i),n.to(r)}cartesianToCartographic(e,r=[0,0,0]){Vg.from(e);const i=this.scaleToGeodeticSurface(Vg,ja);if(!i)return;const n=this.geodeticSurfaceNormal(i,DP),o=Kse;o.copy(Vg).subtract(i);const s=Math.atan2(n.y,n.x),f=Math.asin(n.z),A=Math.sign(P2(o,Vg))*eB(o);return Vse([s,f,A],r)}eastNorthUpToFixedFrame(e,r=new Gr){return OP(this,"east","north","up",e,r)}localFrameToFixedFrame(e,r,i,n,o=new Gr){return OP(this,e,r,i,n,o)}geocentricSurfaceNormal(e,r=[0,0,0]){return zg.from(e).normalize().to(r)}geodeticSurfaceNormalCartographic(e,r=[0,0,0]){const i=Use(e),n=i[0],o=i[1],s=Math.cos(o);return zg.set(s*Math.cos(n),s*Math.sin(n),Math.sin(o)).normalize(),zg.to(r)}geodeticSurfaceNormal(e,r=[0,0,0]){return zg.from(e).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(e,r){return $se(e,this,r)}scaleToGeocentricSurface(e,r=[0,0,0]){ja.from(e);const i=ja.x,n=ja.y,o=ja.z,s=this.oneOverRadiiSquared,f=1/Math.sqrt(i*i*s.x+n*n*s.y+o*o*s.z);return ja.multiplyScalar(f).to(r)}transformPositionToScaledSpace(e,r=[0,0,0]){return ja.from(e).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(e,r=[0,0,0]){return ja.from(e).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(e,r=0,i=[0,0,0]){qa(Ca(this.radii.x,this.radii.y,hB)),qa(this.radii.z>0),ja.from(e);const n=ja.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-r))return ja.set(0,0,n).to(i)}}Ui.WGS84=new Ui(Fse,Lse,kse);class Yse{constructor(e,r,i){U(this,"item");U(this,"previous");U(this,"next");this.item=e,this.previous=r,this.next=i}}class Jse{constructor(){U(this,"head",null);U(this,"tail",null);U(this,"_length",0)}get length(){return this._length}add(e){const r=new Yse(e,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,r){e!==r&&(this.remove(r),this._insert(e,r))}_insert(e,r){const i=e.next;e.next=r,this.tail===e?this.tail=r:i.previous=r,r.next=i,r.previous=e,++this._length}}class Qse{constructor(){U(this,"_list");U(this,"_sentinel");U(this,"_trimTiles");this._list=new Jse,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const r=e._cacheNode;r&&this._list.splice(this._sentinel,r)}add(e,r,i){r._cacheNode||(r._cacheNode=this._list.add(r),i&&i(e,r))}unloadTile(e,r,i){const n=r._cacheNode;n&&(this._list.remove(n),r._cacheNode=null,i&&i(e,r))}unloadTiles(e,r){const i=this._trimTiles;this._trimTiles=!1;const n=this._list,o=e.maximumMemoryUsage*1024*1024,s=this._sentinel;let f=n.head;for(;f!==s&&(e.gpuMemoryUsageInBytes>o||i);){const A=f.item;f=f.next,this.unloadTile(e,A,r)}}trim(){this._trimTiles=!0}}function eoe(t,e){Ni(t),Ni(e);const{rtcCenter:r,gltfUpAxis:i}=e,{computedTransform:n,boundingVolume:{center:o}}=t;let s=new Gr(n);switch(r&&s.translate(r),i){case"Z":break;case"Y":const C=new Gr().rotateX(Math.PI/2);s=s.multiplyRight(C);break;case"X":const I=new Gr().rotateY(-Math.PI/2);s=s.multiplyRight(I);break}e.isQuantized&&s.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const f=new Ke(o);e.cartesianModelMatrix=s,e.cartesianOrigin=f;const A=Ui.WGS84.cartesianToCartographic(f,new Ke),w=Ui.WGS84.eastNorthUpToFixedFrame(f).invert();e.cartographicModelMatrix=w.multiplyRight(s),e.cartographicOrigin=A,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const FP=new Ke,Yv=new Ke,Wb=new Jo([new Xa,new Xa,new Xa,new Xa,new Xa,new Xa]);function toe(t,e){const{cameraDirection:r,cameraUp:i,height:n}=t,{metersPerUnit:o}=t.distanceScales,s=Am(t,t.center),f=Ui.WGS84.eastNorthUpToFixedFrame(s),A=t.unprojectPosition(t.cameraPosition),v=Ui.WGS84.cartographicToCartesian(A,new Ke),w=new Ke(f.transformAsVector(new Ke(r).scale(o))).normalize(),C=new Ke(f.transformAsVector(new Ke(i).scale(o))).normalize();ioe(t);const I=t.constructor,{longitude:B,latitude:F,width:N,bearing:V,zoom:G}=t,Y=new I({longitude:B,latitude:F,height:n,width:N,bearing:V,zoom:G,pitch:0});return{camera:{position:v,direction:w,up:C},viewport:t,topDownViewport:Y,height:n,cullingVolume:Wb,frameNumber:e,sseDenominator:1.15}}function roe(t,e,r){if(r===0||t.length<=r)return[t,[]];const i=[],{longitude:n,latitude:o}=e.viewport;for(const[v,w]of t.entries()){const[C,I]=w.header.mbs,B=Math.abs(n-C),F=Math.abs(o-I),N=Math.sqrt(F*F+B*B);i.push([v,N])}const s=i.sort((v,w)=>v[1]-w[1]),f=[];for(let v=0;v<r;v++)f.push(t[s[v][0]]);const A=[];for(let v=r;v<s.length;v++)A.push(t[s[v][0]]);return[f,A]}function ioe(t){const e=t.getFrustumPlanes(),r=LP(e.near,t.cameraPosition),i=Am(t,r),n=Am(t,t.cameraPosition,Yv);let o=0;Wb.planes[o++].fromPointNormal(i,FP.copy(i).subtract(n));for(const s in e){if(s==="near")continue;const f=e[s],A=LP(f,r,Yv),v=Am(t,A,Yv);Wb.planes[o++].fromPointNormal(v,FP.copy(i).subtract(v))}}function LP(t,e,r=new Ke){const i=t.normal.dot(e);return r.copy(t.normal).scale(t.distance-i).add(e),r}function Am(t,e,r=new Ke){const i=t.unprojectPosition(e);return Ui.WGS84.cartographicToCartesian(i,r)}const noe=6378137,soe=6378137,Xb=6356752314245179e-9,Md=new Ke;function ooe(t,e){if(t instanceof p0){const{halfAxes:r}=t,i=loe(r);return Math.log2(Xb/(i+e[2]))}else if(t instanceof A0){const{radius:r}=t;return Math.log2(Xb/(r+e[2]))}else if(t.width&&t.height){const{width:r,height:i}=t,n=Math.log2(noe/r),o=Math.log2(soe/i);return(n+o)/2}return 1}function yD(t,e,r){Ui.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],Md);const i=Math.sqrt(Math.pow(Md[0]-r[0],2)+Math.pow(Md[1]-r[1],2)+Math.pow(Md[2]-r[2],2));return Math.log2(Xb/(i+e[2]))}function aoe(t,e,r){const[i,n,o,s]=t;return yD({xmin:i,xmax:o,ymin:n,ymax:s,zmin:0,zmax:0},e,r)}function loe(t){t.getColumn(0,Md);const e=t.getColumn(1),r=t.getColumn(2);return Md.add(e).add(r).len()}const $o={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var tl;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(tl||(tl={}));var Sc;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Sc||(Sc={}));var So;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(So||(So={}));var nA;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(nA||(nA={}));const coe={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function vD(t){return t!=null}const Gs=new Ke,pm=new Ke,uoe=new Ke,hoe=new Ke,mh=new Ke,kP=new Ke,NP=new Ke,UP=new Ke;function Jv(t,e,r){if(Ni(t,"3D Tile: boundingVolume must be defined"),t.box)return bD(t.box,e,r);if(t.region)return Aoe(t.region);if(t.sphere)return doe(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function foe(t,e){if(t.box)return poe(e);if(t.region){const[r,i,n,o,s,f]=t.region;return[[Wa(r),Wa(i),s],[Wa(n),Wa(o),f]]}if(t.sphere)return goe(e);throw new Error("Unkown boundingVolume type")}function bD(t,e,r){const i=new Ke(t[0],t[1],t[2]);e.transform(i,i);let n=[];if(t.length===10){const v=t.slice(3,6),w=new Up;w.fromArray(t,6);const C=new Ke([1,0,0]),I=new Ke([0,1,0]),B=new Ke([0,0,1]);C.transformByQuaternion(w),C.scale(v[0]),I.transformByQuaternion(w),I.scale(v[1]),B.transformByQuaternion(w),B.scale(v[2]),n=[...C.toArray(),...I.toArray(),...B.toArray()]}else n=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const o=e.transformAsVector(n.slice(0,3)),s=e.transformAsVector(n.slice(3,6)),f=e.transformAsVector(n.slice(6,9)),A=new Mn([o[0],o[1],o[2],s[0],s[1],s[2],f[0],f[1],f[2]]);return vD(r)?(r.center=i,r.halfAxes=A,r):new p0(i,A)}function doe(t,e,r){const i=new Ke(t[0],t[1],t[2]);e.transform(i,i);const n=e.getScale(pm),o=Math.max(Math.max(n[0],n[1]),n[2]),s=t[3]*o;return vD(r)?(r.center=i,r.radius=s,r):new A0(i,s)}function Aoe(t){const[e,r,i,n,o,s]=t,f=Ui.WGS84.cartographicToCartesian([Wa(e),Wa(n),o],uoe),A=Ui.WGS84.cartographicToCartesian([Wa(i),Wa(r),s],hoe),v=new Ke().addVectors(f,A).multiplyByScalar(.5);return Ui.WGS84.cartesianToCartographic(v,mh),Ui.WGS84.cartographicToCartesian([Wa(i),mh[1],mh[2]],kP),Ui.WGS84.cartographicToCartesian([mh[0],Wa(n),mh[2]],NP),Ui.WGS84.cartographicToCartesian([mh[0],mh[1],s],UP),bD([...v,...kP.subtract(v),...NP.subtract(v),...UP.subtract(v)],new Gr)}function poe(t){const e=xD(),{halfAxes:r}=t,i=new Ke(r.getColumn(0)),n=new Ke(r.getColumn(1)),o=new Ke(r.getColumn(2));for(let s=0;s<2;s++){for(let f=0;f<2;f++){for(let A=0;A<2;A++)Gs.copy(t.center),Gs.add(i),Gs.add(n),Gs.add(o),wD(e,Gs),o.negate();n.negate()}i.negate()}return e}function goe(t){const e=xD(),{center:r,radius:i}=t,n=Ui.WGS84.scaleToGeodeticSurface(r,Gs);let o;n?o=Ui.WGS84.geodeticSurfaceNormal(n):o=new Ke(0,0,1);let s=new Ke(o[2],-o[1],0);s.len()>0?s.normalize():s=new Ke(0,1,0);const f=s.clone().cross(o);for(const A of[s,f,o]){pm.copy(A).scale(i);for(let v=0;v<2;v++)Gs.copy(r),Gs.add(pm),wD(e,Gs),pm.negate()}return e}function xD(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function wD(t,e){Ui.WGS84.cartesianToCartographic(e,Gs),t[0][0]=Math.min(t[0][0],Gs[0]),t[0][1]=Math.min(t[0][1],Gs[1]),t[0][2]=Math.min(t[0][2],Gs[2]),t[1][0]=Math.max(t[1][0],Gs[0]),t[1][1]=Math.max(t[1][1],Gs[1]),t[1][2]=Math.max(t[1][2],Gs[2])}new Ke;new Ke;new Gr;new Ke;new Ke;new Ke;function moe(t,e){const r=t*e;return 1-Math.exp(-(r*r))}function _oe(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const r=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return moe(e,r)*i}return 0}function yoe(t,e,r){const i=t.tileset,n=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,o=r?n:t.lodMetricValue;if(o===0)return 0;const s=Math.max(t._distanceToCamera,1e-7),{height:f,sseDenominator:A}=e,{viewDistanceScale:v}=i.options;let w=o*f*(v||1)/(s*A);return w-=_oe(i,s),w}const Qv=new Ke,zP=new Ke,_u=new Ke,VP=new Ke,voe=new Ke,e1=new Gr,jP=new Gr;function boe(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const r=2*TD(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function TD(t,e){const{topDownViewport:r}=e,i=t.header.mbs[1],n=t.header.mbs[0],o=t.header.mbs[2],s=t.header.mbs[3],f=[...t.boundingVolume.center],A=r.unprojectPosition(r.cameraPosition);Ui.WGS84.cartographicToCartesian(A,Qv),zP.copy(Qv).subtract(f).normalize(),Ui.WGS84.eastNorthUpToFixedFrame(f,e1),jP.copy(e1).invert(),_u.copy(Qv).transform(jP);const v=Math.sqrt(_u[0]*_u[0]+_u[1]*_u[1]),w=v*v/_u[2];VP.copy([_u[0],_u[1],w]);const I=VP.transform(e1).subtract(f).normalize(),F=zP.cross(I).normalize().scale(s).add(f),N=Ui.WGS84.cartesianToCartographic(F),V=r.project([n,i,o]),G=r.project(N);return voe.copy(V).subtract(G).magnitude()}function xoe(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class HP{constructor(e=0){U(this,"_map",new Map);U(this,"_array");U(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ni(e<this._array.length),this._array[e]}set(e,r){Ni(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=r,this._map.set(r,e)}delete(e){const r=this._map.get(e);r>=0&&(this._array.splice(r,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const r=this.length++;this._array[r]=e,this._map.set(e,r)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ni(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ni(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const woe={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Q_{constructor(e){U(this,"options");U(this,"root",null);U(this,"selectedTiles",{});U(this,"requestedTiles",{});U(this,"emptyTiles",{});U(this,"lastUpdate",new Date().getTime());U(this,"updateDebounceTime",1e3);U(this,"_traversalStack",new HP);U(this,"_emptyTraversalStack",new HP);U(this,"_frameNumber",null);this.options={...woe,...e}}traversalFinished(e){return!0}traverse(e,r,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,r),this._frameNumber=r.frameNumber,this.executeTraversal(e,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,r){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const o=i.pop();let s=!1;this.canTraverse(o,r)&&(this.updateChildTiles(o,r),s=this.updateAndPushChildren(o,r,i,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const f=o.parent,A=!!(!f||f._shouldRefine),v=!s;o.hasRenderContent?o.refine===tl.ADD?(this.loadTile(o,r),this.selectTile(o,r)):o.refine===tl.REPLACE&&(this.loadTile(o,r),v&&this.selectTile(o,r)):(this.emptyTiles[o.id]=o,this.loadTile(o,r),v&&this.selectTile(o,r)),this.touchTile(o,r),o._shouldRefine=s&&A}const n=new Date().getTime();(this.traversalFinished(r)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(r))}updateChildTiles(e,r){const i=e.children;for(const n of i)this.updateTile(n,r)}updateAndPushChildren(e,r,i,n){const{loadSiblings:o,skipLevelOfDetail:s}=this.options,f=e.children;f.sort(this.compareDistanceToCamera.bind(this));const A=e.refine===tl.REPLACE&&e.hasRenderContent&&!s;let v=!1,w=!0;for(const C of f)if(C._selectionDepth=n,C.isVisibleAndInRequestVolume?(i.find(C)&&i.delete(C),i.push(C),v=!0):(A||o)&&(this.loadTile(C,r),this.touchTile(C,r)),A){let I;if(C._inRequestVolume?C.hasRenderContent?I=C.contentAvailable:I=this.executeEmptyTraversal(C,r):I=!1,w=w&&I,!w)return!1}return v||(w=!1),w}updateTile(e,r){this.updateTileVisibility(e,r)}selectTile(e,r){this.shouldSelectTile(e)&&(e._selectedFrame=r.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,r){this.shouldLoadTile(e)&&(e._requestedFrame=r.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,r){e.tileset._cache.touch(e),e._touchedFrame=r.frameNumber}canTraverse(e,r,i=!1,n=!1){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!n&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,r,i):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,r,i=!1){let n=e._screenSpaceError;return i&&(n=e.getScreenSpaceError(r,!0)),n>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,r){const i=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===r.viewport.id&&i.push(n);else i.push(r.viewport.id);e.updateVisibility(r,i)}compareDistanceToCamera(e,r){return e._distanceToCamera-r._distanceToCamera}anyChildrenVisible(e,r){let i=!1;for(const n of e.children)n.updateVisibility(r),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,r){let i=!0;const n=this._emptyTraversalStack;for(n.push(e);n.length>0;){const o=n.pop(),s=!o.hasRenderContent&&this.canTraverse(o,r,!1,!1),f=!o.hasRenderContent&&o.children.length===0;if(!s&&!o.contentAvailable&&!f&&(i=!1),this.updateTile(o,r),o.isVisibleAndInRequestVolume||(this.loadTile(o,r),this.touchTile(o,r)),s){const A=o.children;for(const v of A)n.push(v)}}return i}}const GP=new Ke;function Toe(t){return t!=null}class qb{constructor(e,r,i,n=""){U(this,"tileset");U(this,"header");U(this,"id");U(this,"url");U(this,"parent");U(this,"refine");U(this,"type");U(this,"contentUrl");U(this,"lodMetricType","geometricError");U(this,"lodMetricValue",0);U(this,"boundingVolume",null);U(this,"content",null);U(this,"contentState",$o.UNLOADED);U(this,"gpuMemoryUsageInBytes",0);U(this,"children",[]);U(this,"depth",0);U(this,"viewportIds",[]);U(this,"transform",new Gr);U(this,"extensions",null);U(this,"implicitTiling",null);U(this,"userData",{});U(this,"computedTransform");U(this,"hasEmptyContent",!1);U(this,"hasTilesetContent",!1);U(this,"traverser",new Q_({}));U(this,"_cacheNode",null);U(this,"_frameNumber",null);U(this,"_expireDate",null);U(this,"_expiredContent",null);U(this,"_boundingBox");U(this,"_distanceToCamera",0);U(this,"_screenSpaceError",0);U(this,"_visibilityPlaneMask");U(this,"_visible");U(this,"_contentBoundingVolume");U(this,"_viewerRequestVolume");U(this,"_initialTransform",new Gr);U(this,"_priority",0);U(this,"_selectedFrame",0);U(this,"_requestedFrame",0);U(this,"_selectionDepth",0);U(this,"_touchedFrame",0);U(this,"_centerZDepth",0);U(this,"_shouldRefine",!1);U(this,"_stackLength",0);U(this,"_visitedFrame",0);U(this,"_inRequestVolume",!1);U(this,"_lodJudge",null);this.header=r,this.tileset=e,this.id=n||r.id,this.url=r.url,this.parent=i,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===$o.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===$o.UNLOADED}get contentExpired(){return this.contentState===$o.EXPIRED}get contentFailed(){return this.contentState===$o.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=foe(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,r){switch(this.tileset.type){case So.I3S:return TD(this,e);case So.TILES3D:return yoe(this,e,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:r}=e.options,i=this.refine===tl.ADD||r;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===$o.UNLOADED)return-1;const n=this.parent,s=n&&(!i||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,f=e.root?e.root._screenSpaceError:0;return Math.max(f-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=$o.LOADING;const r=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!r)return this.contentState=$o.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,o={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await Ic(i,n,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=$o.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=$o.FAILED,i}finally{r.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=$o.UNLOADED,!0}updateVisibility(e,r){if(this._frameNumber===e.frameNumber)return;const i=this.parent,n=i?i._visibilityPlaneMask:Jo.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==Jo.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=r}visibility(e,r){const{cullingVolume:i}=e,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,r)}contentVisibility(){return!0}distanceToTile(e){const r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const r=this.boundingVolume;return GP.subVectors(r.center,e.position),e.direction.dot(GP)}insideViewerRequestVolume(e){const r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(Toe(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=$o.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Gr(e.transform):new Gr;const r=this.parent,i=this.tileset,n=r&&r.computedTransform?r.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Gr(n).multiplyRight(this.transform);const o=r&&r._initialTransform?r._initialTransform.clone():new Gr;this._initialTransform=new Gr(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=$o.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Jo.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||tl.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=Jv(e.boundingVolume,this.computedTransform,this.boundingVolume);const r=e.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=Jv(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Jv(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Gr){const r=e.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return xoe(this.tileset.tileset)}}}class Eoe extends Q_{compareDistanceToCamera(e,r){return r._distanceToCamera===0&&e._distanceToCamera===0?r._centerZDepth-e._centerZDepth:r._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,r){if(super.updateTileVisibility(e,r),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const s=e.children[0];this.updateTileVisibility(s,r),e._visible=s._visible;return}if(this.meetsScreenSpaceErrorEarly(e,r)){e._visible=!1;return}const n=e.refine===tl.REPLACE,o=e._optimChildrenWithinParent===coe.USE_OPTIMIZATION;if(n&&o&&i&&!this.anyChildrenVisible(e,r)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,r){const{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==tl.ADD?!1:!this.shouldRefine(e,r,!0)}}class Soe{constructor(){U(this,"frameNumberMap",new Map)}register(e,r){const i=this.frameNumberMap.get(e)||new Map,n=i.get(r)||0;i.set(r,n+1),this.frameNumberMap.set(e,i)}deregister(e,r){const i=this.frameNumberMap.get(e);if(!i)return;const n=i.get(r)||1;i.set(r,n-1)}isZero(e,r){var n;return(((n=this.frameNumberMap.get(e))==null?void 0:n.get(r))||0)===0}}const t1={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Coe{constructor(){U(this,"_statusMap");U(this,"pendingTilesRegister",new Soe);this._statusMap={}}add(e,r,i,n){if(!this._statusMap[r]){const{frameNumber:o,viewport:{id:s}}=n;this._statusMap[r]={request:e,callback:i,key:r,frameState:n,status:t1.REQUESTED},this.pendingTilesRegister.register(s,o),e().then(f=>{this._statusMap[r].status=t1.COMPLETED;const{frameNumber:A,viewport:{id:v}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(v,A),this._statusMap[r].callback(f,n)}).catch(f=>{this._statusMap[r].status=t1.ERROR;const{frameNumber:A,viewport:{id:v}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(v,A),i(f)})}}update(e,r){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,i);const{frameNumber:o,viewport:{id:s}}=r;this.pendingTilesRegister.register(s,o),this._statusMap[e].frameState=r}}find(e){return this._statusMap[e]}hasPendingTiles(e,r){return!this.pendingTilesRegister.isZero(e,r)}}class Poe extends Q_{constructor(r){super(r);U(this,"_tileManager");this._tileManager=new Coe}traversalFinished(r){return!this._tileManager.hasPendingTiles(r.viewport.id,this._frameNumber||0)}shouldRefine(r,i){return r._lodJudge=boe(r,i),r._lodJudge==="DIG"}updateChildTiles(r,i){const n=r.header.children||[],o=r.children,s=r.tileset;for(const f of n){const A=`${f.id}-${i.viewport.id}`,v=o&&o.find(w=>w.id===A);if(v)v&&this.updateTile(v,i);else{let w=()=>this._loadTile(f.id,s);this._tileManager.find(A)?this._tileManager.update(A,i):(s.tileset.nodePages&&(w=()=>s.tileset.nodePagesTile.formTileFromNodePages(f.id)),this._tileManager.add(w,A,I=>this._onTileLoad(I,r,A),i))}}return!1}async _loadTile(r,i){const{loader:n}=i,o=i.getTileUrl(`${i.url}/nodes/${r}`),s={...i.loadOptions,i3s:{...i.loadOptions.i3s,isTileHeader:!0}};return await Ic(o,n,s)}_onTileLoad(r,i,n){const o=new qb(i.tileset,r,i,n);i.children.push(o);const s=this._tileManager.find(o.id).frameState;this.updateTile(o,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(o,s)}}const Ioe={description:"",ellipsoid:Ui.WGS84,modelMatrix:new Gr,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},jg="Tiles In Tileset(s)",r1="Tiles In Memory",WP="Tiles In View",XP="Tiles To Render",qP="Tiles Loaded",i1="Tiles Loading",$P="Tiles Unloaded",ZP="Failed Tile Loads",KP="Points/Vertices",n1="Tile Memory Use",YP="Maximum Screen Space Error";class Moe{constructor(e,r){U(this,"options");U(this,"loadOptions");U(this,"type");U(this,"tileset");U(this,"loader");U(this,"url");U(this,"basePath");U(this,"modelMatrix");U(this,"ellipsoid");U(this,"lodMetricType");U(this,"lodMetricValue");U(this,"refine");U(this,"root",null);U(this,"roots",{});U(this,"asset",{});U(this,"description","");U(this,"properties");U(this,"extras",null);U(this,"attributions",{});U(this,"credits",{});U(this,"stats");U(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});U(this,"cartographicCenter",null);U(this,"cartesianCenter",null);U(this,"zoom",1);U(this,"boundingVolume",null);U(this,"dynamicScreenSpaceErrorComputedDensity",0);U(this,"maximumMemoryUsage",32);U(this,"gpuMemoryUsageInBytes",0);U(this,"memoryAdjustedScreenSpaceError",0);U(this,"_cacheBytes",0);U(this,"_cacheOverflowBytes",0);U(this,"_frameNumber",0);U(this,"_queryParams",{});U(this,"_extensionsUsed",[]);U(this,"_tiles",{});U(this,"_pendingCount",0);U(this,"selectedTiles",[]);U(this,"traverseCounter",0);U(this,"geometricError",0);U(this,"lastUpdatedVieports",null);U(this,"_requestedTiles",[]);U(this,"_emptyTiles",[]);U(this,"frameStateData",{});U(this,"_traverser");U(this,"_cache",new Qse);U(this,"_requestScheduler");U(this,"updatePromise",null);U(this,"tilesetInitializationPromise");this.options={...Ioe,...r},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||f2(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new rR({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new cA({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let i=e;return this.queryParams.length&&(i=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const r=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;const i=[];for(const n of r){const o=n.id;this._needTraverse(o)?i.push(o):this.traverseCounter--}for(const n of r){const o=n.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!i.includes(o))continue;const s=toe(n,this._frameNumber);this._traverser.traverse(this.roots[o],s,this.options)}}_needTraverse(e){let r=e;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[e]),r===e}_onTraversalEnd(e){const r=e.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[r],n=Object.values(this._traverser.selectedTiles),[o,s]=roe(n,e,this.options.maximumTilesSelected);i.selectedTiles=o;for(const f of s)f.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const r=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,r){if(e.length!==r.length)return!0;const i=new Set(e.map(s=>s.id)),n=new Set(r.map(s=>s.id));let o=e.filter(s=>!n.has(s.id)).length>0;return o=o||r.filter(s=>!i.has(s.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,r)=>e._unloadTile(r))}_updateStats(){let e=0,r=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?r+=i.content.pointCount:r+=i.content.vertexCount);this.stats.get(WP).count=this.selectedTiles.length,this.stats.get(XP).count=e,this.stats.get(KP).count=r,this.stats.get(YP).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===So.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===So.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===So.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var i;const e=this.tileset.fullExtent;if(e){const{xmin:n,xmax:o,ymin:s,ymax:f,zmin:A,zmax:v}=e;this.cartographicCenter=new Ke(n+(o-n)/2,s+(f-s)/2,A+(v-A)/2),this.cartesianCenter=new Ke,Ui.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=yD(e,this.cartographicCenter,this.cartesianCenter);return}const r=(i=this.tileset.store)==null?void 0:i.extent;if(r){const[n,o,s,f]=r;this.cartographicCenter=new Ke(n+(s-n)/2,o+(f-o)/2,0),this.cartesianCenter=new Ke,Ui.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=aoe(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Ke,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:r}=e.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Ke,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new Ke,Ui.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new Ke(0,0,-Ui.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=ooe(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(jg),this.stats.get(i1),this.stats.get(r1),this.stats.get(WP),this.stats.get(XP),this.stats.get(qP),this.stats.get($P),this.stats.get(ZP),this.stats.get(KP),this.stats.get(n1,"memory"),this.stats.get(YP)}_initializeTileHeaders(e,r){var n;const i=new qb(this,e.root,r);if(r&&(r.children.push(i),i.depth=r.depth+1),this.type===So.TILES3D){const o=[];for(o.push(i);o.length>0;){const s=o.pop();this.stats.get(jg).incrementCount();const f=s.header.children||[];for(const A of f){const v=new qb(this,A,s);if((n=v.contentUrl)!=null&&n.includes("?session=")){const C=new URL(v.contentUrl).searchParams.get("session");C&&(this._queryParams.session=C)}s.children.push(v),v.depth=s.depth+1,o.push(v)}}}return i}_initializeTraverser(){let e;switch(this.type){case So.TILES3D:e=Eoe;break;case So.I3S:e=Poe;break;default:e=Q_}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let r;try{this._onStartTileLoading(),r=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,r)}}_onTileLoadError(e,r){this.stats.get(ZP).incrementCount();const i=r.message||r.toString(),n=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,n)}_onTileLoad(e,r){var i,n;if(r){if(this.type===So.I3S){const o=((n=(i=this.tileset)==null?void 0:i.nodePagesTile)==null?void 0:n.nodesInNodePages)||0;this.stats.get(jg).reset(),this.stats.get(jg).addCount(o)}e&&e.content&&eoe(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var r;if(this.type===So.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===So.TILES3D){const{extensionsRemoved:i=[]}=((r=e.content)==null?void 0:r.gltf)||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(i1).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(i1).decrementCount()}_addTileToCache(e){this._cache.add(this,e,r=>r._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(qP).incrementCount(),this.stats.get(r1).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(n1).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(r1).decrementCount(),this.stats.get($P).incrementCount(),this.stats.get(n1).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const r=e.pop();for(const i of r.children)e.push(i);this._destroyTile(r)}this.root=null}_destroySubtree(e){const r=e,i=[];for(i.push(r);i.length>0;){e=i.pop();for(const n of e.children)i.push(n);e!==r&&this._destroyTile(e)}r.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const r=new URLSearchParams(e.queryString),i=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const ED="4.2.4",op={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function SD(t,e,r){Ni(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),n=new Uint8Array(t,e,r);return i.decode(n)}function Roe(t,e=0){const r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}const Boe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Hn={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ui={...Boe,...Hn},s1={[Hn.DOUBLE]:Float64Array,[Hn.FLOAT]:Float32Array,[Hn.UNSIGNED_SHORT]:Uint16Array,[Hn.UNSIGNED_INT]:Uint32Array,[Hn.UNSIGNED_BYTE]:Uint8Array,[Hn.BYTE]:Int8Array,[Hn.SHORT]:Int16Array,[Hn.INT]:Int32Array},Ooe={DOUBLE:Hn.DOUBLE,FLOAT:Hn.FLOAT,UNSIGNED_SHORT:Hn.UNSIGNED_SHORT,UNSIGNED_INT:Hn.UNSIGNED_INT,UNSIGNED_BYTE:Hn.UNSIGNED_BYTE,BYTE:Hn.BYTE,SHORT:Hn.SHORT,INT:Hn.INT},o1="Failed to convert GL type";class zl{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const r in s1)if(s1[r]===e)return r;throw new Error(o1)}static fromName(e){const r=Ooe[e];if(!r)throw new Error(o1);return r}static getArrayType(e){switch(e){case Hn.UNSIGNED_SHORT_5_6_5:case Hn.UNSIGNED_SHORT_4_4_4_4:case Hn.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const r=s1[e];if(!r)throw new Error(o1);return r}}static getByteSize(e){return zl.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!zl.getArrayType(e)}static createTypedArray(e,r,i=0,n){n===void 0&&(n=(r.byteLength-i)/zl.getByteSize(e));const o=zl.getArrayType(e);return new o(r,i,n)}}function Doe(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function Foe(t,e=[0,0,0]){const r=t>>11&31,i=t>>5&63,n=t&31;return e[0]=r<<3,e[1]=i<<2,e[2]=n<<3,e}new C2;new Ke;new C2;new C2;function JP(t,e=255){return Tc(t,0,e)/e*2-1}function QP(t){return t<0?-1:1}function Loe(t,e,r,i){if(Doe(i),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(i.x=JP(t,r),i.y=JP(e,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const n=i.x;i.x=(1-Math.abs(i.y))*QP(n),i.y=(1-Math.abs(n))*QP(i.y)}return i.normalize()}function koe(t,e,r){return Loe(t,e,255,r)}class Hx{constructor(e,r){U(this,"json");U(this,"buffer");U(this,"featuresLength",0);U(this,"_cachedTypedArrays",{});this.json=e,this.buffer=r}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,r=ui.UNSIGNED_INT,i=1){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,r,i,1,n.byteOffset):n}getPropertyArray(e,r,i){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(r=zl.fromName(n.componentType)),this._getTypedArrayFromBinary(e,r,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,r,n)}getProperty(e,r,i,n,o){const s=this.json[e];if(!s)return s;const f=this.getPropertyArray(e,r,i);if(i===1)return f[n];for(let A=0;A<i;++A)o[A]=f[i*n+A];return o}_getTypedArrayFromBinary(e,r,i,n,o){const s=this._cachedTypedArrays;let f=s[e];return f||(f=zl.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+o,n*i),s[e]=f),f}_getTypedArrayFromArray(e,r,i){const n=this._cachedTypedArrays;let o=n[e];return o||(o=zl.createTypedArray(r,i),n[e]=o),o}}const Noe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Uoe={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},zoe={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};function Voe(t,e,r,i){const{componentType:n}=t;Ni(t.componentType);const o=typeof n=="string"?zl.fromName(n):n,s=Noe[t.type],f=Uoe[t.type],A=zoe[t.type];return r+=t.byteOffset,{values:zl.createTypedArray(o,e,r,s*i),type:o,size:s,unpacker:f,packer:A}}const Nl=t=>t!==void 0;function joe(t,e,r){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,i=n),i?Hoe(i,r):null}function Hoe(t,e){let r,i,n;const o=t.instancesLength,s=t.classes;let f=t.classIds,A=t.parentCounts,v=t.parentIds,w=o;Nl(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,n=getBinaryAccessor(f),f=n.createArrayBufferView(e.buffer,e.byteOffset+f.byteOffset,o));let C;if(Nl(A))for(Nl(A.byteOffset)&&(A.componentType=defaultValue(A.componentType,GL.UNSIGNED_SHORT),A.type=AttributeType.SCALAR,n=getBinaryAccessor(A),A=n.createArrayBufferView(e.buffer,e.byteOffset+A.byteOffset,o)),C=new Uint16Array(o),w=0,r=0;r<o;++r)C[r]=w,w+=A[r];Nl(v)&&Nl(v.byteOffset)&&(v.componentType=defaultValue(v.componentType,GL.UNSIGNED_SHORT),v.type=AttributeType.SCALAR,n=getBinaryAccessor(v),v=n.createArrayBufferView(e.buffer,e.byteOffset+v.byteOffset,w));const I=s.length;for(r=0;r<I;++r){const V=s[r].length,G=s[r].instances,Y=getBinaryProperties(V,G,e);s[r].instances=combine(Y,G)}const B=new Array(I).fill(0),F=new Uint16Array(o);for(r=0;r<o;++r)i=f[r],F[r]=B[i],++B[i];const N={classes:s,classIds:f,classIndexes:F,parentCounts:A,parentIndexes:C,parentIds:v};return Xoe(N),N}function ap(t,e,r){if(!t)return;const i=t.parentCounts;return t.parentIds?r(t,e):i>0?Goe(t,e,r):Woe(t,e,r)}function Goe(t,e,r){const i=t.classIds,n=t.parentCounts,o=t.parentIds,s=t.parentIndexes,f=i.length,A=scratchVisited;A.length=Math.max(A.length,f);const v=++marker,w=scratchStack;for(w.length=0,w.push(e);w.length>0;){if(e=w.pop(),A[e]===v)continue;A[e]=v;const C=r(t,e);if(Nl(C))return C;const I=n[e],B=s[e];for(let F=0;F<I;++F){const N=o[B+F];N!==e&&w.push(N)}}return null}function Woe(t,e,r){let i=!0;for(;i;){const n=r(t,e);if(Nl(n))return n;const o=t.parentIds[e];i=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function Xoe(t){const r=t.classIds.length;for(let i=0;i<r;++i)CD(t,i,stack)}function CD(t,e,r){const i=t.parentCounts,n=t.parentIds,o=t.parentIndexes,f=t.classIds.length;if(!Nl(n))return;assert(e<f,`Parent index ${e} exceeds the total number of instances: ${f}`),assert(r.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(e);const A=Nl(i)?i[e]:1,v=Nl(i)?o[e]:e;for(let w=0;w<A;++w){const C=n[v+w];C!==e&&CD(t,C,r)}r.pop(e)}function Eo(t){return t!=null}const Hg=(t,e)=>t,qoe={HIERARCHY:!0,extensions:!0,extras:!0};class PD{constructor(e,r,i,n={}){U(this,"json");U(this,"binary");U(this,"featureCount");U(this,"_extensions");U(this,"_properties");U(this,"_binaryProperties");U(this,"_hierarchy");var o;Ni(i>=0),this.json=e||{},this.binary=r,this.featureCount=i,this._extensions=((o=this.json)==null?void 0:o.extensions)||{},this._properties={};for(const s in this.json)qoe[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=joe(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,r){if(this._checkBatchId(e),Ni(typeof r=="string",r),this._hierarchy){const i=ap(this._hierarchy,e,(n,o)=>{const s=n.classIds[o];return n.classes[s].name===r});return Eo(i)}return!1}isExactClass(e,r){return Ni(typeof r=="string",r),this.getExactClassName(e)===r}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const r=this._hierarchy.classIds[e];return this._hierarchy.classes[r].name}}hasProperty(e,r){return this._checkBatchId(e),Ni(typeof r=="string",r),Eo(this._properties[r])||this._hasPropertyInHierarchy(e,r)}getPropertyNames(e,r){this._checkBatchId(e),r=Eo(r)?r:[],r.length=0;const i=Object.keys(this._properties);return r.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,r),r}getProperty(e,r){if(this._checkBatchId(e),Ni(typeof r=="string",r),this._binaryProperties){const n=this._binaryProperties[r];if(Eo(n))return this._getBinaryProperty(n,e)}const i=this._properties[r];if(Eo(i))return Hg(i[e]);if(this._hierarchy){const n=this._getHierarchyProperty(e,r);if(Eo(n))return n}}setProperty(e,r,i){const n=this.featureCount;if(this._checkBatchId(e),Ni(typeof r=="string",r),this._binaryProperties){const s=this._binaryProperties[r];if(s){this._setBinaryProperty(s,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,r,i))return;let o=this._properties[r];Eo(o)||(this._properties[r]=new Array(n),o=this._properties[r]),o[e]=Hg(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,r){return e.unpack(e.typedArray,r)}_setBinaryProperty(e,r,i){e.pack(i,e.typedArray,r)}_initializeBinaryProperties(){let e=null;for(const r in this._properties){const i=this._properties[r],n=this._initializeBinaryProperty(r,i);n&&(e=e||{},e[r]=n)}return e}_initializeBinaryProperty(e,r){if("byteOffset"in r){const i=r;Ni(this.binary,`Property ${e} requires a batch table binary.`),Ni(i.type,`Property ${e} requires a type.`);const n=Voe(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,r){if(!this._hierarchy)return!1;const i=ap(this._hierarchy,e,(n,o)=>{const s=n.classIds[o],f=n.classes[s].instances;return Eo(f[r])});return Eo(i)}_getPropertyNamesInHierarchy(e,r){ap(this._hierarchy,e,(i,n)=>{const o=i.classIds[n],s=i.classes[o].instances;for(const f in s)s.hasOwnProperty(f)&&r.indexOf(f)===-1&&r.push(f)})}_getHierarchyProperty(e,r){return ap(this._hierarchy,e,(i,n)=>{const o=i.classIds[n],s=i.classes[o],f=i.classIndexes[n],A=s.instances[r];return Eo(A)?Eo(A.typedArray)?this._getBinaryProperty(A,f):Hg(A[f]):null})}_setHierarchyProperty(e,r,i,n){const o=ap(this._hierarchy,r,(s,f)=>{const A=s.classIds[f],v=s.classes[A],w=s.classIndexes[f],C=v.instances[i];return Eo(C)?(Ni(f===r,`Inherited property "${i}" is read-only.`),Eo(C.typedArray)?this._setBinaryProperty(C,w,n):C[w]=Hg(n),!0):!1});return Eo(o)}}const a1=4;function ey(t,e,r=0){const i=new DataView(e);if(t.magic=i.getUint32(r,!0),r+=a1,t.version=i.getUint32(r,!0),r+=a1,t.byteLength=i.getUint32(r,!0),r+=a1,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return r}const rd=4,eI="b3dm tile in legacy format.";function Gx(t,e,r){const i=new DataView(e);let n;t.header=t.header||{};let o=i.getUint32(r,!0);r+=rd;let s=i.getUint32(r,!0);r+=rd;let f=i.getUint32(r,!0);r+=rd;let A=i.getUint32(r,!0);return r+=rd,f>=570425344?(r-=rd*2,n=o,f=s,A=0,o=0,s=0,console.warn(eI)):A>=570425344&&(r-=rd,n=f,f=o,A=s,o=0,s=0,console.warn(eI)),t.header.featureTableJsonByteLength=o,t.header.featureTableBinaryByteLength=s,t.header.batchTableJsonByteLength=f,t.header.batchTableBinaryByteLength=A,t.header.batchLength=n,r}function Wx(t,e,r,i){return r=$oe(t,e,r),r=Zoe(t,e,r),r}function $oe(t,e,r,i){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:o,batchLength:s}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:s||0},n&&n>0){const f=SD(e,r,n);t.featureTableJson=JSON.parse(f)}return r+=n||0,t.featureTableBinary=new Uint8Array(e,r,o),r+=o||0,r}function Zoe(t,e,r,i){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:o}=t.header||{};if(n&&n>0){const s=SD(e,r,n);t.batchTableJson=JSON.parse(s),r+=n,o&&o>0&&(t.batchTableBinary=new Uint8Array(e,r,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=o)}return r}function ID(t,e,r){if(!e&&(!t||!t.batchIds||!r))return null;const{batchIds:i,isRGB565:n,pointCount:o=0}=t;if(i&&r){const s=new Uint8ClampedArray(o*3);for(let f=0;f<o;f++){const A=i[f],w=r.getProperty(A,"dimensions").map(C=>C*255);s[f*3]=w[0],s[f*3+1]=w[1],s[f*3+2]=w[2]}return{type:ui.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}if(e&&n){const s=new Uint8ClampedArray(o*3);for(let f=0;f<o;f++){const A=Foe(e[f]);s[f*3]=A[0],s[f*3+1]=A[1],s[f*3+2]=A[2]}return{type:ui.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}return e&&e.length===o*3?{type:ui.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:ui.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const tI=new Ke;function Koe(t,e){if(!e)return null;if(t.isOctEncoded16P){const r=new Float32Array((t.pointsLength||0)*3);for(let i=0;i<(t.pointsLength||0);i++)koe(e[i*2],e[i*2+1],tI),tI.toArray(r,i*3);return{type:ui.FLOAT,size:2,value:r}}return{type:ui.FLOAT,size:2,value:e}}function Yoe(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,Joe(t,e)):{type:ui.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Joe(t,e){const r=new Ke,i=new Float32Array(t.pointCount*3);for(let n=0;n<t.pointCount;n++)r.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,n*3);return i}async function Qoe(t,e,r,i,n){r=ey(t,e,r),r=Gx(t,e,r),r=Wx(t,e,r),eae(t);const{featureTable:o,batchTable:s}=tae(t);return await oae(t,o,s,i,n),rae(t,o,i),iae(t,o,s),nae(t,o),r}function eae(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function tae(t){const e=new Hx(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",ui.FLOAT,3);const i=sae(t,e);return{featureTable:e,batchTable:i}}function rae(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",ui.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",ui.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ui.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ui.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Yoe(t,i,r)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function iae(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",ui.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",ui.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",ui.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=ID(t,i,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",ui.UNSIGNED_BYTE,4))}function nae(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",ui.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",ui.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=Koe(t,r)}}function sae(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",ui.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:o}=t;r=new PD(n,o,i)}return r}async function oae(t,e,r,i,n){let o,s,f;const A=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];A&&(f=A.properties);const v=e.getExtension("3DTILES_draco_point_compression");if(v){s=v.properties;const C=v.byteOffset,I=v.byteLength;if(!s||!Number.isFinite(C)||!I)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=(t.featureTableBinary||[]).slice(C,C+I),t.hasPositions=Number.isFinite(s.POSITION),t.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),t.hasNormals=Number.isFinite(s.NORMAL),t.hasBatchIds=Number.isFinite(s.BATCH_ID),t.isTranslucent=Number.isFinite(s.RGBA)}if(!o)return!0;const w={buffer:o,properties:{...s,...f},featureTableProperties:s,batchTableProperties:f,dequantizeInShader:!1};return await aae(t,w,i,n)}async function aae(t,e,r,i){if(!i)return;const n={...r,draco:{...r==null?void 0:r.draco,extraAttributes:e.batchTableProperties||{}}};delete n["3d-tiles"];const o=await aA(e.buffer,lO,n,i),s=o.attributes.POSITION&&o.attributes.POSITION.value,f=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,A=o.attributes.NORMAL&&o.attributes.NORMAL.value,v=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,w=s&&o.attributes.POSITION.value.quantization,C=A&&o.attributes.NORMAL.value.quantization;if(w){const B=o.POSITION.data.quantization,F=B.range;t.quantizedVolumeScale=new Ke(F,F,F),t.quantizedVolumeOffset=new Ke(B.minValues),t.quantizedRange=(1<<B.quantizationBits)-1,t.isQuantizedDraco=!0}C&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const I={};if(e.batchTableProperties)for(const B of Object.keys(e.batchTableProperties))o.attributes[B]&&o.attributes[B].value&&(I[B.toLowerCase()]=o.attributes[B].value);t.attributes={positions:s,colors:ID(t,f,void 0),normals:A,batchIds:v,...I}}const $b={URI:0,EMBEDDED:1};function MD(t,e,r,i){t.rotateYtoZ=!0;const n=(t.byteOffset||0)+(t.byteLength||0)-r;if(n===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i!=null&&i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=h2(e,r,n),t.gltfByteOffset=0,t.gltfByteLength=n,r%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function RD(t,e,r,i){const n=(r==null?void 0:r["3d-tiles"])||{};if(lae(t,e),n.loadGLTF){if(!i)return;if(t.gltfUrl){const{fetch:o}=i,s=await o(t.gltfUrl,r);t.gltfArrayBuffer=await s.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const o=await aA(t.gltfArrayBuffer,tA,r,i);t.gltf=yx(o),t.gpuMemoryUsageInBytes=Z4(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function lae(t,e,r){switch(e){case $b.URI:if(t.gltfArrayBuffer){const i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),o=new TextDecoder().decode(i);t.gltfUrl=o.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case $b.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function cae(t,e,r,i,n){var s;r=uae(t,e,r,i),await RD(t,$b.EMBEDDED,i,n);const o=(s=t==null?void 0:t.gltf)==null?void 0:s.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),r}function uae(t,e,r,i,n){r=ey(t,e,r),r=Gx(t,e,r),r=Wx(t,e,r),r=MD(t,e,r,i);const o=new Hx(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=o.getGlobalProperty("RTC_CENTER",ui.FLOAT,3),r}async function hae(t,e,r,i,n){return r=fae(t,e,r,i),await RD(t,t.gltfFormat||0,i,n),r}function fae(t,e,r,i,n){var v;if(r=ey(t,e,r),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=Gx(t,e,r);const o=new DataView(e);if(t.gltfFormat=o.getUint32(r,!0),r+=4,r=Wx(t,e,r),r=MD(t,e,r,i),!((v=t==null?void 0:t.header)!=null&&v.featureTableJsonByteLength)||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const s=new Hx(t.featureTableJson,t.featureTableBinary),f=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=f,!Number.isFinite(f))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=s.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=s.getGlobalProperty("RTC_CENTER",ui.FLOAT,3);const A=new PD(t.batchTableJson,t.batchTableBinary,f);return dae(t,s,A,f),r}function dae(t,e,r,i){const n=new Array(i),o=new Ke;new Ke,new Ke,new Ke;const s=new Mn,f=new Up,A=new Ke,v={},w=new Gr,C=[],I=[],B=[],F=[];for(let N=0;N<i;N++){let V;if(e.hasProperty("POSITION"))V=e.getProperty("POSITION",ui.FLOAT,3,N,o);else if(e.hasProperty("POSITION_QUANTIZED")){V=e.getProperty("POSITION_QUANTIZED",ui.UNSIGNED_SHORT,3,N,o);const Pe=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ui.FLOAT,3);if(!Pe)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ue=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ui.FLOAT,3);if(!Ue)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Fe=65535;for(let pe=0;pe<3;pe++)V[pe]=V[pe]/Fe*Ue[pe]+Pe[pe]}if(!V)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(V),v.translation=o,t.normalUp=e.getProperty("NORMAL_UP",ui.FLOAT,3,N,C),t.normalRight=e.getProperty("NORMAL_RIGHT",ui.FLOAT,3,N,I),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",ui.UNSIGNED_SHORT,2,N,C),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",ui.UNSIGNED_SHORT,2,N,I),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(Ui.WGS84.eastNorthUpToFixedFrame(o,w),w.getRotationMatrix3(s)):s.identity()}f.fromMatrix3(s),v.rotation=f,A.set(1,1,1);const G=e.getProperty("SCALE",ui.FLOAT,1,N,B);Number.isFinite(G)&&A.multiplyByScalar(G);const Y=e.getProperty("SCALE_NON_UNIFORM",ui.FLOAT,3,N,C);Y&&A.scale(Y),v.scale=A;let Z=e.getProperty("BATCH_ID",ui.UNSIGNED_SHORT,1,N,F);Z===void 0&&(Z=N);const se=new Gr().fromQuaternion(v.rotation);w.identity(),w.translate(v.translation),w.multiplyRight(se),w.scale(v.scale);const ge=w.clone();n[N]={modelMatrix:ge,batchId:Z}}t.instances=n}async function Aae(t,e,r,i,n,o){r=ey(t,e,r);const s=new DataView(e);for(t.tilesLength=s.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-r>12;){const f={shape:"tile3d"};t.tiles.push(f),r=await o(e,r,i,n,f)}return r}async function pae(t,e,r,i){var n,o;if(t.rotateYtoZ=!0,t.gltfUpAxis=(n=r==null?void 0:r["3d-tiles"])!=null&&n.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",(o=r==null?void 0:r["3d-tiles"])!=null&&o.loadGLTF){if(!i)return e.byteLength;const s=await aA(e,tA,r,i);t.gltf=yx(s),t.gpuMemoryUsageInBytes=Z4(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function BD(t,e=0,r,i,n={shape:"tile3d"}){switch(n.byteOffset=e,n.type=Roe(t,e),n.type){case op.COMPOSITE:return await Aae(n,t,e,r,i,BD);case op.BATCHED_3D_MODEL:return await cae(n,t,e,r,i);case op.GLTF:return await pae(n,t,r,i);case op.INSTANCED_3D_MODEL:return await hae(n,t,e,r,i);case op.POINT_CLOUD:return await Qoe(n,t,e,r,i);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}const gae=1952609651,mae=1;async function _ae(t,e,r){if(new Uint32Array(t.slice(0,4))[0]!==gae)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==mae)throw new Error("Wrong subtree file verson, must be 1");const o=rI(t.slice(8,16)),s=new Uint8Array(t,24,o),A=new TextDecoder("utf8").decode(s),v=JSON.parse(A),w=rI(t.slice(16,24));let C=new ArrayBuffer(0);if(w&&(C=t.slice(24+o)),await Gg(v,v.tileAvailability,C,r),Array.isArray(v.contentAvailability))for(const I of v.contentAvailability)await Gg(v,I,C,r);else await Gg(v,v.contentAvailability,C,r);return await Gg(v,v.childSubtreeAvailability,C,r),v}async function Gg(t,e,r,i){const n=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof n!="number")return;const o=t.bufferViews[n],s=t.buffers[o.buffer];if(!(i!=null&&i.baseUrl))throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(s.uri){const A=`${(i==null?void 0:i.baseUrl)||""}/${s.uri}`,w=await(await i.fetch(A)).arrayBuffer();e.explicitBitstream=new Uint8Array(w,o.byteOffset,o.byteLength);return}const f=t.buffers.slice(0,o.buffer).reduce((A,v)=>A+v.byteLength,0);e.explicitBitstream=new Uint8Array(r.slice(f,f+s.byteLength),o.byteOffset,o.byteLength)}function rI(t){const e=new DataView(t),r=e.getUint32(0,!0),i=e.getUint32(4,!0);return r+2**32*i}const OD={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:ED,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:_ae,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ta=null;try{Ta=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ci(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}Ci.prototype.__isLong__;Object.defineProperty(Ci.prototype,"__isLong__",{value:!0});function $s(t){return(t&&t.__isLong__)===!0}function iI(t){var e=Math.clz32(t&-t);return t?31-e:e}Ci.isLong=$s;var nI={},sI={};function Kh(t,e){var r,i,n;return e?(t>>>=0,(n=0<=t&&t<256)&&(i=sI[t],i)?i:(r=fi(t,0,!0),n&&(sI[t]=r),r)):(t|=0,(n=-128<=t&&t<128)&&(i=nI[t],i)?i:(r=fi(t,t<0?-1:0,!1),n&&(nI[t]=r),r))}Ci.fromInt=Kh;function Ea(t,e){if(isNaN(t))return e?Cc:Qa;if(e){if(t<0)return Cc;if(t>=DD)return kD}else{if(t<=-aI)return Po;if(t+1>=aI)return LD}return t<0?Ea(-t,e).neg():fi(t%sA|0,t/sA|0,e)}Ci.fromNumber=Ea;function fi(t,e,r){return new Ci(t,e,r)}Ci.fromBits=fi;var t_=Math.pow;function Xx(t,e,r){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(r=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Cc:Qa;if(r=r||10,r<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return Xx(t.substring(1),e,r).neg();for(var n=Ea(t_(r,8)),o=Qa,s=0;s<t.length;s+=8){var f=Math.min(8,t.length-s),A=parseInt(t.substring(s,s+f),r);if(f<8){var v=Ea(t_(r,f));o=o.mul(v).add(Ea(A))}else o=o.mul(n),o=o.add(Ea(A))}return o.unsigned=e,o}Ci.fromString=Xx;function ol(t,e){return typeof t=="number"?Ea(t,e):typeof t=="string"?Xx(t,e):fi(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Ci.fromValue=ol;var oI=65536,yae=1<<24,sA=oI*oI,DD=sA*sA,aI=DD/2,lI=Kh(yae),Qa=Kh(0);Ci.ZERO=Qa;var Cc=Kh(0,!0);Ci.UZERO=Cc;var Rd=Kh(1);Ci.ONE=Rd;var FD=Kh(1,!0);Ci.UONE=FD;var Zb=Kh(-1);Ci.NEG_ONE=Zb;var LD=fi(-1,2147483647,!1);Ci.MAX_VALUE=LD;var kD=fi(-1,-1,!0);Ci.MAX_UNSIGNED_VALUE=kD;var Po=fi(0,-2147483648,!1);Ci.MIN_VALUE=Po;var Pt=Ci.prototype;Pt.toInt=function(){return this.unsigned?this.low>>>0:this.low};Pt.toNumber=function(){return this.unsigned?(this.high>>>0)*sA+(this.low>>>0):this.high*sA+(this.low>>>0)};Pt.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Po)){var r=Ea(e),i=this.div(r),n=i.mul(r).sub(this);return i.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Ea(t_(e,6),this.unsigned),s=this,f="";;){var A=s.div(o),v=s.sub(A.mul(o)).toInt()>>>0,w=v.toString(e);if(s=A,s.isZero())return w+f;for(;w.length<6;)w="0"+w;f=""+w+f}};Pt.getHighBits=function(){return this.high};Pt.getHighBitsUnsigned=function(){return this.high>>>0};Pt.getLowBits=function(){return this.low};Pt.getLowBitsUnsigned=function(){return this.low>>>0};Pt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Po)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;r>0&&!(e&1<<r);r--);return this.high!=0?r+33:r+1};Pt.isZero=function(){return this.high===0&&this.low===0};Pt.eqz=Pt.isZero;Pt.isNegative=function(){return!this.unsigned&&this.high<0};Pt.isPositive=function(){return this.unsigned||this.high>=0};Pt.isOdd=function(){return(this.low&1)===1};Pt.isEven=function(){return(this.low&1)===0};Pt.equals=function(e){return $s(e)||(e=ol(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Pt.eq=Pt.equals;Pt.notEquals=function(e){return!this.eq(e)};Pt.neq=Pt.notEquals;Pt.ne=Pt.notEquals;Pt.lessThan=function(e){return this.comp(e)<0};Pt.lt=Pt.lessThan;Pt.lessThanOrEqual=function(e){return this.comp(e)<=0};Pt.lte=Pt.lessThanOrEqual;Pt.le=Pt.lessThanOrEqual;Pt.greaterThan=function(e){return this.comp(e)>0};Pt.gt=Pt.greaterThan;Pt.greaterThanOrEqual=function(e){return this.comp(e)>=0};Pt.gte=Pt.greaterThanOrEqual;Pt.ge=Pt.greaterThanOrEqual;Pt.compare=function(e){if($s(e)||(e=ol(e)),this.eq(e))return 0;var r=this.isNegative(),i=e.isNegative();return r&&!i?-1:!r&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Pt.comp=Pt.compare;Pt.negate=function(){return!this.unsigned&&this.eq(Po)?Po:this.not().add(Rd)};Pt.neg=Pt.negate;Pt.add=function(e){$s(e)||(e=ol(e));var r=this.high>>>16,i=this.high&65535,n=this.low>>>16,o=this.low&65535,s=e.high>>>16,f=e.high&65535,A=e.low>>>16,v=e.low&65535,w=0,C=0,I=0,B=0;return B+=o+v,I+=B>>>16,B&=65535,I+=n+A,C+=I>>>16,I&=65535,C+=i+f,w+=C>>>16,C&=65535,w+=r+s,w&=65535,fi(I<<16|B,w<<16|C,this.unsigned)};Pt.subtract=function(e){return $s(e)||(e=ol(e)),this.add(e.neg())};Pt.sub=Pt.subtract;Pt.multiply=function(e){if(this.isZero())return this;if($s(e)||(e=ol(e)),Ta){var r=Ta.mul(this.low,this.high,e.low,e.high);return fi(r,Ta.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Cc:Qa;if(this.eq(Po))return e.isOdd()?Po:Qa;if(e.eq(Po))return this.isOdd()?Po:Qa;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(lI)&&e.lt(lI))return Ea(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,n=this.high&65535,o=this.low>>>16,s=this.low&65535,f=e.high>>>16,A=e.high&65535,v=e.low>>>16,w=e.low&65535,C=0,I=0,B=0,F=0;return F+=s*w,B+=F>>>16,F&=65535,B+=o*w,I+=B>>>16,B&=65535,B+=s*v,I+=B>>>16,B&=65535,I+=n*w,C+=I>>>16,I&=65535,I+=o*v,C+=I>>>16,I&=65535,I+=s*A,C+=I>>>16,I&=65535,C+=i*w+n*v+o*A+s*f,C&=65535,fi(B<<16|F,C<<16|I,this.unsigned)};Pt.mul=Pt.multiply;Pt.divide=function(e){if($s(e)||(e=ol(e)),e.isZero())throw Error("division by zero");if(Ta){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?Ta.div_u:Ta.div_s)(this.low,this.high,e.low,e.high);return fi(r,Ta.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Cc:Qa;var i,n,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Cc;if(e.gt(this.shru(1)))return FD;o=Cc}else{if(this.eq(Po)){if(e.eq(Rd)||e.eq(Zb))return Po;if(e.eq(Po))return Rd;var s=this.shr(1);return i=s.div(e).shl(1),i.eq(Qa)?e.isNegative()?Rd:Zb:(n=this.sub(e.mul(i)),o=i.add(n.div(e)),o)}else if(e.eq(Po))return this.unsigned?Cc:Qa;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Qa}for(n=this;n.gte(e);){i=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var f=Math.ceil(Math.log(i)/Math.LN2),A=f<=48?1:t_(2,f-48),v=Ea(i),w=v.mul(e);w.isNegative()||w.gt(n);)i-=A,v=Ea(i,this.unsigned),w=v.mul(e);v.isZero()&&(v=Rd),o=o.add(v),n=n.sub(w)}return o};Pt.div=Pt.divide;Pt.modulo=function(e){if($s(e)||(e=ol(e)),Ta){var r=(this.unsigned?Ta.rem_u:Ta.rem_s)(this.low,this.high,e.low,e.high);return fi(r,Ta.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Pt.mod=Pt.modulo;Pt.rem=Pt.modulo;Pt.not=function(){return fi(~this.low,~this.high,this.unsigned)};Pt.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Pt.clz=Pt.countLeadingZeros;Pt.countTrailingZeros=function(){return this.low?iI(this.low):iI(this.high)+32};Pt.ctz=Pt.countTrailingZeros;Pt.and=function(e){return $s(e)||(e=ol(e)),fi(this.low&e.low,this.high&e.high,this.unsigned)};Pt.or=function(e){return $s(e)||(e=ol(e)),fi(this.low|e.low,this.high|e.high,this.unsigned)};Pt.xor=function(e){return $s(e)||(e=ol(e)),fi(this.low^e.low,this.high^e.high,this.unsigned)};Pt.shiftLeft=function(e){return $s(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fi(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fi(0,this.low<<e-32,this.unsigned)};Pt.shl=Pt.shiftLeft;Pt.shiftRight=function(e){return $s(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fi(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fi(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Pt.shr=Pt.shiftRight;Pt.shiftRightUnsigned=function(e){return $s(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fi(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?fi(this.high,0,this.unsigned):fi(this.high>>>e-32,0,this.unsigned)};Pt.shru=Pt.shiftRightUnsigned;Pt.shr_u=Pt.shiftRightUnsigned;Pt.rotateLeft=function(e){var r;return $s(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?fi(this.high,this.low,this.unsigned):e<32?(r=32-e,fi(this.low<<e|this.high>>>r,this.high<<e|this.low>>>r,this.unsigned)):(e-=32,r=32-e,fi(this.high<<e|this.low>>>r,this.low<<e|this.high>>>r,this.unsigned))};Pt.rotl=Pt.rotateLeft;Pt.rotateRight=function(e){var r;return $s(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?fi(this.high,this.low,this.unsigned):e<32?(r=32-e,fi(this.high<<r|this.low>>>e,this.low<<r|this.high>>>e,this.unsigned)):(e-=32,r=32-e,fi(this.low<<r|this.high>>>e,this.high<<r|this.low>>>e,this.unsigned))};Pt.rotr=Pt.rotateRight;Pt.toSigned=function(){return this.unsigned?fi(this.low,this.high,!1):this};Pt.toUnsigned=function(){return this.unsigned?this:fi(this.low,this.high,!0)};Pt.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Pt.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Pt.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]};Ci.fromBytes=function(e,r,i){return i?Ci.fromBytesLE(e,r):Ci.fromBytesBE(e,r)};Ci.fromBytesLE=function(e,r){return new Ci(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)};Ci.fromBytesBE=function(e,r){return new Ci(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)};const vae=16;function ND(t){t==="X"&&(t="");const e=t.padEnd(vae,"0");return Ci.fromString(e,!0,16)}function bae(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const r=e%4;e=(e-r)/4;const i=e;e*=4;const o=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-o.length).join("0")+o}function xae(t,e){const r=wae(t).shiftRightUnsigned(2);return t.add(Ci.fromNumber(2*e+1-4).multiply(r))}function wae(t){return t.and(t.not().add(1))}const Tae=3,Eae=30,Sae=2*Eae+1,cI=180/Math.PI;function Cae(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),r=parseInt(e[0],10),i=e[1],n=i.length;let o=0;const s=[0,0];for(let f=n-1;f>=0;f--){o=n-f;const A=i[f];let v=0,w=0;A==="1"?w=1:A==="2"?(v=1,w=1):A==="3"&&(v=1);const C=Math.pow(2,o-1);Iae(C,s,v,w),s[0]+=C*v,s[1]+=C*w}if(r%2===1){const f=s[0];s[0]=s[1],s[1]=f}return{face:r,ij:s,level:o}}function Pae(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<Tae+Sae;)e="0"+e;const r=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,r),o=n.length/2,s=Ci.fromString(i,!0,2).toString(10);let f="";if(o!==0)for(f=Ci.fromString(n,!0,2).toString(4);f.length<o;)f="0"+f;return`${s}/${f}`}function UD(t,e,r){const i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function uI(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function zD(t){return[uI(t[0]),uI(t[1])]}function VD(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function jD([t,e,r]){const i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*cI,i*cI]}function Iae(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}function Mae(t){const e=UD(t.ij,t.level,[.5,.5]),r=zD(e),i=VD(t.face,r);return jD(i)}const Rae=100;function hI(t){const{face:e,ij:r,level:i}=t,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(Rae*Math.pow(2,-i))),s=new Float64Array(4*o*2+2);let f=0,A=0;for(let v=0;v<4;v++){const w=n[v].slice(0),C=n[v+1],I=(C[0]-w[0])/o,B=(C[1]-w[1])/o;for(let F=0;F<o;F++){w[0]+=I,w[1]+=B;const N=UD(r,i,w),V=zD(N),G=VD(e,V),Y=jD(G);Math.abs(Y[1])>89.999&&(Y[0]=A);const Z=Y[0]-A;Y[0]+=Z>180?-360:Z<-180?360:0,s[f++]=Y[0],s[f++]=Y[1],A=Y[0]}}return s[f++]=s[0],s[f++]=s[1],s}function qx(t){const e=Bae(t);return Cae(e)}function Bae(t){if(t.indexOf("/")>0)return t;const e=ND(t);return Pae(e)}function Oae(t){const e=qx(t);return Mae(e)}function Dae(t){let e;if(t.face===2||t.face===5){let r=null,i=0;for(let n=0;n<4;n++){const o=`${t.face}/${n}`,s=qx(o),f=hI(s);(typeof r>"u"||r===null)&&(r=new Float64Array(4*f.length)),r.set(f,i),i+=f.length}e=fI(r)}else{const r=hI(t);e=fI(r)}return e}function fI(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],r=[];for(let i=0;i<t.length;i+=2)e.push(t[i]),r.push(t[i+1]);return e.sort((i,n)=>i-n),r.sort((i,n)=>i-n),{west:e[0],east:e[e.length-1],north:r[r.length-1],south:r[0]}}function Fae(t,e){const r=(e==null?void 0:e.minimumHeight)||0,i=(e==null?void 0:e.maximumHeight)||0,n=qx(t),o=Dae(n),s=o.west,f=o.south,A=o.east,v=o.north,w=[];return w.push(new Ke(s,v,r)),w.push(new Ke(A,v,r)),w.push(new Ke(A,f,r)),w.push(new Ke(s,f,r)),w.push(new Ke(s,v,i)),w.push(new Ke(A,v,i)),w.push(new Ke(A,f,i)),w.push(new Ke(s,f,i)),w}function HD(t){const e=t.token,r={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},i=Fae(e,r),n=Oae(e),o=n[0],s=n[1],f=Ui.WGS84.cartographicToCartesian([o,s,r.maximumHeight]),A=new Ke(f[0],f[1],f[2]);i.push(A);const v=KO(i);return[...v.center,...v.halfAxes]}const Lae=4,kae=8,Nae={QUADTREE:Lae,OCTREE:kae};function Uae(t,e,r){if(t!=null&&t.box){const i=ND(t.s2VolumeInfo.token),n=xae(i,e),o=bae(n),s={...t.s2VolumeInfo};switch(s.token=o,r){case"OCTREE":const v=t.s2VolumeInfo,w=v.maximumHeight-v.minimumHeight,C=w/2,I=v.minimumHeight+w/2;v.minimumHeight=I-C,v.maximumHeight=I+C;break}return{box:HD(s),s2VolumeInfo:s}}}async function GD(t){const{implicitOptions:e,parentData:r={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,s2VolumeBox:n,loaderOptions:o}=t;let{subtree:s,level:f=0,globalData:A={level:0,mortonIndex:0,x:0,y:0,z:0}}=t;const{subdivisionScheme:v,subtreeLevels:w,maximumLevel:C,contentUrlTemplate:I,subtreesUriTemplate:B,basePath:F}=e,N={children:[],lodMetricValue:0,contentUrl:""};if(!C)return KM.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${I} won't be loaded...`),N;const V=f+A.level;if(V>C)return N;const G=Nae[v],Y=Math.log2(G),Z=i&1,se=i>>1&1,ge=i>>2&1,Pe=(G**f-1)/(G-1);let Ue=_h(r.mortonIndex,i,Y),Fe=Pe+Ue,pe=_h(r.x,Z,1),Te=_h(r.y,se,1),Ae=_h(r.z,ge,1),Le=!1;f>=w&&(Le=l1(s.childSubtreeAvailability,Ue));const Ve=_h(A.x,pe,f),Xe=_h(A.y,Te,f),dt=_h(A.z,Ae,f);if(Le){const rr=`${F}/${B}`,Ot=Kb(rr,V,Ve,Xe,dt);s=await Ic(Ot,OD,o),A={mortonIndex:Ue,x:pe,y:Te,z:Ae,level:f},Ue=0,Fe=0,pe=0,Te=0,Ae=0,f=0}if(!l1(s.tileAvailability,Fe))return N;l1(s.contentAvailability,Fe)&&(N.contentUrl=Kb(I,V,Ve,Xe,dt));const mr=f+1,_r={mortonIndex:Ue,x:pe,y:Te,z:Ae};for(let rr=0;rr<G;rr++){const Ot=Uae(n,rr,v),Qt=await GD({subtree:s,implicitOptions:e,loaderOptions:o,parentData:_r,childIndex:rr,level:mr,globalData:{...A},s2VolumeBox:Ot});if(Qt.contentUrl||Qt.children.length){const qt=V+1,ut=zae(Qt,qt,{childTileX:pe,childTileY:Te,childTileZ:Ae},e,n);N.children.push(ut)}}return N}function l1(t,e){let r;return Array.isArray(t)?(r=t[0],t.length>1&&KM.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=t,"constant"in r?!!r.constant:r.explicitBitstream?Hae(e,r.explicitBitstream):!1}function zae(t,e,r,i,n){const{basePath:o,refine:s,getRefine:f,lodMetricType:A,getTileType:v,rootLodMetricValue:w,rootBoundingVolume:C}=i,I=t.contentUrl&&t.contentUrl.replace(`${o}/`,""),B=w/2**e,F=n!=null&&n.box?{box:n.box}:C,N=Vae(e,F,r);return{children:t.children,contentUrl:t.contentUrl,content:{uri:I},id:t.contentUrl,refine:f(s),type:v(t),lodMetricType:A,lodMetricValue:B,geometricError:B,transform:t.transform,boundingVolume:N}}function Vae(t,e,r){if(e.region){const{childTileX:i,childTileY:n,childTileZ:o}=r,[s,f,A,v,w,C]=e.region,I=2**t,B=(A-s)/I,F=(v-f)/I,N=(C-w)/I,[V,G]=[s+B*i,s+B*(i+1)],[Y,Z]=[f+F*n,f+F*(n+1)],[se,ge]=[w+N*o,w+N*(o+1)];return{region:[V,Y,G,Z,se,ge]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function _h(t,e,r){return(t<<r)+e}function Kb(t,e,r,i,n){const o=jae({level:e,x:r,y:i,z:n});return t.replace(/{level}|{x}|{y}|{z}/gi,s=>o[s])}function jae(t){const e={};for(const r in t)e[`{${r}}`]=t[r];return e}function Hae(t,e){const r=Math.floor(t/8),i=t%8;return(e[r]>>i&1)===1}function $x(t,e=""){if(!e)return Sc.EMPTY;const i=e.split("?")[0].split(".").pop();switch(i){case"pnts":return Sc.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Sc.SCENEGRAPH;default:return i||Sc.EMPTY}}function Zx(t){switch(t){case"REPLACE":case"replace":return tl.REPLACE;case"ADD":case"add":return tl.ADD;default:return t}}function Yb(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const i=new URL(t,`${e}/`);return decodeURI(i.toString())}else if(t.startsWith("/"))return t;return Nk(e,t)}function dI(t,e){var n;if(!t)return null;let r;if(t.content){const o=t.content.uri||((n=t.content)==null?void 0:n.url);typeof o<"u"&&(r=Yb(o,e))}return{...t,id:r,contentUrl:r,lodMetricType:nA.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:$x(t,r),refine:Zx(t.refine)}}async function Gae(t,e,r){let i=null;const n=pI(t.root);n&&t.root?i=await AI(t.root,t,e,n,r):i=dI(t.root,e);const o=[];for(o.push(i);o.length>0;){const s=o.pop()||{},f=s.children||[],A=[];for(const v of f){const w=pI(v);let C;w?C=await AI(v,t,e,w,r):C=dI(v,e),C&&(A.push(C),o.push(C))}s.children=A}return i}async function AI(t,e,r,i,n){var se,ge,Pe;const{subdivisionScheme:o,maximumLevel:s,availableLevels:f,subtreeLevels:A,subtrees:{uri:v}}=i,w=Kb(v,0,0,0,0),C=Yb(w,r),I=await Ic(C,OD,n),B=(se=t.content)==null?void 0:se.uri,F=B?Yb(B,r):"",N=(ge=e==null?void 0:e.root)==null?void 0:ge.refine,V=t.geometricError,G=(Pe=t.boundingVolume.extensions)==null?void 0:Pe["3DTILES_bounding_volume_S2"];if(G){const Fe={box:HD(G),s2VolumeInfo:G};t.boundingVolume=Fe}const Y=t.boundingVolume,Z={contentUrlTemplate:F,subtreesUriTemplate:v,subdivisionScheme:o,subtreeLevels:A,maximumLevel:Number.isFinite(f)?f-1:s,refine:N,basePath:r,lodMetricType:nA.GEOMETRIC_ERROR,rootLodMetricValue:V,rootBoundingVolume:Y,getTileType:$x,getRefine:Zx};return await Wae(t,r,I,Z,n)}async function Wae(t,e,r,i,n){if(!t)return null;const{children:o,contentUrl:s}=await GD({subtree:r,implicitOptions:i,loaderOptions:n});let f,A=null;return s&&(f=s,A={uri:s.replace(`${e}/`,"")}),{...t,id:f,contentUrl:f,lodMetricType:nA.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:$x(t,f),refine:Zx(t.refine),content:A||t.content,children:o}}function pI(t){var e;return((e=t==null?void 0:t.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const WD={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:ED,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Xae,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Xae(t,e={},r){const i=e["3d-tiles"]||{};let n;return i.isTileset==="auto"?n=(r==null?void 0:r.url)&&r.url.indexOf(".json")!==-1:n=i.isTileset,n?qae(t,e,r):$ae(t,e,r)}async function qae(t,e,r){var A;const i=JSON.parse(new TextDecoder().decode(t)),n=(r==null?void 0:r.url)||"",o=Zae(n),s=await Gae(i,o,e||{});return{...i,shape:"tileset3d",loader:WD,url:n,queryString:(r==null?void 0:r.queryString)||"",basePath:o,root:s||i.root,type:So.TILES3D,lodMetricType:nA.GEOMETRIC_ERROR,lodMetricValue:((A=i.root)==null?void 0:A.geometricError)||0}}async function $ae(t,e,r){const i={content:{shape:"tile3d",featureIds:null}};return await BD(t,0,e,r,i.content),i.content}function Zae(t){return f2(t)}const gI=[0],Kae={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:WD,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,r)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class Kx extends rs{initializeState(){"onTileLoadFail"in this.props&&fr.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,r;return!!((r=(e=this.state)==null?void 0:e.tileset3d)!=null&&r.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:r,changeFlags:i}){if(e.data&&e.data!==r.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:n}=this.state;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:n}=this.state;for(const o in n)n[o].needsUpdate=!0}}activateViewport(e){const{activeViewports:r,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,r[e.id]=e;const n=i==null?void 0:i[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:r}){const i=r&&r.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:r}){const{tile:i}=e.props,{id:n}=r;return i.selected&&i.viewportIds.includes(n)}_updateAutoHighlight(e){const r=e.sourceTile,i=this.state.layerMap[r==null?void 0:r.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:r={}}=this.props,i=this.props.loader||this.props.loaders,n=Array.isArray(i)?i[0]:i,o={loadOptions:{...r}};let s=e;if(n.preload){const v=await n.preload(e,r);v.url&&(s=v.url),v.headers&&(o.loadOptions.fetch={...o.loadOptions.fetch,headers:v.headers}),Object.assign(o,v)}const f=await Ic(s,n,o.loadOptions),A=new Moe(f,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...o});this.setState({tileset3d:A,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(A)}_onTileLoad(e){const{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(e),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:r}=this.state,{timeline:i}=this.context,n=Object.keys(e).length;!i||!n||!r||r.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,r){if(!e.content)return null;switch(e.type){case Sc.POINTCLOUD:return this._makePointCloudLayer(e,r);case Sc.SCENEGRAPH:return this._make3DModelLayer(e);case Sc.MESH:return this._makeSimpleMeshLayer(e,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,r){const{attributes:i,pointCount:n,constantRGBA:o,cartographicOrigin:s,modelMatrix:f}=e.content,{positions:A,normals:v,colors:w}=i;if(!A)return null;const C=r&&r.props.data||{header:{vertexCount:n},attributes:{POSITION:A,NORMAL:v,COLOR_0:w}},{pointSize:I,getPointColor:B}=this.props,F=this.getSubLayerClass("pointcloud",h0);return new F({pointSize:I},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:C,coordinateSystem:br.METER_OFFSETS,coordinateOrigin:s,modelMatrix:f,getColor:o||B,_offset:0})}_make3DModelLayer(e){const{gltf:r,instances:i,cartographicOrigin:n,modelMatrix:o}=e.content,s=this.getSubLayerClass("scenegraph",g0);return new s({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:i||gI,scenegraph:r,coordinateSystem:br.METER_OFFSETS,coordinateOrigin:n,modelMatrix:o,getTransformMatrix:f=>f.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,r){const i=e.content,{attributes:n,indices:o,modelMatrix:s,cartographicOrigin:f,coordinateSystem:A=br.METER_OFFSETS,material:v,featureIds:w}=i,{_getMeshColor:C}=this.props,I=r&&r.props.mesh||new _s({topology:"triangle-list",attributes:Yae(n),indices:o}),B=this.getSubLayerClass("mesh",jx);return new B(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:I,data:gI,getColor:C(e),pbrMaterial:v,modelMatrix:s,coordinateOrigin:f,coordinateSystem:A,featureIds:w,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:r}=this.state;return e?e.tiles.map(i=>{const n=r[i.id]=r[i.id]||{tile:i};let{layer:o}=n;return i.selected&&(o?n.needsUpdate&&(o=this._getSubLayer(i,o),n.needsUpdate=!1):o=this._getSubLayer(i)),n.layer=o,o}).filter(Boolean):null}}Kx.defaultProps=Kae;Kx.layerName="Tile3DLayer";function Yae(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}function Jae(t,e,r,i){const n=Qae(e),o=new t.POSITION.value.constructor(n.length*6),s=new t.TEXCOORD_0.value.constructor(n.length*4),f=new e.constructor(n.length*6);for(let v=0;v<n.length;v++){const w=n[v];ele({edge:w,edgeIndex:v,attributes:t,skirtHeight:r,newPosition:o,newTexcoord0:s,newTriangles:f})}t.POSITION.value=Zy(t.POSITION.value,o),t.TEXCOORD_0.value=Zy(t.TEXCOORD_0.value,s);const A=e instanceof Array?e.concat(f):Zy(e,f);return{attributes:t,triangles:A}}function Qae(t){var n,o;const e=[];for(let s=0;s<t.length;s+=3)e.push([t[s],t[s+1]]),e.push([t[s+1],t[s+2]]),e.push([t[s+2],t[s]]);e.sort((s,f)=>Math.min(...s)-Math.min(...f)||Math.max(...s)-Math.max(...f));const r=[];let i=0;for(;i<e.length;)e[i][0]===((n=e[i+1])==null?void 0:n[1])&&e[i][1]===((o=e[i+1])==null?void 0:o[0])?i+=2:(r.push(e[i]),i++);return r}function ele({edge:t,edgeIndex:e,attributes:r,skirtHeight:i,newPosition:n,newTexcoord0:o,newTriangles:s}){const f=r.POSITION.value.length,A=e*2,v=e*2+1;n.set(r.POSITION.value.subarray(t[0]*3,t[0]*3+3),A*3),n[A*3+2]=n[A*3+2]-i,n.set(r.POSITION.value.subarray(t[1]*3,t[1]*3+3),v*3),n[v*3+2]=n[v*3+2]-i,o.set(r.TEXCOORD_0.value.subarray(t[0]*2,t[0]*2+2),A*2),o.set(r.TEXCOORD_0.value.subarray(t[1]*2,t[1]*2+2),v*2);const w=e*2*3;s[w]=t[0],s[w+1]=f/3+v,s[w+2]=t[1],s[w+3]=f/3+v,s[w+4]=t[0],s[w+5]=f/3+A}class tle{constructor(e=257){this.gridSize=e;const r=e-1;if(r&r-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=r*r*2-2,this.numParentTriangles=this.numTriangles-r*r,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let i=0;i<this.numTriangles;i++){let n=i+2,o=0,s=0,f=0,A=0,v=0,w=0;for(n&1?f=A=v=r:o=s=w=r;(n>>=1)>1;){const I=o+f>>1,B=s+A>>1;n&1?(f=o,A=s,o=v,s=w):(o=f,s=A,f=v,A=w),v=I,w=B}const C=i*4;this.coords[C+0]=o,this.coords[C+1]=s,this.coords[C+2]=f,this.coords[C+3]=A}}createTile(e){return new rle(e,this)}}class rle{constructor(e,r){const i=r.gridSize;if(e.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${e.length}.`);this.terrain=e,this.martini=r,this.errors=new Float32Array(e.length),this.update()}update(){const{numTriangles:e,numParentTriangles:r,coords:i,gridSize:n}=this.martini,{terrain:o,errors:s}=this;for(let f=e-1;f>=0;f--){const A=f*4,v=i[A+0],w=i[A+1],C=i[A+2],I=i[A+3],B=v+C>>1,F=w+I>>1,N=B+F-w,V=F+v-B,G=(o[w*n+v]+o[I*n+C])/2,Y=F*n+B,Z=Math.abs(G-o[Y]);if(s[Y]=Math.max(s[Y],Z),f<r){const se=(w+V>>1)*n+(v+N>>1),ge=(I+V>>1)*n+(C+N>>1);s[Y]=Math.max(s[Y],s[se],s[ge])}}}getMesh(e=0){const{gridSize:r,indices:i}=this.martini,{errors:n}=this;let o=0,s=0;const f=r-1;i.fill(0);function A(B,F,N,V,G,Y){const Z=B+N>>1,se=F+V>>1;Math.abs(B-G)+Math.abs(F-Y)>1&&n[se*r+Z]>e?(A(G,Y,B,F,Z,se),A(N,V,G,Y,Z,se)):(i[F*r+B]=i[F*r+B]||++o,i[V*r+N]=i[V*r+N]||++o,i[Y*r+G]=i[Y*r+G]||++o,s++)}A(0,0,f,f,f,0),A(f,f,0,0,0,f);const v=new Uint16Array(o*2),w=new Uint32Array(s*3);let C=0;function I(B,F,N,V,G,Y){const Z=B+N>>1,se=F+V>>1;if(Math.abs(B-G)+Math.abs(F-Y)>1&&n[se*r+Z]>e)I(G,Y,B,F,Z,se),I(N,V,G,Y,Z,se);else{const ge=i[F*r+B]-1,Pe=i[V*r+N]-1,Ue=i[Y*r+G]-1;v[2*ge]=B,v[2*ge+1]=F,v[2*Pe]=N,v[2*Pe+1]=V,v[2*Ue]=G,v[2*Ue+1]=Y,w[C++]=ge,w[C++]=Pe,w[C++]=Ue}}return I(0,0,f,f,f,0),I(f,f,0,0,0,f),{vertices:v,triangles:w}}}class ile{constructor(e,r,i=r){this.data=e,this.width=r,this.height=i,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;const n=r-1,o=i-1,s=this._addPoint(0,0),f=this._addPoint(n,0),A=this._addPoint(0,o),v=this._addPoint(n,o),w=this._addTriangle(v,s,A,-1,-1,-1);this._addTriangle(s,v,f,w,-1,-1),this._flush()}run(e=1){for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,r){return this.data[this.width*r+e]}_flush(){const e=this.coords;for(let r=0;r<this._pendingLen;r++){const i=this._pending[r],n=2*this.triangles[i*3+0],o=2*this.triangles[i*3+1],s=2*this.triangles[i*3+2];this._findCandidate(e[n],e[n+1],e[o],e[o+1],e[s],e[s+1],i)}this._pendingLen=0}_findCandidate(e,r,i,n,o,s,f){const A=Math.min(e,i,o),v=Math.min(r,n,s),w=Math.max(e,i,o),C=Math.max(r,n,s);let I=yh(i,n,o,s,A,v),B=yh(o,s,e,r,A,v),F=yh(e,r,i,n,A,v);const N=n-r,V=e-i,G=s-n,Y=i-o,Z=r-s,se=o-e,ge=yh(e,r,i,n,o,s),Pe=this.heightAt(e,r)/ge,Ue=this.heightAt(i,n)/ge,Fe=this.heightAt(o,s)/ge;let pe=0,Te=0,Ae=0,Le=0;for(let Ve=v;Ve<=C;Ve++){let Xe=0;I<0&&G!==0&&(Xe=Math.max(Xe,Math.floor(-I/G))),B<0&&Z!==0&&(Xe=Math.max(Xe,Math.floor(-B/Z))),F<0&&N!==0&&(Xe=Math.max(Xe,Math.floor(-F/N)));let dt=I+G*Xe,Nt=B+Z*Xe,gr=F+N*Xe,mr=!1;for(let _r=A+Xe;_r<=w;_r++){if(dt>=0&&Nt>=0&&gr>=0){mr=!0;const rr=Pe*dt+Ue*Nt+Fe*gr,Ot=Math.abs(rr-this.heightAt(_r,Ve));Le+=Ot*Ot,Ot>pe&&(pe=Ot,Te=_r,Ae=Ve)}else if(mr)break;dt+=G,Nt+=Z,gr+=N}I+=Y,B+=se,F+=V}(Te===e&&Ae===r||Te===i&&Ae===n||Te===o&&Ae===s)&&(pe=0),this._candidates[2*f]=Te,this._candidates[2*f+1]=Ae,this._rms[f]=Le,this._queuePush(f,pe,Le)}_step(){const e=this._queuePop(),r=e*3+0,i=e*3+1,n=e*3+2,o=this.triangles[r],s=this.triangles[i],f=this.triangles[n],A=this.coords[2*o],v=this.coords[2*o+1],w=this.coords[2*s],C=this.coords[2*s+1],I=this.coords[2*f],B=this.coords[2*f+1],F=this._candidates[2*e],N=this._candidates[2*e+1],V=this._addPoint(F,N);if(yh(A,v,w,C,F,N)===0)this._handleCollinear(V,r);else if(yh(w,C,I,B,F,N)===0)this._handleCollinear(V,i);else if(yh(I,B,A,v,F,N)===0)this._handleCollinear(V,n);else{const G=this._halfedges[r],Y=this._halfedges[i],Z=this._halfedges[n],se=this._addTriangle(o,s,V,G,-1,-1,r),ge=this._addTriangle(s,f,V,Y,-1,se+1),Pe=this._addTriangle(f,o,V,Z,se+2,ge+1);this._legalize(se),this._legalize(ge),this._legalize(Pe)}}_addPoint(e,r){const i=this.coords.length>>1;return this.coords.push(e,r),i}_addTriangle(e,r,i,n,o,s,f=this.triangles.length){const A=f/3;return this.triangles[f+0]=e,this.triangles[f+1]=r,this.triangles[f+2]=i,this._halfedges[f+0]=n,this._halfedges[f+1]=o,this._halfedges[f+2]=s,n>=0&&(this._halfedges[n]=f+0),o>=0&&(this._halfedges[o]=f+1),s>=0&&(this._halfedges[s]=f+2),this._candidates[2*A+0]=0,this._candidates[2*A+1]=0,this._queueIndices[A]=-1,this._rms[A]=0,this._pending[this._pendingLen++]=A,f}_legalize(e){const r=this._halfedges[e];if(r<0)return;const i=e-e%3,n=r-r%3,o=i+(e+1)%3,s=i+(e+2)%3,f=n+(r+2)%3,A=n+(r+1)%3,v=this.triangles[s],w=this.triangles[e],C=this.triangles[o],I=this.triangles[f],B=this.coords;if(!nle(B[2*v],B[2*v+1],B[2*w],B[2*w+1],B[2*C],B[2*C+1],B[2*I],B[2*I+1]))return;const F=this._halfedges[o],N=this._halfedges[s],V=this._halfedges[f],G=this._halfedges[A];this._queueRemove(i/3),this._queueRemove(n/3);const Y=this._addTriangle(v,I,C,-1,V,F,i),Z=this._addTriangle(I,v,w,Y,N,G,n);this._legalize(Y+1),this._legalize(Z+2)}_handleCollinear(e,r){const i=r-r%3,n=i+(r+1)%3,o=i+(r+2)%3,s=this.triangles[o],f=this.triangles[r],A=this.triangles[n],v=this._halfedges[n],w=this._halfedges[o],C=this._halfedges[r];if(C<0){const Pe=this._addTriangle(e,s,f,-1,w,-1,i),Ue=this._addTriangle(s,e,A,Pe,-1,v);this._legalize(Pe+1),this._legalize(Ue+2);return}const I=C-C%3,B=I+(C+2)%3,F=I+(C+1)%3,N=this.triangles[B],V=this._halfedges[B],G=this._halfedges[F];this._queueRemove(I/3);const Y=this._addTriangle(s,f,e,w,-1,-1,i),Z=this._addTriangle(f,N,e,G,-1,Y+1,I),se=this._addTriangle(N,A,e,V,-1,Z+1),ge=this._addTriangle(A,s,e,v,Y+2,se+1);this._legalize(Y),this._legalize(Z),this._legalize(se),this._legalize(ge)}_queuePush(e,r,i){const n=this._queue.length;this._queueIndices[e]=n,this._queue.push(e),this._errors.push(r),this._rmsSum+=i,this._queueUp(n)}_queuePop(){const e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){const e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){const r=this._queueIndices[e];if(r<0){const n=this._pending.indexOf(e);if(n!==-1)this._pending[n]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}const i=this._queue.length-1;i!==r&&(this._queueSwap(r,i),this._queueDown(r,i)||this._queueUp(r)),this._queuePopBack()}_queueLess(e,r){return this._errors[e]>this._errors[r]}_queueSwap(e,r){const i=this._queue[e],n=this._queue[r];this._queue[e]=n,this._queue[r]=i,this._queueIndices[i]=r,this._queueIndices[n]=e;const o=this._errors[e];this._errors[e]=this._errors[r],this._errors[r]=o}_queueUp(e){let r=e;for(;;){const i=r-1>>1;if(i===r||!this._queueLess(r,i))break;this._queueSwap(i,r),r=i}}_queueDown(e,r){let i=e;for(;;){const n=2*i+1;if(n>=r||n<0)break;const o=n+1;let s=n;if(o<r&&this._queueLess(o,n)&&(s=o),!this._queueLess(s,i))break;this._queueSwap(i,s),i=s}return i>e}}function yh(t,e,r,i,n,o){return(r-n)*(e-o)-(i-o)*(t-n)}function nle(t,e,r,i,n,o,s,f){const A=t-s,v=e-f,w=r-s,C=i-f,I=n-s,B=o-f,F=A*A+v*v,N=w*w+C*C,V=I*I+B*B;return A*(C*V-N*B)-v*(w*V-N*I)+F*(w*B-C*I)<0}function sle(t,e){const{meshMaxError:r,bounds:i,elevationDecoder:n}=e,{data:o,width:s,height:f}=t;let A,v;switch(e.tesselator){case"martini":A=Wg(o,s,f,n,e.tesselator),v=mI(r,s,A);break;case"delatin":A=Wg(o,s,f,n,e.tesselator),v=_I(r,s,f,A);break;default:s===f&&!(f&s-1)?(A=Wg(o,s,f,n,"martini"),v=mI(r,s,A)):(A=Wg(o,s,f,n,"delatin"),v=_I(r,s,f,A));break}const{vertices:w}=v;let{triangles:C}=v,I=ole(w,A,s,f,i);const B=m2(I);if(e.skirtHeight){const{attributes:F,triangles:N}=Jae(I,C,e.skirtHeight);I=F,C=N}return{loaderData:{header:{}},header:{vertexCount:C.length,boundingBox:B},mode:4,indices:{value:Uint32Array.from(C),size:1},attributes:I}}function mI(t,e,r){const i=e+1,o=new tle(i).createTile(r),{vertices:s,triangles:f}=o.getMesh(t);return{vertices:s,triangles:f}}function _I(t,e,r,i){const n=new ile(i,e+1,r+1);n.run(t);const{coords:o,triangles:s}=n;return{vertices:o,triangles:s}}function Wg(t,e,r,i,n){const{rScaler:o,bScaler:s,gScaler:f,offset:A}=i,v=new Float32Array((e+1)*(r+1));for(let w=0,C=0;C<r;C++)for(let I=0;I<e;I++,w++){const B=w*4,F=t[B+0],N=t[B+1],V=t[B+2];v[w+C]=F*o+N*f+V*s+A}if(n==="martini"){for(let w=(e+1)*e,C=0;C<e;C++,w++)v[w]=v[w-e-1];for(let w=r,C=0;C<r+1;C++,w+=r+1)v[w]=v[w-1]}return v}function ole(t,e,r,i,n){const o=r+1,s=t.length/2,f=new Float32Array(s*3),A=new Float32Array(s*2),[v,w,C,I]=n||[0,0,r,i],B=(C-v)/r,F=(I-w)/i;for(let N=0;N<s;N++){const V=t[N*2],G=t[N*2+1],Y=G*o+V;f[3*N+0]=V*B+v,f[3*N+1]=-G*F+I,f[3*N+2]=e[Y],A[2*N+0]=V/r,A[2*N+1]=G/i}return{POSITION:{value:f,size:3},TEXCOORD_0:{value:A,size:2}}}const ale="4.2.4",XD={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:ale,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}},lle={...XD,parse:cle};async function cle(t,e,r){const i={...e,mimeType:"application/x.image",image:{...e==null?void 0:e.image,type:"data"}},n=await aA(t,[],i,r),o={...lle.options.terrain,...e==null?void 0:e.terrain};return sle(n,o)}const yI=[1],ule={...Nc.defaultProps,elevationData:Qm,texture:{...Qm,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[XD]};function vI(t){return Array.isArray(t)?t.join(";"):t||""}class Yx extends rs{updateState({props:e,oldProps:r}){const i=e.elevationData!==r.elevationData;if(i){const{elevationData:o}=e,s=o&&(Array.isArray(o)||o.includes("{x}")&&o.includes("{y}"));this.setState({isTiled:s})}const n=i||e.meshMaxError!==r.meshMaxError||e.elevationDecoder!==r.elevationDecoder||e.bounds!==r.bounds;if(!this.state.isTiled&&n){const o=this.loadTerrain(e);this.setState({terrain:o})}e.workerUrl&&fr.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:r,elevationDecoder:i,meshMaxError:n,signal:o}){if(!e)return null;let s=this.getLoadOptions();s={...s,terrain:{skirtHeight:this.state.isTiled?n*2:0,...s==null?void 0:s.terrain,bounds:r,meshMaxError:n,elevationDecoder:i}};const{fetch:f}=this.props;return f(e,{propName:"elevationData",layer:this,loadOptions:s,signal:o})}getTiledTerrainData(e){const{elevationData:r,fetch:i,texture:n,elevationDecoder:o,meshMaxError:s}=this.props,{viewport:f}=this.context,A=Uh(r,e),v=n&&Uh(n,e),{signal:w}=e;let C=[0,0],I=[0,0];if(f.isGeospatial){const V=e.bbox;C=f.projectFlat([V.west,V.south]),I=f.projectFlat([V.east,V.north])}else{const V=e.bbox;C=[V.left,V.bottom],I=[V.right,V.top]}const B=[C[0],C[1],I[0],I[1]],F=this.loadTerrain({elevationData:A,bounds:B,elevationDecoder:o,meshMaxError:s,signal:w}),N=v?i(v,{propName:"texture",layer:this,loaders:[],signal:w}).catch(V=>null):Promise.resolve(null);return Promise.all([F,N])}renderSubLayers(e){const r=this.getSubLayerClass("mesh",zh),{color:i,wireframe:n,material:o}=this.props,{data:s}=e;if(!s)return null;const[f,A]=s;return new r(e,{data:yI,mesh:f,texture:A,_instanced:!1,coordinateSystem:br.CARTESIAN,getPosition:v=>[0,0,0],getColor:i,wireframe:n,material:o})}onViewportLoad(e){if(!e)return;const{zRange:r}=this.state,i=e.map(s=>s.content).filter(Boolean).map(s=>s[0].header.boundingBox.map(A=>A[2]));if(i.length===0)return;const n=Math.min(...i.map(s=>s[0])),o=Math.max(...i.map(s=>s[1]));(!r||n<r[0]||o>r[1])&&this.setState({zRange:[n,o]})}renderLayers(){const{color:e,material:r,elevationData:i,texture:n,wireframe:o,meshMaxError:s,elevationDecoder:f,tileSize:A,maxZoom:v,minZoom:w,extent:C,maxRequests:I,onTileLoad:B,onTileUnload:F,onTileError:N,maxCacheSize:V,maxCacheByteSize:G,refinementStrategy:Y}=this.props;if(this.state.isTiled)return new Nc(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:vI(i),texture:vI(n),meshMaxError:s,elevationDecoder:f}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:A,maxZoom:v,minZoom:w,extent:C,maxRequests:I,onTileLoad:B,onTileUnload:F,onTileError:N,maxCacheSize:V,maxCacheByteSize:G,refinementStrategy:Y});if(!i)return null;const Z=this.getSubLayerClass("mesh",zh);return new Z(this.getSubLayerProps({id:"mesh"}),{data:yI,mesh:this.state.terrain,texture:n,_instanced:!1,getPosition:se=>[0,0,0],getColor:e,material:r,wireframe:o})}}Yx.defaultProps=ule;Yx.layerName="TerrainLayer";const hle={clipBounds:[0,0,1,1],clipByInstance:void 0},qD=`
uniform vec4 clip_bounds;
bool clip_isInBounds(vec2 position) {
return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,fle={name:"clip-vs",vs:qD},dle={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
if (clip_isVisible < 0.5) discard;
`},Ale={name:"clip-fs",fs:qD},ple={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
if (!clip_isInBounds(clip_commonPosition)) discard;
`};class ty extends Z2{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[fle],inject:dle}:{modules:[Ale],inject:ple}}draw({uniforms:e}){const{clipBounds:r}=this.props;if(this.state.clipByInstance)e.clip_bounds=r;else{const i=this.projectPosition([r[0],r[1],0]),n=this.projectPosition([r[2],r[3],0]);e.clip_bounds=[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[0],n[0]),Math.max(i[1],n[1])]}}}ty.defaultProps=hle;ty.extensionName="ClipExtension";function gle(t,e,r){const i=mle(t),n=Object.keys(i).filter(o=>i[o]!==Array);return _le(t,{propArrayTypes:i,...e},{numericPropKeys:n,PositionDataType:Float32Array,triangulate:!0})}function mle(t){const e={};for(const r of t)if(r.properties)for(const i in r.properties){const n=r.properties[i];e[i]=Tle(n,e[i])}return e}function _le(t,e,r){const{pointPositionsCount:i,pointFeaturesCount:n,linePositionsCount:o,linePathsCount:s,lineFeaturesCount:f,polygonPositionsCount:A,polygonObjectsCount:v,polygonRingsCount:w,polygonFeaturesCount:C,propArrayTypes:I,coordLength:B}=e,{numericPropKeys:F=[],PositionDataType:N=Float32Array,triangulate:V=!0}=r,G=t[0]&&"id"in t[0],Y=t.length>65535?Uint32Array:Uint16Array,Z={type:"Point",positions:new N(i*B),globalFeatureIds:new Y(i),featureIds:n>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},se={type:"LineString",pathIndices:o>65535?new Uint32Array(s+1):new Uint16Array(s+1),positions:new N(o*B),globalFeatureIds:new Y(o),featureIds:f>65535?new Uint32Array(o):new Uint16Array(o),numericProps:{},properties:[],fields:[]},ge={type:"Polygon",polygonIndices:A>65535?new Uint32Array(v+1):new Uint16Array(v+1),primitivePolygonIndices:A>65535?new Uint32Array(w+1):new Uint16Array(w+1),positions:new N(A*B),globalFeatureIds:new Y(A),featureIds:C>65535?new Uint32Array(A):new Uint16Array(A),numericProps:{},properties:[],fields:[]};V&&(ge.triangles=[]);for(const Ue of[Z,se,ge])for(const Fe of F){const pe=I[Fe];Ue.numericProps[Fe]=new pe(Ue.positions.length/B)}se.pathIndices[s]=o,ge.polygonIndices[v]=A,ge.primitivePolygonIndices[w]=A;const Pe={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const Ue of t){const Fe=Ue.geometry,pe=Ue.properties||{};switch(Fe.type){case"Point":yle(Fe,Z,Pe,B,pe),Z.properties.push(u1(pe,F)),G&&Z.fields.push({id:Ue.id}),Pe.pointFeature++;break;case"LineString":vle(Fe,se,Pe,B,pe),se.properties.push(u1(pe,F)),G&&se.fields.push({id:Ue.id}),Pe.lineFeature++;break;case"Polygon":ble(Fe,ge,Pe,B,pe),ge.properties.push(u1(pe,F)),G&&ge.fields.push({id:Ue.id}),Pe.polygonFeature++;break;default:throw new Error("Invalid geometry type")}Pe.feature++}return wle(Z,se,ge,B)}function yle(t,e,r,i,n){e.positions.set(t.data,r.pointPosition*i);const o=t.data.length/i;Jx(e,n,r.pointPosition,o),e.globalFeatureIds.fill(r.feature,r.pointPosition,r.pointPosition+o),e.featureIds.fill(r.pointFeature,r.pointPosition,r.pointPosition+o),r.pointPosition+=o}function vle(t,e,r,i,n){e.positions.set(t.data,r.linePosition*i);const o=t.data.length/i;Jx(e,n,r.linePosition,o),e.globalFeatureIds.fill(r.feature,r.linePosition,r.linePosition+o),e.featureIds.fill(r.lineFeature,r.linePosition,r.linePosition+o);for(let s=0,f=t.indices.length;s<f;++s){const A=t.indices[s],v=s===f-1?t.data.length:t.indices[s+1];e.pathIndices[r.linePath++]=r.linePosition,r.linePosition+=(v-A)/i}}function ble(t,e,r,i,n){e.positions.set(t.data,r.polygonPosition*i);const o=t.data.length/i;Jx(e,n,r.polygonPosition,o),e.globalFeatureIds.fill(r.feature,r.polygonPosition,r.polygonPosition+o),e.featureIds.fill(r.polygonFeature,r.polygonPosition,r.polygonPosition+o);for(let s=0,f=t.indices.length;s<f;++s){const A=r.polygonPosition;e.polygonIndices[r.polygonObject++]=A;const v=t.areas[s],w=t.indices[s],C=t.indices[s+1];for(let B=0,F=w.length;B<F;++B){const N=w[B],V=B===F-1?C===void 0?t.data.length:C[0]:w[B+1];e.primitivePolygonIndices[r.polygonRing++]=r.polygonPosition,r.polygonPosition+=(V-N)/i}const I=r.polygonPosition;xle(e,v,w,{startPosition:A,endPosition:I,coordLength:i})}}function xle(t,e,r,{startPosition:i,endPosition:n,coordLength:o}){if(!t.triangles)return;const s=i*o,f=n*o,A=t.positions.subarray(s,f),v=r[0],w=r.slice(1).map(I=>(I-v)/o),C=gQ(A,w,o,e);for(let I=0,B=C.length;I<B;++I)t.triangles.push(i+C[I])}function c1(t,e){const r={};for(const i in t)r[i]={value:t[i],size:e};return r}function wle(t,e,r,i){const n={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:c1(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:c1(e.numericProps,1)},polygons:{...r,positions:{value:r.positions,size:i},polygonIndices:{value:r.polygonIndices,size:1},primitivePolygonIndices:{value:r.primitivePolygonIndices,size:1},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:c1(r.numericProps,1)}};return n.polygons&&r.triangles&&(n.polygons.triangles={value:new Uint32Array(r.triangles),size:1}),n}function Jx(t,e,r,i){for(const n in t.numericProps)if(n in e){const o=e[n];t.numericProps[n].fill(o,r,r+i)}}function u1(t,e){const r={};for(const i in t)e.includes(i)||(r[i]=t[i]);return r}function Tle(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function Jb(t,e){const r=e==null?void 0:e.globalFeatureId;return r!==void 0?Ele(t,r):Sle(t,e==null?void 0:e.type)}function Ele(t,e){const r=$D(t);for(const i of r){let n=0,o=i.featureIds.value[0];for(let s=0;s<i.featureIds.value.length;s++){const f=i.featureIds.value[s];if(f!==o){if(e===i.globalFeatureIds.value[n])return r_(i,n,s);n=s,o=f}}if(e===i.globalFeatureIds.value[n])return r_(i,n,i.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function Sle(t,e){const r=$D(t);return Ple(r)}function Cle(t,e,r){switch(t.type){case"Point":return Ble(t,e,r);case"LineString":return Rle(t,e,r);case"Polygon":return ZD(t,e,r);default:const i=t;throw new Error(`Unsupported geometry type: ${i==null?void 0:i.type}`)}}function $D(t,e){const r=[];return t.points&&(t.points.type="Point",r.push(t.points)),t.lines&&(t.lines.type="LineString",r.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",r.push(t.polygons)),r}function Ple(t){const e=[];for(const r of t){if(r.featureIds.value.length===0)continue;let i=0,n=r.featureIds.value[0];for(let o=0;o<r.featureIds.value.length;o++){const s=r.featureIds.value[o];s!==n&&(e.push(r_(r,i,o)),i=o,n=s)}e.push(r_(r,i,r.featureIds.value.length))}return e}function r_(t,e,r){const i=Cle(t,e,r),n=Mle(t,e),o=Ile(t,e);return{type:"Feature",geometry:i,properties:n,...o}}function Ile(t,e=0,r){return t.fields&&t.fields[t.featureIds.value[e]]}function Mle(t,e=0,r){const i=Object.assign({},t.properties[t.featureIds.value[e]]);for(const n in t.numericProps)i[n]=t.numericProps[n].value[e];return i}function ZD(t,e=-1/0,r=1/0){const{positions:i}=t,n=t.polygonIndices.value.filter(A=>A>=e&&A<=r),o=t.primitivePolygonIndices.value.filter(A=>A>=e&&A<=r);if(!(n.length>2)){const A=[];for(let v=0;v<o.length-1;v++){const w=o[v],C=o[v+1],I=i_(i,w,C);A.push(I)}return{type:"Polygon",coordinates:A}}const f=[];for(let A=0;A<n.length-1;A++){const v=n[A],w=n[A+1],C=ZD(t,v,w).coordinates;f.push(C)}return{type:"MultiPolygon",coordinates:f}}function Rle(t,e=-1/0,r=1/0){const{positions:i}=t,n=t.pathIndices.value.filter(f=>f>=e&&f<=r);if(!(n.length>2))return{type:"LineString",coordinates:i_(i,n[0],n[1])};const s=[];for(let f=0;f<n.length-1;f++){const A=i_(i,n[f],n[f+1]);s.push(A)}return{type:"MultiLineString",coordinates:s}}function Ble(t,e,r){const{positions:i}=t,n=i_(i,e,r);return n.length>1?{type:"MultiPoint",coordinates:n}:{type:"Point",coordinates:n[0]}}function i_(t,e,r){e=e||0,r=r||t.value.length/t.size;const i=[];for(let n=e;n<r;n++){const o=Array();for(let s=n*t.size;s<(n+1)*t.size;s++)o.push(Number(t.value[s]));i.push(o)}return i}var Qx={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Qx.read=function(t,e,r,i,n){var o,s,f=n*8-i-1,A=(1<<f)-1,v=A>>1,w=-7,C=r?n-1:0,I=r?-1:1,B=t[e+C];for(C+=I,o=B&(1<<-w)-1,B>>=-w,w+=f;w>0;o=o*256+t[e+C],C+=I,w-=8);for(s=o&(1<<-w)-1,o>>=-w,w+=i;w>0;s=s*256+t[e+C],C+=I,w-=8);if(o===0)o=1-v;else{if(o===A)return s?NaN:(B?-1:1)*(1/0);s=s+Math.pow(2,i),o=o-v}return(B?-1:1)*s*Math.pow(2,o-i)};Qx.write=function(t,e,r,i,n,o){var s,f,A,v=o*8-n-1,w=(1<<v)-1,C=w>>1,I=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=i?0:o-1,F=i?1:-1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,s=w):(s=Math.floor(Math.log(e)/Math.LN2),e*(A=Math.pow(2,-s))<1&&(s--,A*=2),s+C>=1?e+=I/A:e+=I*Math.pow(2,1-C),e*A>=2&&(s++,A/=2),s+C>=w?(f=0,s=w):s+C>=1?(f=(e*A-1)*Math.pow(2,n),s=s+C):(f=e*Math.pow(2,C-1)*Math.pow(2,n),s=0));n>=8;t[r+B]=f&255,B+=F,f/=256,n-=8);for(s=s<<n|f,v+=n;v>0;t[r+B]=s&255,B+=F,s/=256,v-=8);t[r+B-F]|=N*128};var Ole=gi,Xg=Qx;function gi(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}gi.Varint=0;gi.Fixed64=1;gi.Bytes=2;gi.Fixed32=5;var Qb=65536*65536,bI=1/Qb,Dle=12,KD=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");gi.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,o=this.pos;this.type=i&7,t(n,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=qg(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wI(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=qg(this.buf,this.pos)+qg(this.buf,this.pos+4)*Qb;return this.pos+=8,t},readSFixed64:function(){var t=qg(this.buf,this.pos)+wI(this.buf,this.pos+4)*Qb;return this.pos+=8,t},readFloat:function(){var t=Xg.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xg.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,r,i;return i=e[this.pos++],r=i&127,i<128||(i=e[this.pos++],r|=(i&127)<<7,i<128)||(i=e[this.pos++],r|=(i&127)<<14,i<128)||(i=e[this.pos++],r|=(i&127)<<21,i<128)?r:(i=e[this.pos],r|=(i&15)<<28,Fle(r,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=Dle&&KD?Zle(this.buf,e,t):$le(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==gi.Bytes)return t.push(this.readVarint(e));var r=_c(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==gi.Bytes)return t.push(this.readSVarint());var e=_c(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==gi.Bytes)return t.push(this.readBoolean());var e=_c(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==gi.Bytes)return t.push(this.readFloat());var e=_c(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==gi.Bytes)return t.push(this.readDouble());var e=_c(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==gi.Bytes)return t.push(this.readFixed32());var e=_c(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==gi.Bytes)return t.push(this.readSFixed32());var e=_c(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==gi.Bytes)return t.push(this.readFixed64());var e=_c(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==gi.Bytes)return t.push(this.readSFixed64());var e=_c(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===gi.Varint)for(;this.buf[this.pos++]>127;);else if(e===gi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===gi.Fixed32)this.pos+=4;else if(e===gi.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),nd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),nd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),nd(this.buf,t&-1,this.pos),nd(this.buf,Math.floor(t*bI),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),nd(this.buf,t&-1,this.pos),nd(this.buf,Math.floor(t*bI),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){Lle(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=Kle(this.buf,t,this.pos);var r=this.pos-e;r>=128&&xI(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Xg.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Xg.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&xI(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,gi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ule,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,zle,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Hle,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Vle,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,jle,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Gle,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Wle,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Xle,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,qle,e)},writeBytesField:function(t,e){this.writeTag(t,gi.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,gi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,gi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,gi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,gi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,gi.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,gi.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,gi.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,gi.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,gi.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function Fle(t,e,r){var i=r.buf,n,o;if(o=i[r.pos++],n=(o&112)>>4,o<128||(o=i[r.pos++],n|=(o&127)<<3,o<128)||(o=i[r.pos++],n|=(o&127)<<10,o<128)||(o=i[r.pos++],n|=(o&127)<<17,o<128)||(o=i[r.pos++],n|=(o&127)<<24,o<128)||(o=i[r.pos++],n|=(o&1)<<31,o<128))return id(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function _c(t){return t.type===gi.Bytes?t.readVarint()+t.pos:t.pos+1}function id(t,e,r){return r?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function Lle(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(r=~(-t%4294967296),i=~(-t/4294967296),r^4294967295?r=r+1|0:(r=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),kle(r,i,e),Nle(i,e)}function kle(t,e,r){r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos]=t&127}function Nle(t,e){var r=(t&7)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function xI(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function Ule(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function zle(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Vle(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function jle(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Hle(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Gle(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function Wle(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Xle(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function qle(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function qg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function nd(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function wI(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function $le(t,e,r){for(var i="",n=e;n<r;){var o=t[n],s=null,f=o>239?4:o>223?3:o>191?2:1;if(n+f>r)break;var A,v,w;f===1?o<128&&(s=o):f===2?(A=t[n+1],(A&192)===128&&(s=(o&31)<<6|A&63,s<=127&&(s=null))):f===3?(A=t[n+1],v=t[n+2],(A&192)===128&&(v&192)===128&&(s=(o&15)<<12|(A&63)<<6|v&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):f===4&&(A=t[n+1],v=t[n+2],w=t[n+3],(A&192)===128&&(v&192)===128&&(w&192)===128&&(s=(o&15)<<18|(A&63)<<12|(v&63)<<6|w&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,f=1):s>65535&&(s-=65536,i+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),i+=String.fromCharCode(s),n+=f}return i}function Zle(t,e,r){return KD.decode(t.subarray(e,r))}function Kle(t,e,r){for(var i=0,n,o;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(o)if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,o=n;continue}else n=o-55296<<10|n-56320|65536,o=null;else{n>56319||i+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):o=n;continue}else o&&(t[r++]=239,t[r++]=191,t[r++]=189,o=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=n&63|128)}return r}const ew=oA(Ole);function Yle(t){const e=t.length;if(e<=1)return[t];const r=[];let i,n;for(let o=0;o<e;o++){const s=Jle(t[o]);s!==0&&(n===void 0&&(n=s<0),n===s<0?(i&&r.push(i),i=[t[o]]):i&&i.push(t[o]))}return i&&r.push(i),r}function Jle(t){let e=0;for(let r=0,i=t.length-1,n,o;r<t.length;i=r++)n=t[r],o=t[i],e+=(o[0]-n[0])*(n[1]+o[1]);return e}function Qle(t,e,r){e&&r&&(t===1?e.id=r.readVarint():t===2?ece(r,e):t===3?e.type=r.readVarint():t===4&&(e._geometry=r.pos))}function ece(t,e){const r=t.readVarint()+t.pos;for(;t.pos<r;){const i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}class tw{constructor(e,r,i,n,o){U(this,"properties");U(this,"extent");U(this,"type");U(this,"id");U(this,"_pbf");U(this,"_geometry");U(this,"_keys");U(this,"_values");this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=n,this._values=o,e.readFields(Qle,this,r)}static get types(){return["Unknown","Point","LineString","Polygon"]}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let i=1,n=0,o=0,s=0;const f=[];let A;for(;e.pos<r;){if(n<=0){const v=e.readVarint();i=v&7,n=v>>3}if(n--,i===1||i===2)o+=e.readSVarint(),s+=e.readSVarint(),i===1&&(A&&f.push(A),A=[]),A&&A.push([o,s]);else if(i===7)A&&A.push(A[0].slice());else throw new Error(`unknown command ${i}`)}return A&&f.push(A),f}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let i=1,n=0,o=0,s=0,f=1/0,A=-1/0,v=1/0,w=-1/0;for(;e.pos<r;){if(n<=0){const C=e.readVarint();i=C&7,n=C>>3}if(n--,i===1||i===2)o+=e.readSVarint(),s+=e.readSVarint(),o<f&&(f=o),o>A&&(A=o),s<v&&(v=s),s>w&&(w=s);else if(i!==7)throw new Error(`unknown command ${i}`)}return[f,v,A,w]}_toGeoJSON(e){let r=this.loadGeometry(),i=tw.types[this.type],n,o;switch(this.type){case 1:const f=[];for(n=0;n<r.length;n++)f[n]=r[n][0];r=f,e(r,this);break;case 2:for(n=0;n<r.length;n++)e(r[n],this);break;case 3:for(r=Yle(r),n=0;n<r.length;n++)for(o=0;o<r[n].length;o++)e(r[n][o],this);break}r.length===1?r=r[0]:i=`Multi${i}`;const s={type:"Feature",geometry:{type:i,coordinates:r},properties:this.properties};return this.id!==null&&(s.id=this.id),s}toGeoJSON(e){if(typeof e=="function")return this._toGeoJSON(e);const{x:r,y:i,z:n}=e,o=this.extent*Math.pow(2,n),s=this.extent*r,f=this.extent*i;function A(v){for(let w=0;w<v.length;w++){const C=v[w];C[0]=(C[0]+s)*360/o-180;const I=180-(C[1]+f)*360/o;C[1]=360/Math.PI*Math.atan(Math.exp(I*Math.PI/180))-90}}return this._toGeoJSON(A)}}let tce=class{constructor(e,r){U(this,"version");U(this,"name");U(this,"extent");U(this,"length");U(this,"_pbf");U(this,"_keys");U(this,"_values");U(this,"_features");this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(rce,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new tw(this._pbf,r,this.extent,this._keys,this._values)}};function rce(t,e,r){e&&r&&(t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(ice(r)))}function ice(t){let e=null;const r=t.readVarint()+t.pos;for(;t.pos<r;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}class nce{constructor(e,r){U(this,"layers");this.layers=e.readFields(sce,{},r)}}function sce(t,e,r){if(t===3&&r){const i=new tce(r,r.readVarint()+r.pos);i.length&&e&&(e[i.name]=i)}}function oce(t){const e=t.indices.length,r="Polygon";if(e<=1)return{type:r,data:t.data,areas:[[Zm(t.data)]],indices:[t.indices]};const i=[],n=[];let o=[],s=[],f,A=0;for(let v,w=0,C;w<e;w++){C=t.indices[w]-A,v=t.indices[w+1]-A||t.data.length;const I=t.data.slice(C,v),B=Zm(I);if(B===0){const F=t.data.slice(0,C),N=t.data.slice(v);t.data=F.concat(N),A+=v-C;continue}f===void 0&&(f=B<0),f===B<0?(s.length&&(i.push(o),n.push(s)),s=[C],o=[B]):(o.push(B),s.push(C))}return o&&i.push(o),s.length&&n.push(s),{type:r,areas:i,indices:n,data:t.data}}function ace(t,e,r,i){for(let n=0,o=t.length;n<o;n+=2){t[n]=(t[n]+e)*360/i-180;const s=180-(t[n+1]+r)*360/i;t[n+1]=360/Math.PI*Math.atan(Math.exp(s*Math.PI/180))-90}}function lce(t,e,r){e&&r&&(t===1?e.id=r.readVarint():t===2?cce(r,e):t===3?e.type=r.readVarint():t===4&&(e._geometry=r.pos))}function cce(t,e){const r=t.readVarint()+t.pos;for(;t.pos<r;){const i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}let TI,vh,h1,$g,f1,d1,lp;class uce{constructor(e,r,i,n,o,s){U(this,"properties");U(this,"extent");U(this,"type");U(this,"id");U(this,"_pbf");U(this,"_geometry");U(this,"_keys");U(this,"_values");U(this,"_geometryInfo");this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=n,this._values=o,this._geometryInfo=s,e.readFields(lce,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry,TI=e.readVarint()+e.pos,vh=1,$g=0,f1=0,d1=0,lp=0;const r=[],i=[];for(;e.pos<TI;)if($g<=0&&(h1=e.readVarint(),vh=h1&7,$g=h1>>3),$g--,vh===1||vh===2)f1+=e.readSVarint(),d1+=e.readSVarint(),vh===1&&r.push(lp),i.push(f1,d1),lp+=2;else if(vh===7){if(lp>0){const n=r[r.length-1];i.push(i[n],i[n+1]),lp+=2}}else throw new Error(`unknown command ${vh}`);return{data:i,indices:r}}_toBinaryCoordinates(e){const r=this.loadGeometry();let i;e(r.data,this);const n=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=r.indices.length,i={type:"Point",...r};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=r.indices.length,this._geometryInfo.linePositionsCount+=r.data.length/n,i={type:"LineString",...r};break;case 3:i=oce(r),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(const s of i.indices)this._geometryInfo.polygonRingsCount+=s.length;this._geometryInfo.polygonPositionsCount+=i.data.length/n;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}const o={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(o.id=this.id),o}toBinaryCoordinates(e){if(typeof e=="function")return this._toBinaryCoordinates(e);const{x:r,y:i,z:n}=e,o=this.extent*Math.pow(2,n),s=this.extent*r,f=this.extent*i;return this._toBinaryCoordinates(A=>ace(A,s,f,o))}}class hce{constructor(e,r){U(this,"version");U(this,"name");U(this,"extent");U(this,"length");U(this,"_pbf");U(this,"_keys");U(this,"_values");U(this,"_features");this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(fce,this,r),this.length=this._features.length}feature(e,r){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new uce(this._pbf,i,this.extent,this._keys,this._values,r)}}function fce(t,e,r){e&&r&&(t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(dce(r)))}function dce(t){let e=null;const r=t.readVarint()+t.pos;for(;t.pos<r;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}class Ace{constructor(e,r){U(this,"layers");this.layers=e.readFields(pce,{},r)}}function pce(t,e,r){if(t===3&&r){const i=new hce(r,r.readVarint()+r.pos);i.length&&e&&(e[i.name]=i)}}function EI(t,e){var n,o;const r=mce(e),i=((n=e==null?void 0:e.gis)==null?void 0:n.format)||((o=e==null?void 0:e.mvt)==null?void 0:o.shape)||(e==null?void 0:e.shape);switch(i){case"columnar-table":return{shape:"columnar-table",data:A1(t,r)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:SI(t,r)};case"geojson":return SI(t,r);case"binary-geometry":return A1(t,r);case"binary":return A1(t,r);default:throw new Error(i||"undefined shape")}}function A1(t,e){const[r,i]=gce(t,e),n=gle(r,i);return n.byteLength=t.byteLength,n}function gce(t,e){const r=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[r,i];const n=new Ace(new ew(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(n.layers)).forEach(s=>{const f=n.layers[s];if(f)for(let A=0;A<f.length;A++){const v=f.feature(A,i),w=yce(v,e,s);r.push(w)}}),[r,i]}function SI(t,e){if(t.byteLength<=0)return[];const r=[],i=new nce(new ew(t));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(o=>{const s=i.layers[o];if(s)for(let f=0;f<s.length;f++){const A=s.feature(f),v=_ce(A,e,o);r.push(v)}}),r}function mce(t){var n;if(!(t!=null&&t.mvt))throw new Error("mvt options required");const e=((n=t.mvt)==null?void 0:n.coordinates)==="wgs84",{tileIndex:r}=t.mvt,i=r&&Number.isFinite(r.x)&&Number.isFinite(r.y)&&Number.isFinite(r.z);if(e&&!i)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.mvt}function _ce(t,e,r){const i=t.toGeoJSON(e.coordinates==="wgs84"?e.tileIndex:vce);return e.layerProperty&&(i.properties[e.layerProperty]=r),i}function yce(t,e,r){const i=t.toBinaryCoordinates(e.coordinates==="wgs84"?e.tileIndex:bce);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=r),i}function vce(t,e){const{extent:r}=e;for(let i=0;i<t.length;i++){const n=t[i];n[0]/=r,n[1]/=r}}function bce(t,e){const{extent:r}=e;for(let i=0,n=t.length;i<n;++i)t[i]/=r}const xce="4.2.4",YD={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:xce,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}}};({...YD});const wce={Point:JD,MultiPoint:Tce,LineString:QD,MultiLineString:Ece,Polygon:eF,MultiPolygon:Sce};function JD([t,e],[r,i],n){const o=el(r[0],i[0],t),s=el(r[1],i[1],e);return n.unprojectFlat([o,s])}function rw(t,e,r){return t.map(i=>JD(i,e,r))}function Tce(t,e,r){return rw(t,e,r)}function QD(t,e,r){return rw(t,e,r)}function Ece(t,e,r){return t.map(i=>QD(i,e,r))}function eF(t,e,r){return t.map(i=>rw(i,e,r))}function Sce(t,e,r){return t.map(i=>eF(i,e,r))}function Cce(t,e,r){const i=r.projectFlat([e.west,e.north]),n=r.projectFlat([e.east,e.south]),o=[i,n];return{...t,coordinates:wce[t.type](t.coordinates,o,r)}}const Pce=["points","lines","polygons"];function Ice(t,e,r,i){for(const n of Pce){const o=t[n]&&Mce(t[n],e,r,i);if(o>=0)return o}return-1}function Mce(t,e,r,i){const n=t.featureIds.value;if(!n.length)return-1;let o=0,s=n[n.length-1]+1;if(i){const A=Rce(t,i);if(A)o=A[0],s=A[1]+1;else return-1}let f=-1;if(e in t.numericProps){const A=t.numericProps[e].value.findIndex((v,w)=>v===r&&n[w]>=o&&n[w]<s);return A>=0?t.globalFeatureIds.value[A]:-1}else e?f=CI(t.properties,A=>A[e]===r,o,s):t.fields&&(f=CI(t.fields,A=>A.id===r,o,s));return f>=0?Bce(t,f):-1}function Rce(t,e){if(!t.__layers){const r={},{properties:i}=t;for(let n=0;n<i.length;n++){const{layerName:o}=i[n];o&&(r[o]?r[o][1]=n:r[o]=[n,n])}t.__layers=r}return t.__layers[e]}function Bce(t,e){if(!t.__ids){const r=[],i=t.featureIds.value,n=t.globalFeatureIds.value;for(let o=0;o<i.length;o++)r[i[o]]=n[o];t.__ids=r}return t.__ids[e]}function CI(t,e,r,i){for(let n=r;n<i;n++)if(e(t[n],n))return n;return-1}const p1=512,Oce={...kc.defaultProps,data:Qm,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[YD],binary:!0};class AA extends Nc{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var e;return!!((e=this.state)!=null&&e.data&&super.isLoaded)}updateState({props:e,oldProps:r,context:i,changeFlags:n}){var s;n.dataChanged&&this._updateTileData(),(s=this.state)!=null&&s.data&&(super.updateState({props:e,oldProps:r,context:i,changeFlags:n}),this._setWGS84PropertyForTiles());const{highlightColor:o}=e;o!==r.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,r=null;if(typeof e=="string"&&!Yie(e)){const{onDataLoad:i,fetch:n}=this.props;this.setState({data:null,tileJSON:null});try{r=await n(e,{propName:"data",layer:this,loaders:[]})}catch(o){this.raiseError(o,"loading TileJSON"),e=null}i&&i(r,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(r=e);r&&(e=r.tiles),this.setState({data:e,tileJSON:r})}_getTilesetOptions(){const e=super._getTilesetOptions(),r=this.state.tileJSON,{minZoom:i,maxZoom:n}=this.props;return r&&(Number.isFinite(r.minzoom)&&r.minzoom>i&&(e.minZoom=r.minzoom),Number.isFinite(r.maxzoom)&&(!Number.isFinite(n)||r.maxzoom<n)&&(e.maxZoom=r.maxzoom)),e}renderLayers(){var e;return(e=this.state)!=null&&e.data?super.renderLayers():null}getTileData(e){const{data:r,binary:i}=this.state,{index:n,signal:o}=e,s=Uh(r,e);if(!s)return Promise.reject("Invalid URL");let f=this.getLoadOptions();const{fetch:A}=this.props;return f={...f,mimeType:"application/x-protobuf",mvt:{...f==null?void 0:f.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:n},gis:i?{format:"binary"}:{}},A(s,{propName:"data",layer:this,loadOptions:f,signal:o})}renderSubLayers(e){const{x:r,y:i,z:n}=e.tile.index,o=Math.pow(2,n),s=p1/o,f=-s,A=p1*r/o,v=p1*(1-i/o),w=new Gr().scale([s,f,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=w,e.coordinateOrigin=[A,v,0],e.coordinateSystem=br.CARTESIAN,e.extensions=[...e.extensions||[],new ty]);const C=super.renderSubLayers(e);return this.state.binary&&!(C instanceof kc)&&fr.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),C}_updateAutoHighlight(e){const{uniqueIdProperty:r}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:n}=this.state,o=e.object;let s=null,f=null;o&&(s=g1(o,r),f=PI(o));let{highlightColor:A}=this.props;typeof A=="function"&&(A=A(e)),(i!==s||n!==f)&&this.setState({highlightColor:A,hoveredFeatureId:s,hoveredFeatureLayerName:f})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const r=super.getPickingInfo(e);if(this.state.binary&&r.index!==-1){const{data:i}=e.sourceLayer.props;r.object=Jb(i,{globalFeatureId:r.index})}return r.object&&!this._isWGS84()&&(r.object=MI(r.object,r.tile.bbox,this.context.viewport)),r}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:r,hoveredFeatureLayerName:i,binary:n}=this.state,{uniqueIdProperty:o,highlightedFeatureId:s}=this.props,f=e.content,A=II(s);if(!(II(r)||A))return-1;const w=A?s:r;return Array.isArray(f)?f.findIndex(C=>{const I=g1(C,o)===w,B=A||PI(C)===i;return I&&B}):f&&n?Ice(f,o,w,A?"":i):-1}_pickObjects(e){const{deck:r,viewport:i}=this.context,n=i.width,o=i.height,s=i.x,f=i.y,A=[this.id];return r.pickObjects({x:s,y:f,width:n,height:o,layerIds:A,maxObjects:e})}getRenderedFeatures(e=null){const r=this._pickObjects(e),i=new Set,n=[];for(const o of r){const s=g1(o.object,this.props.uniqueIdProperty);s===void 0?n.push(o.object):i.has(s)||(i.add(s),n.push(o.object))}return n}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:n}=i;if(i._contentWGS84===void 0&&Jie(n)){const o=this.state.binary?Jb(i.content):i.content;i._contentWGS84=o.map(s=>MI(s,n,this.context.viewport))}return i._contentWGS84}})})}}AA.layerName="MVTLayer";AA.defaultProps=Oce;function g1(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function PI(t){var e;return((e=t.properties)==null?void 0:e.layerName)||null}function II(t){return t!=null&&t!==""}function MI(t,e,r){const i={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>Cce(t.geometry,e,r).coordinates}),i}const RI="0123456789bcdefghjkmnpqrstuvwxyz",tF={};for(let t=0;t<RI.length;t++)tF[RI.charAt(t)]=t;const Dce=-90,Fce=90,Lce=-180,kce=180;function Nce(t){let e=!0,r=Fce,i=Dce,n=kce,o=Lce,s,f=0;for(let A=0,v=t.length;A<v;A++){const w=t[A].toLowerCase();f=tF[w];for(let C=4;C>=0;C--){const I=f>>C&1;e?(s=(n+o)/2,I===1?o=s:n=s):(s=(r+i)/2,I===1?i=s:r=s),e=!e}}return[i,o,r,n]}function Uce(t){const[e,r,i,n]=Nce(t);return[n,i,n,e,r,e,r,i,n,i]}const zce={getGeohash:{type:"accessor",value:t=>t.geohash}};class ry extends Hu{indexToBounds(){const{data:e,getGeohash:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>Uce(r(i,n))}}}ry.layerName="GeohashLayer";ry.defaultProps=zce;const Vce=Object.freeze(Object.defineProperty({__proto__:null,GeohashLayer:ry,GreatCircleLayer:Px,H3ClusterLayer:Y_,H3HexagonLayer:$l,MVTLayer:AA,QuadkeyLayer:W_,S2Layer:G_,TerrainLayer:Yx,Tile3DLayer:Kx,TileLayer:Nc,TripsLayer:$_,_GeoCellLayer:Hu,_Tile2DHeader:ZO,_Tileset2D:q_,_WMSLayer:Cx,_getURLFromTemplate:Uh},Symbol.toStringTag,{value:"Module"})),rF=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],iF=[0n,1n,2n,4n,8n,16n];function jce(t){return BigInt(`0x${t}`)}function e2(t){return t.toString(16)}function Hce(t){if(t.z<0||t.z>26)throw new Error("Wrong zoom");const e=BigInt(t.z);let r=BigInt(t.x)<<32n-e,i=BigInt(t.y)<<32n-e;for(let o=0;o<5;o++){const s=iF[5-o],f=rF[4-o];r=(r|r<<s)&f,i=(i|i<<s)&f}return 0x4000000000000000n|1n<<59n|e<<52n|(r|i<<1n)>>12n|0xfffffffffffffn>>e*2n}function nF(t){const e=t>>59n&7n,r=t>>57n&3n,i=t>>52n&0x1fn,n=(t&0xfffffffffffffn)<<12n;if(e!==1n&&r!==0n)throw new Error("Wrong mode");let o=n,s=n>>1n;for(let f=0;f<6;f++){const A=iF[f],v=rF[f];o=(o|o>>A)&v,s=(s|s>>A)&v}return o=o>>32n-i,s=s>>32n-i,{z:Number(i),x:Number(o),y:Number(s)}}function iw(t){return t>>52n&0x1fn}function sF(t){const e=iw(t)-1n;return t&~(0x1fn<<52n)|e<<52n|0xfffffffffffffn>>e*2n}function Gce(t,e,r,i=[],n,o){var A;if(!t.content)return!1;t.userData||(t.userData={});const s=(A=e.get(r))==null?void 0:A[0];if(s){if(i.every(v=>v.name in s))return!1;e.clear()}const f={};for(const v of t.content){let w=v.id;const C=typeof n=="function"?n(v,{}):n;for(let V=0;V<r-1;V++)w=sF(w);const I=Number(w);if(!(I in f)){f[I]={id:w,count:0,position:[0,0]};for(const{name:V,aggregation:G}of i)G==="any"?f[I][V]=v.properties[V]:f[I][V]=0}const B=f[I].count;f[I].count+=typeof o=="function"?o(v,{}):o;const F=f[I].count,N=F-B;f[I].position[0]=(B*f[I].position[0]+N*C[0])/F,f[I].position[1]=(B*f[I].position[1]+N*C[1])/F;for(const{name:V,aggregation:G}of i){const Y=f[I][V],Z=v.properties[V];G==="average"?f[I][V]=(B*Y+N*Z)/F:G==="count"||G==="sum"?f[I][V]=Y+Z:G==="max"?f[I][V]=Math.max(Y,Z):G==="min"&&(f[I][V]=Math.min(Y,Z))}}return e.set(r,Object.values(f)),!0}function Wce(t){const e=[],r=["any","average","count","min","max","sum"];for(const i of Object.keys(t.content[0].properties)){let n=i.split("_").pop().toLowerCase();r.includes(n)||(fr.warn(`No valid aggregation present in ${i} property`)(),n="any"),e.push({name:i,aggregation:n})}return e}function Xce(t,e){const r={};for(const{name:i,aggregation:n}of e)if(r[i]={min:1/0,max:-1/0},n!=="any")for(const o of t)r[i].min=Math.min(r[i].min,o[i]),r[i].max=Math.max(r[i].max,o[i]);return r}const Rp=new Uint16Array,BI={positions:{value:new Float32Array,size:2},properties:[],numericProps:{},featureIds:{value:Rp,size:1},globalFeatureIds:{value:Rp,size:1}};function qce(t){const e=new Float32Array(t.length*2),r=new Uint16Array(t.length);for(let i=0;i<t.length;i++)e.set(t[i].position,2*i),r[i]=i;return{shape:"binary-feature-collection",points:{type:"Point",positions:{value:e,size:2},properties:t,numericProps:{},featureIds:{value:r,size:1},globalFeatureIds:{value:r,size:1}},lines:{type:"LineString",pathIndices:{value:Rp,size:1},...BI},polygons:{type:"Polygon",polygonIndices:{value:Rp,size:1},primitivePolygonIndices:{value:Rp,size:1},...BI}}}const pA=512;class nw extends q_{getTileIndices(e){return super.getTileIndices(e).map(Hce).map(r=>({q:r,i:e2(r)}))}getTileId({q:e,i:r}){return r||e2(e)}getTileMetadata({q:e}){return super.getTileMetadata(nF(e))}getTileZoom({q:e}){return Number(iw(e))}getParentIndex({q:e}){return{q:sF(e)}}}const OI=512;function oF(t){const{x:e,y:r,z:i}=nF(t),n=OI/(1<<i);return[e*n,OI-r*n,n]}function $ce(t,e){const[r,i,n]=oF(t);return[[r,i],[r+e*n,i-e*n]]}function aF(t,e=1){const[r,i]=$ce(t,e),[n,o]=Gl(r),[s,f]=Gl(i);return[s,o,s,f,n,f,n,o,s,o]}function iy(t,e,r){const i=e.type===2?e.readVarint()+e.pos:e.pos+1;return r.value=new t(e.buf.buffer.slice(e.pos,i)),e.pos=i,r.value}class sw{static read(e,r){return e.readFields(sw._readField,{key:"",value:null},r)}static _readField(e,r,i){e===1?r.key=i.readString():e===2&&(r.value=i.readString())}}class Yh{static read(e,r){return e.readFields(Yh._readField,{},r)}static _readField(e,r,i){if(e===1){const{key:n,value:o}=sw.read(i,i.readVarint()+i.pos);r[n]=o}}}class m0{static read(e,r){const{value:i,size:n}=e.readFields(m0._readField,{value:[],size:0},r);return{value:i,size:n}}static _readField(e,r,i){e===1?iy(Float64Array,i,r):e===2&&(r.size=i.readVarint(!0))}}class wa{static read(e,r){const{value:i,size:n}=e.readFields(wa._readField,{value:[],size:0},r);return{value:new Uint32Array(i),size:n}}static _readField(e,r,i){e===1?i.readPackedVarint(r.value):e===2&&(r.size=i.readVarint(!0))}}class _0{static read(e,r){return e.readFields(_0._readField,{id:0},r)}static _readField(e,r,i){e===1&&(r.id=i.readVarint())}}class ow{static read(e,r){return e.readFields(ow._readField,{value:[]},r)}static _readField(e,r,i){e===1&&iy(Float64Array,i,r)}}class Jh{static read(e,r){return e.readFields(Jh._readField,{key:"",value:null},r)}static _readField(e,r,i){e===1?r.key=i.readString():e===2&&(r.value=ow.read(i,i.readVarint()+i.pos))}}class aw{static read(e,r){return e.readFields(aw._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},r)}static _readField(e,r,i){if(e===1)r.positions=m0.read(i,i.readVarint()+i.pos);else if(e===2)r.globalFeatureIds=wa.read(i,i.readVarint()+i.pos);else if(e===3)r.featureIds=wa.read(i,i.readVarint()+i.pos);else if(e===4)r.properties.push(Yh.read(i,i.readVarint()+i.pos));else if(e===5){const n=Jh.read(i,i.readVarint()+i.pos);r.numericProps[n.key]=n.value}else e===6&&r.fields.push(_0.read(i,i.readVarint()+i.pos))}}class lw{static read(e,r){return e.readFields(lw._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},r)}static _readField(e,r,i){if(e===1)r.positions=m0.read(i,i.readVarint()+i.pos);else if(e===2)r.pathIndices=wa.read(i,i.readVarint()+i.pos);else if(e===3)r.globalFeatureIds=wa.read(i,i.readVarint()+i.pos);else if(e===4)r.featureIds=wa.read(i,i.readVarint()+i.pos);else if(e===5)r.properties.push(Yh.read(i,i.readVarint()+i.pos));else if(e===6){const n=Jh.read(i,i.readVarint()+i.pos);r.numericProps[n.key]=n.value}else e===7&&r.fields.push(_0.read(i,i.readVarint()+i.pos))}}class cw{static read(e,r){return e.readFields(cw._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},r)}static _readField(e,r,i){if(e===1)r.positions=m0.read(i,i.readVarint()+i.pos);else if(e===2)r.polygonIndices=wa.read(i,i.readVarint()+i.pos);else if(e===3)r.globalFeatureIds=wa.read(i,i.readVarint()+i.pos);else if(e===4)r.featureIds=wa.read(i,i.readVarint()+i.pos);else if(e===5)r.primitivePolygonIndices=wa.read(i,i.readVarint()+i.pos);else if(e===6)r.triangles=wa.read(i,i.readVarint()+i.pos);else if(e===7)r.properties.push(Yh.read(i,i.readVarint()+i.pos));else if(e===8){const n=Jh.read(i,i.readVarint()+i.pos);r.numericProps[n.key]=n.value}else e===9&&r.fields.push(_0.read(i,i.readVarint()+i.pos))}}let Zce=class lF{static read(e,r){return e.readFields(lF._readField,{points:null,lines:null,polygons:null},r)}static _readField(e,r,i){e===1?r.points=aw.read(i,i.readVarint()+i.pos):e===2?r.lines=lw.read(i,i.readVarint()+i.pos):e===3&&(r.polygons=cw.read(i,i.readVarint()+i.pos))}};class uw{static read(e,r){return e.readFields(uw._readField,{value:[]},r)}static _readField(e,r,i){e===1&&iy(BigUint64Array,i,r)}}class hw{static read(e,r){return e.readFields(hw._readField,{indices:null,properties:[],numericProps:{}},r)}static _readField(e,r,i){if(e===1)r.indices=uw.read(i,i.readVarint()+i.pos);else if(e===2)r.properties.push(Yh.read(i,i.readVarint()+i.pos));else if(e===3){const n=Jh.read(i,i.readVarint()+i.pos);r.numericProps[n.key]=n.value}}}let Kce=class cF{static read(e,r){return e.readFields(cF._readField,{scheme:0,cells:null},r)}static _readField(e,r,i){e===1?r.scheme=i.readVarint():e===2&&(r.cells=hw.read(i,i.readVarint()+i.pos))}};function ny(t,e){const r=new ew(t);return e.read(r)}function Vh(t,e){fr.assert(t,e)}function Yce(t,e){const{properties:r,numericProps:i}=t;return new Proxy(r[e]||{},{get(n,o){return o in i?i[o].value[e]:n[o]},has(n,o){return o in i||o in n},ownKeys(n){return[...Object.keys(i),...Reflect.ownKeys(n)]},getOwnPropertyDescriptor(n,o){return{enumerable:!0,configurable:!0}}})}function fw(t,e){return`https://unpkg.com/@deck.gl/carto@${e}/dist/${t}-worker.js`}function Jce(t){const{cells:e,scheme:r}=t,i=e.indices.value.length,n=[];for(let o=0;o<i;o++){const s=r==="h3"?e2(e.indices.value[o]):e.indices.value[o],f={...e.properties[o]};for(const A of Object.keys(e.numericProps))f[A]=e.numericProps[A].value[o];n.push({id:s,properties:f})}return n}const uF="9.0.33",hF="cartoSpatialTile",Qce={cartoSpatialTile:{scheme:"quadbin",workerUrl:fw(hF,uF)}},fF={name:"CARTO Spatial Tile",version:uF,id:hF,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(t,e)=>DI(t,e),parseSync:DI,worker:!0,options:Qce};function DI(t,e){var s;if(!t)return null;const r=ny(t,Kce),{cells:i}=r,n=(s=e==null?void 0:e.cartoSpatialTile)==null?void 0:s.scheme;return Jce({cells:i,scheme:n})}function y0(t,e){var r,i,n;(i=(r=t==null?void 0:t.fetch)==null?void 0:r.headers)!=null&&i.Authorization||(t.fetch={...t.fetch,headers:{...(n=t.fetch)==null?void 0:n.headers,Authorization:`Bearer ${e}`}})}function eue(t,e){const r={};for(const{geoid:i,...n}of e.properties)i in r?fr.warn("Duplicate geoid key in boundary mapping, using first occurance")():r[i]=n;for(const i of["points","lines","polygons"]){const n=t[i];if(n.positions.value.length===0)continue;n.properties=n.properties.map(({geoid:v})=>r[v]);const{positions:o,globalFeatureIds:s}=n;let f=null;i==="lines"&&(f=n.pathIndices.value),i==="polygons"&&(f=n.polygonIndices.value);const A=o.value.length/o.size;for(const v in e.numericProps){const w=e.numericProps[v].value,C=w.constructor,I=new C(A);if(n.numericProps[v]={value:I,size:1},f)for(let B=0;B<f.length-1;B++){const F=f[B],N=f[B+1],V=s.value[F];I.fill(w[V],F,N)}else for(let B=0;B<A;B++){const F=s.value[B];I[B]=w[F]}}}return t}const jh={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="object"&&Array.isArray(t.tiles)&&t.tiles.every(r=>typeof r=="string"),equal:(t,e)=>Ws(t,e,2),async:!0};s0([fF]);const dF={data:jh,clusterLevel:{type:"number",value:5,min:1},getPosition:{type:"accessor",value:({id:t})=>aF(t,.5).slice(2,4)},getWeight:{type:"accessor",value:1},refinementStrategy:"no-overlap",tileSize:pA};class dw extends Nc{initializeState(){super.initializeState(),this.state.aggregationCache=new WeakMap}renderLayers(){var I;const e=(I=this.state.tileset)==null?void 0:I.tiles.filter(B=>B.isLoaded&&B.content&&this.state.tileset.isTileVisible(B));if(!(e!=null&&e.length))return null;e.sort((B,F)=>F.zoom-B.zoom);const{zoom:r}=this.context.viewport,{clusterLevel:i,getPosition:n,getWeight:o}=this.props,{aggregationCache:s}=this.state,f=Wce(e[0]),A=[];let v=!1;for(const B of e){const F=Math.round(r-B.zoom),N=Math.round(i)-F;let V=s.get(B.content);V||(V=new Map,s.set(B.content,V));const G=Gce(B,V,N,f,n,o);v||(v=G),A.push(...V.get(N))}A.sort((B,F)=>Number(F.count-B.count));const w=A==null?void 0:A.map(B=>B.id);if(v||(v=!Ws(w,this.state.clusterIds,1)),this.setState({clusterIds:w}),v){const B=Xce(A,f),F=qce(A);F.points.attributes={stats:B},this.setState({data:F})}const C={...this.props,id:"clusters",data:this.state.data,dataComparator:(B,F)=>{var G,Y,Z,se;const N=(Y=(G=B==null?void 0:B.points)==null?void 0:G.properties)==null?void 0:Y.map(ge=>ge.id),V=(se=(Z=F==null?void 0:F.points)==null?void 0:Z.properties)==null?void 0:se.map(ge=>ge.id);return Ws(N,V,1)}};return new kc(this.getSubLayerProps(C))}getPickingInfo(e){const r=e.info;if(r.index!==-1){const{data:i}=e.sourceLayer.props;r.object=Jb(i,{globalFeatureId:r.index})}return r}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}filterSubLayer(){return!0}}dw.layerName="ClusterGeoJsonLayer";dw.defaultProps=dF;class Aw extends rs{getLoadOptions(){const e=super.getLoadOptions()||{},r=this.props.data;return y0(e,r.accessToken),e.cartoSpatialTile={...e.cartoSpatialTile,scheme:"quadbin"},e}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r,maxresolution:i}=e;return[new dw(this.props,{id:`cluster-geojson-layer-${this.props.id}`,data:r,TilesetClass:nw,maxZoom:i,loadOptions:this.getLoadOptions()})]}}Aw.layerName="ClusterTileLayer";Aw.defaultProps=dF;const FI=85.051128;function tue({west:t,north:e,east:r,south:i},n){const f=[[e,r],[i,r],[i,t],[e,t]].map(w=>Ux(w[0],w[1],n)).map(w=>Math.max(...Gne(w).map(C=>Xne(C,jd.rads)))*180/Math.PI),A=Math.max(...f),v=Math.min(180,A/Math.cos((e+i)/2*Math.PI/180));return{north:Math.min(e+A,FI),east:r+v,south:Math.max(i-A,-FI),west:t-v}}function AF({west:t,north:e,east:r,south:i},n){const o=Math.abs(r-t);if(o>180){const f=Math.ceil(o/180);let A=[];for(let v=0;v<f;v++){const w=t+v*180,C=Math.min(w+179.9999999,r);A=A.concat(AF({west:w,north:e,east:C,south:i},n))}return[...new Set(A)]}return jne([[e,r],[i,r],[i,t],[e,t],[e,r]],n)}function rue(t){const e=dD(t),r=e.map(A=>A[0]),i=e.map(A=>A[1]),n=Math.min(...i),o=Math.min(...r),s=Math.max(...i),f=Math.max(...r);return{west:n,south:o,east:s,north:f}}const iue=2;function t2(t,e){const r=Math.log2(e/512),i=2/3*(t.zoom-r),n=Math.log(1/Math.cos(Math.PI*t.latitude/180));return Math.max(0,Math.floor(i+n-iue))}class nue extends q_{getTileIndices({viewport:e,minZoom:r,maxZoom:i}){if(e.latitude===void 0)return[];const[n,o,s,f]=e.getBounds(),{tileSize:A}=this.opts;let v=t2(e,A),w;if(typeof r=="number"&&Number.isFinite(r)&&v<r)return[];if(typeof i=="number"&&Number.isFinite(i)&&v>i){v=i;const C=Ux(e.latitude,e.longitude,i);w=Vne(C,1)}else{const C=tue({west:n,north:f,east:s,south:o},v);w=AF(C,v)}return w.map(C=>({i:C}))}getTileId({i:e}){return e}getTileMetadata({i:e}){return{bbox:rue(e)}}getTileZoom({i:e}){return Gb(e)}getParentIndex(e){const r=Gb(e.i);return{i:zne(e.i,r-1)}}}const sue={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class pw{static read(e,r){return e.readFields(pw._readField,{name:"",type:"",data:null},r)}static _readField(e,r,i){if(e===1)r.name=i.readString();else if(e===2)r.type=i.readString();else if(e===3){const n=sue[r.type];if(!n)throw Error(`Invalid data type: ${r.type}`);r.data={},iy(n,i,r.data)}}}let oue=class pF{static read(e,r){return e.readFields(pF._readField,{blockSize:0,bands:[]},r)}static _readField(e,r,i){e===1?r.blockSize=i.readVarint():e===2&&r.bands.push(pw.read(i,i.readVarint()+i.pos))}};const gF="9.0.33",mF="cartoRasterTile",aue={cartoRasterTile:{workerUrl:fw(mF,gF)}},lue={name:"CARTO Raster Tile",version:gF,id:mF,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(t,e)=>LI(t),parseSync:LI,worker:!0,options:aue};function LI(t,e){if(!t)return null;const{bands:r,blockSize:i}=ny(t,oue),n={};for(let o=0;o<r.length;o++){const{name:s,data:f}=r[o];n[s]=f}return{blockSize:i,cells:{numericProps:n,properties:[]}}}s0([lue,fF]);function cue(t){return t!=null&&t!==""}const uue={tileSize:pA};class sy extends Nc{_updateAutoHighlight(e){const{hoveredFeatureId:r}=this.state,i=e.object;let n=null;if(i&&(n=i.id),r!==n){let{highlightColor:o}=this.props;typeof o=="function"&&(o=o(e)),this.setState({highlightColor:o,hoveredFeatureId:n})}}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:r}=this.state,i=e.content;return!cue(r)||!Array.isArray(i)||!this._featureInTile(e,r)?-1:i.findIndex(o=>o.id===r)}_featureInTile(e,r){const i=this.state.tileset,n=i.getTileZoom(e.index),o=e.index.q?"q":"i";let s={[o]:r},f=i.getTileZoom(s);for(;!(f<=n);)s=i.getParentIndex(s),f=i.getTileZoom(s);return s[o]===e.index[o]}}sy.layerName="SpatialIndexTileLayer";sy.defaultProps=uue;const hue=t=>{const{data:e}=t,{index:r}=t.tile;return!e||!e.length?null:new $l(t,{getHexagon:i=>i.id,centerHexagon:r,highPrecision:!0})},fue={data:jh,tileSize:pA};class gw extends rs{initializeState(){$l._checkH3Lib()}getLoadOptions(){const e=super.getLoadOptions()||{},r=this.props.data;return y0(e,r.accessToken),e.cartoSpatialTile={...e.cartoSpatialTile,scheme:"h3"},e}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r}=e;let{minresolution:i,maxresolution:n}=e;return this.props.minZoom&&(i=Math.max(i,t2({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(n=Math.min(n,t2({zoom:this.props.maxZoom,latitude:0},this.props.tileSize))),[new sy(this.props,{id:`h3-tile-layer-${this.props.id}`,data:r,TilesetClass:nue,renderSubLayers:hue,minZoom:i,maxZoom:n,loadOptions:this.getLoadOptions()})]}}gw.layerName="H3TileLayer";gw.defaultProps=fue;const due=`uniform heatmapUniforms {
vec2 delta;
float radiusPixels;
vec2 colorDomain;
vec3 color1;
vec3 color2;
vec3 color3;
vec3 color4;
vec3 color5;
vec3 color6;
float intensity;
float opacity;
} heatmap;
const vec4 STOPS = vec4(0.2, 0.4, 0.6, 0.8);
vec3 colorGradient(float value) {
vec3 c1;
vec3 c2;
vec2 range;
if (value < STOPS.x) {
range = vec2(0.0, STOPS.x);
c1 = heatmap.color1; c2 = heatmap.color2;
} else if (value < STOPS.y) {
range = STOPS.xy;
c1 = heatmap.color2; c2 = heatmap.color3;
} else if (value < STOPS.z) {
range = STOPS.yz;
c1 = heatmap.color3; c2 = heatmap.color4;
} else if (value < STOPS.w) {
range = STOPS.zw;
c1 = heatmap.color4; c2 = heatmap.color5;
} else {
range = vec2(STOPS.w, 1.0);
c1 = heatmap.color5; c2 = heatmap.color6;
}
float f = (clamp(value, 0.0, 1.0) - range.x) / (range.y - range.x);
return mix(c1, c2, f) / 255.0;
}
const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
return 255.0 * dot(color, SHIFT);
}
vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
bool firstPass = (heatmap.delta.y < 0.5);
float accumulator = 0.0;
float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);
float sigma = SUPPORT / 3.0;
float a = -0.5 / (sigma * sigma);
float w0 = 0.3989422804014327 / sigma;
for (float t = -SUPPORT; t <= SUPPORT; t++) {
vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
vec2 delta = percent * heatmap.radiusPixels / texSize;
vec4 offsetColor = texture(source, texCoord + delta);
float value = unpack(offsetColor.rgb);
float weight = w0 * exp(a * t * t);
accumulator += value * weight;
}
if (firstPass) {
return pack(accumulator);
}
float density = 10.0 * heatmap.intensity * accumulator / SCALE;
vec2 domain = heatmap.colorDomain;
float f = (density - domain[0]) / (domain[1] - domain[0]);
vec4 color = vec4(0.0);
color.rgb = colorGradient(f);
color.a = smoothstep(0.0, 0.1, f);
color.a = pow(color.a, 1.0 / 2.2);
color.a *= heatmap.opacity;
return color;
}
`,Aue=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],pue={name:"heatmap",uniformPropTypes:{delta:{value:[0,1]},radiusPixels:{value:20,min:0,softMax:100},colorDomain:{value:[0,1]},color1:{value:[0,0,0]},color2:{value:[0,0,0]},color3:{value:[0,0,0]},color4:{value:[0,0,0]},color5:{value:[0,0,0]},color6:{value:[0,0,0]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1}},uniformTypes:{delta:"vec2<f32>",radiusPixels:"f32",colorDomain:"vec2<f32>",color1:"vec3<f32>",color2:"vec3<f32>",color3:"vec3<f32>",color4:"vec3<f32>",color5:"vec3<f32>",color6:"vec3<f32>",intensity:"f32",opacity:"f32"},getUniforms:t=>{const{delta:e=[1,0],colorRange:r=Aue,radiusPixels:i=20,colorDomain:n=[0,1],intensity:o=1,opacity:s=1}=t,[f,A,v,w,C,I]=r;return{delta:e,color1:f,color2:A,color3:v,color4:w,color5:C,color6:I,radiusPixels:i,colorDomain:n,intensity:o,opacity:s}},fs:due,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},gue={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function r2(t){for(;t.parent&&!t.applyPostProcess;)t=t.parent;return t}class _F extends Wn{initializeState(){this.id=`draw-callback-${r2(this).props.id}`}_drawLayer(){r2(this).applyPostProcess()}}_F.layerName="DrawCallbackLayer";function mue(t){var e;return e=class extends t{draw(i){const{moduleParameters:n}=i,{picking:o}=n,s=r2(this);o.isActive||s.enableRTT(i),super.draw(i),o.isActive||s.disableRTT()}},e.layerName=`RTT-${t.layerName}`,e}function _ue(t,e){var r;return r=class extends t{initializeState(n){super.initializeState(n),this._createTextures(),this.internalState.postProcess=new TV(e,this.props),this.internalState.postProcess.setup(n)}updateState(n){super.updateState(n),this.internalState.postProcess.setProps(this.props)}renderLayers(){let n=super.renderLayers();return n?(n=Array.isArray(n)?n:[n],[...n,new _F]):null}_createTextures(){const{device:n}=this.context;this.internalState.renderBuffers=[0,1].map(o=>n.createFramebuffer({id:`layer-fbo-${o}`,colorAttachments:[n.createTexture(gue)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(n){const{moduleParameters:o}=n,{viewport:s}=this.context,f=o.devicePixelRatio*s.width,A=o.devicePixelRatio*s.height;this.internalState.renderBuffers.forEach(v=>v.resize({width:f,height:A}))}enableRTT(n){this._resizeBuffers(n),this.internalState.originalRenderPass=this.context.renderPass;const[o]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,o.width,o.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[n,o]=this.internalState.renderBuffers,{framebuffer:s}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:n,swapBuffer:o,target:s}),this.internalState.renderInProgress=!1}},r.layerName=`PostProcess${t.layerName}`,r}const yue={getQuadbin:{type:"accessor",value:t=>t.quadbin}};class mw extends Hu{indexToBounds(){const{data:e,extruded:r,getQuadbin:i}=this.props,n=r?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>aF(i(o,s),n),updateTriggers:{getPolygon:n}}}}mw.layerName="QuadbinLayer";mw.defaultProps=yue;const vue=t=>{const{data:e}=t;if(!e||!e.length)return null;const r=typeof e[0].id=="bigint";return new mw(t,{getQuadbin:r?i=>i.id:i=>jce(i.id)})},bue={data:jh,tileSize:pA};class oy extends rs{getLoadOptions(){const e=super.getLoadOptions()||{},r=this.props.data;return y0(e,r.accessToken),e.cartoSpatialTile={...e.cartoSpatialTile,scheme:"quadbin"},e}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r,maxresolution:i}=e;return[new sy(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:r,TilesetClass:nw,renderSubLayers:vue,maxZoom:i,loadOptions:this.getLoadOptions()})]}}oy.layerName="QuadbinTileLayer";oy.defaultProps=bue;function yF(t){const e=Number(iw(t));return Math.pow(4,e)}class vF extends mue(zu){getShaders(e){const r=super.getShaders(e);return r.inject={"vs:#decl":`
uniform float densityFactor;
`,"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density 
  weight *= densityFactor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},r}draw(e){const r=this.props.data[0],i=this.props.elevationScale,n=yF(r.id)/i;for(const o of this.state.models)o.setUniforms({densityFactor:n});super.draw(e)}}vF.layerName="RTTSolidPolygonLayer";const xue=_ue(oy,pue),wue={data:jh,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class _w extends rs{initializeState(){this.state={isLoaded:!1,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:e}){const{viewportChanged:r}=e;return this.setState({viewportChanged:r}),e.somethingChanged}renderLayers(){var se,ge,Pe;const{data:e,getWeight:r,colorDomain:i,colorRange:n,intensity:o,radiusPixels:s,_subLayerProps:f,updateTriggers:A,onMaxDensityChange:v,onViewportLoad:w,onTileLoad:C,onTileUnload:I,...B}=this.props,F={...f,cell:{...f==null?void 0:f.cell,_subLayerProps:{...(se=f==null?void 0:f.cell)==null?void 0:se._subLayerProps,fill:{...(Pe=(ge=f==null?void 0:f.cell)==null?void 0:ge._subLayerProps)==null?void 0:Pe.fill,type:vF}}}};let N=0,V=0;const G=[...this.state.tiles].filter(Ue=>Ue.isVisible&&Ue.content);for(const Ue of G){const Fe=Ue.content[0],pe=yF(Fe.id);V=Math.max(Ue.userData.maxWeight*pe,V),N=Math.max(Ue.zoom,N)}const Y=this.context.viewport.zoom-N;return V=V*Math.pow(2,Y),typeof v=="function"&&v(V),new xue(B,this.getSubLayerProps({id:"heatmap",data:e,getFillColor:0,getElevation:r,elevationScale:V,colorDomain:i,colorRange:n,radiusPixels:s,intensity:o,_subLayerProps:F,refinementStrategy:"no-overlap",extruded:!1,stroked:!1,updateTriggers:{getElevation:A.getWeight},onViewportLoad:Ue=>{this.setState({isLoaded:!0}),typeof w=="function"&&w(Ue)},onTileLoad:Ue=>{let Fe=-1/0;if(typeof r!="function")Fe=r;else if(Ue.content)for(const pe of Ue.content)Fe=Math.max(r(pe,{}),Fe);Ue.userData={maxWeight:Fe},this.state.tiles.add(Ue),typeof C=="function"&&C(Ue)},onTileUnload:Ue=>{this.state.tiles.delete(Ue),typeof I=="function"&&I(Ue)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}}_w.layerName="HeatmapTileLayer";_w.defaultProps=wue;const[kI,NI,UI,zI]=[0,1,2,3];class bF extends d0{getShaders(){const e=super.getShaders();let r=e.vs;return r=r.replaceAll("padding.","_padding."),r=r.replace("void main(void) {",`void main(void) {
  vec4 _padding = padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...e,vs:r}}}bF.layerName="EnhancedTextBackgroundLayer";class xF extends Zh{filterSubLayer({layer:e,renderPass:r}){const i=e.id.includes("primary-background");return r==="collision"?i:!i}}xF.layerName="EnhancedTextLayer";const Tue={...Zh.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}};class yw extends rs{calculatePixelOffset(e){const{getTextAnchor:r,getAlignmentBaseline:i,getRadius:n,getSecondaryText:o,radiusScale:s,secondarySizeScale:f,sizeScale:A}=this.props,v=r==="middle"?0:r==="start"?1:-1,w=i==="center"?0:i==="bottom"?1:-1,C=A/4,I=A*(1+1/4),B=.6*(1-w)*A;let F=e?B:0;r==="middle"&&i==="top"&&o&&(F-=B,F-=f,F+=A);const N=1+1/4;return typeof n=="function"?(V,G)=>{const Y=(G?n(V,G):1)*s*N;return[v*(Y+C),w*(Y+I)+F]}:[v*(n*s*N+C),w*(n*s*N+I)+F]}calculateBackgroundPadding(){const{getTextAnchor:e,getAlignmentBaseline:r,sizeScale:i}=this.props,n=12*i,o=3*i,s=[0,0,0,0];return r==="top"?s[NI]=o:r==="bottom"?s[zI]=o:(s[NI]=.5*o,s[zI]=.5*o),e==="start"?s[kI]=n:e==="end"?s[UI]=n:(s[kI]=.5*n,s[UI]=.5*n),s}renderTextLayer(e,{updateTriggers:r={},...i}){const{data:n,characterSet:o,fontFamily:s,fontSettings:f,fontWeight:A,outlineColor:v,outlineWidth:w,sizeScale:C,radiusScale:I,getAlignmentBaseline:B,getColor:F,getPosition:N,getTextAnchor:V,updateTriggers:G}=this.props;return new xF(this.getSubLayerProps({id:e,data:n,characterSet:o,fontFamily:s,fontSettings:f,fontWeight:A,outlineColor:v,outlineWidth:w,sizeScale:C,getAlignmentBaseline:B,getColor:F,getPosition:N,getTextAnchor:V,updateTriggers:{...G,...r,getPixelOffset:[G.getRadius,G.getTextAnchor,G.getAlignmentBaseline,I,C]}}),{getSize:1,_subLayerProps:{background:{type:bF}}},i)}renderLayers(){const{getText:e,getSecondaryColor:r,getSecondaryText:i,secondaryOutlineColor:n,secondarySizeScale:o,updateTriggers:s}=this.props,f=this.calculatePixelOffset(!1),A=this.calculateBackgroundPadding();return[this.renderTextLayer(`${s.getText}-primary`,{backgroundPadding:A,getText:e,getPixelOffset:f,background:!0}),!!i&&this.renderTextLayer(`${s.getSecondaryText}-secondary`,{getText:i,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...r&&{getColor:r},...o&&{sizeScale:o},...n&&{outlineColor:n}})]}}yw.layerName="PointLabelLayer";yw.defaultProps=Tue;const Eue=`#version 300 es
#define SHADER_NAME raster-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float widthScale;
uniform vec3 offset;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
vec2 common_position = offset.xy;
float scale = offset.z;
int yIndex = - (gl_InstanceID / BLOCK_WIDTH);
int xIndex = gl_InstanceID + (yIndex * BLOCK_WIDTH);
common_position += scale * vec2(float(xIndex), float(yIndex));
vec4 color = isStroke ? instanceLineColors : instanceFillColors;
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float cellWidth = coverage * scale;
geometry.position = vec4(common_position, 0.0, 1.0);
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
geometry.position.xyz -= project_uCommonOrigin;
}
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
} else if (stroked) {
float halfOffset = project_pixel_size(widthScale) / cellWidth;
if (isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
geometry.pickingColor = instancePickingColors;
vec2 offset = (vec2(0.5) + positions.xy * strokeOffsetRatio) * cellWidth * shouldRender;
vec3 pos = vec3(offset, project_size(elevation));
DECKGL_FILTER_SIZE(pos, geometry);
geometry.position.xyz += pos;
gl_Position = project_common_position_to_clipspace(geometry.position);
geometry.normal = project_normal(normals);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded && !isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Sue={...Lc.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class wF extends Lc{getShaders(){const e=super.getShaders(),r=this.props.data,i=r.data.blockSize??Math.sqrt(r.length);return{...e,defines:{...e.defines,BLOCK_WIDTH:i},vs:Eue}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}wF.layerName="RasterColumnLayer";class vw extends rs{renderLayers(){const{data:e,getElevation:r,getFillColor:i,getLineColor:n,getLineWidth:o,tileIndex:s,updateTriggers:f}=this.props;if(!e||!s)return null;const A=e.blockSize??0,[v,w,C]=oF(s),I=[v,w,C/A],B=this.getSubLayerClass("column",wF),{highlightedObjectIndex:F,highlightColor:N}=this.state;return new B(this.props,this.getSubLayerProps({id:"cell",updateTriggers:f,getElevation:this.getSubLayerAccessor(r),getFillColor:this.getSubLayerAccessor(i),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(o)}),{data:{data:e,length:A*A},offset:I,highlightedObjectIndex:F,highlightColor:N})}getSubLayerAccessor(e){return typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:n,index:o}=i,s=n.data,f=Yce(s.cells,o);return e({properties:f},i)}}getPickingInfo(e){const r=super.getPickingInfo(e);return r.index!==-1&&(r.object=this.getSubLayerAccessor(i=>i)(void 0,{data:this.props,index:r.index})),r}_updateAutoHighlight(e){const{highlightedObjectIndex:r}=this.state;let i=-1;if(e.index!==-1&&(i=e.index),r!==i){let{highlightColor:n}=this.props;typeof n=="function"&&(n=n(e)),this.setState({highlightColor:n,highlightedObjectIndex:i})}}}vw.layerName="RasterLayer";vw.defaultProps=Sue;const Cue=t=>{var r,i;const e=(i=(r=t.tile)==null?void 0:r.index)==null?void 0:i.q;return e?new vw(t,{tileIndex:e}):null},Pue={data:jh,tileSize:pA};class bw extends rs{getLoadOptions(){const e=super.getLoadOptions()||{},r=this.props.data;return y0(e,r.accessToken),e}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r,minzoom:i,maxzoom:n}=e;return[new Nc(this.props,{id:`raster-tile-layer-${this.props.id}`,data:r,TilesetClass:nw,renderSubLayers:Cue,minZoom:i,maxZoom:n,loadOptions:this.getLoadOptions()})]}}bw.layerName="RasterTileLayer";bw.defaultProps=Pue;class xw{static read(e,r){return e.readFields(xw._readField,{properties:[],numericProps:{}},r)}static _readField(e,r,i){if(e===1)r.properties.push(Yh.read(i,i.readVarint()+i.pos));else if(e===2){const n=Jh.read(i,i.readVarint()+i.pos);r.numericProps[n.key]=n.value}}}const Iue={name:"CARTO Properties Tile",version:"1",id:"cartoPropertiesTile",module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!1,parse:async(t,e)=>VI(t),parseSync:VI,options:{}};function VI(t,e){return t?ny(t,xw):null}const TF="9.0.33",EF="cartoVectorTile",Mue={cartoVectorTile:{workerUrl:fw(EF,TF)}},Rue={name:"CARTO Vector Tile",version:TF,id:EF,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(t,e)=>jI(t),parseSync:jI,worker:!0,options:Mue};function Bue(t,e,{startPosition:r,endPosition:i,indices:n}){const o=t.positions.size,s=r*o,f=i*o,A=t.positions.value.subarray(s,f),v=n.slice(1).map(C=>C-r),w=IO(A,v,o);for(let C=0,I=w.length;C<I;++C)e.push(r+w[C])}function Oue(t){const{polygonIndices:e,primitivePolygonIndices:r}=t,i=[];let n=0;for(let o=0;o<e.value.length-1;o++){const s=e.value[o],f=e.value[o+1],A=r.value.indexOf(f),v=r.value.subarray(n,A);n=A,Bue(t,i,{startPosition:s,endPosition:f,indices:v})}t.triangles={value:new Uint32Array(i),size:1}}function jI(t,e){if(!t)return null;const r=ny(t,Zce);return r.polygons&&!r.polygons.triangles&&Oue(r.polygons),r}s0([Iue,Rue]);const Due={...AA.defaultProps,data:jh,dataComparator:jh.equal,tileSize:pA};class ww extends AA{constructor(...e){super(...e)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(e){const{props:r}=e;if(r.data){super.updateState(e);const n=new URL(r.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:n})}}getLoadOptions(){const e=super.getLoadOptions()||{},r=this.props.data;return y0(e,r.accessToken),e.gis={format:"binary"},e}async getTileData(e){const r=this.props.data,{tiles:i,properties_tiles:n}=r,o=Uh(i,e);if(!o)return Promise.reject("Invalid URL");const s=this.getLoadOptions(),{fetch:f}=this.props,{signal:A}=e,v=f(o,{propName:"data",layer:this,loadOptions:s,signal:A});if(!n)return await v;const w=Uh(n,e);if(!w)return Promise.reject("Invalid properties URL");const C=f(w,{propName:"data",layer:this,loadOptions:s,signal:A}),[I,B]=await Promise.all([v,C]);return I?B?eue(I,B):I:null}renderSubLayers(e){if(e.data===null)return null;if(this.state.mvt)return super.renderSubLayers(e);const r=e.tile.bbox,{west:i,south:n,east:o,north:s}=r,f=[new ty,...e.extensions||[]],A={clipBounds:[i,n,o,s]},v=I=>{var B,F,N;return{[I]:{...A,...(B=e==null?void 0:e._subLayerProps)==null?void 0:B[I],extensions:[...f,...((N=(F=e==null?void 0:e._subLayerProps)==null?void 0:F[I])==null?void 0:N.extensions)||[]]}}},w={...e,autoHighlight:!1,_subLayerProps:{...e._subLayerProps,...v("polygons-fill"),...v("polygons-stroke"),...v("linestrings")}};return new kc(w)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}ww.layerName="VectorTileLayer";ww.defaultProps=Due;var ii={schemeGroups:{sequential:["BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","YlGnBu","YlOrBr","YlOrRd"],singlehue:["Blues","Greens","Greys","Oranges","Purples","Reds"],diverging:["BrBG","PiYG","PRGn","PuOr","RdBu","RdGy","RdYlBu","RdYlGn","Spectral"],qualitative:["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"]},YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},Fue={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},Lue={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},kue={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},Nue={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},Uue={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},zue={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},Vue={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},jue={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},Hue={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},Gue={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},Wue={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},Xue={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},que={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},$ue={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},Zue={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},Kue={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},Yue={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},Jue={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},Que={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},ehe={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},the={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},rhe={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},ihe={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},nhe={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},she={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},ohe={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},ahe={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},lhe={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},che={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},uhe={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},hhe={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},fhe={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},dhe={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},Ahe={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},phe={...ii.BuGn,tags:["quantitative"]},ghe={...ii.BuPu,tags:["quantitative"]},mhe={...ii.GnBu,tags:["quantitative"]},_he={...ii.OrRd,tags:["quantitative"]},yhe={...ii.PuBu,tags:["quantitative"]},vhe={...ii.PuBuGn,tags:["quantitative"]},bhe={...ii.PuRd,tags:["quantitative"]},xhe={...ii.RdPu,tags:["quantitative"]},whe={...ii.YlGn,tags:["quantitative"]},The={...ii.YlGnBu,tags:["quantitative"]},Ehe={...ii.YlOrBr,tags:["quantitative"]},She={...ii.YlOrRd,tags:["quantitative"]},Che={...ii.Accent,tags:["qualitative"]},Phe={...ii.Dark2,tags:["qualitative"]},Ihe={...ii.Paired,tags:["qualitative"]},Mhe={...ii.Pastel1,tags:["qualitative"]},Rhe={...ii.Pastel2,tags:["qualitative"]},Bhe={...ii.Set1,tags:["qualitative"]},Ohe={...ii.Set2,tags:["qualitative"]},Dhe={...ii.Set3,tags:["qualitative"]},Fhe={...ii.Blues,tags:["quantitative"]},Lhe={...ii.Greens,tags:["quantitative"]},khe={...ii.Greys,tags:["quantitative"]},Nhe={...ii.Oranges,tags:["quantitative"]},Uhe={...ii.Purples,tags:["quantitative"]},zhe={...ii.Reds,tags:["quantitative"]},Vhe={...ii.BrBG,tags:["diverging"]},jhe={...ii.PiYG,tags:["diverging"]},Hhe={...ii.PRGn,tags:["diverging"]},Ghe={...ii.PuOr,tags:["diverging"]},Whe={...ii.RdBu,tags:["diverging"]},Xhe={...ii.RdGy,tags:["diverging"]},qhe={...ii.RdYlBu,tags:["diverging"]},$he={...ii.RdYlGn,tags:["diverging"]},Zhe={...ii.Spectral,tags:["diverging"]};const Khe=Object.freeze(Object.defineProperty({__proto__:null,Antique:che,ArmyRose:rhe,BluGrn:jue,BluYl:Xue,Bold:uhe,BrwnYl:the,Burg:Fue,BurgYl:Lue,DarkMint:Hue,Earth:lhe,Emrld:Gue,Fall:ihe,Geyser:nhe,Magenta:Jue,Mint:Vue,OrYel:Nue,Pastel:hhe,Peach:Uue,PinkYl:zue,Prism:fhe,Purp:Zue,PurpOr:Kue,RedOr:kue,Safe:dhe,Sunset:Yue,SunsetDark:Que,Teal:que,TealGrn:$ue,TealRose:ohe,Temps:she,Tropic:ahe,Vivid:Ahe,ag_GrnYl:Wue,ag_Sunset:ehe,cb_Accent:Che,cb_Blues:Fhe,cb_BrBG:Vhe,cb_BuGn:phe,cb_BuPu:ghe,cb_Dark2:Phe,cb_GnBu:mhe,cb_Greens:Lhe,cb_Greys:khe,cb_OrRd:_he,cb_Oranges:Nhe,cb_PRGn:Hhe,cb_Paired:Ihe,cb_Pastel1:Mhe,cb_Pastel2:Rhe,cb_PiYG:jhe,cb_PuBu:yhe,cb_PuBuGn:vhe,cb_PuOr:Ghe,cb_PuRd:bhe,cb_Purples:Uhe,cb_RdBu:Whe,cb_RdGy:Xhe,cb_RdPu:xhe,cb_RdYlBu:qhe,cb_RdYlGn:$he,cb_Reds:zhe,cb_Set1:Bhe,cb_Set2:Ohe,cb_Set3:Dhe,cb_Spectral:Zhe,cb_YlGn:whe,cb_YlGnBu:The,cb_YlOrBr:Ehe,cb_YlOrRd:She},Symbol.toStringTag,{value:"Module"})),Tw="PurpOr",Ew=[204,204,204],Yhe=[119,119,119];function Sw(t,e){const r=Khe[t];let i=e;Vh(r,`Palette "${t}" not found. Expected a CARTOColors string`);const n=Object.keys(r).filter(A=>A!=="tags").map(Number),o=Math.max(...n),s=Math.min(...n);!Number.isInteger(e)||e>o?i=o:e<s&&(i=s);let f=r[i];return r.tags&&r.tags.includes("qualitative")&&(f=f.slice(0,-1)),f.map(A=>Jhe(A))}function Jhe(t){let e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t);return e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),255]:(e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t),e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),parseInt(e[4]+e[4],16)]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),Vh(e,`Hexadecimal color "${t}" was not parsed correctly`),[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16)])))}const Qhe=Object.freeze(["function","string"]);function Cw(t,e,r){var i;return Vh(typeof e=="object",'Expected "data" to be an object'),Vh(Qhe.includes(typeof t),'Expected "attr" to be a function or string'),typeof t=="function"?t(e,r):(i=e==null?void 0:e.properties)==null?void 0:i[t]}function efe({attr:t,domain:e,colors:r=Tw,nullColor:i=Ew}){Vh(Array.isArray(e),'Expected "domain" to be an array of numbers');const n=typeof r=="string"?Sw(r,e.length+1):r,o=NL().domain(e).range(n);return(s,f)=>{const A=Cw(t,s,f);return typeof A=="number"&&Number.isFinite(A)?o(A):i}}function tfe({attr:t,domain:e,colors:r=Tw,nullColor:i=Ew,othersColor:n=Yhe}){Vh(Array.isArray(e),'Expected "domain" to be an array of numbers or strings');const o={},s=typeof r=="string"?Sw(r,e.length):r;for(const[f,A]of e.entries())o[A]=s[f];return(f,A)=>{const v=Cw(t,f,A);return typeof v=="number"&&Number.isFinite(v)||typeof v=="string"?o[v]||n:i}}function rfe({attr:t,domain:e,colors:r=Tw,nullColor:i=Ew}){Vh(Array.isArray(e),'Expected "domain" to be an array of numbers');const n=typeof r=="string"?Sw(r,e.length):r,o=UL().domain(e).range(n);return(s,f)=>{const A=Cw(t,s,f);return typeof A=="number"&&Number.isFinite(A)?o(A):i}}const Pn={SUM:1,MEAN:2,MIN:3,MAX:4};function SF(t,e){return t+e}function ife(t,e){return e>t?e:t}function nfe(t,e){return e<t?e:t}function sfe(t,e){if(Number.isFinite(e))return t.length?e:null;const r=t.map(e).filter(Number.isFinite);return r.length?r.reduce(SF,0)/r.length:null}function ofe(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const r=t.map(e).filter(Number.isFinite);return r.length?r.reduce(SF,0):null}function afe(t,e){if(Number.isFinite(e))return t.length?e:null;const r=t.map(e).filter(Number.isFinite);return r.length?r.reduce(ife,-1/0):null}function lfe(t,e){if(Number.isFinite(e))return t.length?e:null;const r=t.map(e).filter(Number.isFinite);return r.length?r.reduce(nfe,1/0):null}function Pw(t,e,r){const i=Pn[t]||Pn.SUM;switch(e=cfe(e,r),i){case Pn.MIN:return n=>lfe(n,e);case Pn.SUM:return n=>ofe(n,e);case Pn.MEAN:return n=>sfe(n,e);case Pn.MAX:return n=>afe(n,e);default:return null}}function cfe(t,e={}){return Number.isFinite(t)?t:r=>(e.index=r.index,t(r.source,e))}function ufe(t,e={}){return r=>(e.indices=r.map(i=>i.index),t(r.map(i=>i.source),e))}const hfe={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},bh=3402823466e29,CF=[32775,32774],PF=[32776,32774],ffe=[32776,32775],HI={[Pn.SUM]:32774,[Pn.MEAN]:32774,[Pn.MIN]:CF,[Pn.MAX]:PF},dfe={size:1,operation:Pn.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},Afe=4,pfe=`#version 300 es
#define SHADER_NAME gpu-aggregation-to-grid-vs
in vec3 positions;
in vec3 positions64Low;
in vec3 weights;
uniform vec2 cellSize;
uniform vec2 gridSize;
uniform bool projectPoints;
uniform vec2 translation;
uniform vec3 scaling;
out vec3 vWeights;
vec2 project_to_pixel(vec4 pos) {
vec4 result;
pos.xy = pos.xy/pos.w;
result = pos + vec4(translation, 0., 0.);
result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;
return result.xy;
}
void main(void) {
vWeights = weights;
vec4 windowPos = vec4(positions, 1.);
if (projectPoints) {
windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));
}
vec2 pos = project_to_pixel(windowPos);
vec2 pixelXY64[2];
pixelXY64[0] = vec2(pos.x, 0.);
pixelXY64[1] = vec2(pos.y, 0.);
vec2 gridXY64[2];
gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));
gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));
float x = floor(gridXY64[0].x);
float y = floor(gridXY64[1].x);
pos = vec2(x, y);
pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);
vec2 offset = 1.0 / gridSize;
pos = pos + offset;
gl_Position = vec4(pos, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,gfe=`#version 300 es
#define SHADER_NAME gpu-aggregation-to-grid-fs
precision highp float;
in vec3 vWeights;
out vec4 fragColor;
void main(void) {
fragColor = vec4(vWeights, 1.0);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,mfe=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-vs-64
in vec2 position;
uniform ivec2 gridSize;
out vec2 vTextureCoord;
void main(void) {
vec2 pos = vec2(-1.0, -1.0);
vec2 offset = 1.0 / vec2(gridSize);
pos = pos + offset;
gl_Position = vec4(pos, 0.0, 1.0);
int yIndex = gl_InstanceID / gridSize[0];
int xIndex = gl_InstanceID - (yIndex * gridSize[0]);
vec2 yIndexFP64 = vec2(float(yIndex), 0.);
vec2 xIndexFP64 = vec2(float(xIndex), 0.);
vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);
vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);
vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);
vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);
vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);
gl_PointSize = 1.0;
}
`,_fe=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-fs
precision highp float;
in vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform bool combineMaxMin;
out vec4 fragColor;
void main(void) {
vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
if (textureColor.a == 0.) {
discard;
}
fragColor.rgb = textureColor.rgb;
fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;
}
`,yfe=`#version 300 es
#define SHADER_NAME gpu-aggregation-transform-mean-vs
in vec4 aggregationValues;
out vec4 meanValues;
void main()
{
bool isCellValid = bool(aggregationValues.w > 0.);
meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);
meanValues.w = aggregationValues.w;
gl_PointSize = 1.0;
}
`,vfe={minFilter:"nearest",magFilter:"nearest"};function gm(t,e){const{width:r=1,height:i=1,data:n=null,parameters:o=vfe}=e;return t.createTexture({data:n,format:"rgba32float",mipmaps:!1,sampler:o,width:r,height:i})}function Zg(t,e){const{id:r,width:i=1,height:n=1,texture:o}=e;return t.createFramebuffer({id:r,width:i,height:n,colorAttachments:[o]})}const bfe=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],GI={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},xfe=["float32-renderable-webgl","texture-blend-float-webgl"];class Hl{static getAggregationData({aggregationData:e,maxData:r,minData:i,maxMinData:n,pixelIndex:o}){const s=o*Afe,f={};return e&&(f.cellCount=e[s+3],f.cellWeight=e[s]),n?(f.maxCellWieght=n[0],f.minCellWeight=n[3]):(r&&(f.maxCellWieght=r[0],f.totalCount=r[3]),i&&(f.minCellWeight=i[0],f.totalCount=i[3])),f}static getCellData({countsData:e,size:r=1}){const i=e.length/4,n=new Float32Array(i*r),o=new Uint32Array(i);for(let s=0;s<i;s++){for(let f=0;f<r;f++)n[s*r+f]=e[s*4+f];o[s]=e[s*4+3]}return{cellCounts:o,cellWeights:n}}static isSupported(e){return xfe.every(r=>e.features.has(r))}constructor(e,r={}){this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},shaderOptions:{},modelDirty:!1,resources:{},results:{}},this.id=r.id||"gpu-grid-aggregator",this.device=e;const i=["float32-renderable-webgl"];this._hasGPUSupport=i.every(n=>e.features.has(n)),this._hasGPUSupport&&this._setupModels()}delete(){const{gridAggregationModel:e,allAggregationModel:r,meanTransform:i}=this,{textures:n,framebuffers:o,maxMinFramebuffers:s,minFramebuffers:f,maxFramebuffers:A,meanTextures:v,resources:w}=this.state;e==null||e.destroy(),r==null||r.destroy(),i==null||i.destroy(),Tfe([o,n,s,f,A,v,w])}run(e={}){this.setState({results:{}});const r=this._normalizeAggregationParams(e);return this._runAggregation(r)}getData(e){const r={},i=this.state.results;i[e].aggregationData||(i[e].aggregationData=i[e].aggregationBuffer.getData()),r.aggregationData=i[e].aggregationData;for(const n in GI){const o=GI[n];(i[e][n]||i[e][o])&&(i[e][n]=i[e][n]||i[e][o].getData(),r[n]=i[e][n])}return r}updateShaders(e={}){this.setState({shaderOptions:e,modelDirty:!0})}_normalizeAggregationParams(e){const r={...hfe,...e},{weights:i}=r;return i&&(r.weights=wfe(i)),r}setState(e){Object.assign(this.state,e)}_getAggregateData(e){const r={},{textures:i,framebuffers:n,maxMinFramebuffers:o,minFramebuffers:s,maxFramebuffers:f,resources:A}=this.state,{weights:v}=e;for(const w in v){r[w]={};const{needMin:C,needMax:I,combineMaxMin:B}=v[w];r[w].aggregationTexture=i[w],r[w].aggregationBuffer=this.device.readPixelsToBufferWebGL(n[w],{target:v[w].aggregationBuffer,sourceType:5126}),C&&I&&B?(r[w].maxMinBuffer=this.device.readPixelsToBufferWebGL(o[w],{target:v[w].maxMinBuffer,sourceType:5126}),r[w].maxMinTexture=A[`${w}-maxMinTexture`]):(C&&(r[w].minBuffer=this.device.readPixelsToBufferWebGL(s[w],{target:v[w].minBuffer,sourceType:5126}),r[w].minTexture=A[`${w}-minTexture`]),I&&(r[w].maxBuffer=this.device.readPixelsToBufferWebGL(f[w],{target:v[w].maxBuffer,sourceType:5126}),r[w].maxTexture=A[`${w}-maxTexture`]))}return this._trackGPUResultBuffers(r,v),r}_renderAggregateData(e){const{cellSize:r,projectPoints:i,attributes:n,moduleSettings:o,numCol:s,numRow:f,weights:A,translation:v,scaling:w}=e,{maxMinFramebuffers:C,minFramebuffers:I,maxFramebuffers:B}=this.state,F=[s,f],N={blend:!0,depthTest:!1,blendFunc:[1,1]},V={cellSize:r,gridSize:F,projectPoints:i,translation:v,scaling:w};for(const G in A){const{needMin:Y,needMax:Z}=A[G],se=Y&&Z&&A[G].combineMaxMin;this._renderToWeightsTexture({id:G,parameters:N,moduleSettings:o,uniforms:V,gridSize:F,attributes:n,weights:A}),se?this._renderToMaxMinTexture({id:G,parameters:{...N,blendEquation:ffe},gridSize:F,minOrMaxFb:C[G],clearParams:{clearColor:[0,0,0,bh]},combineMaxMin:se}):(Y&&this._renderToMaxMinTexture({id:G,parameters:{...N,blendEquation:CF},gridSize:F,minOrMaxFb:I[G],clearParams:{clearColor:[bh,bh,bh,0]},combineMaxMin:se}),Z&&this._renderToMaxMinTexture({id:G,parameters:{...N,blendEquation:PF},gridSize:F,minOrMaxFb:B[G],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:se}))}}_renderToMaxMinTexture(e){const{id:r,gridSize:i,minOrMaxFb:n,combineMaxMin:o,clearParams:s={}}=e,{framebuffers:f}=this.state,{allAggregationModel:A}=this;this.device.withParametersWebGL({...s,framebuffer:n,viewport:[0,0,i[0],i[1]]},()=>{this.device.clearWebGL({color:!0}),A.setUniforms({gridSize:i,combineMaxMin:o}),A.setBindings({uSampler:f[r].texture}),A.draw()})}_renderToWeightsTexture(e){const{id:r,parameters:i,moduleSettings:n,uniforms:o,gridSize:s,weights:f}=e,{framebuffers:A,equations:v,weightAttributes:w}=this.state,{gridAggregationModel:C}=this,{operation:I}=f[r],B=I===Pn.MIN?[bh,bh,bh,0]:[0,0,0,0];if(this.device.withParametersWebGL({framebuffer:A[r],viewport:[0,0,s[0],s[1]],clearColor:B},()=>{this.device.clearWebGL({color:!0});const F={weights:w[r]};C.draw({parameters:{...i,blendEquation:v[r]},moduleSettings:n,uniforms:o,attributes:F})}),I===Pn.MEAN){const{meanTextures:F,textures:N}=this.state,V={_sourceTextures:{aggregationValues:F[r]},_targetTexture:N[r],elementCount:N[r].width*N[r].height};this.meanTransform?this.meanTransform.update(V):this.meanTransform=Cfe(this.device,V),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),A[r].attach({36064:N[r]})}}_runAggregation(e){this._updateModels(e),this._setupFramebuffers(e),this._renderAggregateData(e);const r=this._getAggregateData(e);return this.setState({results:r}),r}_setupFramebuffers(e){const{textures:r,framebuffers:i,maxMinFramebuffers:n,minFramebuffers:o,maxFramebuffers:s,meanTextures:f,equations:A}=this.state,{weights:v}=e,{numCol:w,numRow:C}=e,I={width:w,height:C};for(const B in v){const{needMin:F,needMax:N,combineMaxMin:V,operation:G}=v[B];r[B]=v[B].aggregationTexture||r[B]||gm(this.device,{id:`${B}-texture`,width:w,height:C}),r[B].resize(I);let Y=r[B];G===Pn.MEAN&&(f[B]=f[B]||gm(this.device,{id:`${B}-mean-texture`,width:w,height:C}),f[B].resize(I),Y=f[B]),i[B]?i[B].attach({36064:Y}):i[B]=Zg(this.device,{id:`${B}-fb`,width:w,height:C,texture:Y}),i[B].resize(I),A[B]=HI[G]||HI[Pn.SUM],(F||N)&&(F&&N&&V?n[B]||(Y=v[B].maxMinTexture||this._getMinMaxTexture(`${B}-maxMinTexture`),n[B]=Zg(this.device,{id:`${B}-maxMinFb`,texture:Y})):(F&&(o[B]||(Y=v[B].minTexture||this._getMinMaxTexture(`${B}-minTexture`),o[B]=Zg(this.device,{id:`${B}-minFb`,texture:Y}))),N&&(s[B]||(Y=v[B].maxTexture||this._getMinMaxTexture(`${B}-maxTexture`),s[B]=Zg(this.device,{id:`${B}-maxFb`,texture:Y})))))}}_getMinMaxTexture(e){const{resources:r}=this.state;return r[e]||(r[e]=gm(this.device,{id:"resourceName"})),r[e]}_setupModels({numCol:e=0,numRow:r=0}={}){var n;const{shaderOptions:i}=this.state;if((n=this.gridAggregationModel)==null||n.destroy(),this.gridAggregationModel=Efe(this.device,i),!this.allAggregationModel){const o=e*r;this.allAggregationModel=Sfe(this.device,o)}}_setupWeightAttributes(e){const{weightAttributes:r}=this.state,{weights:i}=e;for(const n in i)r[n]=e.attributes[n]}_trackGPUResultBuffers(e,r){const{resources:i}=this.state;for(const n in e)if(e[n]){for(const o of bfe)if(e[n][o]&&r[n][o]!==e[n][o]){const s=`gpu-result-${n}-${o}`;i[s]&&i[s].delete(),i[s]=e[n][o]}}}_updateModels(e){const{vertexCount:r,attributes:i,numCol:n,numRow:o}=e,{modelDirty:s}=this.state;s&&(this._setupModels(e),this.setState({modelDirty:!1})),this._setupWeightAttributes(e),this.gridAggregationModel.setVertexCount(r),this.gridAggregationModel.setAttributes(i),this.allAggregationModel.setInstanceCount(n*o)}}function wfe(t){const e={};for(const r in t)e[r]={...dfe,...t[r]};return e}function Tfe(t){t=Array.isArray(t)?t:[t],t.forEach(e=>{for(const r in e)e[r].delete()})}function Efe(t,e){const r=ub({vs:pfe,fs:gfe,modules:[T_,uo]},e);return new zi(t,{id:"Grid-Aggregation-Model",vertexCount:1,drawMode:0,shaderAssembler:TB(),...r})}function Sfe(t,e){return new zi(t,{id:"All-Aggregation-Model",vs:mfe,fs:_fe,modules:[T_],vertexCount:1,topology:"point-list",isInstanced:!0,instanceCount:e,attributes:{position:[0,0]}})}function Cfe(t,e){return new Q1(t,{vs:yfe,_targetTextureVarying:"meanValues",...e})}const gA=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function ay(t,e=!1,r=Float32Array){let i;if(Number.isFinite(t[0]))i=new r(t);else{i=new r(t.length*4);let n=0;for(let o=0;o<t.length;o++){const s=t[o];i[n++]=s[0],i[n++]=s[1],i[n++]=s[2],i[n++]=Number.isFinite(s[3])?s[3]:255}}if(e)for(let n=0;n<i.length;n++)i[n]/=255;return i}const Pfe=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec3 positions;
in vec3 instancePositions;
in vec4 instanceCounts;
in vec3 instancePickingColors;
uniform float opacity;
uniform vec3 cellScale;
uniform vec4 minColor;
uniform vec4 maxColor;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 colorDomain;
uniform bool shouldUseMinMax;
uniform sampler2D maxTexture;
out vec4 vColor;
out float vSampleCount;
vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
vec4 outColor = vec4(0., 0., 0., 0.);
if (value >= domain.x && value <= domain.y) {
float domainRange = domain.y - domain.x;
if (domainRange <= 0.) {
outColor = colorRange[0];
} else {
float rangeCount = float(RANGE_COUNT);
float rangeStep = domainRange / rangeCount;
float idx = floor((value - domain.x) / rangeStep);
idx = clamp(idx, 0., rangeCount - 1.);
int intIdx = int(idx);
outColor = colorRange[intIdx];
}
}
outColor = outColor / 255.;
return outColor;
}
void main(void) {
vSampleCount = instanceCounts.a;
float weight = instanceCounts.r;
float maxWeight = texture(maxTexture, vec2(0.5)).r;
float step = weight / maxWeight;
vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;
vec2 domain = colorDomain;
float domainMaxValid = float(colorDomain.y != 0.);
domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);
vec4 rangeColor = quantizeScale(domain, colorRange, weight);
float rangeMinMax = float(shouldUseMinMax);
vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);
vColor = vec4(color.rgb, color.a * opacity);
picking_setPickingColor(instancePickingColors);
gl_Position = vec4(instancePositions + positions * cellScale, 1.);
}
`,Ife=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
in float vSampleCount;
out vec4 fragColor;
void main(void) {
if (vSampleCount <= 0.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Mfe=[0,0,0,0],Rfe=[0,255,0,255],Bfe=["minColor","maxColor","colorRange","colorDomain"],Ofe={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0,max:5},colorDomain:null,colorRange:gA};class ly extends Wn{getShaders(){return{vs:Pfe,fs:Ife,modules:[Mo]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel()})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e);const{oldProps:r,props:i,changeFlags:n}=e,o=this.getAttributeManager();i.numInstances!==r.numInstances?o.invalidateAll():r.cellSizePixels!==i.cellSizePixels&&o.invalidate("instancePositions"),this._updateUniforms(r,i,n)}draw({uniforms:e}){const{parameters:r,maxTexture:i}=this.props,n=this.props.minColor||Mfe,o=this.props.maxColor||Rfe,s=this.props.colorDomain||[1,0],f=this.state.model;f.setUniforms(e),f.setBindings({maxTexture:i}),f.setUniforms({minColor:n,maxColor:o,colorDomain:s}),f.setParameters({depthWriteEnabled:!1,...r}),f.draw(this.context.renderPass)}calculateInstancePositions(e,{numInstances:r}){const{width:i,height:n}=this.context.viewport,{cellSizePixels:o}=this.props,s=Math.ceil(i/o),{value:f,size:A}=e;for(let v=0;v<r;v++){const w=v%s,C=Math.floor(v/s);f[v*A+0]=w*o/i*2-1,f[v*A+1]=1-C*o/n*2,f[v*A+2]=0}}_getModel(){return new zi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _s({topology:"triangle-list",attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,1,0])}}),isInstanced:!0})}_shouldUseMinMax(){const{minColor:e,maxColor:r,colorDomain:i,colorRange:n}=this.props;return e||r?(fr.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!(i||n)}_updateUniforms(e,r,i){const n=this.state.model;if(Bfe.some(o=>e[o]!==r[o])&&n.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),e.colorRange!==r.colorRange&&n.setUniforms({colorRange:ay(r.colorRange)}),e.cellMarginPixels!==r.cellMarginPixels||e.cellSizePixels!==r.cellSizePixels||i.viewportChanged){const{width:o,height:s}=this.context.viewport,{cellSizePixels:f,cellMarginPixels:A}=this.props,v=f>A?A:0,w=new Float32Array([(f-v)/o*2,-(f-v)/s*2,1]);n.setUniforms({cellScale:w})}}}ly.layerName="ScreenGridCellLayer";ly.defaultProps=Ofe;function Dfe(t,e){const r={};for(const i in t)e.includes(i)||(r[i]=t[i]);return r}class mA extends rs{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:Dfe(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:r}=e;if(r.extensionsChanged){const i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:r,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:r,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,r={}){const{props:i,oldProps:n,changeFlags:o}=e,{compareAll:s=!1,dimension:f}=r,{ignoreProps:A}=this.state,{props:v,accessors:w=[]}=f,{updateTriggersChanged:C}=o;if(o.dataChanged)return!0;if(C){if(C.all)return!0;for(const I of w)if(C[I])return!0}if(s)return o.extensionsChanged?!0:X2({oldProps:n,newProps:i,ignoreProps:A,propTypes:this.constructor._propTypes});for(const I of v)if(i[I]!==n[I])return!0;return!1}isAttributeChanged(e){const{changedAttributes:r}=this.state;return e?r&&r[e]!==void 0:!Ffe(r)}_getAttributeManager(){return new W2(this.context.device,{id:this.props.id,stats:this.context.stats})}}mA.layerName="AggregationLayer";function Ffe(t){let e=!0;for(const r in t){e=!1;break}return e}function cy(t,e,r){const i=r;return i.domain=()=>t,i.range=()=>e,i}function WI(t,e){return cy(t,e,i=>Hfe(t,e,i))}function Lfe(t,e){return cy(t,e,i=>Gfe(t,e,i))}function kfe(t,e){const r=t.sort(IF);let i=0;const n=Math.max(1,e.length),o=new Array(n-1);for(;++i<n;)o[i-1]=Nfe(r,i/n);const s=f=>zfe(o,e,f);return s.thresholds=()=>o,cy(t,e,s)}function IF(t,e){return t-e}function Nfe(t,e){const r=t.length;if(e<=0||r<2)return t[0];if(e>=1)return t[r-1];const i=(r-1)*e,n=Math.floor(i),o=t[n],s=t[n+1];return o+(s-o)*(i-n)}function Ufe(t,e){let r=0,i=t.length;for(;r<i;){const n=r+i>>>1;IF(t[n],e)>0?i=n:r=n+1}return r}function zfe(t,e,r){return e[Ufe(t,r)]}function Vfe(t,e,r,i){const n=`${i}`;let o=e.get(n);return o===void 0&&(o=t.push(i),e.set(n,o)),r[(o-1)%r.length]}function jfe(t,e){const r=new Map,i=[];for(const o of t){const s=`${o}`;r.has(s)||r.set(s,i.push(o))}return cy(t,e,o=>Vfe(i,r,e,o))}function Hfe(t,e,r){const i=t[1]-t[0];if(i<=0)return fr.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const n=i/e.length,o=Math.floor((r-t[0])/n),s=Math.max(Math.min(o,e.length-1),0);return e[s]}function Gfe(t,e,r){return(r-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}function MF(t){return t!=null}function Wfe(t){const e=[];return t.forEach(r=>{!e.includes(r)&&MF(r)&&e.push(r)}),e}function RF(t,e){return(typeof e=="function"?t.map(e):t).filter(MF)}function Xfe(t,e){return RF(t,e)}function qfe(t,e){return Wfe(RF(t,e))}function $fe(t,e,r){return Math.max(e,Math.min(r,t))}function Zfe(t){switch(t){case"quantize":return WI;case"linear":return Lfe;case"quantile":return kfe;case"ordinal":return jfe;default:return WI}}const BF=t=>t.length,Kfe=3402823466e29,OF=t=>t.points,DF=t=>t.index,XI=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,Yfe={getValue:BF,getPoints:OF,getIndex:DF,filterData:null};class Iw{constructor(e=[],r=Yfe){this.aggregatedBins=this.getAggregatedBins(e,r),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(e,r){const{getValue:i=BF,getPoints:n=OF,getIndex:o=DF,filterData:s}=r,f=typeof s=="function",A=e.length,v=[];let w=0;for(let C=0;C<A;C++){const I=e[C],B=n(I),F=o(I),N=f?B.filter(s):B;I.filteredPoints=f?N:null;const V=N.length?i(N):null;V!=null&&(v[w]={i:Number.isFinite(F)?F:C,value:V,counts:N.length},w++)}return v}_percentileToIndex(e){const r=this.sortedBins.length;if(r<2)return[0,0];const[i,n]=e.map(f=>$fe(f,0,100)),o=Math.ceil(i/100*(r-1)),s=Math.floor(n/100*(r-1));return[o,s]}getBinMap(){const e={};for(const r of this.aggregatedBins)e[r.i]=r;return e}_updateMinMaxValues(){let e=0,r=0,i=Kfe,n=0;for(const o of this.aggregatedBins)e=e>o.counts?e:o.counts,r=r>o.value?r:o.value,i=i<o.value?i:o.value,n+=o.counts;this.maxCount=e,this.maxValue=r,this.minValue=i,this.totalCount=n}getValueRange(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((n,o)=>XI(n.value,o.value))),!this.sortedBins.length)return[];let r=0,i=this.sortedBins.length-1;if(Array.isArray(e)){const n=this._percentileToIndex(e);r=n[0],i=n[1]}return[this.sortedBins[r].value,this.sortedBins[i].value]}getValueDomainByScale(e,[r=0,i=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((o,s)=>XI(o.value,s.value))),!this.sortedBins.length)return[];const n=this._percentileToIndex([r,i]);return this._getScaleDomain(e,n)}_getScaleDomain(e,[r,i]){const n=this.sortedBins;switch(e){case"quantize":case"linear":return[n[r].value,n[i].value];case"quantile":return Xfe(n.slice(r,i+1),o=>o.value);case"ordinal":return qfe(n,o=>o.value);default:return[n[r].value,n[i].value]}}}const FF=6378e3;function Kg(t){return Number.isFinite(t)?t:0}function LF(t,e){const r=t.positions.value;let i=1/0,n=-1/0,o=1/0,s=-1/0,f,A;for(let w=0;w<e;w++)A=r[w*3],f=r[w*3+1],i=f<i?f:i,n=f>n?f:n,o=A<o?A:o,s=A>s?A:s;return{xMin:Kg(o),xMax:Kg(s),yMin:Kg(i),yMax:Kg(n)}}function Jfe(t,e,r,i){const{width:n,height:o}=i,s=r===br.CARTESIAN?[-n/2,-o/2]:[-180,-90];fr.assert(r===br.CARTESIAN||r===br.LNGLAT||r===br.DEFAULT);const{xMin:f,yMin:A}=t;return[-1*(qI(f-s[0],e.xOffset)+s[0]),-1*(qI(A-s[1],e.yOffset)+s[1])]}function qI(t,e){const r=t<0?-1:1;let i=r<0?Math.abs(t)+e:Math.abs(t);return i=Math.floor(i/e)*e,i*r}function kF(t,e,r=!0){if(!r)return{xOffset:e,yOffset:e};const{yMin:i,yMax:n}=t,o=(i+n)/2;return Qfe(e,o)}function NF(t,e,r,i){const n=kF(t,e,i!==br.CARTESIAN),o=Jfe(t,n,i,r),{xMin:s,yMin:f,xMax:A,yMax:v}=t,w=A-s+n.xOffset,C=v-f+n.yOffset,I=Math.ceil(w/n.xOffset),B=Math.ceil(C/n.yOffset);return{gridOffset:n,translation:o,width:w,height:C,numCol:I,numRow:B}}function Qfe(t,e){const r=ede(t),i=tde(e,t);return{yOffset:r,xOffset:i}}function ede(t){return t/FF*(180/Math.PI)}function tde(t,e){return e/FF*(180/Math.PI)/Math.cos(t*Math.PI/180)}function Mw(t,e){const r=rde(t,e),i=ide(r);return{gridHash:r.gridHash,gridOffset:r.gridOffset,data:i}}function rde(t,e){const{data:r=[],cellSize:i}=t,{attributes:n,viewport:o,projectPoints:s,numInstances:f}=e,A=n.positions.value,{size:v}=n.positions.getAccessor(),w=e.boundingBox||nde(n.positions,f),C=e.posOffset||[180,90],I=e.gridOffset||kF(w,i);if(I.xOffset<=0||I.yOffset<=0)return{gridHash:{},gridOffset:I,offsets:[0,0]};const{width:B,height:F}=o,N=Math.ceil(B/I.xOffset),V=Math.ceil(F/I.yOffset),G={},{iterable:Y,objectInfo:Z}=ql(r),se=new Array(3);for(const ge of Y){Z.index++,se[0]=A[Z.index*v],se[1]=A[Z.index*v+1],se[2]=v>=3?A[Z.index*v+2]:0;const[Pe,Ue]=s?o.project(se):se;if(Number.isFinite(Pe)&&Number.isFinite(Ue)){const Fe=Math.floor((Ue+C[1])/I.yOffset),pe=Math.floor((Pe+C[0])/I.xOffset);if(!s||pe>=0&&pe<N&&Fe>=0&&Fe<V){const Te=`${Fe}-${pe}`;G[Te]=G[Te]||{count:0,points:[],lonIdx:pe,latIdx:Fe},G[Te].count+=1,G[Te].points.push({source:ge,index:Z.index})}}}return{gridHash:G,gridOffset:I,offsets:[C[0]*-1,C[1]*-1]}}function ide({gridHash:t,gridOffset:e,offsets:r}){const i=new Array(Object.keys(t).length);let n=0;for(const o in t){const s=o.split("-"),f=parseInt(s[0],10),A=parseInt(s[1],10),v=n++;i[v]={index:v,position:[r[0]+e.xOffset*A,r[1]+e.yOffset*f],...t[o]}}return i}function nde(t,e){const r=t.value,{size:i}=t.getAccessor();let n=1/0,o=-1/0,s=1/0,f=-1/0,A,v;for(let w=0;w<e;w++)v=r[w*i],A=r[w*i+1],Number.isFinite(v)&&Number.isFinite(A)&&(n=A<n?A:n,o=A>o?A:o,s=v<s?v:s,f=v>f?v:f);return{xMin:s,xMax:f,yMin:n,yMax:o}}class uy extends mA{initializeAggregationLayer({dimensions:e}){super.initializeAggregationLayer(e),this.setState({layerData:{},gpuGridAggregator:new Hl(this.context.device,{id:`${this.id}-gpu-aggregator`}),cpuGridAggregator:Mw})}updateState(e){super.updateState(e),this.updateAggregationState(e);const{aggregationDataDirty:r,aggregationWeightsDirty:i,gpuAggregation:n}=this.state;if(this.getNumInstances()<=0)return;let o=!1;(r||n&&i)&&(this._updateAggregation(e),o=!0),!n&&(r||i)&&(this._updateWeightBins(),this._uploadAggregationResults(),o=!0),this.setState({aggregationDirty:o})}finalizeState(e){var i;const{count:r}=this.state.weights;r&&r.aggregationBuffer&&r.aggregationBuffer.delete(),(i=this.state.gpuGridAggregator)==null||i.delete(),super.finalizeState(e)}updateShaders(e){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(e)}updateAggregationState(e){fr.assert(!1)}allocateResources(e,r){if(this.state.numRow!==e||this.state.numCol!==r){const i=r*e*4*4,{weights:n}=this.state;for(const o in n){const s=n[o];s.aggregationBuffer&&s.aggregationBuffer.delete(),s.aggregationBuffer=this.context.device.createBuffer({byteLength:i,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:e,maxMinData:r,maxData:i,minData:n}){const{count:o}=this.state.weights;o&&(o.aggregationData=e,o.maxMinData=r,o.maxData=i,o.minData=n)}_updateAggregation(e){const{cpuGridAggregator:r,gpuGridAggregator:i,gridOffset:n,posOffset:o,translation:s=[0,0],scaling:f=[0,0,0],boundingBox:A,projectPoints:v,gpuAggregation:w,numCol:C,numRow:I}=this.state,{props:B}=e,{viewport:F}=this.context,N=this.getAttributes(),V=this.getNumInstances();if(w){const{weights:G}=this.state;i.run({weights:G,cellSize:[n.xOffset,n.yOffset],numCol:C,numRow:I,translation:s,scaling:f,vertexCount:V,projectPoints:v,attributes:N,moduleSettings:this.getModuleSettings()})}else{const G=r(B,{gridOffset:n,projectPoints:v,attributes:N,viewport:F,posOffset:o,boundingBox:A});this.setState({layerData:G})}}_updateWeightBins(){const{getValue:e}=this.state,r=new Iw(this.state.layerData.data||[],{getValue:e});this.setState({sortedBins:r})}_uploadAggregationResults(){const{numCol:e,numRow:r}=this.state,{data:i}=this.state.layerData,{aggregatedBins:n,minValue:o,maxValue:s,totalCount:f}=this.state.sortedBins,A=4,v=e*r*A,w=new Float32Array(v).fill(0);for(const F of n){const{lonIdx:N,latIdx:V}=i[F.i],{value:G,counts:Y}=F,Z=(N+V*e)*A;w[Z]=G,w[Z+A-1]=Y}const C=new Float32Array([s,0,0,o]),I=new Float32Array([s,0,0,f]),B=new Float32Array([o,0,0,f]);this.updateResults({aggregationData:w,maxMinData:C,maxData:I,minData:B})}}uy.layerName="GridAggregationLayer";const sde={...ly.defaultProps,getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!1,aggregation:"SUM"},$I="positions",ode={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class Rw extends uy{initializeState(){super.initializeAggregationLayer({dimensions:ode,getCellSize:i=>i.cellSizePixels});const e={count:{size:1,operation:Pn.SUM,needMax:!0,maxTexture:gm(this.context.device,{id:`${this.id}-max-texture`})}};this.setState({supported:!0,projectPoints:!0,weights:e,subLayerData:{attributes:{}},maxTexture:e.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]}),this.getAttributeManager().add({[$I]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return this.state.supported&&e.somethingChanged}updateState(e){super.updateState(e)}renderLayers(){if(!this.state.supported)return[];const{maxTexture:e,numRow:r,numCol:i,weights:n}=this.state,{updateTriggers:o}=this.props,{aggregationBuffer:s}=n.count,f=this.getSubLayerClass("cells",ly);return new f(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:o}),{data:{attributes:{instanceCounts:s}},maxTexture:e,numInstances:r*i})}finalizeState(e){super.finalizeState(e);const{aggregationBuffer:r,maxBuffer:i,maxTexture:n}=this.state;r==null||r.delete(),i==null||i.delete(),n==null||n.delete()}getPickingInfo({info:e}){const{index:r}=e;if(r>=0){const{gpuGridAggregator:i,gpuAggregation:n,weights:o}=this.state,s=n?i.getData("count"):o.count;e.object=Hl.getAggregationData({pixelIndex:r,...s})}return e}updateResults({aggregationData:e,maxData:r}){const{count:i}=this.state.weights;i.aggregationData=e,i.aggregationBuffer.write(e),i.maxData=r,i.maxTexture.setImageData({data:r})}updateAggregationState(e){const r=e.props.cellSizePixels,i=e.oldProps.cellSizePixels!==r,{viewportChanged:n}=e.changeFlags;let o=e.props.gpuAggregation;this.state.gpuAggregation!==e.props.gpuAggregation&&o&&!Hl.isSupported(this.context.device)&&(fr.warn("GPU Grid Aggregation not supported, falling back to CPU")(),o=!1);const s=o!==this.state.gpuAggregation;this.setState({gpuAggregation:o});const f=this.isAttributeChanged($I),{dimensions:A}=this.state,{data:v,weights:w}=A,C=f||s||n||this.isAggregationDirty(e,{compareAll:o,dimension:v}),I=this.isAggregationDirty(e,{dimension:w});this.setState({aggregationDataDirty:C,aggregationWeightsDirty:I});const{viewport:B}=this.context;if(n||i){const{width:F,height:N}=B,V=Math.ceil(F/r),G=Math.ceil(N/r);this.allocateResources(G,V),this.setState({scaling:[F/2,-N/2,1],gridOffset:{xOffset:r,yOffset:r},width:F,height:N,numCol:V,numRow:G})}I&&this._updateAccessors(e),(C||I)&&this._resetResults()}_updateAccessors(e){const{getWeight:r,aggregation:i,data:n}=e.props,{count:o}=this.state.weights;o&&(o.getWeight=r,o.operation=Pn[i]),this.setState({getValue:Pw(i,r,{data:n})})}_resetResults(){const{count:e}=this.state.weights;e&&(e.aggregationData=null)}}Rw.layerName="ScreenGridLayer";Rw.defaultProps=sde;function ZI(){}const KI=["getBins","getDomain","getScaleFunc"],YI=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],ade=t=>t.cellSize;class Bw{constructor(e){this.state={layerData:{data:void 0},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=e.getCellSize||ade,this._getAggregator=e.getAggregator,this._addDimension(e.dimensions||YI)}static defaultDimensions(){return YI}updateState(e,r){const{oldProps:i,props:n,changeFlags:o}=e;this.updateGetValueFuncs(i,n,o);const s=this.needsReProjectPoints(i,n,o);let f=!1;return o.dataChanged||s?(this.getAggregatedData(n,r),f=!0):((this.getDimensionChanges(i,n,o)||[]).forEach(v=>typeof v=="function"&&v()),f=!0),this.setState({aggregationDirty:f}),this.state}setState(e){this.state={...this.state,...e}}setDimensionState(e,r){this.setState({dimensions:{...this.state.dimensions,[e]:{...this.state.dimensions[e],...r}}})}normalizeResult(e={}){return e.hexagons?{data:e.hexagons,...e}:e.layerData?{data:e.layerData,...e}:e}getAggregatedData(e,r){const n=this._getAggregator(e)(e,r);this.setState({layerData:this.normalizeResult(n)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}updateGetValueFuncs(e,r,i){for(const n in this.dimensionUpdaters){const{value:o,weight:s,aggregation:f}=this.dimensionUpdaters[n].getBins.triggers;let A=r[o.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[n].getBins,e,r,i)&&(A?A=ufe(A,{data:r.data}):A=Pw(r[f.prop],r[s.prop],{data:r.data})),A&&this.setDimensionState(n,{getValue:A})}}needsReProjectPoints(e,r,i){return this._getCellSize(e)!==this._getCellSize(r)||this._getAggregator(e)!==this._getAggregator(r)||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}addDimension(e){this._addDimension(e)}_addDimension(e=[]){e.forEach(r=>{const{key:i}=r;this.dimensionUpdaters[i]=this.getDimensionUpdaters(r),this.state.dimensions[i]={getValue:null,domain:null,sortedBins:null,scaleFunc:ZI}})}getDimensionUpdaters({key:e,accessor:r,pickingInfo:i,getBins:n,getDomain:o,getScaleFunc:s,nullValue:f}){return{key:e,accessor:r,pickingInfo:i,getBins:{updater:this.getDimensionSortedBins.bind(this),...n},getDomain:{updater:this.getDimensionValueDomain.bind(this),...o},getScaleFunc:{updater:this.getDimensionScale.bind(this),...s},attributeAccessor:this.getSubLayerDimensionAttribute(e,f)}}needUpdateDimensionStep(e,r,i,n){return Object.values(e.triggers).some(o=>o.updateTrigger?n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged[o.updateTrigger]):r[o.prop]!==i[o.prop])}getDimensionChanges(e,r,i){const n=[];for(const o in this.dimensionUpdaters){const s=KI.find(f=>this.needUpdateDimensionStep(this.dimensionUpdaters[o][f],e,r,i));s&&n.push(this.dimensionUpdaters[o][s].updater.bind(this,r,this.dimensionUpdaters[o]))}return n.length?n:null}getUpdateTriggers(e){const r=e.updateTriggers||{},i={};for(const n in this.dimensionUpdaters){const{accessor:o}=this.dimensionUpdaters[n];i[o]={},KI.forEach(s=>{Object.values(this.dimensionUpdaters[n][s].triggers).forEach(({prop:f,updateTrigger:A})=>{if(A){const v=r[A];typeof v=="object"&&!Array.isArray(v)?Object.assign(i[o],v):v!==void 0&&(i[o][f]=v)}else i[o][f]=e[f]})})}return i}getSortedBins(e){for(const r in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[r])}getDimensionSortedBins(e,r){const{key:i}=r,{getValue:n}=this.state.dimensions[i],o=new Iw(this.state.layerData.data||[],{getValue:n,filterData:e._filterData});this.setDimensionState(i,{sortedBins:o}),this.getDimensionValueDomain(e,r)}getDimensionValueDomain(e,r){const{getDomain:i,key:n}=r,{triggers:{lowerPercentile:o,upperPercentile:s,scaleType:f}}=i,A=this.state.dimensions[n].sortedBins.getValueDomainByScale(e[f.prop],[e[o.prop],e[s.prop]]);this.setDimensionState(n,{valueDomain:A}),this.getDimensionScale(e,r)}getDimensionScale(e,r){const{key:i,getScaleFunc:n,getDomain:o}=r,{domain:s,range:f}=n.triggers,{scaleType:A}=o.triggers,{onSet:v}=n,w=e[f.prop],C=e[s.prop]||this.state.dimensions[i].valueDomain,B=Zfe(A&&e[A.prop])(C,w);typeof v=="object"&&typeof e[v.props]=="function"&&e[v.props](B.domain()),this.setDimensionState(i,{scaleFunc:B})}getSubLayerDimensionAttribute(e,r){return i=>{const{sortedBins:n,scaleFunc:o}=this.state.dimensions[e],s=n.binMap[i.index];if(s&&s.counts===0)return r;const f=s&&s.value,A=o.domain();return f>=A[0]&&f<=A[A.length-1]?o(f):r}}getSubLayerAccessors(e){const r={};for(const i in this.dimensionUpdaters){const{accessor:n}=this.dimensionUpdaters[i];r[n]=this.getSubLayerDimensionAttribute(e,i)}return r}getPickingInfo({info:e}){const r=e.picked&&e.index>-1;let i=null;if(r){const n=this.state.layerData.data[e.index],o={};for(const s in this.dimensionUpdaters){const{pickingInfo:f}=this.dimensionUpdaters[s],{sortedBins:A}=this.state.dimensions[s],v=A.binMap[n.index]&&A.binMap[n.index].value;o[f]=v}i=Object.assign(o,n,{points:n.filteredPoints||n.points})}return e.picked=!!i,e.object=i,e}getAccessor(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:ZI}}function JI(){}const lde={colorDomain:null,colorRange:gA,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:JI,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:JI,gridAggregator:Mw,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}};class v0 extends mA{initializeState(){const e=new Bw({getAggregator:i=>i.gridAggregator,getCellSize:i=>i.cellSize});this.state={cpuAggregator:e,aggregatorState:e.state},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(e){super.updateState(e),this.setState({aggregatorState:this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:r,cellSize:i,coverage:n,material:o,transitions:s}=this.props,{cpuAggregator:f}=this.state,A=this.getSubLayerClass("grid-cell",N_),v=this._getSublayerUpdateTriggers();return new A({cellSize:i,coverage:n,material:o,elevationScale:e,extruded:r,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:v}),{data:f.state.layerData.data})}}v0.layerName="CPUGridLayer";v0.defaultProps=lde;var md=Math.PI/3,cde=[0,md,2*md,3*md,4*md,5*md];function ude(t){return t[0]}function hde(t){return t[1]}function fde(){var t=0,e=0,r=1,i=1,n=ude,o=hde,s,f,A;function v(C){var I={},B=[],F,N=C.length;for(F=0;F<N;++F)if(!(isNaN(G=+n.call(null,V=C[F],F,C))||isNaN(Y=+o.call(null,V,F,C)))){var V,G,Y,Z=Math.round(Y=Y/A),se=Math.round(G=G/f-(Z&1)/2),ge=Y-Z;if(Math.abs(ge)*3>1){var Pe=G-se,Ue=se+(G<se?-1:1)/2,Fe=Z+(Y<Z?-1:1),pe=G-Ue,Te=Y-Fe;Pe*Pe+ge*ge>pe*pe+Te*Te&&(se=Ue+(Z&1?1:-1)/2,Z=Fe)}var Ae=se+"-"+Z,Le=I[Ae];Le?Le.push(V):(B.push(Le=I[Ae]=[V]),Le.x=(se+(Z&1)/2)*f,Le.y=Z*A)}return B}function w(C){var I=0,B=0;return cde.map(function(F){var N=Math.sin(F)*C,V=-Math.cos(F)*C,G=N-I,Y=V-B;return I=N,B=V,[G,Y]})}return v.hexagon=function(C){return"m"+w(C==null?s:+C).join("l")+"z"},v.centers=function(){for(var C=[],I=Math.round(e/A),B=Math.round(t/f),F=I*A;F<i+s;F+=A,++I)for(var N=B*f+(I&1)*f/2;N<r+f/2;N+=f)C.push([N,F]);return C},v.mesh=function(){var C=w(s).slice(0,4).join("l");return v.centers().map(function(I){return"M"+I+"m"+C}).join("")},v.x=function(C){return arguments.length?(n=C,v):n},v.y=function(C){return arguments.length?(o=C,v):o},v.radius=function(C){return arguments.length?(s=+C,f=s*2*Math.sin(md),A=s*1.5,v):s},v.size=function(C){return arguments.length?(t=e=0,r=+C[0],i=+C[1],v):[r-t,i-e]},v.extent=function(C){return arguments.length?(t=+C[0][0],e=+C[0][1],r=+C[1][0],i=+C[1][1],v):[[t,e],[r,i]]},v.radius(1)}function dde(t,e){const{data:r,radius:i}=t,{viewport:n,attributes:o}=e,s=r.length?Ade(r,e):null,f=pde(i,n,s),A=[],{iterable:v,objectInfo:w}=ql(r),C=o.positions.value,{size:I}=o.positions.getAccessor();for(const N of v){w.index++;const V=w.index*I,G=[C[V],C[V+1]];Number.isFinite(G[0])&&Number.isFinite(G[1])?A.push({screenCoord:n.projectFlat(G),source:N,index:w.index}):fr.warn("HexagonLayer: invalid position")()}return{hexagons:fde().radius(f).x(N=>N.screenCoord[0]).y(N=>N.screenCoord[1])(A).map((N,V)=>({position:n.unprojectFlat([N.x,N.y]),points:N,index:V})),radiusCommon:f}}function Ade(t,e){const{attributes:r}=e,i=r.positions.value,{size:n}=r.positions.getAccessor();let o=1/0,s=1/0,f=-1/0,A=-1/0,v;for(v=0;v<n*t.length;v+=n){const w=i[v],C=i[v+1];Number.isFinite(w)&&Number.isFinite(C)&&(o=Math.min(w,o),f=Math.max(w,f),s=Math.min(C,s),A=Math.max(C,A))}return[o,s,f,A].every(Number.isFinite)?[(o+f)/2,(s+A)/2]:null}function pde(t,e,r){const{unitsPerMeter:i}=e.getDistanceScales(r);return t*i[0]}function QI(){}const gde={colorDomain:null,colorRange:gA,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:QI,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:QI,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:dde,getPosition:{type:"accessor",value:t=>t.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class Ow extends mA{initializeState(){const e=new Bw({getAggregator:i=>i.hexagonAggregator,getCellSize:i=>i.radius});this.state={cpuAggregator:e,aggregatorState:e.state,vertices:null},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(e){if(super.updateState(e),e.changeFlags.propsOrDataChanged){const r=this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==r.layerData){const{hexagonVertices:i}=r.layerData||{};this.setState({vertices:i&&this.convertLatLngToMeterOffset(i)})}this.setState({aggregatorState:r})}}convertLatLngToMeterOffset(e){const{viewport:r}=this.context;if(Array.isArray(e)&&e.length===6){const i=e[0],n=e[3],o=[(i[0]+n[0])/2,(i[1]+n[1])/2],s=r.projectFlat(o),{metersPerUnit:f}=r.getDistanceScales(o);return e.map(v=>{const w=r.projectFlat(v);return[(w[0]-s[0])*f[0],(w[1]-s[1])*f[1]]})}return fr.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:r,coverage:i,material:n,transitions:o}=this.props,{aggregatorState:s,vertices:f}=this.state,A=this.getSubLayerClass("hexagon-cell",Lc),v=this._getSublayerUpdateTriggers(),w=f?{vertices:f,radius:1}:{radius:s.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new A({...w,diskResolution:6,elevationScale:e,extruded:r,coverage:i,material:n,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:v}),{data:s.layerData.data})}}Ow.layerName="HexagonLayer";Ow.defaultProps=gde;const Ft=.5,Gt=1/6,tt={N:[0,Ft],E:[Ft,0],S:[0,-Ft],W:[-Ft,0],NE:[Ft,Ft],NW:[-Ft,Ft],SE:[Ft,-Ft],SW:[-Ft,-Ft]},sd=[tt.W,tt.SW,tt.S],od=[tt.S,tt.SE,tt.E],ad=[tt.E,tt.NE,tt.N],ld=[tt.NW,tt.W,tt.N],cd=[[-Ft,Gt],[-Ft,-Gt],[-Gt,-Ft],[Gt,-Ft]],ud=[[-Gt,-Ft],[Gt,-Ft],[Ft,-Gt],[Ft,Gt]],hd=[[Ft,-Gt],[Ft,Gt],[Gt,Ft],[-Gt,Ft]],fd=[[-Ft,Gt],[-Ft,-Gt],[Gt,Ft],[-Gt,Ft]],eM=[tt.W,tt.SW,tt.SE,tt.E],tM=[tt.S,tt.SE,tt.NE,tt.N],rM=[tt.NW,tt.W,tt.E,tt.NE],iM=[tt.NW,tt.SW,tt.S,tt.N],nM=[[-Ft,Gt],[-Ft,-Gt],[Ft,-Gt],[Ft,Gt]],sM=[[-Gt,-Ft],[Gt,-Ft],[Gt,Ft],[-Gt,Ft]],mde=[tt.NW,tt.SW,tt.SE,tt.NE],oM=[tt.NW,tt.SW,tt.SE,tt.E,tt.N],aM=[tt.W,tt.SW,tt.SE,tt.NE,tt.N],lM=[tt.NW,tt.W,tt.S,tt.SE,tt.NE],cM=[tt.NW,tt.SW,tt.S,tt.E,tt.NE],uM=[tt.NW,tt.W,[Ft,-Gt],[Ft,Gt],tt.N],hM=[[-Gt,-Ft],[Gt,-Ft],tt.E,tt.NE,tt.N],fM=[[-Ft,Gt],[-Ft,-Gt],tt.S,tt.SE,tt.E],dM=[tt.W,tt.SW,tt.S,[Gt,Ft],[-Gt,Ft]],AM=[tt.NW,tt.W,[-Gt,-Ft],[Gt,-Ft],tt.N],pM=[[-Ft,Gt],[-Ft,-Gt],tt.E,tt.NE,tt.N],gM=[tt.S,tt.SE,tt.E,[Gt,Ft],[-Gt,Ft]],mM=[tt.W,tt.SW,tt.S,[Ft,-Gt],[Ft,Gt]],_M=[tt.W,tt.SW,tt.SE,tt.E,[Gt,Ft],[-Gt,Ft]],yM=[[-Ft,Gt],[-Ft,-Gt],tt.S,tt.SE,tt.NE,tt.N],vM=[tt.NW,tt.W,[-Gt,-Ft],[Gt,-Ft],tt.E,tt.NE],bM=[tt.NW,tt.SW,tt.S,[Ft,-Gt],[Ft,Gt],tt.N],dd=[tt.W,tt.SW,tt.S,tt.E,tt.NE,tt.N],Ad=[tt.NW,tt.W,tt.S,tt.SE,tt.E,tt.N],Yg=[[-Ft,Gt],[-Ft,-Gt],[-Gt,-Ft],[Gt,-Ft],tt.E,tt.NE,tt.N],Jg=[tt.W,tt.SW,tt.S,[Ft,-Gt],[Ft,Gt],[Gt,Ft],[-Gt,Ft]],Qg=[tt.NW,tt.W,[-Gt,-Ft],[Gt,-Ft],[Ft,-Gt],[Ft,Gt],tt.N],em=[[-Ft,Gt],[-Ft,-Gt],tt.S,tt.SE,tt.E,[Gt,Ft],[-Gt,Ft]],xM=[[-Ft,Gt],[-Ft,-Gt],[-Gt,-Ft],[Gt,-Ft],[Ft,-Gt],[Ft,Gt],[Gt,Ft],[-Gt,Ft]],_de={0:[],1:[[tt.W,tt.S]],2:[[tt.S,tt.E]],3:[[tt.W,tt.E]],4:[[tt.N,tt.E]],5:{0:[[tt.W,tt.S],[tt.N,tt.E]],1:[[tt.W,tt.N],[tt.S,tt.E]]},6:[[tt.N,tt.S]],7:[[tt.W,tt.N]],8:[[tt.W,tt.N]],9:[[tt.N,tt.S]],10:{0:[[tt.W,tt.N],[tt.S,tt.E]],1:[[tt.W,tt.S],[tt.N,tt.E]]},11:[[tt.N,tt.E]],12:[[tt.W,tt.E]],13:[[tt.S,tt.E]],14:[[tt.W,tt.S]],15:[]};function kt(t){return parseInt(t,4)}const yde={[kt("0000")]:[],[kt("2222")]:[],[kt("2221")]:[sd],[kt("2212")]:[od],[kt("2122")]:[ad],[kt("1222")]:[ld],[kt("0001")]:[sd],[kt("0010")]:[od],[kt("0100")]:[ad],[kt("1000")]:[ld],[kt("2220")]:[cd],[kt("2202")]:[ud],[kt("2022")]:[hd],[kt("0222")]:[fd],[kt("0002")]:[cd],[kt("0020")]:[ud],[kt("0200")]:[hd],[kt("2000")]:[fd],[kt("0011")]:[eM],[kt("0110")]:[tM],[kt("1100")]:[rM],[kt("1001")]:[iM],[kt("2211")]:[eM],[kt("2112")]:[tM],[kt("1122")]:[rM],[kt("1221")]:[iM],[kt("2200")]:[nM],[kt("2002")]:[sM],[kt("0022")]:[nM],[kt("0220")]:[sM],[kt("1111")]:[mde],[kt("1211")]:[oM],[kt("2111")]:[aM],[kt("1112")]:[lM],[kt("1121")]:[cM],[kt("1011")]:[oM],[kt("0111")]:[aM],[kt("1110")]:[lM],[kt("1101")]:[cM],[kt("1200")]:[uM],[kt("0120")]:[hM],[kt("0012")]:[fM],[kt("2001")]:[dM],[kt("1022")]:[uM],[kt("2102")]:[hM],[kt("2210")]:[fM],[kt("0221")]:[dM],[kt("1002")]:[AM],[kt("2100")]:[pM],[kt("0210")]:[gM],[kt("0021")]:[mM],[kt("1220")]:[AM],[kt("0122")]:[pM],[kt("2012")]:[gM],[kt("2201")]:[mM],[kt("0211")]:[_M],[kt("2110")]:[yM],[kt("1102")]:[vM],[kt("1021")]:[bM],[kt("2011")]:[_M],[kt("0112")]:[yM],[kt("1120")]:[vM],[kt("1201")]:[bM],[kt("2101")]:[dd],[kt("0121")]:[dd],[kt("1012")]:[Ad],[kt("1210")]:[Ad],[kt("0101")]:{0:[sd,ad],1:[dd],2:[dd]},[kt("1010")]:{0:[ld,od],1:[Ad],2:[Ad]},[kt("2121")]:{0:[dd],1:[dd],2:[sd,ad]},[kt("1212")]:{0:[Ad],1:[Ad],2:[ld,od]},[kt("2120")]:{0:[Yg],1:[Yg],2:[cd,ad]},[kt("2021")]:{0:[Jg],1:[Jg],2:[sd,hd]},[kt("1202")]:{0:[Qg],1:[Qg],2:[ld,ud]},[kt("0212")]:{0:[em],1:[em],2:[od,fd]},[kt("0102")]:{0:[cd,ad],1:[Yg],2:[Yg]},[kt("0201")]:{0:[sd,hd],1:[Jg],2:[Jg]},[kt("1020")]:{0:[ld,ud],1:[Qg],2:[Qg]},[kt("2010")]:{0:[od,fd],1:[em],2:[em]},[kt("2020")]:{0:[fd,ud],1:[xM],2:[cd,hd]},[kt("0202")]:{0:[hd,cd],1:[xM],2:[fd,ud]}},Hd={ISO_LINES:1,ISO_BANDS:2},vde={zIndex:0,zOffset:.005};function cp(t,e){return Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function bde(t){const{cellWeights:e,x:r,y:i,width:n,height:o}=t;let s=t.threshold;t.thresholdValue&&(fr.deprecated("thresholdValue","threshold")(),s=t.thresholdValue);const f=r<0,A=r>=n-1,v=i<0,w=i>=o-1,C=f||A||v||w,I={},B={};f||w?B.top=0:(I.top=e[(i+1)*n+r],B.top=cp(I.top,s)),A||w?B.topRight=0:(I.topRight=e[(i+1)*n+r+1],B.topRight=cp(I.topRight,s)),A||v?B.right=0:(I.right=e[i*n+r+1],B.right=cp(I.right,s)),f||v?B.current=0:(I.current=e[i*n+r],B.current=cp(I.current,s));const{top:F,topRight:N,right:V,current:G}=B;let Y=-1;Number.isFinite(s)&&(Y=F<<3|N<<2|V<<1|G),Array.isArray(s)&&(Y=F<<6|N<<4|V<<2|G);let Z=0;return C||(Z=cp((I.top+I.topRight+I.right+I.current)/4,s)),{code:Y,meanCode:Z}}function wM(t){const{gridOrigin:e,cellSize:r,x:i,y:n,code:o,meanCode:s,type:f=Hd.ISO_LINES}=t,A={...vde,...t.thresholdData};let v=f===Hd.ISO_BANDS?yde[o]:_de[o];Array.isArray(v)||(v=v[s]);const w=A.zIndex*A.zOffset,C=(i+1)*r[0],I=(n+1)*r[1],B=e[0]+C,F=e[1]+I;if(f===Hd.ISO_BANDS){const V=[];return v.forEach(G=>{const Y=[];G.forEach(Z=>{const se=B+Z[0]*r[0],ge=F+Z[1]*r[1];Y.push([se,ge,w])}),V.push(Y)}),V}const N=[];return v.forEach(V=>{V.forEach(G=>{const Y=B+G[0]*r[0],Z=F+G[1]*r[1];N.push([Y,Z,w])})}),N}function xde({thresholdData:t,cellWeights:e,gridSize:r,gridOrigin:i,cellSize:n}){const o=[],s=[],f=r[0],A=r[1];let v=0,w=0;for(const C of t){const{contour:I}=C,{threshold:B}=I;for(let F=-1;F<f;F++)for(let N=-1;N<A;N++){const{code:V,meanCode:G}=bde({cellWeights:e,threshold:B,x:F,y:N,width:f,height:A}),Y={type:Hd.ISO_BANDS,gridOrigin:i,cellSize:n,x:F,y:N,width:f,height:A,code:V,meanCode:G,thresholdData:C};if(Array.isArray(B)){Y.type=Hd.ISO_BANDS;const Z=wM(Y);for(const se of Z)s[w++]={vertices:se,contour:I}}else{Y.type=Hd.ISO_LINES;const Z=wM(Y);for(let se=0;se<Z.length;se+=2)o[v++]={start:Z[se],end:Z[se+1],contour:I}}}}return{contourSegments:o,contourPolygons:s}}const TM=[255,255,255,255],wde=1,Tde=1,Ede={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!1,aggregation:"SUM",contours:{type:"object",value:[{threshold:Tde}],optional:!0,compare:3},zOffset:.005},EM="positions",Sde={data:{props:["cellSize"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class Dw extends uy{initializeState(){super.initializeAggregationLayer({dimensions:Sde}),this.setState({contourData:{},projectPoints:!1,weights:{count:{size:1,operation:Pn.SUM}}}),this.getAttributeManager().add({[EM]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}updateState(e){super.updateState(e);let r=!1;const{oldProps:i,props:n}=e,{aggregationDirty:o}=this.state;(i.contours!==n.contours||i.zOffset!==n.zOffset)&&(r=!0,this._updateThresholdData(e.props)),this.getNumInstances()>0&&(o||r)&&this._generateContours()}renderLayers(){const{contourSegments:e,contourPolygons:r}=this.state.contourData,i=this.getSubLayerClass("lines",u0),n=this.getSubLayerClass("bands",zu),o=e&&e.length>0&&new i(this.getSubLayerProps({id:"lines"}),{data:this.state.contourData.contourSegments,getSourcePosition:f=>f.start,getTargetPosition:f=>f.end,getColor:f=>f.contour.color||TM,getWidth:f=>f.contour.strokeWidth||wde}),s=r&&r.length>0&&new n(this.getSubLayerProps({id:"bands"}),{data:this.state.contourData.contourPolygons,getPolygon:f=>f.vertices,getFillColor:f=>f.contour.color||TM});return[o,s]}updateAggregationState(e){const{props:r,oldProps:i}=e,{cellSize:n,coordinateSystem:o}=r,{viewport:s}=this.context,f=i.cellSize!==n;let A=r.gpuAggregation;this.state.gpuAggregation!==r.gpuAggregation&&A&&!Hl.isSupported(this.context.device)&&(fr.warn("GPU Grid Aggregation not supported, falling back to CPU")(),A=!1);const v=A!==this.state.gpuAggregation;this.setState({gpuAggregation:A});const{dimensions:w}=this.state,C=this.isAttributeChanged(EM),{data:I,weights:B}=w;let{boundingBox:F}=this.state;if(C&&(F=LF(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:F})),C||f){const{gridOffset:G,translation:Y,width:Z,height:se,numCol:ge,numRow:Pe}=NF(F,n,s,o);this.allocateResources(Pe,ge),this.setState({gridOffset:G,boundingBox:F,translation:Y,posOffset:Y.slice(),gridOrigin:[-1*Y[0],-1*Y[1]],width:Z,height:se,numCol:ge,numRow:Pe})}const N=C||v||this.isAggregationDirty(e,{dimension:I,compareAll:A}),V=this.isAggregationDirty(e,{dimension:B});V&&this._updateAccessors(e),(N||V)&&this._resetResults(),this.setState({aggregationDataDirty:N,aggregationWeightsDirty:V})}_updateAccessors(e){const{getWeight:r,aggregation:i,data:n}=e.props,{count:o}=this.state.weights;o&&(o.getWeight=r,o.operation=Pn[i]),this.setState({getValue:Pw(i,r,{data:n})})}_resetResults(){const{count:e}=this.state.weights;e&&(e.aggregationData=null)}_generateContours(){const{numCol:e,numRow:r,gridOrigin:i,gridOffset:n,thresholdData:o}=this.state,{count:s}=this.state.weights;let{aggregationData:f}=s;f||(f=s.aggregationBuffer.readSyncWebGL(),s.aggregationData=f);const{cellWeights:A}=Hl.getCellData({countsData:f}),v=xde({thresholdData:o,cellWeights:A,gridSize:[e,r],gridOrigin:i,cellSize:[n.xOffset,n.yOffset]});this.setState({contourData:v})}_updateThresholdData(e){const{contours:r,zOffset:i}=e,n=r.length,o=new Array(n);for(let s=0;s<n;s++){const f=r[s];o[s]={contour:f,zIndex:f.zIndex||s,zOffset:i}}this.setState({thresholdData:o})}}Dw.layerName="ContourLayer";Dw.defaultProps=Ede;const Cde=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-vertex-shader
#define RANGE_COUNT 6
in vec3 positions;
in vec3 normals;
in vec4 colors;
in vec4 elevations;
in vec3 instancePickingColors;
uniform vec2 offset;
uniform bool extruded;
uniform float cellSize;
uniform float coverage;
uniform float opacity;
uniform float elevationScale;
uniform ivec2 gridSize;
uniform vec2 gridOrigin;
uniform vec2 gridOriginLow;
uniform vec2 gridOffset;
uniform vec2 gridOffsetLow;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 elevationRange;
uniform vec2 colorDomain;
uniform bool colorDomainValid;
uniform vec2 elevationDomain;
uniform bool elevationDomainValid;
layout(std140) uniform;
uniform ColorData
{
vec4 maxMinCount;
} colorData;
uniform ElevationData
{
vec4 maxMinCount;
} elevationData;
#define EPSILON 0.00001
out vec4 vColor;
vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
vec4 outColor = vec4(0., 0., 0., 0.);
if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
float domainRange = domain.y - domain.x;
if (domainRange <= 0.) {
outColor = colorRange[0];
} else {
float rangeCount = float(RANGE_COUNT);
float rangeStep = domainRange / rangeCount;
float idx = floor((value - domain.x) / rangeStep);
idx = clamp(idx, 0., rangeCount - 1.);
int intIdx = int(idx);
outColor = colorRange[intIdx];
}
}
return outColor;
}
float linearScale(vec2 domain, vec2 range, float value) {
if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;
}
return -1.;
}
void main(void) {
vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);
vec4 color = quantizeScale(clrDomain, colorRange, colors.r);
float elevation = 0.0;
if (extruded) {
vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);
elevation = linearScale(elvDomain, elevationRange, elevations.r);
elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;
}
float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);
float dotRadius = cellSize / 2. * coverage * shouldRender;
int yIndex = (gl_InstanceID / gridSize[0]);
int xIndex = gl_InstanceID - (yIndex * gridSize[0]);
vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));
instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));
vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));
instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));
vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);
vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);
geometry.worldPosition = centroidPosition;
vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);
picking_setPickingColor(instancePickingColors);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
vec3 normals_commonspace = project_normal(normals);
if (extruded) {
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, normals_commonspace);
vColor = vec4(lightColor, color.a * opacity) / 255.;
} else {
vColor = vec4(color.rgb, color.a * opacity) / 255.;
}
}
`,Pde=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
fragColor = picking_filterColor(fragColor);
}
`,m1=0,_1=1,Ide={colorDomain:null,colorRange:gA,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",value:[1,1]},gridOrigin:{type:"array",value:[0,0]},gridOffset:{type:"array",value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0};class Fw extends Wn{getShaders(){return super.getShaders({vs:Cde,fs:Pde,modules:[uo,E_,Mo,T_]})}initializeState(){this.getAttributeManager().addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});const r=this._getModel();this._setupUniformBuffer(r),this.setState({model:r})}_getModel(){return new zi(this.context.device,{...this.getShaders(),id:this.props.id,geometry:new MB,isInstanced:!0})}draw({uniforms:e}){const{cellSize:r,offset:i,extruded:n,elevationScale:o,coverage:s,gridSize:f,gridOrigin:A,gridOffset:v,elevationRange:w,colorMaxMinBuffer:C,elevationMaxMinBuffer:I}=this.props,B=this.state.model,F=[dp(A[0]),dp(A[1])],N=[dp(v[0]),dp(v[1])],V=this.getDomainUniforms(),G=ay(this.props.colorRange);this.bindUniformBuffers(C,I),B.setUniforms(e),B.setUniforms(V),B.setUniforms({cellSize:r,offset:i,extruded:n,elevationScale:o,coverage:s,gridSize:f,gridOrigin:A,gridOriginLow:F,gridOffset:v,gridOffsetLow:N,colorRange:G,elevationRange:w}),B.draw(this.context.renderPass),this.unbindUniformBuffers(C,I)}bindUniformBuffers(e,r){e.bind({target:35345,index:m1}),r.bind({target:35345,index:_1})}unbindUniformBuffers(e,r){e.unbind({target:35345,index:m1}),r.unbind({target:35345,index:_1})}getDomainUniforms(){const{colorDomain:e,elevationDomain:r}=this.props,i={};return e!==null?(i.colorDomainValid=!0,i.colorDomain=e):i.colorDomainValid=!1,r!==null?(i.elevationDomainValid=!0,i.elevationDomain=r):i.elevationDomainValid=!1,i}_setupUniformBuffer(e){const r=e.pipeline.handle,i=this.context.gl,n=i.getUniformBlockIndex(r,"ColorData"),o=i.getUniformBlockIndex(r,"ElevationData");i.uniformBlockBinding(r,n,m1),i.uniformBlockBinding(r,o,_1)}}Fw.layerName="GPUGridCellLayer";Fw.defaultProps=Ide;const Mde={colorDomain:null,colorRange:gA,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0},Rde={data:{props:["cellSize","colorAggregation","elevationAggregation"]}},SM="positions";class b0 extends uy{initializeState({device:e}){const r=Hl.isSupported(e);r||fr.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),super.initializeAggregationLayer({dimensions:Rde}),this.setState({gpuAggregation:!1,projectPoints:!1,isSupported:r,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:e.createBuffer({byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:e.createBuffer({byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"}),this.getAttributeManager().add({[SM]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},color:{size:3,accessor:"getColorWeight"},elevation:{size:3,accessor:"getElevationWeight"}})}updateState(e){if(this.state.isSupported===!1)return;super.updateState(e);const{aggregationDirty:r}=this.state;r&&this.setState({gridHash:null})}getHashKeyForIndex(e){const{numRow:r,numCol:i,boundingBox:n,gridOffset:o}=this.state,s=[i,r],f=[n.xMin,n.yMin],A=[o.xOffset,o.yOffset],v=Math.floor(e/s[0]),w=e-v*s[0],C=Math.floor((v*A[1]+f[1]+90+A[1]/2)/A[1]),I=Math.floor((w*A[0]+f[0]+180+A[0]/2)/A[0]);return`${C}-${I}`}getPositionForIndex(e){const{numRow:r,numCol:i,boundingBox:n,gridOffset:o}=this.state,s=[i,r],f=[n.xMin,n.yMin],A=[o.xOffset,o.yOffset],v=Math.floor(e/s[0]),w=e-v*s[0],C=v*A[1]+f[1];return[w*A[0]+f[0],C]}getPickingInfo({info:e,mode:r}){const{index:i}=e;let n=null;if(i>=0){const o=this.state.gpuGridAggregator,s=this.getPositionForIndex(i),f=Hl.getAggregationData({pixelIndex:i,...o.getData("color")}),A=Hl.getAggregationData({pixelIndex:i,...o.getData("elevation")});if(n={colorValue:f.cellWeight,elevationValue:A.cellWeight,count:f.cellCount||A.cellCount,position:s,totalCount:f.totalCount||A.totalCount},r!=="hover"){const{props:v}=this;let{gridHash:w}=this.state;if(!w){const{gridOffset:B,translation:F,boundingBox:N}=this.state,{viewport:V}=this.context,G=this.getAttributes();w=Mw(v,{gridOffset:B,attributes:G,viewport:V,translation:F,boundingBox:N}).gridHash,this.setState({gridHash:w})}const C=this.getHashKeyForIndex(i),I=w[C];Object.assign(n,I)}}return e.picked=!!n,e.object=n,e}renderLayers(){if(!this.state.isSupported)return null;const{elevationScale:e,extruded:r,cellSize:i,coverage:n,material:o,elevationRange:s,colorDomain:f,elevationDomain:A}=this.props,{weights:v,numRow:w,numCol:C,gridOrigin:I,gridOffset:B}=this.state,{color:F,elevation:N}=v,V=ay(this.props.colorRange),G=this.getSubLayerClass("gpu-grid-cell",Fw);return new G({gridSize:[C,w],gridOrigin:I,gridOffset:[B.xOffset,B.yOffset],colorRange:V,elevationRange:s,colorDomain:f,elevationDomain:A,cellSize:i,coverage:n,material:o,elevationScale:e,extruded:r},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:F.aggregationBuffer,elevations:N.aggregationBuffer}},colorMaxMinBuffer:F.maxMinBuffer,elevationMaxMinBuffer:N.maxMinBuffer,numInstances:C*w})}finalizeState(e){const{color:r,elevation:i}=this.state.weights;[r,i].forEach(n=>{const{aggregationBuffer:o,maxMinBuffer:s}=n;s==null||s.destroy(),o==null||o.destroy()}),super.finalizeState(e)}updateAggregationState(e){const{props:r,oldProps:i}=e,{cellSize:n,coordinateSystem:o}=r,{viewport:s}=this.context,f=i.cellSize!==n,{dimensions:A}=this.state,v=this.isAttributeChanged(SM),w=v||this.isAttributeChanged();let{boundingBox:C}=this.state;if(v&&(C=LF(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:C})),v||f){const{gridOffset:B,translation:F,width:N,height:V,numCol:G,numRow:Y}=NF(C,n,s,o);this.allocateResources(Y,G),this.setState({gridOffset:B,translation:F,gridOrigin:[-1*F[0],-1*F[1]],width:N,height:V,numCol:G,numRow:Y})}const I=w||this.isAggregationDirty(e,{dimension:A.data,compareAll:!0});I&&this._updateAccessors(e),this.setState({aggregationDataDirty:I})}_updateAccessors(e){const{colorAggregation:r,elevationAggregation:i}=e.props,{color:n,elevation:o}=this.state.weights;n.operation=Pn[r],o.operation=Pn[i]}}b0.layerName="GPUGridLayer";b0.defaultProps=Mde;const Bde={...b0.defaultProps,...v0.defaultProps,gpuAggregation:!1};class Lw extends rs{initializeState(){this.state={useGPUAggregation:!1}}updateState({props:e}){this.setState({useGPUAggregation:!1})}renderLayers(){const{data:e,updateTriggers:r}=this.props,i=this.state.useGPUAggregation?"GPU":"CPU",n=this.state.useGPUAggregation?this.getSubLayerClass("GPU",b0):this.getSubLayerClass("CPU",v0);return new n(this.props,this.getSubLayerProps({id:i,updateTriggers:r}),{data:e})}canUseGPUAggregation(e){const{gpuAggregation:r,lowerPercentile:i,upperPercentile:n,getColorValue:o,getElevationValue:s,colorScaleType:f}=e;return!(!r||!Hl.isSupported(this.context.device)||i!==0||n!==100||o!==null||s!==null||f==="quantile"||f==="ordinal")}}Lw.layerName="GridLayer";Lw.defaultProps=Bde;function Ode(t){const e=t.map(f=>f[0]),r=t.map(f=>f[1]),i=Math.min.apply(null,e),n=Math.max.apply(null,e),o=Math.min.apply(null,r),s=Math.max.apply(null,r);return[i,o,n,s]}function Dde(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}const CM=new Float32Array(12);function PM(t,e=2){let r=0;for(const i of t)for(let n=0;n<e;n++)CM[r++]=i[n]||0;return CM}function Fde(t,e,r){const[i,n,o,s]=t,f=o-i,A=s-n;let v=f,w=A;f/A<e/r?v=e/r*A:w=r/e*f,v<e&&(v=e,w=r);const C=(o+i)/2,I=(s+n)/2;return[C-v/2,I-w/2,C+v/2,I+w/2]}function Lde(t,e){const[r,i,n,o]=e;return[(t[0]-r)/(n-r),(t[1]-i)/(o-i)]}const kde=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
uniform float intensity;
uniform vec2 colorDomain;
uniform float threshold;
uniform float aggregationMode;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * threshold;
if (colorDomain[1] > 0.) {
maxValue = colorDomain[1];
minValue = colorDomain[0];
}
vIntensityMax = intensity / maxValue;
vIntensityMin = intensity / minValue;
}
`,Nde=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
uniform float aggregationMode;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= opacity;
fragColor = linearColor;
}
`;class UF extends Wn{getShaders(){return{vs:kde,fs:Nde,modules:[uo]}}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:r,data:i,weightsTexture:n,maxTexture:o,colorTexture:s}=this.props;return new zi(e,{...this.getShaders(),id:this.props.id,bindings:{weightsTexture:n,maxTexture:o,colorTexture:s},attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-fan-webgl",vertexCount:r})}draw({uniforms:e}){const{model:r}=this.state,{intensity:i,threshold:n,aggregationMode:o,colorDomain:s}=this.props;r.setUniforms({...e,intensity:i,threshold:n,aggregationMode:o,colorDomain:s}),r.draw(this.context.renderPass)}}UF.layerName="TriangleLayer";const IM=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
uniform float radiusPixels;
uniform float textureWidth;
uniform vec4 commonBounds;
uniform float weightsScale;
void main()
{
weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,MM=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Ude=`#version 300 es
uniform sampler2D inTexture;
uniform float textureSize;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(textureSize);
int xIndex = gl_VertexID - (yIndex * int(textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,zde=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,Vde=2,y1={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},RM=[0,0],jde={SUM:0,MEAN:1},Hde={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:gA,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},Gde=["float32-renderable-webgl","texture-blend-float-webgl"],Wde={data:{props:["radiusPixels"]}};class kw extends mA{initializeState(){super.initializeAggregationLayer(Wde),this.setState({colorDomain:RM}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:r,oldProps:i}=e,n=this._getChangeFlags(e);(n.dataChanged||n.viewportChanged)&&(n.boundsChanged=this._updateBounds(n.dataChanged),this._updateTextureRenderingBounds()),n.dataChanged||n.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):n.viewportZoomChanged&&this._debouncedUpdateWeightmap(),r.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:r,triTexCoordBuffer:i,maxWeightsTexture:n,colorTexture:o,colorDomain:s}=this.state,{updateTriggers:f,intensity:A,threshold:v,aggregation:w}=this.props,C=this.getSubLayerClass("triangle",UF);return new C(this.getSubLayerProps({id:"triangle-layer",updateTriggers:f}),{coordinateSystem:br.DEFAULT,data:{attributes:{positions:r,texCoords:i}},vertexCount:4,maxTexture:n,colorTexture:o,aggregationMode:jde[w]||0,weightsTexture:e,intensity:A,threshold:v,colorDomain:s})}finalizeState(e){super.finalizeState(e);const{weightsTransform:r,weightsTexture:i,maxWeightTransform:n,maxWeightsTexture:o,triPositionBuffer:s,triTexCoordBuffer:f,colorTexture:A,updateTimer:v}=this.state;r==null||r.destroy(),i==null||i.destroy(),n==null||n.destroy(),o==null||o.destroy(),s==null||s.destroy(),f==null||f.destroy(),A==null||A.destroy(),v&&clearTimeout(v)}_getAttributeManager(){return new W2(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const r={},{dimensions:i}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",r.viewportChanged=e.changeFlags.viewportChanged;const{zoom:n}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==n)&&(r.viewportZoomChanged=!0),r}_createTextures(){const{textureSize:e,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...y1,width:e,height:e,format:r}),maxWeightsTexture:this.context.device.createTexture({...y1,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:r}=this.props,i=Math.min(r,e.limits.maxTextureDimension2D),n=Gde.every(f=>e.features.has(f)),o=n?"rgba32float":"rgba8unorm",s=n?1:1/255;this.setState({textureSize:i,format:o,weightsScale:s}),n||fr.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:r}=this.state;const{weightsTexture:i}=this.state,n=this.getAttributeManager();r==null||r.destroy(),r=new Q1(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:n.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:r,weightsTexture:i,maxWeightsTexture:n}=this.state,o=this.getShaders({vs:IM,fs:MM});this._createWeightsTransform(o);const s=this.getShaders({vs:Ude,fs:zde}),f=new Q1(e,{id:`${this.id}-max-weights-transform`,bindings:{inTexture:i},uniforms:{textureSize:r},targetTexture:n,...s,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}});this.setState({weightsTexture:i,maxWeightsTexture:n,maxWeightTransform:f,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:IM,fs:MM,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:r}=this.context,i=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([r.width,r.height]),r.unproject([0,r.height])].map(f=>f.map(Math.fround)),n=Ode(i),o={visibleWorldBounds:n,viewportCorners:i};let s=!1;if(e||!this.state.worldBounds||!Dde(this.state.worldBounds,n)){const f=this._worldToCommonBounds(n),A=this._commonToWorldBounds(f);this.props.coordinateSystem===br.LNGLAT&&(A[1]=Math.max(A[1],-85.051129),A[3]=Math.min(A[3],85.051129),A[0]=Math.max(A[0],-360),A[2]=Math.min(A[2],360));const v=this._worldToCommonBounds(A);o.worldBounds=A,o.normalizedCommonBounds=v,s=!0}return this.setState(o),s}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:r,normalizedCommonBounds:i,viewportCorners:n}=this.state,{viewport:o}=this.context;e.write(PM(n,3));const s=n.map(f=>Lde(o.projectPosition(f),i));r.write(PM(s,2))}_updateColorTexture(e){const{colorRange:r}=e.props;let{colorTexture:i}=this.state;const n=ay(r,!1,Uint8Array);i&&(i==null?void 0:i.width)===r.length?i.setSubImageData({data:n}):(i==null||i.destroy(),i=this.context.device.createTexture({...y1,data:n,width:r.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){const{radiusPixels:e,colorDomain:r,aggregation:i}=this.props,{worldBounds:n,textureSize:o,weightsScale:s}=this.state,f=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const A=this._worldToCommonBounds(n,{useLayerCoordinateSystem:!0});if(r&&i==="SUM"){const{viewport:B}=this.context,F=B.distanceScales.metersPerUnit[2]*(A[2]-A[0])/o;this.state.colorDomain=r.map(N=>N*F*s)}else this.state.colorDomain=r||RM;const w=this.getAttributeManager().getAttributes(),C=this.getModuleSettings(),I={radiusPixels:e,commonBounds:A,textureWidth:o,weightsScale:s};this._setModelAttributes(f.model,w),f.model.setVertexCount(this.getNumInstances()),f.model.setUniforms(I),f.model.updateModuleSettings(C),f.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:r}=this.state;const{debounceTimeout:i}=this.props;e?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:r})}_worldToCommonBounds(e,r={}){const{useLayerCoordinateSystem:i=!1}=r,[n,o,s,f]=e,{viewport:A}=this.context,{textureSize:v}=this.state,{coordinateSystem:w}=this.props,C=i&&(w===br.LNGLAT_OFFSETS||w===br.METER_OFFSETS),I=C?A.projectPosition(this.props.coordinateOrigin):[0,0],B=v*Vde/A.scale;let F,N;return i&&!C?(F=this.projectPosition([n,o,0]),N=this.projectPosition([s,f,0])):(F=A.projectPosition([n,o,0]),N=A.projectPosition([s,f,0])),Fde([F[0]-I[0],F[1]-I[1],N[0]-I[0],N[1]-I[1]],B,B)}_commonToWorldBounds(e){const[r,i,n,o]=e,{viewport:s}=this.context,f=s.unprojectPosition([r,i]),A=s.unprojectPosition([n,o]);return f.slice(0,2).concat(A.slice(0,2))}}kw.layerName="HeatmapLayer";kw.defaultProps=Hde;const Xde=Object.freeze(Object.defineProperty({__proto__:null,AGGREGATION_OPERATION:Pn,CPUGridLayer:v0,ContourLayer:Dw,GPUGridLayer:b0,GridLayer:Lw,HeatmapLayer:kw,HexagonLayer:Ow,ScreenGridLayer:Rw,_AggregationLayer:mA,_BinSorter:Iw,_CPUAggregator:Bw,_GPUGridAggregator:Hl},Symbol.toStringTag,{value:"Module"})),qde={ClusterTileLayer:Aw,H3TileLayer:gw,HeatmapTileLayer:_w,_PointLabelLayer:yw,QuadbinTileLayer:oy,RasterTileLayer:bw,VectorTileLayer:ww};function i2(t,e=""){if(!t)throw new Error(`JSON conversion error ${e}`)}function $de(t,e){const r=Kde(e);let i=t;for(const n of r)i=Zde(i)?i[n]:void 0;return i}function Zde(t){return t!==null&&typeof t=="object"}const BM={};function Kde(t){if(typeof t=="string"){let e=BM[t];return e||(e=t.split("."),BM[t]=e),e}return Array.isArray(t)?t:[t]}var n2={exports:{}};(function(t,e){(function(r){var i="Compound",n="Identifier",o="MemberExpression",s="Literal",f="ThisExpression",A="CallExpression",v="UnaryExpression",w="BinaryExpression",C="LogicalExpression",I="ConditionalExpression",B="ArrayExpression",F=46,N=44,V=39,G=34,Y=40,Z=41,se=91,ge=93,Pe=63,Ue=59,Fe=58,pe=function(Rt,ut){var Vi=new Error(Rt+" at character "+ut);throw Vi.index=ut,Vi.description=Rt,Vi},Te=!0,Ae={"-":Te,"!":Te,"~":Te,"+":Te},Le={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Ve=function(Rt){var ut=0,Vi;for(var Sr in Rt)(Vi=Sr.length)>ut&&Rt.hasOwnProperty(Sr)&&(ut=Vi);return ut},Xe=Ve(Ae),dt=Ve(Le),Nt={true:!0,false:!1,null:null},gr="this",mr=function(Rt){return Le[Rt]||0},_r=function(Rt,ut,Vi){var Sr=Rt==="||"||Rt==="&&"?C:w;return{type:Sr,operator:Rt,left:ut,right:Vi}},rr=function(Rt){return Rt>=48&&Rt<=57},Ot=function(Rt){return Rt===36||Rt===95||Rt>=65&&Rt<=90||Rt>=97&&Rt<=122||Rt>=128&&!Le[String.fromCharCode(Rt)]},Qt=function(Rt){return Rt===36||Rt===95||Rt>=65&&Rt<=90||Rt>=97&&Rt<=122||Rt>=48&&Rt<=57||Rt>=128&&!Le[String.fromCharCode(Rt)]},qt=function(Rt){for(var ut=0,Vi=Rt.charAt,Sr=Rt.charCodeAt,Ur=function(vt){return Vi.call(Rt,vt)},Dt=function(vt){return Sr.call(Rt,vt)},$r=Rt.length,Pi=function(){for(var vt=Dt(ut);vt===32||vt===9||vt===10||vt===13;)vt=Dt(++ut)},yi=function(){var vt=gn(),Yt,Mr;if(Pi(),Dt(ut)===Pe){if(ut++,Yt=yi(),Yt||pe("Expected expression",ut),Pi(),Dt(ut)===Fe)return ut++,Mr=yi(),Mr||pe("Expected expression",ut),{type:I,test:vt,consequent:Yt,alternate:Mr};pe("Expected :",ut)}else return vt},dr=function(){Pi();for(var vt=Rt.substr(ut,dt),Yt=vt.length;Yt>0;){if(Le.hasOwnProperty(vt)&&(!Ot(Dt(ut))||ut+vt.length<Rt.length&&!Qt(Dt(ut+vt.length))))return ut+=Yt,vt;vt=vt.substr(0,--Yt)}return!1},gn=function(){var vt,Yt,Mr,qr,kn,Di,mn,Xn,ho;if(Di=oi(),Yt=dr(),!Yt)return Di;for(kn={value:Yt,prec:mr(Yt)},mn=oi(),mn||pe("Expected expression after "+Yt,ut),qr=[Di,kn,mn];(Yt=dr())&&(Mr=mr(Yt),Mr!==0);){for(kn={value:Yt,prec:Mr},ho=Yt;qr.length>2&&Mr<=qr[qr.length-2].prec;)mn=qr.pop(),Yt=qr.pop().value,Di=qr.pop(),vt=_r(Yt,Di,mn),qr.push(vt);vt=oi(),vt||pe("Expected expression after "+ho,ut),qr.push(kn,vt)}for(Xn=qr.length-1,vt=qr[Xn];Xn>1;)vt=_r(qr[Xn-1].value,qr[Xn-2],vt),Xn-=2;return vt},oi=function(){var vt,Yt,Mr;if(Pi(),vt=Dt(ut),rr(vt)||vt===F)return xi();if(vt===V||vt===G)return an();if(vt===se)return Is();for(Yt=Rt.substr(ut,Xe),Mr=Yt.length;Mr>0;){if(Ae.hasOwnProperty(Yt)&&(!Ot(Dt(ut))||ut+Yt.length<Rt.length&&!Qt(Dt(ut+Yt.length))))return ut+=Mr,{type:v,operator:Yt,argument:oi(),prefix:!0};Yt=Yt.substr(0,--Mr)}return Ot(vt)||vt===Y?ln():!1},xi=function(){for(var vt="",Yt,Mr;rr(Dt(ut));)vt+=Ur(ut++);if(Dt(ut)===F)for(vt+=Ur(ut++);rr(Dt(ut));)vt+=Ur(ut++);if(Yt=Ur(ut),Yt==="e"||Yt==="E"){for(vt+=Ur(ut++),Yt=Ur(ut),(Yt==="+"||Yt==="-")&&(vt+=Ur(ut++));rr(Dt(ut));)vt+=Ur(ut++);rr(Dt(ut-1))||pe("Expected exponent ("+vt+Ur(ut)+")",ut)}return Mr=Dt(ut),Ot(Mr)?pe("Variable names cannot start with a number ("+vt+Ur(ut)+")",ut):Mr===F&&pe("Unexpected period",ut),{type:s,value:parseFloat(vt),raw:vt}},an=function(){for(var vt="",Yt=Ur(ut++),Mr=!1,qr;ut<$r;)if(qr=Ur(ut++),qr===Yt){Mr=!0;break}else if(qr==="\\")switch(qr=Ur(ut++),qr){case"n":vt+=`
`;break;case"r":vt+="\r";break;case"t":vt+="	";break;case"b":vt+="\b";break;case"f":vt+="\f";break;case"v":vt+="\v";break;default:vt+=qr}else vt+=qr;return Mr||pe('Unclosed quote after "'+vt+'"',ut),{type:s,value:vt,raw:Yt+vt+Yt}},$i=function(){var vt=Dt(ut),Yt=ut,Mr;for(Ot(vt)?ut++:pe("Unexpected "+Ur(ut),ut);ut<$r&&(vt=Dt(ut),Qt(vt));)ut++;return Mr=Rt.slice(Yt,ut),Nt.hasOwnProperty(Mr)?{type:s,value:Nt[Mr],raw:Mr}:Mr===gr?{type:f}:{type:n,name:Mr}},Zs=function(vt){for(var Yt,Mr=[],qr,kn=!1,Di=0;ut<$r;)if(Pi(),Yt=Dt(ut),Yt===vt){kn=!0,ut++,vt===Z&&Di&&Di>=Mr.length&&pe("Unexpected token "+String.fromCharCode(vt),ut);break}else if(Yt===N){if(ut++,Di++,Di!==Mr.length){if(vt===Z)pe("Unexpected token ,",ut);else if(vt===ge)for(var mn=Mr.length;mn<Di;mn++)Mr.push(null)}}else qr=yi(),(!qr||qr.type===i)&&pe("Expected comma",ut),Mr.push(qr);return kn||pe("Expected "+String.fromCharCode(vt),ut),Mr},ln=function(){var vt,Yt;for(vt=Dt(ut),vt===Y?Yt=ni():Yt=$i(),Pi(),vt=Dt(ut);vt===F||vt===se||vt===Y;)ut++,vt===F?(Pi(),Yt={type:o,computed:!1,object:Yt,property:$i()}):vt===se?(Yt={type:o,computed:!0,object:Yt,property:yi()},Pi(),vt=Dt(ut),vt!==ge&&pe("Unclosed [",ut),ut++):vt===Y&&(Yt={type:A,arguments:Zs(Z),callee:Yt}),Pi(),vt=Dt(ut);return Yt},ni=function(){ut++;var vt=yi();if(Pi(),Dt(ut)===Z)return ut++,vt;pe("Unclosed (",ut)},Is=function(){return ut++,{type:B,elements:Zs(ge)}},nn=[],Oi,is;ut<$r;)Oi=Dt(ut),Oi===Ue||Oi===N?ut++:(is=yi())?nn.push(is):ut<$r&&pe('Unexpected "'+Ur(ut)+'"',ut);return nn.length===1?nn[0]:{type:i,body:nn}};qt.version="0.3.5",qt.toString=function(){return"JavaScript Expression Parser (JSEP) v"+qt.version},qt.addUnaryOp=function(Rt){return Xe=Math.max(Rt.length,Xe),Ae[Rt]=Te,this},qt.addBinaryOp=function(Rt,ut){return dt=Math.max(Rt.length,dt),Le[Rt]=ut,this},qt.addLiteral=function(Rt,ut){return Nt[Rt]=ut,this},qt.removeUnaryOp=function(Rt){return delete Ae[Rt],Rt.length===Xe&&(Xe=Ve(Ae)),this},qt.removeAllUnaryOps=function(){return Ae={},Xe=0,this},qt.removeBinaryOp=function(Rt){return delete Le[Rt],Rt.length===dt&&(dt=Ve(Le)),this},qt.removeAllBinaryOps=function(){return Le={},dt=0,this},qt.removeLiteral=function(Rt){return delete Nt[Rt],this},qt.removeAllLiterals=function(){return Nt={},this},t.exports?e=t.exports=qt:e.parse=qt})()})(n2,n2.exports);var Yde=n2.exports;const Jde=oA(Yde),OM={"||":(t,e)=>t||e,"&&":(t,e)=>t&&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"&":(t,e)=>t&e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"<":(t,e)=>t<e,">":(t,e)=>t>e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e},Qde={"-":t=>-t,"+":t=>+t,"~":t=>~t,"!":t=>!t};function DM(t,e){return t.map(function(r){return Ss(r,e)})}function FM(t,e){const r=Ss(t.object,e);let i;if(t.computed?i=Ss(t.property,e):i=t.property.name,/^__proto__|prototype|constructor$/.test(i))throw Error(`Access to member "${i}" disallowed.`);return[r,r[i]]}function Ss(t,e){const r=t;switch(r.type){case"ArrayExpression":return DM(r.elements,e);case"BinaryExpression":return OM[r.operator](Ss(r.left,e),Ss(r.right,e));case"CallExpression":let i,n,o;return r.callee.type==="MemberExpression"?(o=FM(r.callee,e),i=o[0],n=o[1]):n=Ss(r.callee,e),typeof n!="function"?void 0:n.apply(i,DM(r.arguments,e));case"ConditionalExpression":return Ss(r.test,e)?Ss(r.consequent,e):Ss(r.alternate,e);case"Identifier":return e[r.name];case"Literal":return r.value;case"LogicalExpression":return r.operator==="||"?Ss(r.left,e)||Ss(r.right,e):r.operator==="&&"?Ss(r.left,e)&&Ss(r.right,e):OM[r.operator](Ss(r.left,e),Ss(r.right,e));case"MemberExpression":return FM(r,e)[1];case"ThisExpression":return e;case"UnaryExpression":return Qde[r.operator](Ss(r.argument,e));default:return}}const v1={"-":t=>t};function zF(t,e){if(t in v1)return v1[t];let r;const i=Jde(t);return i.type==="Identifier"?r=n=>$de(n,t):(s2(i,n=>{if(n.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),r=n=>Ss(i,n)),v1[t]=r,r}function s2(t,e){if(Array.isArray(t))t.forEach(r=>s2(r,e));else if(t&&typeof t=="object"){t.type&&e(t);for(const r in t)s2(t[r],e)}}const n_="@@=",LM="@@#",eAe="@@type",VF="@@function",kM=t=>t&&typeof t=="object";class o2{constructor(...e){this.typeKey=eAe,this.functionKey=VF,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=zF,this.preProcessClassProps=(r,i)=>i,this.postProcessConvertedJson=r=>r;for(const r of e)this.merge(r)}merge(e){for(const r in e)switch(r){case"layers":case"views":Object.assign(this.classes,e[r]);break;default:if(r in this){const i=e[r];this[r]=kM(this[r])?Object.assign(this[r],i):i}}}validate(e){return i2(!this.typeKey||typeof this.typeKey=="string"),i2(kM(this.classes)),!0}}function tAe(t){return typeof t=="string"&&t.startsWith(n_)}function rAe(t){return t.replace(n_,"")}function jF(t,e){const r={};for(const i in t){let n=t[i];tAe(n)&&(n=rAe(n),n=zF(n)),r[i]=n}return r}function iAe(t,e,r){const i=r.classes[t],n=r.reactComponents[t];if(!i&&!n){const{log:o}=r;if(o){const s=JSON.stringify(e,null,0).slice(0,40);o.warn(`JSON converter: No registered class of type ${t}(${s}...)  `)}return null}return i?nAe(i,e,r):sAe(n,e,r)}function nAe(t,e,r){return r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=jF(e),new t(e)}function sAe(t,e,r){const{React:i}=r,{children:n=[]}=e;return delete e.children,r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=jF(e),i.createElement(t,e,n)}function oAe(t,e,r){const i=r.functions[t];if(!i){const{log:n}=r;if(n){const o=JSON.stringify(e,null,0).slice(0,40);n.warn(`JSON converter: No registered function ${t}(${o}...)  `)}return null}return i(e)}function aAe(t){return typeof t=="string"?JSON.parse(t):t}const Nw=t=>t&&typeof t=="object";class lAe{constructor(e){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(e)}finalize(){}setProps(e){"configuration"in e&&(this.configuration=e.configuration instanceof o2?e.configuration:new o2(e.configuration)),"onJSONChange"in e&&(this.onJSONChange=e.onJSONChange)}mergeConfiguration(e){this.configuration.merge(e)}convert(e){if(!e||e===this.json)return this.convertedJson;this.json=e;const r=aAe(e);let i=cAe(r,this.configuration);return i=this.configuration.postProcessConvertedJson(i),this.convertedJson=i,i}convertJson(e){return this.convert(e)}}function cAe(t,e){return e=new o2(e),Uw(t,"",e)}function Uw(t,e,r){return Array.isArray(t)?t.map((i,n)=>Uw(i,String(n),r)):uAe(t,r)?hAe(t,r):Nw(t)?VF in t?fAe(t,r):zw(t,r):typeof t=="string"?dAe(t,e,r):t}function uAe(t,e){const{typeKey:r}=e;return Nw(t)&&!!t[r]}function hAe(t,e){const{typeKey:r}=e,i=t[r];let n={...t};return delete n[r],n=zw(n,e),iAe(i,n,e)}function fAe(t,e){const{functionKey:r}=e,i=t[r];let n={...t};return delete n[r],n=zw(n,e),oAe(i,n,e)}function zw(t,e){i2(Nw(t));const r={};for(const i in t){const n=t[i];r[i]=Uw(n,i,e)}return r}function dAe(t,e,r){if(t.startsWith(n_)&&r.convertFunction)return t=t.replace(n_,""),r.convertFunction(t,r);if(t.startsWith(LM)){if(t=t.replace(LM,""),r.constants[t])return r.constants[t];const[i,n]=t.split(".");return r.enumerations[i][n]}return t}const AAe={classes:{...ote,...Xde,...Vce,...Mse,...qde},functions:{colorBins:efe,colorCategories:tfe,colorContinuous:rfe}},HF=new lAe({configuration:AAe}),pAe={[ry.layerName]:["getFillColor"],[Y_.layerName]:["getFillColor"],[$l.layerName]:["getFillColor"],[AA.layerName]:["getFillColor"],[W_.layerName]:["getFillColor"],[G_.layerName]:["getFillColor"],[$_.layerName]:["getColor"],[c0.layerName]:["getTargetColor","getSourceColor"],[Lc.layerName]:["getFillColor"],[kc.layerName]:["getFillColor"],[dA.layerName]:["getColor"],[u0.layerName]:["getColor"],[$h.layerName]:["getColor"],[h0.layerName]:["getColor"],[Vu.layerName]:["getFillColor"],[f0.layerName]:["getFillColor","getColor","getLineColor"],[zu.layerName]:["getFillColor"],[Zh.layerName]:["getColor"],[g0.layerName]:["getColor"],[zh.layerName]:["getColor"]},gAe=({object:t,objectInfo:e,originalFillFunction:r})=>{const i=typeof r=="function"?r(t,e):r;if(Array.isArray(i))return[i[0]||0,i[1]||0,i[2]||0,i[3]||255];if(typeof i=="string"&&i.startsWith("@@=")){const n=HF.convert({originalColor:i}).originalColor(t);return[n[0]||0,n[1]||0,n[2]||0,n[3]||255]}return null},NM=({isSelected:t,object:e,objectInfo:r,opacity:i,originalFillFunction:n})=>{const o=gAe({object:e,objectInfo:r,originalFillFunction:n});if(!o)return null;let s=0;return t?s=Math.max(typeof o[3]=="number"?o[3]:i,i):s=Math.min(typeof o[3]=="number"?o[3]:i,i),[o[0]||0,o[1]||0,o[2]||0,s]},mAe=({isSelected:t,object:e,objectInfo:r,originalFillFunction:i,selectedColor:n,selectedOpacity:o=255,unselectedColor:s,unselectedOpacity:f=Math.floor(255*.4)})=>t?NM({opacity:o,isSelected:!0,object:e,objectInfo:r,originalFillFunction:i})||n:NM({opacity:f,isSelected:!1,object:e,objectInfo:r,originalFillFunction:i})||s,_Ae=500,r0={selection:{indices:{},objects:{}}},UM=(t,e)=>{const r=e.match(/{(.*?)}/g);return r&&r.forEach(i=>{const n=i.substring(1,i.length-1);t.object.hasOwnProperty(n)?e=e.replace(i,t.object[n]):t.object.hasOwnProperty("properties")&&t.object.properties.hasOwnProperty(n)&&(e=e.replace(i,t.object.properties[n]))}),e};function yAe(t,e){return e.id?t.getElementState(e.id,"selection")??r0:r0}function vAe(t,e){if(!e.id)return r0;const r=t.getStringValue(e);return(r?w1.parse(r):null)??r0}function bAe(t,e,r,i){t.id&&e.setStringValue(t,JSON.stringify(r.value),{fromUi:r.fromUi},i)}const xAe=t=>{var Le;const{height:e,width:r,expanded:i}=WM(XM),{element:n,fragmentId:o,isLightTheme:s,theme:f,widgetMgr:A}=t,{selectionMode:v,tooltip:w,useContainerWidth:C}=n,I=i??!1,[B,F]=LL({element:n,getDefaultState:yAe,getStateFromWidgetMgr:vAe,updateWidgetMgrState:bAe,widgetMgr:A,fragmentId:o}),[N,V]=it.useState({bearing:0,pitch:0,zoom:11}),{height:G,width:Y}=RJ({element:n,isFullScreen:I,shouldUseContainerWidth:C,container:{height:e,width:r},heightFallback:((Le=N.initialViewState)==null?void 0:Le.height)||_Ae}),[Z,se]=it.useState({}),ge=v[0],Pe=ge!==void 0,Ue=Pe&&Object.keys(B.selection.indices).length>0,Fe=it.useMemo(()=>Object.freeze(w1.parse(n.json)),[I,s,n.json]),pe=it.useMemo(()=>{const Ve={...Fe};if(Ve.mapStyle||(Ve.mapStyle=`mapbox://styles/mapbox/${s?"light":"dark"}-v9`),Ve.layers){const Xe=Object.values(B.selection.indices).some(Nt=>Nt==null?void 0:Nt.length),dt=Ve.layers.some(Nt=>Object.hasOwn(Nt,"pickable"));Ve.layers=Ve.layers.map(Nt=>{var Ot,Qt;if(!Nt||Array.isArray(Nt)||!Pe)return Nt;dt||(Nt.pickable=!0);const gr=`${Nt.id||null}`,mr=((Qt=(Ot=B==null?void 0:B.selection)==null?void 0:Ot.indices)==null?void 0:Qt[gr])||[],_r=pAe[Nt["@@type"]];if(!_r)return Nt;const rr={...Nt};return _r.forEach(qt=>{var dr;rr.updateTriggers={[qt]:[...((dr=rr.updateTriggers)==null?void 0:dr[qt])||[],mr,Xe]};const Rt=!Xe,ut=Nt[qt];if(Rt||!ut)return rr;const Vi=255,Sr=Math.floor(255*.4),Ur=cE(f.colors.primary),Dt=[Ur[0],Ur[1],Ur[2],Vi],$r=cE(f.colors.gray20),Pi=[$r[0],$r[1],$r[2],Sr],yi=(gn,oi)=>mAe({isSelected:mr.includes(oi.index),object:gn,objectInfo:oi,originalFillFunction:ut,selectedColor:Dt,unselectedColor:Pi,selectedOpacity:Vi,unselectedOpacity:Sr});rr[qt]=yi}),rr})}return Ve==null||delete Ve.views,HF.convert(Ve)},[B.selection.indices,s,Pe,Fe,f.colors.gray20,f.colors.primary]);it.useEffect(()=>{if(!ML(pe.initialViewState,Z)){const Ve=Object.keys(pe.initialViewState).reduce((Xe,dt)=>pe.initialViewState[dt]===Z[dt]?Xe:{...Xe,[dt]:pe.initialViewState[dt]},{});V({...N,...Ve}),se(pe.initialViewState)}},[pe.initialViewState,Z,N]);const Te=it.useCallback(Ve=>{if(!Ve||!Ve.object||!w)return null;const Xe=w1.parse(w);return Xe.html?Xe.html=UM(Ve,Xe.html):Xe.text=UM(Ve,Xe.text),Xe},[w]),Ae=it.useCallback(({viewState:Ve})=>{V(Ve)},[V]);return{createTooltip:Te,data:B,deck:pe,hasActiveSelection:Ue,height:G,isSelectionModeActivated:Pe,onViewStateChange:Ae,selectionMode:ge,setSelection:F,viewState:N,width:Y}};s0([hx,tA]);const b1=r0.selection,wAe=[],TAe=t=>{const{disabled:e,disableFullscreenMode:r,element:i,fragmentId:n,mapboxToken:o,widgetMgr:s}=t,{mapboxToken:f}=i,A=RL(),{expanded:v,expand:w,collapse:C}=WM(XM),{createTooltip:I,data:B,deck:F,hasActiveSelection:N,height:V,isSelectionModeActivated:G,onViewStateChange:Y,selectionMode:Z,setSelection:se,viewState:ge,width:Pe}=xAe({element:i,fragmentId:n,isLightTheme:GM(A),theme:A,widgetMgr:s}),[Ue,Fe]=it.useState(!1);it.useEffect(()=>{Fe(!0)},[]);const pe=it.useCallback(Ae=>{var _r;if(Z===void 0)return;const{index:Le,object:Ve}=Ae,Xe=`${((_r=Ae.layer)==null?void 0:_r.id)||null}`,dt=B,Nt=Le===-1,mr=(()=>{var rr;if(Nt)return b1;switch(Z){case uE.SelectionMode.SINGLE_OBJECT:return((rr=dt.selection.indices[Xe])==null?void 0:rr[0])===Le?b1:{indices:{[`${Xe}`]:[Le]},objects:{[`${Xe}`]:[Ve]}};case uE.SelectionMode.MULTI_OBJECT:{const Ot=new Map((()=>{var qt,Rt;return(((Rt=(qt=dt==null?void 0:dt.selection)==null?void 0:qt.indices)==null?void 0:Rt[Xe])||[]).map((ut,Vi)=>{var Sr,Ur,Dt;return[ut,(Dt=(Ur=(Sr=dt.selection)==null?void 0:Sr.objects)==null?void 0:Ur[Xe])==null?void 0:Dt[Vi]]})})());if(Ot.has(Le)?Ot.delete(Le):Ot.set(Le,Ve),Ot.size===0){const{[Xe]:Qt,...qt}=dt.selection.indices,{[Xe]:Rt,...ut}=dt.selection.objects;return{indices:qt,objects:ut}}return{indices:{...dt.selection.indices,[`${Xe}`]:Array.from(Ot.keys())},objects:{...dt.selection.objects,[`${Xe}`]:Array.from(Ot.values())}}}default:throw SJ(Z),new Error("Invalid selection mode")}})();JSON.stringify(mr)!==JSON.stringify(dt.selection)&&se({fromUi:!0,value:{selection:mr}})},[Z,B,se]),Te=it.useCallback(()=>{se({value:{selection:b1},fromUi:!0})},[se]);return Ll(E3,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",width:Pe,height:V,children:[ms(DL,{isFullScreen:v,disableFullscreenMode:r,onExpand:w,onCollapse:C,target:E3,locked:N&&!e?!0:void 0,children:N&&!e&&ms(OL,{label:"Clear selection",onClick:Te,icon:BL})}),Ll(SX,{viewState:ge,onViewStateChange:Y,height:V,width:Pe,layers:Ue?F.layers:wAe,getTooltip:I,ContextProvider:qh.Provider,controller:!0,onClick:G&&!e?pe:void 0,children:[ms(Fc,{height:V,width:Pe,mapStyle:F.mapStyle&&(typeof F.mapStyle=="string"?F.mapStyle:F.mapStyle[0]),mapboxApiAccessToken:f||o}),ms(MJ,{children:ms(nZ,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})},KAe=FL(IJ("st.pydeck_chart")(TAe));export{KAe as default};
